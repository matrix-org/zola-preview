<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - General</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="stylesheet" href="/style.css" />

    
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://matrix.org/category/general/atom.xml">
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        <a href="&#x2F;docs&#x2F;" class="
            ">
            Documentation
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="ecosystem-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true"
                >
            <label for="ecosystem-submenu-checkbox" class="submenu-title">Ecosystem <div class="arrow">
                </div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;integrations&#x2F;">Integrations</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<div id="taxonomy-single">
    <div class="content">
        <header>
            <h1>General</h1>
            137 posts tagged with "General" <a href="/category">(See all Category)</a>
            
            <h2>
                <small><a href="https://matrix.org/category/general/atom.xml">Atom Feed</a></small>
            </h2>
            
        </header>

        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2018&#x2F;03&#x2F;16&#x2F;urgent-synapse-0-26-1-hotfix-out&#x2F;" title="Urgent Synapse 0.26.1 hotfix out">Urgent Synapse 0.26.1 hotfix out</a></h2>
                <span>
                    16.03.2018 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>We just rushed out an urgent hotfix release for Synapse 0.26.1, addressing a nasty bug in the ujson library which causes it to misbehave badly in the presence of JSON containing very large &gt;64-bit integers.  Anyone whose synapses are currently filling up with &quot;Value too big!&quot; errors will want to upgrade immediately from <a href="https://github.com/matrix-org/synapse/releases/tag/v0.26.1">https://github.com/matrix-org/synapse/releases/tag/v0.26.1</a>.</p>
<p>Sorry for the inconvenience.</p>
<h3 id="changes-in-synapse-v0-26-1-2018-03-15">Changes in synapse v0.26.1 (2018-03-15)</h3>
<p>Bug fixes:</p>
<ul>
 	<li>Fix bug where an invalid event caused server to stop functioning correctly, due to parsing and serializing bugs in ujson library.</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2018&#x2F;02&#x2F;05&#x2F;3d-video-calling-with-matrix-webrtc-and-webvr-at-fosdem-2018&#x2F;" title="3D Video Calling with Matrix, WebRTC and WebVR at FOSDEM 2018!">3D Video Calling with Matrix, WebRTC and WebVR at FOSDEM 2018!</a></h2>
                <span>
                    05.02.2018 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p><strong>TL;DR: We built a proof-of-concept for <a href="https://fosdem.org/2018/schedule/event/matrix_webvr/">FOSDEM</a> of the world's first(?) 3D video calling using Matrix and the iPhone X... and it looks like this!!</strong></p>
<p><a href="/blog/wp-content/uploads/2018/02/Screen-Shot-2018-02-04-at-16.18.09.jpg"><img class="aligncenter size-large wp-image-2990" src="/blog/wp-content/uploads/2018/02/Screen-Shot-2018-02-04-at-16.18.09-1024x672.jpg" alt="" width="1024" height="672" /></a>
<a href="/blog/wp-content/uploads/2018/02/3dvc.jpeg"><img class="aligncenter size-large wp-image-2989" src="/blog/wp-content/uploads/2018/02/3dvc-1024x768.jpeg" alt="" width="1024" height="768" /></a></p>
<p>Last year we spent a few weeks putting together a <a href="/blog/2017/04/04/opening-up-cyberspace-with-matrix-and-webvr/">proof of concept of using Matrix as an open, interoperable communication layer for VR/AR</a> - showing how you can use it as an open signalling protocol to connect users within (and between) virtual worlds, with full-mesh E2E encrypted video conferencing in VR; WebRTC calls overlaid on 360 degree video, and other fun stuff. The reasons for building the demo were quite eclectic:</p>
<ol>
 	<li>Try to highlight that Matrix is about much more than just about instant messaging or team chat</li>
 	<li>Try to encourage the community to jump in and build out more interesting use cases</li>
 	<li>Learn where the state of the art in WebVR + WebGL is</li>
 	<li>Kick off the process of encouraging folks to think about storing world geometry and physics in Matrix</li>
 	<li>Have a fun visual demo we could show to excite potential investors in New Vector (which comically backfired when the investment community spontaneously decided that <a href="https://techcrunch.com/2017/08/26/this-vr-cycle-is-dead/">VR is still too early</a>).</li>
</ol>
In the end it succeeded on some points (highlighting exotic uses of Matrix; learning all about WebVR) and failed on others (a surge in Matrix-for-VR) - although we did have a lot of fun showing it off at the <a href="https://www.youtube.com/watch?v=y0-j4Q77KXM">ETHLDN meetup</a> back in October. (Eagle eyed viewers may be amused to spot team <a href="https://status.im">Status</a> & Matrix sitting together in the audience ;)
<p>However, we still believe that Matrix is the missing link for decentralised communication within VR/AR, and we were lucky enough to get a <a href="https://fosdem.org/2018/schedule/event/matrix_webvr/">talk about Matrix+WebRTC+WebVR</a> accepted to the Real-Time Communications Devroom at FOSDEM 2018! So, given a new chance to show the world how cool Matrix-powered comms could be in VR/AR, myself and Dave Baker went on a (very) quick detour to update the demo a little...</p>
<p>One of the issues of the original demo is that the video calling bits were just putting plain old video planes into the scene - floating television screens of 2D video content, if you will. This is better than nothing, but it's sort of missing the whole point of VR/AR: surely you want to see who you're talking to in 3D? Ideally they should have the same presence as if they were physically in your virtual space. This could also be a big step towards fixing one of the oldest problems of video calling: gaze correction. We've been obsessed about gaze correction since our early days (pre-Matrix) building mobile video calling stacks: gaze correction tries to fix the fact that the break in eye contact caused by staring at the screen (rather than the camera) has a terrible impact on the emotional connection of a video call. <em>But</em> if the person you are talking to is 3D, you can always rotate them in 3D space (or reposition yourself) to correct their line of sight - to re-align their gaze so they're actually looking (in VR) at the thing they're looking at in real life!</p>
<p>Back in early 2017 it would have been wildly ambitious to build an off-the-shelf 3D video calling app - but this changed overnight in late 2017 with the introduction of the iPhone X and its TrueDepth infrared-dot-projector based depth camera; effectively a mini-Kinect. Suddenly we have a mainstream high quality depth+video camera perfectly optimised for 3D video calling, with <a href="https://developer.apple.com/videos/play/wwdc2017/507/">excellent API support</a> from Apple. So we decided to see if we could be first in the world (as far as we know) to do 3D video calling using the iPhone X, using Matrix to signal the WebRTC media and using our WebVR demo as the viewing environment!</p>
<p><strong>Step 1:</strong> Hack on WebRTC to add support for the iPhone X depth camera as a capture device. This is pretty easy, at least if you're just swapping WebRTC's AVFoundationVideoCapturer to request the depth camera instead of the video camera: <a href="https://github.com/matrix-org/webrtc/commit/c3044670d87c305d8f8ee72751939e281bf5223f">https://github.com/matrix-org/webrtc/commit/c3044670d87c305d8f8ee72751939e281bf5223f</a> is the starting point.</p>
<p><strong>Step 2</strong>: Build a custom Riot/iOS with the right WebRTC SDK.  This is relatively easy thanks to Riot/iOS using CocoaPods and Google shipping a pod for WebRTC these days - it was a matter of tweaking Google's pod so it could be referred to directly as a local project by Riot/iOS (and so that it provided debug symbols in the form CocoaPods expects). Brief notes are at <a href="https://github.com/matrix-org/webrtc/blob/matthew/depth/matrix/build_instructions.txt">https://github.com/matrix-org/webrtc/blob/matthew/depth/matrix/build_instructions.txt</a> - many thanks to Manu for helping on this :)</p>
<p><strong>Step 3:</strong> Decide how to encode the depth buffer. Now, the official WebRTC working group quite correctly insists that depth data should be treated as a first class citizen which is modelled and compressed in its own right. However, it looks like nobody has added first-class depth support to official WebRTC yet - and if we want to be able to easily display 3D calls on generic browsers capable of running WebVR+WebRTC+Matrix, we have no choice but do the ugly thing and encode the depth into a video signal which can be compressed with VP8/VP8/H.264 etc.</p>
<p>A quick search showed that some folks had already proposed a method for encoding depth data into a video signal, back in the days of the Kinect: <a href="https://reality.cs.ucl.ac.uk/projects/depth-streaming/depth-streaming.pdf">https://reality.cs.ucl.ac.uk/projects/depth-streaming/depth-streaming.pdf</a>. The paper outlines a fairly simple approach: you encode the 16-bit depth data into the three 8-bit colour channels; putting the coarse depth data into Blue, and then finer-grained depth data into Red and Green, encoding it as a periodic triangle wave:</p>
<p><a href="/blog/wp-content/uploads/2018/02/Screen-Shot-2018-02-04-at-00.43.53.png"><img class="aligncenter size-large wp-image-2992" src="/blog/wp-content/uploads/2018/02/Screen-Shot-2018-02-04-at-00.43.53-1024x484.png" alt="" width="1024" height="484" /></a></p>
<p>In practice this means that as an object gets closer towards you, it gets gradually more blue - and meanwhile it pulses through a sequence of red and green so you can refine the precise depth more easily. So we went and implemented this, building a 16-bit lookup-table to encode the half-precision floating point 16-bit depth measurements the camera yields into video: <a href="https://github.com/matrix-org/webrtc/compare/c3044670d87c305d8f8ee72751939e281bf5223f...0258a4ef14c11a0161f078c970c64574629761c2.">https://github.com/matrix-org/webrtc/compare/c3044670d87c305d8f8ee72751939e281bf5223f...0258a4ef14c11a0161f078c970c64574629761c2.</a></p>
<p>Placing a video call through to another Matrix client then coughed up a video stream that looks like this:</p>
<p><a href="/blog/wp-content/uploads/2018/02/depth-encoded.jpg"><img class="aligncenter size-large wp-image-2982" src="/blog/wp-content/uploads/2018/02/depth-encoded-956x1024.jpg" alt="" width="956" height="1024" /></a></p>
<p>As you can see, closer things (my head) are bluer than further things (the wall), and everything's covered with trippy red &amp; green stripes to refine the fine detail.  For the record, the iPhone TrueDepth camera emits 640x480 depth frames at around 24Hz.</p>
<p><strong>Step 4</strong>: extend matrix-vr-demo to view a dot cloud, displaced using a WebGL vertex shader based on the encoded depth info.  Dave kindly did the honours: <a href="https://github.com/matrix-org/matrix-vr-demo/commit/b14cdda605d3807080049e84181b46706cec553e">https://github.com/matrix-org/matrix-vr-demo/commit/b14cdda605d3807080049e84181b46706cec553e</a></p>
<p>Unfortunately, it showed that the depth encoding really wasn't working very well... you can just about make out my head, but there are dots flying around all over the place, and when you view it in profile the 3D effect was almost entirely missing.</p>
<p><a href="/blog/wp-content/uploads/2018/02/bad.jpg"><img class="aligncenter size-large wp-image-2983" src="/blog/wp-content/uploads/2018/02/bad-1024x744.jpg" alt="" width="1024" height="744" /></a></p>
<p>The main problems seem to be:</p>
<ul>
 	<li>Whenever there's a big jump in depth, the stripes get incredibly noisy and don't compress at all well, generating completely corrupt data at edges of objects (e.g. the sides of my head)</li>
 	<li>The complexity of the pattern as a whole isn't particularly compression-friendly</li>
 	<li>The contrast of the red/green stripes tends to dominate, causing the arguably more important blue to get overpowered during compression.</li>
 	<li>Converting from 4:4:4 RGB to 4:2:0 YUV (NV12) as required by WebRTC and then back to RGB inevitably entangles the colours - meaning that the extreme contrast of the red/green stripes is very visible on the blue channel after round-tripping due to sampling artefacts.</li>
 	<li>I probably made a mistake by bitwise casting the 16-bit half-precision floating point depth values directly onto the 16-bit unsigned int lookup index, rather than interpreting the float as a number and building a new index into the lookup table based on its numeric value.  As a result, depth values being encoded ended up having a much lower range than they should.</li>
 	<li>There are probably other bugs too.</li>
</ul>
<p><strong>Step 5: </strong>Give up on the fancy depth encoding (for now): <a href="https://github.com/matrix-org/webrtc/commit/2f5d29352ce5d80727639991b1480f610cbdd54c">https://github.com/matrix-org/webrtc/commit/2f5d29352ce5d80727639991b1480f610cbdd54c</a>.  In practice, simply picking a range of the 16-bit half-precision floats to fit in the integer range [0,255] turns out to be good enough for a quick demo (i.e. 8-bit depth buffer, but over a small subset of the 16-bit depth space) - the dot cloud suddenly looked a lot more 3D and recognisable:</p>
<p><a href="/blog/wp-content/uploads/2018/02/fixed.jpg"><img class="aligncenter size-large wp-image-2984" src="/blog/wp-content/uploads/2018/02/fixed-1024x832.jpg" alt="" width="1024" height="832" /></a></p>
<p><strong>Step 6</strong>: Clearly this needs colour as well as depth.  This means asking WebRTC to add VideoTracks for both video and depth to your call's MediaStream.  Firstly, we added a simple 'matrixDepth' constraint to WebRTC to tell a video source whether to capture depth or not.  (Yes, I know there's a <a href="https://www.w3.org/TR/mediacapture-depth/">specced way to do this</a>, but given nothing else here is on spec, we went for the simplest approach).  However, it turns out that only one WebRTC's AVFoundationVideoCapturer can run at a time, because it manages its own AVCaptureSession and you can only have one of those at a time in a given app.  As a result, the two capturers (one per video track) collided, with the second session killing the first session.  As a quick fix, we modified RTCAVFoundationVideoSource to accept an existing AVCaptureSession (and AVCaptureDeviceInput) so that the application itself can handle the capture session and select the device, which can then be shared between multiple capturers: <a href="https://github.com/matrix-org/webrtc/commit/9c58465ada08018b1238fb8c5d784b5570f9246b">https://github.com/matrix-org/webrtc/commit/9c58465ada08018b1238fb8c5d784b5570f9246b</a>.  Finally, just needed a few lines to matrix-ios-sdk to set the constraint and send the depth as well as video... <a href="https://github.com/matrix-org/matrix-ios-sdk/compare/fa9a24a6914b207389bacdd9ad08d5386fd0644a...5947d634ae8d722133ecdbde94cccf60bb88f11d">https://github.com/matrix-org/matrix-ios-sdk/compare/fa9a24a6914b207389bacdd9ad08d5386fd0644a...5947d634ae8d722133ecdbde94cccf60bb88f11d</a>, and adding playback of both channels to the vrdemo (<a href="https://github.com/matrix-org/matrix-vr-demo/commit/4059ab671d13bb4d4eb19dd2f534d9a387e47b81">https://github.com/matrix-org/matrix-vr-demo/commit/4059ab671d13bb4d4eb19dd2f534d9a387e47b81</a> and <a href="https://github.com/matrix-org/matrix-js-sdk/commit/f3f1524fcd46d2e772fd5cd022364018c8889364">https://github.com/matrix-org/matrix-js-sdk/commit/f3f1524fcd46d2e772fd5cd022364018c8889364</a>) ...and it worked!</p>
<p><a href="/blog/wp-content/uploads/2018/02/dots.jpg"><img class="aligncenter size-large wp-image-2985" src="/blog/wp-content/uploads/2018/02/dots-1024x967.jpg" alt="" width="1024" height="967" /></a></p>
<p>However, the dot cloud obviously has some limitations - especially when you zoom in like this.</p>
<p><strong>Step 7</strong>: Replace the dot cloud with a displacement-mapped mesh so that it's solid.  So as a final tweak for the demo, Dave switched out the dot cloud for a simple A-Frame plane with 640x480 vertices, keeping the same vertex shader.  Ironically this is where we hit some nasty problems, as for some reason the video texture started being applied to the depth texture (albeit flickering a bit) - eventually we realised that the flickering was the vertex shader inexplicably flapping between using the depth and the video texture for the displacement map.  At this point we compared it between laptops, and it turns out that for some reason the integrated Intel graphics on Dave's Macbook Pro was choking on the two video textures, whereas a AMD Radeon R9 M370X got it right.  It's unclear if this was actually a GPU bug or an A-Frame or Three.js or WebGL or Chrome bug.  Eitherway, on switching laptop to one with discrete graphics it started working perfectly!  Finally, we tweaked the shader to try to reduce smearing, by discarding vertices where there are big discontinuities in depth (through looking at the partial derivatives of the depth texture).  This isn't perfect yet but it's better than nothing.  <a href="https://github.com/matrix-org/matrix-vr-demo/compare/bbd460e81ff1336cd63468e707d858d47261ea42...06abe34957732ba8c728b99f198d987fe48d0420">https://github.com/matrix-org/matrix-vr-demo/compare/bbd460e81ff1336cd63468e707d858d47261ea42...06abe34957732ba8c728b99f198d987fe48d0420</a></p>
<p>And here's the end result! (complete with trancey soundtrack as the audio we recorded at FOSDEM was unusable)</p>
<iframe src="https://www.youtube.com/embed/XvdZ2orVnrk" frameBorder="0" allowFullScreen="allowfullscreen"></iframe>
<p><strong>Conclusion:</strong></p>
<p>Hopefully this gives a bit of a taste of what proper 3D video calling could be like in VR, and how (relatively) easy it was at the Matrix level to add it in.  If anyone wants to follow along at home, the various hacky branches are:</p>
<ul>
 	<li>Playback:
<ul>
 	<li><a href="https://github.com/matrix-org/matrix-vr-demo/tree/dbkr/depthhack_plane">https://github.com/matrix-org/matrix-vr-demo/tree/dbkr/depthhack_plane</a></li>
 	<li><a href="https://github.com/matrix-org/webrtc/tree/matthew/depth">https://github.com/matrix-org/matrix-js-sdk/tree/matthew/depth</a></li>
</ul>
</li>
 	<li>Capture:
<ul>
 	<li><a href="https://github.com/matrix-org/webrtc/tree/matthew/depth">https://github.com/matrix-org/webrtc/tree/matthew/depth</a></li>
 	<li><a href="https://github.com/matrix-org/matrix-ios-sdk/tree/matthew/depth">https://github.com/matrix-org/matrix-ios-sdk/tree/matthew/depth</a></li>
</ul>
</li>
</ul>
If you'd like to get involved with hacking on Matrix in VR, please come hang out at <a href="https://matrix.to/#/#vr:matrix.org">#vr:matrix.org</a>.
<p>Also, New Vector (where most of the core team work) is also hiring for VoIP/VR specialists right now, so if you'd like to work on this sort of thing fulltime, please contact us at <a href="mailto:jobs@matrix.org">jobs@matrix.org</a> asap!</p>
<p>Matthew</p>
<p><strong>Update:</strong> Slides from the FOSDEM talk (adapted from this blog post by Amandine) are available at <a href="/~matthew/2018-02-04%20FOSDEM%20-%20VR.pdf">https://matrix.org/~matthew/2018-02-04%20FOSDEM%20-%20VR.pdf</a></p>
<p><strong>Update 2: </strong>The full FOSDEM talk recording is now up already at the RTC dev room at <a href="https://video.fosdem.org/2018/H.1309/">https://video.fosdem.org/2018/H.1309/</a>!</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2018&#x2F;01&#x2F;29&#x2F;status-partners-up-with-new-vector-fueling-decentralised-comms-and-the-matrix-ecosystem&#x2F;" title="Status partners up with New Vector, fueling decentralised comms and the Matrix ecosystem!">Status partners up with New Vector, fueling decentralised comms and the Matrix ecosystem!</a></h2>
                <span>
                    29.01.2018 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>We're delighted to announce that our friends at <a href="https://status.im">Status</a> have made a major strategic investment ($5M) in New Vector: the company which currently employs most of the Matrix.org core team.  This means that we now have the financial backing to let us focus entirely on improving the Matrix ecosystem and getting the protocol out of beta… and beyond!!</p>
<p><a href="https://status.im"><img class="size-medium wp-image-2941" style="position: relative; right: 25px;" src="/blog/wp-content/uploads/2018/01/LOGO_status_v5_1020x290-300x85.png" alt="" width="300" height="85" /></a><a href="https://matrix.org"><img class="size-medium wp-image-2944" style="position: relative; left: 25px; top: 7px;" src="/blog/wp-content/uploads/2018/01/matrix-logo-1-300x128.png" alt="" width="225" height="96" /></a></p>
<p>First up - massive, massive thanks to everyone who has supported us over the last 6 months since our <a href="/blog/2017/07/07/a-call-to-arms-supporting-matrix/">funding situation changed</a>: as of the end of 2017 we had enough Patreon / Liberapay / IBAN / BTC / ETH donations and sponsorship (for Matrix.org) and enough paid consulting work (for New Vector) that we've been able to keep almost the whole core team working on Matrix as their day job.  Simply: the core Matrix team could not have continued in its current form without the support of the community - so we will be forever indebted to everyone who has supported us: especially all our donating supporters on Patreon/Liberapay/etc, our customers at New Vector, and our big $ sponsors, including <a href="https://www.upcloud.com/">UpCloud.com</a> (who provide <em>incredible</em> hosting for Matrix.org), <a href="https://www.privateinternetaccess.com/">PrivateInternetAccess.com</a>, <a href="http://inblockchain.com/">INBlockchain.com</a>, <a href="http://omg.omise.co">OmiseGO</a> and <a href="https://tendermint.com">Tendermint</a>.</p>
<p>The investment from <a href="https://status.im">Status</a> that we're announcing today is a massive step change as it gives us the resources to grow the team and to focus fully on Matrix's key problem areas without distractions (whilst still supporting paid New Vector work). Please note that donations are still <b>very</b> appreciated however: we are in the process of setting up the Matrix.org Foundation (at last!) as the non-profit target for all future donations, such that Matrix itself has a financial means to support pure Matrix work independently of any other companies (including New Vector).</p>
<p>Many folks will be familiar with Status already as one of the leading projects in the <a href="https://ethereum.org/">Ethereum</a> ecosystem: building a beautiful usability-focused browser for decentralised apps (DApps) which run on the Ethereum Virtual Machine - as well as providing cryptocurrency payments and chat functionality (via the <a href="https://github.com/ethereum/wiki/wiki/Whisper">Whisper</a> protocol).  It effectively lets users access Ethereum as a usable meaningful operating system - a bit like how Riot attempts to be a flagship ‘browser' for the Matrix ecosystem.  The reason Status is investing in Matrix is primarily to accelerate decentralisation technology and open protocols in general - and also because there are some pretty obvious advantages to the collaboration, potentially including:</p>
<ul>
<li>Bridging between Matrix and Whisper (Ethereum's own real-time communication protocol) - exposing all of the Matrix ecosystem into Ethereum and vice versa</li>
<li>Bundling up Status DApps as Matrix Widgets</li>
<li>Exposing Matrix Widgets into Status</li>
<li>Supporting Olm/Megolm such that it could be used for E2E encryption in Status</li>
<li>Collaboration on the decentralised reputation systems needed to combat abuse in both Matrix &amp; Ethereum</li>
<li>Utilize the <a href="https://status.im/whitepaper.pdf">Status Network token</a> within Riot.im by enabling crypto assets.</li>
<li>...and more!</li>
</ul>
<p>We've spent a lot of time working with Status over the last few months whilst arranging this partnership, and we've been really impressed by Jarrad and Carl and the team (they even have their own golang <a href="https://github.com/status-im/doubleratchet">Double Ratchet Implementation</a>!).  It's fair to say that Status are very much aligned with Matrix's vision, and the projects and can help each other a lot.</p>
<p>It's also worth noting that Status and Matrix are really quite complementary: Whisper (as used by Status) is entirely p2p and focuses on protecting metadata and is tightly coupled to Ethereum, whereas Matrix is standalone and more feature rich but currently lacks metadata protection.  We both have fledgling app ecosystems; Matrix through Widgets and Status through Ethereum DApps. That said, Matrix and Status are going to continue on their own paths, and Matrix will of course remain controlled by Matrix.org - but we are looking forward to learning more about each other's tech and driving decentralisation forward in general!</p>
<p>Meanwhile, on the core Matrix side, the investment lets us focus immediately on the following priorities:</p>
<ul>
<li><b>Improving Riot's usability. As of today we are urgently hiring for a Lead Designer to join the team fulltime to revamp and address Riot's usability issues, as this is one of the single biggest things getting in the way of Matrix uptake today.  Hit up <a href="mailto:jobs@riot.im">jobs@riot.im</a> if you're interested!</b></li>
<li><b>At the same time, we're excited to ramp up our investment in Riot's performance and overall polish (as well as achieving feature parity with Slack/Discord and friends) - that means we're looking for React, Android &amp; iOS folks to join the core team full-time asap to take the apps to the next level.  Again, <a href="mailto:jobs@riot.im">jobs@riot.im</a> if this sounds like you!</b></li>
</ul>
<ul>
 	<li><b>Getting End-to-end Encryption out of beta.</b> We know what we need to do to push E2E out of beta (incremental key backup; cross-signing devices; improved device verification) - Status' investment means we can build the team to get it done! Decentralised end-to-end encryption is not for the faint-hearted, but if you're up for the challenge please get in touch at <a href="mailto:jobs@matrix.org">jobs@matrix.org</a>.
</li>
</ul>
<ul>
 	<li><b>Finishing Dendrite.</b> Dendrite (our next-gen golang homeserver implementation) is a hugely ambitious project and right now the only folks working on it are Rich and Erik… who also happen to be supporting Synapse too.  The good news is that the community has been helping considerably with Dendrite, but it would be even better if we had more people supported to work on it full time.  If you love Go, and you love massively scalable decentralised systems, please hit up <a href="mailto:jobs@matrix.org">jobs@matrix.org</a>!
</li>
</ul>
<ul>
 	<li><b>Supporting Synapse.</b>There is massive scope for performance improvements to Synapse, and there are thousands of deployments out there today, so we really want to improve support for Synapse.  If you love Python and Twisted, and interesting performance/profiling and efficiency work, please hit up <a href="mailto:jobs@matrix.org">jobs@matrix.org</a> too!
</li>
</ul>
<ul>
 	<li><b>Maintaining the Spec.</b> If Matrix is anything it is the spec, and maintenance of the spec is key to the project's success. In 2018 we intend to invest heavily in its maintenance and address outstanding API proposals, documenting APIs, not to mention updating the general technical documentation (guides, FAQ etc) on Matrix.org in general.  If you are a developer who loves spec work, we need you over at <a href="mailto:jobs@matrix.org">jobs@matrix.org</a> immediately! :)
</li>
</ul>
Beyond these immediate priorities, we have a long feature roadmap lined up too (highest priority first): Reactions, Message Editing, improved Widgets (e.g. Sticker Packs), Threading, Decentralised Accounts, Decentralised Identity, Decentralised Reputation, Peer-to-peer Matrix and more.  However, right now our focus has to be on improving the quality and stability of what we have today and getting it out of beta before we open yet more battlefronts.  In other words: we're not adding more features (modulo emergencies) until the current features are polished!
<p>So: exciting times ahead!  Never before has Matrix had the resources to fully realise its potential, and we'd like to say enormous thanks to Carl, Jarrad, Yessin and Nabil at Status for their patience and support while sorting out the investment.  We'd also like to say thanks to everyone else who offered us investment: in the end we had several viable offers on the table - and we owe sincere thanks to those who invested the time and faith to make an offer which we've ended up turning down.</p>
<p>For now, however, it's back to work: making Riot slicker than Slack; making Synapse go faster and use less RAM; making Dendrite federate; making E2E encryption transparent and indestructible; making sure that it's possible to implement Matrix purely by referring to the Spec.</p>
<p>2018 is going to be an interesting year indeed :)  Thank you all for supporting Matrix - and thanks, once again, to Status for helping to take us to the next level.</p>
<p>Matthew, Amandine &amp; the whole team.</p>
<p><b>Update 1: VentureBeat is covering the news over at <a href="https://venturebeat.com/2018/01/29/status-invests-5-million-in-matrix-to-create-a-blockchain-messaging-superpower/">https://venturebeat.com/2018/01/29/status-invests-5-million-in-matrix-to-create-a-blockchain-messaging-superpower/</a></b></p>
<p><b>Update 2: IBTimes is also covering it at <a href="http://www.ibtimes.co.uk/matrix-status-ico-gains-support-non-blockchain-decentralisation-technology-1656183">http://www.ibtimes.co.uk/matrix-status-ico-gains-support-non-blockchain-decentralisation-technology-1656183</a>!</b></p>
<p><b>...and you can see Status's side of the story over at <a href="https://blog.status.im/status-invests-5m-in-riot-im-4e3026a8bd50">https://blog.status.im/status-invests-5m-in-riot-im-4e3026a8bd50</a>!</b></p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2017&#x2F;12&#x2F;25&#x2F;the-matrix-holiday-mini-special-2017-edition&#x2F;" title="The Matrix Holiday Mini-Special (2017 edition)">The Matrix Holiday Mini-Special (2017 edition)</a></h2>
                <span>
                    25.12.2017 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi folks,</p>
<p>Since we began Matrix it's been a sort of tradition to do a huge update on Christmas Eve to reflect on the past year and tease the future - you can check out the <a href="/blog/2016/12/26/the-matrix-holiday-special-2016-edition/">2016 edition</a> or the <a href="/blog/2015/12/25/the-matrix-holiday-special/">2015 edition</a> and a sort of <a href="/blog/2015/01/07/synapse-0-6-1-released-and-other-news/">proto-update for 2014</a> too if you're feeling nostalgic.  This year I'm going to try to keep it short though, as I'm hoping to write a Very Big Update related to long-term-funding progress in the relatively near future.</p>
<p>2017 has been a weird year for us: progress in the core team has been relatively badly impacted by the mission to secure long-term funding, with myself (Matthew) &amp; Amandine spending the vast majority of our time handling the meta-problem of keeping the core team secure rather than actually working on the project itself.  Meanwhile we've lost a few of the original team during the disruption, which has particularly impacted Spec, E2E and Dendrite progress (such are the risks of running a very lean team in the first place!).  However, against the odds, we have (hopefully) prevailed - and this is almost <strong>entirely</strong> due to the massive support we've seen through donations via <a href="https://patreon.com/matrixdotorg">Patreon</a>, <a href="https://liberapay.com/matrixdotorg">Liberapay</a>, Ethereum, Bitcoin and <a href="https://paypal.me/matrixdotorg">PayPal</a>, and some much-appreciated paid consulting work.</p>
<p>Simply put, without the donation support we would have not been able to pay the core team over the last 3 months, and we would not be able to pay for the legal costs of setting up the team as an independent company, and we would be completely screwed for securing large-scale long-term funding if we couldn't point to the community's support as evidence that Matrix is worthy of funding.  So: we sincerely owe our thanks to those who heeded the <a href="/blog/2017/07/07/a-call-to-arms-supporting-matrix/">call to arms</a> and are supporting us.  We've also been pretty lucky in benefiting from the skyrocketing value of Ethereum and Bitcoin donations.  And even if/when long-term funding is secured for New Vector (the company we formed in July to hire the core team), donations will continue to be vital to support the Matrix.org Foundation itself as an independent non-profit entity - as it's obviously not in Matrix.org's interests to be entirely financially dependent on New Vector.  Hopefully this whole episode will end up being a bit like a <a href="http://www.startrek.com/article/john-trimbles-contribution-to-saving-star-trek">Save Star Trek</a> scenario - where something fun and amazing almost gets almost wiped out when it's only a few years old due to corporate factors... only for the community to band together to save it, and then for it to go from strength to strength for the next 50 years or more! :D</p>
<p>That said, we've made some major progress this year anyway: the addition of Widgets to Matrix; the addition of Communities (aka Groups) and Flair; major improvements to E2E encryption (even though it's not out of beta yet); lots of progress on Dendrite (the minimum-viable phase 1 is now about 75% complete); switching everything over to Jitsi for group video conferencing; rewriting onboarding for Riot/Web; Antiscam/spam support for cryptocommunities; the whole VR proof-of-concept of Matrix+WebVR+WebRTC video and voip calling; Version 0.3 of the Matrix spec; and a whole lot more which I'm probably forgetting right now.  And meanwhile the community has been more active than ever, with major new clients like <a href="https://github.com/mujx/nheko">Nheko</a> hitting the scene with a large and loyal community of open source contributors (over the last few weeks I've literally seen more nheko PRs fly past than Riot ones!) - and we've also been <em>incredibly</em> glad of community contributions towards Dendrite.  Dendrite is already way ahead of Synapse in terms of % community contributed code - we have hope that it will end up being a model FOSS project :)</p>
<p>So what lies ahead?  It's hard to predict the level of progress we're going to make in the core team, as it really depends on long-term funding.  Whatever happens, one of our top priorities is to improve our governance so that everyone can better contribute in places that have historically been more blocked on the core team (i.e. the spec; synapse)... whilst still maintaining coherency across the project.  Ideally we'll end up with more folks pushing Matrix forwards from both the wider world and the core team however, and right now the main priorities are:</p>
<ul>
 	<li>Phase 2 of Communities: letting users filter their current view of Matrix to rooms associated with a given subset of communities (if desired), for Slack/Discord-style semantics</li>
 	<li>Fixing the remaining end-to-end encryption failures (although the majority of them have now been solved)</li>
 	<li>Finalising proper UI/UX for end-to-end encryption (at last), including the option to transparently back up your room keys if desired.</li>
 	<li>Dendrite Phase 1</li>
 	<li>Performance in Riot (on all platforms)</li>
 	<li>Editable messages</li>
 	<li>Reactions</li>
 	<li>Making widgets much more useful</li>
 	<li>Paid integrations and hosting options to help avoid further funding nightmares.</li>
</ul>
Looking at the bigger picture, what we'd really love for 2018 would be to finally get to a 1.0 release of the Matrix Spec (i.e. catching up on our massive backlog of merging unstable spec drafts & proposals into the spec) - and for Dendrite to start to replace Synapse as the reference home server from Matrix.org and become really ubiquitous, and for E2E encryption be turned on by default in private rooms.  Beyond the above list, we don't really have any other features urgently planned (threading, for instance, is on hold until we have the rest of the above sorted) - but we believe that if we stabilise everything we have today (plus that list), then there is no reason for Matrix to not fulfil its full potential as a true global open decentralised communications standard.  And then it's on to threading, P2P matrix, decentralised reputation and all that good stuff!
<p>It's going to be a crazy year ahead, either way: so thank you, once again, for supporting Matrix - whether that's financially, or by contributing code, or running a server, or just using the protocol as a user.  We literally wouldn't be here without you!! :)</p>
<p>Matthew, Amandine &amp; the whole core team.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2017&#x2F;12&#x2F;08&#x2F;gotohack-ver-berlin-jan-2-9-a-week-long-session-on-internet-decentralization&#x2F;" title="Goto::Hack: Ver, Berlin, Jan 2-9: A week-long session on internet decentralization!">Goto::Hack: Ver, Berlin, Jan 2-9: A week-long session on internet decentralization!</a></h2>
                <span>
                    08.12.2017 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/amandine-le-pape">
                        Amandine Le Pape
                    </a>
                </span>
                
            </header>
            <div>
                
                <p style="text-align: left;"><em>We'd like to share a guest post from Dmitriy Volkov (who's been using Matrix almost since day 1!) - announcing the Goto::Hack event at the Tor Onionspace in Berlin in January.  The Onionspace will be on fire as folks attack the New Year by tackling the critical problem of internet decentralisation. A week long brainstorm and hack feels like the right way to go after the Christmas break! GNUnet, Tor, Matrix, pick your topic, or mix them all, and join the gang!  Hopefully we'll have someone there from the Matrix core team too (although it depends on funding and timings).</em></p>
<p style="text-align: left;"><em>-- Amandine</em></p>
We'd like to invite you to discuss and hack all things decentralized internet: from conceptual issues like identity and foundational tech like network stack to most practical questions, e.g. "What do I advise people at Cryptoparty in lieu of WhatsApp?" or "How do I make a GNUnet app?".
<p>Broadly, we'll do networks, distributed systems, infosec and telecom - with GNUnet / secushare and Matrix developers, find out more <a href="https://gateway.ipfs.io/ipns/QmSgwwdejjsizQnKffKo6e84vfvBWCH5tnGpAwLPJVvhby/">here</a>.</p>
<p><span style="text-decoration: underline;">Time</span>
: 02-09 Jan 2018
<span style="text-decoration: underline;">Space</span>
: Onionspace, Gottschedstraße 4, Aufgang 4, 13357 Berlin</p>
<p>It's well known Big Brother has been listening to our phone calls, reading texts and partnering with companies like Amazon or Google for a while now; more and more countries start censoring Internet - it's not just China. Most &quot;secure&quot; communications solutions like Threema or Telegram suffer conceptual issues, like being unsecure-by-default or controlled by single commercial entity.
Decentralized systems - the proposed technical part of the solution - bring forth their own challenges: how do we conveniently identify an entity (considering revocation and squatting), and why do blockchains as innovative as Bitcoin and Ethereum churn through gigawatts of energy while handling miserable tens of transactions per second? What can serve as practical, scalable infrastructure for a decentralized network alternative to current Internet: on physical and channel levels, in terms of routing, etc.? How do we forge convenient XMPP, free Signal, a WhatsApp that can be both used universally and trusted?</p>
<p>How do we make the Internet less centralized and what can be done to make existing distributed technologies more popular? Why is Tor not enough and how long are we going to continue communicating in plaintext? How do we cook identity, and can we better consensus?</p>
<p>During the event we will discuss, hack, code, debug and develop - both systems (GNUnet, Tor, Matrix, etc.) and applications based on them, fix UX and write docs. The goal is to make a measurable contribution to solving some of the described problems through the course of the week, meet in person with the people tackling the issues you care about and return home with the desire to continue hacking.</p>
<p>Please register at our <a href="https://gateway.ipfs.io/ipns/QmSgwwdejjsizQnKffKo6e84vfvBWCH5tnGpAwLPJVvhby/">website</a> if you'd like to come - also, if you're not local, we are doing a group booking at a hostel and will be having some Berlin hacker community tours! (Use <a href="https://gateway.ipfs.io/ipfs/QmSSmmDueDSGYparbzPuibQUnTmji3CTJX5MgvttBRbqUn/">this</a> if the first link didn't work for you - that's an IPNS issue and one thing in scope for the event.)</p>
<p>-- Dmitriy</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2017&#x2F;10&#x2F;12&#x2F;announcing-matrix-meetup-in-berlin-october-19th&#x2F;" title="Announcing Matrix meetup in Berlin - Thursday October 19th!!">Announcing Matrix meetup in Berlin - Thursday October 19th!!</a></h2>
                <span>
                    12.10.2017 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi folks,</p>
<p>On October 19th (next Thursday, as of the time of writing) we're going to be back in Berlin for various meetings - and we're incredibly excited that <a href="http://blueyard.com/">BlueYard</a> have offered to host the world's first ever official <a href="https://www.eventbrite.co.uk/e/matrix-and-friends-tickets-38729041606">Matrix and Decentralised Communications Meetup</a> at their offices in Kreuzberg!  Matthew, Amandine and maybe others will be attending and speaking from the core team, and giving a VIP tour of the long-long-long-awaited Groups/Communities features in Matrix and Riot as well as some of the other good stuff in the pipeline - and we're also excited to have Exul joining us from the community to talk about his recent <a href="https://github.com/exul/matrix-rocketchat">Matrix&lt;-&gt;Rocket.Chat</a> bridging adventures.  We're also expecting some exciting folks to join us from the Ethereum community to talk about decentralised realtime comms in their ecosystem - plus if anyone wants to talk about other Matrix/XMPP/Tox/Briar/Richochet or similar projects please ping us and let us know asap!</p>
<p><b>Update: we're excited to announce that <a href="https://twitter.com/jFransham">Jack Fransham</a> from <a href="https://polkadot.network/">Polkadot</a> (who are <a href="https://riot.im/app/#/room/#polkadot-watercooler:matrix.org">very active</a> Riot/Matrix users - and just raised &gt;$130M in their token generation event yesterday) will also be joining us to tell us all about how Polkadot bridges together different blockchains!</b>. (The original speaker was Marek Kotewicz, but availability didn't work out).</p>
<p><a href="https://polkadot.network/"><img src="/blog/wp-content/uploads/2017/10/Screen-Shot-2017-10-16-at-21.50.57-300x83.png" alt="" width="300" height="83" class="aligncenter size-medium wp-image-2885" /></a></p>
<p><b>Update 2: and our final speaker is confirmed as Maximilian Möhring, CEO of <a href="https://keyp.io/">Keyp</a>, who's going to talk about their self-sovereign decentralised identity system.</b></p>
<p><a href="https://keyp.io/"><img src="/blog/wp-content/uploads/2017/10/Screen-Shot-2017-10-16-at-21.53.40-300x98.png" alt="" width="300" height="98" class="aligncenter size-medium wp-image-2884" /></a></p>
<p><b>Update 3: ...and we have a last minute addition for a lightning talk from Secushare (Psyc + GNUnet, fully decentralised p2p encrypted comms)!!</b></p>
<p><a href="https://secushare.org"><img src="/blog/wp-content/uploads/2017/10/secushare-0444-300x200.png" alt="" width="200" height="200" class="aligncenter size-medium wp-image-2888" /></a></p>
<p><a href="https://www.eventbrite.co.uk/e/matrix-and-friends-tickets-38729041606"><img src="/blog/wp-content/uploads/2017/10/meetup.png" alt="" width="800" height="400" class="aligncenter size-full wp-image-2877" /></a></p>
<p>Space is limited to 70 attendees, so <a href="https://www.eventbrite.co.uk/e/matrix-and-friends-tickets-38729041606"><strong>please register on Eventbrite</strong></a> asap if you'd like to come!</p>
<p>As a taster: the official video of our massive talk from the ETHLDN meetup a few weeks ago was just released (see below).  The meetup in Berlin will have different content and be more free-form, letting folks ask their own questions and steer the conversation and discussion as you see fit: so please come hang out in person, grab pizza and beer courtesy of BlueYard, and find the answers to all the deepest Matrix questions you never knew you even had...!</p>
<p>See you next week! :D</p>
<iframe src="https://www.youtube.com/embed/y0-j4Q77KXM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2017&#x2F;10&#x2F;02&#x2F;synapse-0-23-is-out&#x2F;" title="Synapse 0.23 is out!">Synapse 0.23 is out!</a></h2>
                <span>
                    02.10.2017 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>We've just released <a href="https://github.com/matrix-org/synapse/releases/tag/v0.23.0">Synapse 0.23</a> - which contains a bunch of significant performance improvements, bug and stability fixes - as well as a few new features: basic spam checking (the ability to configure your homeserver to reject events which match arbitrary rules, both from users and other servers) - and long-awaited support for privacy-preserving ('event_id_only') push notifications.  This means that apps can choose to register themselves to receive push notifications which do <em>not</em> contain any information about the actual push, but instead act as a simple &quot;wake up!&quot; event, which triggers the app to then sync via the client-server API in order to display the actual push notification details.  This is particularly useful for push notifications for E2E encrypted rooms, as it means the client has a chance of decrypting the message in order to display the push notification details in the UI (if the user wants that).  matrix-ios-sdk and matrix-android-sdk are in the process of being moved over to use the new 'event_id_only' push format.</p>
<p>Long-awaited Communities/Groups will land in Synapse 0.24, which should come quite soon (we're almost ready to merge it to develop, but it's a major update so we wanted to get 0.23 out the door first).</p>
<p>As always, you can get your latest Synapse from <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a> or a OS repository of your choice (we've just released the official Debian packages).</p>
<h3 id="full-details-of-synapse-0-23">Full details of Synapse 0.23:</h3>
<p>Features:</p>
<ul>
 	<li>Add a frontend proxy worker (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2344" data-error-text="Failed to load issue title" data-id="241327229" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2344">#2344</a>)</li>
 	<li>Add support for event_id_only push format (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2450" data-error-text="Failed to load issue title" data-id="258504959" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2450">#2450</a>)</li>
 	<li>Add a PoC for filtering spammy events (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2456" data-error-text="Failed to load issue title" data-id="258768438" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2456">#2456</a>)</li>
 	<li>Add a config option to block all room invites (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2457" data-error-text="Failed to load issue title" data-id="258801420" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2457">#2457</a>)</li>
</ul>
Changes:
<ul>
 	<li>Use bcrypt module instead of py-bcrypt (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2288" data-error-text="Failed to load issue title" data-id="236667408" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2288">#2288</a>) Thanks to <a class="user-mention" href="https://github.com/kyrias">@kyrias</a>!</li>
 	<li>Improve performance of generating push notifications (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2343" data-error-text="Failed to load issue title" data-id="241258390" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2343">#2343</a>, <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2357" data-error-text="Failed to load issue title" data-id="241976794" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2357">#2357</a>, <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2365" data-error-text="Failed to load issue title" data-id="242655038" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2365">#2365</a>,
<a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2366" data-error-text="Failed to load issue title" data-id="242658178" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2366">#2366</a>, <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2371" data-error-text="Failed to load issue title" data-id="243026516" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2371">#2371</a>)</li>
 	<li>Improve DB performance for device list handling in sync (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2362" data-error-text="Failed to load issue title" data-id="242317186" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2362">#2362</a>)</li>
 	<li>Include a sample prometheus config (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2416" data-error-text="Failed to load issue title" data-id="250649035" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2416">#2416</a>)</li>
 	<li>Document known to work postgres version (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2433" data-error-text="Failed to load issue title" data-id="254647605" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2433">#2433</a>) Thanks to <a class="user-mention" href="https://github.com/ptman">@ptman</a>!</li>
</ul>
Bug fixes:
<ul>
 	<li>Fix caching error in the push evaluator (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2332" data-error-text="Failed to load issue title" data-id="240510018" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2332">#2332</a>)</li>
 	<li>Fix bug where pusherpool didn't start and broke some rooms (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2342" data-error-text="Failed to load issue title" data-id="241022132" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2342">#2342</a>)</li>
 	<li>Fix port script for user directory tables (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2375" data-error-text="Failed to load issue title" data-id="244304452" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2375">#2375</a>)</li>
 	<li>Fix device lists notifications when user rejoins a room (PR <a class="issue-link js-issue-link" title="Send down device list change notif when member leaves/rejoins room" href="https://github.com/matrix-org/synapse/pull/2443" data-error-text="Failed to load issue title" data-id="255950357" data-permission-text="Issue title is private">#2443</a>, <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2449" data-error-text="Failed to load issue title" data-id="258504140" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2449">#2449</a>)</li>
 	<li>Fix sync to always send down current state events in timeline (PR <a class="issue-link js-issue-link" title="Don't filter out current state events from timeline" href="https://github.com/matrix-org/synapse/pull/2451" data-error-text="Failed to load issue title" data-id="258537401" data-permission-text="Issue title is private">#2451</a>)</li>
 	<li>Fix bug where guest users were incorrectly kicked (PR <a class="issue-link js-issue-link" title="Fix overzealous kicking of guest users" href="https://github.com/matrix-org/synapse/pull/2453" data-error-text="Failed to load issue title" data-id="258560872" data-permission-text="Issue title is private">#2453</a>)</li>
 	<li>Fix bug talking to IPv6 only servers using SRV records (PR <a class="issue-link js-issue-link" href="https://github.com/matrix-org/synapse/pull/2462" data-error-text="Failed to load issue title" data-id="259840408" data-permission-text="Issue title is private" data-url="https://github.com/matrix-org/synapse/issues/2462">#2462</a>)</li>
 	<li>Fix regression in performance of syncs (PR <a class="issue-link js-issue-link" title="Refactor to speed up incremental syncs" href="https://github.com/matrix-org/synapse/pull/2470" data-error-text="Failed to load issue title" data-id="260340514" data-permission-text="Issue title is private">#2470</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2017&#x2F;09&#x2F;29&#x2F;matrix-live&#x2F;" title="Matrix &quot;Live&quot;!">Matrix &quot;Live&quot;!</a></h2>
                <span>
                    29.09.2017 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Occasionally folks ask why we don't update the blog more often - we're infamous in only doing big formal updates once every 3 months, unless there's something very specific to yell about.  However, it's possible that some readers don't realise that we have been publishing a weekly status update blog since July - albeit a video blog: <a href="https://www.youtube.com/playlist?list=PLl5dnxRMP1hXZJtaE1Q3_ztrfIMJgrgZM">Matrix Live</a>!  The episodes are published on YouTube (for now, although in future we're going to use Matrix to distribute them), and are first made available to Quadratic ($5+) Patreon supporters.  After a week we make them public to everyone though and add them to the YouTube Playlist.  The videos also have very brief bullet-point summaries of the contents in the description for those who don't have time to watch and just want to skim for interesting stuff.</p>
<p>We appreciate that video blogs are unusual for a FOSS project relative to written blogs - but we've chosen to go down this path because counterintuitively it takes much less time to just speak about what's going on than write it down; for whatever reason my blogposts always seem to take hours to write as I get sucked into the details and try to be as comprehensive and accurate as possible.  Whereas just chatting about it with Amandine is much easier, and given that we do it anyway; why not film it for everyone's benefit?  We always film the show in one continuous take (hence the &quot;live&quot;), so it's literally only eating 10-15 mins out of our week.</p>
<p>Eitherway, just wanted to remind anyone who reads this blog that the video blog exists, and to gently encourage folks to donate at <a href="https://patreon.com/matrixdotorg">Patreon</a> or <a href="https://liberapay.com/matrixdotorg">Liberapay</a> if they want to get access to the videos on the day they air, rather than having to wait for a week!  Finally, we'd suggest that folks subscribe to the <a href="https://www.youtube.com/playlist?list=PLl5dnxRMP1hXZJtaE1Q3_ztrfIMJgrgZM">playlist</a> itself on YouTube even if they don't donate, so they can be reminded about new eps.</p>
<p>So, without further ado, here's an alarming montage of Matthew &amp; Amandine geeking about Matrix, in case you've missed the show so far!</p>
<div style="text-align: center;"><a href="https://www.youtube.com/watch?v=a0n1xz4KRVE"><img class="alignnone wp-image-2844 size-full" src="/blog/wp-content/uploads/2017/09/ep1.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=0g2jEm84w8w"><img class="alignnone wp-image-2845 size-full" src="/blog/wp-content/uploads/2017/09/ep2.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=T9ENe3fzH6w"><img class="alignnone wp-image-2846 size-full" src="/blog/wp-content/uploads/2017/09/ep3.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=kG3Pa7BoUBY"><img class="alignnone wp-image-2847 size-full" src="/blog/wp-content/uploads/2017/09/ep4.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=bMt4rD86_wc"><img class="alignnone wp-image-2848 size-full" src="/blog/wp-content/uploads/2017/09/ep5.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=M4jjl4jxst4"><img class="alignnone wp-image-2849 size-full" src="/blog/wp-content/uploads/2017/09/ep6.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=S5u9haaQwzg"><img class="alignnone wp-image-2850" src="/blog/wp-content/uploads/2017/09/ep7.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=hX1bZWHwXWo"><img class="alignnone wp-image-2851 size-full" src="/blog/wp-content/uploads/2017/09/ep8.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=uFpcgj2HFoU"><img class="alignnone wp-image-2852" src="/blog/wp-content/uploads/2017/09/ep9.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=OuxP21lE-gg"><img class="alignnone wp-image-2853" src="/blog/wp-content/uploads/2017/09/ep10.jpg" width="336" height="188" /></a><a href="https://www.youtube.com/watch?v=9Iw2IaR_jpQ"><img class="alignnone wp-image-2854" src="/blog/wp-content/uploads/2017/09/ep11.jpg" width="336" height="188" /></a><a href="https://www.patreon.com/posts/matrix-live-ep-14609414"><img class="size-full wp-image-2857" src="/blog/wp-content/uploads/2017/09/ep12.png" alt="" width="336" height="188" /></a></div>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2017&#x2F;09&#x2F;28&#x2F;experiments-with-matrix-on-the-purism-librem5-starring-ubports-and-nheko&#x2F;" title="Experiments with Matrix for the Purism Librem5, starring Ubports and Nheko">Experiments with Matrix for the Purism Librem5, starring Ubports and Nheko</a></h2>
                <span>
                    28.09.2017 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p><strong><em>TL;DR: If you love FOSS-friendly hardware and if you love Matrix, please <a href="https://puri.sm/shop/librem-5/">preorder a Purism Librem5 Matrix-native smartphone</a>, so we can fully bring native Matrix communication to both phones and desktop!</em></strong></p>
<p>It's been just over a month since Purism announced the campaign to fund the <a href="/blog/2017/08/24/the-librem-5-from-purism-a-matrix-native-smartphone/">Matrix-native Librem5 FOSS smartphone</a> - and the campaign is doing pretty well, with 54% of its target reached as of the time of writing!  So in a shameless attempt to whet everyone's appetite and <a href="https://puri.sm/shop/librem-5/">encourage everyone to fund the remaining 50%</a>, we thought we'd share some of the experiments we've been doing with running native Matrix clients on a pure Linux phone.</p>
<p>Unfortunately the Librem5 doesn't exist yet, but we do happen to have an <a href="https://store.bq.com/en/ubuntu-edition-e5/">BQ Aquaris E5 Ubuntu Phone</a> hanging around - so we wondered: Is it possible to run a native desktop Matrix client like mujx's <a href="https://github.com/mujx/nheko">Nheko</a> on a Linux phone, given all the latest Qt voodoo? And just how hard is it anyway to update the Qt platform abstractions (or GTK for that matter) for a given platform?  In retrospect, we probably should have just run <a href="https://github.com/LarreaMikel/uMatriks">uMatriks</a> on it - a proper dedicated Ubuntu Touch Matrix Client, but then we wouldn't have had a useful tour of maintaining the guts of a Qt distribution on mobile :)</p>
<p>So the core problem of running a client like Nheko on Ubuntu Touch is that it uses lots of fun glossy stuff from Qt 5.9, whereas Ubuntu Touch is still on Qt 5.4, which is over 2 years old now.  Also, it's been written as a desktop client so needs a bit of tuning to support a 'fat-finger' mobile form factor, although this is just a simple matter of programming and is a very similar problem to ensuring the desktop app has a nice responsive design on small screen window sizes (similar to how the telegram desktop client handles it).  In the end, we focused on solving the Qt problem: building a custom Qt 5.9 for <a href="https://ubports.com">Ubports</a> (the community project who do a fantastic job of continuing Ubuntu Touch development since Canonical pulled out), while for simplicity building it on top of the current ubports distribution (which is effectively still Ubuntu 15.04).  The reason for all this Ubuntu stuff rather than using PureOS is simply that it's not far enough along, and we don't physically have a Librem5 dev kit yet to play with!</p>
<p>In practice, this has been a fascinating process: setting up a crosscompiler to build all of Qt5.9, and then porting the ubuntumirclient Qt Platform Abstraction to work with Qt5.9, as well as (finally) working out how to build a Qt5.9-compatible custom Maliit input context platform plugin to get the onscreen keyboard (OSK) up and running.  But we got there in the end, and it was rather fun to finally see the Nheko splash screen popping up on the Aquaris E5! :D</p>
<img class="aligncenter size-large wp-image-2833" src="/blog/wp-content/uploads/2017/09/nheko1-768x1024.jpeg" alt="" width="432" height="768" />
<p>There was then a bit of a nightmare to get the OSK to work, thanks to<a href="https://bugreports.qt.io/browse/QTBUG-46009"> https://bugreports.qt.io/browse/QTBUG-46009</a> causing the plugin to be silently not updated - but could then log in and the app worked great (albeit a bit slow thanks to being a debug build on the energy-efficient but slow Mediatek MT6582 SoC):</p>
<div style="text-align: center;"><img class="size-large wp-image-2834" src="/blog/wp-content/uploads/2017/09/screenshot20170928_131924004-576x1024.png" alt="" width="288" height="512" /> <img class="size-large wp-image-2835" src="/blog/wp-content/uploads/2017/09/screenshot20170928_132210382-576x1024.png" alt="" width="288" height="512" /> <img class="size-large wp-image-2836" src="/blog/wp-content/uploads/2017/09/screenshot20170928_131057113-576x1024.png" alt="" width="288" height="512" /> <img class="size-large wp-image-2837" src="/blog/wp-content/uploads/2017/09/screenshot20170928_132238278-576x1024.png" alt="" width="288" height="512" /></div>
Now the next step here would obviously be to tweak the app properly to layout on a phone (bigger fonts; bigger buttons; resize the window to make room for the OSK; separate the Left Panel from the timeline view; etc) - but the point here was more to show a fully fledged native Matrix client running on a current Linux Phone environment and see how it feels.  And we're happy to say that it leaves us dying to get our hands on a proper Librem5 so we can work with Nheko, uMatriks, libqmatrixclient and all the other native Matrix client projects to see how we can get the best possible native client experience running in PureOS for the phone!!
<p>Finally, there doesn't seem to be much documentation out there on how to do a heavy customisation of Ubports like this, so for the sake of posterity, here's the guide if anyone else is crazy enough to try this (or for when Ubports gets around to doing an official update to Qt 5.9 for their OS!).  A versioned copy of this lives over at <a href="https://gist.github.com/ara4n/4a4076b8fd5a61153bde6c9a0a726c72">this gist</a>.</p>
<p>Thanks for reading, and don't forget to preorder!</p>
<p>Matthew</p>
<h3 id="recipe-librem5-experiments-with-an-ubuntu-phone-and-nheko">Recipe: Librem5 experiments with an Ubuntu Phone and Nheko</h3>
<p>Starting point: one old BQ Aquaris E5 ubuntu phone, running some old version of Ubuntu Touch which had got completely stuck (UI only unfreezing for 2-3 seconds every 2-3 minutes).</p>
<p>Step one: flash to latest UBPorts image:</p>
<ul>
 	<li>Set up Ubuntu desktop as a host (as per <a href="https://docs.ubuntu.com/phone/en/devices/installing-ubuntu-for-devices">https://docs.ubuntu.com/phone/en/devices/installing-ubuntu-for-devices</a>)</li>
</ul>
<pre><code>sudo add-apt-repository ppa:ubuntu-sdk-team/ppa
sudo apt-get update
sudo apt-get install ubuntu-device-flash
sudo apt-get install phablet-tools
</code></pre>
<ul>
 	<li>Grab an adb-compatible recovery image (yes, seems like the right place is someone's personal webspace...)</li>
</ul>
<pre><code>wget http://people.canonical.com/~jhm/barajas/recovery-vegetahd.img
</code></pre>
<ul>
 	<li>If your Ubuntu desktop is running in a VM, make sure you have USB 2.0 or 3.0 support enabled (in Virtualbox this needs the extension pack installed). USB 1 is too slow and the flash will timeout, semi-bricking the phone.</li>
 	<li>Press volume-up and power on the phone during boot to get at the bootloader. Make sure it's not plugged into USB</li>
 	<li>Select fastboot</li>
 	<li>Plug into USB</li>
 	<li>Flash the recovery image and latest UBPorts OS:</li>
</ul>
<pre><code>sudo ubuntu-device-flash --server=http://system-image.ubports.com touch --device=vegetahd \\
                         --channel=15.04/stable --bootstrap --recovery-image=recovery-vegetahd.img \\
                         --developer-mode --password=secret
</code></pre>
<ul>
 	<li>Ensure the system OS is writable. (Ubuntu Touch runs the OS partition read-only by default to protect users. In this case, you can always re-flash it if all goes wrong.)</li>
</ul>
<pre><code>sudo phablet-config writable-image
</code></pre>
<ul>
 	<li>Get an SSH server running on the phone before you go insane</li>
</ul>
<pre><code>adb shell
sudo /etc/init.d/ssh start # password is as set when flashing.
</code></pre>
Step two: cross-compile latest Qt 5.9 for the phone.
<p>Ubuntu 15.04 shipped with 5.4, which is pretty old now, and too old for nheko. Based on <a href="https://rm5248.com/cross-compile-qt-for-arm/">https://rm5248.com/cross-compile-qt-for-arm/</a></p>
<pre><code># grab the source for Qt5
git clone git://code.qt.io/qt/qt5.git
cd qt5
./init-repository

# grab the right dev headers (as qtubuntu needs dbus & atspi support)
ssh phablet@phone "sudo apt-get install libdbus-1-dev libatspi2.0-dev libssl-dev"

# grab a copy of the root filesystem on the phone for the cross-compile to run against.
# you could also sshfs mount or something if you could be bothered.
mkdir ~/phone
rsync -avz --exclude /proc --exclude /run --exclude /sys --exclude /dev \\
           --exclude /android --exclude /var/lib/lxc phablet@phone:/ ~/phone/system
export ROOTFS=~/phone

# install the crosscompiler.
# We probably have to use GCC 4.9 so that it can link ok against the older system libraries
# (libstdc++ etc) on Ubuntu Touch 15.04
sudo apt-get install arm-linux-gnueabihf-g++-4.9

# fix up the absolute symlinks (important!)
cd ~
git clone https://github.com/rm5248/cross-compile-tools.git
./cross-compile-tools/fixQualifiedLibraryPaths $ROOTFS /usr/bin/arm-linux-gnueabihf-g++-4.9

# define a mkspec target for armhf
cd ~/qt5
cp -a qtbase/mkspecs/linux-arm-gnueabi-g++ qtbase/mkspecs/linux-arm-gnueabihf-g++
cat &gt; qtbase/mkspecs/linux-arm-gnueabihf-g++/qmake.conf &lt;&lt;EOT
#
# qmake configuration for building with arm-linux-gnueabihf-g++
#

MAKEFILE_GENERATOR      = UNIX
CONFIG                 += incremental
QMAKE_INCREMENTAL_STYLE = sublib

include(../common/linux.conf)
include(../common/gcc-base-unix.conf)
include(../common/g++-unix.conf)

# modifications to g++.conf
QMAKE_CC                = arm-linux-gnueabihf-gcc-4.9
QMAKE_CXX               = arm-linux-gnueabihf-g++-4.9
QMAKE_LINK              = arm-linux-gnueabihf-g++-4.9
QMAKE_LINK_SHLIB        = arm-linux-gnueabihf-g++-4.9

# modifications to linux.conf
QMAKE_AR                = arm-linux-gnueabihf-ar cqs
QMAKE_OBJCOPY           = arm-linux-gnueabihf-objcopy
QMAKE_NM                = arm-linux-gnueabihf-nm -P
QMAKE_STRIP             = arm-linux-gnueabihf-strip

!host_build {'{'}
        QMAKE_INCDIR_OPENGL     = $ROOTFS/usr/include/GL
        QMAKE_LIBDIR_OPENGL     = $ROOTFS/usr/lib/arm-linux-gnueabihf
        # GCC 4.9 apparently doesn't know where its own libstdc++ headers are when cross-compiling...
        QMAKE_INCDIR            = /usr/arm-linux-gnueabihf/include/c++/4.9.3 \\
                                  /usr/arm-linux-gnueabihf/include/c++/4.9.3/arm-linux-gnueabihf
{'}'}

load(qt_config)
EOT

# build it!
./configure \\
    -v \\
    -confirm-license \\
    -prefix /opt/qt5-arm \\
    -sysroot $ROOTFS \\
    -opensource \\
    -nomake examples \\
    -nomake tests \\
    -opengl es2 \\
    -qpa ubuntumirclient \\
    -xplatform linux-arm-gnueabihf-g++ \\
    -platform linux-g++ \\
    -feature-accessibility \\
    -feature-accessibility-atspi-bridge \\
    -feature-webrtc \\
    -feature-proprietary-codecs \\
    -reduce-exports

make -j8

# go to lunch

make install
</code></pre>
<p>If anything goes wrong, a good bet (having backed up your new mkspec target) is to git clean everything:</p>
<pre><code>git submodule foreach --recursive "git clean -dfx"
git clean -dfx
</code></pre>
<p>Step 3: compile qtubuntu for Ubuntu-specific Qt stuff like the integration with the Mir display server (hey, at this point it feels like we're building our very own zombie Ubuntu Touch 17.04... :/)</p>
<pre><code># grab dev package deps
ssh phablet@phone "sudo apt-get install libubuntu-application-api-dev libudev-dev"
rsync -avz --exclude /proc --exclude /run --exclude /sys --exclude /dev \\
           --exclude /android --exclude /var/lib/lxc phablet@phone:/ ~/phone/system
~/cross-compile-tools/fixQualifiedLibraryPaths $ROOTFS /usr/bin/arm-linux-gnueabihf-g++-4.9

# grab the qtubuntu source
bzr branch lp:qtubuntu

# find an version old enough that it builds against the old mir in 15.04
bzr revert -r 345

# cherrypick patches so it builds against qt 5.9...
http://bazaar.launchpad.net/~phablet-team/qtubuntu/trunk/revision/354
http://bazaar.launchpad.net/~phablet-team/qtubuntu/trunk/revision/372
http://bazaar.launchpad.net/~phablet-team/qtubuntu/trunk/revision/394
# ...we probably need others too.

/mnt/build/qt5/qtbase/bin/qmake -spec /mnt/build/qt5/qtbase/mkspecs/linux-arm-gnueabihf-g++

# we probably should have told Qt about more pkgconfig libraries when we built it, so as to not have to do it manually here...
export PKG_CONFIG_LIBDIR=$ROOTFS/usr/lib/pkgconfig:$ROOTFS/usr/share/pkgconfig:\\
$ROOTFS/usr/lib/arm-linux-gnueabihf/pkgconfig/:$ROOTFS/opt/qt5-arm/lib/pkgconfig/
export PKG_CONFIG_SYSROOT_DIR=$ROOTFS

# might need to manually explicitify the --sysroot definitions in qt's qconfig.pri
# as otherwise QT_SYSROOT seems not to be getting picked up for reasons unknown

make -j4
cp src/ubuntumirclient/libqpa-ubuntumirclient.so $ROOTFS/opt/qt5-arm/plugins/platforms/

# Need to build our own libmaliitphabletplatforminputcontextplugin.so for onscreen keyboard, as
# you can't mix Qt platform plugins between versions - see https://bugreports.qt.io/browse/QTBUG-46009
cd
bzr branch lp:ubuntu/vivid/maliit-framework
cd maliit-framework
# add QMAKE_LFLAGS+='-lQt5Network -lGLESv2' to config.pri

# technically don't need to build all of maliit - only the platform inputcontext plugin is required
export QMAKEMODULES=/mnt/build/qt5/qtdeclarative/mkspecs/modules 
/mnt/build/qt5/qtbase/bin/qmake -spec /mnt/build/qt5/qtbase/mkspecs/linux-arm-gnueabihf-g++
make -j4

# build the input-context plugin
cd input-context
# change the version of the plugin in main.cpp so that it's picked up by Qt 5.9 (the API hasn't changed;
# it's just the difference between an explicit and implicit version):
# Q_PLUGIN_METADATA(IID "org.qt-project.Qt.QPlatformInputContextFactoryInterface.5.1" FILE "maliit.json")
/mnt/build/qt5/qtbase/bin/qmake -spec /mnt/build/qt5/qtbase/mkspecs/linux-arm-gnueabihf-g++

make -j4
make install

# rsync our beautiful new Qt5.9 over to the phone, including the qtubuntu plugin
rsync -avz $ROOTFS/opt/qt5-arm root@phone:/opt/
</code></pre>
<p>Step 4: cross-compile nheko as an experiment</p>
<pre><code># check it out
git clone --recursive git+ssh://git@github.com/mujx/nheko
cd nheko

# define a cross-compile toolchain (https://cmake.org/Wiki/CMake_Cross_Compiling)
cat &gt; Toolchain-arm-linux-gnueabihf.cmake &lt;&lt;EOT
# this one is important
SET(CMAKE_SYSTEM_NAME Linux)
# this one not so much
SET(CMAKE_SYSTEM_VERSION 1)
# needed to get the right flavour of ARM
SET(CMAKE_SYSTEM_PROCESSOR armv7)

# specify the cross compiler
SET(CMAKE_C_COMPILER   /usr/bin/arm-linux-gnueabihf-gcc-4.9)
SET(CMAKE_CXX_COMPILER /usr/bin/arm-linux-gnueabihf-g++-4.9)

# where is the target environment
SET(CMAKE_SYSROOT  $ROOTFS)
SET(CMAKE_FIND_ROOT_PATH  $ROOTFS)

# sort out our includes...
SET(CMAKE_CXX_FLAGS "${'{'}CMAKE_CXX_FLAGS{'}'} \\
    -I$ROOTFS/usr/include/c++/4.9 \\
    -I$ROOTFS/usr/include/arm-linux-gnueabihf \\
    -I$ROOTFS/usr/include/arm-linux-gnueabihf/c++/4.9")

SET(CMAKE_EXE_LINKER_FLAGS "${'{'}CMAKE_EXE_LINKER_FLAGS{'}'} \\
  $ROOTFS/lib/arm-linux-gnueabihf/libc.so.6 \\
  $ROOTFS/usr/lib/arm-linux-gnueabihf/libm.so \\
  $ROOTFS/usr/lib/arm-linux-gnueabihf/libhybris-egl/libGLESv2.so.2")

# search for programs in the build host directories
SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
# for libraries and headers in the target directories
SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)

SET(CMAKE_PREFIX_PATH $ROOTFS/opt/qt5-arm)
EOT

# grab its dependencies on the phone and sync them over to your local phone FS copy
ssh phablet@phone 'sudo apt-get install liblmdb-dev'
rsync -avz --exclude /proc --exclude /run --exclude /sys --exclude /dev \\
           --exclude /android --exclude /var/lib/lxc phablet@phone:/ ~/phone/system
~/cross-compile-tools/fixQualifiedLibraryPaths $ROOTFS /usr/bin/arm-linux-gnueabihf-g++-4.9

# gen the makefile
sudo apt-get install cmake
cmake -DLMDB_LIBRARY=$ROOTFS/usr/lib/arm-linux-gnueabihf/liblmdb.so \\
      -DCMAKE_TOOLCHAIN_FILE=`pwd`/Toolchain-arm-linux-gnueabihf.cmake \\
      -H. -Bbuild -DCMAKE_BUILD_TYPE=Release
# remove -march=native from CMakeLists.txt

# build it
VERBOSE=1 make -C build -j4

# XXX: you might need to touch the Toolchain file and then run again to pick up
# the CXX_FLAGS correctly for some reason.

# run it!
rsync -avz $ROOTFS/home/phablet/nheko phablet@phone:/home/phablet
ssh phablet@phone "export MIR_SOCKET=/run/user/32011/mir_socket;
                   ./build/nheko --desktop_file_hint=unity8"

# N.B. if debugging under gdb, use `handle SIGILL nostop`
</code></pre>
<p>Step 5: Package nheko</p>
<pre><code># make sure you have a manifest.json, nheko.png, nheko.apparmor and nheko.desktop.
# If you don't have an icon, the app won't show up.
# you can grab it from the matthew/mobile branch of github.com/matrix-org/nheko
click build ./
scp im.vector.nheko_0.1_all.click phablet@phone:

# install it
ssh phablet@phone pkcon install-local --allow-untrusted im.vector.nheko_0.1_all.click

# ...and then swipe down on the app listing to hopefully see the app there.
# if that doesn't work, you can manually launch it with:
ssh phablet@phone ubuntu-app-launch im.vector.nheko_nheko_0.1</code></pre>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2017&#x2F;08&#x2F;30&#x2F;pr&#x2F;" title="PR">PR</a></h2>
                <span>
                    30.08.2017 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/tom-lant">
                        Tom Lant
                    </a>
                </span>
                
            </header>
            <div>
                
                <h2 id="press-media-contact">Press/Media Contact</h2>
<p>You can reach us by email at <a href="mailto:pr@matrix.org">pr@matrix.org</a>, or reach <a href="https://riot.im/develop/#/user/@matthew:matrix.org?action=chat">Matthew</a> or <a href="https://riot.im/develop/#/user/@amandine:matrix.org?action=chat">Amandine</a> on Matrix via Riot.im (or your favourite Matrix client).</p>
<h2 id="who-is-matrix-org">Who is Matrix.org?</h2>
<p>Matrix.org is the world leader in decentralised encrypted communication, with project lead Matthew Hodgson a regular speaker at conferences such as FOSDEM and decentralisation/privacy summits. In Sept 2016 Matrix released the world's first ever publicly audited end-to-end encryption “Olm”, based on the Double Ratchet Algorithm.</p>
<p>Matrix core team is based in London (UK) and Rennes (France).</p>
<h2 id="branding-identity">Branding Identity</h2>
<p><a href="https://github.com/vector-im/logos/raw/master/matrix/matrix-logo.png"><img class="alignnone size-medium" src="https://github.com/vector-im/logos/raw/master/matrix/matrix-logo.png" width="300" /></a><em>Matrix logo, black on transparent background, PNG format (also available in <a href="https://github.com/vector-im/logos/raw/master/matrix/matrix-logo.svg">SVG</a>)</em></p>
<span style="padding-left: 3px; padding-right: 3px; background: black; display: inline-block;">
<a href="https://github.com/vector-im/logos/raw/master/matrix/matrix-logo-white.png"><img class="alignnone size-medium" src="https://github.com/vector-im/logos/raw/master/matrix/matrix-logo-white.png" width="300" /></a></span>
<p><em>Matrix logo, white on transparent background, PNG format</em></p>

                
            </div>
        </article>
        
        <nav class="pagination">
    <div class="prev">
        
        <a href="https:&#x2F;&#x2F;matrix.org&#x2F;category&#x2F;general&#x2F;page&#x2F;6&#x2F;">‹ Previous</a>
        
    </div>
    <span class="page-number">7 / 14</span>
    <div class="prev">
        
        <a href="https:&#x2F;&#x2F;matrix.org&#x2F;category&#x2F;general&#x2F;page&#x2F;8&#x2F;">Next ›</a>
        
    </div>
</nav>

    </div>
</div>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p><a href="/legal/copyright-notice">Copyright Notice</a></p>
</footer>

</body>

</html>
