<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Security</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <link rel="stylesheet" href="/style.css" />

    
<link rel="alternate" type="application/rss+xml" title="RSS" href="/category/security/atom.xml">
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;docs&#x2F;" class="section ">
                Documentation
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                </div>
            </div>
        </div>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;ecosystem&#x2F;" class="section ">
                Ecosystem
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<div id="taxonomy-single">
    <div class="content">
        <header>
            <h1>Security</h1>
            30 posts tagged with "Security" <a href="/category">(See all Category)</a>
            
            <h2>
                <small><a href="/category/security/atom.xml">Atom Feed</a></small>
            </h2>
            
        </header>

        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2022&#x2F;09&#x2F;28&#x2F;upgrade-now-to-address-encryption-vulns-in-matrix-sdks-and-clients&#x2F;" title="Upgrade now to address E2EE vulnerabilities in matrix-js-sdk, matrix-ios-sdk and matrix-android-sdk2">Upgrade now to address E2EE vulnerabilities in matrix-js-sdk, matrix-ios-sdk and matrix-android-sdk2</a></h2>
                <span>
                    28.09.2022 15:41
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p><strong>TL;DR:</strong></p>
<ul>
<li>Two critical severity vulnerabilities in end-to-end encryption were found in
the SDKs which power Element, Beeper, Cinny, SchildiChat, Circuli, Synod.im
and any other clients based on matrix-js-sdk, matrix-ios-sdk or
matrix-android-sdk2.</li>
<li>These have now been fixed, and we have not seen evidence of them being
exploited in the wild. All of the critical vulnerabilities require
cooperation from a malicious homeserver to be exploited.</li>
<li><strong>Please upgrade immediately in order to be protected against these
vulnerabilities.</strong></li>
<li>Clients with other encryption implementations (including Hydrogen, ElementX,
Nheko, FluffyChat, Syphon, Timmy, Gomuks and Pantalaimon) are not affected;
<strong>this is not a protocol bug</strong>.</li>
<li>We take the security of our end-to-end encryption extremely seriously, and we
have an ongoing series of public independent audits booked to help guard
against future vulnerabilities.  We will also be making some protocol changes
in the future to provide additional layers of protection.</li>
<li>This resolves the <a href="https://matrix.org/blog/2022/09/23/pre-disclosure-upcoming-critical-security-release-of-matrix-sd-ks-and-clients">pre-disclosure</a> issued on September 23rd.</li>
</ul>

                <p><a href="/blog/2022/09/28/upgrade-now-to-address-encryption-vulns-in-matrix-sdks-and-clients/#continue-reading">Continue reading…</a></p>
                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2022&#x2F;09&#x2F;23&#x2F;pre-disclosure-upcoming-critical-security-release-of-matrix-sd-ks-and-clients&#x2F;" title="Pre-disclosure: upcoming critical security release of Matrix SDKs and clients">Pre-disclosure: upcoming critical security release of Matrix SDKs and clients</a></h2>
                <span>
                    23.09.2022 12:53
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/matrix-security">
                        Matrix Security
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>We will be releasing a security update to matrix-js-sdk, matrix-ios-sdk and matrix-android-sdk2 and clients which implement end-to-end encryption with these libraries, to patch <strong>critical</strong> security issues, on <strong>Wed, Sept 28th</strong>. The releases will be published in the afternoon, followed by the disclosure blog post around 16:00 UTC. The affected clients include Element Web, Desktop, iOS and Android.  We will also be working with downstream packagers and forks over the coming days to ensure a synchronised release to address affected clients.</p>
<p>Clients using matrix-rust-sdk, hydrogen-sdk and matrix-nio are not affected by these critical issues.  We are also auditing third-party client SDKs and clients in advance of the release, and will work with the projects if action is needed. So far we've confirmed that other popular SDK/clients including mtxclient (nheko), Matrix Dart SDK (FluffyChat), Trixnity (Timmy), Syphon, mautrix-go (Gomuks) and mautrix-python are not affected by the issues in question.</p>
<p>If you maintain or package a (potentially) affected E2EE-capable Matrix client and need to coordinate on the release, please contact <a href="mailto:security@matrix.org">security@matrix.org</a>.</p>
<p><strong>We advise to upgrade as soon as possible after the patched versions are released.</strong></p>
<p>Thank you for your patience while we work to resolve this issue.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2022&#x2F;09&#x2F;13&#x2F;security-release-of-matrix-appservice-irc-0-35-0-high-severity&#x2F;" title="Security release of matrix-appservice-irc 0.35.0 (High severity)">Security release of matrix-appservice-irc 0.35.0 (High severity)</a></h2>
                <span>
                    13.09.2022 14:56
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/denis-kasak">
                        Denis Kasak
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>We've released a new version of matrix.org's node-irc 1.3.0 and
matrix-appservice-irc 0.35.0, to patch several security issues:</p>
<ul>
<li>IRC mode operator confusion (Low, <a href="https://github.com/matrix-org/matrix-appservice-irc/security/advisories/GHSA-cq7q-5c67-w39w">GHSA-cq7q-5c67-w39w</a>)</li>
<li>Parsing issue leading to room takeovers (High, <a href="https://github.com/matrix-org/matrix-appservice-irc/security/advisories/GHSA-xvqg-mv25-rwvw">GHSA-xvqg-mv25-rwvw</a>)</li>
<li>Undisclosed issue (Moderate, <a href="https://github.com/matrix-org/matrix-appservice-irc/security/advisories/GHSA-r3p6-cg2c-c4qw">GHSA-r3p6-cg2c-c4qw</a>)</li>
</ul>
<p>The details of the final vulnerability will be released at a later date,
pending an audit of the codebase to ensure it's not affected by other similar
vulnerabilities.</p>
<p>The vulnerabilities have been patched in node-irc version 1.3.0 and
matrix-appservice-irc 0.35.0. You can get the release on
<a href="https://github.com/matrix-org/matrix-appservice-irc/releases">Github</a>.</p>
<p>The bridges running on the Libera Chat, OFTC and other networks bridged by the
Matrix.org Foundation have been patched.</p>
<p><strong>Please upgrade your IRC bridge as soon as possible.</strong></p>
<p>The above vulnerabilities were reported by <a href="https://valentin-lorentz.fr/">Val
Lorentz</a>. Thank you!</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;15&#x2F;on-matrix-and-the-log4j-vulnerabilities&#x2F;" title="On Matrix and the log4j vulnerabilities">On Matrix and the log4j vulnerabilities</a></h2>
                <span>
                    15.12.2021 12:58
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/matrix-security">
                        Matrix Security
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>There is currently a lot of buzz and uncertainty around a number of vulnerabilities discovered in the log4j library in the Java ecosystem. These vulnerabilities are collectively known as &quot;Log4Shell&quot; and currently encompass CVE-2021-44228 and CVE-2021-45046.</p>
<p>First and foremost, there are to our knowledge no Matrix homeservers written in Java. <a href="https://github.com/matrix-org/synapse/">Synapse</a>, the canonical implementation developed by the Matrix Foundation and the implementation that is backing matrix.org, is written in Python and thus unaffected. P2P Matrix relies on <a href="https://github.com/matrix-org/dendrite">Dendrite</a>, our next-gen homeserver which is written in Go and is unaffected. <a href="https://gitlab.com/famedly/conduit/">Conduit</a>, a community homeserver, is written in Rust and also unaffected. Supporting components like <a href="https://github.com/matrix-org/sygnal">Sygnal</a> and <a href="https://github.com/matrix-org/sydent">Sydent</a> are written in Python and unaffected.</p>
<p>There are two components that are commonly used in the Matrix ecosystem that do rely on Java. These are Jitsi, specifically the <a href="https://github.com/jitsi/jitsi-videobridge">Jitsi Videobridge</a> for VoIP, and <a href="https://gitlab.com/signald/signald">signald</a> used by the Signal bridge. Both components pull in log4j as part of their (transitive) dependencies. We're not aware of other bridges that are dependent on Java-based components.</p>
<p>For both of these projects updates have been published that integrate log4j 2.15.0 covering the initial CVE and we're currently waiting for additional updates to be published that integrate log4j 2.16.0 to cover the second. In the meantime, we've put all mitigations we are aware of in place on our systems and we strongly recommend everyone do the same.</p>
<p>For what mitigations to put in place, we recommend following the <a href="https://www.lunasec.io/docs/blog/log4j-zero-day-mitigation-guide/">recommendations provided by LunaSec</a>. They also provide a lot of background information on the vulnerabilities and how to audit for them.</p>
<p>Please keep an eye out for releases from the Jitsi and signald projects and follow their upgrade instructions to update your own deployments as soon as possible.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;13&#x2F;disclosure-buffer-overflow-in-libolm-and-matrix-js-sdk&#x2F;" title="Disclosure: buffer overflow in libolm and matrix-js-sdk">Disclosure: buffer overflow in libolm and matrix-js-sdk</a></h2>
                <span>
                    13.12.2021 18:35
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/matrix-security">
                        Matrix Security
                    </a>
                </span>
                <br>
                <small>Last update: 13.12.2021 16:11</small>
            </header>
            <div>
                
                <p>Today we are releasing security updates to libolm, matrix-js-sdk, and several clients including Element Web / Desktop. Users are encouraged to upgrade as soon as possible. This resolves the <a href="https://matrix.org/blog/2021/12/03/pre-disclosure-upcoming-security-release-of-libolm-and-matrix-js-sdk">pre-disclosure</a> issued on December 3rd.</p>
<p>Fixed library versions are:</p>
<ul>
<li>libolm: <a href="https://gitlab.matrix.org/matrix-org/olm/-/tree/3.2.8">3.2.8</a></li>
<li>matrix-js-sdk: <a href="https://github.com/matrix-org/matrix-js-sdk/releases/tag/v15.2.1">15.2.1</a></li>
</ul>
<p>Client versions incorporating the fixes are:</p>
<ul>
<li>Element Web / Desktop: <a href="https://github.com/vector-im/element-web/releases/tag/v1.9.7">1.9.7</a></li>
<li>SchildiChat Web / Desktop: <a href="https://github.com/SchildiChat/schildichat-desktop/releases/tag/v1.9.7-sc.1">1.9.7-sc.1</a></li>
<li>Cinny: <a href="https://github.com/ajbura/cinny/releases/tag/v1.6.0">1.6.0</a></li>
</ul>
<p>These releases mitigate a buffer overflow in <code>olm_session_describe</code>, a libolm debugging function used by matrix-js-sdk in its end-to-end encryption (E2EE) implementation. If you rely on matrix-js-sdk for E2EE, you are affected. This vulnerability has been assigned <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44538">CVE-2021-44538</a>.</p>
<p>Clients which do <em>not</em> use matrix-js-sdk for E2EE, like FluffyChat or Element Android / iOS, are <em>not</em> affected.</p>
<p>This issue has been present since the introduction of the <code>olm_session_describe</code> function in October 2019 (commits: <a href="https://gitlab.matrix.org/matrix-org/olm/-/commit/39a1ee0b18f0fced6d7bc293cc9a46ea70ec9e96">libolm</a>, <a href="https://github.com/matrix-org/matrix-js-sdk/commit/e6699c5424a856a639baa6d6f78d44594baaf404">matrix-js-sdk</a>).</p>
<p>We do not believe it is practical to successfully exploit this issue. However, upgrading remains important as the overflow <em>can</em> be triggered remotely.</p>
<p>Separately from the above vulnerability, we noticed during an internal audit that the libolm bindings in matrix-js-sdk were not zeroing out certain arrays containing entropy for cryptographic operations. This causes the entropy to remain resident in memory longer than necessary. As a defense-in-depth measure, this release of libolm now proactively overwrites those arrays when it is safe to do so.</p>
<p>Lastly, we are also taking this opportunity to update the version of Electron bundled with Element Desktop, pulling in the latest backported security fixes there.</p>
<p>The buffer overflow was found and reported by GitHub user <a href="https://github.com/brevilo">@brevilo</a> in the course of developing <a href="https://github.com/brevilo/jolm/">jOlm</a>, a library of Java bindings to libolm; thank you. If you believe you've discovered a security vulnerability in Matrix or its implementations, please see our <a href="https://matrix.org/security-disclosure-policy/">Security Disclosure Policy</a> for how to get in touch.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;03&#x2F;pre-disclosure-upcoming-security-release-of-libolm-and-matrix-js-sdk&#x2F;" title="Pre-disclosure: upcoming security release of libolm and matrix-js-sdk">Pre-disclosure: upcoming security release of libolm and matrix-js-sdk</a></h2>
                <span>
                    03.12.2021 00:00
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/matrix-security">
                        Matrix Security
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>On <strong>Monday, 13th December</strong> we plan to publish a security release of libolm at 15:00 UTC to address a single high severity issue. To the best of our knowledge, only matrix-js-sdk and clients relying on it for E2EE are affected by this issue. This includes Element Web/Desktop and their forks (like SchildiChat). The release of libolm will be immediately followed by a security release of matrix-js-sdk and the affected clients. Users of these clients are encouraged to <strong>upgrade as soon as the patched versions are released</strong>.</p>
<p>We will be reaching out to downstream packagers to ensure they can prepare patched versions of the affected packages at the time of the release. The details of the vulnerability will be disclosed in a blog post on the day of the release. There is so far no evidence of the vulnerability being exploited in the wild.</p>
<p>The patched version numbers will be as follows:</p>
<ul>
<li>libolm 3.2.8</li>
<li>matrix-js-sdk 15.2.1</li>
<li>Element Web/Desktop 1.9.7</li>
</ul>
<p>Thank you for your patience while we work to resolve this issue.</p>
<p><em>Edit, 2021-12-13: Added patched release numbers.</em></p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2021&#x2F;11&#x2F;23&#x2F;synapse-1-47-1-released&#x2F;" title="Synapse 1.47.1 released">Synapse 1.47.1 released</a></h2>
                <span>
                    23.11.2021 12:46
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/david-robertson">
                        David Robertson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Today we are releasing Synapse 1.47.1, a security update based on last week's release of <a href="https://matrix.org/blog/2021/11/17/synapse-1-47-0-released">Synapse 1.47.0</a>. This <a href="https://github.com/matrix-org/synapse/releases/tag/v1.47.1">release</a> patches one high severity issue affecting Synapse installations 1.47.0 and earlier using the media repository. An attacker could cause these Synapses to download a remote file and store it in a directory outside the media repository. </p>
<p>Note that:</p>
<ul>
<li>This only affects homeservers using Synapse's built-in media repository, as opposed to <a href="https://github.com/matrix-org/synapse-s3-storage-provider">synapse-s3-storage-provider</a> or <a href="https://github.com/turt2live/matrix-media-repo">matrix-media-repo</a>.</li>
<li>Attackers cannot control the exact name or destination of the stored file.</li>
</ul>
<p>To quote from the advisory:</p>
<blockquote>
<h3 id="ghsa-3hfw-x7gx-437c-cve-2021-41281-path-traversal-when-downloading-remote-media"><a href="https://github.com/matrix-org/synapse/security/advisories/GHSA-3hfw-x7gx-437c">GHSA-3hfw-x7gx-437c</a> / CVE-2021-41281: Path traversal when downloading remote media.</h3>
<h4 id="impact">Impact</h4>
<p>Synapse instances with the media repository enabled can be tricked into downloading a file from a remote server into an arbitrary directory, potentially outside the media store directory.</p>
<p>The last two directories and file name of the path are chosen randomly by Synapse and cannot be controlled by an attacker, which limits the impact.</p>
<p>Homeservers with the media repository disabled are unaffected. Homeservers configured with a federation whitelist are also unaffected.</p>
</blockquote>
<p>The <a href="https://github.com/matrix-org/synapse/security/advisories/GHSA-3hfw-x7gx-437c">advisory</a> has full details, including workarounds.</p>
<p>This issue was discovered and fixed by our internal security team.</p>
<p>Please update at your earliest convenience.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2021&#x2F;11&#x2F;18&#x2F;pre-disclosure-upcoming-security-release-of-synapse-1-47-1&#x2F;" title="Pre-disclosure: upcoming security release of Synapse 1.47.1">Pre-disclosure: upcoming security release of Synapse 1.47.1</a></h2>
                <span>
                    18.11.2021 00:00
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/matrix-security">
                        Matrix Security
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>On <strong>Tuesday, 23rd November</strong> we plan to release Synapse 1.47.1 at 12:00 UTC to address a single high severity issue. This vulnerability was discovered internally by our security team. Synapse is a Matrix homeserver implementation developed by the matrix.org team and the wider Matrix community.</p>
<p>If you're a server administrator running Synapse, <strong>please be prepared to upgrade as soon as the patched version is released</strong>.</p>
<p>We will be reaching out to downstream packagers to ensure they can prepare patched versions of affected packages at the time of the release. The details of the vulnerability will be disclosed in a blog post on the day of the release. There is so far no evidence of the vulnerability being exploited in the wild.</p>
<p>Thank you for your patience while we work to resolve this issue.</p>
<p><em>Edit, 2021-11-19: The opening paragraph was amended to note that the vulnerability was discovered internally.</em></p>
<p><em>Edit, 2021-11-22: The opening paragraph was amended to include a release time of 12:00 UTC.</em></p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2021&#x2F;09&#x2F;13&#x2F;vulnerability-disclosure-key-sharing&#x2F;" title="Disclosing CVE-2021-40823 and CVE-2021-40824: E2EE vulnerability in multiple Matrix clients">Disclosing CVE-2021-40823 and CVE-2021-40824: E2EE vulnerability in multiple Matrix clients</a></h2>
                <span>
                    13.09.2021 17:29
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/denis-kasak-dan-callahan-and-matthew-hodgson">
                        Denis Kasak, Dan Callahan, and Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Today we are disclosing a critical security issue affecting multiple Matrix clients and libraries including <a href="https://element.io/">Element</a> (Web/Desktop/Android), <a href="https://fluffychat.im/">FluffyChat</a>, <a href="https://nheko-reborn.github.io/">Nheko</a>, <a href="https://cinny.in/">Cinny</a>, and <a href="https://schildi.chat/">SchildiChat</a>. Element on iOS is not affected.</p>
<p>Specifically, in certain circumstances it may be possible to trick vulnerable clients into disclosing encryption keys for messages previously sent by that client to user accounts later compromised by an attacker.</p>
<p>Exploiting this vulnerability to read encrypted messages requires gaining control over the recipient’s account. This requires either compromising their credentials directly or compromising their homeserver.</p>
<p>Thus, the greatest risk is to users who are in encrypted rooms containing malicious servers. Admins of malicious servers could attempt to impersonate their users' devices in order to spy on messages sent by vulnerable clients in that room.</p>
<p>This is not a vulnerability in the Matrix or Olm/Megolm protocols, nor the libolm implementation. It is an implementation bug in certain Matrix clients and SDKs which support end-to-end encryption (“E2EE”).</p>
<p><strong>We have no evidence of the vulnerability being exploited in the wild</strong>.</p>
<p>This issue was discovered during an internal audit by Denis Kasak, a security researcher at Element.</p>
<h2 id="remediation-and-detection">Remediation and Detection</h2>
<p>Patched versions of affected clients are available now; please upgrade as soon as possible — we apologise sincerely for the inconvenience. If you are unable to upgrade, consider keeping vulnerable clients offline until you can. If vulnerable clients are offline, they cannot be tricked into disclosing keys. They may safely return online once updated.</p>
<p>Unfortunately, it is difficult or impossible to retroactively identify instances of this attack with standard logging levels present on both clients and servers. However, as the attack requires account compromise, homeserver administrators may wish to review their authentication logs for any indications of inappropriate access.</p>
<p>Similarly, users should review the list of devices connected to their account with an eye toward missing, untrusted, or non-functioning devices. Because an attacker must impersonate an existing or historical device, exploiting this vulnerability would either break an existing login on the user’s account, or a historical device would be re-added and flagged as untrusted.</p>
<p>Lastly, if you have previously verified the users / devices in a room, you would witness the safety shield on the room turn red during the attack, indicating the presence of an untrusted and potentially malicious device.</p>
<h2 id="affected-software">Affected Software</h2>
<p>Given the severity of this issue, Element attempted to review all known encryption-capable Matrix clients and libraries so that patches could be prepared prior to public disclosure.</p>
<p>Known <strong>vulnerable</strong> software:</p>
<ul>
<li><strong><a href="https://github.com/matrix-org/matrix-js-sdk">matrix-js-sdk</a> &lt; 12.4.1</strong> (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-40823">CVE-2021-40823</a>), including:
<ul>
<li><a href="https://element.io/">Element</a> Web / Desktop &lt; 1.8.3</li>
<li><a href="https://schildi.chat/">SchildiChat</a> (Web / Desktop) ≤ 1.7.32-sc1</li>
<li><a href="https://cinny.in/">Cinny</a> &lt; 1.2.1</li>
</ul>
</li>
<li><strong><a href="https://github.com/matrix-org/matrix-android-sdk2">matrix-android-sdk2</a> &lt; 1.2.2</strong> (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-40824">CVE-2021-40824</a>), including:
<ul>
<li><a href="https://element.io/">Element</a> (Android) &lt; 1.2.2</li>
<li><a href="https://schildi.chat/">SchildiChat</a> (Android) &lt; 1.2.2.sc43</li>
</ul>
</li>
<li><strong><a href="https://github.com/matrix-org/matrix-rust-sdk">matrix-rust-sdk</a> &lt; 0.4.0:</strong>
<ul>
<li><a href="https://gitlab.gnome.org/GNOME/fractal/-/tree/fractal-next">fractal-next</a> is <strong>not vulnerable</strong> due to depending on a recent enough commit.</li>
<li><a href="https://github.com/poljar/weechat-matrix-rs/">weechat-matrix-rs</a>, a rewrite of the original weechat-matrix script, had no tagged releases, but some commits did depend on vulnerable versions of the matrix-rust-sdk. Users should ensure to update to the latest master of weechat-matrix-rs, presently <a href="https://github.com/poljar/weechat-matrix-rs/commit/2b093a7ff1c75650467d61335b90e4a6ce1fa210">2b093a7</a>.</li>
</ul>
</li>
<li><strong><a href="https://gitlab.com/famedly/company/frontend/famedlysdk">FamedlySDK</a> &lt; 0.5.0</strong>, including:
<ul>
<li>Famedly &lt; 0.45.0</li>
<li><a href="https://fluffychat.im/">FluffyChat</a> &lt; 0.40.0</li>
</ul>
</li>
<li><strong><a href="https://nheko-reborn.github.io/">Nheko</a> ≤ 0.8.2</strong></li>
</ul>
<p>We believe the following software is <strong>not vulnerable:</strong></p>
<ul>
<li><strong><a href="https://github.com/matrix-org/matrix-android-sdk">matrix-android-sdk</a></strong> (deprecated!)</li>
<li><strong><a href="https://github.com/matrix-org/matrix-ios-sdk">matrix-ios-sdk</a></strong></li>
<li><strong><a href="https://github.com/poljar/matrix-nio">matrix-nio</a></strong>, including its use in<a href="https://github.com/matrix-org/pantalaimon"> Pantalaimon</a> and <a href="https://github.com/poljar/weechat-matrix">weechat-matrix</a>.</li>
</ul>
<p>We believe the following are <strong>not vulnerable</strong> due to not implementing key sharing:</p>
<ul>
<li><strong><a href="https://source.puri.sm/Librem5/chatty/-/tree/master/src/matrix">Chatty</a></strong></li>
<li><strong><a href="https://github.com/vector-im/hydrogen-web/tree/master/src/matrix">Hydrogen</a></strong></li>
<li><strong><a href="https://github.com/mautrix/go">mautrix</a></strong></li>
<li><strong><a href="https://github.com/matrix-org/purple-matrix">purple-matrix</a></strong></li>
<li><strong><a href="https://github.com/syphon-org/syphon">Syphon</a></strong></li>
</ul>
<h2 id="background">Background</h2>
<p>Matrix supports the concept of “key sharing”, letting a Matrix client which lacks the keys to decrypt a message request those keys from that user's other devices or the original sender's device.</p>
<p>This was a feature added in 2016 in order to address edge cases where a newly logged-in device might not have the necessary keys to decrypt historical messages.  Specifically, if other devices in the room are unaware of the new device due to a network partition, they have no way to encrypt for it—meaning that the only way the new device will be able to decrypt history is if the recipient's other devices share the necessary keys with it.</p>
<p>Other situations where key sharing is desirable include when the recipient hasn't backed up their keys (either online or offline) and needs them to decrypt history on a new login, or when facing implementation bugs which prevent clients from sending keys correctly. Requesting keys from a user's other devices sidesteps these issues.</p>
<p>Key sharing is described <a href="https://matrix.org/docs/guides/end-to-end-encryption-implementation-guide#key-sharing">here</a> in the Matrix E2EE Implementation Guide, which contains the following paragraph:</p>
<blockquote>
<p>In order to securely implement key sharing, clients must not reply to every key request they receive. The recommended strategy is to share the keys automatically only to verified devices of the same user. </p>
</blockquote>
<p>This is the approach taken in the original implementation in matrix-js-sdk, as used in Element Web and others, with the extension of also letting the sending device service keyshare requests from recipient devices.  Unfortunately, the implementation did not sufficiently verify the identity of the device requesting the keyshare, meaning that a compromised account can impersonate the device requesting the keys, creating this vulnerability.</p>
<p>This is not a protocol or specification bug, but an implementation bug which was then unfortunately replicated in other independent implementations.</p>
<p>While we believe we have identified and contacted all affected E2EE client implementations: if your client implements key sharing requests, we strongly recommend you check that you cryptographically verify the identity of the device which originated the key sharing request.</p>
<h2 id="next-steps">Next Steps</h2>
<p>The fact that this vulnerability was independently introduced so many times is a clear signal that the current wording in the Matrix Spec and the E2EE Implementation Guide is insufficient. We will thoroughly review the related documentation and revise it with clear guidelines on safely implementing key sharing.</p>
<p>Going further, we will also consider whether key sharing is still a necessary part of the Matrix protocol. If it is not, we will remove it. As discussed above, key sharing was originally introduced to make E2EE more reliable while we were ironing out its many edge cases and failure modes. Meanwhile, implementations have become much more robust, to the point that we may be able to go without key sharing completely. We will also consider changing how we present situations in which you cannot decrypt messages because the original sender was not aware of your presence. For example, undecryptable messages could be filed in a separate conversation thread, or those messages could require that keys are shared manually, effectively turning a bug into a feature.</p>
<p>We will also accelerate our work on matrix-rust-sdk as a portable reference implementation of the Matrix protocol, avoiding the implicit requirement that each independent library must necessarily reimplement this logic on its own. This will have the effect of reducing attack surface and simplifying audits for software which chooses to use matrix-rust-sdk.</p>
<p>Finally, we apologise to the wider Matrix community for the inconvenience and disruption of this issue.  While Element discovered this vulnerability during an internal audit of E2EE implementations, we will be funding an independent end-to-end audit of the reference Matrix E2EE implementations (not just Olm + libolm) in the near future to help mitigate the risk from any future vulnerabilities. The results of this audit will be made publicly available.</p>
<h2 id="timeline">Timeline</h2>
<p>Ultimately, Element took two weeks from initial discovery to completing an audit of all known, public E2EE implementations. It took a further week to coordinate disclosure, culminating in today's announcement.</p>
<ul>
<li>Monday, 23rd August — Discovery that Element Web is exploitable.</li>
<li>Thursday, 26th August — Determination that Element Android is exploitable with a modified attack.</li>
<li>Wednesday, 1 September — Determination that Element iOS fails safe in the presence of device changes.</li>
<li>Friday, 3 September — Determination that FluffyChat and Nheko are exploitable.</li>
<li>Tuesday, 7th September — Audit of Matrix clients and libraries complete.</li>
<li>Wednesday, 8th September — Affected software authors contacted, disclosure timelines agreed.</li>
<li>Friday, 10th September —<a href="https://matrix.org/blog/2021/09/10/pre-disclosure-upcoming-critical-fix-for-several-popular-matrix-clients"> Public pre-disclosure notification</a>. Downstream packagers (e.g., Linux distributions) notified via Matrix and e-mail.</li>
<li>Monday, 13th September — Coordinated releases of all affected software, public disclosure.</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2021&#x2F;09&#x2F;10&#x2F;pre-disclosure-upcoming-critical-fix-for-several-popular-matrix-clients&#x2F;" title="Pre-disclosure: upcoming critical fix for several popular Matrix clients">Pre-disclosure: upcoming critical fix for several popular Matrix clients</a></h2>
                <span>
                    10.09.2021 16:43
                    —
                    <a href="/category/security">
                        Security
                    </a>
                    —
                    <a
                        href="/author/matrix-security">
                        Matrix Security
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>A critical security vulnerability impacting several popular Matrix clients and libraries was recently discovered. A coordinated security release of the affected components will be happening in the afternoon (from an UTC perspective) of <strong>Monday, Sept 13th</strong>.</p>
<p>We will be reaching out to downstream packagers to ensure they can prepare patched versions of affected packages at the time of the release. The details of the vulnerability will be disclosed in a blog post on the day of the release. There is so far no evidence of the vulnerability being exploited in the wild.</p>
<p><strong>Please be prepared to upgrade as soon as the patched versions are released.</strong></p>
<p>Thank you for your patience while we work to resolve this issue.</p>

                
            </div>
        </article>
        
        <nav class="pagination">
    <div class="prev">
        
    </div>
    <span class="page-number">1 / 3</span>
    <div class="prev">
        
        <a href="&#x2F;category&#x2F;security&#x2F;page&#x2F;2&#x2F;">Next ›</a>
        
    </div>
</nav>

    </div>
</div>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="&#x2F;code"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
