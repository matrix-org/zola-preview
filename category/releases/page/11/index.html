<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Releases</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="stylesheet" href="/style.css" />

    
<link rel="alternate" type="application/rss+xml" title="RSS" href="/category/releases/atom.xml">
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        <a href="&#x2F;docs&#x2F;" class="
            ">
            Documentation
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="ecosystem-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true"
                >
            <label for="ecosystem-submenu-checkbox" class="submenu-title">Ecosystem <div class="arrow">
                </div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;integrations&#x2F;">Integrations</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<div id="taxonomy-single">
    <div class="content">
        <header>
            <h1>Releases</h1>
            141 posts tagged with "Releases" <a href="/category">(See all Category)</a>
            
            <h2>
                <small><a href="/category/releases/atom.xml">Atom Feed</a></small>
            </h2>
            
        </header>

        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;12&#x2F;13&#x2F;synapse-1-7-0-released&#x2F;" title="Synapse 1.7.0 released">Synapse 1.7.0 released</a></h2>
                <span>
                    13.12.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hello people, it’s Synapse 1.7.0 time.</p>
<p>This release includes some long requested features, most notably the ability to automatically delete message data after a predefined period. For more details take a look at the config <a href="https://github.com/matrix-org/synapse/blob/v1.7.0/docs/sample_config.yaml#L332-L393">here</a> ─ it should be pretty self explanatory.</p>
<p>Another significant change this release is to explicitly set room directories to be private by default. Previously it was possible to inadvertently configure the directory to be visible to arbitrary Matrix servers and the internet in general.</p>
<p>This means that for those admins who want their room directories to be publicly searchable (matrix.org for instance) they need to explicitly say so in the config. For more details see the <a href="https://github.com/matrix-org/synapse/blob/v1.7.0/UPGRADE.rst#upgrading-to-v170">upgrade notes</a> and our <a href="https://matrix.org/blog/2019/11/09/avoiding-unwelcome-visitors-on-private-matrix-servers/">blog post</a> explaining the situation in greater detail.</p>
<p>We also have early support for ephemeral messages, as well as the ability to specify a reason when rejecting an invite (amongst other actions).</p>
<p>Aside from all of that, we want to let you know about some changes on the horizon. Currently Synapse runs Sqlite by default. This is great in that it gets new admins going quickly without needing to install and configure Postgres. The downside of using Sqlite is that it offers very poor performance, especially once a server tries to join the federation. In truth Sqlite is only really there to demonstrate the service, but for anything other than the most trivial cases it is essential to migrate to Postgres.</p>
<p>Over the past few months we’ve been working to improve the migration path to Postgres such that finally we feel confident to actively encourage admins to migrate. What’s more, in a future release we will forcibly prevent SQLite-backed servers federating unless the admin explicitly sets a config flag to show that they understand the trade-off they are making.</p>
<p>Overall we see these changes as something that will improve everyone’s experience of the matrix federation. We’ll talk more about this closer to the time, but please expect a change in the coming months and if you are running SQLite, consider this a nudge to get yourself migrated.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.7.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a>.</p>
<p>The changelog since 1.6.1 follows:</p>
<h1 id="synapse-1-7-0-2019-12-13">Synapse 1.7.0 (2019-12-13)</h1>
<p>This release changes the default settings so that only local authenticated users can query the server's room directory. See the <a href="https://github.com/matrix-org/synapse/blob/v1.7.0/UPGRADE.rst#upgrading-to-v170">upgrade notes</a> for details.</p>
<p>Support for SQLite versions before 3.11 is now deprecated. A future release will refuse to start if used with an SQLite version before 3.11.</p>
<p>Administrators are reminded that SQLite should not be used for production instances. Instructions for migrating to Postgres are available <a href="https://github.com/matrix-org/synapse/blob/v1.7.0/docs/postgres.md">here</a>. A future release of synapse will, by default, disable federation for servers using SQLite.</p>
<p>No significant changes since 1.7.0rc2.</p>
<h1 id="synapse-1-7-0rc2-2019-12-11">Synapse 1.7.0rc2 (2019-12-11)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix incorrect error message for invalid requests when setting user's avatar URL. (<a href="https://github.com/matrix-org/synapse/issues/6497">#6497</a>)</li>
<li>Fix support for SQLite 3.7. (<a href="https://github.com/matrix-org/synapse/issues/6499">#6499</a>)</li>
<li>Fix regression where sending email push would not work when using a pusher worker. (<a href="https://github.com/matrix-org/synapse/issues/6507">#6507</a>, <a href="https://github.com/matrix-org/synapse/issues/6509">#6509</a>)</li>
</ul>
<h1 id="synapse-1-7-0rc1-2019-12-09">Synapse 1.7.0rc1 (2019-12-09)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Implement per-room message retention policies. (<a href="https://github.com/matrix-org/synapse/issues/5815">#5815</a>, <a href="https://github.com/matrix-org/synapse/issues/6436">#6436</a>)</li>
<li>Add etag and count fields to key backup endpoints to help clients guess if there are new keys. (<a href="https://github.com/matrix-org/synapse/issues/5858">#5858</a>)</li>
<li>Add <code>/admin/v2/users</code> endpoint with pagination. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/5925">#5925</a>)</li>
<li>Require User-Interactive Authentication for <code>/account/3pid/add</code>, meaning the user's password will be required to add a third-party ID to their account. (<a href="https://github.com/matrix-org/synapse/issues/6119">#6119</a>)</li>
<li>Implement the <code>/_matrix/federation/unstable/net.atleastfornow/state/&lt;context&gt;</code> API as drafted in MSC2314. (<a href="https://github.com/matrix-org/synapse/issues/6176">#6176</a>)</li>
<li>Configure privacy-preserving settings by default for the room directory. (<a href="https://github.com/matrix-org/synapse/issues/6355">#6355</a>)</li>
<li>Add ephemeral messages support by partially implementing <a href="https://github.com/matrix-org/matrix-doc/pull/2228">MSC2228</a>. (<a href="https://github.com/matrix-org/synapse/issues/6409">#6409</a>)</li>
<li>Add support for <a href="https://github.com/matrix-org/matrix-doc/pull/2367">MSC 2367</a>, which allows specifying a reason on all membership events. (<a href="https://github.com/matrix-org/synapse/issues/6434">#6434</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Transfer non-standard power levels on room upgrade. (<a href="https://github.com/matrix-org/synapse/issues/6237">#6237</a>)</li>
<li>Fix error from the Pillow library when uploading RGBA images. (<a href="https://github.com/matrix-org/synapse/issues/6241">#6241</a>)</li>
<li>Correctly apply the event filter to the <code>state</code>, <code>events_before</code> and <code>events_after</code> fields in the response to <code>/context</code> requests. (<a href="https://github.com/matrix-org/synapse/issues/6329">#6329</a>)</li>
<li>Fix caching devices for remote users when using workers, so that we don't attempt to refetch (and potentially fail) each time a user requests devices. (<a href="https://github.com/matrix-org/synapse/issues/6332">#6332</a>)</li>
<li>Prevent account data syncs getting lost across TCP replication. (<a href="https://github.com/matrix-org/synapse/issues/6333">#6333</a>)</li>
<li>Fix bug: TypeError in <code>register_user()</code> while using LDAP auth module. (<a href="https://github.com/matrix-org/synapse/issues/6406">#6406</a>)</li>
<li>Fix an intermittent exception when handling read-receipts. (<a href="https://github.com/matrix-org/synapse/issues/6408">#6408</a>)</li>
<li>Fix broken guest registration when there are existing blocks of numeric user IDs. (<a href="https://github.com/matrix-org/synapse/issues/6420">#6420</a>)</li>
<li>Fix startup error when http proxy is defined. (<a href="https://github.com/matrix-org/synapse/issues/6421">#6421</a>)</li>
<li>Fix error when using synapse_port_db on a vanilla synapse db. (<a href="https://github.com/matrix-org/synapse/issues/6449">#6449</a>)</li>
<li>Fix uploading multiple cross signing signatures for the same user. (<a href="https://github.com/matrix-org/synapse/issues/6451">#6451</a>)</li>
<li>Fix bug which lead to exceptions being thrown in a loop when a cross-signed device is deleted. (<a href="https://github.com/matrix-org/synapse/issues/6462">#6462</a>)</li>
<li>Fix <code>synapse_port_db</code> not exiting with a 0 code if something went wrong during the port process. (<a href="https://github.com/matrix-org/synapse/issues/6470">#6470</a>)</li>
<li>Improve sanity-checking when receiving events over federation. (<a href="https://github.com/matrix-org/synapse/issues/6472">#6472</a>)</li>
<li>Fix inaccurate per-block Prometheus metrics. (<a href="https://github.com/matrix-org/synapse/issues/6491">#6491</a>)</li>
<li>Fix small performance regression for sending invites. (<a href="https://github.com/matrix-org/synapse/issues/6493">#6493</a>)</li>
<li>Back out cross-signing code added in Synapse 1.5.0, which caused a performance regression. (<a href="https://github.com/matrix-org/synapse/issues/6494">#6494</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Update documentation and variables in user contributed systemd reference file. (<a href="https://github.com/matrix-org/synapse/issues/6369">#6369</a>, <a href="https://github.com/matrix-org/synapse/issues/6490">#6490</a>)</li>
<li>Fix link in the user directory documentation. (<a href="https://github.com/matrix-org/synapse/issues/6388">#6388</a>)</li>
<li>Add build instructions to the docker readme. (<a href="https://github.com/matrix-org/synapse/issues/6390">#6390</a>)</li>
<li>Switch Ubuntu package install recommendation to use python3 packages in INSTALL.md. (<a href="https://github.com/matrix-org/synapse/issues/6443">#6443</a>)</li>
<li>Write some docs for the quarantine_media api. (<a href="https://github.com/matrix-org/synapse/issues/6458">#6458</a>)</li>
<li>Convert CONTRIBUTING.rst to markdown (among other small fixes). (<a href="https://github.com/matrix-org/synapse/issues/6461">#6461</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove admin/v1/users_paginate endpoint. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/5925">#5925</a>)</li>
<li>Remove fallback for federation with old servers which lack the /federation/v1/state_ids API. (<a href="https://github.com/matrix-org/synapse/issues/6488">#6488</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add benchmarks for structured logging and improve output performance. (<a href="https://github.com/matrix-org/synapse/issues/6266">#6266</a>)</li>
<li>Improve the performance of outputting structured logging. (<a href="https://github.com/matrix-org/synapse/issues/6322">#6322</a>)</li>
<li>Refactor some code in the event authentication path for clarity. (<a href="https://github.com/matrix-org/synapse/issues/6343">#6343</a>, <a href="https://github.com/matrix-org/synapse/issues/6468">#6468</a>, <a href="https://github.com/matrix-org/synapse/issues/6480">#6480</a>)</li>
<li>Clean up some unnecessary quotation marks around the codebase. (<a href="https://github.com/matrix-org/synapse/issues/6362">#6362</a>)</li>
<li>Complain on startup instead of 500'ing during runtime when <code>public_baseurl</code> isn't set when necessary. (<a href="https://github.com/matrix-org/synapse/issues/6379">#6379</a>)</li>
<li>Add a test scenario to make sure room history purges don't break <code>/messages</code> in the future. (<a href="https://github.com/matrix-org/synapse/issues/6392">#6392</a>)</li>
<li>Clarifications for the email configuration settings. (<a href="https://github.com/matrix-org/synapse/issues/6423">#6423</a>)</li>
<li>Add more tests to the blacklist when running in worker mode. (<a href="https://github.com/matrix-org/synapse/issues/6429">#6429</a>)</li>
<li>Refactor data store layer to support multiple databases in the future. (<a href="https://github.com/matrix-org/synapse/issues/6454">#6454</a>, <a href="https://github.com/matrix-org/synapse/issues/6464">#6464</a>, <a href="https://github.com/matrix-org/synapse/issues/6469">#6469</a>, <a href="https://github.com/matrix-org/synapse/issues/6487">#6487</a>)</li>
<li>Port synapse.rest.client.v1 to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6482">#6482</a>)</li>
<li>Port synapse.rest.client.v2_alpha to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6483">#6483</a>)</li>
<li>Port SyncHandler to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6484">#6484</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;11&#x2F;26&#x2F;synapse-1-6-0-released&#x2F;" title="Synapse 1.6.0 released">Synapse 1.6.0 released</a></h2>
                <span>
                    26.11.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Synapse 1.6.0 has landed and is here to brighten your day!</p>
<p>1.6.0's most notable feature is that of label based filtering. It allows for messages to be tagged with a given label so that clients can filter on the label, this means that clients can subscribe to specific topics in a room, such as #lunch.</p>
<p>Completely separately, from here on in new rooms will be version 5 by default, all this means in practice is that servers will respect server signing key validity periods. This won't make a lot of difference in day to day operation, but it is an important security consideration and we now have sufficient penetration across the federation to make version 5 the default.</p>
<p>Aside from that there are a bunch of bug fixes and improvements, including fixing a bug that in some cases prevented messages being decrypted shortly after a restart (<a href="https://github.com/matrix-org/synapse/issues/6363">#6363</a>) and generally improving the room upgrade experience (<a href="https://github.com/matrix-org/synapse/issues/6232">#6232</a>, <a href="https://github.com/matrix-org/synapse/issues/6235">#6235</a>).</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.6.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.5.1 follows:</p>
<h1 id="synapse-1-6-0-2019-11-26">Synapse 1.6.0 (2019-11-26)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix phone home stats reporting. (<a href="https://github.com/matrix-org/synapse/issues/6418">#6418</a>)</li>
</ul>
<h1 id="synapse-1-6-0rc2-2019-11-25">Synapse 1.6.0rc2 (2019-11-25)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix a bug which could cause the background database update handler for event labels to get stuck in a loop raising exceptions. (<a href="https://github.com/matrix-org/synapse/issues/6407">#6407</a>)</li>
</ul>
<h1 id="synapse-1-6-0rc1-2019-11-20">Synapse 1.6.0rc1 (2019-11-20)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Add federation support for cross-signing. (<a href="https://github.com/matrix-org/synapse/issues/5727">#5727</a>)</li>
<li>Increase default room version from 4 to 5, thereby enforcing server key validity period checks. (<a href="https://github.com/matrix-org/synapse/issues/6220">#6220</a>)</li>
<li>Add support for outbound http proxying via http_proxy/HTTPS_PROXY env vars. (<a href="https://github.com/matrix-org/synapse/issues/6238">#6238</a>)</li>
<li>Implement label-based filtering on <code>/sync</code> and <code>/messages</code> (<a href="https://github.com/matrix-org/matrix-doc/pull/2326">MSC2326</a>). (<a href="https://github.com/matrix-org/synapse/issues/6301">#6301</a>, <a href="https://github.com/matrix-org/synapse/issues/6310">#6310</a>, <a href="https://github.com/matrix-org/synapse/issues/6340">#6340</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Fix LruCache callback deduplication for Python 3.8. Contributed by @V02460. (<a href="https://github.com/matrix-org/synapse/issues/6213">#6213</a>)</li>
<li>Remove a room from a server's public rooms list on room upgrade. (<a href="https://github.com/matrix-org/synapse/issues/6232">#6232</a>, <a href="https://github.com/matrix-org/synapse/issues/6235">#6235</a>)</li>
<li>Delete keys from key backup when deleting backup versions. (<a href="https://github.com/matrix-org/synapse/issues/6253">#6253</a>)</li>
<li>Make notification of cross-signing signatures work with workers. (<a href="https://github.com/matrix-org/synapse/issues/6254">#6254</a>)</li>
<li>Fix exception when remote servers attempt to join a room that they're not allowed to join. (<a href="https://github.com/matrix-org/synapse/issues/6278">#6278</a>)</li>
<li>Prevent errors from appearing on Synapse startup if <code>git</code> is not installed. (<a href="https://github.com/matrix-org/synapse/issues/6284">#6284</a>)</li>
<li>Appservice requests will no longer contain a double slash prefix when the appservice url provided ends in a slash. (<a href="https://github.com/matrix-org/synapse/issues/6306">#6306</a>)</li>
<li>Fix <code>/purge_room</code> admin API. (<a href="https://github.com/matrix-org/synapse/issues/6307">#6307</a>)</li>
<li>Fix the <code>hidden</code> field in the <code>devices</code> table for SQLite versions prior to 3.23.0. (<a href="https://github.com/matrix-org/synapse/issues/6313">#6313</a>)</li>
<li>Fix bug which caused rejected events to be persisted with the wrong room state. (<a href="https://github.com/matrix-org/synapse/issues/6320">#6320</a>)</li>
<li>Fix bug where <code>rc_login</code> ratelimiting would prematurely kick in. (<a href="https://github.com/matrix-org/synapse/issues/6335">#6335</a>)</li>
<li>Prevent the server taking a long time to start up when guest registration is enabled. (<a href="https://github.com/matrix-org/synapse/issues/6338">#6338</a>)</li>
<li>Fix bug where upgrading a guest account to a full user would fail when account validity is enabled. (<a href="https://github.com/matrix-org/synapse/issues/6359">#6359</a>)</li>
<li>Fix <code>to_device</code> stream ID getting reset every time Synapse restarts, which had the potential to cause unable to decrypt errors. (<a href="https://github.com/matrix-org/synapse/issues/6363">#6363</a>)</li>
<li>Fix permission denied error when trying to generate a config file with the docker image. (<a href="https://github.com/matrix-org/synapse/issues/6389">#6389</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Contributor documentation now mentions script to run linters. (<a href="https://github.com/matrix-org/synapse/issues/6164">#6164</a>)</li>
<li>Modify CAPTCHA_SETUP.md to update the terms <code>private key</code> and <code>public key</code> to <code>secret key</code> and <code>site key</code> respectively. Contributed by Yash Jipkate. (<a href="https://github.com/matrix-org/synapse/issues/6257">#6257</a>)</li>
<li>Update <code>INSTALL.md</code> Email section to talk about <code>account_threepid_delegates</code>. (<a href="https://github.com/matrix-org/synapse/issues/6272">#6272</a>)</li>
<li>Fix a small typo in <code>account_threepid_delegates</code> configuration option. (<a href="https://github.com/matrix-org/synapse/issues/6273">#6273</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add a CI job to test the <code>synapse_port_db</code> script. (<a href="https://github.com/matrix-org/synapse/issues/6140">#6140</a>, <a href="https://github.com/matrix-org/synapse/issues/6276">#6276</a>)</li>
<li>Convert EventContext to an attrs. (<a href="https://github.com/matrix-org/synapse/issues/6218">#6218</a>)</li>
<li>Move <code>persist_events</code> out from main data store. (<a href="https://github.com/matrix-org/synapse/issues/6240">#6240</a>, <a href="https://github.com/matrix-org/synapse/issues/6300">#6300</a>)</li>
<li>Reduce verbosity of user/room stats. (<a href="https://github.com/matrix-org/synapse/issues/6250">#6250</a>)</li>
<li>Reduce impact of debug logging. (<a href="https://github.com/matrix-org/synapse/issues/6251">#6251</a>)</li>
<li>Expose some homeserver functionality to spam checkers. (<a href="https://github.com/matrix-org/synapse/issues/6259">#6259</a>)</li>
<li>Change cache descriptors to always return deferreds. (<a href="https://github.com/matrix-org/synapse/issues/6263">#6263</a>, <a href="https://github.com/matrix-org/synapse/issues/6291">#6291</a>)</li>
<li>Fix incorrect comment regarding the functionality of an <code>if</code> statement. (<a href="https://github.com/matrix-org/synapse/issues/6269">#6269</a>)</li>
<li>Update CI to run <code>isort</code> over the <code>scripts</code> and <code>scripts-dev</code> directories. (<a href="https://github.com/matrix-org/synapse/issues/6270">#6270</a>)</li>
<li>Replace every instance of <code>logger.warn</code> method with <code>logger.warning</code> as the former is deprecated. (<a href="https://github.com/matrix-org/synapse/issues/6271">#6271</a>, <a href="https://github.com/matrix-org/synapse/issues/6314">#6314</a>)</li>
<li>Port replication http server endpoints to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6274">#6274</a>)</li>
<li>Port room rest handlers to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6275">#6275</a>)</li>
<li>Remove redundant CLI parameters on CI's <code>flake8</code> step. (<a href="https://github.com/matrix-org/synapse/issues/6277">#6277</a>)</li>
<li>Port <code>federation_server.py</code> to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6279">#6279</a>)</li>
<li>Port receipt and read markers to async/wait. (<a href="https://github.com/matrix-org/synapse/issues/6280">#6280</a>)</li>
<li>Split out state storage into separate data store. (<a href="https://github.com/matrix-org/synapse/issues/6294">#6294</a>, <a href="https://github.com/matrix-org/synapse/issues/6295">#6295</a>)</li>
<li>Refactor EventContext for clarity. (<a href="https://github.com/matrix-org/synapse/issues/6298">#6298</a>)</li>
<li>Update the version of black used to 19.10b0. (<a href="https://github.com/matrix-org/synapse/issues/6304">#6304</a>)</li>
<li>Add some documentation about worker replication. (<a href="https://github.com/matrix-org/synapse/issues/6305">#6305</a>)</li>
<li>Move admin endpoints into separate files. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/6308">#6308</a>)</li>
<li>Document the use of <code>lint.sh</code> for code style enforcement &amp; extend it to run on specified paths only. (<a href="https://github.com/matrix-org/synapse/issues/6312">#6312</a>)</li>
<li>Add optional python dependencies and dependant binary libraries to snapcraft packaging. (<a href="https://github.com/matrix-org/synapse/issues/6317">#6317</a>)</li>
<li>Remove the dependency on psutil and replace functionality with the stdlib <code>resource</code> module. (<a href="https://github.com/matrix-org/synapse/issues/6318">#6318</a>, <a href="https://github.com/matrix-org/synapse/issues/6336">#6336</a>)</li>
<li>Improve documentation for EventContext fields. (<a href="https://github.com/matrix-org/synapse/issues/6319">#6319</a>)</li>
<li>Add some checks that we aren't using state from rejected events. (<a href="https://github.com/matrix-org/synapse/issues/6330">#6330</a>)</li>
<li>Add continuous integration for python 3.8. (<a href="https://github.com/matrix-org/synapse/issues/6341">#6341</a>)</li>
<li>Correct spacing/case of various instances of the word &quot;homeserver&quot;. (<a href="https://github.com/matrix-org/synapse/issues/6357">#6357</a>)</li>
<li>Temporarily blacklist the failing unit test PurgeRoomTestCase.test_purge_room. (<a href="https://github.com/matrix-org/synapse/issues/6361">#6361</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;11&#x2F;08&#x2F;client-server-r0-6-0-and-identity-service-r0-3-0-releases&#x2F;" title="Client-server r0.6.0 and Identity Service r0.3.0 releases">Client-server r0.6.0 and Identity Service r0.3.0 releases</a></h2>
                <span>
                    08.11.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/travis-ralston">
                        Travis Ralston
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hey all,</p>
<p>For the last several months the team has been working on <a href="https://matrix.org/blog/2019/06/30/tightening-up-privacy-in-matrix">tightening up privacy in Matrix</a>, and with the <a href="https://matrix.org/blog/2019/09/27/privacy-improvements-in-synapse-1-4-and-riot-1-4">1.4 release of Synapse and Riot</a> quite a lot has been done in the area. One of the remaining pieces was to release all the specification changes to help other client/server implementations achieve the same goals, and now we've done that.</p>
<p>The <a href="https://matrix.org/docs/spec/client_server/r0.6.0">Client-Server r0.6.0</a> and <a href="https://matrix.org/docs/spec/identity_service/r0.3.0">Identity Service r0.3.0</a> spec releases both cover the privacy improvements added through a number of MSCs in the last few months. Of particular note is that identity servers are now expected to support terms of service endpoints, which requires authentication that clients might need to worry about - check the spec changelogs for details.</p>
<p>The full changelog for the Client-Server r0.6.0 release is:</p>
<ul>
<li>
<p>Breaking Changes</p>
<ul>
<li>Add <code>id_access_token</code> as a required request parameter to a few
endpoints which require an <code>id_server</code> parameter as part of
<a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a>.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2255">#2255</a>)</li>
</ul>
</li>
<li>
<p>New Endpoints</p>
<ul>
<li>Add <code>POST /account/3pid/unbind</code> for removing a 3PID from an identity
server.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2282">#2282</a>)</li>
</ul>
</li>
<li>
<p>Backwards Compatible Changes</p>
<ul>
<li>Add <code>M_USER_DEACTIVATED</code> error code.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2234">#2234</a>)</li>
<li>Remove <code>bind_msisdn</code> and <code>bind_email</code> from <code>/register</code> now that the
identity server's bind endpoint requires authentication.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2279">#2279</a>)</li>
<li>Add <code>m.identity_server</code> account data for tracking the user's
preferred identity server.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2281">#2281</a>)</li>
<li>Deprecate <code>id_server</code> and make it optional in several places.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2310">#2310</a>)</li>
</ul>
</li>
<li>
<p>Spec Clarifications</p>
<ul>
<li>Add missing format fields to <code>m.room.message$m.notice</code> schema.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2125">#2125</a>)</li>
<li>Remove &quot;required&quot; designation from the <code>url</code> field of certain
<code>m.room.message</code> msgtypes.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2129">#2129</a>)</li>
<li>Fix various typos throughout the specification.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2131">#2131</a>,
<a href="https://github.com/matrix-org/matrix-doc/issues/2136">#2136</a>,
<a href="https://github.com/matrix-org/matrix-doc/issues/2148">#2148</a>,
<a href="https://github.com/matrix-org/matrix-doc/issues/2215">#2215</a>)</li>
<li>Clarify the distinction between <code>m.key.verification.start</code> and its
<code>m.sas.v1</code> variant.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2132">#2132</a>)</li>
<li>Fix link to Olm signing specification.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2133">#2133</a>)</li>
<li>Clarify the conditions for the <code>.m.rule.room_one_to_one</code> push rule.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2152">#2152</a>)</li>
<li>Clarify the encryption algorithms supported by the device of the
device keys example.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2157">#2157</a>)</li>
<li>Clarify that <code>/rooms/:roomId/event/:eventId</code> returns a Matrix error.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2204">#2204</a>)</li>
<li>Add a missing <code>state_key</code> check on <code>.m.rule.tombstone</code>.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2223">#2223</a>)</li>
<li>Fix the <code>m.room_key_request</code> <code>action</code> value, setting it from
<code>cancel_request</code> to <code>request_cancellation</code>.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2247">#2247</a>)</li>
<li>Clarify that the <code>submit_url</code> field is without authentication.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2341">#2341</a>)</li>
<li>Clarify the expected phone number format.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2342">#2342</a>)</li>
<li>Clarify that clients should consider not requesting URL previews in
encrypted rooms.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2343">#2343</a>)</li>
<li>Add missing information on how filters are meant to work with
<code>/context</code>.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2344">#2344</a>)</li>
<li>Clarify what the keys are for rooms in <code>/sync</code>.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2345">#2345</a>)</li>
</ul>
</li>
</ul>
<p>The full changelog for the Identity Service r0.3.0 release is:</p>
<ul>
<li>
<p>New Endpoints</p>
<ul>
<li>Add <code>/account</code>, <code>/account/register</code>, and <code>/account/logout</code> to
authenticate with the identity server.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2255">#2255</a>)</li>
<li>Add endpoints for accepting and handling terms of service.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2258">#2258</a>)</li>
<li>Add <code>/hash_details</code> and a new <code>/lookup</code> endpoint for performing
hashed association lookups.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2287">#2287</a>)</li>
</ul>
</li>
<li>
<p>Backwards Compatible Changes</p>
<ul>
<li>Deprecate the v1 API in favour of an authenticated v2 API.
(<a href="https://github.com/matrix-org/matrix-doc/issues/2254">#2254</a>)</li>
</ul>
</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;29&#x2F;synapse-1-5-0-released&#x2F;" title="Synapse 1.5.0 released">Synapse 1.5.0 released</a></h2>
                <span>
                    29.10.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>That's right folks Synapse 1.5.0 is here and ready to make your life just a little bit better.</p>
<p>First things first, this release includes a security fix (<a href="https://github.com/matrix-org/synapse/issues/6262">#6262</a>, below). Administrators are encouraged to upgrade as soon as possible.</p>
<p>Aside from that, the main thing you'll notice in 1.5.0 is a massive performance improvement to the room directory, which means that servers with large directories to scan will return much more quickly. This is especially true for matrix.org but all servers will benefit.</p>
<p>Another key win is finally fixing some bugs in the sqlite -&gt; postgres migrator script. Sqlite mode is there strictly for testing purposes and should never be used in a production setting let alone a federating homeserver. So if you are currently using Sqlite now is the time to migrate. What's more the script is now in CI so it can't easily break in the future (with apologies to anyone bitten by the old script...).</p>
<p>A final final point, we have some preparatory work for e2ee cross signing, the overall feature is not ready for release just yet but we are getting really close. Watch this space.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.5.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.4.1 follows:</p>
<h1 id="synapse-1-5-0-2019-10-29">Synapse 1.5.0 (2019-10-29)</h1>
<h2 id="security-updates">Security updates</h2>
<p>This release includes a security fix (<a href="https://github.com/matrix-org/synapse/issues/6262">#6262</a>, below). Administrators are encouraged to upgrade as soon as possible.</p>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where room directory search was case sensitive. (<a href="https://github.com/matrix-org/synapse/issues/6268">#6268</a>)</li>
</ul>
<h1 id="synapse-1-5-0rc2-2019-10-28">Synapse 1.5.0rc2 (2019-10-28)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Update list of boolean columns in <code>synapse_port_db</code>. (<a href="https://github.com/matrix-org/synapse/issues/6247">#6247</a>)</li>
<li>Fix /keys/query API on workers. (<a href="https://github.com/matrix-org/synapse/issues/6256">#6256</a>)</li>
<li>Improve signature checking on some federation APIs. (<a href="https://github.com/matrix-org/synapse/issues/6262">#6262</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Move schema delta files to the correct data store. (<a href="https://github.com/matrix-org/synapse/issues/6248">#6248</a>)</li>
<li>Small performance improvement by removing repeated config lookups in room stats calculation. (<a href="https://github.com/matrix-org/synapse/issues/6255">#6255</a>)</li>
</ul>
<h1 id="synapse-1-5-0rc1-2019-10-24">Synapse 1.5.0rc1 (2019-10-24)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Improve quality of thumbnails for 1-bit/8-bit color palette images. (<a href="https://github.com/matrix-org/synapse/issues/2142">#2142</a>)</li>
<li>Add ability to upload cross-signing signatures. (<a href="https://github.com/matrix-org/synapse/issues/5726">#5726</a>)</li>
<li>Allow uploading of cross-signing keys. (<a href="https://github.com/matrix-org/synapse/issues/5769">#5769</a>)</li>
<li>CAS login now provides a default display name for users if a <code>displayname_attribute</code> is set in the configuration file. (<a href="https://github.com/matrix-org/synapse/issues/6114">#6114</a>)</li>
<li>Reject all pending invites for a user during deactivation. (<a href="https://github.com/matrix-org/synapse/issues/6125">#6125</a>)</li>
<li>Add config option to suppress client side resource limit alerting. (<a href="https://github.com/matrix-org/synapse/issues/6173">#6173</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Return an HTTP 404 instead of 400 when requesting a filter by ID that is unknown to the server. Thanks to @krombel for contributing this! (<a href="https://github.com/matrix-org/synapse/issues/2380">#2380</a>)</li>
<li>Fix a bug where users could be invited twice to the same group. (<a href="https://github.com/matrix-org/synapse/issues/3436">#3436</a>)</li>
<li>Fix <code>/createRoom</code> failing with badly-formatted MXIDs in the invitee list. Thanks to @wener291! (<a href="https://github.com/matrix-org/synapse/issues/4088">#4088</a>)</li>
<li>Make the <code>synapse_port_db</code> script create the right indexes on a new PostgreSQL database. (<a href="https://github.com/matrix-org/synapse/issues/6102">#6102</a>, <a href="https://github.com/matrix-org/synapse/issues/6178">#6178</a>, <a href="https://github.com/matrix-org/synapse/issues/6243">#6243</a>)</li>
<li>Fix bug when uploading a large file: Synapse responds with <code>M_UNKNOWN</code> while it should be <code>M_TOO_LARGE</code> according to spec. Contributed by Anshul Angaria. (<a href="https://github.com/matrix-org/synapse/issues/6109">#6109</a>)</li>
<li>Fix user push rules being deleted from a room when it is upgraded. (<a href="https://github.com/matrix-org/synapse/issues/6144">#6144</a>)</li>
<li>Don't 500 when trying to exchange a revoked 3PID invite. (<a href="https://github.com/matrix-org/synapse/issues/6147">#6147</a>)</li>
<li>Fix transferring notifications and tags when joining an upgraded room that is new to your server. (<a href="https://github.com/matrix-org/synapse/issues/6155">#6155</a>)</li>
<li>Fix bug where guest account registration can wedge after restart. (<a href="https://github.com/matrix-org/synapse/issues/6161">#6161</a>)</li>
<li>Fix monthly active user reaping when reserved users are specified. (<a href="https://github.com/matrix-org/synapse/issues/6168">#6168</a>)</li>
<li>Fix <code>/federation/v1/state</code> endpoint not supporting newer room versions. (<a href="https://github.com/matrix-org/synapse/issues/6170">#6170</a>)</li>
<li>Fix bug where we were updating censored events as bytes rather than text, occasionally causing invalid JSON being inserted breaking APIs that attempted to fetch such events. (<a href="https://github.com/matrix-org/synapse/issues/6186">#6186</a>)</li>
<li>Fix occasional missed updates in the room and user directories. (<a href="https://github.com/matrix-org/synapse/issues/6187">#6187</a>)</li>
<li>Fix tracing of non-JSON APIs, <code>/media</code>, <code>/key</code> etc. (<a href="https://github.com/matrix-org/synapse/issues/6195">#6195</a>)</li>
<li>Fix bug where presence would not get timed out correctly if a synchrotron worker is used and restarted. (<a href="https://github.com/matrix-org/synapse/issues/6212">#6212</a>)</li>
<li>synapse_port_db: Add 2 additional BOOLEAN_COLUMNS to be able to convert from database schema v56. (<a href="https://github.com/matrix-org/synapse/issues/6216">#6216</a>)</li>
<li>Fix a bug where the Synapse demo script blacklisted <code>::1</code> (ipv6 localhost) from receiving federation traffic. (<a href="https://github.com/matrix-org/synapse/issues/6229">#6229</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Fix logging getting lost for the docker image. (<a href="https://github.com/matrix-org/synapse/issues/6197">#6197</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Update <code>user_filters</code> table to have a unique index, and non-null columns. Thanks to @pik for contributing this. (<a href="https://github.com/matrix-org/synapse/issues/1172">#1172</a>, <a href="https://github.com/matrix-org/synapse/issues/6175">#6175</a>, <a href="https://github.com/matrix-org/synapse/issues/6184">#6184</a>)</li>
<li>Allow devices to be marked as hidden, for use by features such as cross-signing.
This adds a new field with a default value to the devices field in the database,
and so the database upgrade may take a long time depending on how many devices
are in the database. (<a href="https://github.com/matrix-org/synapse/issues/5759">#5759</a>)</li>
<li>Move lookup-related functions from RoomMemberHandler to IdentityHandler. (<a href="https://github.com/matrix-org/synapse/issues/5978">#5978</a>)</li>
<li>Improve performance of the public room list directory. (<a href="https://github.com/matrix-org/synapse/issues/6019">#6019</a>, <a href="https://github.com/matrix-org/synapse/issues/6152">#6152</a>, <a href="https://github.com/matrix-org/synapse/issues/6153">#6153</a>, <a href="https://github.com/matrix-org/synapse/issues/6154">#6154</a>)</li>
<li>Edit header dicts docstrings in <code>SimpleHttpClient</code> to note that <code>str</code> or <code>bytes</code> can be passed as header keys. (<a href="https://github.com/matrix-org/synapse/issues/6077">#6077</a>)</li>
<li>Add snapcraft packaging information. Contributed by @devec0. (<a href="https://github.com/matrix-org/synapse/issues/6084">#6084</a>, <a href="https://github.com/matrix-org/synapse/issues/6191">#6191</a>)</li>
<li>Kill off half-implemented password-reset via sms. (<a href="https://github.com/matrix-org/synapse/issues/6101">#6101</a>)</li>
<li>Remove <code>get_user_by_req</code> opentracing span and add some tags. (<a href="https://github.com/matrix-org/synapse/issues/6108">#6108</a>)</li>
<li>Drop some unused database tables. (<a href="https://github.com/matrix-org/synapse/issues/6115">#6115</a>)</li>
<li>Add env var to turn on tracking of log context changes. (<a href="https://github.com/matrix-org/synapse/issues/6127">#6127</a>)</li>
<li>Refactor configuration loading to allow better typechecking. (<a href="https://github.com/matrix-org/synapse/issues/6137">#6137</a>)</li>
<li>Log responder when responding to media request. (<a href="https://github.com/matrix-org/synapse/issues/6139">#6139</a>)</li>
<li>Improve performance of <code>find_next_generated_user_id</code> DB query. (<a href="https://github.com/matrix-org/synapse/issues/6148">#6148</a>)</li>
<li>Expand type-checking on modules imported by <code>synapse.config</code>. (<a href="https://github.com/matrix-org/synapse/issues/6150">#6150</a>)</li>
<li>Use Postgres ANY for selecting many values. (<a href="https://github.com/matrix-org/synapse/issues/6156">#6156</a>)</li>
<li>Add more caching to <code>_get_joined_users_from_context</code> DB query. (<a href="https://github.com/matrix-org/synapse/issues/6159">#6159</a>)</li>
<li>Add some metrics on the federation sender. (<a href="https://github.com/matrix-org/synapse/issues/6160">#6160</a>)</li>
<li>Add some logging to the rooms stats updates, to try to track down a flaky test. (<a href="https://github.com/matrix-org/synapse/issues/6167">#6167</a>)</li>
<li>Remove unused <code>timeout</code> parameter from <code>_get_public_room_list</code>. (<a href="https://github.com/matrix-org/synapse/issues/6179">#6179</a>)</li>
<li>Reject (accidental) attempts to insert bytes into postgres tables. (<a href="https://github.com/matrix-org/synapse/issues/6186">#6186</a>)</li>
<li>Make <code>version</code> optional in body of <code>PUT /room_keys/version/{version}</code>, since it's redundant. (<a href="https://github.com/matrix-org/synapse/issues/6189">#6189</a>)</li>
<li>Make storage layer responsible for adding device names to key, rather than the handler. (<a href="https://github.com/matrix-org/synapse/issues/6193">#6193</a>)</li>
<li>Port <code>synapse.rest.admin</code> module to use async/await. (<a href="https://github.com/matrix-org/synapse/issues/6196">#6196</a>)</li>
<li>Enforce that all boolean configuration values are lowercase in CI. (<a href="https://github.com/matrix-org/synapse/issues/6203">#6203</a>)</li>
<li>Remove some unused event-auth code. (<a href="https://github.com/matrix-org/synapse/issues/6214">#6214</a>)</li>
<li>Remove <code>Auth.check</code> method. (<a href="https://github.com/matrix-org/synapse/issues/6217">#6217</a>)</li>
<li>Remove <code>format_tap.py</code> script in favour of a perl reimplementation in Sytest's repo. (<a href="https://github.com/matrix-org/synapse/issues/6219">#6219</a>)</li>
<li>Refactor storage layer in preparation to support having multiple databases. (<a href="https://github.com/matrix-org/synapse/issues/6231">#6231</a>)</li>
<li>Remove some extra quotation marks across the codebase. (<a href="https://github.com/matrix-org/synapse/issues/6236">#6236</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;18&#x2F;synapse-1-4-1-released&#x2F;" title="Synapse 1.4.1 released">Synapse 1.4.1 released</a></h2>
                <span>
                    18.10.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>We've released Synapse 1.4.1 as a small but important bugfix to 1.4.0.</p>
<p>This fixes a regression which crept in with our newly implemented &quot;erase redacted data after N days&quot; feature where some APIs
would fail when hitting erased redactions - anyone on Synapse 1.4.0 will want to upgrade asap.</p>
<p>As always, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.4.1">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.4.0 follows:</p>
<h1 id="synapse-1-4-1-2019-10-18">Synapse 1.4.1 (2019-10-18)</h1>
<p>No changes since 1.4.1rc1.</p>
<h1 id="synapse-1-4-1rc1-2019-10-17">Synapse 1.4.1rc1 (2019-10-17)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where redacted events were sometimes incorrectly censored in the database, breaking APIs that attempted to fetch such events. (<a href="https://github.com/matrix-org/synapse/issues/6185">#6185</a>, <a href="https://github.com/matrix-org/synapse/commit/5b0e9948eaae801643e594b5abc8ee4b10bd194e">5b0e9948</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;03&#x2F;matrix-appservice-slack-bridge-1-0-is-here&#x2F;" title="matrix-appservice-slack bridge 1.0 is here!">matrix-appservice-slack bridge 1.0 is here!</a></h2>
                <span>
                    03.10.2019 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/half-shot">
                        Half-Shot
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hello Matrix enthusiasts! Yesterday we released <a href="https://github.com/matrix-org/matrix-appservice-slack/releases/tag/1.0.0">matrix-appservice-slack 1.0</a>. This marks a major milestone
in bridge development for the Matrix.org team, being our first bridge to ever reach 1.0. The decision to
release this version came after we decided that the bridge had gained enough features and reached a point
of stability where it could be deployed in the wild with minimal risk.</p>
<p>For those not in the know, the Slack bridge is Node.JS based, and bridges slack channels &amp; users into Matrix
seamlessly. And for those wondering, yes it works with Mattermost too (since their API is compatible with Slack)!
In previous versions only a limited subset of features were supported, making heavy usage of Slack’s
webhook API. As of 1.0, the bridge now makes use of the newer Slack Events/RTM API which gives us all we need for
a richer bridging experience. Everything from edits and reactions to typing notifications is supported in the 1.0 release.</p>
<p>Finally for those who are self hosting, we are pleased to offer the ability to &quot;puppet&quot; your Slack account using the
bridge. Puppeting is the process in which the bridge will send messages as if you were sending them from the Slack client
directly, when you talk using your Matrix account. This opens the door to seamless bridging and direct messaging support.</p>
<p>For those wishing to bridge their whole workspace across, <a href="https://github.com/SolarDrew/skill-picard">picard</a> exists
as a tool to manage large scale Slack bridge deployments. This tool is provided by <a href="https://matrix.to/#/@Cadair:matrix.org">Cadair</a> and <a href="https://matrix.to/#/@SolarDrew:matrix.org">SolarDrew</a></p>
<p><img src="/blog/img/2019-10-03-slack1.0-threading.png" alt="Slack Screenshot" />
Threading &amp; Reactions!</p>
<p>The bridge has undergone some pretty serious code surgery as well. The whole codebase has been rewritten in
TypeScript to take advantage of type checking and generic types. The bridge is currently based upon the
<a href="https://github.com/matrix-org/matrix-appservice-bridge/">matrix-appservice-bridge</a> library. The datastore interface now supports PostgreSQL, which allows for administrators to inspect and edit the database while the bridge is running, as well as offering  helpful performance boost over the NeDB datastore format that was used previously. Finally, the codebase has proper Unit and Integration Tests to ensure new changes will not cause any regressions in behaviour. In short, <strong>now is an excellent time to get involved and hack on the bridge</strong>. There is already a <a href="https://github.com/matrix-org/matrix-appservice-slack/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22">crafted list of easy issues</a> for new and experienced bridge devs.</p>
<p><img src="/blog/img/2019-10-03-slack1.0-perfmem.png" alt="Grafana memory usage graph" />
Memory usage of the bridge comparison</p>
<p><img src="/blog/img/2019-10-03-slack1.0-perfcpu.png" alt="Grafana CPU usage graph" />
CPU usage of the bridge comparison</p>
<p>In terms of how many users matrix.org is currently serving at the moment, we present to you some figures:</p>
<ul>
<li>2562 bridged rooms</li>
<li>764 teams connected to the bridge</li>
<li>103711 events have passed through the bridge since the launch of 0.3.2</li>
</ul>
<p>Of course, our work doesn’t stop at 1.0. The plan for the immediate future of the bridge
is to continue adding support for other event types coming from Matrix and Slack to create
an ever richer experience. Obvious features are things like topic changes, and syncing membership
across the bridge. In the long term future we would also like to add community support to the bridge,
so whole Slack workspaces can be bridged across with a single click.</p>
<p>That’s all from me, and I would like to say a massive thank you to <a href="https://matrix.to/#/@Cadair:matrix.org">Cadair</a>
and <a href="https://matrix.to/#/@benpa:matrix.org">Ben</a> for both their code and review work on the project and as always,
thank you to the community for using the bridge and reporting issues. 🙂</p>
<p>Useful links:</p>
<ul>
<li><a href="https://matrix.to/#/#matrix_appservice_slack:matrix.org">Matrix Room</a></li>
<li><a href="https://github.com/matrix-org/matrix-appservice-slack">Project Home</a></li>
<li><a href="https://matrix-appservice-slack.readthedocs.io/en/stable/">Docs</a></li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;03&#x2F;synapse-1-4-0-released&#x2F;" title="Synapse 1.4.0 released">Synapse 1.4.0 released</a></h2>
                <span>
                    03.10.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Wheyhey as I live and breathe 1.4.0 is here!</p>
<p>1.4.0 should be considered ‘The Privacy Release’ and is the cumulation of a huge body of work spanning multiple projects to improve data privacy in the matrix ecosystem. You can read more about the <a href="https://matrix.org/blog/2019/09/27/privacy-improvements-in-synapse-1-4-and-riot-1-4">full project here</a>.</p>
<p>While we consider 1.4.0 to be a huge leap forward in terms of data privacy, it is really important to note that it contains breaking changes.</p>
<ul>
<li>If you currently rely on email or SMS delivery via an identity server you must modify your Synapse configuration.</li>
<li>If you have configured custom templates, then eight new templates must be added to your templates directory.</li>
</ul>
<p>If either apply to you failure to act will break your installation. Full details can be found in the <a href="https://github.com/matrix-org/synapse/blob/master/UPGRADE.rst#upgrading-to-v140">upgrade notes</a>.</p>
<h2 id="so-what-has-changed">So what has changed?</h2>
<p>It is possible for a user to associate an email address or phone number with their account, for a number of reasons:</p>
<ul>
<li>For use when logging in, as an alternative to the user id.</li>
<li>In the case of email, as an alternative contact to help with account recovery.</li>
<li>In the case of email, to receive notifications of missed messages.</li>
</ul>
<p>Before an email address or phone number can be added to a user's account, or before such an address is used to carry out a password-reset, Synapse must confirm the operation with the owner of the email address or phone number. It does this by sending an email or text giving the user a link or token to confirm receipt. This process is known as '3pid verification'. ('3pid', or 'threepid', stands for third-party identifier, and we use it to refer to external identifiers such as email addresses and phone numbers.)</p>
<p>Previous versions of Synapse delegated the task of 3pid verification to an identity server by default. In most cases this server is vector.im or matrix.org.</p>
<p>In Synapse 1.4.0, for security and privacy reasons, the homeserver will no longer delegate this task to an identity server by default. Instead, the server administrator will need to explicitly decide how they would like the verification messages to be sent.</p>
<p>In the medium term, the vector.im and matrix.org identity servers will disable support for delegated 3pid verification entirely. However, in order to ease the transition, they will retain the capability for a limited period. Delegated email verification will be disabled on Monday 2nd December 2019 (giving roughly 2 months notice). Disabling delegated SMS verification will follow some time after that once SMS verification support lands in Synapse.</p>
<p>Once delegated 3pid verification support has been disabled in the vector.im and matrix.org identity servers, all Synapse versions that depend on those instances will be unable to verify email and phone numbers through them. There are no imminent plans to remove delegated 3pid verification from Sydent generally. (Sydent is the identity server project that backs the vector.im and matrix.org instances).</p>
<h2 id="why-is-this-necessary">Why is this necessary?</h2>
<p>Prior to 1.4.0, the identity server was providing two related-but-separate functions:</p>
<p>a directory for users to publish their contact details and to look up their contacts by their email addresses and phone numbers.
a &quot;trusted third party communications network delegate&quot;, providing SMS- and email-sending functionality to all homeservers for registration and password reset.</p>
<p>The intention behind the identity server's providing 2. was one of convenience: to save homeserver admins the burden of configuring their homeservers to send email, as well as sparing us the effort of writing generic SMS-gateway integration that would allow any homeserver admin to configure their homeserver to send SMS via their chosen SMS aggregator.</p>
<p>By exposing this 'trusted email/sms delegate' functionality, however, and by including references to the New Vector identity servers in the default configuration for both Synapse and Riot, we created a situation in which users on non-New Vector run homeservers (who had never seen our privacy notice) could easily end up sharing their email addresses and phone numbers with a New Vector identity server.</p>
<p>Using identity servers for registration and password reset introduced yet further complexity - since password reset is a sensitive operation, it was important that the homeserver only use 'trusted' identity servers for this purpose (with the trust being configured by the homeserver admin in the homeserver config). But this created ambiguity over who was ultimately responsible for the choice of identity server and when they could make that choice - the client could present a default identity server at login/registration/password reset time, which the user could choose to override before logging in, but unless the identity server ultimately selected were on the homeserver admin's 'trusted identity servers' list, any identity server operations that were proxied via the homeserver would have been blocked by the homeserver. However, not all identity server operations initiated by the client were proxied via the homeserver - some were sent directly from the client to the identity server, and would not have been filtered.</p>
<p>The best way to solve this problem is to have individual homeservers take ownership for their own email and SMS needs. In the case of email this means configuring details of an appropriate SMTP server or continuing to delegate through an identity server that will allow it to do so. If a homeserver admin makes the active choice to use New Vector's identity servers for delegation (up until 1st December), they should make their own users aware through their privacy notice.</p>
<p>This delegation is entirely separate from the user's choice of identity server for user directory services. As of right now the user is free to choose and trust whichever identity server they wish, or to choose not to use an identity server at all.</p>
<h2 id="are-there-any-other-data-privacy-features">Are there any other data privacy features?</h2>
<p>Yes, 1.4.0 now <a href="https://github.com/matrix-org/synapse/issues/1287">automatically garbage collects redacted messages</a> (defaults to 7 days) and removes <a href="https://github.com/matrix-org/synapse/pull/6098/files">unused IP and user agent information</a> stored in the user_ips table (defaults to 30 days). Finally, Synapse now <a href="https://github.com/matrix-org/synapse/pull/6090/files">warns in its logs</a> if you are using matrix.org as a trusted key server, in case you wish to use a different server to help discover other servers’ keys.</p>
<h2 id="anything-else">Anything else?</h2>
<p>Aside from privacy, we’ve expanded our OpenTracing support and fixed a host of bugs. However the thing that is most exciting is switching on our solution for <a href="https://github.com/matrix-org/synapse/issues/5319">mitigating forward extremities build up</a>’ by default.</p>
<p>In some cases rooms can accumulate ‘forward extremities’, which are simply an artefact of attempting to resolve the room state over multiple servers. Forward extremities are necessary to ensure that each server can independently arrive at the same view of the room eventually, however processing these extremities can be <a href="https://github.com/matrix-org/synapse/issues/1760">computationally expensive and degrade server performance overall</a>.</p>
<p>Originally it was an experimental config option but we now feel confident to turn it on by default for all instances - it should make a big difference for the CPU of servers in fragmented rooms.</p>
<p>So that’s it folks, thanks for making it this far. As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.4.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.3.1 follows:</p>
<h1 id="synapse-1-4-0-2019-10-03">Synapse 1.4.0 (2019-10-03)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Redact <code>client_secret</code> in server logs. (<a href="https://github.com/matrix-org/synapse/issues/6158">#6158</a>)</li>
</ul>
<h1 id="synapse-1-4-0rc2-2019-10-02">Synapse 1.4.0rc2 (2019-10-02)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix bug in background update that adds last seen information to the <code>devices</code> table, and improve its performance on Postgres. (<a href="https://github.com/matrix-org/synapse/issues/6135">#6135</a>)</li>
<li>Fix bad performance of censoring redactions background task. (<a href="https://github.com/matrix-org/synapse/issues/6141">#6141</a>)</li>
<li>Fix fetching censored redactions from DB, which caused APIs like initial sync to fail if it tried to include the censored redaction. (<a href="https://github.com/matrix-org/synapse/issues/6145">#6145</a>)</li>
<li>Fix exceptions when storing large retry intervals for down remote servers. (<a href="https://github.com/matrix-org/synapse/issues/6146">#6146</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Fix up sample config entry for <code>redaction_retention_period</code> option. (<a href="https://github.com/matrix-org/synapse/issues/6117">#6117</a>)</li>
</ul>
<h1 id="synapse-1-4-0rc1-2019-09-26">Synapse 1.4.0rc1 (2019-09-26)</h1>
<p>Note that this release includes significant changes around 3pid verification. Administrators are reminded to review the <a href="UPGRADE.rst#upgrading-to-v140">upgrade notes</a>.</p>
<h2 id="features">Features</h2>
<ul>
<li>Changes to 3pid verification:
<ul>
<li>Add the ability to send registration emails from the homeserver rather than delegating to an identity server. (<a href="https://github.com/matrix-org/synapse/issues/5835">#5835</a>, <a href="https://github.com/matrix-org/synapse/issues/5940">#5940</a>, <a href="https://github.com/matrix-org/synapse/issues/5993">#5993</a>, <a href="https://github.com/matrix-org/synapse/issues/5994">#5994</a>, <a href="https://github.com/matrix-org/synapse/issues/5868">#5868</a>)</li>
<li>Replace <code>trust_identity_server_for_password_resets</code> config option with <code>account_threepid_delegates</code>, and make the <code>id_server</code> parameteter optional on <code>*/requestToken</code> endpoints, as per <a href="https://github.com/matrix-org/matrix-doc/pull/2263">MSC2263</a>. (<a href="https://github.com/matrix-org/synapse/issues/5876">#5876</a>, <a href="https://github.com/matrix-org/synapse/issues/5969">#5969</a>, <a href="https://github.com/matrix-org/synapse/issues/6028">#6028</a>)</li>
<li>Switch to using the v2 Identity Service <code>/lookup</code> API where available, with fallback to v1. (Implements <a href="https://github.com/matrix-org/matrix-doc/pull/2134">MSC2134</a> plus <code>id_access_token authentication</code> for v2 Identity Service APIs from <a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a>). (<a href="https://github.com/matrix-org/synapse/issues/5897">#5897</a>)</li>
<li>Remove <code>bind_email</code> and <code>bind_msisdn</code> parameters from <code>/register</code> ala <a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a>. (<a href="https://github.com/matrix-org/synapse/issues/5964">#5964</a>)</li>
<li>Add <code>m.id_access_token</code> to <code>unstable_features</code> in <code>/versions</code> as per <a href="https://github.com/matrix-org/matrix-doc/pull/2264">MSC2264</a>. (<a href="https://github.com/matrix-org/synapse/issues/5974">#5974</a>)</li>
<li>Use the v2 Identity Service API for 3PID invites. (<a href="https://github.com/matrix-org/synapse/issues/5979">#5979</a>)</li>
<li>Add <code>POST /_matrix/client/unstable/account/3pid/unbind</code> endpoint from <a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a> for unbinding a 3PID from an identity server without removing it from the homeserver user account. (<a href="https://github.com/matrix-org/synapse/issues/5980">#5980</a>, <a href="https://github.com/matrix-org/synapse/issues/6062">#6062</a>)</li>
<li>Use <code>account_threepid_delegate.email</code> and <code>account_threepid_delegate.msisdn</code> for validating threepid sessions. (<a href="https://github.com/matrix-org/synapse/issues/6011">#6011</a>)</li>
<li>Allow homeserver to handle or delegate email validation when adding an email to a user's account. (<a href="https://github.com/matrix-org/synapse/issues/6042">#6042</a>)</li>
<li>Implement new Client Server API endpoints <code>/account/3pid/add</code> and <code>/account/3pid/bind</code> as per <a href="https://github.com/matrix-org/matrix-doc/pull/2290">MSC2290</a>. (<a href="https://github.com/matrix-org/synapse/issues/6043">#6043</a>)</li>
<li>Add an unstable feature flag for separate add/bind 3pid APIs. (<a href="https://github.com/matrix-org/synapse/issues/6044">#6044</a>)</li>
<li>Remove <code>bind</code> parameter from Client Server POST <code>/account</code> endpoint as per <a href="https://github.com/matrix-org/matrix-doc/pull/2290/">MSC2290</a>. (<a href="https://github.com/matrix-org/synapse/issues/6067">#6067</a>)</li>
<li>Add <code>POST /add_threepid/msisdn/submit_token</code> endpoint for proxying submitToken on an <code>account_threepid_handler</code>. (<a href="https://github.com/matrix-org/synapse/issues/6078">#6078</a>)</li>
<li>Add <code>submit_url</code> response parameter to <code>*/msisdn/requestToken</code> endpoints. (<a href="https://github.com/matrix-org/synapse/issues/6079">#6079</a>)</li>
<li>Add <code>m.require_identity_server</code> flag to /version's unstable_features. (<a href="https://github.com/matrix-org/synapse/issues/5972">#5972</a>)</li>
</ul>
</li>
<li>Enhancements to OpenTracing support:
<ul>
<li>Make OpenTracing work in worker mode. (<a href="https://github.com/matrix-org/synapse/issues/5771">#5771</a>)</li>
<li>Pass OpenTracing contexts between servers when transmitting EDUs. (<a href="https://github.com/matrix-org/synapse/issues/5852">#5852</a>)</li>
<li>OpenTracing for device list updates. (<a href="https://github.com/matrix-org/synapse/issues/5853">#5853</a>)</li>
<li>Add a tag recording a request's authenticated entity and corresponding servlet in OpenTracing. (<a href="https://github.com/matrix-org/synapse/issues/5856">#5856</a>)</li>
<li>Add minimum OpenTracing for client servlets. (<a href="https://github.com/matrix-org/synapse/issues/5983">#5983</a>)</li>
<li>Check at setup that OpenTracing is installed if it's enabled in the config. (<a href="https://github.com/matrix-org/synapse/issues/5985">#5985</a>)</li>
<li>Trace replication send times. (<a href="https://github.com/matrix-org/synapse/issues/5986">#5986</a>)</li>
<li>Include missing OpenTracing contexts in outbout replication requests. (<a href="https://github.com/matrix-org/synapse/issues/5982">#5982</a>)</li>
<li>Fix sending of EDUs when OpenTracing is enabled with an empty whitelist. (<a href="https://github.com/matrix-org/synapse/issues/5984">#5984</a>)</li>
<li>Fix invalid references to None while OpenTracing if the log context slips. (<a href="https://github.com/matrix-org/synapse/issues/5988">#5988</a>, <a href="https://github.com/matrix-org/synapse/issues/5991">#5991</a>)</li>
<li>OpenTracing for room and e2e keys. (<a href="https://github.com/matrix-org/synapse/issues/5855">#5855</a>)</li>
<li>Add OpenTracing span over HTTP push processing. (<a href="https://github.com/matrix-org/synapse/issues/6003">#6003</a>)</li>
</ul>
</li>
<li>Add an admin API to purge old rooms from the database. (<a href="https://github.com/matrix-org/synapse/issues/5845">#5845</a>)</li>
<li>Retry well-known lookups if we have recently seen a valid well-known record for the server. (<a href="https://github.com/matrix-org/synapse/issues/5850">#5850</a>)</li>
<li>Add support for filtered room-directory search requests over federation (<a href="https://github.com/matrix-org/matrix-doc/pull/2197">MSC2197</a>, in order to allow upcoming room directory query performance improvements. (<a href="https://github.com/matrix-org/synapse/issues/5859">#5859</a>)</li>
<li>Correctly retry all hosts returned from SRV when we fail to connect. (<a href="https://github.com/matrix-org/synapse/issues/5864">#5864</a>)</li>
<li>Add admin API endpoint for setting whether or not a user is a server administrator. (<a href="https://github.com/matrix-org/synapse/issues/5878">#5878</a>)</li>
<li>Enable cleaning up extremities with dummy events by default to prevent undue build up of forward extremities. (<a href="https://github.com/matrix-org/synapse/issues/5884">#5884</a>)</li>
<li>Add config option to sign remote key query responses with a separate key. (<a href="https://github.com/matrix-org/synapse/issues/5895">#5895</a>)</li>
<li>Add support for config templating. (<a href="https://github.com/matrix-org/synapse/issues/5900">#5900</a>)</li>
<li>Users with the type of &quot;support&quot; or &quot;bot&quot; are no longer required to consent. (<a href="https://github.com/matrix-org/synapse/issues/5902">#5902</a>)</li>
<li>Let synctl accept a directory of config files. (<a href="https://github.com/matrix-org/synapse/issues/5904">#5904</a>)</li>
<li>Increase max display name size to 256. (<a href="https://github.com/matrix-org/synapse/issues/5906">#5906</a>)</li>
<li>Add admin API endpoint for getting whether or not a user is a server administrator. (<a href="https://github.com/matrix-org/synapse/issues/5914">#5914</a>)</li>
<li>Redact events in the database that have been redacted for a week. (<a href="https://github.com/matrix-org/synapse/issues/5934">#5934</a>)</li>
<li>New prometheus metrics:
<ul>
<li><code>synapse_federation_known_servers</code>: represents the total number of servers your server knows about (i.e. is in rooms with), including itself. Enable by setting <code>metrics_flags.known_servers</code> to True in the configuration.(<a href="https://github.com/matrix-org/synapse/issues/5981">#5981</a>)</li>
<li><code>synapse_build_info</code>: exposes the Python version, OS version, and Synapse version of the running server. (<a href="https://github.com/matrix-org/synapse/issues/6005">#6005</a>)</li>
</ul>
</li>
<li>Give appropriate exit codes when synctl fails. (<a href="https://github.com/matrix-org/synapse/issues/5992">#5992</a>)</li>
<li>Apply the federation blacklist to requests to identity servers. (<a href="https://github.com/matrix-org/synapse/issues/6000">#6000</a>)</li>
<li>Add <code>report_stats_endpoint</code> option to configure where stats are reported to, if enabled. Contributed by @Sorunome. (<a href="https://github.com/matrix-org/synapse/issues/6012">#6012</a>)</li>
<li>Add config option to increase ratelimits for room admins redacting messages. (<a href="https://github.com/matrix-org/synapse/issues/6015">#6015</a>)</li>
<li>Stop sending federation transactions to servers which have been down for a long time. (<a href="https://github.com/matrix-org/synapse/issues/6026">#6026</a>)</li>
<li>Make the process for mapping SAML2 users to matrix IDs more flexible. (<a href="https://github.com/matrix-org/synapse/issues/6037">#6037</a>)</li>
<li>Return a clearer error message when a timeout occurs when attempting to contact an identity server. (<a href="https://github.com/matrix-org/synapse/issues/6073">#6073</a>)</li>
<li>Prevent password reset's submit_token endpoint from accepting trailing slashes. (<a href="https://github.com/matrix-org/synapse/issues/6074">#6074</a>)</li>
<li>Return 403 on <code>/register/available</code> if registration has been disabled. (<a href="https://github.com/matrix-org/synapse/issues/6082">#6082</a>)</li>
<li>Explicitly log when a homeserver does not have the <code>trusted_key_servers</code> config field configured. (<a href="https://github.com/matrix-org/synapse/issues/6090">#6090</a>)</li>
<li>Add support for pruning old rows in <code>user_ips</code> table. (<a href="https://github.com/matrix-org/synapse/issues/6098">#6098</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Don't create broken room when <code>power_level_content_override.users</code> does not contain <code>creator_id</code>. (<a href="https://github.com/matrix-org/synapse/issues/5633">#5633</a>)</li>
<li>Fix database index so that different backup versions can have the same sessions. (<a href="https://github.com/matrix-org/synapse/issues/5857">#5857</a>)</li>
<li>Fix Synapse looking for config options <code>password_reset_failure_template</code> and <code>password_reset_success_template</code>, when they are actually <code>password_reset_template_failure_html</code>, <code>password_reset_template_success_html</code>. (<a href="https://github.com/matrix-org/synapse/issues/5863">#5863</a>)</li>
<li>Fix stack overflow when recovering an appservice which had an outage. (<a href="https://github.com/matrix-org/synapse/issues/5885">#5885</a>)</li>
<li>Fix error message which referred to <code>public_base_url</code> instead of <code>public_baseurl</code>. Thanks to @aaronraimist for the fix! (<a href="https://github.com/matrix-org/synapse/issues/5909">#5909</a>)</li>
<li>Fix 404 for thumbnail download when <code>dynamic_thumbnails</code> is <code>false</code> and the thumbnail was dynamically generated. Fix reported by rkfg. (<a href="https://github.com/matrix-org/synapse/issues/5915">#5915</a>)</li>
<li>Fix a cache-invalidation bug for worker-based deployments. (<a href="https://github.com/matrix-org/synapse/issues/5920">#5920</a>)</li>
<li>Fix admin API for listing media in a room not being available with an external media repo. (<a href="https://github.com/matrix-org/synapse/issues/5966">#5966</a>)</li>
<li>Fix list media admin API always returning an error. (<a href="https://github.com/matrix-org/synapse/issues/5967">#5967</a>)</li>
<li>Fix room and user stats tracking. (<a href="https://github.com/matrix-org/synapse/issues/5971">#5971</a>, <a href="https://github.com/matrix-org/synapse/issues/5998">#5998</a>, <a href="https://github.com/matrix-org/synapse/issues/6029">#6029</a>)</li>
<li>Return a <code>M_MISSING_PARAM</code> if <code>sid</code> is not provided to <code>/account/3pid</code>. (<a href="https://github.com/matrix-org/synapse/issues/5995">#5995</a>)</li>
<li><code>federation_certificate_verification_whitelist</code> now will not cause <code>TypeErrors</code> to be raised (a regression in 1.3). Additionally, it now supports internationalised domain names in their non-canonical representation. (<a href="https://github.com/matrix-org/synapse/issues/5996">#5996</a>)</li>
<li>Only count real users when checking for auto-creation of auto-join room. (<a href="https://github.com/matrix-org/synapse/issues/6004">#6004</a>)</li>
<li>Ensure support users can be registered even if MAU limit is reached. (<a href="https://github.com/matrix-org/synapse/issues/6020">#6020</a>)</li>
<li>Fix bug where login error was shown incorrectly on SSO fallback login. (<a href="https://github.com/matrix-org/synapse/issues/6024">#6024</a>)</li>
<li>Fix bug in calculating the federation retry backoff period. (<a href="https://github.com/matrix-org/synapse/issues/6025">#6025</a>)</li>
<li>Prevent exceptions being logged when extremity-cleanup events fail due to lack of user consent to the terms of service. (<a href="https://github.com/matrix-org/synapse/issues/6053">#6053</a>)</li>
<li>Remove POST method from password-reset <code>submit_token</code> endpoint until we implement <code>submit_url</code> functionality. (<a href="https://github.com/matrix-org/synapse/issues/6056">#6056</a>)</li>
<li>Fix logcontext spam on non-Linux platforms. (<a href="https://github.com/matrix-org/synapse/issues/6059">#6059</a>)</li>
<li>Ensure query parameters in email validation links are URL-encoded. (<a href="https://github.com/matrix-org/synapse/issues/6063">#6063</a>)</li>
<li>Fix a bug which caused SAML attribute maps to be overridden by defaults. (<a href="https://github.com/matrix-org/synapse/issues/6069">#6069</a>)</li>
<li>Fix the logged number of updated items for the <code>users_set_deactivated_flag</code> background update. (<a href="https://github.com/matrix-org/synapse/issues/6092">#6092</a>)</li>
<li>Add <code>sid</code> to <code>next_link</code> for email validation. (<a href="https://github.com/matrix-org/synapse/issues/6097">#6097</a>)</li>
<li>Threepid validity checks on msisdns should not be dependent on <code>threepid_behaviour_email</code>. (<a href="https://github.com/matrix-org/synapse/issues/6104">#6104</a>)</li>
<li>Ensure that servers which are not configured to support email address verification do not offer it in the registration flows. (<a href="https://github.com/matrix-org/synapse/issues/6107">#6107</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Avoid changing <code>UID/GID</code> if they are already correct. (<a href="https://github.com/matrix-org/synapse/issues/5970">#5970</a>)</li>
<li>Provide <code>SYNAPSE_WORKER</code> envvar to specify python module. (<a href="https://github.com/matrix-org/synapse/issues/6058">#6058</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Convert documentation to markdown (from rst) (<a href="https://github.com/matrix-org/synapse/issues/5849">#5849</a>)</li>
<li>Update <code>INSTALL.md</code> to say that Python 2 is no longer supported. (<a href="https://github.com/matrix-org/synapse/issues/5953">#5953</a>)</li>
<li>Add developer documentation for using SAML2. (<a href="https://github.com/matrix-org/synapse/issues/6032">#6032</a>)</li>
<li>Add some notes on rolling back to v1.3.1. (<a href="https://github.com/matrix-org/synapse/issues/6049">#6049</a>)</li>
<li>Update the upgrade notes. (<a href="https://github.com/matrix-org/synapse/issues/6050">#6050</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove shared-secret registration from <code>/_matrix/client/r0/register</code> endpoint. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/5877">#5877</a>)</li>
<li>Deprecate the <code>trusted_third_party_id_servers</code> option. (<a href="https://github.com/matrix-org/synapse/issues/5875">#5875</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Lay the groundwork for structured logging output. (<a href="https://github.com/matrix-org/synapse/issues/5680">#5680</a>)</li>
<li>Retry well-known lookup before the cache expires, giving a grace period where the remote well-known can be down but we still use the old result. (<a href="https://github.com/matrix-org/synapse/issues/5844">#5844</a>)</li>
<li>Remove log line for debugging issue #5407. (<a href="https://github.com/matrix-org/synapse/issues/5860">#5860</a>)</li>
<li>Refactor the Appservice scheduler code. (<a href="https://github.com/matrix-org/synapse/issues/5886">#5886</a>)</li>
<li>Compatibility with v2 Identity Service APIs other than /lookup. (<a href="https://github.com/matrix-org/synapse/issues/5892">#5892</a>, <a href="https://github.com/matrix-org/synapse/issues/6013">#6013</a>)</li>
<li>Stop populating some unused tables. (<a href="https://github.com/matrix-org/synapse/issues/5893">#5893</a>, <a href="https://github.com/matrix-org/synapse/issues/6047">#6047</a>)</li>
<li>Add missing index on <code>users_in_public_rooms</code> to improve the performance of directory queries. (<a href="https://github.com/matrix-org/synapse/issues/5894">#5894</a>)</li>
<li>Improve the logging when we have an error when fetching signing keys. (<a href="https://github.com/matrix-org/synapse/issues/5896">#5896</a>)</li>
<li>Add support for database engine-specific schema deltas, based on file extension. (<a href="https://github.com/matrix-org/synapse/issues/5911">#5911</a>)</li>
<li>Update Buildkite pipeline to use plugins instead of buildkite-agent commands. (<a href="https://github.com/matrix-org/synapse/issues/5922">#5922</a>)</li>
<li>Add link in sample config to the logging config schema. (<a href="https://github.com/matrix-org/synapse/issues/5926">#5926</a>)</li>
<li>Remove unnecessary parentheses in return statements. (<a href="https://github.com/matrix-org/synapse/issues/5931">#5931</a>)</li>
<li>Remove unused <code>jenkins/prepare_sytest.sh</code> file. (<a href="https://github.com/matrix-org/synapse/issues/5938">#5938</a>)</li>
<li>Move Buildkite pipeline config to the pipelines repo. (<a href="https://github.com/matrix-org/synapse/issues/5943">#5943</a>)</li>
<li>Remove unnecessary return statements in the codebase which were the result of a regex run. (<a href="https://github.com/matrix-org/synapse/issues/5962">#5962</a>)</li>
<li>Remove left-over methods from v1 registration API. (<a href="https://github.com/matrix-org/synapse/issues/5963">#5963</a>)</li>
<li>Cleanup event auth type initialisation. (<a href="https://github.com/matrix-org/synapse/issues/5975">#5975</a>)</li>
<li>Clean up dependency checking at setup. (<a href="https://github.com/matrix-org/synapse/issues/5989">#5989</a>)</li>
<li>Update OpenTracing docs to use the unified <code>trace</code> method. (<a href="https://github.com/matrix-org/synapse/issues/5776">#5776</a>)</li>
<li>Small refactor of function arguments and docstrings in<code> RoomMemberHandler</code>. (<a href="https://github.com/matrix-org/synapse/issues/6009">#6009</a>)</li>
<li>Remove unused <code>origin</code> argument on <code>FederationHandler.add_display_name_to_third_party_invite</code>. (<a href="https://github.com/matrix-org/synapse/issues/6010">#6010</a>)</li>
<li>Add a <code>failure_ts</code> column to the <code>destinations</code> database table. (<a href="https://github.com/matrix-org/synapse/issues/6016">#6016</a>, <a href="https://github.com/matrix-org/synapse/issues/6072">#6072</a>)</li>
<li>Clean up some code in the retry logic. (<a href="https://github.com/matrix-org/synapse/issues/6017">#6017</a>)</li>
<li>Fix the structured logging tests stomping on the global log configuration for subsequent tests. (<a href="https://github.com/matrix-org/synapse/issues/6023">#6023</a>)</li>
<li>Clean up the sample config for SAML authentication. (<a href="https://github.com/matrix-org/synapse/issues/6064">#6064</a>)</li>
<li>Change mailer logging to reflect Synapse doesn't just do chat notifications by email now. (<a href="https://github.com/matrix-org/synapse/issues/6075">#6075</a>)</li>
<li>Move last-seen info into devices table. (<a href="https://github.com/matrix-org/synapse/issues/6089">#6089</a>)</li>
<li>Remove unused parameter to <code>get_user_id_by_threepid</code>. (<a href="https://github.com/matrix-org/synapse/issues/6099">#6099</a>)</li>
<li>Refactor the user-interactive auth handling. (<a href="https://github.com/matrix-org/synapse/issues/6105">#6105</a>)</li>
<li>Refactor code for calculating registration flows. (<a href="https://github.com/matrix-org/synapse/issues/6106">#6106</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;08&#x2F;17&#x2F;synapse-1-3-1-released&#x2F;" title="Synapse 1.3.1 released">Synapse 1.3.1 released</a></h2>
                <span>
                    17.08.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Some of you will have been bitten by a bug that <a href="https://github.com/matrix-org/synapse/issues/5866">prevented Synapse 1.3.0 from starting up correctly</a>. If this is you, please upgrade.</p>
<p>Additionally we have taken the opportunity to fix a <a href="https://github.com/matrix-org/synapse/issues/5865">dependency bug</a> for our intrepid packagers.</p>
<p>Apologies for the inconvenience.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.3.1">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.3.0 follows:</p>
<h1 id="synapse-1-3-1-2019-08-17">Synapse 1.3.1 (2019-08-17)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Drop hard dependency on <code>sdnotify</code> python package. (<a href="https://github.com/matrix-org/synapse/issues/5871">#5871</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix startup issue (hang on ACME provisioning) due to ordering of Twisted reactor startup. Thanks to @chrismoos for supplying the fix. (<a href="https://github.com/matrix-org/synapse/issues/5867">#5867</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;08&#x2F;15&#x2F;synapse-1-3-0-released&#x2F;" title="Synapse 1.3.0 released">Synapse 1.3.0 released</a></h2>
                <span>
                    15.08.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Well now, Synapse 1.3.0 is here.</p>
<p>The main thing to know about 1.3.0 is that is contains performance improvements to reduce disk I/O and reduce RAM usage. We’ve been running it on matrix.org for a week or so and are really pleased with the results.</p>
<p>Check out our message send heat map.</p>
<p><img src="/blog/img/2019-08-15-message-send.png" alt="Message Send" /></p>
<p>Other than that there are a bunch of bug fixes and tweaks to generally make things run more smoothly.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.3.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.2.1 follows:</p>
<h1 id="synapse-1-3-0-2019-08-15">Synapse 1.3.0 (2019-08-15)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix 500 Internal Server Error on <code>publicRooms</code> when the public room list was
cached. (<a href="https://github.com/matrix-org/synapse/issues/5851">#5851</a>)</li>
</ul>
<h1 id="synapse-1-3-0rc1-2019-08-13">Synapse 1.3.0rc1 (2019-08-13)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Use <code>M_USER_DEACTIVATED</code> instead of <code>M_UNKNOWN</code> for errcode when a deactivated user attempts to login. (<a href="https://github.com/matrix-org/synapse/issues/5686">#5686</a>)</li>
<li>Add sd_notify hooks to ease systemd integration and allows usage of Type=Notify. (<a href="https://github.com/matrix-org/synapse/issues/5732">#5732</a>)</li>
<li>Synapse will no longer serve any media repo admin endpoints when <code>enable_media_repo</code> is set to False in the configuration. If a media repo worker is used, the admin APIs relating to the media repo will be served from it instead. (<a href="https://github.com/matrix-org/synapse/issues/5754">#5754</a>, <a href="https://github.com/matrix-org/synapse/issues/5848">#5848</a>)</li>
<li>Synapse can now be configured to not join remote rooms of a given &quot;complexity&quot; (currently, state events) over federation. This option can be used to prevent adverse performance on resource-constrained homeservers. (<a href="https://github.com/matrix-org/synapse/issues/5783">#5783</a>)</li>
<li>Allow defining HTML templates to serve the user on account renewal attempt when using the account validity feature. (<a href="https://github.com/matrix-org/synapse/issues/5807">#5807</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix UISIs during homeserver outage. (<a href="https://github.com/matrix-org/synapse/issues/5693">#5693</a>, <a href="https://github.com/matrix-org/synapse/issues/5789">#5789</a>)</li>
<li>Fix stack overflow in server key lookup code. (<a href="https://github.com/matrix-org/synapse/issues/5724">#5724</a>)</li>
<li>start.sh no longer uses deprecated cli option. (<a href="https://github.com/matrix-org/synapse/issues/5725">#5725</a>)</li>
<li>Log when we receive an event receipt from an unexpected origin. (<a href="https://github.com/matrix-org/synapse/issues/5743">#5743</a>)</li>
<li>Fix debian packaging scripts to correctly build sid packages. (<a href="https://github.com/matrix-org/synapse/issues/5775">#5775</a>)</li>
<li>Correctly handle redactions of redactions. (<a href="https://github.com/matrix-org/synapse/issues/5788">#5788</a>)</li>
<li>Return 404 instead of 403 when accessing /rooms/{roomId}/event/{eventId} for an event without the appropriate permissions. (<a href="https://github.com/matrix-org/synapse/issues/5798">#5798</a>)</li>
<li>Fix check that tombstone is a state event in push rules. (<a href="https://github.com/matrix-org/synapse/issues/5804">#5804</a>)</li>
<li>Fix error when trying to login as a deactivated user when using a worker to handle login. (<a href="https://github.com/matrix-org/synapse/issues/5806">#5806</a>)</li>
<li>Fix bug where user <code>/sync</code> stream could get wedged in rare circumstances. (<a href="https://github.com/matrix-org/synapse/issues/5825">#5825</a>)</li>
<li>The purge_remote_media.sh script was fixed. (<a href="https://github.com/matrix-org/synapse/issues/5839">#5839</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Synapse now no longer accepts the <code>-v</code>/<code>--verbose</code>, <code>-f</code>/<code>--log-file</code>, or <code>--log-config</code> command line flags, and removes the deprecated <code>verbose</code> and <code>log_file</code> configuration file options. Users of these options should migrate their options into the dedicated log configuration. (<a href="https://github.com/matrix-org/synapse/issues/5678">#5678</a>, <a href="https://github.com/matrix-org/synapse/issues/5729">#5729</a>)</li>
<li>Remove non-functional 'expire_access_token' setting. (<a href="https://github.com/matrix-org/synapse/issues/5782">#5782</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Make Jaeger fully configurable. (<a href="https://github.com/matrix-org/synapse/issues/5694">#5694</a>)</li>
<li>Add precautionary measures to prevent future abuse of <code>window.opener</code> in default welcome page. (<a href="https://github.com/matrix-org/synapse/issues/5695">#5695</a>)</li>
<li>Reduce database IO usage by optimising queries for current membership. (<a href="https://github.com/matrix-org/synapse/issues/5706">#5706</a>, <a href="https://github.com/matrix-org/synapse/issues/5738">#5738</a>, <a href="https://github.com/matrix-org/synapse/issues/5746">#5746</a>, <a href="https://github.com/matrix-org/synapse/issues/5752">#5752</a>, <a href="https://github.com/matrix-org/synapse/issues/5770">#5770</a>, <a href="https://github.com/matrix-org/synapse/issues/5774">#5774</a>, <a href="https://github.com/matrix-org/synapse/issues/5792">#5792</a>, <a href="https://github.com/matrix-org/synapse/issues/5793">#5793</a>)</li>
<li>Improve caching when fetching <code>get_filtered_current_state_ids</code>. (<a href="https://github.com/matrix-org/synapse/issues/5713">#5713</a>)</li>
<li>Don't accept opentracing data from clients. (<a href="https://github.com/matrix-org/synapse/issues/5715">#5715</a>)</li>
<li>Speed up PostgreSQL unit tests in CI. (<a href="https://github.com/matrix-org/synapse/issues/5717">#5717</a>)</li>
<li>Update the coding style document. (<a href="https://github.com/matrix-org/synapse/issues/5719">#5719</a>)</li>
<li>Improve database query performance when recording retry intervals for remote hosts. (<a href="https://github.com/matrix-org/synapse/issues/5720">#5720</a>)</li>
<li>Add a set of opentracing utils. (<a href="https://github.com/matrix-org/synapse/issues/5722">#5722</a>)</li>
<li>Cache result of get_version_string to reduce overhead of <code>/version</code> federation requests. (<a href="https://github.com/matrix-org/synapse/issues/5730">#5730</a>)</li>
<li>Return 'user_type' in admin API user endpoints results. (<a href="https://github.com/matrix-org/synapse/issues/5731">#5731</a>)</li>
<li>Don't package the sytest test blacklist file. (<a href="https://github.com/matrix-org/synapse/issues/5733">#5733</a>)</li>
<li>Replace uses of returnValue with plain return, as returnValue is not needed on Python 3. (<a href="https://github.com/matrix-org/synapse/issues/5736">#5736</a>)</li>
<li>Blacklist some flakey tests in worker mode. (<a href="https://github.com/matrix-org/synapse/issues/5740">#5740</a>)</li>
<li>Fix some error cases in the caching layer. (<a href="https://github.com/matrix-org/synapse/issues/5749">#5749</a>)</li>
<li>Add a prometheus metric for pending cache lookups. (<a href="https://github.com/matrix-org/synapse/issues/5750">#5750</a>)</li>
<li>Stop trying to fetch events with event_id=None. (<a href="https://github.com/matrix-org/synapse/issues/5753">#5753</a>)</li>
<li>Convert RedactionTestCase to modern test style. (<a href="https://github.com/matrix-org/synapse/issues/5768">#5768</a>)</li>
<li>Allow looping calls to be given arguments. (<a href="https://github.com/matrix-org/synapse/issues/5780">#5780</a>)</li>
<li>Set the logs emitted when checking typing and presence timeouts to DEBUG level, not INFO. (<a href="https://github.com/matrix-org/synapse/issues/5785">#5785</a>)</li>
<li>Remove DelayedCall debugging from the test suite, as it is no longer required in the vast majority of Synapse's tests. (<a href="https://github.com/matrix-org/synapse/issues/5787">#5787</a>)</li>
<li>Remove some spurious exceptions from the logs where we failed to talk to a remote server. (<a href="https://github.com/matrix-org/synapse/issues/5790">#5790</a>)</li>
<li>Improve performance when making <code>.well-known</code> requests by sharing the SSL options between requests. (<a href="https://github.com/matrix-org/synapse/issues/5794">#5794</a>)</li>
<li>Disable codecov GitHub comments on PRs. (<a href="https://github.com/matrix-org/synapse/issues/5796">#5796</a>)</li>
<li>Don't allow clients to send tombstone events that reference the room it's sent in. (<a href="https://github.com/matrix-org/synapse/issues/5801">#5801</a>)</li>
<li>Deny redactions of events sent in a different room. (<a href="https://github.com/matrix-org/synapse/issues/5802">#5802</a>)</li>
<li>Deny sending well known state types as non-state events. (<a href="https://github.com/matrix-org/synapse/issues/5805">#5805</a>)</li>
<li>Handle incorrectly encoded query params correctly by returning a 400. (<a href="https://github.com/matrix-org/synapse/issues/5808">#5808</a>)</li>
<li>Handle pusher being deleted during processing rather than logging an exception. (<a href="https://github.com/matrix-org/synapse/issues/5809">#5809</a>)</li>
<li>Return 502 not 500 when failing to reach any remote server. (<a href="https://github.com/matrix-org/synapse/issues/5810">#5810</a>)</li>
<li>Reduce global pauses in the events stream caused by expensive state resolution during persistence. (<a href="https://github.com/matrix-org/synapse/issues/5826">#5826</a>)</li>
<li>Add a lower bound to well-known lookup cache time to avoid repeated lookups. (<a href="https://github.com/matrix-org/synapse/issues/5836">#5836</a>)</li>
<li>Whitelist history visbility sytests in worker mode tests. (<a href="https://github.com/matrix-org/synapse/issues/5843">#5843</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;26&#x2F;critical-security-update-synapse-1-2-1-released&#x2F;" title="Critical Security Update - Synapse 1.2.1 released">Critical Security Update - Synapse 1.2.1 released</a></h2>
                <span>
                    26.07.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Today we release Synapse 1.2.1 as a critical security update. It contains patches relating to redactions and event federation. The patches address long standing bugs, and are not regressions specific to the previous version (1.2).  <strong>All admins, regardless of current version, should upgrade asap</strong>.</p>
<p>This release includes <em>four</em> security fixes:</p>
<ul>
<li>Prevent an attack where a federated server could send redactions for arbitrary events in v1 and v2 rooms. (<a href="https://github.com/matrix-org/synapse/issues/5767">#5767</a>)</li>
<li>Prevent a denial-of-service attack where cycles of redaction events would make Synapse spin infinitely. Thanks to <code>@lrizika:matrix.org</code> for identifying and responsibly disclosing this issue. (<a href="https://github.com/matrix-org/synapse/commit/0f2ecb961">0f2ecb961</a>)</li>
<li>Prevent an attack where users could be joined or parted from public rooms without their consent. Thanks to <a href="https://github.com/dylangerdaly">Dylanger</a> for identifying and responsibly disclosing this issue. (<a href="https://github.com/matrix-org/synapse/issues/5744">#5744</a>)</li>
<li>Fix a vulnerability where a federated server could spoof read-receipts from
users on other servers. Thanks to <a href="https://github.com/dylangerdaly">Dylanger</a> for identifying this issue too. (<a href="https://github.com/matrix-org/synapse/issues/5743">#5743</a>)</li>
</ul>
<p>Additionally, the following fix was in Synapse <strong>1.2.0</strong>, but was not correctly
identified during the original release:</p>
<ul>
<li>It was possible for a room moderator to send a redaction for an <code>m.room.create</code> event, which would downgrade the room to version 1. Thanks to <code>@/dev/ponies:ponies.im</code> for identifying and responsibly disclosing this issue! (<a href="https://github.com/matrix-org/synapse/issues/5701">#5701</a>)</li>
</ul>
<p>You can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.2.1">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Alternatively check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>Thanks for bearing with us.</p>

                
            </div>
        </article>
        
        <nav class="pagination">
    <div class="prev">
        
        <a href="&#x2F;category&#x2F;releases&#x2F;page&#x2F;10&#x2F;">‹ Previous</a>
        
    </div>
    <span class="page-number">11 / 15</span>
    <div class="prev">
        
        <a href="&#x2F;category&#x2F;releases&#x2F;page&#x2F;12&#x2F;">Next ›</a>
        
    </div>
</nav>

    </div>
</div>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p><a href="/legal/copyright-notice">Copyright Notice</a></p>
</footer>

</body>

</html>
