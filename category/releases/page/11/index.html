<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Releases</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="stylesheet" href="/style.css" />

    
<link rel="alternate" type="application/rss+xml" title="RSS" href="/category/releases/atom.xml">
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        <a href="&#x2F;docs&#x2F;" class="
            ">
            Documentation
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="ecosystem-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true"
                >
            <label for="ecosystem-submenu-checkbox" class="submenu-title">Ecosystem <div class="arrow">
                </div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<div id="taxonomy-single">
    <div class="content">
        <header>
            <h1>Releases</h1>
            138 posts tagged with "Releases" <a href="/category">(See all Category)</a>
            
            <h2>
                <small><a href="/category/releases/atom.xml">Atom Feed</a></small>
            </h2>
            
        </header>

        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;29&#x2F;synapse-1-5-0-released&#x2F;" title="Synapse 1.5.0 released">Synapse 1.5.0 released</a></h2>
                <span>
                    29.10.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>That's right folks Synapse 1.5.0 is here and ready to make your life just a little bit better.</p>
<p>First things first, this release includes a security fix (<a href="https://github.com/matrix-org/synapse/issues/6262">#6262</a>, below). Administrators are encouraged to upgrade as soon as possible.</p>
<p>Aside from that, the main thing you'll notice in 1.5.0 is a massive performance improvement to the room directory, which means that servers with large directories to scan will return much more quickly. This is especially true for matrix.org but all servers will benefit.</p>
<p>Another key win is finally fixing some bugs in the sqlite -&gt; postgres migrator script. Sqlite mode is there strictly for testing purposes and should never be used in a production setting let alone a federating homeserver. So if you are currently using Sqlite now is the time to migrate. What's more the script is now in CI so it can't easily break in the future (with apologies to anyone bitten by the old script...).</p>
<p>A final final point, we have some preparatory work for e2ee cross signing, the overall feature is not ready for release just yet but we are getting really close. Watch this space.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.5.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.4.1 follows:</p>
<h1 id="synapse-1-5-0-2019-10-29">Synapse 1.5.0 (2019-10-29)</h1>
<h2 id="security-updates">Security updates</h2>
<p>This release includes a security fix (<a href="https://github.com/matrix-org/synapse/issues/6262">#6262</a>, below). Administrators are encouraged to upgrade as soon as possible.</p>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where room directory search was case sensitive. (<a href="https://github.com/matrix-org/synapse/issues/6268">#6268</a>)</li>
</ul>
<h1 id="synapse-1-5-0rc2-2019-10-28">Synapse 1.5.0rc2 (2019-10-28)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Update list of boolean columns in <code>synapse_port_db</code>. (<a href="https://github.com/matrix-org/synapse/issues/6247">#6247</a>)</li>
<li>Fix /keys/query API on workers. (<a href="https://github.com/matrix-org/synapse/issues/6256">#6256</a>)</li>
<li>Improve signature checking on some federation APIs. (<a href="https://github.com/matrix-org/synapse/issues/6262">#6262</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Move schema delta files to the correct data store. (<a href="https://github.com/matrix-org/synapse/issues/6248">#6248</a>)</li>
<li>Small performance improvement by removing repeated config lookups in room stats calculation. (<a href="https://github.com/matrix-org/synapse/issues/6255">#6255</a>)</li>
</ul>
<h1 id="synapse-1-5-0rc1-2019-10-24">Synapse 1.5.0rc1 (2019-10-24)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Improve quality of thumbnails for 1-bit/8-bit color palette images. (<a href="https://github.com/matrix-org/synapse/issues/2142">#2142</a>)</li>
<li>Add ability to upload cross-signing signatures. (<a href="https://github.com/matrix-org/synapse/issues/5726">#5726</a>)</li>
<li>Allow uploading of cross-signing keys. (<a href="https://github.com/matrix-org/synapse/issues/5769">#5769</a>)</li>
<li>CAS login now provides a default display name for users if a <code>displayname_attribute</code> is set in the configuration file. (<a href="https://github.com/matrix-org/synapse/issues/6114">#6114</a>)</li>
<li>Reject all pending invites for a user during deactivation. (<a href="https://github.com/matrix-org/synapse/issues/6125">#6125</a>)</li>
<li>Add config option to suppress client side resource limit alerting. (<a href="https://github.com/matrix-org/synapse/issues/6173">#6173</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Return an HTTP 404 instead of 400 when requesting a filter by ID that is unknown to the server. Thanks to @krombel for contributing this! (<a href="https://github.com/matrix-org/synapse/issues/2380">#2380</a>)</li>
<li>Fix a bug where users could be invited twice to the same group. (<a href="https://github.com/matrix-org/synapse/issues/3436">#3436</a>)</li>
<li>Fix <code>/createRoom</code> failing with badly-formatted MXIDs in the invitee list. Thanks to @wener291! (<a href="https://github.com/matrix-org/synapse/issues/4088">#4088</a>)</li>
<li>Make the <code>synapse_port_db</code> script create the right indexes on a new PostgreSQL database. (<a href="https://github.com/matrix-org/synapse/issues/6102">#6102</a>, <a href="https://github.com/matrix-org/synapse/issues/6178">#6178</a>, <a href="https://github.com/matrix-org/synapse/issues/6243">#6243</a>)</li>
<li>Fix bug when uploading a large file: Synapse responds with <code>M_UNKNOWN</code> while it should be <code>M_TOO_LARGE</code> according to spec. Contributed by Anshul Angaria. (<a href="https://github.com/matrix-org/synapse/issues/6109">#6109</a>)</li>
<li>Fix user push rules being deleted from a room when it is upgraded. (<a href="https://github.com/matrix-org/synapse/issues/6144">#6144</a>)</li>
<li>Don't 500 when trying to exchange a revoked 3PID invite. (<a href="https://github.com/matrix-org/synapse/issues/6147">#6147</a>)</li>
<li>Fix transferring notifications and tags when joining an upgraded room that is new to your server. (<a href="https://github.com/matrix-org/synapse/issues/6155">#6155</a>)</li>
<li>Fix bug where guest account registration can wedge after restart. (<a href="https://github.com/matrix-org/synapse/issues/6161">#6161</a>)</li>
<li>Fix monthly active user reaping when reserved users are specified. (<a href="https://github.com/matrix-org/synapse/issues/6168">#6168</a>)</li>
<li>Fix <code>/federation/v1/state</code> endpoint not supporting newer room versions. (<a href="https://github.com/matrix-org/synapse/issues/6170">#6170</a>)</li>
<li>Fix bug where we were updating censored events as bytes rather than text, occasionally causing invalid JSON being inserted breaking APIs that attempted to fetch such events. (<a href="https://github.com/matrix-org/synapse/issues/6186">#6186</a>)</li>
<li>Fix occasional missed updates in the room and user directories. (<a href="https://github.com/matrix-org/synapse/issues/6187">#6187</a>)</li>
<li>Fix tracing of non-JSON APIs, <code>/media</code>, <code>/key</code> etc. (<a href="https://github.com/matrix-org/synapse/issues/6195">#6195</a>)</li>
<li>Fix bug where presence would not get timed out correctly if a synchrotron worker is used and restarted. (<a href="https://github.com/matrix-org/synapse/issues/6212">#6212</a>)</li>
<li>synapse_port_db: Add 2 additional BOOLEAN_COLUMNS to be able to convert from database schema v56. (<a href="https://github.com/matrix-org/synapse/issues/6216">#6216</a>)</li>
<li>Fix a bug where the Synapse demo script blacklisted <code>::1</code> (ipv6 localhost) from receiving federation traffic. (<a href="https://github.com/matrix-org/synapse/issues/6229">#6229</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Fix logging getting lost for the docker image. (<a href="https://github.com/matrix-org/synapse/issues/6197">#6197</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Update <code>user_filters</code> table to have a unique index, and non-null columns. Thanks to @pik for contributing this. (<a href="https://github.com/matrix-org/synapse/issues/1172">#1172</a>, <a href="https://github.com/matrix-org/synapse/issues/6175">#6175</a>, <a href="https://github.com/matrix-org/synapse/issues/6184">#6184</a>)</li>
<li>Allow devices to be marked as hidden, for use by features such as cross-signing.
This adds a new field with a default value to the devices field in the database,
and so the database upgrade may take a long time depending on how many devices
are in the database. (<a href="https://github.com/matrix-org/synapse/issues/5759">#5759</a>)</li>
<li>Move lookup-related functions from RoomMemberHandler to IdentityHandler. (<a href="https://github.com/matrix-org/synapse/issues/5978">#5978</a>)</li>
<li>Improve performance of the public room list directory. (<a href="https://github.com/matrix-org/synapse/issues/6019">#6019</a>, <a href="https://github.com/matrix-org/synapse/issues/6152">#6152</a>, <a href="https://github.com/matrix-org/synapse/issues/6153">#6153</a>, <a href="https://github.com/matrix-org/synapse/issues/6154">#6154</a>)</li>
<li>Edit header dicts docstrings in <code>SimpleHttpClient</code> to note that <code>str</code> or <code>bytes</code> can be passed as header keys. (<a href="https://github.com/matrix-org/synapse/issues/6077">#6077</a>)</li>
<li>Add snapcraft packaging information. Contributed by @devec0. (<a href="https://github.com/matrix-org/synapse/issues/6084">#6084</a>, <a href="https://github.com/matrix-org/synapse/issues/6191">#6191</a>)</li>
<li>Kill off half-implemented password-reset via sms. (<a href="https://github.com/matrix-org/synapse/issues/6101">#6101</a>)</li>
<li>Remove <code>get_user_by_req</code> opentracing span and add some tags. (<a href="https://github.com/matrix-org/synapse/issues/6108">#6108</a>)</li>
<li>Drop some unused database tables. (<a href="https://github.com/matrix-org/synapse/issues/6115">#6115</a>)</li>
<li>Add env var to turn on tracking of log context changes. (<a href="https://github.com/matrix-org/synapse/issues/6127">#6127</a>)</li>
<li>Refactor configuration loading to allow better typechecking. (<a href="https://github.com/matrix-org/synapse/issues/6137">#6137</a>)</li>
<li>Log responder when responding to media request. (<a href="https://github.com/matrix-org/synapse/issues/6139">#6139</a>)</li>
<li>Improve performance of <code>find_next_generated_user_id</code> DB query. (<a href="https://github.com/matrix-org/synapse/issues/6148">#6148</a>)</li>
<li>Expand type-checking on modules imported by <code>synapse.config</code>. (<a href="https://github.com/matrix-org/synapse/issues/6150">#6150</a>)</li>
<li>Use Postgres ANY for selecting many values. (<a href="https://github.com/matrix-org/synapse/issues/6156">#6156</a>)</li>
<li>Add more caching to <code>_get_joined_users_from_context</code> DB query. (<a href="https://github.com/matrix-org/synapse/issues/6159">#6159</a>)</li>
<li>Add some metrics on the federation sender. (<a href="https://github.com/matrix-org/synapse/issues/6160">#6160</a>)</li>
<li>Add some logging to the rooms stats updates, to try to track down a flaky test. (<a href="https://github.com/matrix-org/synapse/issues/6167">#6167</a>)</li>
<li>Remove unused <code>timeout</code> parameter from <code>_get_public_room_list</code>. (<a href="https://github.com/matrix-org/synapse/issues/6179">#6179</a>)</li>
<li>Reject (accidental) attempts to insert bytes into postgres tables. (<a href="https://github.com/matrix-org/synapse/issues/6186">#6186</a>)</li>
<li>Make <code>version</code> optional in body of <code>PUT /room_keys/version/{version}</code>, since it's redundant. (<a href="https://github.com/matrix-org/synapse/issues/6189">#6189</a>)</li>
<li>Make storage layer responsible for adding device names to key, rather than the handler. (<a href="https://github.com/matrix-org/synapse/issues/6193">#6193</a>)</li>
<li>Port <code>synapse.rest.admin</code> module to use async/await. (<a href="https://github.com/matrix-org/synapse/issues/6196">#6196</a>)</li>
<li>Enforce that all boolean configuration values are lowercase in CI. (<a href="https://github.com/matrix-org/synapse/issues/6203">#6203</a>)</li>
<li>Remove some unused event-auth code. (<a href="https://github.com/matrix-org/synapse/issues/6214">#6214</a>)</li>
<li>Remove <code>Auth.check</code> method. (<a href="https://github.com/matrix-org/synapse/issues/6217">#6217</a>)</li>
<li>Remove <code>format_tap.py</code> script in favour of a perl reimplementation in Sytest's repo. (<a href="https://github.com/matrix-org/synapse/issues/6219">#6219</a>)</li>
<li>Refactor storage layer in preparation to support having multiple databases. (<a href="https://github.com/matrix-org/synapse/issues/6231">#6231</a>)</li>
<li>Remove some extra quotation marks across the codebase. (<a href="https://github.com/matrix-org/synapse/issues/6236">#6236</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;18&#x2F;synapse-1-4-1-released&#x2F;" title="Synapse 1.4.1 released">Synapse 1.4.1 released</a></h2>
                <span>
                    18.10.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>We've released Synapse 1.4.1 as a small but important bugfix to 1.4.0.</p>
<p>This fixes a regression which crept in with our newly implemented &quot;erase redacted data after N days&quot; feature where some APIs
would fail when hitting erased redactions - anyone on Synapse 1.4.0 will want to upgrade asap.</p>
<p>As always, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.4.1">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.4.0 follows:</p>
<h1 id="synapse-1-4-1-2019-10-18">Synapse 1.4.1 (2019-10-18)</h1>
<p>No changes since 1.4.1rc1.</p>
<h1 id="synapse-1-4-1rc1-2019-10-17">Synapse 1.4.1rc1 (2019-10-17)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where redacted events were sometimes incorrectly censored in the database, breaking APIs that attempted to fetch such events. (<a href="https://github.com/matrix-org/synapse/issues/6185">#6185</a>, <a href="https://github.com/matrix-org/synapse/commit/5b0e9948eaae801643e594b5abc8ee4b10bd194e">5b0e9948</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;03&#x2F;matrix-appservice-slack-bridge-1-0-is-here&#x2F;" title="matrix-appservice-slack bridge 1.0 is here!">matrix-appservice-slack bridge 1.0 is here!</a></h2>
                <span>
                    03.10.2019 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/half-shot">
                        Half-Shot
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hello Matrix enthusiasts! Yesterday we released <a href="https://github.com/matrix-org/matrix-appservice-slack/releases/tag/1.0.0">matrix-appservice-slack 1.0</a>. This marks a major milestone
in bridge development for the Matrix.org team, being our first bridge to ever reach 1.0. The decision to
release this version came after we decided that the bridge had gained enough features and reached a point
of stability where it could be deployed in the wild with minimal risk.</p>
<p>For those not in the know, the Slack bridge is Node.JS based, and bridges slack channels &amp; users into Matrix
seamlessly. And for those wondering, yes it works with Mattermost too (since their API is compatible with Slack)!
In previous versions only a limited subset of features were supported, making heavy usage of Slack’s
webhook API. As of 1.0, the bridge now makes use of the newer Slack Events/RTM API which gives us all we need for
a richer bridging experience. Everything from edits and reactions to typing notifications is supported in the 1.0 release.</p>
<p>Finally for those who are self hosting, we are pleased to offer the ability to &quot;puppet&quot; your Slack account using the
bridge. Puppeting is the process in which the bridge will send messages as if you were sending them from the Slack client
directly, when you talk using your Matrix account. This opens the door to seamless bridging and direct messaging support.</p>
<p>For those wishing to bridge their whole workspace across, <a href="https://github.com/SolarDrew/skill-picard">picard</a> exists
as a tool to manage large scale Slack bridge deployments. This tool is provided by <a href="https://matrix.to/#/@Cadair:matrix.org">Cadair</a> and <a href="https://matrix.to/#/@SolarDrew:matrix.org">SolarDrew</a></p>
<p><img src="/blog/img/2019-10-03-slack1.0-threading.png" alt="Slack Screenshot" />
Threading &amp; Reactions!</p>
<p>The bridge has undergone some pretty serious code surgery as well. The whole codebase has been rewritten in
TypeScript to take advantage of type checking and generic types. The bridge is currently based upon the
<a href="https://github.com/matrix-org/matrix-appservice-bridge/">matrix-appservice-bridge</a> library. The datastore interface now supports PostgreSQL, which allows for administrators to inspect and edit the database while the bridge is running, as well as offering  helpful performance boost over the NeDB datastore format that was used previously. Finally, the codebase has proper Unit and Integration Tests to ensure new changes will not cause any regressions in behaviour. In short, <strong>now is an excellent time to get involved and hack on the bridge</strong>. There is already a <a href="https://github.com/matrix-org/matrix-appservice-slack/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22">crafted list of easy issues</a> for new and experienced bridge devs.</p>
<p><img src="/blog/img/2019-10-03-slack1.0-perfmem.png" alt="Grafana memory usage graph" />
Memory usage of the bridge comparison</p>
<p><img src="/blog/img/2019-10-03-slack1.0-perfcpu.png" alt="Grafana CPU usage graph" />
CPU usage of the bridge comparison</p>
<p>In terms of how many users matrix.org is currently serving at the moment, we present to you some figures:</p>
<ul>
<li>2562 bridged rooms</li>
<li>764 teams connected to the bridge</li>
<li>103711 events have passed through the bridge since the launch of 0.3.2</li>
</ul>
<p>Of course, our work doesn’t stop at 1.0. The plan for the immediate future of the bridge
is to continue adding support for other event types coming from Matrix and Slack to create
an ever richer experience. Obvious features are things like topic changes, and syncing membership
across the bridge. In the long term future we would also like to add community support to the bridge,
so whole Slack workspaces can be bridged across with a single click.</p>
<p>That’s all from me, and I would like to say a massive thank you to <a href="https://matrix.to/#/@Cadair:matrix.org">Cadair</a>
and <a href="https://matrix.to/#/@benpa:matrix.org">Ben</a> for both their code and review work on the project and as always,
thank you to the community for using the bridge and reporting issues. 🙂</p>
<p>Useful links:</p>
<ul>
<li><a href="https://matrix.to/#/#matrix_appservice_slack:matrix.org">Matrix Room</a></li>
<li><a href="https://github.com/matrix-org/matrix-appservice-slack">Project Home</a></li>
<li><a href="https://matrix-appservice-slack.readthedocs.io/en/stable/">Docs</a></li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;03&#x2F;synapse-1-4-0-released&#x2F;" title="Synapse 1.4.0 released">Synapse 1.4.0 released</a></h2>
                <span>
                    03.10.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Wheyhey as I live and breathe 1.4.0 is here!</p>
<p>1.4.0 should be considered ‘The Privacy Release’ and is the cumulation of a huge body of work spanning multiple projects to improve data privacy in the matrix ecosystem. You can read more about the <a href="https://matrix.org/blog/2019/09/27/privacy-improvements-in-synapse-1-4-and-riot-1-4">full project here</a>.</p>
<p>While we consider 1.4.0 to be a huge leap forward in terms of data privacy, it is really important to note that it contains breaking changes.</p>
<ul>
<li>If you currently rely on email or SMS delivery via an identity server you must modify your Synapse configuration.</li>
<li>If you have configured custom templates, then eight new templates must be added to your templates directory.</li>
</ul>
<p>If either apply to you failure to act will break your installation. Full details can be found in the <a href="https://github.com/matrix-org/synapse/blob/master/UPGRADE.rst#upgrading-to-v140">upgrade notes</a>.</p>
<h2 id="so-what-has-changed">So what has changed?</h2>
<p>It is possible for a user to associate an email address or phone number with their account, for a number of reasons:</p>
<ul>
<li>For use when logging in, as an alternative to the user id.</li>
<li>In the case of email, as an alternative contact to help with account recovery.</li>
<li>In the case of email, to receive notifications of missed messages.</li>
</ul>
<p>Before an email address or phone number can be added to a user's account, or before such an address is used to carry out a password-reset, Synapse must confirm the operation with the owner of the email address or phone number. It does this by sending an email or text giving the user a link or token to confirm receipt. This process is known as '3pid verification'. ('3pid', or 'threepid', stands for third-party identifier, and we use it to refer to external identifiers such as email addresses and phone numbers.)</p>
<p>Previous versions of Synapse delegated the task of 3pid verification to an identity server by default. In most cases this server is vector.im or matrix.org.</p>
<p>In Synapse 1.4.0, for security and privacy reasons, the homeserver will no longer delegate this task to an identity server by default. Instead, the server administrator will need to explicitly decide how they would like the verification messages to be sent.</p>
<p>In the medium term, the vector.im and matrix.org identity servers will disable support for delegated 3pid verification entirely. However, in order to ease the transition, they will retain the capability for a limited period. Delegated email verification will be disabled on Monday 2nd December 2019 (giving roughly 2 months notice). Disabling delegated SMS verification will follow some time after that once SMS verification support lands in Synapse.</p>
<p>Once delegated 3pid verification support has been disabled in the vector.im and matrix.org identity servers, all Synapse versions that depend on those instances will be unable to verify email and phone numbers through them. There are no imminent plans to remove delegated 3pid verification from Sydent generally. (Sydent is the identity server project that backs the vector.im and matrix.org instances).</p>
<h2 id="why-is-this-necessary">Why is this necessary?</h2>
<p>Prior to 1.4.0, the identity server was providing two related-but-separate functions:</p>
<p>a directory for users to publish their contact details and to look up their contacts by their email addresses and phone numbers.
a &quot;trusted third party communications network delegate&quot;, providing SMS- and email-sending functionality to all homeservers for registration and password reset.</p>
<p>The intention behind the identity server's providing 2. was one of convenience: to save homeserver admins the burden of configuring their homeservers to send email, as well as sparing us the effort of writing generic SMS-gateway integration that would allow any homeserver admin to configure their homeserver to send SMS via their chosen SMS aggregator.</p>
<p>By exposing this 'trusted email/sms delegate' functionality, however, and by including references to the New Vector identity servers in the default configuration for both Synapse and Riot, we created a situation in which users on non-New Vector run homeservers (who had never seen our privacy notice) could easily end up sharing their email addresses and phone numbers with a New Vector identity server.</p>
<p>Using identity servers for registration and password reset introduced yet further complexity - since password reset is a sensitive operation, it was important that the homeserver only use 'trusted' identity servers for this purpose (with the trust being configured by the homeserver admin in the homeserver config). But this created ambiguity over who was ultimately responsible for the choice of identity server and when they could make that choice - the client could present a default identity server at login/registration/password reset time, which the user could choose to override before logging in, but unless the identity server ultimately selected were on the homeserver admin's 'trusted identity servers' list, any identity server operations that were proxied via the homeserver would have been blocked by the homeserver. However, not all identity server operations initiated by the client were proxied via the homeserver - some were sent directly from the client to the identity server, and would not have been filtered.</p>
<p>The best way to solve this problem is to have individual homeservers take ownership for their own email and SMS needs. In the case of email this means configuring details of an appropriate SMTP server or continuing to delegate through an identity server that will allow it to do so. If a homeserver admin makes the active choice to use New Vector's identity servers for delegation (up until 1st December), they should make their own users aware through their privacy notice.</p>
<p>This delegation is entirely separate from the user's choice of identity server for user directory services. As of right now the user is free to choose and trust whichever identity server they wish, or to choose not to use an identity server at all.</p>
<h2 id="are-there-any-other-data-privacy-features">Are there any other data privacy features?</h2>
<p>Yes, 1.4.0 now <a href="https://github.com/matrix-org/synapse/issues/1287">automatically garbage collects redacted messages</a> (defaults to 7 days) and removes <a href="https://github.com/matrix-org/synapse/pull/6098/files">unused IP and user agent information</a> stored in the user_ips table (defaults to 30 days). Finally, Synapse now <a href="https://github.com/matrix-org/synapse/pull/6090/files">warns in its logs</a> if you are using matrix.org as a trusted key server, in case you wish to use a different server to help discover other servers’ keys.</p>
<h2 id="anything-else">Anything else?</h2>
<p>Aside from privacy, we’ve expanded our OpenTracing support and fixed a host of bugs. However the thing that is most exciting is switching on our solution for <a href="https://github.com/matrix-org/synapse/issues/5319">mitigating forward extremities build up</a>’ by default.</p>
<p>In some cases rooms can accumulate ‘forward extremities’, which are simply an artefact of attempting to resolve the room state over multiple servers. Forward extremities are necessary to ensure that each server can independently arrive at the same view of the room eventually, however processing these extremities can be <a href="https://github.com/matrix-org/synapse/issues/1760">computationally expensive and degrade server performance overall</a>.</p>
<p>Originally it was an experimental config option but we now feel confident to turn it on by default for all instances - it should make a big difference for the CPU of servers in fragmented rooms.</p>
<p>So that’s it folks, thanks for making it this far. As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.4.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.3.1 follows:</p>
<h1 id="synapse-1-4-0-2019-10-03">Synapse 1.4.0 (2019-10-03)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Redact <code>client_secret</code> in server logs. (<a href="https://github.com/matrix-org/synapse/issues/6158">#6158</a>)</li>
</ul>
<h1 id="synapse-1-4-0rc2-2019-10-02">Synapse 1.4.0rc2 (2019-10-02)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix bug in background update that adds last seen information to the <code>devices</code> table, and improve its performance on Postgres. (<a href="https://github.com/matrix-org/synapse/issues/6135">#6135</a>)</li>
<li>Fix bad performance of censoring redactions background task. (<a href="https://github.com/matrix-org/synapse/issues/6141">#6141</a>)</li>
<li>Fix fetching censored redactions from DB, which caused APIs like initial sync to fail if it tried to include the censored redaction. (<a href="https://github.com/matrix-org/synapse/issues/6145">#6145</a>)</li>
<li>Fix exceptions when storing large retry intervals for down remote servers. (<a href="https://github.com/matrix-org/synapse/issues/6146">#6146</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Fix up sample config entry for <code>redaction_retention_period</code> option. (<a href="https://github.com/matrix-org/synapse/issues/6117">#6117</a>)</li>
</ul>
<h1 id="synapse-1-4-0rc1-2019-09-26">Synapse 1.4.0rc1 (2019-09-26)</h1>
<p>Note that this release includes significant changes around 3pid verification. Administrators are reminded to review the <a href="UPGRADE.rst#upgrading-to-v140">upgrade notes</a>.</p>
<h2 id="features">Features</h2>
<ul>
<li>Changes to 3pid verification:
<ul>
<li>Add the ability to send registration emails from the homeserver rather than delegating to an identity server. (<a href="https://github.com/matrix-org/synapse/issues/5835">#5835</a>, <a href="https://github.com/matrix-org/synapse/issues/5940">#5940</a>, <a href="https://github.com/matrix-org/synapse/issues/5993">#5993</a>, <a href="https://github.com/matrix-org/synapse/issues/5994">#5994</a>, <a href="https://github.com/matrix-org/synapse/issues/5868">#5868</a>)</li>
<li>Replace <code>trust_identity_server_for_password_resets</code> config option with <code>account_threepid_delegates</code>, and make the <code>id_server</code> parameteter optional on <code>*/requestToken</code> endpoints, as per <a href="https://github.com/matrix-org/matrix-doc/pull/2263">MSC2263</a>. (<a href="https://github.com/matrix-org/synapse/issues/5876">#5876</a>, <a href="https://github.com/matrix-org/synapse/issues/5969">#5969</a>, <a href="https://github.com/matrix-org/synapse/issues/6028">#6028</a>)</li>
<li>Switch to using the v2 Identity Service <code>/lookup</code> API where available, with fallback to v1. (Implements <a href="https://github.com/matrix-org/matrix-doc/pull/2134">MSC2134</a> plus <code>id_access_token authentication</code> for v2 Identity Service APIs from <a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a>). (<a href="https://github.com/matrix-org/synapse/issues/5897">#5897</a>)</li>
<li>Remove <code>bind_email</code> and <code>bind_msisdn</code> parameters from <code>/register</code> ala <a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a>. (<a href="https://github.com/matrix-org/synapse/issues/5964">#5964</a>)</li>
<li>Add <code>m.id_access_token</code> to <code>unstable_features</code> in <code>/versions</code> as per <a href="https://github.com/matrix-org/matrix-doc/pull/2264">MSC2264</a>. (<a href="https://github.com/matrix-org/synapse/issues/5974">#5974</a>)</li>
<li>Use the v2 Identity Service API for 3PID invites. (<a href="https://github.com/matrix-org/synapse/issues/5979">#5979</a>)</li>
<li>Add <code>POST /_matrix/client/unstable/account/3pid/unbind</code> endpoint from <a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a> for unbinding a 3PID from an identity server without removing it from the homeserver user account. (<a href="https://github.com/matrix-org/synapse/issues/5980">#5980</a>, <a href="https://github.com/matrix-org/synapse/issues/6062">#6062</a>)</li>
<li>Use <code>account_threepid_delegate.email</code> and <code>account_threepid_delegate.msisdn</code> for validating threepid sessions. (<a href="https://github.com/matrix-org/synapse/issues/6011">#6011</a>)</li>
<li>Allow homeserver to handle or delegate email validation when adding an email to a user's account. (<a href="https://github.com/matrix-org/synapse/issues/6042">#6042</a>)</li>
<li>Implement new Client Server API endpoints <code>/account/3pid/add</code> and <code>/account/3pid/bind</code> as per <a href="https://github.com/matrix-org/matrix-doc/pull/2290">MSC2290</a>. (<a href="https://github.com/matrix-org/synapse/issues/6043">#6043</a>)</li>
<li>Add an unstable feature flag for separate add/bind 3pid APIs. (<a href="https://github.com/matrix-org/synapse/issues/6044">#6044</a>)</li>
<li>Remove <code>bind</code> parameter from Client Server POST <code>/account</code> endpoint as per <a href="https://github.com/matrix-org/matrix-doc/pull/2290/">MSC2290</a>. (<a href="https://github.com/matrix-org/synapse/issues/6067">#6067</a>)</li>
<li>Add <code>POST /add_threepid/msisdn/submit_token</code> endpoint for proxying submitToken on an <code>account_threepid_handler</code>. (<a href="https://github.com/matrix-org/synapse/issues/6078">#6078</a>)</li>
<li>Add <code>submit_url</code> response parameter to <code>*/msisdn/requestToken</code> endpoints. (<a href="https://github.com/matrix-org/synapse/issues/6079">#6079</a>)</li>
<li>Add <code>m.require_identity_server</code> flag to /version's unstable_features. (<a href="https://github.com/matrix-org/synapse/issues/5972">#5972</a>)</li>
</ul>
</li>
<li>Enhancements to OpenTracing support:
<ul>
<li>Make OpenTracing work in worker mode. (<a href="https://github.com/matrix-org/synapse/issues/5771">#5771</a>)</li>
<li>Pass OpenTracing contexts between servers when transmitting EDUs. (<a href="https://github.com/matrix-org/synapse/issues/5852">#5852</a>)</li>
<li>OpenTracing for device list updates. (<a href="https://github.com/matrix-org/synapse/issues/5853">#5853</a>)</li>
<li>Add a tag recording a request's authenticated entity and corresponding servlet in OpenTracing. (<a href="https://github.com/matrix-org/synapse/issues/5856">#5856</a>)</li>
<li>Add minimum OpenTracing for client servlets. (<a href="https://github.com/matrix-org/synapse/issues/5983">#5983</a>)</li>
<li>Check at setup that OpenTracing is installed if it's enabled in the config. (<a href="https://github.com/matrix-org/synapse/issues/5985">#5985</a>)</li>
<li>Trace replication send times. (<a href="https://github.com/matrix-org/synapse/issues/5986">#5986</a>)</li>
<li>Include missing OpenTracing contexts in outbout replication requests. (<a href="https://github.com/matrix-org/synapse/issues/5982">#5982</a>)</li>
<li>Fix sending of EDUs when OpenTracing is enabled with an empty whitelist. (<a href="https://github.com/matrix-org/synapse/issues/5984">#5984</a>)</li>
<li>Fix invalid references to None while OpenTracing if the log context slips. (<a href="https://github.com/matrix-org/synapse/issues/5988">#5988</a>, <a href="https://github.com/matrix-org/synapse/issues/5991">#5991</a>)</li>
<li>OpenTracing for room and e2e keys. (<a href="https://github.com/matrix-org/synapse/issues/5855">#5855</a>)</li>
<li>Add OpenTracing span over HTTP push processing. (<a href="https://github.com/matrix-org/synapse/issues/6003">#6003</a>)</li>
</ul>
</li>
<li>Add an admin API to purge old rooms from the database. (<a href="https://github.com/matrix-org/synapse/issues/5845">#5845</a>)</li>
<li>Retry well-known lookups if we have recently seen a valid well-known record for the server. (<a href="https://github.com/matrix-org/synapse/issues/5850">#5850</a>)</li>
<li>Add support for filtered room-directory search requests over federation (<a href="https://github.com/matrix-org/matrix-doc/pull/2197">MSC2197</a>, in order to allow upcoming room directory query performance improvements. (<a href="https://github.com/matrix-org/synapse/issues/5859">#5859</a>)</li>
<li>Correctly retry all hosts returned from SRV when we fail to connect. (<a href="https://github.com/matrix-org/synapse/issues/5864">#5864</a>)</li>
<li>Add admin API endpoint for setting whether or not a user is a server administrator. (<a href="https://github.com/matrix-org/synapse/issues/5878">#5878</a>)</li>
<li>Enable cleaning up extremities with dummy events by default to prevent undue build up of forward extremities. (<a href="https://github.com/matrix-org/synapse/issues/5884">#5884</a>)</li>
<li>Add config option to sign remote key query responses with a separate key. (<a href="https://github.com/matrix-org/synapse/issues/5895">#5895</a>)</li>
<li>Add support for config templating. (<a href="https://github.com/matrix-org/synapse/issues/5900">#5900</a>)</li>
<li>Users with the type of &quot;support&quot; or &quot;bot&quot; are no longer required to consent. (<a href="https://github.com/matrix-org/synapse/issues/5902">#5902</a>)</li>
<li>Let synctl accept a directory of config files. (<a href="https://github.com/matrix-org/synapse/issues/5904">#5904</a>)</li>
<li>Increase max display name size to 256. (<a href="https://github.com/matrix-org/synapse/issues/5906">#5906</a>)</li>
<li>Add admin API endpoint for getting whether or not a user is a server administrator. (<a href="https://github.com/matrix-org/synapse/issues/5914">#5914</a>)</li>
<li>Redact events in the database that have been redacted for a week. (<a href="https://github.com/matrix-org/synapse/issues/5934">#5934</a>)</li>
<li>New prometheus metrics:
<ul>
<li><code>synapse_federation_known_servers</code>: represents the total number of servers your server knows about (i.e. is in rooms with), including itself. Enable by setting <code>metrics_flags.known_servers</code> to True in the configuration.(<a href="https://github.com/matrix-org/synapse/issues/5981">#5981</a>)</li>
<li><code>synapse_build_info</code>: exposes the Python version, OS version, and Synapse version of the running server. (<a href="https://github.com/matrix-org/synapse/issues/6005">#6005</a>)</li>
</ul>
</li>
<li>Give appropriate exit codes when synctl fails. (<a href="https://github.com/matrix-org/synapse/issues/5992">#5992</a>)</li>
<li>Apply the federation blacklist to requests to identity servers. (<a href="https://github.com/matrix-org/synapse/issues/6000">#6000</a>)</li>
<li>Add <code>report_stats_endpoint</code> option to configure where stats are reported to, if enabled. Contributed by @Sorunome. (<a href="https://github.com/matrix-org/synapse/issues/6012">#6012</a>)</li>
<li>Add config option to increase ratelimits for room admins redacting messages. (<a href="https://github.com/matrix-org/synapse/issues/6015">#6015</a>)</li>
<li>Stop sending federation transactions to servers which have been down for a long time. (<a href="https://github.com/matrix-org/synapse/issues/6026">#6026</a>)</li>
<li>Make the process for mapping SAML2 users to matrix IDs more flexible. (<a href="https://github.com/matrix-org/synapse/issues/6037">#6037</a>)</li>
<li>Return a clearer error message when a timeout occurs when attempting to contact an identity server. (<a href="https://github.com/matrix-org/synapse/issues/6073">#6073</a>)</li>
<li>Prevent password reset's submit_token endpoint from accepting trailing slashes. (<a href="https://github.com/matrix-org/synapse/issues/6074">#6074</a>)</li>
<li>Return 403 on <code>/register/available</code> if registration has been disabled. (<a href="https://github.com/matrix-org/synapse/issues/6082">#6082</a>)</li>
<li>Explicitly log when a homeserver does not have the <code>trusted_key_servers</code> config field configured. (<a href="https://github.com/matrix-org/synapse/issues/6090">#6090</a>)</li>
<li>Add support for pruning old rows in <code>user_ips</code> table. (<a href="https://github.com/matrix-org/synapse/issues/6098">#6098</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Don't create broken room when <code>power_level_content_override.users</code> does not contain <code>creator_id</code>. (<a href="https://github.com/matrix-org/synapse/issues/5633">#5633</a>)</li>
<li>Fix database index so that different backup versions can have the same sessions. (<a href="https://github.com/matrix-org/synapse/issues/5857">#5857</a>)</li>
<li>Fix Synapse looking for config options <code>password_reset_failure_template</code> and <code>password_reset_success_template</code>, when they are actually <code>password_reset_template_failure_html</code>, <code>password_reset_template_success_html</code>. (<a href="https://github.com/matrix-org/synapse/issues/5863">#5863</a>)</li>
<li>Fix stack overflow when recovering an appservice which had an outage. (<a href="https://github.com/matrix-org/synapse/issues/5885">#5885</a>)</li>
<li>Fix error message which referred to <code>public_base_url</code> instead of <code>public_baseurl</code>. Thanks to @aaronraimist for the fix! (<a href="https://github.com/matrix-org/synapse/issues/5909">#5909</a>)</li>
<li>Fix 404 for thumbnail download when <code>dynamic_thumbnails</code> is <code>false</code> and the thumbnail was dynamically generated. Fix reported by rkfg. (<a href="https://github.com/matrix-org/synapse/issues/5915">#5915</a>)</li>
<li>Fix a cache-invalidation bug for worker-based deployments. (<a href="https://github.com/matrix-org/synapse/issues/5920">#5920</a>)</li>
<li>Fix admin API for listing media in a room not being available with an external media repo. (<a href="https://github.com/matrix-org/synapse/issues/5966">#5966</a>)</li>
<li>Fix list media admin API always returning an error. (<a href="https://github.com/matrix-org/synapse/issues/5967">#5967</a>)</li>
<li>Fix room and user stats tracking. (<a href="https://github.com/matrix-org/synapse/issues/5971">#5971</a>, <a href="https://github.com/matrix-org/synapse/issues/5998">#5998</a>, <a href="https://github.com/matrix-org/synapse/issues/6029">#6029</a>)</li>
<li>Return a <code>M_MISSING_PARAM</code> if <code>sid</code> is not provided to <code>/account/3pid</code>. (<a href="https://github.com/matrix-org/synapse/issues/5995">#5995</a>)</li>
<li><code>federation_certificate_verification_whitelist</code> now will not cause <code>TypeErrors</code> to be raised (a regression in 1.3). Additionally, it now supports internationalised domain names in their non-canonical representation. (<a href="https://github.com/matrix-org/synapse/issues/5996">#5996</a>)</li>
<li>Only count real users when checking for auto-creation of auto-join room. (<a href="https://github.com/matrix-org/synapse/issues/6004">#6004</a>)</li>
<li>Ensure support users can be registered even if MAU limit is reached. (<a href="https://github.com/matrix-org/synapse/issues/6020">#6020</a>)</li>
<li>Fix bug where login error was shown incorrectly on SSO fallback login. (<a href="https://github.com/matrix-org/synapse/issues/6024">#6024</a>)</li>
<li>Fix bug in calculating the federation retry backoff period. (<a href="https://github.com/matrix-org/synapse/issues/6025">#6025</a>)</li>
<li>Prevent exceptions being logged when extremity-cleanup events fail due to lack of user consent to the terms of service. (<a href="https://github.com/matrix-org/synapse/issues/6053">#6053</a>)</li>
<li>Remove POST method from password-reset <code>submit_token</code> endpoint until we implement <code>submit_url</code> functionality. (<a href="https://github.com/matrix-org/synapse/issues/6056">#6056</a>)</li>
<li>Fix logcontext spam on non-Linux platforms. (<a href="https://github.com/matrix-org/synapse/issues/6059">#6059</a>)</li>
<li>Ensure query parameters in email validation links are URL-encoded. (<a href="https://github.com/matrix-org/synapse/issues/6063">#6063</a>)</li>
<li>Fix a bug which caused SAML attribute maps to be overridden by defaults. (<a href="https://github.com/matrix-org/synapse/issues/6069">#6069</a>)</li>
<li>Fix the logged number of updated items for the <code>users_set_deactivated_flag</code> background update. (<a href="https://github.com/matrix-org/synapse/issues/6092">#6092</a>)</li>
<li>Add <code>sid</code> to <code>next_link</code> for email validation. (<a href="https://github.com/matrix-org/synapse/issues/6097">#6097</a>)</li>
<li>Threepid validity checks on msisdns should not be dependent on <code>threepid_behaviour_email</code>. (<a href="https://github.com/matrix-org/synapse/issues/6104">#6104</a>)</li>
<li>Ensure that servers which are not configured to support email address verification do not offer it in the registration flows. (<a href="https://github.com/matrix-org/synapse/issues/6107">#6107</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Avoid changing <code>UID/GID</code> if they are already correct. (<a href="https://github.com/matrix-org/synapse/issues/5970">#5970</a>)</li>
<li>Provide <code>SYNAPSE_WORKER</code> envvar to specify python module. (<a href="https://github.com/matrix-org/synapse/issues/6058">#6058</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Convert documentation to markdown (from rst) (<a href="https://github.com/matrix-org/synapse/issues/5849">#5849</a>)</li>
<li>Update <code>INSTALL.md</code> to say that Python 2 is no longer supported. (<a href="https://github.com/matrix-org/synapse/issues/5953">#5953</a>)</li>
<li>Add developer documentation for using SAML2. (<a href="https://github.com/matrix-org/synapse/issues/6032">#6032</a>)</li>
<li>Add some notes on rolling back to v1.3.1. (<a href="https://github.com/matrix-org/synapse/issues/6049">#6049</a>)</li>
<li>Update the upgrade notes. (<a href="https://github.com/matrix-org/synapse/issues/6050">#6050</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove shared-secret registration from <code>/_matrix/client/r0/register</code> endpoint. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/5877">#5877</a>)</li>
<li>Deprecate the <code>trusted_third_party_id_servers</code> option. (<a href="https://github.com/matrix-org/synapse/issues/5875">#5875</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Lay the groundwork for structured logging output. (<a href="https://github.com/matrix-org/synapse/issues/5680">#5680</a>)</li>
<li>Retry well-known lookup before the cache expires, giving a grace period where the remote well-known can be down but we still use the old result. (<a href="https://github.com/matrix-org/synapse/issues/5844">#5844</a>)</li>
<li>Remove log line for debugging issue #5407. (<a href="https://github.com/matrix-org/synapse/issues/5860">#5860</a>)</li>
<li>Refactor the Appservice scheduler code. (<a href="https://github.com/matrix-org/synapse/issues/5886">#5886</a>)</li>
<li>Compatibility with v2 Identity Service APIs other than /lookup. (<a href="https://github.com/matrix-org/synapse/issues/5892">#5892</a>, <a href="https://github.com/matrix-org/synapse/issues/6013">#6013</a>)</li>
<li>Stop populating some unused tables. (<a href="https://github.com/matrix-org/synapse/issues/5893">#5893</a>, <a href="https://github.com/matrix-org/synapse/issues/6047">#6047</a>)</li>
<li>Add missing index on <code>users_in_public_rooms</code> to improve the performance of directory queries. (<a href="https://github.com/matrix-org/synapse/issues/5894">#5894</a>)</li>
<li>Improve the logging when we have an error when fetching signing keys. (<a href="https://github.com/matrix-org/synapse/issues/5896">#5896</a>)</li>
<li>Add support for database engine-specific schema deltas, based on file extension. (<a href="https://github.com/matrix-org/synapse/issues/5911">#5911</a>)</li>
<li>Update Buildkite pipeline to use plugins instead of buildkite-agent commands. (<a href="https://github.com/matrix-org/synapse/issues/5922">#5922</a>)</li>
<li>Add link in sample config to the logging config schema. (<a href="https://github.com/matrix-org/synapse/issues/5926">#5926</a>)</li>
<li>Remove unnecessary parentheses in return statements. (<a href="https://github.com/matrix-org/synapse/issues/5931">#5931</a>)</li>
<li>Remove unused <code>jenkins/prepare_sytest.sh</code> file. (<a href="https://github.com/matrix-org/synapse/issues/5938">#5938</a>)</li>
<li>Move Buildkite pipeline config to the pipelines repo. (<a href="https://github.com/matrix-org/synapse/issues/5943">#5943</a>)</li>
<li>Remove unnecessary return statements in the codebase which were the result of a regex run. (<a href="https://github.com/matrix-org/synapse/issues/5962">#5962</a>)</li>
<li>Remove left-over methods from v1 registration API. (<a href="https://github.com/matrix-org/synapse/issues/5963">#5963</a>)</li>
<li>Cleanup event auth type initialisation. (<a href="https://github.com/matrix-org/synapse/issues/5975">#5975</a>)</li>
<li>Clean up dependency checking at setup. (<a href="https://github.com/matrix-org/synapse/issues/5989">#5989</a>)</li>
<li>Update OpenTracing docs to use the unified <code>trace</code> method. (<a href="https://github.com/matrix-org/synapse/issues/5776">#5776</a>)</li>
<li>Small refactor of function arguments and docstrings in<code> RoomMemberHandler</code>. (<a href="https://github.com/matrix-org/synapse/issues/6009">#6009</a>)</li>
<li>Remove unused <code>origin</code> argument on <code>FederationHandler.add_display_name_to_third_party_invite</code>. (<a href="https://github.com/matrix-org/synapse/issues/6010">#6010</a>)</li>
<li>Add a <code>failure_ts</code> column to the <code>destinations</code> database table. (<a href="https://github.com/matrix-org/synapse/issues/6016">#6016</a>, <a href="https://github.com/matrix-org/synapse/issues/6072">#6072</a>)</li>
<li>Clean up some code in the retry logic. (<a href="https://github.com/matrix-org/synapse/issues/6017">#6017</a>)</li>
<li>Fix the structured logging tests stomping on the global log configuration for subsequent tests. (<a href="https://github.com/matrix-org/synapse/issues/6023">#6023</a>)</li>
<li>Clean up the sample config for SAML authentication. (<a href="https://github.com/matrix-org/synapse/issues/6064">#6064</a>)</li>
<li>Change mailer logging to reflect Synapse doesn't just do chat notifications by email now. (<a href="https://github.com/matrix-org/synapse/issues/6075">#6075</a>)</li>
<li>Move last-seen info into devices table. (<a href="https://github.com/matrix-org/synapse/issues/6089">#6089</a>)</li>
<li>Remove unused parameter to <code>get_user_id_by_threepid</code>. (<a href="https://github.com/matrix-org/synapse/issues/6099">#6099</a>)</li>
<li>Refactor the user-interactive auth handling. (<a href="https://github.com/matrix-org/synapse/issues/6105">#6105</a>)</li>
<li>Refactor code for calculating registration flows. (<a href="https://github.com/matrix-org/synapse/issues/6106">#6106</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;08&#x2F;17&#x2F;synapse-1-3-1-released&#x2F;" title="Synapse 1.3.1 released">Synapse 1.3.1 released</a></h2>
                <span>
                    17.08.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Some of you will have been bitten by a bug that <a href="https://github.com/matrix-org/synapse/issues/5866">prevented Synapse 1.3.0 from starting up correctly</a>. If this is you, please upgrade.</p>
<p>Additionally we have taken the opportunity to fix a <a href="https://github.com/matrix-org/synapse/issues/5865">dependency bug</a> for our intrepid packagers.</p>
<p>Apologies for the inconvenience.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.3.1">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.3.0 follows:</p>
<h1 id="synapse-1-3-1-2019-08-17">Synapse 1.3.1 (2019-08-17)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Drop hard dependency on <code>sdnotify</code> python package. (<a href="https://github.com/matrix-org/synapse/issues/5871">#5871</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix startup issue (hang on ACME provisioning) due to ordering of Twisted reactor startup. Thanks to @chrismoos for supplying the fix. (<a href="https://github.com/matrix-org/synapse/issues/5867">#5867</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;08&#x2F;15&#x2F;synapse-1-3-0-released&#x2F;" title="Synapse 1.3.0 released">Synapse 1.3.0 released</a></h2>
                <span>
                    15.08.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Well now, Synapse 1.3.0 is here.</p>
<p>The main thing to know about 1.3.0 is that is contains performance improvements to reduce disk I/O and reduce RAM usage. We’ve been running it on matrix.org for a week or so and are really pleased with the results.</p>
<p>Check out our message send heat map.</p>
<p><img src="/blog/img/2019-08-15-message-send.png" alt="Message Send" /></p>
<p>Other than that there are a bunch of bug fixes and tweaks to generally make things run more smoothly.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.3.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.2.1 follows:</p>
<h1 id="synapse-1-3-0-2019-08-15">Synapse 1.3.0 (2019-08-15)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix 500 Internal Server Error on <code>publicRooms</code> when the public room list was
cached. (<a href="https://github.com/matrix-org/synapse/issues/5851">#5851</a>)</li>
</ul>
<h1 id="synapse-1-3-0rc1-2019-08-13">Synapse 1.3.0rc1 (2019-08-13)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Use <code>M_USER_DEACTIVATED</code> instead of <code>M_UNKNOWN</code> for errcode when a deactivated user attempts to login. (<a href="https://github.com/matrix-org/synapse/issues/5686">#5686</a>)</li>
<li>Add sd_notify hooks to ease systemd integration and allows usage of Type=Notify. (<a href="https://github.com/matrix-org/synapse/issues/5732">#5732</a>)</li>
<li>Synapse will no longer serve any media repo admin endpoints when <code>enable_media_repo</code> is set to False in the configuration. If a media repo worker is used, the admin APIs relating to the media repo will be served from it instead. (<a href="https://github.com/matrix-org/synapse/issues/5754">#5754</a>, <a href="https://github.com/matrix-org/synapse/issues/5848">#5848</a>)</li>
<li>Synapse can now be configured to not join remote rooms of a given &quot;complexity&quot; (currently, state events) over federation. This option can be used to prevent adverse performance on resource-constrained homeservers. (<a href="https://github.com/matrix-org/synapse/issues/5783">#5783</a>)</li>
<li>Allow defining HTML templates to serve the user on account renewal attempt when using the account validity feature. (<a href="https://github.com/matrix-org/synapse/issues/5807">#5807</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix UISIs during homeserver outage. (<a href="https://github.com/matrix-org/synapse/issues/5693">#5693</a>, <a href="https://github.com/matrix-org/synapse/issues/5789">#5789</a>)</li>
<li>Fix stack overflow in server key lookup code. (<a href="https://github.com/matrix-org/synapse/issues/5724">#5724</a>)</li>
<li>start.sh no longer uses deprecated cli option. (<a href="https://github.com/matrix-org/synapse/issues/5725">#5725</a>)</li>
<li>Log when we receive an event receipt from an unexpected origin. (<a href="https://github.com/matrix-org/synapse/issues/5743">#5743</a>)</li>
<li>Fix debian packaging scripts to correctly build sid packages. (<a href="https://github.com/matrix-org/synapse/issues/5775">#5775</a>)</li>
<li>Correctly handle redactions of redactions. (<a href="https://github.com/matrix-org/synapse/issues/5788">#5788</a>)</li>
<li>Return 404 instead of 403 when accessing /rooms/{roomId}/event/{eventId} for an event without the appropriate permissions. (<a href="https://github.com/matrix-org/synapse/issues/5798">#5798</a>)</li>
<li>Fix check that tombstone is a state event in push rules. (<a href="https://github.com/matrix-org/synapse/issues/5804">#5804</a>)</li>
<li>Fix error when trying to login as a deactivated user when using a worker to handle login. (<a href="https://github.com/matrix-org/synapse/issues/5806">#5806</a>)</li>
<li>Fix bug where user <code>/sync</code> stream could get wedged in rare circumstances. (<a href="https://github.com/matrix-org/synapse/issues/5825">#5825</a>)</li>
<li>The purge_remote_media.sh script was fixed. (<a href="https://github.com/matrix-org/synapse/issues/5839">#5839</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Synapse now no longer accepts the <code>-v</code>/<code>--verbose</code>, <code>-f</code>/<code>--log-file</code>, or <code>--log-config</code> command line flags, and removes the deprecated <code>verbose</code> and <code>log_file</code> configuration file options. Users of these options should migrate their options into the dedicated log configuration. (<a href="https://github.com/matrix-org/synapse/issues/5678">#5678</a>, <a href="https://github.com/matrix-org/synapse/issues/5729">#5729</a>)</li>
<li>Remove non-functional 'expire_access_token' setting. (<a href="https://github.com/matrix-org/synapse/issues/5782">#5782</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Make Jaeger fully configurable. (<a href="https://github.com/matrix-org/synapse/issues/5694">#5694</a>)</li>
<li>Add precautionary measures to prevent future abuse of <code>window.opener</code> in default welcome page. (<a href="https://github.com/matrix-org/synapse/issues/5695">#5695</a>)</li>
<li>Reduce database IO usage by optimising queries for current membership. (<a href="https://github.com/matrix-org/synapse/issues/5706">#5706</a>, <a href="https://github.com/matrix-org/synapse/issues/5738">#5738</a>, <a href="https://github.com/matrix-org/synapse/issues/5746">#5746</a>, <a href="https://github.com/matrix-org/synapse/issues/5752">#5752</a>, <a href="https://github.com/matrix-org/synapse/issues/5770">#5770</a>, <a href="https://github.com/matrix-org/synapse/issues/5774">#5774</a>, <a href="https://github.com/matrix-org/synapse/issues/5792">#5792</a>, <a href="https://github.com/matrix-org/synapse/issues/5793">#5793</a>)</li>
<li>Improve caching when fetching <code>get_filtered_current_state_ids</code>. (<a href="https://github.com/matrix-org/synapse/issues/5713">#5713</a>)</li>
<li>Don't accept opentracing data from clients. (<a href="https://github.com/matrix-org/synapse/issues/5715">#5715</a>)</li>
<li>Speed up PostgreSQL unit tests in CI. (<a href="https://github.com/matrix-org/synapse/issues/5717">#5717</a>)</li>
<li>Update the coding style document. (<a href="https://github.com/matrix-org/synapse/issues/5719">#5719</a>)</li>
<li>Improve database query performance when recording retry intervals for remote hosts. (<a href="https://github.com/matrix-org/synapse/issues/5720">#5720</a>)</li>
<li>Add a set of opentracing utils. (<a href="https://github.com/matrix-org/synapse/issues/5722">#5722</a>)</li>
<li>Cache result of get_version_string to reduce overhead of <code>/version</code> federation requests. (<a href="https://github.com/matrix-org/synapse/issues/5730">#5730</a>)</li>
<li>Return 'user_type' in admin API user endpoints results. (<a href="https://github.com/matrix-org/synapse/issues/5731">#5731</a>)</li>
<li>Don't package the sytest test blacklist file. (<a href="https://github.com/matrix-org/synapse/issues/5733">#5733</a>)</li>
<li>Replace uses of returnValue with plain return, as returnValue is not needed on Python 3. (<a href="https://github.com/matrix-org/synapse/issues/5736">#5736</a>)</li>
<li>Blacklist some flakey tests in worker mode. (<a href="https://github.com/matrix-org/synapse/issues/5740">#5740</a>)</li>
<li>Fix some error cases in the caching layer. (<a href="https://github.com/matrix-org/synapse/issues/5749">#5749</a>)</li>
<li>Add a prometheus metric for pending cache lookups. (<a href="https://github.com/matrix-org/synapse/issues/5750">#5750</a>)</li>
<li>Stop trying to fetch events with event_id=None. (<a href="https://github.com/matrix-org/synapse/issues/5753">#5753</a>)</li>
<li>Convert RedactionTestCase to modern test style. (<a href="https://github.com/matrix-org/synapse/issues/5768">#5768</a>)</li>
<li>Allow looping calls to be given arguments. (<a href="https://github.com/matrix-org/synapse/issues/5780">#5780</a>)</li>
<li>Set the logs emitted when checking typing and presence timeouts to DEBUG level, not INFO. (<a href="https://github.com/matrix-org/synapse/issues/5785">#5785</a>)</li>
<li>Remove DelayedCall debugging from the test suite, as it is no longer required in the vast majority of Synapse's tests. (<a href="https://github.com/matrix-org/synapse/issues/5787">#5787</a>)</li>
<li>Remove some spurious exceptions from the logs where we failed to talk to a remote server. (<a href="https://github.com/matrix-org/synapse/issues/5790">#5790</a>)</li>
<li>Improve performance when making <code>.well-known</code> requests by sharing the SSL options between requests. (<a href="https://github.com/matrix-org/synapse/issues/5794">#5794</a>)</li>
<li>Disable codecov GitHub comments on PRs. (<a href="https://github.com/matrix-org/synapse/issues/5796">#5796</a>)</li>
<li>Don't allow clients to send tombstone events that reference the room it's sent in. (<a href="https://github.com/matrix-org/synapse/issues/5801">#5801</a>)</li>
<li>Deny redactions of events sent in a different room. (<a href="https://github.com/matrix-org/synapse/issues/5802">#5802</a>)</li>
<li>Deny sending well known state types as non-state events. (<a href="https://github.com/matrix-org/synapse/issues/5805">#5805</a>)</li>
<li>Handle incorrectly encoded query params correctly by returning a 400. (<a href="https://github.com/matrix-org/synapse/issues/5808">#5808</a>)</li>
<li>Handle pusher being deleted during processing rather than logging an exception. (<a href="https://github.com/matrix-org/synapse/issues/5809">#5809</a>)</li>
<li>Return 502 not 500 when failing to reach any remote server. (<a href="https://github.com/matrix-org/synapse/issues/5810">#5810</a>)</li>
<li>Reduce global pauses in the events stream caused by expensive state resolution during persistence. (<a href="https://github.com/matrix-org/synapse/issues/5826">#5826</a>)</li>
<li>Add a lower bound to well-known lookup cache time to avoid repeated lookups. (<a href="https://github.com/matrix-org/synapse/issues/5836">#5836</a>)</li>
<li>Whitelist history visbility sytests in worker mode tests. (<a href="https://github.com/matrix-org/synapse/issues/5843">#5843</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;26&#x2F;critical-security-update-synapse-1-2-1-released&#x2F;" title="Critical Security Update - Synapse 1.2.1 released">Critical Security Update - Synapse 1.2.1 released</a></h2>
                <span>
                    26.07.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Today we release Synapse 1.2.1 as a critical security update. It contains patches relating to redactions and event federation. The patches address long standing bugs, and are not regressions specific to the previous version (1.2).  <strong>All admins, regardless of current version, should upgrade asap</strong>.</p>
<p>This release includes <em>four</em> security fixes:</p>
<ul>
<li>Prevent an attack where a federated server could send redactions for arbitrary events in v1 and v2 rooms. (<a href="https://github.com/matrix-org/synapse/issues/5767">#5767</a>)</li>
<li>Prevent a denial-of-service attack where cycles of redaction events would make Synapse spin infinitely. Thanks to <code>@lrizika:matrix.org</code> for identifying and responsibly disclosing this issue. (<a href="https://github.com/matrix-org/synapse/commit/0f2ecb961">0f2ecb961</a>)</li>
<li>Prevent an attack where users could be joined or parted from public rooms without their consent. Thanks to <a href="https://github.com/dylangerdaly">Dylanger</a> for identifying and responsibly disclosing this issue. (<a href="https://github.com/matrix-org/synapse/issues/5744">#5744</a>)</li>
<li>Fix a vulnerability where a federated server could spoof read-receipts from
users on other servers. Thanks to <a href="https://github.com/dylangerdaly">Dylanger</a> for identifying this issue too. (<a href="https://github.com/matrix-org/synapse/issues/5743">#5743</a>)</li>
</ul>
<p>Additionally, the following fix was in Synapse <strong>1.2.0</strong>, but was not correctly
identified during the original release:</p>
<ul>
<li>It was possible for a room moderator to send a redaction for an <code>m.room.create</code> event, which would downgrade the room to version 1. Thanks to <code>@/dev/ponies:ponies.im</code> for identifying and responsibly disclosing this issue! (<a href="https://github.com/matrix-org/synapse/issues/5701">#5701</a>)</li>
</ul>
<p>You can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.2.1">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Alternatively check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>Thanks for bearing with us.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;25&#x2F;synapse-1-2-0-released&#x2F;" title="Synapse 1.2.0 released">Synapse 1.2.0 released</a></h2>
                <span>
                    25.07.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hey hey, Synapse 1.2.0 is here. It contains aggregations support, better error handling for  deactivated accounts and some important bug fixes for redacting messages. Special thanks to community members <a href="https://github.com/skalarproduktraum">skalarproduktraum</a> and <a href="https://github.com/Lrizika">Lrizika</a> for submissions to improve our documentation.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.2.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up <a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.1.0 follows:</p>
<h1 id="synapse-1-2-0-2019-07-25">Synapse 1.2.0 (2019-07-25)</h1>
<p>No significant changes.</p>
<h1 id="synapse-1-2-0rc2-2019-07-24">Synapse 1.2.0rc2 (2019-07-24)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix a regression introduced in v1.2.0rc1 which led to incorrect labels on some prometheus metrics. (<a href="https://github.com/matrix-org/synapse/issues/5734">#5734</a>)</li>
</ul>
<h1 id="synapse-1-2-0rc1-2019-07-22">Synapse 1.2.0rc1 (2019-07-22)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Add support for opentracing. (<a href="https://github.com/matrix-org/synapse/issues/5544">#5544</a>, <a href="https://github.com/matrix-org/synapse/issues/5712">#5712</a>)</li>
<li>Add ability to pull all locally stored events out of synapse that a particular user can see. (<a href="https://github.com/matrix-org/synapse/issues/5589">#5589</a>)</li>
<li>Add a basic admin command app to allow server operators to run Synapse admin commands separately from the main production instance. (<a href="https://github.com/matrix-org/synapse/issues/5597">#5597</a>)</li>
<li>Add <code>sender</code> and <code>origin_server_ts</code> fields to <code>m.replace</code>. (<a href="https://github.com/matrix-org/synapse/issues/5613">#5613</a>)</li>
<li>Add default push rule to ignore reactions. (<a href="https://github.com/matrix-org/synapse/issues/5623">#5623</a>)</li>
<li>Include the original event when asking for its relations. (<a href="https://github.com/matrix-org/synapse/issues/5626">#5626</a>)</li>
<li>Implement <code>session_lifetime</code> configuration option, after which access tokens will expire. (<a href="https://github.com/matrix-org/synapse/issues/5660">#5660</a>)</li>
<li>Return &quot;This account has been deactivated&quot; when a deactivated user tries to login. (<a href="https://github.com/matrix-org/synapse/issues/5674">#5674</a>)</li>
<li>Enable aggregations support by default (<a href="https://github.com/matrix-org/synapse/issues/5714">#5714</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix 'utime went backwards' errors on daemonization. (<a href="https://github.com/matrix-org/synapse/issues/5609">#5609</a>)</li>
<li>Various minor fixes to the federation request rate limiter. (<a href="https://github.com/matrix-org/synapse/issues/5621">#5621</a>)</li>
<li>Forbid viewing relations on an event once it has been redacted. (<a href="https://github.com/matrix-org/synapse/issues/5629">#5629</a>)</li>
<li>Fix requests to the <code>/store_invite</code> endpoint of identity servers being sent in the wrong format. (<a href="https://github.com/matrix-org/synapse/issues/5638">#5638</a>)</li>
<li>Fix newly-registered users not being able to lookup their own profile without joining a room. (<a href="https://github.com/matrix-org/synapse/issues/5644">#5644</a>)</li>
<li>Fix bug in #5626 that prevented the original_event field from actually having the contents of the original event in a call to <code>/relations</code>. (<a href="https://github.com/matrix-org/synapse/issues/5654">#5654</a>)</li>
<li>Fix 3PID bind requests being sent to identity servers as <code>application/x-form-www-urlencoded</code> data, which is deprecated. (<a href="https://github.com/matrix-org/synapse/issues/5658">#5658</a>)</li>
<li>Fix some problems with authenticating redactions in recent room versions. (<a href="https://github.com/matrix-org/synapse/issues/5699">#5699</a>, <a href="https://github.com/matrix-org/synapse/issues/5700">#5700</a>, <a href="https://github.com/matrix-org/synapse/issues/5707">#5707</a>)</li>
<li>Ignore redactions of m.room.create events. (<a href="https://github.com/matrix-org/synapse/issues/5701">#5701</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Base Docker image on a newer Alpine Linux version (3.8 -&gt; 3.10). (<a href="https://github.com/matrix-org/synapse/issues/5619">#5619</a>)</li>
<li>Add missing space in default logging file format generated by the Docker image. (<a href="https://github.com/matrix-org/synapse/issues/5620">#5620</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Add information about nginx normalisation to reverse_proxy.rst. Contributed by @skalarproduktraum - thanks! (<a href="https://github.com/matrix-org/synapse/issues/5397">#5397</a>)</li>
<li>--no-pep517 should be --no-use-pep517 in the documentation to setup the development environment. (<a href="https://github.com/matrix-org/synapse/issues/5651">#5651</a>)</li>
<li>Improvements to Postgres setup instructions. Contributed by @Lrizika - thanks! (<a href="https://github.com/matrix-org/synapse/issues/5661">#5661</a>)</li>
<li>Minor tweaks to postgres documentation. (<a href="https://github.com/matrix-org/synapse/issues/5675">#5675</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove support for the <code>invite_3pid_guest</code> configuration setting. (<a href="https://github.com/matrix-org/synapse/issues/5625">#5625</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Move logging code out of <code>synapse.util</code> and into <code>synapse.logging</code>. (<a href="https://github.com/matrix-org/synapse/issues/5606">#5606</a>, <a href="https://github.com/matrix-org/synapse/issues/5617">#5617</a>)</li>
<li>Add a blacklist file to the repo to blacklist certain sytests from failing CI. (<a href="https://github.com/matrix-org/synapse/issues/5611">#5611</a>)</li>
<li>Make runtime errors surrounding password reset emails much clearer. (<a href="https://github.com/matrix-org/synapse/issues/5616">#5616</a>)</li>
<li>Remove dead code for persiting outgoing federation transactions. (<a href="https://github.com/matrix-org/synapse/issues/5622">#5622</a>)</li>
<li>Add <code>lint.sh</code> to the scripts-dev folder which will run all linting steps required by CI. (<a href="https://github.com/matrix-org/synapse/issues/5627">#5627</a>)</li>
<li>Move RegistrationHandler.get_or_create_user to test code. (<a href="https://github.com/matrix-org/synapse/issues/5628">#5628</a>)</li>
<li>Add some more common python virtual-environment paths to the black exclusion list. (<a href="https://github.com/matrix-org/synapse/issues/5630">#5630</a>)</li>
<li>Some counter metrics exposed over Prometheus have been renamed, with the old names preserved for backwards compatibility and deprecated. See <code>docs/metrics-howto.rst</code> for details. (<a href="https://github.com/matrix-org/synapse/issues/5636">#5636</a>)</li>
<li>Unblacklist some user_directory sytests. (<a href="https://github.com/matrix-org/synapse/issues/5637">#5637</a>)</li>
<li>Factor out some redundant code in the login implementation. (<a href="https://github.com/matrix-org/synapse/issues/5639">#5639</a>)</li>
<li>Update ModuleApi to avoid register(generate_token=True). (<a href="https://github.com/matrix-org/synapse/issues/5640">#5640</a>)</li>
<li>Remove access-token support from <code>RegistrationHandler.register</code>, and rename it. (<a href="https://github.com/matrix-org/synapse/issues/5641">#5641</a>)</li>
<li>Remove access-token support from <code>RegistrationStore.register</code>, and rename it. (<a href="https://github.com/matrix-org/synapse/issues/5642">#5642</a>)</li>
<li>Improve logging for auto-join when a new user is created. (<a href="https://github.com/matrix-org/synapse/issues/5643">#5643</a>)</li>
<li>Remove unused and unnecessary check for FederationDeniedError in _exception_to_failure. (<a href="https://github.com/matrix-org/synapse/issues/5645">#5645</a>)</li>
<li>Fix a small typo in a code comment. (<a href="https://github.com/matrix-org/synapse/issues/5655">#5655</a>)</li>
<li>Clean up exception handling around client access tokens. (<a href="https://github.com/matrix-org/synapse/issues/5656">#5656</a>)</li>
<li>Add a mechanism for per-test homeserver configuration in the unit tests. (<a href="https://github.com/matrix-org/synapse/issues/5657">#5657</a>)</li>
<li>Inline issue_access_token. (<a href="https://github.com/matrix-org/synapse/issues/5659">#5659</a>)</li>
<li>Update the sytest BuildKite configuration to checkout Synapse in <code>/src</code>. (<a href="https://github.com/matrix-org/synapse/issues/5664">#5664</a>)</li>
<li>Add a <code>docker</code> type to the towncrier configuration. (<a href="https://github.com/matrix-org/synapse/issues/5673">#5673</a>)</li>
<li>Convert <code>synapse.federation.transport.server</code> to <code>async</code>. Might improve some stack traces. (<a href="https://github.com/matrix-org/synapse/issues/5689">#5689</a>)</li>
<li>Documentation for opentracing. (<a href="https://github.com/matrix-org/synapse/issues/5703">#5703</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;04&#x2F;synapse-1-1-0-released&#x2F;" title="Synapse 1.1.0 released">Synapse 1.1.0 released</a></h2>
                <span>
                    04.07.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Right folks, this is our first post 1.0 release, which means that we have now
officially <a href="https://matrix.org/blog/2019/04/08/synapse-deprecating-postgres-9-4-and-python-2-x">dropped support for Python 2 and Postgres
9.4</a>.
This means that we can start making use of Python 3 specific features and you
should expect lots of associated performance wins over the coming months. See the <a href="https://github.com/matrix-org/synapse/blob/master/UPGRADE.rst#upgrading-to-v110">upgrade notes</a> for more.</p>
<p>Synapse 1.1.0 also contains a reworked approach to the Docker image, as well lots
of performance improvements with special focus on DB IO - expect more to come
in this area.</p>
<p>Special thanks to community member <a href="https://github.com/galexrt">Alexander
Trost</a> for rounding out  our SAML support and also
to <a href="https://github.com/dhoffend">Daniel Hoffend</a> for contributing the ability
to disable local password authentication.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.1.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up <a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.0.0 follows:</p>
<h1 id="synapse-1-1-0-2019-07-04">Synapse 1.1.0 (2019-07-04)</h1>
<p>As of v1.1.0, Synapse no longer supports Python 2, nor Postgres version 9.4.
See the <a href="https://github.com/matrix-org/synapse/blob/master/UPGRADE.rst#upgrading-to-v110">upgrade notes</a> for more details.</p>
<p>This release also deprecates the use of environment variables to configure the
docker image. See the <a href="https://github.com/matrix-org/synapse/blob/release-v1.1.0/docker/README.md#legacy-dynamic-configuration-file-support">docker README</a>
for more details.</p>
<p>No changes since 1.1.0rc2.</p>
<h1 id="synapse-1-1-0rc2-2019-07-03">Synapse 1.1.0rc2 (2019-07-03)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix regression in 1.1rc1 where OPTIONS requests to the media repo would fail. (<a href="https://github.com/matrix-org/synapse/issues/5593">#5593</a>)</li>
<li>Removed the <code>SYNAPSE_SMTP_*</code> docker container environment variables. Using these environment variables prevented the docker container from starting in Synapse v1.0, even though they didn't actually allow any functionality anyway. (<a href="https://github.com/matrix-org/synapse/issues/5596">#5596</a>)</li>
<li>Fix a number of &quot;Starting txn from sentinel context&quot; warnings. (<a href="https://github.com/matrix-org/synapse/issues/5605">#5605</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Update github templates. (<a href="https://github.com/matrix-org/synapse/issues/5552">#5552</a>)</li>
</ul>
<h1 id="synapse-1-1-0rc1-2019-07-02">Synapse 1.1.0rc1 (2019-07-02)</h1>
<p>As of v1.1.0, Synapse no longer supports Python 2, nor Postgres version 9.4.
See the <a href="UPGRADE.rst#upgrading-to-v110">upgrade notes</a> for more details.</p>
<h2 id="features">Features</h2>
<ul>
<li>Added possibility to disable local password authentication. Contributed by Daniel Hoffend. (<a href="https://github.com/matrix-org/synapse/issues/5092">#5092</a>)</li>
<li>Add monthly active users to phonehome stats. (<a href="https://github.com/matrix-org/synapse/issues/5252">#5252</a>)</li>
<li>Allow expired user to trigger renewal email sending manually. (<a href="https://github.com/matrix-org/synapse/issues/5363">#5363</a>)</li>
<li>Statistics on forward extremities per room are now exposed via Prometheus. (<a href="https://github.com/matrix-org/synapse/issues/5384">#5384</a>, <a href="https://github.com/matrix-org/synapse/issues/5458">#5458</a>, <a href="https://github.com/matrix-org/synapse/issues/5461">#5461</a>)</li>
<li>Add --no-daemonize option to run synapse in the foreground, per issue #4130. Contributed by Soham Gumaste. (<a href="https://github.com/matrix-org/synapse/issues/5412">#5412</a>, <a href="https://github.com/matrix-org/synapse/issues/5587">#5587</a>)</li>
<li>Fully support SAML2 authentication. Contributed by <a href="https://github.com/galexrt">Alexander Trost</a> - thank you! (<a href="https://github.com/matrix-org/synapse/issues/5422">#5422</a>)</li>
<li>Allow server admins to define implementations of extra rules for allowing or denying incoming events. (<a href="https://github.com/matrix-org/synapse/issues/5440">#5440</a>, <a href="https://github.com/matrix-org/synapse/issues/5474">#5474</a>, <a href="https://github.com/matrix-org/synapse/issues/5477">#5477</a>)</li>
<li>Add support for handling pagination APIs on client reader worker. (<a href="https://github.com/matrix-org/synapse/issues/5505">#5505</a>, <a href="https://github.com/matrix-org/synapse/issues/5513">#5513</a>, <a href="https://github.com/matrix-org/synapse/issues/5531">#5531</a>)</li>
<li>Improve help and cmdline option names for --generate-config options. (<a href="https://github.com/matrix-org/synapse/issues/5512">#5512</a>)</li>
<li>Allow configuration of the path used for ACME account keys. (<a href="https://github.com/matrix-org/synapse/issues/5516">#5516</a>, <a href="https://github.com/matrix-org/synapse/issues/5521">#5521</a>, <a href="https://github.com/matrix-org/synapse/issues/5522">#5522</a>)</li>
<li>Add --data-dir and --open-private-ports options. (<a href="https://github.com/matrix-org/synapse/issues/5524">#5524</a>)</li>
<li>Split public rooms directory auth config in two settings, in order to manage client auth independently from the federation part of it. Obsoletes the &quot;restrict_public_rooms_to_local_users&quot; configuration setting. If &quot;restrict_public_rooms_to_local_users&quot; is set in the config, Synapse will act as if both new options are enabled, i.e. require authentication through the client API and deny federation requests. (<a href="https://github.com/matrix-org/synapse/issues/5534">#5534</a>)</li>
<li>The minimum TLS version used for outgoing federation requests can now be set with <code>federation_client_minimum_tls_version</code>. (<a href="https://github.com/matrix-org/synapse/issues/5550">#5550</a>)</li>
<li>Optimise devices changed query to not pull unnecessary rows from the database, reducing database load. (<a href="https://github.com/matrix-org/synapse/issues/5559">#5559</a>)</li>
<li>Add new metrics for number of forward extremities being persisted and number of state groups involved in resolution. (<a href="https://github.com/matrix-org/synapse/issues/5476">#5476</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix bug processing incoming events over federation if call to <code>/get_missing_events</code> fails. (<a href="https://github.com/matrix-org/synapse/issues/5042">#5042</a>)</li>
<li>Prevent more than one room upgrade happening simultaneously on the same room. (<a href="https://github.com/matrix-org/synapse/issues/5051">#5051</a>)</li>
<li>Fix a bug where running synapse_port_db would cause the account validity feature to fail because it didn't set the type of the email_sent column to boolean. (<a href="https://github.com/matrix-org/synapse/issues/5325">#5325</a>)</li>
<li>Warn about disabling email-based password resets when a reset occurs, and remove warning when someone attempts a phone-based reset. (<a href="https://github.com/matrix-org/synapse/issues/5387">#5387</a>)</li>
<li>Fix email notifications for unnamed rooms with multiple people. (<a href="https://github.com/matrix-org/synapse/issues/5388">#5388</a>)</li>
<li>Fix exceptions in federation reader worker caused by attempting to renew attestations, which should only happen on master worker. (<a href="https://github.com/matrix-org/synapse/issues/5389">#5389</a>)</li>
<li>Fix handling of failures fetching remote content to not log failures as exceptions. (<a href="https://github.com/matrix-org/synapse/issues/5390">#5390</a>)</li>
<li>Fix a bug where deactivated users could receive renewal emails if the account validity feature is on. (<a href="https://github.com/matrix-org/synapse/issues/5394">#5394</a>)</li>
<li>Fix missing invite state after exchanging 3PID invites over federaton. (<a href="https://github.com/matrix-org/synapse/issues/5464">#5464</a>)</li>
<li>Fix intermittent exceptions on Apple hardware. Also fix bug that caused database activity times to be under-reported in log lines. (<a href="https://github.com/matrix-org/synapse/issues/5498">#5498</a>)</li>
<li>Fix logging error when a tampered event is detected. (<a href="https://github.com/matrix-org/synapse/issues/5500">#5500</a>)</li>
<li>Fix bug where clients could tight loop calling <code>/sync</code> for a period. (<a href="https://github.com/matrix-org/synapse/issues/5507">#5507</a>)</li>
<li>Fix bug with <code>jinja2</code> preventing Synapse from starting. Users who had this problem should now simply need to run <code>pip install matrix-synapse</code>. (<a href="https://github.com/matrix-org/synapse/issues/5514">#5514</a>)</li>
<li>Fix a regression where homeservers on private IP addresses were incorrectly blacklisted. (<a href="https://github.com/matrix-org/synapse/issues/5523">#5523</a>)</li>
<li>Fixed m.login.jwt using unregistered user_id and added pyjwt&gt;=1.6.4 as jwt conditional dependencies. Contributed by Pau Rodriguez-Estivill. (<a href="https://github.com/matrix-org/synapse/issues/5555">#5555</a>, <a href="https://github.com/matrix-org/synapse/issues/5586">#5586</a>)</li>
<li>Fix a bug that would cause invited users to receive several emails for a single 3PID invite in case the inviter is rate limited. (<a href="https://github.com/matrix-org/synapse/issues/5576">#5576</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Add ability to change Docker containers <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">timezone</a> with the <code>TZ</code> variable. (<a href="https://github.com/matrix-org/synapse/issues/5383">#5383</a>)</li>
<li>Update docker image to use Python 3.7. (<a href="https://github.com/matrix-org/synapse/issues/5546">#5546</a>)</li>
<li>Deprecate the use of environment variables for configuration, and make the use of a static configuration the default. (<a href="https://github.com/matrix-org/synapse/issues/5561">#5561</a>, <a href="https://github.com/matrix-org/synapse/issues/5562">#5562</a>, <a href="https://github.com/matrix-org/synapse/issues/5566">#5566</a>, <a href="https://github.com/matrix-org/synapse/issues/5567">#5567</a>)</li>
<li>Increase default log level for docker image to INFO. It can still be changed by editing the generated log.config file. (<a href="https://github.com/matrix-org/synapse/issues/5547">#5547</a>)</li>
<li>Send synapse logs to the docker logging system, by default. (<a href="https://github.com/matrix-org/synapse/issues/5565">#5565</a>)</li>
<li>Open the non-TLS port by default. (<a href="https://github.com/matrix-org/synapse/issues/5568">#5568</a>)</li>
<li>Fix failure to start under docker with SAML support enabled. (<a href="https://github.com/matrix-org/synapse/issues/5490">#5490</a>)</li>
<li>Use a sensible location for data files when generating a config file. (<a href="https://github.com/matrix-org/synapse/issues/5563">#5563</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Python 2.7 is no longer a supported platform. Synapse now requires Python 3.5+ to run. (<a href="https://github.com/matrix-org/synapse/issues/5425">#5425</a>)</li>
<li>PostgreSQL 9.4 is no longer supported. Synapse requires Postgres 9.5+ or above for Postgres support. (<a href="https://github.com/matrix-org/synapse/issues/5448">#5448</a>)</li>
<li>Remove support for cpu_affinity setting. (<a href="https://github.com/matrix-org/synapse/issues/5525">#5525</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Improve README section on performance troubleshooting. (<a href="https://github.com/matrix-org/synapse/issues/4276">#4276</a>)</li>
<li>Add information about how to install and run <code>black</code> on the codebase to code_style.rst. (<a href="https://github.com/matrix-org/synapse/issues/5537">#5537</a>)</li>
<li>Improve install docs on choosing server_name. (<a href="https://github.com/matrix-org/synapse/issues/5558">#5558</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Add logging to 3pid invite signature verification. (<a href="https://github.com/matrix-org/synapse/issues/5015">#5015</a>)</li>
<li>Update example haproxy config to a more compatible setup. (<a href="https://github.com/matrix-org/synapse/issues/5313">#5313</a>)</li>
<li>Track deactivated accounts in the database. (<a href="https://github.com/matrix-org/synapse/issues/5378">#5378</a>, <a href="https://github.com/matrix-org/synapse/issues/5465">#5465</a>, <a href="https://github.com/matrix-org/synapse/issues/5493">#5493</a>)</li>
<li>Clean up code for sending federation EDUs. (<a href="https://github.com/matrix-org/synapse/issues/5381">#5381</a>)</li>
<li>Add a sponsor button to the repo. (<a href="https://github.com/matrix-org/synapse/issues/5382">#5382</a>, <a href="https://github.com/matrix-org/synapse/issues/5386">#5386</a>)</li>
<li>Don't log non-200 responses from federation queries as exceptions. (<a href="https://github.com/matrix-org/synapse/issues/5383">#5383</a>)</li>
<li>Update Python syntax in contrib/ to Python 3. (<a href="https://github.com/matrix-org/synapse/issues/5446">#5446</a>)</li>
<li>Update federation_client dev script to support <code>.well-known</code> and work with python3. (<a href="https://github.com/matrix-org/synapse/issues/5447">#5447</a>)</li>
<li>SyTest has been moved to Buildkite. (<a href="https://github.com/matrix-org/synapse/issues/5459">#5459</a>)</li>
<li>Demo script now uses python3. (<a href="https://github.com/matrix-org/synapse/issues/5460">#5460</a>)</li>
<li>Synapse can now handle RestServlets that return coroutines. (<a href="https://github.com/matrix-org/synapse/issues/5475">#5475</a>, <a href="https://github.com/matrix-org/synapse/issues/5585">#5585</a>)</li>
<li>The demo servers talk to each other again. (<a href="https://github.com/matrix-org/synapse/issues/5478">#5478</a>)</li>
<li>Add an EXPERIMENTAL config option to try and periodically clean up extremities by sending dummy events. (<a href="https://github.com/matrix-org/synapse/issues/5480">#5480</a>)</li>
<li>Synapse's codebase is now formatted by <code>black</code>. (<a href="https://github.com/matrix-org/synapse/issues/5482">#5482</a>)</li>
<li>Some cleanups and sanity-checking in the CPU and database metrics. (<a href="https://github.com/matrix-org/synapse/issues/5499">#5499</a>)</li>
<li>Improve email notification logging. (<a href="https://github.com/matrix-org/synapse/issues/5502">#5502</a>)</li>
<li>Fix &quot;Unexpected entry in 'full_schemas'&quot; log warning. (<a href="https://github.com/matrix-org/synapse/issues/5509">#5509</a>)</li>
<li>Improve logging when generating config files. (<a href="https://github.com/matrix-org/synapse/issues/5510">#5510</a>)</li>
<li>Refactor and clean up Config parser for maintainability. (<a href="https://github.com/matrix-org/synapse/issues/5511">#5511</a>)</li>
<li>Make the config clearer in that email.template_dir is relative to the Synapse's root directory, not the <code>synapse/</code> folder within it. (<a href="https://github.com/matrix-org/synapse/issues/5543">#5543</a>)</li>
<li>Update v1.0.0 release changelog to include more information about changes to password resets. (<a href="https://github.com/matrix-org/synapse/issues/5545">#5545</a>)</li>
<li>Remove non-functioning check_event_hash.py dev script. (<a href="https://github.com/matrix-org/synapse/issues/5548">#5548</a>)</li>
<li>Synapse will now only allow TLS v1.2 connections when serving federation, if it terminates TLS. As Synapse's allowed ciphers were only able to be used in TLSv1.2 before, this does not change behaviour. (<a href="https://github.com/matrix-org/synapse/issues/5550">#5550</a>)</li>
<li>Logging when running GC collection on generation 0 is now at the DEBUG level, not INFO. (<a href="https://github.com/matrix-org/synapse/issues/5557">#5557</a>)</li>
<li>Reduce the amount of stuff we send in the docker context. (<a href="https://github.com/matrix-org/synapse/issues/5564">#5564</a>)</li>
<li>Point the reverse links in the Purge History contrib scripts at the intended location. (<a href="https://github.com/matrix-org/synapse/issues/5570">#5570</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;06&#x2F;11&#x2F;synapse-1-0-0-released&#x2F;" title="Synapse 1.0.0 released">Synapse 1.0.0 released</a></h2>
                <span>
                    11.06.2019 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Well here it is: Synapse 1.0.</p>
<p>Synapse 1.0 is the reference implementation of the <a href="https://matrix.org/docs/spec">Matrix 1.0 spec</a>. The goal of the release overall has been to focus on security and stability, such that we can officially declare Synapse (and Matrix) out of beta and recommended for production use. This means changing the default room protocol version used for new rooms to be <a href="https://github.com/matrix-org/matrix-doc/blob/37871106c6fc6013c17b5711fb93853fff140267/proposals/2002-rooms-v4.md">v4</a>, which includes the new <a href="https://github.com/matrix-org/matrix-doc/blob/f714aaadd011ac736d779f8460202a8d95799123/proposals/1442-state-resolution.md">state resolution algorithm</a>, as well as <a href="https://github.com/matrix-org/matrix-doc/blob/erikj/event_id_hashes/proposals/1659-event-id-as-hashes.md">collision-resistant event IDs</a>, which are now formatted to be <a href="https://github.com/matrix-org/matrix-doc/blob/rav/proposal/no_slash_in_event_id/proposals/1884-replace-slashes-in-event_ids.md">URL safe</a>.</p>
<p>Synapse 1.0 also ships with support for the upcoming <a href="https://matrix.org/docs/spec/rooms/v5.html">v5 room protocol</a> (which enforces honouring server key validity periods), but this will not be used as the default for new rooms until a sufficient number of servers support it.</p>
<p>Please note that Synapse 1.0 does <strong>not</strong> include significant performance work or new features - our focus has been almost exclusively on providing a reference implementation of the Matrix 1.0 protocol. But having cleared our backlog on security/stability issues we will finally be now unblocked to pursue work around reducing RAM footprint, eliminating forward-extremity build up, and shipping new features like Edits, Reactions &amp; E2E cross-signing support.</p>
<p>As part of the security work, Synapse 1.0 contains a <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md#it-used-to-work-just-fine-why-are-you-breaking-everything">breaking change</a> that requires a valid TLS certificate on the federation API endpoint. <strong>Servers that do not configure their certificate will no longer be able to federate post 1.0.</strong></p>
<p>It is also worth noting that Synapse 1.0.0 is the last release that will support Python 2.x and Postgres 9.4. For more information see <a href="/blog/2019/04/08/synapse-deprecating-postgres-9-4-and-python-2-x">here</a> but the TL;DR is that you should upgrade asap.</p>
<p>This release has been a long time coming. Many thanks indeed to everyone who helped test the release candidates and provided feedback along the way.</p>
<p>Synapse 1.0 is just one component of a larger Matrix 1.0 release, which you can <a href="/blog/2019/06/11/introducing-matrix-1-0-and-the-matrix-org-foundation">read all about here</a>.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.0.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up <a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 0.99.5 follows:</p>
<h1 id="synapse-1-0-0-2019-06-11">Synapse 1.0.0 (2019-06-11)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where attempting to send transactions with large number of EDUs can fail. (<a href="https://github.com/matrix-org/synapse/issues/5418">#5418</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Expand the federation guide to include relevant content from the MSC1711 FAQ (<a href="https://github.com/matrix-org/synapse/issues/5419">#5419</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Move password reset links to /_matrix/client/unstable namespace. (<a href="https://github.com/matrix-org/synapse/issues/5424">#5424</a>)</li>
</ul>
<h1 id="synapse-1-0-0rc3-2019-06-10">Synapse 1.0.0rc3 (2019-06-10)</h1>
<p>Security: Fix authentication bug introduced in 1.0.0rc1. Please upgrade to rc3 immediately</p>
<h1 id="synapse-1-0-0rc2-2019-06-10">Synapse 1.0.0rc2 (2019-06-10)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Remove redundant warning about key server response validation. (<a href="https://github.com/matrix-org/synapse/issues/5392">#5392</a>)</li>
<li>Fix bug where old keys stored in the database with a null valid until timestamp caused all verification requests for that key to fail. (<a href="https://github.com/matrix-org/synapse/issues/5415">#5415</a>)</li>
<li>Fix excessive memory using with default <code>federation_verify_certificates: true</code> configuration. (<a href="https://github.com/matrix-org/synapse/issues/5417">#5417</a>)</li>
</ul>
<h1 id="synapse-1-0-0rc1-2019-06-07">Synapse 1.0.0rc1 (2019-06-07)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Synapse now more efficiently collates room statistics. (<a href="https://github.com/matrix-org/synapse/issues/4338">#4338</a>, <a href="https://github.com/matrix-org/synapse/issues/5260">#5260</a>, <a href="https://github.com/matrix-org/synapse/issues/5324">#5324</a>)</li>
<li>Add experimental support for relations (aka reactions and edits). (<a href="https://github.com/matrix-org/synapse/issues/5220">#5220</a>)</li>
<li>Ability to configure default room version. (<a href="https://github.com/matrix-org/synapse/issues/5223">#5223</a>, <a href="https://github.com/matrix-org/synapse/issues/5249">#5249</a>)</li>
<li>Allow configuring a range for the account validity startup job. (<a href="https://github.com/matrix-org/synapse/issues/5276">#5276</a>)</li>
<li>CAS login will now hit the r0 API, not the deprecated v1 one. (<a href="https://github.com/matrix-org/synapse/issues/5286">#5286</a>)</li>
<li>Validate federation server TLS certificates by default (implements <a href="https://github.com/matrix-org/matrix-doc/blob/master/proposals/1711-x509-for-federation.md">MSC1711</a>). (<a href="https://github.com/matrix-org/synapse/issues/5359">#5359</a>)</li>
<li>Update /_matrix/client/versions to reference support for r0.5.0. (<a href="https://github.com/matrix-org/synapse/issues/5360">#5360</a>)</li>
<li>Add a script to generate new signing-key files. (<a href="https://github.com/matrix-org/synapse/issues/5361">#5361</a>)</li>
<li>Update upgrade and installation guides ahead of 1.0. (<a href="https://github.com/matrix-org/synapse/issues/5371">#5371</a>)</li>
<li>Replace the <code>perspectives</code> configuration section with <code>trusted_key_servers</code>, and make validating the signatures on responses optional (since TLS will do this job for us). (<a href="https://github.com/matrix-org/synapse/issues/5374">#5374</a>)</li>
<li>Add ability to perform password reset via email without trusting the identity server. (<a href="https://github.com/matrix-org/synapse/issues/5377">#5377</a>)</li>
<li>Set default room version to v4. (<a href="https://github.com/matrix-org/synapse/issues/5379">#5379</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Fixes client-server API not sending &quot;m.heroes&quot; to lazy-load /sync requests when a rooms name or its canonical alias are empty. Thanks to @dnaf for this work! (<a href="https://github.com/matrix-org/synapse/issues/5089">#5089</a>)</li>
<li>Prevent federation device list updates breaking when processing multiple updates at once. (<a href="https://github.com/matrix-org/synapse/issues/5156">#5156</a>)</li>
<li>Fix worker registration bug caused by ClientReaderSlavedStore being unable to see get_profileinfo. (<a href="https://github.com/matrix-org/synapse/issues/5200">#5200</a>)</li>
<li>Fix race when backfilling in rooms with worker mode. (<a href="https://github.com/matrix-org/synapse/issues/5221">#5221</a>)</li>
<li>Fix appservice timestamp massaging. (<a href="https://github.com/matrix-org/synapse/issues/5233">#5233</a>)</li>
<li>Ensure that server_keys fetched via a notary server are correctly signed. (<a href="https://github.com/matrix-org/synapse/issues/5251">#5251</a>)</li>
<li>Show the correct error when logging out and access token is missing. (<a href="https://github.com/matrix-org/synapse/issues/5256">#5256</a>)</li>
<li>Fix error code when there is an invalid parameter on /_matrix/client/r0/publicRooms (<a href="https://github.com/matrix-org/synapse/issues/5257">#5257</a>)</li>
<li>Fix error when downloading thumbnail with missing width/height parameter. (<a href="https://github.com/matrix-org/synapse/issues/5258">#5258</a>)</li>
<li>Fix schema update for account validity. (<a href="https://github.com/matrix-org/synapse/issues/5268">#5268</a>)</li>
<li>Fix bug where we leaked extremities when we soft failed events, leading to performance degradation. (<a href="https://github.com/matrix-org/synapse/issues/5274">#5274</a>, <a href="https://github.com/matrix-org/synapse/issues/5278">#5278</a>, <a href="https://github.com/matrix-org/synapse/issues/5291">#5291</a>)</li>
<li>Fix &quot;db txn 'update_presence' from sentinel context&quot; log messages. (<a href="https://github.com/matrix-org/synapse/issues/5275">#5275</a>)</li>
<li>Fix dropped logcontexts during high outbound traffic. (<a href="https://github.com/matrix-org/synapse/issues/5277">#5277</a>)</li>
<li>Fix a bug where it is not possible to get events in the federation format with the request <code>GET /_matrix/client/r0/rooms/{roomId}/messages</code>. (<a href="https://github.com/matrix-org/synapse/issues/5293">#5293</a>)</li>
<li>Fix performance problems with the rooms stats background update. (<a href="https://github.com/matrix-org/synapse/issues/5294">#5294</a>)</li>
<li>Fix noisy 'no key for server' logs. (<a href="https://github.com/matrix-org/synapse/issues/5300">#5300</a>)</li>
<li>Fix bug where a notary server would sometimes forget old keys. (<a href="https://github.com/matrix-org/synapse/issues/5307">#5307</a>)</li>
<li>Prevent users from setting huge displaynames and avatar URLs. (<a href="https://github.com/matrix-org/synapse/issues/5309">#5309</a>)</li>
<li>Fix handling of failures when processing incoming events where calling <code>/event_auth</code> on remote server fails. (<a href="https://github.com/matrix-org/synapse/issues/5317">#5317</a>)</li>
<li>Ensure that we have an up-to-date copy of the signing key when validating incoming federation requests. (<a href="https://github.com/matrix-org/synapse/issues/5321">#5321</a>)</li>
<li>Fix various problems which made the signing-key notary server time out for some requests. (<a href="https://github.com/matrix-org/synapse/issues/5333">#5333</a>)</li>
<li>Fix bug which would make certain operations (such as room joins) block for 20 minutes while attemoting to fetch verification keys. (<a href="https://github.com/matrix-org/synapse/issues/5334">#5334</a>)</li>
<li>Fix a bug where we could rapidly mark a server as unreachable even though it was only down for a few minutes. (<a href="https://github.com/matrix-org/synapse/issues/5335">#5335</a>, <a href="https://github.com/matrix-org/synapse/issues/5340">#5340</a>)</li>
<li>Fix a bug where account validity renewal emails could only be sent when email notifs were enabled. (<a href="https://github.com/matrix-org/synapse/issues/5341">#5341</a>)</li>
<li>Fix failure when fetching batches of events during backfill, etc. (<a href="https://github.com/matrix-org/synapse/issues/5342">#5342</a>)</li>
<li>Add a new room version where the timestamps on events are checked against the validity periods on signing keys. (<a href="https://github.com/matrix-org/synapse/issues/5348">#5348</a>, <a href="https://github.com/matrix-org/synapse/issues/5354">#5354</a>)</li>
<li>Fix room stats and presence background updates to correctly handle missing events. (<a href="https://github.com/matrix-org/synapse/issues/5352">#5352</a>)</li>
<li>Include left members in room summaries' heroes. (<a href="https://github.com/matrix-org/synapse/issues/5355">#5355</a>)</li>
<li>Fix <code>federation_custom_ca_list</code> configuration option. (<a href="https://github.com/matrix-org/synapse/issues/5362">#5362</a>)</li>
<li>Fix missing logcontext warnings on shutdown. (<a href="https://github.com/matrix-org/synapse/issues/5369">#5369</a>)</li>
</ul>
<h2 id="improved-documentation-1">Improved Documentation</h2>
<ul>
<li>Fix docs on resetting the user directory. (<a href="https://github.com/matrix-org/synapse/issues/5282">#5282</a>)</li>
<li>Fix notes about ACME in the MSC1711 faq. (<a href="https://github.com/matrix-org/synapse/issues/5357">#5357</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Synapse will now serve the experimental &quot;room complexity&quot; API endpoint. (<a href="https://github.com/matrix-org/synapse/issues/5216">#5216</a>)</li>
<li>The base classes for the v1 and v2_alpha REST APIs have been unified. (<a href="https://github.com/matrix-org/synapse/issues/5226">#5226</a>, <a href="https://github.com/matrix-org/synapse/issues/5328">#5328</a>)</li>
<li>Simplifications and comments in do_auth. (<a href="https://github.com/matrix-org/synapse/issues/5227">#5227</a>)</li>
<li>Remove urllib3 pin as requests 2.22.0 has been released supporting urllib3 1.25.2. (<a href="https://github.com/matrix-org/synapse/issues/5230">#5230</a>)</li>
<li>Preparatory work for key-validity features. (<a href="https://github.com/matrix-org/synapse/issues/5232">#5232</a>, <a href="https://github.com/matrix-org/synapse/issues/5234">#5234</a>, <a href="https://github.com/matrix-org/synapse/issues/5235">#5235</a>, <a href="https://github.com/matrix-org/synapse/issues/5236">#5236</a>, <a href="https://github.com/matrix-org/synapse/issues/5237">#5237</a>, <a href="https://github.com/matrix-org/synapse/issues/5244">#5244</a>, <a href="https://github.com/matrix-org/synapse/issues/5250">#5250</a>, <a href="https://github.com/matrix-org/synapse/issues/5296">#5296</a>, <a href="https://github.com/matrix-org/synapse/issues/5299">#5299</a>, <a href="https://github.com/matrix-org/synapse/issues/5343">#5343</a>, <a href="https://github.com/matrix-org/synapse/issues/5347">#5347</a>, <a href="https://github.com/matrix-org/synapse/issues/5356">#5356</a>)</li>
<li>Specify the type of reCAPTCHA key to use. (<a href="https://github.com/matrix-org/synapse/issues/5283">#5283</a>)</li>
<li>Improve sample config for monthly active user blocking. (<a href="https://github.com/matrix-org/synapse/issues/5284">#5284</a>)</li>
<li>Remove spurious debug from MatrixFederationHttpClient.get_json. (<a href="https://github.com/matrix-org/synapse/issues/5287">#5287</a>)</li>
<li>Improve logging for logcontext leaks. (<a href="https://github.com/matrix-org/synapse/issues/5288">#5288</a>)</li>
<li>Clarify that the admin change password API logs the user out. (<a href="https://github.com/matrix-org/synapse/issues/5303">#5303</a>)</li>
<li>New installs will now use the v54 full schema, rather than the full schema v14 and applying incremental updates to v54. (<a href="https://github.com/matrix-org/synapse/issues/5320">#5320</a>)</li>
<li>Improve docstrings on MatrixFederationClient. (<a href="https://github.com/matrix-org/synapse/issues/5332">#5332</a>)</li>
<li>Clean up FederationClient.get_events for clarity. (<a href="https://github.com/matrix-org/synapse/issues/5344">#5344</a>)</li>
<li>Various improvements to debug logging. (<a href="https://github.com/matrix-org/synapse/issues/5353">#5353</a>)</li>
<li>Don't run CI build checks until sample config check has passed. (<a href="https://github.com/matrix-org/synapse/issues/5370">#5370</a>)</li>
<li>Automatically retry buildkite builds (max twice) when an agent is lost. (<a href="https://github.com/matrix-org/synapse/issues/5380">#5380</a>)</li>
</ul>

                
            </div>
        </article>
        
        <nav class="pagination">
    <div class="prev">
        
        <a href="&#x2F;category&#x2F;releases&#x2F;page&#x2F;10&#x2F;">‹ Previous</a>
        
    </div>
    <span class="page-number">11 / 14</span>
    <div class="prev">
        
        <a href="&#x2F;category&#x2F;releases&#x2F;page&#x2F;12&#x2F;">Next ›</a>
        
    </div>
</nav>

    </div>
</div>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
