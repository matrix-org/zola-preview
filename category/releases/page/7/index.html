<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Releases</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <link rel="stylesheet" href="/style.css" />

    
<link rel="alternate" type="application/rss+xml" title="RSS" href="/category/releases/atom.xml">
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        <a href="&#x2F;docs&#x2F;" class="
            ">
            Documentation
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="ecosystem-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true" >
            <label for="ecosystem-submenu-checkbox" class="submenu-title">Ecosystem <div class="arrow"></div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<div id="taxonomy-single">
    <div class="content">
        <header>
            <h1>Releases</h1>
            132 posts tagged with "Releases" <a href="/category">(See all Category)</a>
            
            <h2>
                <small><a href="/category/releases/atom.xml">Atom Feed</a></small>
            </h2>
            
        </header>

        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;11&#x2F;18&#x2F;synapse-1-23-0-released&#x2F;" title="Synapse 1.23.0 released">Synapse 1.23.0 released</a></h2>
                <span>
                    18.11.2020 00:00
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/dan-callahan">
                        Dan Callahan
                    </a>
                </span>
                
            </header>
            <div>
                
                <blockquote>
<p><strong>Reminder:</strong> On Monday, we will be announcing a denial of service vulnerability which affects Synapse versions prior to 1.20.0. If you have not upgraded recently, please do so.</p>
</blockquote>
<p><a href="https://github.com/matrix-org/synapse/releases/tag/v1.23.0">Synapse 1.23.0</a> now available!</p>
<p>For Synapse admins, this release support generating structured logs via the standard logging configuration (<a href="https://github.com/matrix-org/synapse/issues/8607">#8607</a>, <a href="https://github.com/matrix-org/synapse/issues/8685">#8685</a>). This may require changing your synapse configuration; see the <a href="https://github.com/matrix-org/synapse/blob/v1.23.0rc1/UPGRADE.rst#upgrading-to-v1230">upgrade notes</a> for more information.</p>
<p>We've also added many new Admin APIs, contributed by <a href="https://github.com/dklimpel">@dklimpel</a>:</p>
<ul>
<li>Add API to get information about uploaded media (<a href="https://github.com/matrix-org/synapse/issues/8647">#8647</a>)</li>
<li>Add API for local user media statistics (<a href="https://github.com/matrix-org/synapse/issues/8700">#8700</a>)</li>
<li>Make it possible to delete files that were not used for a defined time (<a href="https://github.com/matrix-org/synapse/issues/8519">#8519</a>)</li>
<li>Split API for reported events into detail and list endpoints. This is a breaking change to <a href="https://github.com/matrix-org/synapse/issues/8217">#8217</a> which was introduced in Synapse v1.21.0. Those who already use this API should check their scripts (<a href="https://github.com/matrix-org/synapse/issues/8539">#8539</a>) </li>
<li>Allow server admins to list users' notification pushers (<a href="https://github.com/matrix-org/synapse/issues/8610">#8610</a>, <a href="https://github.com/matrix-org/synapse/issues/8689">#8689</a>)</li>
</ul>
<p>Lastly, Synapse 1.23.0 addresses some significant bugs, including regressions in the SQLite-to-PostgreSQL database porting script (<a href="http://github.com/matrix-org/synapse/issues/8729">#8729</a>, <a href="http://github.com/matrix-org/synapse/issues/8730">#8730</a>, <a href="http://github.com/matrix-org/synapse/issues/8755">#8755</a>) and an issue which could prevent Synapse from recovering after losing its connection to its database (<a href="https://github.com/matrix-org/synapse/issues/8726">#8726</a>). Synapse will also reject ACL modifications from clients which would otherwise cause a server to ban itself from a room (<a href="https://github.com/matrix-org/synapse/issues/8708">#8708</a>).</p>
<p>Installation instructions are available <a href="https://github.com/matrix-org/synapse/blob/master/INSTALL.md">on GitHub</a>, as is the <code>v1.23.0</code> <a href="https://github.com/matrix-org/synapse/releases/tag/v1.23.0">release tag</a>.</p>
<p>Synapse is a Free and Open Source Software project, and we'd like to extend our thanks to everyone who contributed to this release, including <a href="https://github.com/chagai95">@chagai95</a> and <a href="https://github.com/dklimpel">@dklimpel</a>.</p>
<p>The full changelog for 1.23.0 is as follows:</p>
<h1 id="synapse-1-23-0-2020-11-18">Synapse 1.23.0 (2020-11-18)</h1>
<p>This release changes the way structured logging is configured. See the <a href="UPGRADE.rst#upgrading-to-v1230">upgrade notes</a> for details.</p>
<p><strong>Note</strong>: We are aware of a trivially exploitable denial of service vulnerability in versions of Synapse prior to 1.20.0. Complete details will be disclosed on Monday, November 23rd. If you have not upgraded recently, please do so.</p>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix a dependency versioning bug in the Dockerfile that prevented Synapse from starting. (<a href="https://github.com/matrix-org/synapse/issues/8767">#8767</a>)</li>
</ul>
<h1 id="synapse-1-23-0rc1-2020-11-13">Synapse 1.23.0rc1 (2020-11-13)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Add a push rule that highlights when a jitsi conference is created in a room. (<a href="https://github.com/matrix-org/synapse/issues/8286">#8286</a>)</li>
<li>Add an admin api to delete a single file or files that were not used for a defined time from server. Contributed by @dklimpel. (<a href="https://github.com/matrix-org/synapse/issues/8519">#8519</a>)</li>
<li>Split admin API for reported events (<code>GET /_synapse/admin/v1/event_reports</code>) into detail and list endpoints. This is a breaking change to #8217 which was introduced in Synapse v1.21.0. Those who already use this API should check their scripts. Contributed by @dklimpel. (<a href="https://github.com/matrix-org/synapse/issues/8539">#8539</a>)</li>
<li>Support generating structured logs via the standard logging configuration. (<a href="https://github.com/matrix-org/synapse/issues/8607">#8607</a>, <a href="https://github.com/matrix-org/synapse/issues/8685">#8685</a>)</li>
<li>Add an admin API to allow server admins to list users' pushers. Contributed by @dklimpel. (<a href="https://github.com/matrix-org/synapse/issues/8610">#8610</a>, <a href="https://github.com/matrix-org/synapse/issues/8689">#8689</a>)</li>
<li>Add an admin API <code>GET /_synapse/admin/v1/users/&lt;user_id&gt;/media</code> to get information about uploaded media. Contributed by @dklimpel. (<a href="https://github.com/matrix-org/synapse/issues/8647">#8647</a>)</li>
<li>Add an admin API for local user media statistics. Contributed by @dklimpel. (<a href="https://github.com/matrix-org/synapse/issues/8700">#8700</a>)</li>
<li>Add <code>displayname</code> to Shared-Secret Registration for admins. (<a href="https://github.com/matrix-org/synapse/issues/8722">#8722</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix fetching of E2E cross signing keys over federation when only one of the master key and device signing key is cached already. (<a href="https://github.com/matrix-org/synapse/issues/8455">#8455</a>)</li>
<li>Fix a bug where Synapse would blindly forward bad responses from federation to clients when retrieving profile information. (<a href="https://github.com/matrix-org/synapse/issues/8580">#8580</a>)</li>
<li>Fix a bug where the account validity endpoint would silently fail if the user ID did not have an expiration time. It now returns a 400 error. (<a href="https://github.com/matrix-org/synapse/issues/8620">#8620</a>)</li>
<li>Fix email notifications for invites without local state. (<a href="https://github.com/matrix-org/synapse/issues/8627">#8627</a>)</li>
<li>Fix handling of invalid group IDs to return a 400 rather than log an exception and return a 500. (<a href="https://github.com/matrix-org/synapse/issues/8628">#8628</a>)</li>
<li>Fix handling of User-Agent headers that are invalid UTF-8, which caused user agents of users to not get correctly recorded. (<a href="https://github.com/matrix-org/synapse/issues/8632">#8632</a>)</li>
<li>Fix a bug in the <code>joined_rooms</code> admin API if the user has never joined any rooms. The bug was introduced, along with the API, in v1.21.0. (<a href="https://github.com/matrix-org/synapse/issues/8643">#8643</a>)</li>
<li>Fix exception during handling multiple concurrent requests for remote media when using multiple media repositories. (<a href="https://github.com/matrix-org/synapse/issues/8682">#8682</a>)</li>
<li>Fix bug that prevented Synapse from recovering after losing connection to the database. (<a href="https://github.com/matrix-org/synapse/issues/8726">#8726</a>)</li>
<li>Fix bug where the <code>/_synapse/admin/v1/send_server_notice</code> API could send notices to non-notice rooms. (<a href="https://github.com/matrix-org/synapse/issues/8728">#8728</a>)</li>
<li>Fix PostgreSQL port script fails when DB has no backfilled events. Broke in v1.21.0. (<a href="https://github.com/matrix-org/synapse/issues/8729">#8729</a>)</li>
<li>Fix PostgreSQL port script to correctly handle foreign key constraints. Broke in v1.21.0. (<a href="https://github.com/matrix-org/synapse/issues/8730">#8730</a>)</li>
<li>Fix PostgreSQL port script so that it can be run again after a failure. Broke in v1.21.0. (<a href="https://github.com/matrix-org/synapse/issues/8755">#8755</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Instructions for Azure AD in the OpenID Connect documentation. Contributed by peterk. (<a href="https://github.com/matrix-org/synapse/issues/8582">#8582</a>)</li>
<li>Improve the sample configuration for single sign-on providers. (<a href="https://github.com/matrix-org/synapse/issues/8635">#8635</a>)</li>
<li>Fix the filepath of Dex's example config and the link to Dex's Getting Started guide in the OpenID Connect docs. (<a href="https://github.com/matrix-org/synapse/issues/8657">#8657</a>)</li>
<li>Note support for Python 3.9. (<a href="https://github.com/matrix-org/synapse/issues/8665">#8665</a>)</li>
<li>Minor updates to docs on running tests. (<a href="https://github.com/matrix-org/synapse/issues/8666">#8666</a>)</li>
<li>Interlink prometheus/grafana documentation. (<a href="https://github.com/matrix-org/synapse/issues/8667">#8667</a>)</li>
<li>Notes on SSO logins and media_repository worker. (<a href="https://github.com/matrix-org/synapse/issues/8701">#8701</a>)</li>
<li>Document experimental support for running multiple event persisters. (<a href="https://github.com/matrix-org/synapse/issues/8706">#8706</a>)</li>
<li>Add information regarding the various sources of, and expected contributions to, Synapse's documentation to <code>CONTRIBUTING.md</code>. (<a href="https://github.com/matrix-org/synapse/issues/8714">#8714</a>)</li>
<li>Migrate documentation <code>docs/admin_api/event_reports</code> to markdown. (<a href="https://github.com/matrix-org/synapse/issues/8742">#8742</a>)</li>
<li>Add some helpful hints to the README for new Synapse developers. Contributed by @chagai95. (<a href="https://github.com/matrix-org/synapse/issues/8746">#8746</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Optimise <code>/createRoom</code> with multiple invited users. (<a href="https://github.com/matrix-org/synapse/issues/8559">#8559</a>)</li>
<li>Implement and use an <code>@lru_cache</code> decorator. (<a href="https://github.com/matrix-org/synapse/issues/8595">#8595</a>)</li>
<li>Don't instantiate Requester directly. (<a href="https://github.com/matrix-org/synapse/issues/8614">#8614</a>)</li>
<li>Type hints for <code>RegistrationStore</code>. (<a href="https://github.com/matrix-org/synapse/issues/8615">#8615</a>)</li>
<li>Change schema to support access tokens belonging to one user but granting access to another. (<a href="https://github.com/matrix-org/synapse/issues/8616">#8616</a>)</li>
<li>Remove unused OPTIONS handlers. (<a href="https://github.com/matrix-org/synapse/issues/8621">#8621</a>)</li>
<li>Run <code>mypy</code> as part of the lint.sh script. (<a href="https://github.com/matrix-org/synapse/issues/8633">#8633</a>)</li>
<li>Correct Synapse's PyPI package name in the OpenID Connect installation instructions. (<a href="https://github.com/matrix-org/synapse/issues/8634">#8634</a>)</li>
<li>Catch exceptions during initialization of <code>password_providers</code>. Contributed by Nicolai S√∏borg. (<a href="https://github.com/matrix-org/synapse/issues/8636">#8636</a>)</li>
<li>Fix typos and spelling errors in the code. (<a href="https://github.com/matrix-org/synapse/issues/8639">#8639</a>)</li>
<li>Reduce number of OpenTracing spans started. (<a href="https://github.com/matrix-org/synapse/issues/8640">#8640</a>, <a href="https://github.com/matrix-org/synapse/issues/8668">#8668</a>, <a href="https://github.com/matrix-org/synapse/issues/8670">#8670</a>)</li>
<li>Add field <code>total</code> to device list in admin API. (<a href="https://github.com/matrix-org/synapse/issues/8644">#8644</a>)</li>
<li>Add more type hints to the application services code. (<a href="https://github.com/matrix-org/synapse/issues/8655">#8655</a>, <a href="https://github.com/matrix-org/synapse/issues/8693">#8693</a>)</li>
<li>Tell Black to format code for Python 3.5. (<a href="https://github.com/matrix-org/synapse/issues/8664">#8664</a>)</li>
<li>Don't pull event from DB when handling replication traffic. (<a href="https://github.com/matrix-org/synapse/issues/8669">#8669</a>)</li>
<li>Abstract some invite-related code in preparation for landing knocking. (<a href="https://github.com/matrix-org/synapse/issues/8671">#8671</a>, <a href="https://github.com/matrix-org/synapse/issues/8688">#8688</a>)</li>
<li>Clarify representation of events in logfiles. (<a href="https://github.com/matrix-org/synapse/issues/8679">#8679</a>)</li>
<li>Don't require <code>hiredis</code> package to be installed to run unit tests. (<a href="https://github.com/matrix-org/synapse/issues/8680">#8680</a>)</li>
<li>Fix typing info on cache call signature to accept <code>on_invalidate</code>. (<a href="https://github.com/matrix-org/synapse/issues/8684">#8684</a>)</li>
<li>Fail tests if they do not await coroutines. (<a href="https://github.com/matrix-org/synapse/issues/8690">#8690</a>)</li>
<li>Improve start time by adding an index to <code>e2e_cross_signing_keys.stream_id</code>. (<a href="https://github.com/matrix-org/synapse/issues/8694">#8694</a>)</li>
<li>Re-organize the structured logging code to separate the TCP transport handling from the JSON formatting. (<a href="https://github.com/matrix-org/synapse/issues/8697">#8697</a>)</li>
<li>Use Python 3.8 in Docker images by default. (<a href="https://github.com/matrix-org/synapse/issues/8698">#8698</a>)</li>
<li>Remove the &quot;draft&quot; status of the Room Details Admin API. (<a href="https://github.com/matrix-org/synapse/issues/8702">#8702</a>)</li>
<li>Improve the error returned when a non-string displayname or avatar_url is used when updating a user's profile. (<a href="https://github.com/matrix-org/synapse/issues/8705">#8705</a>)</li>
<li>Block attempts by clients to send server ACLs, or redactions of server ACLs, that would result in the local server being blocked from the room. (<a href="https://github.com/matrix-org/synapse/issues/8708">#8708</a>)</li>
<li>Add metrics the allow the local sysadmin to track 3PID <code>/requestToken</code> requests. (<a href="https://github.com/matrix-org/synapse/issues/8712">#8712</a>)</li>
<li>Consolidate duplicated lists of purged tables that are checked in tests. (<a href="https://github.com/matrix-org/synapse/issues/8713">#8713</a>)</li>
<li>Add some <code>mdui:UIInfo</code> element examples for <code>saml2_config</code> in the homeserver config. (<a href="https://github.com/matrix-org/synapse/issues/8718">#8718</a>)</li>
<li>Improve the error message returned when a remote server incorrectly sets the <code>Content-Type</code> header in response to a JSON request. (<a href="https://github.com/matrix-org/synapse/issues/8719">#8719</a>)</li>
<li>Speed up repeated state resolutions on the same room by caching event ID to auth event ID lookups. (<a href="https://github.com/matrix-org/synapse/issues/8752">#8752</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;11&#x2F;16&#x2F;dendrite-0-3-0-released&#x2F;" title="Dendrite 0.3.0 released">Dendrite 0.3.0 released</a></h2>
                <span>
                    16.11.2020 17:44
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Heads up that we just cut another beta release of Dendrite - now at 0.3.0!</p>
<p>This is a really fun release given almost all the changes are contributed from
the wider community - so huge thanks to <a href="https://github.com/S7evinK">S7evinK</a>,
<a href="https://github.com/MayeulC">MayeulC</a> and <a href="https://github.com/felix">felix</a>!</p>
<p>The main new feature is full Read Receipt support thanks to S7evinK, which
makes an enormous perceptual improvement when using Dendrite - so especial
thanks are due there :)</p>
<p>So, if you're interested in helping us test, please spin up a copy from
https://github.com/matrix-org/dendrite and let us know how it goes - and if you're
already running one, now is an excellent time to upgrade!</p>
<p>Full changelog (including 0.2.1, which we forgot to blog about) follows:</p>
<h2 id="dendrite-0-3-0-2020-11-16">Dendrite 0.3.0 (2020-11-16)</h2>
<h3 id="features">Features</h3>
<ul>
<li>Read receipts (both inbound and outbound) are now supported (contributed by <a href="https://github.com/S7evinK">S7evinK</a>)</li>
<li>Forgetting rooms is now supported (contributed by <a href="https://github.com/S7evinK">S7evinK</a>)</li>
<li>The <code>-version</code> command line flag has been added (contributed by <a href="https://github.com/S7evinK">S7evinK</a>)</li>
</ul>
<h3 id="fixes">Fixes</h3>
<ul>
<li>User accounts that contain the <code>=</code> character can now be registered</li>
<li>Backfilling should now work properly on rooms with world-readable history visibility (contributed by <a href="https://github.com/MayeulC">MayeulC</a>)</li>
<li>The <code>gjson</code> dependency has been updated for correct JSON integer ranges</li>
<li>Some more client event fields have been marked as omit-when-empty (contributed by <a href="https://github.com/S7evinK">S7evinK</a>)</li>
<li>The <code>build.sh</code> script has been updated to work properly on all POSIX platforms (contributed by <a href="https://github.com/felix">felix</a>)</li>
</ul>
<h2 id="dendrite-0-2-1-2020-10-22">Dendrite 0.2.1 (2020-10-22)</h2>
<h3 id="fixes-1">Fixes</h3>
<ul>
<li>Forward extremities are now calculated using only references from other extremities, rather than including outliers, which should fix cases where state can become corrupted (<a href="https://github.com/matrix-org/dendrite/pull/1556">#1556</a>)</li>
<li>Old state events will no longer be processed by the sync API as new, which should fix some cases where clients incorrectly believe they have joined or left rooms (<a href="https://github.com/matrix-org/dendrite/pull/1548">#1548</a>)</li>
<li>More SQLite database locking issues have been resolved in the latest events updater (<a href="https://github.com/matrix-org/dendrite/pull/1554">#1554</a>)</li>
<li>Internal HTTP API calls are now made using H2C (HTTP/2) in polylith mode, mitigating some potential head-of-line blocking issues (<a href="https://github.com/matrix-org/dendrite/pull/1541">#1541</a>)</li>
<li>Roomserver output events no longer incorrectly flag state rewrites (<a href="https://github.com/matrix-org/dendrite/pull/1557">#1557</a>)</li>
<li>Notification levels are now parsed correctly in power level events (<a href="https://github.com/matrix-org/gomatrixserverlib/pull/228">gomatrixserverlib#228</a>, contributed by <a href="https://github.com/Pestdoktor">Pestdoktor</a>)</li>
<li>Invalid UTF-8 is now correctly rejected when making federation requests (<a href="https://github.com/matrix-org/gomatrixserverlib/pull/229">gomatrixserverlib#229</a>, contributed by <a href="https://github.com/Pestdoktor">Pestdoktor</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;11&#x2F;03&#x2F;how-we-fixed-synapse-s-scalability&#x2F;" title="How we fixed Synapse&#x27;s scalability!">How we fixed Synapse&#x27;s scalability!</a></h2>
                <span>
                    03.11.2020 00:00
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>We had a major break-through in Synapse 1.22 which we want to talk about in
more detail: <strong>Synapse now scales horizontally across multiple python
processes.</strong></p>
<p>Horizontal scaling means that you can support more users and traffic by adding
in more python processes (spread over more machines, if necessary) without
there being a single bottleneck which all the traffic is passing through - as
opposed to vertical scaling where you make things go faster overall by making
the bottleneck go faster.</p>
<p>After many years of having to vertically scale Synapse (by trying to make the
main process go faster) we‚Äôre now finally at the point where you can configure
Synapse so that <strong>messages no longer flow through the main process</strong> -
eliminating the bottleneck entirely.  What‚Äôs more, the Matrix.org homeserver
has now been successfully running in this config and enjoying the massive
scalability improvements for the last 2 weeks! Huge kudos goes to Erik and the
wider Synapse team for pulling this off.</p>
<p>Some readers might wonder how this ties in with <a href="https://matrix.org/blog/2020/10/08/dendrite-is-entering-beta">Dendrite entering
beta</a>, given one
of Dendrite‚Äôs design goals is full horizontal scalability.  The answer is that
we‚Äôre very much using Dendrite for experimentation and next-gen stuff at the
moment (currently focused more on scaling downwards for P2P rather than
scaling upwards for megaservers) - while Synapse is the stable and long-term
supported option.</p>
<p>So, that‚Äôs the context - now over to Erik with more than you could possibly
ever want to know about how we actually did it...</p>
<h2 id="background">Background</h2>
<p>Synapse started life off back in 2014 as a single monolithic python process,
and for quite a while we made it scale by adding more and more in-memory
caches to speed things up by avoiding hitting the database (at the expense of
RAM).  It looked like this:</p>
<div style="margin: auto; max-width: 640px;">
    <img src="/blog/img/2020-11-03-synapse1.png"/>
</div>
<p>Eventually the caches stopped helping and we needed more than one thread of
execution in order to spread CPU across multiple cores. Python‚Äôs Global
Interpreter Lock (<a href="https://wiki.python.org/moin/GlobalInterpreterLock">GIL</a>)
means that Python can mainly only use one CPU core at a time, so starting more
threads doesn‚Äôt help with scalability - you have to run multiple processes.</p>
<p>Now, the vast majority of the work that Synapse does is related to ‚Äústreams‚Äù.
These are append only sequences of rows, such as the events stream, typing
stream, receipts stream, etc. When a new event arrives (for example) we write
it to the events stream, and then notify anything waiting that there has been
an update. The <code>/sync</code> endpoint, for instance, will wait for updates to streams
and send them down to long-polling Matrix clients. </p>
<p>Streams support being added to concurrently, so have a concept of the
‚Äúpersisted up-to position‚Äù. This is the point where <strong>all</strong> rows before that
point have finished persisting. Readers only read up to the current ‚Äúpersisted
up-to position‚Äù, so that they don‚Äôt skip updates that haven‚Äôt finished
persisting at that point. (E.g. if two events A and B get assigned positions 5
and 6, but B finishes persisting first, then the persisted up to position will
remain at 4 until A finishes persisting and then it jumps to 6).</p>
<p>To split any meaningful amount of work into separate processes, we need to add
a mechanism where processes can be told that updates to streams have happened
(otherwise they‚Äôd have to repeatedly poll the DB, which would be deeply
inefficient). The architecture ended up being one where we had the ‚Äúmain‚Äù
process that streams updates via a custom replication protocol (initially
long-polling HTTP; later custom TCP) to any number of ‚Äúworker‚Äù processes. This
meant that we could move sync stream handling (and other read apis) off the
main process and onto workers, but also that all database writes had to go
through the single main process (as it was a star topology, the main process
could talk to all workers but workers could only talk to the main process and
not each other).</p>
<p><img src="/blog/img/2020-11-03-synapse2.png" alt="2020-11-03-synapse2.png" /></p>
<p>As an aside: cache invalidations also had to be streamed down the replication
connections, which has the side effect that we could only cache things that
would only be invalidated on the main process.</p>
<p>We continued to move more and more read APIs out onto separate workers. We
also added workers in front of the main process that would e.g. handle the
creation of the new events, authenticating, etc, and then call out to the main
process with the event for it to persist the event.</p>
<h2 id="moving-writes-off-the-main-process">Moving writes off the main process</h2>
<p>Eventually we ran out of stuff to move out of the main process that didn‚Äôt
involve writing to the DB. To write stuff from other processes we needed a way
for the workers to stream updates to each other. The easiest and most obvious
way was to just use Redis and its pub/sub support. </p>
<p><img src="/blog/img/2020-11-03-synapse3.png" alt="2020-11-03-synapse3.png" /></p>
<p>This almost allowed us to move writing of a particular stream to a different
worker, <em>except</em> writing to streams generally also meant invalidating caches
which in itself requires writing to a stream. We needed a way of writing to
the cache invalidation stream from multiple workers at once.</p>
<p>Sharding the cache invalidation thankfully turned out to be easy, as workers
would simply call the cache invalidation function whenever they get an
invalidation notice over replication. In particular, the ordering of
invalidations from different workers doesn‚Äôt matter and so there isn‚Äôt a need
to calculate a single ‚Äúpersisted up-to position‚Äù. Sharding then just becomes a
case of adding the name of the worker that is writing the update to the
replication stream, and then workers reading from it can basically treat the
cache stream the same as if they were multiple streams, one per worker.</p>
<p>This then unlocks the ability to move writing of streams off the main process
and onto different workers - and so we added the ‚Äúevent persister‚Äù worker for
offloading the main event stream off the main process:</p>
<p><img src="/blog/img/2020-11-03-synapse4.png" alt="2020-11-03-synapse4.png" /></p>
<h2 id="sharding-the-events-stream">Sharding the events stream</h2>
<p>Eventually the worker responsible for doing nothing but persisting events
started maxing out CPU. This meant that we had to look at sharding the events
stream, i.e. writing to it from multiple workers.</p>
<p>This is more complicated than sharding the cache invalidation stream as the
ordering of the events does matter; we send them down sync streams, in order,
with a token that indicates where the sync stream is up to in the events
stream. This means that workers need to be able to calculate a ‚Äúpersisted
up-to position‚Äù when getting updates from different workers. </p>
<p>The easiest way of doing that is to simply set the persisted up-to position as
the minimum position received over federation from all active writers. This
works, except events would only be processed after all other writers have
subsequently written events (to advance the persisted position past the point
at which the event was written), which can add a lot of latency depending on
how often events are written. </p>
<p>A refinement is to note that if you have a persisted up-to position of 10,
then receive updates at sequential positions 11, 12, 13 and 14, you know that
everything between 10 and 14 has finished persisting (as you received updates
about them), and so can set the persisted up-to position to 14. Annoyingly,
it‚Äôs not required that positions are sequential without gaps (due to various
technical considerations), and so in the worst case this still has the same
problems as the na√Øve solution.</p>
<p>To avoid these problems we change the persisted up-to position to be a <a href="https://en.wikipedia.org/wiki/Vector_clock">vector
clock</a> of positions; tracking a
vector of positions - one per writer. This still allows answering the query of
‚Äúget all events after token X‚Äù (as events are written with the position and
the name of the writer). The persisted up-to position is then calculated by
just tracking the last position seen to arrive over replication from each
writer. </p>
<p>This allows writing events from multiple workers, while ensuring that other
workers can correctly keep track of a ‚Äúpersisted up-to position‚Äù. Then it's
just a matter of inspecting the code to ensure that it does not assume that it
is the only writer to the stream. In the case of writing to the events stream,
we note that the function persisting events assumes it's the only writer for a
given room, so when sharding we have to ensure that there are no concurrent
writes to the same room. This is most easily done by sharding based on room
ID, and ensuring that the mapping of room ID to worker does not change
(without coordination).</p>
<p>The only thing left is to then encode the vector clock position into the sync
tokens. We want to ensure that these tokens are not too long, as they get
included as query string parameters (e.g. the <code>since=</code> parameter of <code>/sync</code>).
By assigning persistent unique integer IDs to workers the vector clock can be
persisted as a sequence of pairs of integers, which is relatively few bytes so
long as we don‚Äôt have too many workers writing to the events stream. We can
further reduce the size of the tokens by calculating an integer ‚Äúpersisted
up-to position‚Äù as we did before, encoding that and only including positions
for workers that are larger than the integer persisted upto position. (The
idea here is that most of the time only a small number of workers will be
ahead of the calculated persisted up-to position, and so we only need to
encode those).</p>
<p>And this is what we have today:</p>
<p><img src="/blog/img/2020-11-03-synapse5.png" alt="2020-11-03-synapse5.png" /></p>
<p>The major limitation of the current situation is that you can‚Äôt dynamically
add/remove workers which persist events, as the sharding by room ID is
calculated at startup, and so changing it requires restarting the whole
system. This could be replaced by any system that allowed coordination over
which persister is allowed to write to a room at any given point. However this
is likely tricky to get right in practice, but would allow dynamic auto
scaling of deployments, or automatically recovering from a worker that gets
wedged/dies.</p>
<p>Finally, it‚Äôs worth noting that sharding event persisters isn‚Äôt the only
performance work that‚Äôs been going on - switching everything over to python 3
and async twisted has helped, along with lots of smaller optimisations on the
hot paths, and further rebalancing workers (e.g. moving background jobs off
the master process to dedicated workers).  We‚Äôve also benefited a lot from the
maintainability of rolling out mypy typing throughout the codebase.  And next
up, we‚Äôll be going back to speeding up the codebase as a whole - starting with
algorithmic state resolution improvements! üéâ</p>
<h3 id="performance">Performance</h3>
<p>So, how does it stack up?</p>
<p>Here‚Äôs the send time heatmap on Matrix.org showing the step change on Oct 16th
when we rolled out the second event persister (full disclosure: this also
coincides with moving background processes off the main Synapse process to a
background worker).  As you can see, we go from messages being spread over a
huge range of durations (up to several seconds) to the sweet spot being 50ms
or less - a spectacular improvement!</p>
<p><img src="/blog/img/2020-11-03-synapse-heatmap.png" alt="2020-11-03-synapse-heatmap.png" /></p>
<p>Meanwhile, here‚Äôs the actual CPU utilisation as we split the traffic from a
single event persister (yellow) to two persisters (one yellow, one blue),
showing the sharding beautifully horizontally balancing CPU between the two
active/active worker processes:</p>
<p><img src="/blog/img/2020-11-03-synapse-cpu.png" alt="2020-11-03-synapse-cpu.png" /></p>
<p>We‚Äôve yet to loadtest to see just how fast we can go now (before we start
hitting bottlenecks on the postgres cluster), but it sure feels good to have
all our CPU headroom back on Matrix.org again, ready for the next wave of
users to arrive.</p>
<h3 id="conclusion">Conclusion</h3>
<p>So there you have it: folks running massive homeservers (50K+ concurrent
users) like Matrix.org (and <em>cough</em> various high profile public sector
deployments) are no longer held hostage by the bottleneck of the main synapse
process and should feel free to experiment with setting up event persister
workers to handle high traffic loads.  Otherwise, if you can spread your users
over smaller servers, that‚Äôs also a good bet (assuming they don‚Äôt have
massively overlapping room membership, like we see on Matrix.org.)</p>
<p>The current <a href="https://github.com/matrix-org/synapse/blob/develop/docs/workers.md">worker
documentation</a>
is up-to-date, although does assume you are already very familiar with how to
administer Synapse.  It‚Äôs also very much subject to change, as we keep adding
new workers and improving the architecture.  However, now is a pretty good
time to get involved if you‚Äôre interested in large-scale Matrix deployments.</p>
<p>-- The Synapse Team</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;10&#x2F;27&#x2F;synapse-1-22-0-released&#x2F;" title="Synapse 1.22.0 released">Synapse 1.22.0 released</a></h2>
                <span>
                    27.10.2020 17:01
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/dan-callahan">
                        Dan Callahan
                    </a>
                </span>
                
            </header>
            <div>
                
                <p><a href="https://github.com/matrix-org/synapse/releases/tag/v1.22.0">Synapse 1.22.0</a> now available!</p>
<p>This release focused on improving Synapse's horizontal scalability, including:</p>
<ul>
<li>Support for running background tasks in separate worker processes.</li>
<li>Fixes to sharded event persisters, which were experimentally introduced in 1.21.0.</li>
<li>Fixing a message duplication bug with worker-based deployments. (<a href="https://github.com/matrix-org/synapse/issues/8476">#8476</a>)</li>
</ul>
<p>Synapse 1.22.0 also has a few other notable changes:</p>
<ul>
<li>Defaulting to <a href="https://matrix.org/docs/spec/rooms/v6">version 6</a> rooms, per <a href="https://github.com/matrix-org/matrix-doc/pull/2788/">MSC2788</a>.</li>
<li>Initial support for three new experimental MSCs:
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2732">MSC2732</a>: Supporting olm fallback keys</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2697">MSC2697</a>: Supporting device dehydration</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2409">MSC2409</a>: Allowing appservices to receive ephemeral events like read receipts, presence, and typing indicators.</li>
</ul>
</li>
<li>Multi-arch Docker images, covering <code>arm64</code> and <code>arm/v7</code> in addition to <code>amd64</code>.</li>
</ul>
<p>Installation instructions are available <a href="https://github.com/matrix-org/synapse/blob/master/INSTALL.md">on GitHub</a>, as is the <code>v1.22.0</code> <a href="https://github.com/matrix-org/synapse/releases/tag/v1.22.0">release tag</a>.</p>
<p>Lastly, Synapse is a Free and Open Source Software project, and we'd like to extend our thanks to everyone who contributed to this release, including <a href="https://github.com/Akkowicz">@Akkowicz</a>, <a href="https://github.com/BBBSnowball">@BBBSnowball</a>, <a href="https://github.com/maquis196">@maquis196</a>, and <a href="https://github.com/samuel-p">@samuel-p</a>.</p>
<p>The full changelog for 1.22.0 is as follows:</p>
<h1 id="synapse-1-22-0-2020-10-27">Synapse 1.22.0 (2020-10-27)</h1>
<p>No significant changes.</p>
<h1 id="synapse-1-22-0rc2-2020-10-26">Synapse 1.22.0rc2 (2020-10-26)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bugs where ephemeral events were not sent to appservices. Broke in v1.22.0rc1. (<a href="https://github.com/matrix-org/synapse/issues/8648">#8648</a>, <a href="https://github.com/matrix-org/synapse/issues/8656">#8656</a>)</li>
<li>Fix <code>user_daily_visits</code> table to not have duplicate rows per user/device due to multiple user agents. Broke in v1.22.0rc1. (<a href="https://github.com/matrix-org/synapse/issues/8654">#8654</a>)</li>
</ul>
<h1 id="synapse-1-22-0rc1-2020-10-22">Synapse 1.22.0rc1 (2020-10-22)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Add a configuration option for always using the &quot;userinfo endpoint&quot; for OpenID Connect. This fixes support for some identity providers, e.g. GitLab. Contributed by Benjamin Koch. (<a href="https://github.com/matrix-org/synapse/issues/7658">#7658</a>)</li>
<li>Add ability for <code>ThirdPartyEventRules</code> modules to query and manipulate whether a room is in the public rooms directory. (<a href="https://github.com/matrix-org/synapse/issues/8292">#8292</a>, <a href="https://github.com/matrix-org/synapse/issues/8467">#8467</a>)</li>
<li>Add support for olm fallback keys (<a href="https://github.com/matrix-org/matrix-doc/pull/2732">MSC2732</a>). (<a href="https://github.com/matrix-org/synapse/issues/8312">#8312</a>, <a href="https://github.com/matrix-org/synapse/issues/8501">#8501</a>)</li>
<li>Add support for running background tasks in a separate worker process. (<a href="https://github.com/matrix-org/synapse/issues/8369">#8369</a>, <a href="https://github.com/matrix-org/synapse/issues/8458">#8458</a>, <a href="https://github.com/matrix-org/synapse/issues/8489">#8489</a>, <a href="https://github.com/matrix-org/synapse/issues/8513">#8513</a>, <a href="https://github.com/matrix-org/synapse/issues/8544">#8544</a>, <a href="https://github.com/matrix-org/synapse/issues/8599">#8599</a>)</li>
<li>Add support for device dehydration (<a href="https://github.com/matrix-org/matrix-doc/pull/2697">MSC2697</a>). (<a href="https://github.com/matrix-org/synapse/issues/8380">#8380</a>)</li>
<li>Add support for <a href="https://github.com/matrix-org/matrix-doc/pull/2409">MSC2409</a>, which allows sending typing, read receipts, and presence events to appservices. (<a href="https://github.com/matrix-org/synapse/issues/8437">#8437</a>, <a href="https://github.com/matrix-org/synapse/issues/8590">#8590</a>)</li>
<li>Change default room version to &quot;6&quot;, per <a href="https://github.com/matrix-org/matrix-doc/pull/2788">MSC2788</a>. (<a href="https://github.com/matrix-org/synapse/issues/8461">#8461</a>)</li>
<li>Add the ability to send non-membership events into a room via the <code>ModuleApi</code>. (<a href="https://github.com/matrix-org/synapse/issues/8479">#8479</a>)</li>
<li>Increase default upload size limit from 10M to 50M. Contributed by @Akkowicz. (<a href="https://github.com/matrix-org/synapse/issues/8502">#8502</a>)</li>
<li>Add support for modifying event content in <code>ThirdPartyRules</code> modules. (<a href="https://github.com/matrix-org/synapse/issues/8535">#8535</a>, <a href="https://github.com/matrix-org/synapse/issues/8564">#8564</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix a longstanding bug where invalid ignored users in account data could break clients. (<a href="https://github.com/matrix-org/synapse/issues/8454">#8454</a>)</li>
<li>Fix a bug where backfilling a room with an event that was missing the <code>redacts</code> field would break. (<a href="https://github.com/matrix-org/synapse/issues/8457">#8457</a>)</li>
<li>Don't attempt to respond to some requests if the client has already disconnected. (<a href="https://github.com/matrix-org/synapse/issues/8465">#8465</a>)</li>
<li>Fix message duplication if something goes wrong after persisting the event. (<a href="https://github.com/matrix-org/synapse/issues/8476">#8476</a>)</li>
<li>Fix incremental sync returning an incorrect <code>prev_batch</code> token in timeline section, which when used to paginate returned events that were included in the incremental sync. Broken since v0.16.0. (<a href="https://github.com/matrix-org/synapse/issues/8486">#8486</a>)</li>
<li>Expose the <code>uk.half-shot.msc2778.login.application_service</code> to clients from the login API. This feature was added in v1.21.0, but was not exposed as a potential login flow. (<a href="https://github.com/matrix-org/synapse/issues/8504">#8504</a>)</li>
<li>Fix error code for <code>/profile/{userId}/displayname</code> to be <code>M_BAD_JSON</code>. (<a href="https://github.com/matrix-org/synapse/issues/8517">#8517</a>)</li>
<li>Fix a bug introduced in v1.7.0 that could cause Synapse to insert values from non-state <code>m.room.retention</code> events into the <code>room_retention</code> database table. (<a href="https://github.com/matrix-org/synapse/issues/8527">#8527</a>)</li>
<li>Fix not sending events over federation when using sharded event writers. (<a href="https://github.com/matrix-org/synapse/issues/8536">#8536</a>)</li>
<li>Fix a long standing bug where email notifications for encrypted messages were blank. (<a href="https://github.com/matrix-org/synapse/issues/8545">#8545</a>)</li>
<li>Fix increase in the number of <code>There was no active span...</code> errors logged when using OpenTracing. (<a href="https://github.com/matrix-org/synapse/issues/8567">#8567</a>)</li>
<li>Fix a bug that prevented errors encountered during execution of the <code>synapse_port_db</code> from being correctly printed. (<a href="https://github.com/matrix-org/synapse/issues/8585">#8585</a>)</li>
<li>Fix appservice transactions to only include a maximum of 100 persistent and 100 ephemeral events. (<a href="https://github.com/matrix-org/synapse/issues/8606">#8606</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Added multi-arch support (arm64,arm/v7) for the docker images. Contributed by @maquis196. (<a href="https://github.com/matrix-org/synapse/issues/7921">#7921</a>)</li>
<li>Add support for passing commandline args to the synapse process. Contributed by @samuel-p. (<a href="https://github.com/matrix-org/synapse/issues/8390">#8390</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Update the directions for using the manhole with coroutines. (<a href="https://github.com/matrix-org/synapse/issues/8462">#8462</a>)</li>
<li>Improve readme by adding new shield.io badges. (<a href="https://github.com/matrix-org/synapse/issues/8493">#8493</a>)</li>
<li>Added note about docker in manhole.md regarding which ip address to bind to. Contributed by @Maquis196. (<a href="https://github.com/matrix-org/synapse/issues/8526">#8526</a>)</li>
<li>Document the new behaviour of the <code>allowed_lifetime_min</code> and <code>allowed_lifetime_max</code> settings in the room retention configuration. (<a href="https://github.com/matrix-org/synapse/issues/8529">#8529</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Drop unused <code>device_max_stream_id</code> table. (<a href="https://github.com/matrix-org/synapse/issues/8589">#8589</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Check for unreachable code with mypy. (<a href="https://github.com/matrix-org/synapse/issues/8432">#8432</a>)</li>
<li>Add unit test for event persister sharding. (<a href="https://github.com/matrix-org/synapse/issues/8433">#8433</a>)</li>
<li>Allow events to be sent to clients sooner when using sharded event persisters. (<a href="https://github.com/matrix-org/synapse/issues/8439">#8439</a>, <a href="https://github.com/matrix-org/synapse/issues/8488">#8488</a>, <a href="https://github.com/matrix-org/synapse/issues/8496">#8496</a>, <a href="https://github.com/matrix-org/synapse/issues/8499">#8499</a>)</li>
<li>Configure <code>public_baseurl</code> when using demo scripts. (<a href="https://github.com/matrix-org/synapse/issues/8443">#8443</a>)</li>
<li>Add SQL logging on queries that happen during startup. (<a href="https://github.com/matrix-org/synapse/issues/8448">#8448</a>)</li>
<li>Speed up unit tests when using PostgreSQL. (<a href="https://github.com/matrix-org/synapse/issues/8450">#8450</a>)</li>
<li>Remove redundant database loads of stream_ordering for events we already have. (<a href="https://github.com/matrix-org/synapse/issues/8452">#8452</a>)</li>
<li>Reduce inconsistencies between codepaths for membership and non-membership events. (<a href="https://github.com/matrix-org/synapse/issues/8463">#8463</a>)</li>
<li>Combine <code>SpamCheckerApi</code> with the more generic <code>ModuleApi</code>. (<a href="https://github.com/matrix-org/synapse/issues/8464">#8464</a>)</li>
<li>Additional testing for <code>ThirdPartyEventRules</code>. (<a href="https://github.com/matrix-org/synapse/issues/8468">#8468</a>)</li>
<li>Add <code>-d</code> option to <code>./scripts-dev/lint.sh</code> to lint files that have changed since the last git commit. (<a href="https://github.com/matrix-org/synapse/issues/8472">#8472</a>)</li>
<li>Unblacklist some sytests. (<a href="https://github.com/matrix-org/synapse/issues/8474">#8474</a>)</li>
<li>Include the log level in the phone home stats. (<a href="https://github.com/matrix-org/synapse/issues/8477">#8477</a>)</li>
<li>Remove outdated sphinx documentation, scripts and configuration. (<a href="https://github.com/matrix-org/synapse/issues/8480">#8480</a>)</li>
<li>Clarify error message when plugin config parsers raise an error. (<a href="https://github.com/matrix-org/synapse/issues/8492">#8492</a>)</li>
<li>Remove the deprecated <code>Handlers</code> object. (<a href="https://github.com/matrix-org/synapse/issues/8494">#8494</a>)</li>
<li>Fix a threadsafety bug in unit tests. (<a href="https://github.com/matrix-org/synapse/issues/8497">#8497</a>)</li>
<li>Add user agent to user_daily_visits table. (<a href="https://github.com/matrix-org/synapse/issues/8503">#8503</a>)</li>
<li>Add type hints to various parts of the code base. (<a href="https://github.com/matrix-org/synapse/issues/8407">#8407</a>, <a href="https://github.com/matrix-org/synapse/issues/8505">#8505</a>, <a href="https://github.com/matrix-org/synapse/issues/8507">#8507</a>, <a href="https://github.com/matrix-org/synapse/issues/8547">#8547</a>, <a href="https://github.com/matrix-org/synapse/issues/8562">#8562</a>, <a href="https://github.com/matrix-org/synapse/issues/8609">#8609</a>)</li>
<li>Remove unused code from the test framework. (<a href="https://github.com/matrix-org/synapse/issues/8514">#8514</a>)</li>
<li>Apply some internal fixes to the <code>HomeServer</code> class to make its code more idiomatic and statically-verifiable. (<a href="https://github.com/matrix-org/synapse/issues/8515">#8515</a>)</li>
<li>Factor out common code between <code>RoomMemberHandler._locally_reject_invite</code> and <code>EventCreationHandler.create_event</code>. (<a href="https://github.com/matrix-org/synapse/issues/8537">#8537</a>)</li>
<li>Improve database performance by executing more queries without starting transactions. (<a href="https://github.com/matrix-org/synapse/issues/8542">#8542</a>)</li>
<li>Rename <code>Cache</code> to <code>DeferredCache</code>, to better reflect its purpose. (<a href="https://github.com/matrix-org/synapse/issues/8548">#8548</a>)</li>
<li>Move metric registration code down into <code>LruCache</code>. (<a href="https://github.com/matrix-org/synapse/issues/8561">#8561</a>, <a href="https://github.com/matrix-org/synapse/issues/8591">#8591</a>)</li>
<li>Replace <code>DeferredCache</code> with the lighter-weight <code>LruCache</code> where possible. (<a href="https://github.com/matrix-org/synapse/issues/8563">#8563</a>)</li>
<li>Add virtualenv-generated folders to <code>.gitignore</code>. (<a href="https://github.com/matrix-org/synapse/issues/8566">#8566</a>)</li>
<li>Add <code>get_immediate</code> method to <code>DeferredCache</code>. (<a href="https://github.com/matrix-org/synapse/issues/8568">#8568</a>)</li>
<li>Fix mypy not properly checking across the codebase, additionally, fix a typing assertion error in <code>handlers/auth.py</code>. (<a href="https://github.com/matrix-org/synapse/issues/8569">#8569</a>)</li>
<li>Fix <code>synmark</code> benchmark runner. (<a href="https://github.com/matrix-org/synapse/issues/8571">#8571</a>)</li>
<li>Modify <code>DeferredCache.get()</code> to return <code>Deferred</code>s instead of <code>ObservableDeferred</code>s. (<a href="https://github.com/matrix-org/synapse/issues/8572">#8572</a>)</li>
<li>Adjust a protocol-type definition to fit <code>sqlite3</code> assertions. (<a href="https://github.com/matrix-org/synapse/issues/8577">#8577</a>)</li>
<li>Support macOS on the <code>synmark</code> benchmark runner. (<a href="https://github.com/matrix-org/synapse/issues/8578">#8578</a>)</li>
<li>Update <code>mypy</code> static type checker to 0.790. (<a href="https://github.com/matrix-org/synapse/issues/8583">#8583</a>, <a href="https://github.com/matrix-org/synapse/issues/8600">#8600</a>)</li>
<li>Re-organize the structured logging code to separate the TCP transport handling from the JSON formatting. (<a href="https://github.com/matrix-org/synapse/issues/8587">#8587</a>)</li>
<li>Remove extraneous unittest logging decorators from unit tests. (<a href="https://github.com/matrix-org/synapse/issues/8592">#8592</a>)</li>
<li>Minor optimisations in caching code. (<a href="https://github.com/matrix-org/synapse/issues/8593">#8593</a>, <a href="https://github.com/matrix-org/synapse/issues/8594">#8594</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;10&#x2F;20&#x2F;dendrite-0-2-0-released&#x2F;" title="Dendrite 0.2.0 released">Dendrite 0.2.0 released</a></h2>
                <span>
                    20.10.2020 19:35
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>It's been over a week since our next-generation homeserver <a href="https://matrix.org/blog/2020/10/08/dendrite-is-entering-beta">Dendrite entered
beta</a>, and it's
been a wild rollercoaster ride as the team has been frantically zapping all
the initial teething issues that came up - mostly around room federation
getting 'stuck' due to needing to fix bugs in how room state is managed.  Huge
huge thanks to everyone who has spun up a Dendrite to experiment and report
bugs!</p>
<p>We're now in an impressively better place, and it's feeling way more stable now
(but please don't trust it with your data yet).  So we've skipped 0.1.x and jumped
straight to 0.2.0.</p>
<p>Now would be a great time for more intrepid explorers to try spinning up a
server from https://github.com/matrix-org/dendrite and see how it feels - the
more feedback the better.  And if you got scared off by weird bugs in 0.1.0,
now's the right time to try it again!</p>
<p>Full changelog follows:</p>
<h2 id="dendrite-0-2-0-2020-10-20">Dendrite 0.2.0 (2020-10-20)</h2>
<h3 id="important">Important</h3>
<ul>
<li>This release makes breaking changes for polylith deployments, since they now use the multi-personality binary rather than separate binary files
<ul>
<li>Users of polylith deployments should revise their setups to use the new binary - see the Features section below</li>
</ul>
</li>
<li>This release also makes breaking changes for Docker deployments, as are now publishing images to Docker Hub in separate repositories for monolith and polylith
<ul>
<li>New repositories are as follows: <a href="https://hub.docker.com/repository/docker/matrixdotorg/dendrite-monolith">matrixdotorg/dendrite-monolith</a> and <a href="https://hub.docker.com/repository/docker/matrixdotorg/dendrite-polylith">matrixdotorg/dendrite-polylith</a></li>
<li>The new <code>latest</code> tag will be updated with the latest release, and new versioned tags, e.g. <code>v0.2.0</code>, will preserve specific release versions</li>
<li><a href="https://github.com/matrix-org/dendrite/tree/master/build/docker">Sample Compose configs</a> have been updated - if you are running a Docker deployment, please review the changes</li>
<li>Images for the client API proxy and federation API proxy are no longer provided as they are unsupported - please use <a href="docs/nginx/">nginx</a> (or another reverse proxy) instead</li>
</ul>
</li>
</ul>
<h3 id="features">Features</h3>
<ul>
<li>Dendrite polylith deployments now use a special multi-personality binary, rather than separate binaries
<ul>
<li>This is cleaner, builds faster and simplifies deployment</li>
<li>The first command line argument states the component to run, e.g. <code>./dendrite-polylith-multi roomserver</code></li>
</ul>
</li>
<li>Database migrations are now run at startup</li>
<li>Invalid UTF-8 in requests is now rejected (contributed by <a href="https://github.com/Pestdoktor">Pestdoktor</a>)</li>
<li>Fully read markers are now implemented in the client API (contributed by <a href="https://github.com/Lesterpig">Lesterpig</a>)</li>
<li>Missing auth events are now retrieved from other servers in the room, rather than just the event origin</li>
<li><code>m.room.create</code> events are now validated properly when processing a <code>/send_join</code> response</li>
<li>The roomserver now implements <code>KindOld</code> for handling historic events without them becoming forward extremity candidates, i.e. for backfilled or missing events</li>
</ul>
<h3 id="fixes">Fixes</h3>
<ul>
<li>State resolution v2 performance has been improved dramatically when dealing with large state sets</li>
<li>The roomserver no longer processes outlier events if they are already known</li>
<li>A SQLite locking issue in the previous events updater has been fixed</li>
<li>The client API <code>/state</code> endpoint now correctly returns state after the leave event, if the user has left the room</li>
<li>The client API <code>/createRoom</code> endpoint now sends cumulative state to the roomserver for the initial room events</li>
<li>The federation API <code>/send</code> endpoint now correctly requests the entire room state from the roomserver when needed</li>
<li>Some internal HTTP API paths have been fixed in the user API (contributed by <a href="https://github.com/S7evinK">S7evinK</a>)</li>
<li>A race condition in the rate limiting code resulting in concurrent map writes has been fixed</li>
<li>Each component now correctly starts a consumer/producer connection in monolith mode (when using Kafka)</li>
<li>State resolution is no longer run for single trusted state snapshots that have been verified before</li>
<li>A crash when rolling back the transaction in the latest events updater has been fixed</li>
<li>Typing events are now ignored when the sender domain does not match the origin server</li>
<li>Duplicate redaction entries no longer result in database errors</li>
<li>Recursion has been removed from the code path for retrieving missing events</li>
<li><code>QueryMissingAuthPrevEvents</code> now returns events that have no associated state as if they are missing</li>
<li>Signing key fetchers no longer ignore keys for the local domain, if retrieving a key that is not known in the local config</li>
<li>Federation timeouts have been adjusted so we don't give up on remote requests so quickly</li>
<li><code>create-account</code> no longer relies on the device database (contributed by <a href="https://github.com/ThatNerdyPikachu">ThatNerdyPikachu</a>)</li>
</ul>
<h3 id="known-issues">Known issues</h3>
<ul>
<li>Old events can incorrectly appear in <code>/sync</code> as if they are new when retrieving missing events from federated servers, causing them to appear at the bottom of the timeline in clients</li>
<li>Memory can explode when catching up after a federation outage.</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;10&#x2F;15&#x2F;synapse-1-21-2-released-and-security-advisory&#x2F;" title="Synapse 1.21.2 released, and security advisory.">Synapse 1.21.2 released, and security advisory.</a></h2>
                <span>
                    15.10.2020 17:25
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/richard-van-der-hoff">
                        Richard van der Hoff
                    </a>
                </span>
                <br>
                <small>Last update: 15.10.2020 17:16</small>
            </header>
            <div>
                
                <p>Hi folks,</p>
<p>Today we have released Synapse 1.21.2, which fixes a couple of minor bugs that crept into the previous release. Full details are below.</p>
<p>Separately, we are advising any administrators who have not yet upgraded to Synapse 1.21.0 or later to do so as soon as possible. Previous versions of Synapse were vulnerable to a cross-site-scripting (XSS) attack; the bug was fixed in Synapse 1.21.0 with <a href="https://github.com/matrix-org/synapse/pull/8444">PR #8444</a>.</p>
<p>The changelog for 1.21.2 is as follows:</p>
<h1 id="synapse-1-21-2-2020-10-15">Synapse 1.21.2 (2020-10-15)</h1>
<p>Debian packages and Docker images have been rebuilt using the latest versions of dependency libraries, including authlib 0.15.1. Please see bugfixes below.</p>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix rare bug where sending an event would fail due to a racey assertion. (<a href="https://github.com/matrix-org/synapse/issues/8530">#8530</a>)</li>
<li>An updated version of the authlib dependency is included in the Docker and Debian images to fix an issue using OpenID Connect. See <a href="https://github.com/matrix-org/synapse/issues/8534">#8534</a> for details.</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;10&#x2F;13&#x2F;synapse-1-21-1-released&#x2F;" title="Synapse 1.21.1 released">Synapse 1.21.1 released</a></h2>
                <span>
                    13.10.2020 00:00
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Synapse 1.21.1 has landed!</p>
<p>Highlights of 1.21.1 include:-</p>
<ul>
<li>
<p>Add experimental support for sharding event persister. (<a href="https://github.com/matrix-org/synapse/issues/8294">#8294</a>, <a href="https://github.com/matrix-org/synapse/issues/8387">#8387</a>, <a href="https://github.com/matrix-org/synapse/issues/8396">#8396</a>, <a href="https://github.com/matrix-org/synapse/issues/8419">#8419</a>)</p>
</li>
<li>
<p>Add experimental prometheus metric to track numbers of &quot;large&quot; rooms for state resolutiom. (<a href="https://github.com/matrix-org/synapse/issues/8425">#8425</a>)</p>
</li>
<li>
<p>Add prometheus metrics to track federation delays. (<a href="https://github.com/matrix-org/synapse/issues/8430">#8430</a>)</p>
</li>
<li>
<p>Fix messages not being sent over federation until an event is sent into the same room. (<a href="https://github.com/matrix-org/synapse/issues/8230">#8230</a>, <a href="https://github.com/matrix-org/synapse/issues/8247">#8247</a>, <a href="https://github.com/matrix-org/synapse/issues/8258">#8258</a>, <a href="https://github.com/matrix-org/synapse/issues/8272">#8272</a>, <a href="https://github.com/matrix-org/synapse/issues/8322">#8322</a>)</p>
</li>
</ul>
<p>We've also made some improvements to SSO and added new admin APIs.</p>
<p>Get the new releases from any of the usual sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md. 1.21.1 is on github <a href="https://github.com/matrix-org/synapse/releases/tag/v1.21.1">here</a></p>
<p>The changelog for 1.21.1 is as follows:</p>
<h1 id="synapse-1-21-1-2020-10-13">Synapse 1.21.1 (2020-10-13)</h1>
<p>This release fixes a regression in v1.21.0 that prevented debian packages from being built.</p>
<p>It is otherwise identical to v1.21.0.</p>
<h1 id="synapse-1-21-0-2020-10-12">Synapse 1.21.0 (2020-10-12)</h1>
<p>No significant changes since v1.21.0rc3.</p>
<p>As <a href="https://github.com/matrix-org/synapse/blob/release-v1.21.1/CHANGES.md#synapse-1200-2020-09-22">noted in v1.20.0</a>, a future release will drop support for accessing Synapse's <a href="https://github.com/matrix-org/synapse/tree/master/docs/admin_api">Admin API</a> under the <code>/_matrix/client/*</code> endpoint prefixes. At that point, the Admin API will only be accessible under <code>/_synapse/admin</code>.</p>
<h1 id="synapse-1-21-0rc3-2020-10-08">Synapse 1.21.0rc3 (2020-10-08)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix duplication of events on high traffic servers, caused by PostgreSQL <code>could not serialize access due to concurrent update</code> errors. (<a href="https://github.com/matrix-org/synapse/issues/8456">#8456</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add Groovy Gorilla to the list of distributions we build <code>.deb</code>s for. (<a href="https://github.com/matrix-org/synapse/issues/8475">#8475</a>)</li>
</ul>
<h1 id="synapse-1-21-0rc2-2020-10-02">Synapse 1.21.0rc2 (2020-10-02)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Convert additional templates from inline HTML to Jinja2 templates. (<a href="https://github.com/matrix-org/synapse/issues/8444">#8444</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix a regression in v1.21.0rc1 which broke thumbnails of remote media. (<a href="https://github.com/matrix-org/synapse/issues/8438">#8438</a>)</li>
<li>Do not expose the experimental <code>uk.half-shot.msc2778.login.application_service</code> flow in the login API, which caused a compatibility problem with Element iOS. (<a href="https://github.com/matrix-org/synapse/issues/8440">#8440</a>)</li>
<li>Fix malformed log line in new federation &quot;catch up&quot; logic. (<a href="https://github.com/matrix-org/synapse/issues/8442">#8442</a>)</li>
<li>Fix DB query on startup for negative streams which caused long start up times. Introduced in <a href="https://github.com/matrix-org/synapse/issues/8374">#8374</a>. (<a href="https://github.com/matrix-org/synapse/issues/8447">#8447</a>)</li>
</ul>
<h1 id="synapse-1-21-0rc1-2020-10-01">Synapse 1.21.0rc1 (2020-10-01)</h1>
<h2 id="features-1">Features</h2>
<ul>
<li>Require the user to confirm that their password should be reset after clicking the email confirmation link. (<a href="https://github.com/matrix-org/synapse/issues/8004">#8004</a>)</li>
<li>Add an admin API <code>GET /_synapse/admin/v1/event_reports</code> to read entries of table <code>event_reports</code>. Contributed by @dklimpel. (<a href="https://github.com/matrix-org/synapse/issues/8217">#8217</a>)</li>
<li>Consolidate the SSO error template across all configuration. (<a href="https://github.com/matrix-org/synapse/issues/8248">#8248</a>, <a href="https://github.com/matrix-org/synapse/issues/8405">#8405</a>)</li>
<li>Add a configuration option to specify a whitelist of domains that a user can be redirected to after validating their email or phone number. (<a href="https://github.com/matrix-org/synapse/issues/8275">#8275</a>, <a href="https://github.com/matrix-org/synapse/issues/8417">#8417</a>)</li>
<li>Add experimental support for sharding event persister. (<a href="https://github.com/matrix-org/synapse/issues/8294">#8294</a>, <a href="https://github.com/matrix-org/synapse/issues/8387">#8387</a>, <a href="https://github.com/matrix-org/synapse/issues/8396">#8396</a>, <a href="https://github.com/matrix-org/synapse/issues/8419">#8419</a>)</li>
<li>Add the room topic and avatar to the room details admin API. (<a href="https://github.com/matrix-org/synapse/issues/8305">#8305</a>)</li>
<li>Add an admin API for querying rooms where a user is a member. Contributed by @dklimpel. (<a href="https://github.com/matrix-org/synapse/issues/8306">#8306</a>)</li>
<li>Add <code>uk.half-shot.msc2778.login.application_service</code> login type to allow appservices to login. (<a href="https://github.com/matrix-org/synapse/issues/8320">#8320</a>)</li>
<li>Add a configuration option that allows existing users to log in with OpenID Connect. Contributed by @BBBSnowball and @OmmyZhang. (<a href="https://github.com/matrix-org/synapse/issues/8345">#8345</a>)</li>
<li>Add prometheus metrics for replication requests. (<a href="https://github.com/matrix-org/synapse/issues/8406">#8406</a>)</li>
<li>Support passing additional single sign-on parameters to the client. (<a href="https://github.com/matrix-org/synapse/issues/8413">#8413</a>)</li>
<li>Add experimental reporting of metrics on expensive rooms for state-resolution. (<a href="https://github.com/matrix-org/synapse/issues/8420">#8420</a>)</li>
<li>Add experimental prometheus metric to track numbers of &quot;large&quot; rooms for state resolutiom. (<a href="https://github.com/matrix-org/synapse/issues/8425">#8425</a>)</li>
<li>Add prometheus metrics to track federation delays. (<a href="https://github.com/matrix-org/synapse/issues/8430">#8430</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Fix a bug in the media repository where remote thumbnails with the same size but different crop methods would overwrite each other. Contributed by @deepbluev7. (<a href="https://github.com/matrix-org/synapse/issues/7124">#7124</a>)</li>
<li>Fix inconsistent handling of non-existent push rules, and stop tracking the <code>enabled</code> state of removed push rules. (<a href="https://github.com/matrix-org/synapse/issues/7796">#7796</a>)</li>
<li>Fix a longstanding bug when storing a media file with an empty <code>upload_name</code>. (<a href="https://github.com/matrix-org/synapse/issues/7905">#7905</a>)</li>
<li>Fix messages not being sent over federation until an event is sent into the same room. (<a href="https://github.com/matrix-org/synapse/issues/8230">#8230</a>, <a href="https://github.com/matrix-org/synapse/issues/8247">#8247</a>, <a href="https://github.com/matrix-org/synapse/issues/8258">#8258</a>, <a href="https://github.com/matrix-org/synapse/issues/8272">#8272</a>, <a href="https://github.com/matrix-org/synapse/issues/8322">#8322</a>)</li>
<li>Fix a longstanding bug where files that could not be thumbnailed would result in an Internal Server Error. (<a href="https://github.com/matrix-org/synapse/issues/8236">#8236</a>, <a href="https://github.com/matrix-org/synapse/issues/8435">#8435</a>)</li>
<li>Upgrade minimum version of <code>canonicaljson</code> to version 1.4.0, to fix an unicode encoding issue. (<a href="https://github.com/matrix-org/synapse/issues/8262">#8262</a>)</li>
<li>Fix longstanding bug which could lead to incomplete database upgrades on SQLite. (<a href="https://github.com/matrix-org/synapse/issues/8265">#8265</a>)</li>
<li>Fix stack overflow when stderr is redirected to the logging system, and the logging system encounters an error. (<a href="https://github.com/matrix-org/synapse/issues/8268">#8268</a>)</li>
<li>Fix a bug which cause the logging system to report errors, if <code>DEBUG</code> was enabled and no <code>context</code> filter was applied. (<a href="https://github.com/matrix-org/synapse/issues/8278">#8278</a>)</li>
<li>Fix edge case where push could get delayed for a user until a later event was pushed. (<a href="https://github.com/matrix-org/synapse/issues/8287">#8287</a>)</li>
<li>Fix fetching malformed events from remote servers. (<a href="https://github.com/matrix-org/synapse/issues/8324">#8324</a>)</li>
<li>Fix <code>UnboundLocalError</code> from occurring when appservices send a malformed register request. (<a href="https://github.com/matrix-org/synapse/issues/8329">#8329</a>)</li>
<li>Don't send push notifications to expired user accounts. (<a href="https://github.com/matrix-org/synapse/issues/8353">#8353</a>)</li>
<li>Fix a regression in v1.19.0 with reactivating users through the admin API. (<a href="https://github.com/matrix-org/synapse/issues/8362">#8362</a>)</li>
<li>Fix a bug where during device registration the length of the device name wasn't limited. (<a href="https://github.com/matrix-org/synapse/issues/8364">#8364</a>)</li>
<li>Include <code>guest_access</code> in the fields that are checked for null bytes when updating <code>room_stats_state</code>. Broke in v1.7.2. (<a href="https://github.com/matrix-org/synapse/issues/8373">#8373</a>)</li>
<li>Fix theoretical race condition where events are not sent down <code>/sync</code> if the synchrotron worker is restarted without restarting other workers. (<a href="https://github.com/matrix-org/synapse/issues/8374">#8374</a>)</li>
<li>Fix a bug which could cause errors in rooms with malformed membership events, on servers using sqlite. (<a href="https://github.com/matrix-org/synapse/issues/8385">#8385</a>)</li>
<li>Fix &quot;Re-starting finished log context&quot; warning when receiving an event we already had over federation. (<a href="https://github.com/matrix-org/synapse/issues/8398">#8398</a>)</li>
<li>Fix incorrect handling of timeouts on outgoing HTTP requests. (<a href="https://github.com/matrix-org/synapse/issues/8400">#8400</a>)</li>
<li>Fix a regression in v1.20.0 in the <code>synapse_port_db</code> script regarding the <code>ui_auth_sessions_ips</code> table. (<a href="https://github.com/matrix-org/synapse/issues/8410">#8410</a>)</li>
<li>Remove unnecessary 3PID registration check when resetting password via an email address. Bug introduced in v0.34.0rc2. (<a href="https://github.com/matrix-org/synapse/issues/8414">#8414</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Add <code>/_synapse/client</code> to the reverse proxy documentation. (<a href="https://github.com/matrix-org/synapse/issues/8227">#8227</a>)</li>
<li>Add note to the reverse proxy settings documentation about disabling Apache's mod_security2. Contributed by Julian Fietkau (@jfietkau). (<a href="https://github.com/matrix-org/synapse/issues/8375">#8375</a>)</li>
<li>Improve description of <code>server_name</code> config option in <code>homserver.yaml</code>. (<a href="https://github.com/matrix-org/synapse/issues/8415">#8415</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Drop support for <code>prometheus_client</code> older than 0.4.0. (<a href="https://github.com/matrix-org/synapse/issues/8426">#8426</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Fix tests on distros which disable TLSv1.0. Contributed by @danc86. (<a href="https://github.com/matrix-org/synapse/issues/8208">#8208</a>)</li>
<li>Simplify the distributor code to avoid unnecessary work. (<a href="https://github.com/matrix-org/synapse/issues/8216">#8216</a>)</li>
<li>Remove the <code>populate_stats_process_rooms_2</code> background job and restore functionality to <code>populate_stats_process_rooms</code>. (<a href="https://github.com/matrix-org/synapse/issues/8243">#8243</a>)</li>
<li>Clean up type hints for <code>PaginationConfig</code>. (<a href="https://github.com/matrix-org/synapse/issues/8250">#8250</a>, <a href="https://github.com/matrix-org/synapse/issues/8282">#8282</a>)</li>
<li>Track the latest event for every destination and room for catch-up after federation outage. (<a href="https://github.com/matrix-org/synapse/issues/8256">#8256</a>)</li>
<li>Fix non-user visible bug in implementation of <code>MultiWriterIdGenerator.get_current_token_for_writer</code>. (<a href="https://github.com/matrix-org/synapse/issues/8257">#8257</a>)</li>
<li>Switch to the JSON implementation from the standard library. (<a href="https://github.com/matrix-org/synapse/issues/8259">#8259</a>)</li>
<li>Add type hints to <code>synapse.util.async_helpers</code>. (<a href="https://github.com/matrix-org/synapse/issues/8260">#8260</a>)</li>
<li>Simplify tests that mock asynchronous functions. (<a href="https://github.com/matrix-org/synapse/issues/8261">#8261</a>)</li>
<li>Add type hints to <code>StreamToken</code> and <code>RoomStreamToken</code> classes. (<a href="https://github.com/matrix-org/synapse/issues/8279">#8279</a>)</li>
<li>Change <code>StreamToken.room_key</code> to be a <code>RoomStreamToken</code> instance. (<a href="https://github.com/matrix-org/synapse/issues/8281">#8281</a>)</li>
<li>Refactor notifier code to correctly use the max event stream position. (<a href="https://github.com/matrix-org/synapse/issues/8288">#8288</a>)</li>
<li>Use slotted classes where possible. (<a href="https://github.com/matrix-org/synapse/issues/8296">#8296</a>)</li>
<li>Support testing the local Synapse checkout against the <a href="https://github.com/matrix-org/complement/">Complement homeserver test suite</a>. (<a href="https://github.com/matrix-org/synapse/issues/8317">#8317</a>)</li>
<li>Update outdated usages of <code>metaclass</code> to python 3 syntax. (<a href="https://github.com/matrix-org/synapse/issues/8326">#8326</a>)</li>
<li>Move lint-related dependencies to package-extra field, update CONTRIBUTING.md to utilise this. (<a href="https://github.com/matrix-org/synapse/issues/8330">#8330</a>, <a href="https://github.com/matrix-org/synapse/issues/8377">#8377</a>)</li>
<li>Use the <code>admin_patterns</code> helper in additional locations. (<a href="https://github.com/matrix-org/synapse/issues/8331">#8331</a>)</li>
<li>Fix test logging to allow braces in log output. (<a href="https://github.com/matrix-org/synapse/issues/8335">#8335</a>)</li>
<li>Remove <code>__future__</code> imports related to Python 2 compatibility. (<a href="https://github.com/matrix-org/synapse/issues/8337">#8337</a>)</li>
<li>Simplify <code>super()</code> calls to Python 3 syntax. (<a href="https://github.com/matrix-org/synapse/issues/8344">#8344</a>)</li>
<li>Fix bad merge from <code>release-v1.20.0</code> branch to <code>develop</code>. (<a href="https://github.com/matrix-org/synapse/issues/8354">#8354</a>)</li>
<li>Factor out a <code>_send_dummy_event_for_room</code> method. (<a href="https://github.com/matrix-org/synapse/issues/8370">#8370</a>)</li>
<li>Improve logging of state resolution. (<a href="https://github.com/matrix-org/synapse/issues/8371">#8371</a>)</li>
<li>Add type annotations to <code>SimpleHttpClient</code>. (<a href="https://github.com/matrix-org/synapse/issues/8372">#8372</a>)</li>
<li>Refactor ID generators to use <code>async with</code> syntax. (<a href="https://github.com/matrix-org/synapse/issues/8383">#8383</a>)</li>
<li>Add <code>EventStreamPosition</code> type. (<a href="https://github.com/matrix-org/synapse/issues/8388">#8388</a>)</li>
<li>Create a mechanism for marking tests &quot;logcontext clean&quot;. (<a href="https://github.com/matrix-org/synapse/issues/8399">#8399</a>)</li>
<li>A pair of tiny cleanups in the federation request code. (<a href="https://github.com/matrix-org/synapse/issues/8401">#8401</a>)</li>
<li>Add checks on startup that PostgreSQL sequences are consistent with their associated tables. (<a href="https://github.com/matrix-org/synapse/issues/8402">#8402</a>)</li>
<li>Do not include appservice users when calculating the total MAU for a server. (<a href="https://github.com/matrix-org/synapse/issues/8404">#8404</a>)</li>
<li>Typing fixes for <code>synapse.handlers.federation</code>. (<a href="https://github.com/matrix-org/synapse/issues/8422">#8422</a>)</li>
<li>Various refactors to simplify stream token handling. (<a href="https://github.com/matrix-org/synapse/issues/8423">#8423</a>)</li>
<li>Make stream token serializing/deserializing async. (<a href="https://github.com/matrix-org/synapse/issues/8427">#8427</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;10&#x2F;08&#x2F;dendrite-is-entering-beta&#x2F;" title="Dendrite is entering Beta!">Dendrite is entering Beta!</a></h2>
                <span>
                    08.10.2020 00:00
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>We‚Äôre very excited to announce that Dendrite, the next-generation Matrix homeserver from the core Matrix team, is at last exiting alpha development and entering beta testing!</p>
<p>The path we‚Äôve taken to get here has been quite a curious one, and it‚Äôs worth recapping to give context on why it‚Äôs taken reality a little while to catch up with the dream. :)</p>
<p>The Dendrite project has its roots in 2016 as <a href="https://github.com/matrix-org/dendron">Dendron</a>: an attempt to write a next-generation homeserver in Golang rather than Python, in order to benefit from Go‚Äôs stronger typing, ease of profiling (no twisted stack-shredding via deferredInlineCallbacks), multithreading and faster GC performance.  The idea for Dendron was to do a <a href="https://martinfowler.com/bliki/StranglerFigApplication.html">strangler pattern</a> rewrite of Synapse - where we‚Äôd insert Dendron in front of Synapse as a load balancer, and incrementally replace Synapse‚Äôs API endpoints with ones implemented by Dendron.</p>
<p>However, as the project started to progress, it became clear that this was going to end up with many of Synapse‚Äôs architectural choices being baked into the project - particularly the DB schema and data flow architecture, such that the new endpoints could interoperate with the existing Python ones.  We got as far as putting Dendron live on matrix.org and moving some of the login/registration APIs over to it‚Ä¶ but then work fizzled out due to Synapse demanding more urgent attention as traffic grew on Matrix.org, combined with concerns about whether Dendron was the right approach in general.</p>
<p>So, towards the end of 2016 (after the rush to launch <del>Vector</del> <del>Riot</del> Element that summer), we went back to the drawing board to devise Dendrite‚Äî‚ÄúDendron done right!‚Äù‚Äîas opposed to Dendron, which in retrospect was Dendrite done wrong. ;) The new vision was:</p>
<ul>
<li>Build a massively horizontally scalable architecture, such that large Matrix deployments like matrix.org and big government deployments could run smoothly without the constant scalability headaches we were seeing at the time with Synapse</li>
<li>Do so by splitting the server into well-defined microservice components, each of which could independently horizontally scale, each with its own DB (if desired)</li>
<li>Connect the components together with a set of append-only logs via <a href="https://kafka.apache.org/">Kafka</a> or similar, easily letting components shard and maintain their databases from the logs, allowing rolling upgrades, possibly schema upgrades, and all sorts of other niceties.  The logs effectively become a primary source of truth rather than putting all the onus on a massive monolithic ever-growing database</li>
</ul>
<p>Rather than Dendron‚Äôs top-down approach, instead Dendrite started bottom-up with the very hardest bit: <a href="https://github.com/matrix-org/gomatrixserverlib">gomatrixserverlib</a>, a standalone Go library implementing the state resolution algorithms and performing federation requests (such that it might also someday be used as a general purpose way to add Matrix federation support to an existing Go codebase).</p>
<p>Then we started building out the various components to implement the various services, starting with the roomserver (the service which models the history and state of one or more rooms in the server), then the syncserver (the service which implements the /sync API to let clients receive messages), etc. We even implemented a simplified in-memory version of Kafka named <a href="https://github.com/matrix-org/naffka">naffka</a>‚Äîuseful for glueing together the microservice components when running them all within a single binary.</p>
<p>Things were looking pretty positive by the summer of 2017: we had the server sending/receiving messages, federating with Synapse, and looking tantalisingly close:</p>
<blockquote>
<p lang="en" dir="ltr">We just sent the first ever synapse-&gt;dendrite federated traffic, including full dendrite media API (thumbnailing, fed, etc)!!! :D :D :D <a href="https://t.co/sBcM2jMAr6">pic.twitter.com/sBcM2jMAr6</a></p>&mdash; Matrix (@matrixdotorg) <a href="https://twitter.com/matrixdotorg/status/872861579141947392?ref_src=twsrc%5Etfw">June 8, 2017</a>
</blockquote>
<p>However, we then hit three fairly major obstacles:</p>
<ul>
<li><a href="https://matrix.org/blog/2017/07/07/a-call-to-arms-supporting-matrix">Matrix lost its funding</a></li>
<li>In the ensuing uncertainty, the two lead developers (Mjark &amp; Kegan) went to work elsewhere</li>
<li>Meanwhile, Matrix uptake was starting to explode and Synapse was failing to scale to handle the traffic on matrix.org (and elsewhere)</li>
</ul>
<p>At first, having formed what would become New Vector (now Element) to keep the rest of the core team hired, we pushed to see if we could get Dendrite finished fast enough to replace Synapse, with Erik &amp; richvdh jumping over from Synapse to pick up the remaining work.  However, it became clear that we urgently needed a quicker solution to address all the overloaded Synapses out there, and so they swung back to focus on improving Synapse (taking inspiration from some of the design of Dendrite - e.g. offloading endpoints onto worker processes connected via replication streams, and using <a href="https://opentracing.io/">OpenTracing</a> to debug traffic as it flows over the various services).</p>
<p>At this point, Dendrite maintenance was in effect valiantly taken over by the community, with Brendan and later Anoa keeping the ball going in 2017, joined by APWhitehat in GSoC 2018 and cnly in GSoC 2019.  The fact that Dendrite is now here today is thanks in no small part to their work to keep the project alive in its ‚Äúwilderness years‚Äù between Sept 2017 and Dec 2019.</p>
<p>Meanwhile, it became clear that we were overdue getting Matrix itself out of beta - and the last thing we wanted to do was to split and dilute the implementation work of Matrix 1.0 over both Synapse and Dendrite - so we consciously made the decision to focus all our effort on Synapse for solving the remaining bugs and challenges.</p>
<p>Then, in July 2019, <a href="https://matrix.org/blog/2019/06/11/introducing-matrix-1-0-and-the-matrix-org-foundation">Matrix and Synapse exited beta</a>, and we finally started to see light at the end of the tunnel.  In October we started dusting off Dendrite again - looking to use it as a relatively simple and flexible codebase for <a href="https://youtu.be/eA0KnTt4O7E?t=1423">experimenting with Peer-to-Peer Matrix</a>, not least because being Go it can compile to WebAssembly and run clientside, and because even though Dendrite was originally built with massive deployments in mind, it turns out the elastic scaling means it can also scale down pretty small too‚Äîas a part of the <a href="http://testflight.apple.com/join/Tgh2MEk6">iOS P2P demo</a>, we‚Äôve even ran full Dendrite homeservers on iPhones embedded into Element iOS! :)</p>
<p>In Dec 2019, we finally got to the point where Element could fund full-time dedicated development on Dendrite once again, with Neil Alexander joining the project and focusing fulltime on getting Dendrite out of alpha and getting it working for P2P and embedded usage (adding libp2p as a federation transport, and adding SQLite support) - and in Jan 2020 we got Dendrite <a href="https://archive.fosdem.org/2020/schedule/event/dip_p2p_matrix/">successfully running clientside in a WASM service worker</a> (just in time for FOSDEM!). Then, in Feb 2020, Kegan returned to the project to work fulltime on Dendrite - and the race began in earnest to get Dendrite ready for beta!</p>
<p>Here‚Äôs a pretty picture courtesy of GitHub to visualise the progress:</p>
<p><img src="/blog/img/2020-10-08-dendrite-contributors.png" alt="020-10-08-dendrite-contributors.png" /></p>
<p>Throughout 2020 there‚Äôs been a huge amount of stabilisation work and polish:</p>
<ul>
<li>Refactoring much of Dendrite‚Äôs foundation to make the codebase more maintainable</li>
<li>Created all-new user server, key server, signing key server microservices</li>
<li>Moving some work from existing microservices (ultimately superseding the former currentstateserver, publicroomsapi and typingserver microservices altogether)</li>
<li>Developing new testing infrastructure:
<ul>
<li><a href="https://github.com/matrix-org/complement">Complement</a> - our brand new Golang Matrix integration test harness</li>
<li><a href="https://github.com/matrix-org/dendrite/blob/master/are-we-synapse-yet.py">Are We Synapse Yet</a> - an aggregator which parses sytest/complement output to compare how close Dendrite is to passing</li>
</ul>
</li>
<li>All the Matrix 1.0 work - particularly state res v2 &amp; room version support</li>
<li>Making it work with more P2P transports for <a href="https://matrix.org/blog/2020/06/02/introducing-p-2-p-matrix/">all the exciting P2P experiments</a></li>
<li>Supporting backfill and fetching missing events</li>
<li>Fixing up SQLite support to make it work as a first class citizen (with shared storage code where we can!)</li>
<li>Supporting both sending and rejecting invites (even over federation)</li>
<li>E2E encryption support (one-time keys, device lists, send-to-device support)</li>
<li>Improved federation sender logic (resend retries, backoffs, blacklisting, metrics, resetting backoffs when receiving transactions)</li>
<li>Handling both inbound and outbound redactions</li>
<li>User interactive authentication (and implemented on various ‚Äòsudo‚Äô endpoints e.g. deleting devices and changing passwords)</li>
<li>Respecting server ACLs</li>
<li>Rejecting / soft-failing events properly</li>
<li>Support for database schema upgrades</li>
</ul>
<p>... which brings us at last to the present day (Oct 2020), as we declare Dendrite sufficiently stable that we consider it ready for beta testing!</p>
<p>In practice, this means **Dendrite is now ready for experimentation by adventurous Matrix sysadmins. It is <em>NOT</em> ready for production usage yet, but we need folks to test it and help us iron out the remaining bugs!  **Please do not trust it with sensitive data yet, and we don‚Äôt recommend trying to run it at scale yet as we haven‚Äôt done any serious optimisation work yet.</p>
<p>That said, we do provide the following guarantees:</p>
<ul>
<li>We‚Äôre providing versioned releases from here on in, beginning with <a href="https://github.com/matrix-org/dendrite/releases/tag/v0.1.0">0.1.0</a></li>
<li>We don‚Äôt expect any major breaking changes to the config or architecture before 1.0</li>
<li>Ready for early adopters to try running Dendrite without experiencing ~daily breaking churn</li>
<li>The database schema is now stable and will upgrade itself going forwards - your database should now be here to stay! (assuming we don‚Äôt hit any nasty data loss bugs during beta)</li>
</ul>
<p>In terms of comparison with Synapse, the main things you should get excited about are:</p>
<ul>
<li>Dendrite aims to provide an <strong>efficient</strong>, <strong>reliable</strong> and <strong>scalable</strong> alternative to Synapse:
<ul>
<li>Efficient: A small memory footprint with better baseline performance than an out-of-the-box Synapse</li>
<li>Reliable: Implements the Matrix specification as written, using the <a href="https://github.com/matrix-org/sytest">same test suite</a> as Synapse as well as a <a href="https://github.com/matrix-org/complement">brand new Go test suite</a></li>
<li>Scalable: can run on multiple machines and eventually scale to massive homeserver deployments</li>
</ul>
</li>
<li>This means significantly less memory usage than Synapse (depends on joined rooms, often between 50MB - 400MB resident memory) - although we haven‚Äôt tuned this at all yet!</li>
<li>All-new database model, where every microservice instance has its own database tables, letting them scale arbitrarily wide</li>
<li>The ability to efficiently use all your available CPU cores without needing to split into separate processes, thanks to Go and our extensive use of goroutines.  No more Python global interpreter lock! :)</li>
<li>Future experimental MSCs are likely to land in Dendrite before Synapse (e.g <a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc2753/proposals/2753-peeking-via-sync-v2.md">MSC2753 Peeking via /sync</a> and <a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc2444/proposals/2444-peeking-over-federation-peek-api.md">MSC2444 Peeking over Federation</a> are already being prototyped (<a href="https://github.com/matrix-org/dendrite/pull/1370">#1370</a> and <a href="https://github.com/matrix-org/dendrite/pull/1391">#1391</a>) in Dendrite rather than Synapse!)</li>
</ul>
<p>The provisos you should know about however are:</p>
<ul>
<li>We‚Äôre not feature complete yet: sytest reports 56% CS API coverage and 77% Federation coverage. <strong>NB: these are always going to be underestimates of how much Dendrite actually performs due to how the tests are spread out, in actuality it‚Äôs likely more 70% CS, 95% Fed.</strong></li>
<li>No read receipts, membership lazy-loading, presence, push notifications, search, event context, key backups, cross-signing. See changelog for full limitations.</li>
<li>Not battle-tested in the wild by many people (there are probably only ~10 dendrites on the open network today!) - so there‚Äôs likely to be a broad spectrum of bugs at first.</li>
<li>Clients that require more exotic features, like lazy loading, may not behave properly yet</li>
<li>Please <strong>use Postgres rather than SQLite wherever possible</strong>‚Äîit‚Äôs faster and has fewer issues regarding concurrency (some requests on SQLite Dendrites may 500 with ‚Äòdatabase is locked‚Äô - though we‚Äôve worked hard to eliminate most of these)</li>
<li>Dendrite can run in either ‚Äúmonolith‚Äù or ‚Äúpolylith‚Äù mode. In monolith, all the microservices are linked into a single binary - and <strong>we recommend running in this configuration wherever possible</strong> for now. Monolith mode is <em>extremely</em> capable as it is and has fewer moving parts for things to go wrong and will be the right choice for the majority of beta deployments!</li>
<li>Whilst Dendrite is nearly 100% federation compatible, there may still be situations where it will split-brain and disagree with the current room state that Synapse has calculated. We expect these issues to resolve as we get more user feedback.</li>
</ul>
<p>Architecture-wise, this is what Dendrite looks like under the hood today:</p>
<p><img src="/blog/img/2020-10-08-dendrite-arch.svg" alt="2020-10-08-dendrite-arch.svg" /></p>
<p>To get up and running, please install Go and head on over to the Get Started guide at <a href="https://github.com/matrix-org/dendrite#get-started">https://github.com/matrix-org/dendrite#get-started</a> to join the fun :)</p>
<p>In terms of where we‚Äôre going next:</p>
<ul>
<li>Read receipts. It‚Äôs a major missing feature and impacts UX significantly.</li>
<li>100% Federation coverage (according to sytest). It‚Äôs crucial that Dendrite instances play nicely with other servers. This will be the best metric we have for asserting that we are just as capable as Synapse at the fed level.</li>
<li>Optimisation‚Äî<strong>Dendrite has not been optimised yet for speed or resource utilisation!</strong>
<ul>
<li>We plan to add benchmarks which will stress test different microservices in the presence of many different scaling factors (number of users, number of rooms, size of room, number of devices per user, number of sync requests, etc). This will hopefully allow us to identify early on bottlenecks and slow algorithms</li>
<li>Good old fashioned pprof with known slow scenarios to see what‚Äôs consuming CPU/memory and fixing issues ad-hoc (which we‚Äôve already done a bit of pre-beta). This may involve adding additional in-memory caches, with a healthy respect for the complexities it may introduce (which Synapse has been bitten by)</li>
</ul>
</li>
<li>We plan to add first class feature flag support for experimental MSCs‚Äîexperimentation is one thing which makes Dendrite notably different from Synapse, and supporting it more thoroughly going forwards will be important. This may mean adding additional hooks; potentially a dedicated microservice to cleanly separate experiments, we don‚Äôt know yet</li>
<li>P2P work will continue with vigour now we have a working, featureful, and relatively stable HS to embed and play with</li>
</ul>
<p>Longer term, it‚Äôs pretty hard to say right now when we expect to exit beta (it took Synapse 5 years to exit beta, after all ;) - but obviously we‚Äôll need Dendrite to have parity with Synapse and have no known serious bugs.</p>
<p>Finally: you‚Äôre probably wondering what this means for Synapse.  Synapse is here to stay - with tens of thousands of deployments around the world serving tens of millions of users.  The majority of the core team is still focused on improving and optimising Synapse, and we‚Äôll be keeping improving it for the foreseeable.</p>
<p>However, we‚Äôll certainly be experimenting with new stuff on Dendrite first - whether that‚Äôs P2P, portable accounts, new-style communities, peeking etc.  We expect Synapse to be the stable long-term-supported solution, while Dendrite (particularly while in beta) will be the more unstable and experimental platform. In the longer term we‚Äôll provide ways of migrating from Synapse to Dendrite however (probably via portable accounts), and perhaps in future new deployments may choose to use Dendrite - a bit like you might choose to use nginx rather than Apache for a new web server these days. But this will be a long transition‚Äîmeanwhile we expect to see more and more next-generation homeservers like <a href="http://conduit.rs/">Conduit</a>, <a href="https://gitlab.com/mascarene/mascarene">Mascarene</a> or <a href="https://github.com/matrix-construct/construct">Construct</a> coming of age too.</p>
<p>So, there you have it. If you‚Äôre an intrepid sysadmin please spin up a Dendrite and start filing bugs! :)</p>
<p>‚Äî Matthew, Neil Alexander, Kegan and the whole Matrix team.</p>
<p>Here‚Äôs the official changelog:</p>
<h3 id="client-server-api-features">Client-Server API Features</h3>
<h4 id="account-registration-and-management">Account registration and management</h4>
<ul>
<li>Registration: By password only.</li>
<li>Login: By password only. No fallback.</li>
<li>Logout: Yes.</li>
<li>Change password: Yes.</li>
<li>Link email/msisdn to account: No.</li>
<li>Deactivate account: Yes.</li>
<li>Check if username is available: Yes.</li>
<li>Account data: Yes.</li>
<li>OpenID: No.</li>
</ul>
<h4 id="rooms">Rooms</h4>
<ul>
<li>Room creation: Yes, including presets.</li>
<li>Joining rooms: Yes, including by alias or <code>?server_name=</code>.</li>
<li>Event sending: Yes, including transaction IDs.</li>
<li>Aliases: Yes.</li>
<li>Published room directory: Yes.</li>
<li>Kicking users: Yes.</li>
<li>Banning users: Yes.</li>
<li>Inviting users: Yes, but not third-party invites.</li>
<li>Forgetting rooms: No.</li>
<li>Room versions: All (v1 - v6)</li>
<li>Tagging: Yes.</li>
</ul>
<h4 id="user-management">User management</h4>
<ul>
<li>User directory: Basic support.</li>
<li>Ignoring users: No.</li>
<li>Groups/Communities: No.</li>
</ul>
<h4 id="device-management">Device management</h4>
<ul>
<li>Creating devices: Yes.</li>
<li>Deleting devices: Yes.</li>
<li>Send-to-device messaging: Yes.</li>
</ul>
<h4 id="sync">Sync</h4>
<ul>
<li>Filters: Timeline limit only. Rest unimplemented.</li>
<li>Deprecated <code>/events</code> and <code>/initialSync</code>: No.</li>
</ul>
<h4 id="room-events">Room events</h4>
<ul>
<li>Typing: Yes.</li>
<li>Receipts: No.</li>
<li>Read Markers: No.</li>
<li>Presence: No.</li>
<li>Content repository (attachments): Yes.</li>
<li>History visibility: No, defaults to <code>joined</code>.</li>
<li>Push notifications: No.</li>
<li>Event context: No.</li>
<li>Reporting content: No.</li>
</ul>
<h4 id="end-to-end-encryption">End-to-End Encryption</h4>
<ul>
<li>Uploading device keys: Yes.</li>
<li>Downloading device keys: Yes.</li>
<li>Claiming one-time keys: Yes.</li>
<li>Querying key changes: Yes.</li>
<li>Cross-Signing: No.</li>
</ul>
<h4 id="misc">Misc</h4>
<ul>
<li>Server-side search: No.</li>
<li>Guest access: Partial.</li>
<li>Room previews: No, partial support for Peeking via MSC2753.</li>
<li>Third-Party networks: No.</li>
<li>Server notices: No.</li>
<li>Policy lists: No.</li>
</ul>
<h3 id="federation-features">Federation Features</h3>
<ul>
<li>Querying keys (incl. notary): Yes.</li>
<li>Server ACLs: Yes.</li>
<li>Sending transactions: Yes.</li>
<li>Joining rooms: Yes.</li>
<li>Inviting to rooms: Yes, but not third-party invites.</li>
<li>Leaving rooms: Yes.</li>
<li>Content repository: Yes.</li>
<li>Backfilling / get_missing_events: Yes.</li>
<li>Retrieving state of the room (<code>/state</code> and <code>/state_ids</code>): Yes.</li>
<li>Public rooms: Yes.</li>
<li>Querying profile data: Yes.</li>
<li>Device management: Yes.</li>
<li>Send-to-Device messaging: Yes.</li>
<li>Querying/Claiming E2E Keys: Yes.</li>
<li>Typing: Yes.</li>
<li>Presence: No.</li>
<li>Receipts: No.</li>
<li>OpenID: No.</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;09&#x2F;22&#x2F;synapse-1-20-0-released&#x2F;" title="Synapse 1.20.0 released">Synapse 1.20.0 released</a></h2>
                <span>
                    22.09.2020 19:30
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Synapse 1.20.0 is here!</p>
<p>Highlights of 1.20.0 include:-</p>
<ul>
<li>Shadow ban support.</li>
<li>Unread message counts in the sync response to help our client developers, this is a precursor to improving notification support.</li>
<li>No less than 28 async/await PRs, so we can finally share all the hard work.</li>
</ul>
<p>Also take note that in a future release, we will be dropping support for accessing Synapse's Admin API using the <code>/_matrix/client/* prefixes</code>. More details follow in the changelog.</p>
<p>Get the new releases from any of the usual sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md. 1.20.0 is on github <a href="https://github.com/matrix-org/synapse/releases/tag/v1.20.0">here</a>, and 1.20.0rc4 is <a href="https://github.com/matrix-org/synapse/releases/tag/v1.20.0rc4">here</a>.</p>
<p>The changelog for 1.20.0 is as follows:</p>
<h1 id="synapse-1-20-0-2020-09-22">Synapse 1.20.0 (2020-09-22)</h1>
<p>No significant changes since v1.20.0rc5.</p>
<h2 id="removal-warning">Removal warning</h2>
<p>Historically, the <a href="https://github.com/matrix-org/synapse/tree/master/docs">Synapse Admin API</a> has been accessible under the <code>/_matrix/client/api/v1/admin</code>, <code>/_matrix/client/unstable/admin</code>, <code>/_matrix/client/r0/admin</code> and <code>/_synapse/admin</code> prefixes. In a future release, we will be dropping support for accessing Synapse's Admin API using the <code>/_matrix/client/*</code> prefixes. This makes it easier for homeserver admins to lock down external access to the Admin API endpoints.</p>
<h1 id="synapse-1-20-0rc5-2020-09-18">Synapse 1.20.0rc5 (2020-09-18)</h1>
<p>In addition to the below, Synapse 1.20.0rc5 also includes the bug fix that was included in 1.19.3.</p>
<h2 id="features">Features</h2>
<ul>
<li>Add flags to the <code>/versions</code> endpoint for whether new rooms default to using E2EE. (<a href="https://github.com/matrix-org/synapse/issues/8343">#8343</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix rate limiting of federation <code>/send</code> requests. (<a href="https://github.com/matrix-org/synapse/issues/8342">#8342</a>)</li>
<li>Fix a longstanding bug where back pagination over federation could get stuck if it failed to handle a received event. (<a href="https://github.com/matrix-org/synapse/issues/8349">#8349</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Blacklist <a href="https://github.com/matrix-org/matrix-doc/pull/2753">MSC2753</a> SyTests until it is implemented. (<a href="https://github.com/matrix-org/synapse/issues/8285">#8285</a>)</li>
</ul>
<h1 id="synapse-1-20-0rc4-2020-09-16">Synapse 1.20.0rc4 (2020-09-16)</h1>
<p>Synapse 1.20.0rc4 is identical to 1.20.0rc3, with the addition of the security fix that was included in 1.19.2.</p>
<h1 id="synapse-1-20-0rc3-2020-09-11">Synapse 1.20.0rc3 (2020-09-11)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix a bug introduced in v1.20.0rc1 where the wrong exception was raised when invalid JSON data is encountered. (<a href="https://github.com/matrix-org/synapse/issues/8291">#8291</a>)</li>
</ul>
<h1 id="synapse-1-20-0rc2-2020-09-09">Synapse 1.20.0rc2 (2020-09-09)</h1>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Fix a bug introduced in v1.20.0rc1 causing some features related to notifications to misbehave following the implementation of unread counts. (<a href="https://github.com/matrix-org/synapse/issues/8280">#8280</a>)</li>
</ul>
<h1 id="synapse-1-20-0rc1-2020-09-08">Synapse 1.20.0rc1 (2020-09-08)</h1>
<h2 id="removal-warning-1">Removal warning</h2>
<p>Some older clients used a <a href="https://matrix.org/docs/spec/client_server/r0.6.1#post-matrix-client-r0-register-email-requesttoken">disallowed character</a> (<code>:</code>) in the <code>client_secret</code> parameter of various endpoints. The incorrect behaviour was allowed for backwards compatibility, but is now being removed from Synapse as most users have updated their client. Further context can be found at <a href="https://github.com/matrix-org/synapse/issues/6766">#6766</a>.</p>
<h2 id="features-1">Features</h2>
<ul>
<li>Add an endpoint to query your shared rooms with another user as an implementation of <a href="https://github.com/matrix-org/matrix-doc/pull/2666">MSC2666</a>. (<a href="https://github.com/matrix-org/synapse/issues/7785">#7785</a>)</li>
<li>Iteratively encode JSON to avoid blocking the reactor. (<a href="https://github.com/matrix-org/synapse/issues/8013">#8013</a>, <a href="https://github.com/matrix-org/synapse/issues/8116">#8116</a>)</li>
<li>Add support for shadow-banning users (ignoring any message send requests). (<a href="https://github.com/matrix-org/synapse/issues/8034">#8034</a>, <a href="https://github.com/matrix-org/synapse/issues/8092">#8092</a>, <a href="https://github.com/matrix-org/synapse/issues/8095">#8095</a>, <a href="https://github.com/matrix-org/synapse/issues/8142">#8142</a>, <a href="https://github.com/matrix-org/synapse/issues/8152">#8152</a>, <a href="https://github.com/matrix-org/synapse/issues/8157">#8157</a>, <a href="https://github.com/matrix-org/synapse/issues/8158">#8158</a>, <a href="https://github.com/matrix-org/synapse/issues/8176">#8176</a>)</li>
<li>Use the default template file when its equivalent is not found in a custom template directory. (<a href="https://github.com/matrix-org/synapse/issues/8037">#8037</a>, <a href="https://github.com/matrix-org/synapse/issues/8107">#8107</a>, <a href="https://github.com/matrix-org/synapse/issues/8252">#8252</a>)</li>
<li>Add unread messages count to sync responses, as specified in <a href="https://github.com/matrix-org/matrix-doc/pull/2654">MSC2654</a>. (<a href="https://github.com/matrix-org/synapse/issues/8059">#8059</a>, <a href="https://github.com/matrix-org/synapse/issues/8254">#8254</a>, <a href="https://github.com/matrix-org/synapse/issues/8270">#8270</a>, <a href="https://github.com/matrix-org/synapse/issues/8274">#8274</a>)</li>
<li>Optimise <code>/federation/v1/user/devices/</code> API by only returning devices with encryption keys. (<a href="https://github.com/matrix-org/synapse/issues/8198">#8198</a>)</li>
</ul>
<h2 id="bugfixes-3">Bugfixes</h2>
<ul>
<li>Fix a memory leak by limiting the length of time that messages will be queued for a remote server that has been unreachable. (<a href="https://github.com/matrix-org/synapse/issues/7864">#7864</a>)</li>
<li>Fix <code>Re-starting finished log context PUT-nnnn</code> warning when event persistence failed. (<a href="https://github.com/matrix-org/synapse/issues/8081">#8081</a>)</li>
<li>Synapse now correctly enforces the valid characters in the <code>client_secret</code> parameter used in various endpoints. (<a href="https://github.com/matrix-org/synapse/issues/8101">#8101</a>)</li>
<li>Fix a bug introduced in v1.7.2 impacting message retention policies that would allow federated homeservers to dictate a retention period that's lower than the configured minimum allowed duration in the configuration file. (<a href="https://github.com/matrix-org/synapse/issues/8104">#8104</a>)</li>
<li>Fix a long-standing bug where invalid JSON would be accepted by Synapse. (<a href="https://github.com/matrix-org/synapse/issues/8106">#8106</a>)</li>
<li>Fix a bug introduced in Synapse v1.12.0 which could cause <code>/sync</code> requests to fail with a 404 if you had a very old outstanding room invite. (<a href="https://github.com/matrix-org/synapse/issues/8110">#8110</a>)</li>
<li>Return a proper error code when the rooms of an invalid group are requested. (<a href="https://github.com/matrix-org/synapse/issues/8129">#8129</a>)</li>
<li>Fix a bug which could cause a leaked postgres connection if synapse was set to daemonize. (<a href="https://github.com/matrix-org/synapse/issues/8131">#8131</a>)</li>
<li>Clarify the error code if a user tries to register with a numeric ID. This bug was introduced in v1.15.0. (<a href="https://github.com/matrix-org/synapse/issues/8135">#8135</a>)</li>
<li>Fix a bug where appservices with ratelimiting disabled would still be ratelimited when joining rooms. This bug was introduced in v1.19.0. (<a href="https://github.com/matrix-org/synapse/issues/8139">#8139</a>)</li>
<li>Fix logging in via OpenID Connect with a provider that uses integer user IDs. (<a href="https://github.com/matrix-org/synapse/issues/8190">#8190</a>)</li>
<li>Fix a longstanding bug where user directory updates could break when unexpected profile data was included in events. (<a href="https://github.com/matrix-org/synapse/issues/8223">#8223</a>)</li>
<li>Fix a longstanding bug where stats updates could break when unexpected profile data was included in events. (<a href="https://github.com/matrix-org/synapse/issues/8226">#8226</a>)</li>
<li>Fix slow start times for large servers by removing a table scan of the <code>users</code> table from startup code. (<a href="https://github.com/matrix-org/synapse/issues/8271">#8271</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Fix builds of the Docker image on non-x86 platforms. (<a href="https://github.com/matrix-org/synapse/issues/8144">#8144</a>)</li>
<li>Added curl for healthcheck support and readme updates for the change. Contributed by @maquis196. (<a href="https://github.com/matrix-org/synapse/issues/8147">#8147</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Link to matrix-synapse-rest-password-provider in the password provider documentation. (<a href="https://github.com/matrix-org/synapse/issues/8111">#8111</a>)</li>
<li>Updated documentation to note that Synapse does not follow <code>HTTP 308</code> redirects due to an upstream library not supporting them. Contributed by Ryan Cole. (<a href="https://github.com/matrix-org/synapse/issues/8120">#8120</a>)</li>
<li>Explain better what GDPR-erased means when deactivating a user. (<a href="https://github.com/matrix-org/synapse/issues/8189">#8189</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Add filter <code>name</code> to the <code>/users</code> admin API, which filters by user ID or displayname. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/7377">#7377</a>, <a href="https://github.com/matrix-org/synapse/issues/8163">#8163</a>)</li>
<li>Reduce run times of some unit tests by advancing the reactor a fewer number of times. (<a href="https://github.com/matrix-org/synapse/issues/7757">#7757</a>)</li>
<li>Don't fail <code>/submit_token</code> requests on incorrect session ID if <code>request_token_inhibit_3pid_errors</code> is turned on. (<a href="https://github.com/matrix-org/synapse/issues/7991">#7991</a>)</li>
<li>Convert various parts of the codebase to async/await. (<a href="https://github.com/matrix-org/synapse/issues/8071">#8071</a>, <a href="https://github.com/matrix-org/synapse/issues/8072">#8072</a>, <a href="https://github.com/matrix-org/synapse/issues/8074">#8074</a>, <a href="https://github.com/matrix-org/synapse/issues/8075">#8075</a>, <a href="https://github.com/matrix-org/synapse/issues/8076">#8076</a>, <a href="https://github.com/matrix-org/synapse/issues/8087">#8087</a>, <a href="https://github.com/matrix-org/synapse/issues/8100">#8100</a>, <a href="https://github.com/matrix-org/synapse/issues/8119">#8119</a>, <a href="https://github.com/matrix-org/synapse/issues/8121">#8121</a>, <a href="https://github.com/matrix-org/synapse/issues/8133">#8133</a>, <a href="https://github.com/matrix-org/synapse/issues/8156">#8156</a>, <a href="https://github.com/matrix-org/synapse/issues/8162">#8162</a>, <a href="https://github.com/matrix-org/synapse/issues/8166">#8166</a>, <a href="https://github.com/matrix-org/synapse/issues/8168">#8168</a>, <a href="https://github.com/matrix-org/synapse/issues/8173">#8173</a>, <a href="https://github.com/matrix-org/synapse/issues/8191">#8191</a>, <a href="https://github.com/matrix-org/synapse/issues/8192">#8192</a>, <a href="https://github.com/matrix-org/synapse/issues/8193">#8193</a>, <a href="https://github.com/matrix-org/synapse/issues/8194">#8194</a>, <a href="https://github.com/matrix-org/synapse/issues/8195">#8195</a>, <a href="https://github.com/matrix-org/synapse/issues/8197">#8197</a>, <a href="https://github.com/matrix-org/synapse/issues/8199">#8199</a>, <a href="https://github.com/matrix-org/synapse/issues/8200">#8200</a>, <a href="https://github.com/matrix-org/synapse/issues/8201">#8201</a>, <a href="https://github.com/matrix-org/synapse/issues/8202">#8202</a>, <a href="https://github.com/matrix-org/synapse/issues/8207">#8207</a>, <a href="https://github.com/matrix-org/synapse/issues/8213">#8213</a>, <a href="https://github.com/matrix-org/synapse/issues/8214">#8214</a>)</li>
<li>Remove some unused database functions. (<a href="https://github.com/matrix-org/synapse/issues/8085">#8085</a>)</li>
<li>Add type hints to various parts of the codebase. (<a href="https://github.com/matrix-org/synapse/issues/8090">#8090</a>, <a href="https://github.com/matrix-org/synapse/issues/8127">#8127</a>, <a href="https://github.com/matrix-org/synapse/issues/8187">#8187</a>, <a href="https://github.com/matrix-org/synapse/issues/8241">#8241</a>, <a href="https://github.com/matrix-org/synapse/issues/8140">#8140</a>, <a href="https://github.com/matrix-org/synapse/issues/8183">#8183</a>, <a href="https://github.com/matrix-org/synapse/issues/8232">#8232</a>, <a href="https://github.com/matrix-org/synapse/issues/8235">#8235</a>, <a href="https://github.com/matrix-org/synapse/issues/8237">#8237</a>, <a href="https://github.com/matrix-org/synapse/issues/8244">#8244</a>)</li>
<li>Return the previous stream token if a non-member event is a duplicate. (<a href="https://github.com/matrix-org/synapse/issues/8093">#8093</a>, <a href="https://github.com/matrix-org/synapse/issues/8112">#8112</a>)</li>
<li>Separate <code>get_current_token</code> into two since there are two different use cases for it. (<a href="https://github.com/matrix-org/synapse/issues/8113">#8113</a>)</li>
<li>Remove <code>ChainedIdGenerator</code>. (<a href="https://github.com/matrix-org/synapse/issues/8123">#8123</a>)</li>
<li>Reduce the amount of whitespace in JSON stored and sent in responses. (<a href="https://github.com/matrix-org/synapse/issues/8124">#8124</a>)</li>
<li>Update the test federation client to handle streaming responses. (<a href="https://github.com/matrix-org/synapse/issues/8130">#8130</a>)</li>
<li>Micro-optimisations to <code>get_auth_chain_ids</code>. (<a href="https://github.com/matrix-org/synapse/issues/8132">#8132</a>)</li>
<li>Refactor <code>StreamIdGenerator</code> and <code>MultiWriterIdGenerator</code> to have the same interface. (<a href="https://github.com/matrix-org/synapse/issues/8161">#8161</a>)</li>
<li>Add functions to <code>MultiWriterIdGen</code> used by events stream. (<a href="https://github.com/matrix-org/synapse/issues/8164">#8164</a>, <a href="https://github.com/matrix-org/synapse/issues/8179">#8179</a>)</li>
<li>Fix tests that were broken due to the merge of 1.19.1. (<a href="https://github.com/matrix-org/synapse/issues/8167">#8167</a>)</li>
<li>Make <code>SlavedIdTracker.advance</code> have the same interface as <code>MultiWriterIDGenerator</code>. (<a href="https://github.com/matrix-org/synapse/issues/8171">#8171</a>)</li>
<li>Remove unused <code>is_guest</code> parameter from, and add safeguard to, <code>MessageHandler.get_room_data</code>. (<a href="https://github.com/matrix-org/synapse/issues/8174">#8174</a>, <a href="https://github.com/matrix-org/synapse/issues/8181">#8181</a>)</li>
<li>Standardize the mypy configuration. (<a href="https://github.com/matrix-org/synapse/issues/8175">#8175</a>)</li>
<li>Refactor some of <code>LoginRestServlet</code>'s helper methods, and move them to <code>AuthHandler</code> for easier reuse. (<a href="https://github.com/matrix-org/synapse/issues/8182">#8182</a>)</li>
<li>Fix <code>wait_for_stream_position</code> to allow multiple waiters on same stream ID. (<a href="https://github.com/matrix-org/synapse/issues/8196">#8196</a>)</li>
<li>Make <code>MultiWriterIDGenerator</code> work for streams that use negative values. (<a href="https://github.com/matrix-org/synapse/issues/8203">#8203</a>)</li>
<li>Refactor queries for device keys and cross-signatures. (<a href="https://github.com/matrix-org/synapse/issues/8204">#8204</a>, <a href="https://github.com/matrix-org/synapse/issues/8205">#8205</a>, <a href="https://github.com/matrix-org/synapse/issues/8222">#8222</a>, <a href="https://github.com/matrix-org/synapse/issues/8224">#8224</a>, <a href="https://github.com/matrix-org/synapse/issues/8225">#8225</a>, <a href="https://github.com/matrix-org/synapse/issues/8231">#8231</a>, <a href="https://github.com/matrix-org/synapse/issues/8233">#8233</a>, <a href="https://github.com/matrix-org/synapse/issues/8234">#8234</a>)</li>
<li>Fix type hints for functions decorated with <code>@cached</code>. (<a href="https://github.com/matrix-org/synapse/issues/8240">#8240</a>)</li>
<li>Remove obsolete <code>order</code> field from federation send queues. (<a href="https://github.com/matrix-org/synapse/issues/8245">#8245</a>)</li>
<li>Stop sub-classing from object. (<a href="https://github.com/matrix-org/synapse/issues/8249">#8249</a>)</li>
<li>Add more logging to debug slow startup. (<a href="https://github.com/matrix-org/synapse/issues/8264">#8264</a>)</li>
<li>Do not attempt to upgrade database schema on worker processes. (<a href="https://github.com/matrix-org/synapse/issues/8266">#8266</a>, <a href="https://github.com/matrix-org/synapse/issues/8276">#8276</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;09&#x2F;16&#x2F;synapse-1-19-2-released&#x2F;" title="Synapse 1.19.2 released">Synapse 1.19.2 released</a></h2>
                <span>
                    16.09.2020 00:00
                    ‚Äî
                    <a href="/category/releases">
                        Releases
                    </a>
                    ‚Äî
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p><strong>Synapse 1.19.2 is a security patch. All federating instances should upgrade immediately.</strong></p>
<p>Today we are releasing Synapse 1.19.2, which is a security patch release containing a fix to encountering invalid events over federation. We are also putting out a fourth release candidate for the upcoming Synapse 1.20.0 release with the same fix.</p>
<p>The bug prevents affected Synapse instances from joining rooms with invalid events. Server administrators running federating instances are strongly encouraged to update as soon as possible.</p>
<p><strong>Those on Synapse 1.19.1 or earlier should upgrade to Synapse 1.19.2, while those who are running a release candidate of Synapse 1.20.0 should upgrade to 1.20.0rc4.</strong></p>
<p>Get the new releases from any of the usual sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md. 1.19.2 is on github <a href="https://github.com/matrix-org/synapse/releases/tag/v1.19.2">here</a>, and 1.20.0rc4 is <a href="https://github.com/matrix-org/synapse/releases/tag/v1.20.0rc4">here</a>.</p>
<p>The changelog for 1.19.2 is as follows:</p>
<h2 id="synapse-1-19-2-2020-09-16">Synapse 1.19.2 (2020-09-16)</h2>
<p>Due to the issue below server admins are encouraged to upgrade as soon as possible.
Bugfixes</p>
<ul>
<li>Fix joining rooms over federation that include malformed events. (#8324)</li>
</ul>

                
            </div>
        </article>
        
        <nav class="pagination">
    <div class="prev">
        
        <a href="&#x2F;category&#x2F;releases&#x2F;page&#x2F;6&#x2F;">‚Äπ Previous</a>
        
    </div>
    <span class="page-number">7 / 14</span>
    <div class="prev">
        
        <a href="&#x2F;category&#x2F;releases&#x2F;page&#x2F;8&#x2F;">Next ‚Ä∫</a>
        
    </div>
</nav>

    </div>
</div>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="&#x2F;code"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>¬© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
