<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
	<title> - Tech</title>
	<link href="/category/tech/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="/"/>
	<generator uri="https://www.getzola.org/">Zola</generator>
	<updated>2021-12-17T00:00:00+00:00</updated>
	<id>/category/tech/atom.xml</id>
	<entry xml:lang="en">
		<title>Type coverage for Sydent: evaluation</title>
		<published>2021-12-17T00:00:00+00:00</published>
		<updated>2021-12-17T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/12/17/type-coverage-for-sydent-evaluation/" type="text/html"/>
		<id>/blog/2021/12/17/type-coverage-for-sydent-evaluation/</id>
		<content type="html">&lt;p&gt;This is the third in a series of three posts which discuss recent work to improve type annotations in &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&quot;&gt;Sydent&lt;&#x2F;a&gt;, the reference Matrix Identity server. &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;10&#x2F;type-coverage-for-sydent-annotation&quot;&gt;Last time&lt;&#x2F;a&gt; we discussed the mechanics of how we added type coverage. Now I want to reflect on how well we did. What information and guarantees did we gain from &lt;code&gt;mypy&lt;&#x2F;code&gt;? How could we track our progress and measure the effect of our work? And lastly, what other tools are out there apart from &lt;code&gt;mypy&lt;&#x2F;code&gt;?&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-best-parts-of-strict&quot;&gt;The best parts of &lt;code&gt;--strict&lt;&#x2F;code&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;While the primary goal was to improve Sydent&#x27;s coverage and robustness, to some extent this was an experiment too. How much could we get out of typing and static analysis, if we &lt;em&gt;really&lt;&#x2F;em&gt; invested in thorough annotations? Sydent is a small project that would make for a good testbed! I decided my goal would be to get Sydent passing mypy under &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#cmdoption-mypy-strict&quot;&gt;--strict mode&lt;&#x2F;a&gt;. This is a command line option which turns on a number of extra checks (though not everything); it feels similar to passing &lt;code&gt;-Wall -Wextra -Werror&lt;&#x2F;code&gt; to &lt;code&gt;gcc&lt;&#x2F;code&gt;. It&#x27;s a little extreme, but Sydent is a small project and this would be a good chance to see how hard it would be. In my view, the most useful options implied by strict mode were as follows.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;check-untyped-defs&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#cmdoption-mypy-check-untyped-defs&quot;&gt;--check-untyped-defs&lt;&#x2F;a&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;By default, mypy will only analyze the implementation of functions that are annotated. On the one hand, without annotations for inputs and the return type, it&#x27;s going to be hard for mypy to thoroughly check the soundness of your function. On the other, it can still do good work with the type information it has from other sources. Mypy can&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;infer the type of literals, e.g. deducing &lt;code&gt;x: str&lt;&#x2F;code&gt; from  &lt;code&gt;x = &amp;quot;hello&amp;quot;&lt;&#x2F;code&gt;;&lt;&#x2F;li&gt;
&lt;li&gt;lookup the return types of standard library calls, via &lt;code&gt;typeshed&lt;&#x2F;code&gt;; and similarly&lt;&#x2F;li&gt;
&lt;li&gt;lookup the return types of any annotated functions in your code or dependencies.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The information is already available for free: we may as well try to use it to spot problems.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;disallow-untyped-defs-and-friends&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#cmdoption-mypy-disallow-untyped-defs&quot;&gt;--disallow-untyped-defs&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#untyped-definitions-and-calls&quot;&gt;friends&lt;&#x2F;a&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;This flag forces you to fully annotate every function. There are less extreme versions available, e.g. &lt;code&gt;--disallow-incomplete-defs&lt;&#x2F;code&gt;; but I think this is a good option to ensure full coverage of your module. It means you can rely on mypy&#x27;s error output as a to-do list.&lt;&#x2F;p&gt;
&lt;p&gt;One downside to this: sometimes I felt like I was writing obvious boilerplate annotations, e.g.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;__str__(self) -&amp;gt; str:
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;...
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;There was one particular example of this that crops up a lot. Mypy has a special exception for a class&#x27;s &lt;code&gt;__init__&lt;&#x2F;code&gt; and &lt;code&gt;__init_subclass__&lt;&#x2F;code&gt; methods. If a return type annotation is missing, it will &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;issues&#x2F;604#issuecomment-348525995&quot;&gt;assume these functions return None&lt;&#x2F;a&gt; instead of &lt;code&gt;Any&lt;&#x2F;code&gt;. (See  here for &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;pull&#x2F;5677&quot;&gt;its implementation&lt;&#x2F;a&gt;.) This is normally compatible with &lt;code&gt;--disallow-untyped-defs&lt;&#x2F;code&gt; and &lt;code&gt;--disallow-incomplete-defs&lt;&#x2F;code&gt;, with one exception. If your &lt;code&gt;__init__&lt;&#x2F;code&gt; function takes no arguments other than &lt;code&gt;self&lt;&#x2F;code&gt;, mypy won&#x27;t consider it annotated, and you&#x27;ll need to write &lt;code&gt;-&amp;gt; None&lt;&#x2F;code&gt; explicitly.&lt;&#x2F;p&gt;
&lt;p&gt;It&#x27;s also worth mentioning &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#cmdoption-mypy-disallow-untyped-calls&quot;&gt;--disallow-untyped-calls&lt;&#x2F;a&gt;, which will cause an error if an annotated function calls an unannotated function. Again, it helps to ensure that mypy has a complete picture of the types in your function&#x27;s implementation. It also helps to highlight dependencies—if you see errors from this, it might be more practical to annotate the functions and modules it&#x27;s calling first.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;warn-return-any&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#cmdoption-mypy-warn-return-any&quot;&gt;--warn-return-any&lt;&#x2F;a&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;If I&#x27;ve written a function and annotated it to return an &lt;code&gt;int&lt;&#x2F;code&gt;, mypy will rightly complain if its implementation actually goes on to return a &lt;code&gt;str&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;foo() -&amp;gt; int:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# error: Incompatible return value type (got &amp;quot;str&amp;quot;, expected &amp;quot;int&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;hello&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;If mypy isn&#x27;t sure what type I&#x27;m returning though, i.e. if I&#x27;m returning an expression of type &lt;code&gt;Any&lt;&#x2F;code&gt;, then by default mypy will trust that we&#x27;ve done the right thing.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;i_promise_this_is_an_int():
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;hello&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;bar() -&amp;gt; int:
&lt;&#x2F;span&gt;&lt;span&gt;    reveal_type(i_promise_this_is_an_int()) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# Any
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;i_promise_this_is_an_int()
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Enabling &lt;code&gt;--warn-return-any&lt;&#x2F;code&gt; will disable this behaviour; to make this error pass we&#x27;ll have to prove to mypy that &lt;code&gt;i_promise_this_is_an_int()&lt;&#x2F;code&gt; really is an &lt;code&gt;int&lt;&#x2F;code&gt;. Sometimes that will be the case, and an extra annotation will provide the necessary proof. At other times (like in this example), investigation will prove that there really is a bug!&lt;&#x2F;p&gt;
&lt;h3 id=&quot;strict-equality&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#cmdoption-mypy-strict-equality&quot;&gt;--strict-equality&lt;&#x2F;a&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;This is a bit like a limited form of gcc&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;gcc.gnu.org&#x2F;onlinedocs&#x2F;gcc&#x2F;Warning-Options.html&quot;&gt;-Wtautological-compare&lt;&#x2F;a&gt;. Mypy will report and reject equality tests between incompatible types. If mypy can spot that an equality is always &lt;code&gt;False&lt;&#x2F;code&gt;, there&#x27;s a good chance of there being a bug in your program, or else an incorrect annotation.&lt;&#x2F;p&gt;
&lt;p&gt;I&#x27;m not sure how general this check is, since users can define their own types with their own rules for equality by overriding &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;reference&#x2F;datamodel.html?highlight=__eq__#object.__eq__&quot;&gt;&lt;strong&gt;eq&lt;&#x2F;strong&gt;&lt;&#x2F;a&gt;. Perhaps it only applies to built-in types?&lt;&#x2F;p&gt;
&lt;h2 id=&quot;quantifying-coverage&quot;&gt;Quantifying coverage&lt;&#x2F;h2&gt;
&lt;p&gt;It was important to have some way to numerically evaluate our efforts to improve type coverage. It&#x27;s a fairly abstract piece of work: there&#x27;s nothing user-visible about it, unless we happen to discover a bug and fix it.&lt;&#x2F;p&gt;
&lt;p&gt;The most obvious metric is the number of total errors reported by mypy. Before the recent sprint, we had roughly 600 errors total.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;dmr on titan in sydent on  HEAD (3dde3ad) via 🐍 v3.9.7 (env)
&lt;&#x2F;span&gt;&lt;span&gt;2021-11-08 12:35:37 ✔  $ mypy --strict sydent
&lt;&#x2F;span&gt;&lt;span&gt;Found 635 errors in 59 files (checked 78 source files)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This is a decent way to measure your progress when working on a particular module or package, but it&#x27;s not perfect, because the errors aren&#x27;t independent. Fixing one could fix another ten or reveal another twenty—the numeric value can be erratic.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;reports&quot;&gt;Reports&lt;&#x2F;h3&gt;
&lt;p&gt;I found mypy&#x27;s various &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#report-generation&quot;&gt;reports&lt;&#x2F;a&gt; to be a better approach here. There were three reports I found particularly useful.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;html-report&quot;&gt;&lt;code&gt;--html-report&lt;&#x2F;code&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;This produces a main index page showing the &amp;quot;imprecision&amp;quot; of each module. At the bottom of the table is a total imprecision value across the entire project.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;blog&#x2F;img&#x2F;2021-12-17-sydent-typing-html-report-index.png&quot; alt=&quot;HTML report, index page. A table showing each module&#x27;s precision and number of lines of code.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;The precision for each module is broken down line-by-line and colour-coded accordingly, which is useful for getting an intuition for what makes a line imprecise. More on that shortly.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;blog&#x2F;img&#x2F;2021-12-17-sydent-typing-html-report-module.png&quot; alt=&quot;HTML report, module page. Most lines of source code are highlighted green; a minority are highlighted red.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h4 id=&quot;txt-report&quot;&gt;&lt;code&gt;--txt-report&lt;&#x2F;code&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;This reproduces the index page from the &lt;code&gt;html&lt;&#x2F;code&gt; report as a plain text file. It&#x27;s slightly easier to parse—that&#x27;s how I got the data for the precision line graphs in &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;03&#x2F;type-coverage-for-sydent-motivation&quot;&gt;part one&lt;&#x2F;a&gt; of this series. That was a quick and dirty hack, though; a proper analysis of precision probably ought to read from the json or xml output formats. Here&#x27;s a truncated sample:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;+-----------------------------------+-------------------+----------+
&lt;&#x2F;span&gt;&lt;span&gt;| Module                            | Imprecision       | Lines    |
&lt;&#x2F;span&gt;&lt;span&gt;+-----------------------------------+-------------------+----------+
&lt;&#x2F;span&gt;&lt;span&gt;| sydent                            |   0.00% imprecise |    1 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;| sydent.config                     |   0.00% imprecise |  266 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;| sydent.config._base               |   0.00% imprecise |   31 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;| sydent.config.crypto              |  15.94% imprecise |   69 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;| ...                               |               ... |      ... |
&lt;&#x2F;span&gt;&lt;span&gt;| sydent.validators                 |   0.00% imprecise |   61 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;| sydent.validators.common          |   7.35% imprecise |   68 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;| sydent.validators.emailvalidator  |   1.30% imprecise |  154 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;| sydent.validators.msisdnvalidator |   1.34% imprecise |  149 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;+-----------------------------------+-------------------+----------+
&lt;&#x2F;span&gt;&lt;span&gt;| Total                             |   5.95% imprecise | 9707 LOC |
&lt;&#x2F;span&gt;&lt;span&gt;+-----------------------------------+-------------------+----------+
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h4 id=&quot;any-exprs-report&quot;&gt;&lt;code&gt;--any-exprs-report&lt;&#x2F;code&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;Selecting this option generate two reports: &lt;code&gt;any-exprs.txt&lt;&#x2F;code&gt; and &lt;code&gt;types-of-anys.txt&lt;&#x2F;code&gt;. The latter is interesting to understand where the &lt;code&gt;Anys&lt;&#x2F;code&gt; come from, but the former is more useful for quantifying the progress of typing. Another sample:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;                  Name   Anys   Exprs   Coverage
&lt;&#x2F;span&gt;&lt;span&gt;-------------------------------------------------
&lt;&#x2F;span&gt;&lt;span&gt;                sydent      0       2    100.00%
&lt;&#x2F;span&gt;&lt;span&gt;         sydent.config      0     185    100.00%
&lt;&#x2F;span&gt;&lt;span&gt;   sydent.config._base      0       3    100.00%
&lt;&#x2F;span&gt;&lt;span&gt;  sydent.config.crypto     34      80     57.50%
&lt;&#x2F;span&gt;&lt;span&gt;sydent.config.database      0       8    100.00%
&lt;&#x2F;span&gt;&lt;span&gt;   sydent.config.email      0      86    100.00%
&lt;&#x2F;span&gt;&lt;span&gt;                   ...    ...     ...        ...
&lt;&#x2F;span&gt;&lt;span&gt;-------------------------------------------------
&lt;&#x2F;span&gt;&lt;span&gt;                 Total    544   11366     95.21%
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The breakdown in &lt;code&gt;types-of-anys.txt&lt;&#x2F;code&gt; has more gory detail. I found the &amp;quot;Unimported&amp;quot; column particularly interesting: it lets us see how exposed we are to a lack of typing in our dependencies.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;                             Name   Unannotated   Explicit   Unimported   Omitted Generics   Error   Special Form   Implementation Artifact
&lt;&#x2F;span&gt;&lt;span&gt;-------------------------------------------------------------------------------------------------------------------------------------------
&lt;&#x2F;span&gt;&lt;span&gt;                           sydent             0          0            0                  0       0              0                         0
&lt;&#x2F;span&gt;&lt;span&gt;                    sydent.config             0          3            0                  0       0              0                         0
&lt;&#x2F;span&gt;&lt;span&gt;              sydent.config._base             0          0            0                  0       0              0                         0
&lt;&#x2F;span&gt;&lt;span&gt;                              ...           ...        ...          ...                ...     ...            ...                       ...
&lt;&#x2F;span&gt;&lt;span&gt;        sydent.util.versionstring             0         80            0                  0       0              0                         0
&lt;&#x2F;span&gt;&lt;span&gt;                sydent.validators             0          4            0                  0       0              0                         0
&lt;&#x2F;span&gt;&lt;span&gt;         sydent.validators.common             0         20            0                  0       0              0                         0
&lt;&#x2F;span&gt;&lt;span&gt; sydent.validators.emailvalidator             0          8            0                  0       0              0                         0
&lt;&#x2F;span&gt;&lt;span&gt;sydent.validators.msisdnvalidator             0          8            0                  0       0              0                         0
&lt;&#x2F;span&gt;&lt;span&gt;-------------------------------------------------------------------------------------------------------------------------------------------
&lt;&#x2F;span&gt;&lt;span&gt;                            Total             9       1276          273                  0      37              0                        17
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h3 id=&quot;the-meaning-of-precision&quot;&gt;The meaning of precision&lt;&#x2F;h3&gt;
&lt;p&gt;There are two metrics I chose to focus on:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;the proportion of &amp;quot;imprecise&amp;quot; lines across the project; I also used the complement, &lt;code&gt;precision = 100% - imprecision&lt;&#x2F;code&gt;, and&lt;&#x2F;li&gt;
&lt;li&gt;the proportion of expressions whose type is not &lt;code&gt;Any&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;These are plotted in the graph at the top of this writeup. I could see that precision and the proportion of typed expressions were correlated, but I didn&#x27;t understand how they differed. I couldn&#x27;t see an explanation in the mypy docs, so I went &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;blob&#x2F;d807e097d142a88a48af93314d15ad87e41d2f19&#x2F;mypy&#x2F;stats.py&quot;&gt;digging&lt;&#x2F;a&gt; into the mypy source code. My understanding is as follows.&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;There are &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;blob&#x2F;d807e097d142a88a48af93314d15ad87e41d2f19&#x2F;mypy&#x2F;stats.py#L27-L31&quot;&gt;five kinds of precision&lt;&#x2F;a&gt;. Full details are visible in the &lt;code&gt;--lineprecision-report&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Two kinds of precision, &lt;code&gt;EMPTY&lt;&#x2F;code&gt; and &lt;code&gt;UNANALYZED&lt;&#x2F;code&gt; convey no information, because there&#x27;s nothing to analyze.&lt;&#x2F;li&gt;
&lt;li&gt;A line is marked as precise, imprecise or any based on the expressions it uses.
&lt;ul&gt;
&lt;li&gt;An expression that has type &lt;code&gt;Any&lt;&#x2F;code&gt; leads to precision &lt;code&gt;ANY&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;I &lt;em&gt;think&lt;&#x2F;em&gt; an expression that &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;blob&#x2F;2907a4dea939e20ff39ef7d9ff85ae1a199a0ee8&#x2F;mypy&#x2F;stats.py#L422-L423&quot;&gt;involves &lt;code&gt;Any&lt;&#x2F;code&gt; but is not &lt;code&gt;Any&lt;&#x2F;code&gt;&lt;&#x2F;a&gt; counts as imprecise. For instance, &lt;code&gt;Dict[str, Any]&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Remaining expressions have precision &lt;code&gt;PRECISE&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;A line&#x27;s precision is the worst of all its expressions&#x27; precisions.
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ANY&lt;&#x2F;code&gt; is worse than &lt;code&gt;IMPRECISE&lt;&#x2F;code&gt;, which is worse than &lt;code&gt;PRECISE&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;The &amp;quot;imprecision&amp;quot; number reported by mypy counts the number of lines &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;blob&#x2F;3bdef9fe6d401f3d2e0cacf4964bd315550c3394&#x2F;mypy&#x2F;xml&#x2F;mypy-txt.xslt#L77-L78&quot;&gt;classified as &lt;code&gt;IMPRECISE&lt;&#x2F;code&gt; or &lt;code&gt;ANY&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;On balance, my preferred metric is the line-level (im)precision percentage. There wasn&#x27;t much difference between the two in my experience, but the colour-coded visualisation in the HTML report is a neat feature to have. Maybe in the future there could be a version of the HTML report that colour-codes each &lt;em&gt;expression&lt;&#x2F;em&gt;?&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-larger-typing-ecosystem&quot;&gt;The larger typing ecosystem&lt;&#x2F;h2&gt;
&lt;p&gt;There are plenty of articles out there about the typing. As well as the &lt;a href=&quot;http:&#x2F;&#x2F;mypy-lang.blogspot.com&#x2F;&quot;&gt;mypy blog itself&lt;&#x2F;a&gt;, see Daniele Varrazzo&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;www.varrazzo.com&#x2F;blog&#x2F;2020&#x2F;03&#x2F;31&#x2F;first-experience-mypy&#x2F;&quot;&gt;post on &lt;code&gt;psycopg3&lt;&#x2F;code&gt; (2020)&lt;&#x2F;a&gt;, Dropbox&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;dropbox.tech&#x2F;application&#x2F;our-journey-to-type-checking-4-million-lines-of-python&quot;&gt;blog post (2019)&lt;&#x2F;a&gt;, Zulip&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;blog.zulip.com&#x2F;2016&#x2F;10&#x2F;13&#x2F;static-types-in-python-oh-mypy&#x2F;&quot;&gt;blog post (2016)&lt;&#x2F;a&gt;, Glyph&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;glyph.twistedmatrix.com&#x2F;2020&#x2F;07&#x2F;new-duck.html&quot;&gt;blog post on &lt;code&gt;Protocols&lt;&#x2F;code&gt; (2020)&lt;&#x2F;a&gt; and a follow-up &lt;a href=&quot;https:&#x2F;&#x2F;glyph.twistedmatrix.com&#x2F;2021&#x2F;03&#x2F;interfaces-and-protocols.html&quot;&gt;comparing them to &lt;code&gt;zope.interface&lt;&#x2F;code&gt; (2021)&lt;&#x2F;a&gt; and Nylas&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;www.nylas.com&#x2F;blog&#x2F;not-your-pie-mypy&#x2F;&quot;&gt;blog (2019)&lt;&#x2F;a&gt;. I&#x27;m sure there&#x27;s plenty more out there.&lt;&#x2F;p&gt;
&lt;p&gt;It&#x27;s worth highlighting the &lt;code&gt;typeshed&lt;&#x2F;code&gt; project, which maintains stubs for the standard library, plus popular third-party libraries. I &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;typeshed&#x2F;pull&#x2F;6150&quot;&gt;submitted a PR&lt;&#x2F;a&gt; to add a single type hint—it was a very pleasant experience! Microsoft has an &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;python-type-stubs&quot;&gt;incubator&lt;&#x2F;a&gt; of sorts for stubs too.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;other-typecheckers&quot;&gt;Other typecheckers&lt;&#x2F;h3&gt;
&lt;p&gt;After the sprint to improve coverage, I spent a short amount of time trying the alternative type checkers out there. Mypy isn&#x27;t the &lt;em&gt;only&lt;&#x2F;em&gt; typechecker out there—other companies have built and open-sourced their own tools, with different strengths, weaknesses and goals. This is by no means an authoritative, exhaustive survey—just my quick notes.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;pyre-facebook&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pyre-check.org&#x2F;&quot;&gt;Pyre&lt;&#x2F;a&gt; (Facebook)&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;I couldn&#x27;t work out how to configure paths to resolve import errors; in the end, I wasn&#x27;t able to process much of Sydent&#x27;s source code.&lt;&#x2F;li&gt;
&lt;li&gt;Couldn&#x27;t get it to process annotations like &lt;code&gt;syd: &amp;quot;Sydent&amp;quot;&lt;&#x2F;code&gt; where &amp;quot;Sydent&amp;quot; is an import guarded by &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=type_checking#typing.TYPE_CHECKING&quot;&gt;TYPE_CHECKING&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;No plugin system that I could see. That said, it has a separate mode&#x2F;program for running &lt;a href=&quot;https:&#x2F;&#x2F;pyre-check.org&#x2F;docs&#x2F;pysa-basics&quot;&gt;&amp;quot;Taint Analysis&amp;quot;&lt;&#x2F;a&gt; to spot security issues.&lt;&#x2F;li&gt;
&lt;li&gt;Seemed stricter by default compared to mypy: there was less inference of types.&lt;&#x2F;li&gt;
&lt;li&gt;Also has its own strict mode.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;pyright-microsoft&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;pyright&quot;&gt;Pyright&lt;&#x2F;a&gt; (Microsoft)&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;Didn&#x27;t seem to recognise &lt;code&gt;getLogger&lt;&#x2F;code&gt; as being imported from &lt;code&gt;logging&lt;&#x2F;code&gt;. Not sure what happened there—maybe something wrong with its bundled version of &lt;code&gt;typeshed&lt;&#x2F;code&gt;?&lt;&#x2F;li&gt;
&lt;li&gt;In a few places, Sydent uses &lt;code&gt;urllib.parse.quote&lt;&#x2F;code&gt; but only imports &lt;code&gt;urllib&lt;&#x2F;code&gt;. We must be unintentionally relying on our dependencies to &lt;code&gt;import urllib.parse&lt;&#x2F;code&gt; somewhere! Mypy didn&#x27;t complain about this; pyright did.&lt;&#x2F;li&gt;
&lt;li&gt;Seemed to give a better explanations of why complex types were incompatible. For example:&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;&#x2F;home&#x2F;dmr&#x2F;workspace&#x2F;sydent&#x2F;sydent&#x2F;replication&#x2F;pusher.py
&lt;&#x2F;span&gt;&lt;span&gt;   &#x2F;home&#x2F;dmr&#x2F;workspace&#x2F;sydent&#x2F;sydent&#x2F;replication&#x2F;pusher.py:77:16 - error: Expression of type &amp;quot;DeferredList&amp;quot; cannot be assigned to return type &amp;quot;Deferred[List[Tuple[bool, None]]]&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;     TypeVar &amp;quot;_DeferredResultT@Deferred&amp;quot; is contravariant
&lt;&#x2F;span&gt;&lt;span&gt;       TypeVar &amp;quot;_T@list&amp;quot; is invariant
&lt;&#x2F;span&gt;&lt;span&gt;         Tuple entry 2 is incorrect type
&lt;&#x2F;span&gt;&lt;span&gt;           Type &amp;quot;None&amp;quot; cannot be assigned to type &amp;quot;_DeferredResultT@_DeferredListResultItemT&amp;quot; (reportGeneralTypeIssues)
&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;home&#x2F;dmr&#x2F;workspace&#x2F;sydent&#x2F;sydent&#x2F;sms&#x2F;openmarket.py
&lt;&#x2F;span&gt;&lt;span&gt;   &#x2F;home&#x2F;dmr&#x2F;workspace&#x2F;sydent&#x2F;sydent&#x2F;sms&#x2F;openmarket.py:93:13 - error: Argument of type &amp;quot;dict[_KT@dict, list[bytes]]&amp;quot; cannot be assigned to parameter &amp;quot;rawHeaders&amp;quot; of type &amp;quot;Mapping[AnyStr@__init__, Sequence[AnyStr@__init__]] | None&amp;quot; in function &amp;quot;__init__&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;     Type &amp;quot;dict[_KT@dict, list[bytes]]&amp;quot; cannot be assigned to type &amp;quot;Mapping[AnyStr@__init__, Sequence[AnyStr@__init__]] | None&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;       TypeVar &amp;quot;_KT@Mapping&amp;quot; is invariant
&lt;&#x2F;span&gt;&lt;span&gt;         Type &amp;quot;_KT@dict&amp;quot; is incompatible with constrained type variable &amp;quot;AnyStr&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;       Type cannot be assigned to type &amp;quot;None&amp;quot; (reportGeneralTypeIssues)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
This would have been really helpful when interpreting mypy&#x27;s error reports; I&#x27;d love to see something like it in mypy.
Here&#x27;s another example where I tried running against a Synapse file.&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;&#x2F;home&#x2F;dmr&#x2F;workspace&#x2F;synapse&#x2F;synapse&#x2F;storage&#x2F;databases&#x2F;main&#x2F;cache.py
&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;home&#x2F;dmr&#x2F;workspace&#x2F;synapse&#x2F;synapse&#x2F;storage&#x2F;databases&#x2F;main&#x2F;cache.py:103:53 - error: Expression of type &amp;quot;list[tuple[Unknown, Tuple[Unknown, ...]]]&amp;quot; cannot be assigned to declared type &amp;quot;List[Tuple[int, _CacheData]]&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;  TypeVar &amp;quot;_T@list&amp;quot; is invariant
&lt;&#x2F;span&gt;&lt;span&gt;    Tuple entry 2 is incorrect type
&lt;&#x2F;span&gt;&lt;span&gt;      Tuple size mismatch; expected 3 but received indeterminate number (reportGeneralTypeIssues)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
This is really valuable information. It&#x27;s worth considering Pyright as an option to get a second opinion!&lt;&#x2F;li&gt;
&lt;li&gt;It looks like Pyright&#x27;s name for &lt;code&gt;Any&lt;&#x2F;code&gt; is &lt;code&gt;Unknown&lt;&#x2F;code&gt;. I think that does a better job of emphasising that &lt;code&gt;Unknown&lt;&#x2F;code&gt; won&#x27;t be type checked. I&#x27;d certainly be more reluctant to type &lt;code&gt;x: Unknown&lt;&#x2F;code&gt; versus &lt;code&gt;x: Any&lt;&#x2F;code&gt;!&lt;&#x2F;li&gt;
&lt;li&gt;Pyright is the machinery behind &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;pylance-release&quot;&gt;Pylance&lt;&#x2F;a&gt;, which drives &lt;a href=&quot;https:&#x2F;&#x2F;marketplace.visualstudio.com&#x2F;items?itemName=ms-python.vscode-pylance&quot;&gt;VS Code&#x27;s Python extension&lt;&#x2F;a&gt;. That alone probably makes it worthy of more eyes.&lt;&#x2F;li&gt;
&lt;li&gt;Seemed like it was the best-placed alternative typechecker to challenge mypy (the de-facto standard).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;pytype-google&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;google&#x2F;pytype&quot;&gt;Pytype&lt;&#x2F;a&gt; (Google)&lt;&#x2F;h4&gt;
&lt;ul&gt;
&lt;li&gt;Google internal? Seems to be maintained by one person semiregularly by &amp;quot;syncing&amp;quot; from Google.&lt;&#x2F;li&gt;
&lt;li&gt;Apparently contains a script &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;google&#x2F;pytype&#x2F;tree&#x2F;master&#x2F;pytype&#x2F;tools&#x2F;merge_pyi&quot;&gt;merge-pyi&lt;&#x2F;a&gt; to annotate a source file given a stub file.&lt;&#x2F;li&gt;
&lt;li&gt;No support for TypedDict: as soon as it saw one in Sydent, it stopped all analysis.&lt;&#x2F;li&gt;
&lt;li&gt;No Python 3.10 support (according to the README anyway).&lt;&#x2F;li&gt;
&lt;li&gt;I think it might use a different kind of typing semantics; its &lt;a href=&quot;https:&#x2F;&#x2F;google.github.io&#x2F;pytype&#x2F;typing_faq.html&quot;&gt;typing FAQ&lt;&#x2F;a&gt; speaks of &amp;quot;descriptive typing&amp;quot; and a more lenient approach.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;pycharm&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.jetbrains.com&#x2F;pycharm&#x2F;&quot;&gt;PyCharm&lt;&#x2F;a&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;PyCharm has its own means to typechecking code as you write it. It&#x27;s definitely caught bugs before, and having the instant feedback as you type is really nice! I have seen it struggle with &lt;code&gt;zope.interface&lt;&#x2F;code&gt; and some uses of &lt;code&gt;Generic&lt;&#x2F;code&gt;s though.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;runtime-uses-of-annotations&quot;&gt;Runtime uses of annotations&lt;&#x2F;h3&gt;
&lt;p&gt;When annotations &lt;a href=&quot;https:&#x2F;&#x2F;www.python.org&#x2F;dev&#x2F;peps&#x2F;pep-3107&#x2F;&quot;&gt;were first introduced&lt;&#x2F;a&gt;, they were a generic means to associate Python objects with parts of a program. (It was only later that the community agreed that we really want to use them to annotate &lt;em&gt;types&lt;&#x2F;em&gt;). These annotations are available at runtime in the &lt;code&gt;__annotations__&lt;&#x2F;code&gt; attribute. There&#x27;s also a helper function in &lt;code&gt;typing&lt;&#x2F;code&gt; which will help resolve forward references.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;&amp;gt;&amp;gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;get_type_hints
&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt;&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff3333;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;foo(x: int) -&amp;gt; str: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;pass
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;&amp;gt;&amp;gt; get_type_hints(foo)
&lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;#39;x&amp;#39;&lt;&#x2F;span&gt;&lt;span&gt;: &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff3333;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;#39;int&amp;#39;&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;#39;return&amp;#39;&lt;&#x2F;span&gt;&lt;span&gt;: &amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff3333;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;#39;str&amp;#39;&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Programs and libraries are free to use these annotations at runtime as they see fit. The most well-known examples are probably &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;dataclasses.html&quot;&gt;dataclasses&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;www.attrs.org&#x2F;en&#x2F;stable&#x2F;&quot;&gt;attrs&lt;&#x2F;a&gt; with &lt;a href=&quot;https:&#x2F;&#x2F;www.attrs.org&#x2F;en&#x2F;stable&#x2F;types.html&quot;&gt;auto_attribs=True&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;pydantic-docs.helpmanual.io&#x2F;&quot;&gt;Pydantic&lt;&#x2F;a&gt;. I&#x27;d be interested to learn if anyone else is consuming annotations at runtime!&lt;&#x2F;p&gt;
&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;&#x2F;h2&gt;
&lt;p&gt;All in all, in a two-week sprint we were able to get Sydent&#x27;s mypy coverage from a precision of 83% up to 94%. Our work would have spotted the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;415&quot;&gt;bytes-versus-strings bug&lt;&#x2F;a&gt;; we understand why &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;413&quot;&gt;the missing await&lt;&#x2F;a&gt; wasn&#x27;t detected. We &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;419&quot;&gt;fixed&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;449&quot;&gt;other&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;447&quot;&gt;small&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;445&quot;&gt;bugs&lt;&#x2F;a&gt; too as part of the process. As well as fix bugs, I&#x27;ve hopefully made the source code clearer for future readers (but that one is hard to quantify).&lt;&#x2F;p&gt;
&lt;p&gt;There&#x27;s room to spin out contributions upstream too. I submitted &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;twisted&#x2F;twisted&#x2F;pull&#x2F;1669&quot;&gt;two&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;twisted&#x2F;twisted&#x2F;pull&#x2F;1668&quot;&gt;PRs&lt;&#x2F;a&gt; to twisted upstream; have started to work on annotations for &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;pyca&#x2F;pynacl&#x2F;pull&#x2F;693&quot;&gt;pynacl&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;pyca&#x2F;pynacl&#x2F;pull&#x2F;694&quot;&gt;in my&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;pyca&#x2F;pynacl&#x2F;pull&#x2F;695&quot;&gt;spare time&lt;&#x2F;a&gt;; and submitted a quick fix to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;typeshed&#x2F;pull&#x2F;6150&quot;&gt;typeshed&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Looking forward, I think we&#x27;d get a quick gain from ensuring that our smaller libraries (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;python-signedjson&quot;&gt;signedjson&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;python-canonicaljson&quot;&gt;canonicaljson&lt;&#x2F;a&gt;) are annotated. We&#x27;ll be sticking with mypy for now—the &lt;code&gt;mypy-zope&lt;&#x2F;code&gt; plugin is crucial given our reliance on twisted. We&#x27;re also working to improve Sygnal and Synapse—though not to the extreme standard of &lt;code&gt;--strict&lt;&#x2F;code&gt; across everything.&lt;&#x2F;p&gt;
&lt;p&gt;I&#x27;d say the biggest outstanding hole is our processing of JSON objects. There&#x27;s too much &lt;code&gt;Dict[str, Any]&lt;&#x2F;code&gt; flying around. The ideal for me would be to define &lt;code&gt;dataclass&lt;&#x2F;code&gt; or &lt;code&gt;attr.s&lt;&#x2F;code&gt; class &lt;code&gt;C&lt;&#x2F;code&gt;, and be able to deserialise a JSON object to &lt;code&gt;C&lt;&#x2F;code&gt;, including automatic (deep) type checking. &lt;a href=&quot;https:&#x2F;&#x2F;pydantic-docs.helpmanual.io&#x2F;&quot;&gt;Pydantic&lt;&#x2F;a&gt; sounds really close to what we want, but I&#x27;m told it will by default gladly interpret the json string &lt;code&gt;&amp;quot;42&amp;quot;&lt;&#x2F;code&gt; as the Python integer &lt;code&gt;42&lt;&#x2F;code&gt;, which isn&#x27;t what we&#x27;d like. More investigation needed there. There are other avenues to explore too, like &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;erickpeirson&#x2F;jsonschema-typed&quot;&gt;jsonschema-typed&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;typedload&#x2F;&quot;&gt;typedload&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;bloomberg&#x2F;attrs-strict&quot;&gt;attrs-strict&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;To end, I&#x27;d like to add a few personal thoughts. Having types available in the source code is definitely A Good Thing. But there is a part of me that wonders if it might have been worth writing our projects in a language which incorporates types from day one. There are always trade-offs, of course: runtime performance, build times, iteration speed, ease of onboarding new contributors, ease of deployment, availability of libraries, ability to shoot yourself in the foot... the list goes on. &lt;&#x2F;p&gt;
&lt;p&gt;On a more upbeat note, adding typing is a great way to get familiar with new source code. It involves a mixture of reading, cross-referencing, deduction, analysis, all across a wide variety of files. It&#x27;d be a &lt;em&gt;lot&lt;&#x2F;em&gt; easier to type as you write from the get-go, but typing after the fact is still a worthy use of time and effort. &lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;Many thanks for reading! If you&#x27;ve got any corrections, comments or queries, I&#x27;m available on Matrix at &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;@dmrobertson:matrix.org&quot;&gt;@dmrobertson:matrix.org&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Type coverage for Sydent: annotation</title>
		<published>2021-12-10T00:00:00+00:00</published>
		<updated>2021-12-10T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/12/10/type-coverage-for-sydent-annotation/" type="text/html"/>
		<id>/blog/2021/12/10/type-coverage-for-sydent-annotation/</id>
		<content type="html">&lt;p&gt;This is the second in a series of three posts which discuss recent work to improve type annotations in &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&quot;&gt;Sydent&lt;&#x2F;a&gt;, the reference Matrix Identity server. &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;03&#x2F;type-coverage-for-sydent-motivation&quot;&gt;Last time&lt;&#x2F;a&gt; we discussed the motivation for doing this work in the first place: the &lt;em&gt;why&lt;&#x2F;em&gt;. Now I want to talk about the &lt;em&gt;how&lt;&#x2F;em&gt;. How did we add annotations to individual files, and across the project as whole? What common idioms did we learn on the way?&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-process-of-improving-coverage&quot;&gt;The process of improving coverage&lt;&#x2F;h2&gt;
&lt;p&gt;From experience adding typing to Synapse, we decided to annotate one module at a time. We configured a list of files in &lt;code&gt;pyproject.toml&lt;&#x2F;code&gt; which we knew passed mypy&#x27;s checks. We could run &lt;code&gt;mypy&lt;&#x2F;code&gt; in CI to check that new PRs didn&#x27;t introduce type problems in modules already covered.&lt;&#x2F;p&gt;
&lt;p&gt;From there, the workflow was&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Choose a new module to annotate. Add it to the list of &lt;code&gt;files&lt;&#x2F;code&gt; in mypy&#x27;s configuration.&lt;&#x2F;li&gt;
&lt;li&gt;Run &lt;code&gt;mypy&lt;&#x2F;code&gt;. See how many errors you get.&lt;&#x2F;li&gt;
&lt;li&gt;Choose an error. Fix it. Re-run &lt;code&gt;mypy&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Repeat until no errors remaining.&lt;&#x2F;li&gt;
&lt;li&gt;Submit for review.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;There are two parts in there which involve a choice. Being honest, I made those choices unscientifically: I tried to choose the easy tasks to do first. My first target was actually the entire &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;418&quot;&gt;sydent.util&lt;&#x2F;a&gt; subpackage. Probably a bit too large for a first bite! My thinking was that &lt;code&gt;util&lt;&#x2F;code&gt; sounded like something with few dependencies that would have impact across the whole source tree.&lt;&#x2F;p&gt;
&lt;p&gt;Within a given module, I&#x27;d try to fix easier errors first: partly for confidence, partly to build up momentum, and partly to get myself familiar with that piece of source code. For example, I&#x27;d often start by telling mypy that &lt;code&gt;mylist = []&lt;&#x2F;code&gt; was actually was a &lt;code&gt;List[str]&lt;&#x2F;code&gt; (rather than the generic &lt;code&gt;List[Any]&lt;&#x2F;code&gt; which it would use otherwise).&lt;&#x2F;p&gt;
&lt;p&gt;Picking and choosing easy targets works fairly well, but sometimes that means you end up fixing an error that&#x27;s really a symptom of an earlier one. Other times fixing one error, e.g. by giving a return type annotation to a function—would solve a series of other errors throughout the file. Watching the total number of errors mypy reports bob up and down was intriguing!&lt;&#x2F;p&gt;
&lt;p&gt;In retrospect, I think it would be smoother to generate some kind of dependency graph for the package. I&#x27;m imagining a &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Directed_acyclic_graph&quot;&gt;DAG&lt;&#x2F;a&gt; where whose vertices are modules, and there&#x27;s an edge &lt;code&gt;A -&amp;gt; B&lt;&#x2F;code&gt; if &lt;code&gt;A&lt;&#x2F;code&gt; imports from &lt;code&gt;B&lt;&#x2F;code&gt;. The sinks of this DAG (i.e. modules which don&#x27;t depend on any others in the package) are the ideal place to start: you can get something strictly typechecked there without having to annotate a long chain of dependencies across other files. Another strategy would be to see which modules were the least precise according to mypy&#x27;s reports—but more on those &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;17&#x2F;type-coverage-for-sydent-evaluation&quot;&gt;next time&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;you-re-at-the-mercy-of-your-dependencies&quot;&gt;You&#x27;re at the mercy of your dependencies&lt;&#x2F;h3&gt;
&lt;p&gt;I think this is my single biggest takeaway from the process of adding annotations to Sydent.
I&#x27;ll admit the phrasing is melodramatic, but I think it rings true. &lt;&#x2F;p&gt;
&lt;p&gt;Improving coverage boils down to giving the typechecker more information about your program. The more information it has, the more it can check—and the more errors it can spot. (Hopefully this doesn&#x27;t make typing come across like a pyramid scheme.) If your dependencies aren&#x27;t typed, mypy can&#x27;t validate you&#x27;re correctly providing inputs and correctly consuming outputs. You might have a bigger impact on overall typing coverage by annotating a dependency (directly or via stubs). I have a hunch that bugs are more likely in code that uses an external dependency: we&#x27;re much more familiar with the details of our own source code compared to that of a third party we trust.&lt;&#x2F;p&gt;
&lt;p&gt;It&#x27;s worth looking to see if your dependencies have a newer version including type annotations. Failing that, they may have a stub package added to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;typeshed&#x2F;tree&#x2F;master&#x2F;stubs&quot;&gt;typeshed&lt;&#x2F;a&gt; and published on PyPI. I saw example of both cases when choosing how to configure mypy for Sydent. If some of your dependencies are under your control, consider annotating them—you&#x27;ll feel the benefits across multiple projects pretty quickly.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;annotations-when-working-with-twisted&quot;&gt;Annotations when working with twisted&lt;&#x2F;h3&gt;
&lt;p&gt;Twisted is Sydent&#x27;s biggest dependency, and I certainly felt at its mercy! In particular, it has a few quirks which make it trickier to annotate applications using it. Here&#x27;s a summary of the work we had to do to get those annotations working.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;partially-typed-modules-and-stubs&quot;&gt;Partially typed modules and stubs&lt;&#x2F;h4&gt;
&lt;p&gt;Early into the process, mypy reported that calling the function &lt;a href=&quot;https:&#x2F;&#x2F;twistedmatrix.com&#x2F;documents&#x2F;current&#x2F;api&#x2F;twisted.python.log.html#err&quot;&gt;twisted.python.log.err&lt;&#x2F;a&gt; was an error. It did so because I was running mypy in &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#cmdoption-mypy-strict&quot;&gt;--strict mode&lt;&#x2F;a&gt;. We&#x27;ll talk more about why I did so and what this means &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;17&#x2F;type-coverage-for-sydent-evaluation&quot;&gt;next time&lt;&#x2F;a&gt;; for now, it&#x27;s enough to know that calling a function that isn&#x27;t fully annotated from within a function that is constitutes an error under strict mode. &lt;code&gt;twisted&lt;&#x2F;code&gt; is partially annotated: many key modules and functions have type annotations, but others don&#x27;t. I was reluctant to give up on &lt;code&gt;--strict&lt;&#x2F;code&gt;. Instead, I decided to stub the &lt;code&gt;err&lt;&#x2F;code&gt; function myself.&lt;&#x2F;p&gt;
&lt;p&gt;A stub is a cut-down version of a python function, class or module which lives in a &lt;code&gt;.pyi&lt;&#x2F;code&gt; file. All implementation details are removed; only type annotations remain. Stubs are useful when you want to write annotations for code you don&#x27;t control. The &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;typeshed&quot;&gt;typeshed&lt;&#x2F;a&gt; library is probably the best example: a collection of third party stubs for the standard library, plus some popular third party packages. Microsoft&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;python-type-stubs&quot;&gt;python-type-stubs&lt;&#x2F;a&gt; is another example. They&#x27;d also solve the problem I mentioned at the end of the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;03&#x2F;type-coverage-for-sydent-motivation&quot;&gt;first part&lt;&#x2F;a&gt;: I could use a stub to &lt;em&gt;teach&lt;&#x2F;em&gt; mypy that &lt;code&gt;IResponse.headers&lt;&#x2F;code&gt; was a &lt;code&gt;Headers&lt;&#x2F;code&gt; object. &lt;&#x2F;p&gt;
&lt;p&gt;Writing a stub for &lt;code&gt;log.err&lt;&#x2F;code&gt; was straightforward, thanks mainly to Twisted&#x27;s thorough documentation. I chose to write it by hand, rather than use &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;stubgen.html&quot;&gt;stubgen&lt;&#x2F;a&gt;. I&#x27;d heard of the latter, but was reluctant to use it for a few reasons.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Twisted is a big project with many big files. I didn&#x27;t want to commit huge stub files for me and my colleagues to maintain.&lt;&#x2F;li&gt;
&lt;li&gt;The more our stubs cover, the larger the risk of a stub becoming out-of-date with twisted itself. Upstream twisted is the best place for these annotations.&lt;&#x2F;li&gt;
&lt;li&gt;We only need annotations for the bits of twisted that we&#x27;re using.&lt;&#x2F;li&gt;
&lt;li&gt;And, being honest: I wanted the low-level experience of writing stubs, cross-referencing between the source and working how to best capture its type semantics.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I think this decision to write a targeted stub made sense at the time. After all, &lt;code&gt;twisted.python.logging.err&lt;&#x2F;code&gt; is just one simple function! But for the project as a whole, I regret not using &lt;code&gt;stubgen&lt;&#x2F;code&gt; to generate module-level stubs. The reason for this is that a &lt;code&gt;.pyi&lt;&#x2F;code&gt; stub file accounts for an entire module: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;issues&#x2F;5880#issuecomment-439237176&quot;&gt;no more and no less&lt;&#x2F;a&gt;. This means that the stubs I was writing for parts of twisted only covered the functions and classes I&#x27;d stubbed. Any existing annotations in the twisted source code would be ignored, along with any types that mypy was able to infer for itself.&lt;&#x2F;p&gt;
&lt;p&gt;I think it would have been more efficient to use &lt;code&gt;stubgen&lt;&#x2F;code&gt; to generate stubs and patch them up, rather than writing them. That would have helped avoid a few cases I encountered where stubbing one function would cause additional typechecking failures (because mypy was no longer examining the twisted source for that file). It would also have meant that I could just faithfully stub Twisted as it is; in practice, I would sometimes hesitate to stub to avoid having to cover another module. &lt;code&gt;sydent.http&lt;&#x2F;code&gt; was the most painful part of the source tree for this: that&#x27;s where we make the most use of Twisted.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;defer-inlinecallbacks&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;twistedmatrix.com&#x2F;documents&#x2F;current&#x2F;api&#x2F;twisted.internet.defer.html#inlineCallbacks&quot;&gt;defer.inlineCallbacks&lt;&#x2F;a&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;This is a decorator which allows us to write code in the style of &lt;code&gt;async&lt;&#x2F;code&gt;&#x2F;&lt;code&gt;await&lt;&#x2F;code&gt; without actually using that syntax. (Twisted predates &lt;code&gt;asyncio&lt;&#x2F;code&gt; and the &lt;code&gt;async&lt;&#x2F;code&gt;&#x2F;&lt;code&gt;await&lt;&#x2F;code&gt; syntax, introduced in Python 3.4 and 3.5 respectively. It was originally released in 2002, back when Python had released version 2.2.) We only use it in &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;blob&#x2F;e4b4dbbdf25255d19effceae7061ad9b3eefc374&#x2F;sydent&#x2F;http&#x2F;matrixfederationagent.py#L125-L132&quot;&gt;one place in Sydent&lt;&#x2F;a&gt; nowadays, but I&#x27;ve seen used across Synapse too. I mention it here because it was a bit fiddly to annotate. Here&#x27;s its use in Sydent:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;    @defer.inlineCallbacks
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;request(
&lt;&#x2F;span&gt;&lt;span&gt;        self,
&lt;&#x2F;span&gt;&lt;span&gt;        method: bytes,
&lt;&#x2F;span&gt;&lt;span&gt;        uri: bytes,
&lt;&#x2F;span&gt;&lt;span&gt;        headers: Optional[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;Headers&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        bodyProducer: Optional[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;IBodyProducer&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    ) -&amp;gt; Generator[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;defer.Deferred[Any]&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, Any, IResponse]:
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Here, &lt;code&gt;request&lt;&#x2F;code&gt; is a &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;glossary.html#term-generator&quot;&gt;generator function&lt;&#x2F;a&gt; because its body uses the &lt;code&gt;yield&lt;&#x2F;code&gt; keyword. Yielding allows the function to relinquish control back to twisted&#x27;s reactor, only for its execution to be resumed asynchronously in the future. The &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=typing%20generator#typing.Generator&quot;&gt;Generator&lt;&#x2F;a&gt; type takes three parameters:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;a &lt;code&gt;YieldType&lt;&#x2F;code&gt;, &lt;code&gt;Deferred[Any]&lt;&#x2F;code&gt;;&lt;&#x2F;li&gt;
&lt;li&gt;a &lt;code&gt;SendType&lt;&#x2F;code&gt;, &lt;code&gt;Any&lt;&#x2F;code&gt;; and&lt;&#x2F;li&gt;
&lt;li&gt;a &lt;code&gt;ReturnType&lt;&#x2F;code&gt;, &lt;code&gt;IResponse&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Why have I opted to use &lt;code&gt;Any&lt;&#x2F;code&gt; here, when we&#x27;ve seen (and will see) that this limits mypy&#x27;s ability to run checks? The answer is that we yield two different types within the function. Firstly a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;blob&#x2F;e4b4dbbdf25255d19effceae7061ad9b3eefc374&#x2F;sydent&#x2F;http&#x2F;matrixfederationagent.py#L152-L153&quot;&gt;routing result&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;        routing: _RoutingResult
&lt;&#x2F;span&gt;&lt;span&gt;        routing = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;yield &lt;&#x2F;span&gt;&lt;span&gt;defer.ensureDeferred(self._route_matrix_uri(parsed_uri))
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;and later, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;blob&#x2F;e4b4dbbdf25255d19effceae7061ad9b3eefc374&#x2F;sydent&#x2F;http&#x2F;matrixfederationagent.py#L194-L195&quot;&gt;the IResponse&lt;&#x2F;a&gt; we go on to return:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;        res: IResponse
&lt;&#x2F;span&gt;&lt;span&gt;        res = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;yield &lt;&#x2F;span&gt;&lt;span&gt;agent.request(method, uri, headers, bodyProducer)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;In this example:&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;We yield a value &lt;code&gt;y: Deferred[Any]&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;That will later be resolved by twisted to an &lt;code&gt;x: Any&lt;&#x2F;code&gt; value. Twisted will send that value to &lt;code&gt;request&lt;&#x2F;code&gt;, and the execution continues.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;This repeats, until we eventually return an &lt;code&gt;IResponse&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I could more correctly annotate the &lt;code&gt;YieldType&lt;&#x2F;code&gt; as &lt;code&gt;Deferred[Union[_RoutingResult, IResponse]]&lt;&#x2F;code&gt; so that the &lt;code&gt;SendType&lt;&#x2F;code&gt; was &lt;code&gt;Union[_RoutingResult, IResponse]&lt;&#x2F;code&gt;. But this would mean we end up having some kind of type check at each yield point: a &lt;code&gt;cast&lt;&#x2F;code&gt;, or a &lt;code&gt;type: ignore&lt;&#x2F;code&gt;, or a runtime &lt;code&gt;isinstance&lt;&#x2F;code&gt; check. It didn&#x27;t feel like it was worth the boilerplate, especially since I could narrow e.g. &lt;code&gt;res: Any&lt;&#x2F;code&gt; to &lt;code&gt;res: IResponse&lt;&#x2F;code&gt; with minimal effort.&lt;&#x2F;p&gt;
&lt;p&gt;This problem doesn&#x27;t arise with using the &lt;code&gt;async&#x2F;await&lt;&#x2F;code&gt; syntax:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;async def &lt;&#x2F;span&gt;&lt;span&gt;foo() -&amp;gt; int:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;async def &lt;&#x2F;span&gt;&lt;span&gt;bar() -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    x = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;await &lt;&#x2F;span&gt;&lt;span&gt;foo()
&lt;&#x2F;span&gt;&lt;span&gt;    reveal_type(foo())
&lt;&#x2F;span&gt;&lt;span&gt;    reveal_type(x)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;$ mypy example.py
&lt;&#x2F;span&gt;&lt;span&gt;example.py:6: note: Revealed type is &amp;quot;typing.Coroutine[Any, Any, builtins.int]&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;example.py:7: note: Revealed type is &amp;quot;builtins.int*&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Behind the scenes, I &lt;em&gt;think&lt;&#x2F;em&gt; that &lt;code&gt;x = await foo()&lt;&#x2F;code&gt; is really using the same mechanism as the &lt;code&gt;inlineCallbacks&lt;&#x2F;code&gt; approach.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;An &lt;code&gt;async def&lt;&#x2F;code&gt; function is really a generator function behind the scenes.&lt;&#x2F;li&gt;
&lt;li&gt;When we &lt;code&gt;await foo()&lt;&#x2F;code&gt;, we yield the expression &lt;code&gt;foo()&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Then the machinery running our coroutine &lt;code&gt;c&lt;&#x2F;code&gt; will call &lt;code&gt;c.send(x)&lt;&#x2F;code&gt; to resume execution, where &lt;code&gt;x&lt;&#x2F;code&gt; is the value produced by waiting for &lt;code&gt;foo()&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;With the &lt;code&gt;await&lt;&#x2F;code&gt; form, mypy knows two things:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;the value &lt;code&gt;foo()&lt;&#x2F;code&gt; which was yielded should be &lt;code&gt;Awaitable[T]&lt;&#x2F;code&gt;, and&lt;&#x2F;li&gt;
&lt;li&gt;the value &lt;code&gt;x&lt;&#x2F;code&gt; send to the coroutine should come from awaiting &lt;code&gt;foo()&lt;&#x2F;code&gt;, and therefore be of type &lt;code&gt;T&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Mypy can&#x27;t assume or enforce these rules for the yield form, which can yield and send whatever it likes. There&#x27;s no reason why the send type should be related to the yield type. Here&#x27;s a toy example:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;Any, Dict, Generator
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;generator_function() -&amp;gt; Generator[int, str, Dict[str, Any]]:
&lt;&#x2F;span&gt;&lt;span&gt;  y: int = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;10
&lt;&#x2F;span&gt;&lt;span&gt;  x: str = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;yield &lt;&#x2F;span&gt;&lt;span&gt;y
&lt;&#x2F;span&gt;&lt;span&gt;  print(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;Coroutine was sent&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, x)  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# -&amp;gt; Coroutine was sent hello
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;{&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;got&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: x, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;done&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;coroutine = generator_function()
&lt;&#x2F;span&gt;&lt;span&gt;y = next(coroutine)
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;try&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  coroutine.send(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;hello&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;except &lt;&#x2F;span&gt;&lt;span&gt;StopIteration &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span&gt;e:
&lt;&#x2F;span&gt;&lt;span&gt;  return_value = e.value
&lt;&#x2F;span&gt;&lt;span&gt;  print(return_value)  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# -&amp;gt; {&amp;#39;got&amp;#39;: &amp;#39;hello&amp;#39;, &amp;#39;done&amp;#39;: True}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;All in all, the handling of &lt;code&gt;inlineCallbacks&lt;&#x2F;code&gt; is a situation specific to working with (older?) twisted code. It&#x27;s still nice to understand what&#x27;s going on behind the scenes though!&lt;&#x2F;p&gt;
&lt;h4 id=&quot;zope-interface-interface&quot;&gt;&lt;code&gt;zope.interface.Interface&lt;&#x2F;code&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;Twisted makes use of &lt;code&gt;zope&lt;&#x2F;code&gt;&#x27;s &lt;code&gt;Interface&lt;&#x2F;code&gt; to define a number of abstract interface classes. Speaking personally, I&#x27;ve not seen it used outside twisted, and I think that means it&#x27;s not supported by much of the typechecking tooling. For example, I&#x27;ve definitely seen PyCharm struggle to realise that it&#x27;s okay to pass a &lt;code&gt;Response&lt;&#x2F;code&gt; to a function which expects an &lt;code&gt;IResponse&lt;&#x2F;code&gt;! Here&#x27;s a more complicated example where &lt;code&gt;PyCharm&lt;&#x2F;code&gt; isn&#x27;t happy with me widening the type &lt;code&gt;LoggingHostnameEndpoint&lt;&#x2F;code&gt; to &lt;code&gt;IStreamClientEndpoint&lt;&#x2F;code&gt;, even though &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;blob&#x2F;92ff7a878a25696365b10cc49e32f5cba32c5960&#x2F;sydent&#x2F;http&#x2F;matrixfederationagent.py#L379-L380&quot;&gt;the latter implements the former&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;blog&#x2F;img&#x2F;2021-12-10-pycharm-false-positive.png&quot; alt=&quot;Screenshot from pycharm showing a false positive warning&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Mypy out of the box doesn&#x27;t play well with a zope &lt;code&gt;Interface&lt;&#x2F;code&gt; (nor does any other typechecker I tried). Fortunately, the excellent &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Shoobx&#x2F;mypy-zope&quot;&gt;mypy-zope&lt;&#x2F;a&gt; plugin helps here: it teaches mypy that any class like &lt;code&gt;Response&lt;&#x2F;code&gt; which &lt;code&gt;@implements(IResponse)&lt;&#x2F;code&gt;  can be passed in place of an &lt;code&gt;IResponse&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;tricks-of-the-trade&quot;&gt;Tricks of the trade&lt;&#x2F;h3&gt;
&lt;p&gt;At this point I&#x27;d like to share a few generic lessons about typing I&#x27;d picked up. Nothing ground-breaking here: I think these are all fairly well-known. Hopefully they&#x27;re the start of a good cheat sheet for annotating—though it pales in comparison to the &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;cheat_sheet_py3.html&quot;&gt;Mypy cheat sheet&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;annotating-decorators&quot;&gt;Annotating decorators&lt;&#x2F;h4&gt;
&lt;p&gt;Annotating decorators is fiddly, but it&#x27;s also vitally important. An unannotated decorator will mask or throw away your decoratee&#x27;s annotations! The way to write the annotation is best explained by the &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;generics.html#declaring-decorators&quot;&gt;mypy docs&lt;&#x2F;a&gt;, but briefly: it involves a &lt;code&gt;TypeVar&lt;&#x2F;code&gt; and sometimes a &lt;code&gt;cast&lt;&#x2F;code&gt; too. Here&#x27;s an example.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;TypeVar, Callable, Any, cast
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;F = TypeVar(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;F&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;, bound=Callable[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;...&lt;&#x2F;span&gt;&lt;span&gt;, Any])
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;decorator(input: F) -&amp;gt; F:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;wrapped(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;*&lt;&#x2F;span&gt;&lt;span&gt;args: Any, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;**&lt;&#x2F;span&gt;&lt;span&gt;kwargs: Any) -&amp;gt; Any:
&lt;&#x2F;span&gt;&lt;span&gt;        print(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;f&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;Calling &lt;&#x2F;span&gt;&lt;span&gt;{f.__name__}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;input_func(*args, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;**&lt;&#x2F;span&gt;&lt;span&gt;kwargs)
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;cast(F, wrapped)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The idea here is&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Use &lt;code&gt;Callable[..., Any]&lt;&#x2F;code&gt; to describe a generic function with no particular signature.&lt;&#x2F;li&gt;
&lt;li&gt;Use that as a bound on a type variable &lt;code&gt;F&lt;&#x2F;code&gt;. At each usage of &lt;code&gt;@decorator&lt;&#x2F;code&gt;, mypy will deduce a more specific version of &lt;code&gt;F&lt;&#x2F;code&gt;, e.g. &lt;code&gt;Callable[[int], str]&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Within that usage of &lt;code&gt;@decorator&lt;&#x2F;code&gt;, &lt;code&gt;F&lt;&#x2F;code&gt; is fixed to that specific type. We use &lt;code&gt;-&amp;gt; F&lt;&#x2F;code&gt; to express that &amp;quot;we return a function with the same signature as the decoratee&amp;quot;.&lt;&#x2F;li&gt;
&lt;li&gt;Unfortunately, we don&#x27;t have a good way to tell &lt;code&gt;mypy&lt;&#x2F;code&gt; that &lt;code&gt;wrapped&lt;&#x2F;code&gt; also has that signature &lt;code&gt;F&lt;&#x2F;code&gt;. We resort to a &lt;code&gt;cast&lt;&#x2F;code&gt; to force mypy to accept this without proof.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;This might change in the future, e.g. when &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=paramspec#typing.ParamSpec&quot;&gt;ParamSpec&lt;&#x2F;a&gt; is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;issues&#x2F;8645&quot;&gt;fully understood&lt;&#x2F;a&gt; by mypy.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;prefer-object-over-any&quot;&gt;Prefer &lt;code&gt;object&lt;&#x2F;code&gt; over &lt;code&gt;Any&lt;&#x2F;code&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;Both of these are general types for expressing &amp;quot;I don&#x27;t know anything about this expression&amp;quot;. But only the former will undergo static type checks. We want those type checks to guard against bugs accidentally introduced in the future. For instance, imagine a class with an &lt;code&gt;Any&lt;&#x2F;code&gt; attribute.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;Any
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;dataclasses
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;@dataclasses.dataclass
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span&gt;C:
&lt;&#x2F;span&gt;&lt;span&gt;    label: Any
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Imagine in the future we add a new method which assumes that &lt;code&gt;label&lt;&#x2F;code&gt; is a string:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;greeting(self) -&amp;gt; str:
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;My name is &amp;quot; &lt;&#x2F;span&gt;&lt;span&gt;+ self.label
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Mypy will consider this valid, because no type-checking is done on an &lt;code&gt;Any&lt;&#x2F;code&gt; value. It will complain that it can&#x27;t prove that &lt;code&gt;greeting&lt;&#x2F;code&gt; returns a &lt;code&gt;str&lt;&#x2F;code&gt;, if &lt;code&gt;--warn-return-any&lt;&#x2F;code&gt; is enabled; but putting that aside, it can&#x27;t identify the call site as a bug. The bug slips through to runtime.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;C(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;123&lt;&#x2F;span&gt;&lt;span&gt;).greeting()  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# TypeError: can only concatenate str (not &amp;quot;int&amp;quot;) to str
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Replacing the &lt;code&gt;Any&lt;&#x2F;code&gt; with &lt;code&gt;object&lt;&#x2F;code&gt; does allow mypy to spot the problem.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;error: Unsupported operand types for + (&amp;quot;str&amp;quot; and &amp;quot;object&amp;quot;)  [operator]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h4 id=&quot;type-ignore-and-cast-sparingly&quot;&gt;&lt;code&gt;# type: ignore&lt;&#x2F;code&gt; and &lt;code&gt;cast&lt;&#x2F;code&gt; sparingly&lt;&#x2F;h4&gt;
&lt;p&gt;There&#x27;s a good chance that mypy knows better than we do, so we should only overrule it if there&#x27;s no better option. There are two techniques for this. One option is to tell mypy to just silence the error, by appending a &lt;code&gt;# type: ignore&lt;&#x2F;code&gt; comment to the erroneous line. The other is to force it to accept that a certain expression has a given type: that&#x27;s what &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=paramspec#typing.cast&quot;&gt;cast&lt;&#x2F;a&gt; is for.&lt;&#x2F;p&gt;
&lt;p&gt;I never like using either of these, but sometimes they&#x27;re the most practical choice. I&#x27;d recommend two best practices for their use, however:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Only ignore a specific error code, e.g. &lt;code&gt;# type: ignore[assignment]&lt;&#x2F;code&gt;.  Those codes can be displayed by passing &lt;code&gt;--show-error-codes&lt;&#x2F;code&gt; to mypy.&lt;&#x2F;li&gt;
&lt;li&gt;Leave a comment before every &lt;code&gt;#type: ignore[...]&lt;&#x2F;code&gt; and every &lt;code&gt;cast&lt;&#x2F;code&gt; to justify their correctness. I don&#x27;t think this is a widely-held practice. I picked it up from the Rust world, where it&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;rust-lang.github.io&#x2F;api-guidelines&#x2F;documentation.html#function-docs-include-error-panic-and-safety-considerations-c-failure&quot;&gt;encouraged&lt;&#x2F;a&gt; as a way to justify &lt;code&gt;unsafe&lt;&#x2F;code&gt; source code.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h4 id=&quot;there-s-good-stuff-in-typing&quot;&gt;There&#x27;s good stuff in &lt;code&gt;typing&lt;&#x2F;code&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;It&#x27;s worth a read through the &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html&quot;&gt;module documentation&lt;&#x2F;a&gt;—plenty of things in there I wish I&#x27;d known about sooner. There&#x27;s lots in the toolkit to chose from. Some bits I use fairly often include:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=typing%20protocol#typing.Protocol&quot;&gt;Protocol&lt;&#x2F;a&gt;: lets you formalise duck typing. To use it, define a class that inherits from &lt;code&gt;Protocol&lt;&#x2F;code&gt;. Its methods and attributes are all stubs which describe what you require of objects belonging to this type. It&#x27;s like an &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;abc.html?highlight=abc#module-abc&quot;&gt;abstract base class&lt;&#x2F;a&gt; or interface, but purely at typecheck time.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=typing%20generic#typing.Generic&quot;&gt;Generic&lt;&#x2F;a&gt;: define your own generic types. A bit of a slippery slope to type mania!&lt;&#x2F;li&gt;
&lt;li&gt;[Optional&lt;code&gt;](https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=typing%20generic#typing.Optional): I use this all the time. It&#x27;s always good to make your &lt;&#x2F;code&gt;None`s explicit!&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=typing%20generic#typing.NewType&quot;&gt;NewType&lt;&#x2F;a&gt;: I haven&#x27;t had a chance to use it much. As I understand it, it&#x27;s a way to define a &amp;quot;strong typedef&amp;quot;. For example, we can use it to distinguish lengths from durations, even if they&#x27;re both represented by a &lt;code&gt;float&lt;&#x2F;code&gt; at runtime.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;I want to call out two parts of &lt;code&gt;typing&lt;&#x2F;code&gt; in particular:&lt;&#x2F;p&gt;
&lt;h4 id=&quot;overload&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=typing%20generic#typing.overload&quot;&gt;overload&lt;&#x2F;a&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;&lt;code&gt;overload&lt;&#x2F;code&gt; is a way to provide extra information about a function depending on how it&#x27;s called. For instance, consider this function which takes a &lt;code&gt;str&lt;&#x2F;code&gt; or &lt;code&gt;bytes&lt;&#x2F;code&gt; as input and returns its uppercase version.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;upper(x: Union[bytes, str]) -&amp;gt; Union[bytes, str]:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;x.upper()
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The problem with this annotation is that we&#x27;ll have to check at every call site to see if the return value was a &lt;code&gt;bytes&lt;&#x2F;code&gt; or a &lt;code&gt;str&lt;&#x2F;code&gt; object. But we know that uppercasing a &lt;code&gt;str&lt;&#x2F;code&gt; gives us a &lt;code&gt;str&lt;&#x2F;code&gt;, and uppercasing a &lt;code&gt;bytes&lt;&#x2F;code&gt; gives us a &lt;code&gt;bytes.&lt;&#x2F;code&gt; We can use &lt;code&gt;overload&lt;&#x2F;code&gt; to express this.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;overload
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;@overload
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;upper(x: str) -&amp;gt; str: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;@overload
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;upper(x: bytes) -&amp;gt; bytes: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;upper(x: Union[bytes, str]) -&amp;gt; Union[bytes, str]:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;x.upper()
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The first two &lt;code&gt;@overload&lt;&#x2F;code&gt; definitions are like stubs: they&#x27;re purely used for their annotations. The actual runtime implementation is specified at the end, undecorated. (&lt;strong&gt;NB&lt;&#x2F;strong&gt;: this specific example is better expressed without overloads, by using &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=typing%20generic#typing.AnyStr&quot;&gt;AnyStr&lt;&#x2F;a&gt;.)&lt;&#x2F;p&gt;
&lt;p&gt;I was really impressed to see how &lt;code&gt;mypy&lt;&#x2F;code&gt; could use this overloading information. Here&#x27;s an example:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;overload, Literal
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;@overload
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;f(x: int) -&amp;gt; Literal[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span&gt;]: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;@overload
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;f(x: str) -&amp;gt; Literal[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;]: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;...
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;f(x: object) -&amp;gt; int:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;isinstance(x, int):
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;elif &lt;&#x2F;span&gt;&lt;span&gt;isinstance(x, str):
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;2
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;3
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span&gt;f(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;10&lt;&#x2F;span&gt;&lt;span&gt;) == &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    print(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;potato&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We can see that &lt;code&gt;f(10) == 1&lt;&#x2F;code&gt; and so the equality is always &lt;code&gt;False&lt;&#x2F;code&gt;: we&#x27;ll never print the word &amp;quot;potato&amp;quot;. Mypy can reason through this too, if we ask it nicely.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;$ mypy example.py
&lt;&#x2F;span&gt;&lt;span&gt;Success: no issues found in 1 source file
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;$ mypy --strict-equality --warn-unreachable example.py
&lt;&#x2F;span&gt;&lt;span&gt;example.py:16: error: Non-overlapping equality check (left operand type: &amp;quot;Literal[1]&amp;quot;, right operand type: &amp;quot;Literal[2]&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;example.py:17: error: Statement is unreachable
&lt;&#x2F;span&gt;&lt;span&gt;Found 2 errors in 1 file (checked 1 source file)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h4 id=&quot;typeddict&quot;&gt;&lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html?highlight=typeddict#typing.TypedDict&quot;&gt;TypedDict&lt;&#x2F;a&gt;&lt;&#x2F;h4&gt;
&lt;p&gt;I mentioned this &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;03&#x2F;type-coverage-for-sydent-motivation&quot;&gt;in last week&#x27;s post&lt;&#x2F;a&gt;) when talking about the missing &lt;code&gt;await&lt;&#x2F;code&gt; bug.
Subclassing from &lt;code&gt;TypedDict&lt;&#x2F;code&gt; allows us to define a new type whose values are dictionaries with&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;a fixed set of keys (some mandatory, some not), and&lt;&#x2F;li&gt;
&lt;li&gt;a fixed type for each key&#x27;s value.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;www.python.org&#x2F;dev&#x2F;peps&#x2F;pep-0589&#x2F;&quot;&gt;PEP 589&lt;&#x2F;a&gt; can best describe the motivation, but in short: there&#x27;s a lot of source code out there that passes dictionaries around. &lt;code&gt;TypedDict&lt;&#x2F;code&gt; is a way to gradually add typechecking to that code, without having to refactor it to use e.g. a &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;dataclasses.html&quot;&gt;dataclass&lt;&#x2F;a&gt; or a &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html#typing.NamedTuple&quot;&gt;NamedTuple&lt;&#x2F;a&gt;. Let&#x27;s have a quick example.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;List, TypedDict
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span&gt;Person(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4ec9b0;&quot;&gt;TypedDict&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span&gt;    full_name: str
&lt;&#x2F;span&gt;&lt;span&gt;    nicknames: List[str]
&lt;&#x2F;span&gt;&lt;span&gt;    age: int
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;p: Person = {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;full_name&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;David Matthew Robertson&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;nicknames&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: [&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;dmr&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;],
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;age&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;29&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Mypy will detect if you delete or omit a required key, or if you insert a key that&#x27;s not part of the type.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# error: Key &amp;quot;age&amp;quot; of TypedDict &amp;quot;Person&amp;quot; cannot be deleted
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;del &lt;&#x2F;span&gt;&lt;span&gt;p[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;age&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# error: Missing keys (&amp;quot;full_name&amp;quot;, &amp;quot;nicknames&amp;quot;, &amp;quot;age&amp;quot;) for TypedDict &amp;quot;Person&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;p2: Person = {}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# error: TypedDict &amp;quot;Person&amp;quot; has no key &amp;quot;eye_colour&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;p[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;eye_colour&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;] = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;brown&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;code&gt;TypedDict&lt;&#x2F;code&gt; is a useful tool, but there are a few important gotchas to be aware of. In my view, these are all minor and worth putting up with, to benefit from the extra type information that a &lt;code&gt;TypedDict&lt;&#x2F;code&gt; provides. Let&#x27;s take a look.&lt;&#x2F;p&gt;
&lt;h5 id=&quot;typeddict-is-incompatible-with-dict&quot;&gt;&lt;code&gt;TypedDict&lt;&#x2F;code&gt; is incompatible with &lt;code&gt;Dict&lt;&#x2F;code&gt;&lt;&#x2F;h5&gt;
&lt;p&gt;This one surprised me at first. Why can&#x27;t I pass my &lt;code&gt;TypedDict&lt;&#x2F;code&gt; to a function that accepts a generic dictionary?&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;json
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;Dict, TypedDict
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span&gt;Foo(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4ec9b0;&quot;&gt;TypedDict&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span&gt;    bar: str
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;print_size(d: Dict[object, object]) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;None&lt;&#x2F;span&gt;&lt;span&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    print(len(d))
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;f: Foo = {&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;bar&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;baz&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# error: Argument 1 to &amp;quot;print_size&amp;quot; has incompatible type &amp;quot;Foo&amp;quot;; expected &amp;quot;Dict[object, object]&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;print_size(f)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The answer is that it wouldn&#x27;t be type-safe! For all we know, the function &lt;code&gt;print_size&lt;&#x2F;code&gt; might mutate its argument &lt;code&gt;d&lt;&#x2F;code&gt;. It might add a key, remove a key, or change the type of a value. Each of those would break the contract that &lt;code&gt;TypedDict&lt;&#x2F;code&gt; is supposed to enforce, so mypy is correct to flag this as an error. &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;issues&#x2F;4976&quot;&gt;This GitHub issue&lt;&#x2F;a&gt; has more discussion.&lt;&#x2F;p&gt;
&lt;p&gt;There are few workarounds for this kind of problem.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;The function might be able to accept a &lt;code&gt;TypedDict&lt;&#x2F;code&gt; directly.&lt;&#x2F;li&gt;
&lt;li&gt;The function could accept a &lt;code&gt;Mapping&lt;&#x2F;code&gt; instead of a &lt;code&gt;Dict&lt;&#x2F;code&gt;. This is type-safe because the &lt;code&gt;Mapping&lt;&#x2F;code&gt; type does not offer mutating methods such as &lt;code&gt;pop&lt;&#x2F;code&gt;, &lt;code&gt;__setitem__&lt;&#x2F;code&gt;, &lt;code&gt;__del__&lt;&#x2F;code&gt;; but it only works if the function does not mutate the dictionary.&lt;&#x2F;li&gt;
&lt;li&gt;A more drastic approach would discard the &lt;code&gt;TypedDict&lt;&#x2F;code&gt; information with a &lt;code&gt;cast&lt;&#x2F;code&gt; to &lt;code&gt;Dict[str, object]&lt;&#x2F;code&gt; or similar. If so, I&#x27;d strongly recommend a comment explaining why the cast is correct and safe.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h5 id=&quot;mixing-mandatory-and-required-fields&quot;&gt;Mixing mandatory and required fields&lt;&#x2F;h5&gt;
&lt;p&gt;Secondly, defining a &lt;code&gt;TypedDict&lt;&#x2F;code&gt; with a mixture of optional and required keys is a little fiddly. All keys can be made optional by passing &lt;code&gt;total=False&lt;&#x2F;code&gt; in the class definition. To have some keys optional and others mandatory, we have to make &lt;em&gt;two&lt;&#x2F;em&gt; TypedDicts. Say for instance we wanted to allow a potentially-missing &lt;code&gt;favourite_colour&lt;&#x2F;code&gt; field to &lt;code&gt;Person&lt;&#x2F;code&gt;. We can&#x27;t add an annotation &lt;code&gt;favourite_colour: Optional[str]&lt;&#x2F;code&gt; to the first class body. That&#x27;s optional in a different sense: it would mean that &lt;code&gt;favourite_colour&lt;&#x2F;code&gt; is a mandatory field which is allowed to be &lt;code&gt;None&lt;&#x2F;code&gt;. Instead, we apply &lt;code&gt;total=False&lt;&#x2F;code&gt; to a subclass:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;List, TypedDict
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span&gt;_PersonRequired(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4ec9b0;&quot;&gt;TypedDict&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span&gt;    full_name: str
&lt;&#x2F;span&gt;&lt;span&gt;    nicknames: List[str]
&lt;&#x2F;span&gt;&lt;span&gt;    age: int
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span&gt;Person(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4ec9b0;&quot;&gt;_PersonRequired&lt;&#x2F;span&gt;&lt;span&gt;, total=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4ec9b0;&quot;&gt;False&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span&gt;    favourite_colour: str
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This means that a valid &lt;code&gt;Person&lt;&#x2F;code&gt; dictionary may have no &lt;code&gt;favourite_colour&lt;&#x2F;code&gt; key. If it is present, it must be a &lt;code&gt;str&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The syntax is unfortunately a little clunky. &lt;a href=&quot;https:&#x2F;&#x2F;www.python.org&#x2F;dev&#x2F;peps&#x2F;pep-0655&#x2F;&quot;&gt;PEP 655&lt;&#x2F;a&gt; acknowledges this and proposes an alternative.&lt;&#x2F;p&gt;
&lt;h5 id=&quot;typeddict-is-typecheck-time-only&quot;&gt;&lt;code&gt;TypedDict&lt;&#x2F;code&gt; is typecheck-time only&lt;&#x2F;h5&gt;
&lt;p&gt;One final note: a &lt;code&gt;TypedDict&lt;&#x2F;code&gt; does no validation or conversion whatsoever. If mypy can&#x27;t know the keys and values a dictionary will have a typecheck-time, you&#x27;ll need to validate it by hand at runtime. We see this a lot because when deserialising json objects into a dictionary. Here&#x27;s an example.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;json
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span&gt;typing &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;TypedDict
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;class &lt;&#x2F;span&gt;&lt;span&gt;Foo(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4ec9b0;&quot;&gt;TypedDict&lt;&#x2F;span&gt;&lt;span&gt;):
&lt;&#x2F;span&gt;&lt;span&gt;    bar: str
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# note: Revealed type is &amp;quot;Any&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;reveal_type(json.loads(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b4cea8;&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;))
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#608b4e;&quot;&gt;# no error. mypy can&amp;#39;t do analysis on Any.
&lt;&#x2F;span&gt;&lt;span&gt;f: Foo = json.loads(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b4cea8;&quot;&gt;{}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;next-time&quot;&gt;Next time&lt;&#x2F;h2&gt;
&lt;p&gt;This covers a lot of the machinery and the day-to-day process of annotating Sydent. The &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;17&#x2F;type-coverage-for-sydent-evaluation&quot;&gt;last part of this series&lt;&#x2F;a&gt; will give us a chance to quantify our efforts and reflect on the wider typing ecosystem.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;Many thanks for reading! If you&#x27;ve got any corrections, comments or queries, I&#x27;m available on Matrix at &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;@dmrobertson:matrix.org&quot;&gt;@dmrobertson:matrix.org&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Type coverage for Sydent: motivation</title>
		<published>2021-12-03T00:00:00+00:00</published>
		<updated>2021-12-03T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/12/03/type-coverage-for-sydent-motivation/" type="text/html"/>
		<id>/blog/2021/12/03/type-coverage-for-sydent-motivation/</id>
		<content type="html">&lt;p&gt;&lt;em&gt;This is the first of three posts on improving type coverage in Sydent. Join us next Friday for the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;10&#x2F;type-coverage-for-sydent-annotation&quot;&gt;second part&lt;&#x2F;a&gt;!&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&quot;&gt;Sydent&lt;&#x2F;a&gt; is the reference Matrix Identity server. It provides a &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;spec&#x2F;identity_service&#x2F;r0.3.0&quot;&gt;lookup service&lt;&#x2F;a&gt;, so that you can find a Matrix user via their email address or phone number (if they&#x27;ve chosen to share it).&lt;&#x2F;p&gt;
&lt;p&gt;We recently worked on &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;414&quot;&gt;improving Sydent&#x27;s type coverage&lt;&#x2F;a&gt;: the proportion of its source code with explicit annotations denoting the kind of data that each variable, expression and return value is expected to hold. These annotations are optional, but if present, they allow tools like &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;&quot;&gt;mypy&lt;&#x2F;a&gt; to analyze your programs and spot entire classes of bugs &lt;em&gt;before&lt;&#x2F;em&gt; you ship them! In this instance, we aimed to make Sydent pass &lt;code&gt;mypy --strict&lt;&#x2F;code&gt;, which &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;commit&#x2F;7bdaac2774840e1f9697d30515f367c5c8c16866&quot;&gt;it now does&lt;&#x2F;a&gt;. Here&#x27;s what the process looked like:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;blog&#x2F;img&#x2F;TWGXKTFpjYxlbnHRkZFAzljQ.png&quot; alt=&quot;Coverage as measured by mypy. Precision and the number of typed expressions increase over the latter half of 2021.&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Two lines show two different measures of how well-typed the project is. The grey region covers our two-week sprint towards improving coverage; the earliest data point is from just before previous efforts to improve typing earlier in the year.&lt;&#x2F;p&gt;
&lt;p&gt;In a series of posts, I&#x27;d like to reflect on this sprint and share what we&#x27;ve learned. In particular, I aim to:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;explain why we wanted to improve type coverage &lt;em&gt;now&lt;&#x2F;em&gt;;&lt;&#x2F;li&gt;
&lt;li&gt;work through examples to see how (if?) mypy could have spotted bugs;&lt;&#x2F;li&gt;
&lt;li&gt;describe the annotation process;&lt;&#x2F;li&gt;
&lt;li&gt;illustrate common patterns I learned along the way;&lt;&#x2F;li&gt;
&lt;li&gt;discuss the checks that &lt;code&gt;mypy&lt;&#x2F;code&gt; provides; and finally&lt;&#x2F;li&gt;
&lt;li&gt;reflect on the state of Python&#x27;s typing ecosystem.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;In this first part, we&#x27;ll concentrate on the first two topics; the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;10&#x2F;type-coverage-for-sydent-annotation&quot;&gt;second&lt;&#x2F;a&gt; covers the middle two; and the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;17&#x2F;type-coverage-for-sydent-evaluation&quot;&gt;third&lt;&#x2F;a&gt; the last two.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;why-do-this-now&quot;&gt;Why do this now?&lt;&#x2F;h2&gt;
&lt;p&gt;It took us a long time (too long) to notice that the Sydent instance serving &lt;code&gt;matrix.org&lt;&#x2F;code&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;element-web&#x2F;issues&#x2F;19317&quot;&gt;was failing to send SMS messages for verification&lt;&#x2F;a&gt;. We suspected that something was going wrong with our &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;blob&#x2F;main&#x2F;sydent&#x2F;sms&#x2F;openmarket.py&quot;&gt;API call to OpenMarket&lt;&#x2F;a&gt;. Our first step was to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;410&quot;&gt;improve logging&lt;&#x2F;a&gt;, so we could start to deduce what was going wrong and why. Whilst trawling through logs, we spotted &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;413#pullrequestreview-775154313&quot;&gt;
one problem&lt;&#x2F;a&gt; which meant we weren&#x27;t actually sending off the API request in the first place. Further investigation revealed a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;415&quot;&gt;strings-versus-bytes confusion&lt;&#x2F;a&gt; which meant that we would always (incorrectly) interpret the API response as having failed.&lt;&#x2F;p&gt;
&lt;p&gt;All in all, phone number verification was unknowingly broken in the 2.4.0 release, to be fixed in 2.4.6 a month later. How could we do better? Better test coverage is (as ever) one answer. But &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;413#pullrequestreview-775154313&quot;&gt;it struck me&lt;&#x2F;a&gt; that the two bugs we&#x27;d encountered might be ripe for automatic detection:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;we created an &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html#typing.Awaitable&quot;&gt;Awaitable&lt;&#x2F;a&gt; but didn&#x27;t &lt;code&gt;await&lt;&#x2F;code&gt; it or use it in any way, and&lt;&#x2F;li&gt;
&lt;li&gt;we tried to look up a &lt;code&gt;str&lt;&#x2F;code&gt; key in a dictionary which mapped &lt;code&gt;bytes&lt;&#x2F;code&gt; to &lt;code&gt;bytes&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Could a static analysis tool like &lt;code&gt;mypy&lt;&#x2F;code&gt; detect these? How much work would it take to do so? Are there other bugs and problems we could spot with it? I was curious to answer these questions and learn more about the tools that Python&#x27;s typing ecosystem provides.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;could-typing-have-spotted-these-problems&quot;&gt;Could typing have spotted these problems?&lt;&#x2F;h2&gt;
&lt;p&gt;Let&#x27;s start with the first of question: what can &lt;code&gt;mypy&lt;&#x2F;code&gt; detect?&lt;&#x2F;p&gt;
&lt;h3 id=&quot;the-missing-await&quot;&gt;The missing &lt;code&gt;await&lt;&#x2F;code&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;Instead of writing &lt;code&gt;x = await foo()&lt;&#x2F;code&gt;, we simply had &lt;code&gt;x = foo()&lt;&#x2F;code&gt; and didn&#x27;t then go on to &lt;code&gt;await x&lt;&#x2F;code&gt;. Mypy doesn&#x27;t have means to detect this at present. There was interest in &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;issues&#x2F;2499&quot;&gt;this issue&lt;&#x2F;a&gt; on such a feature, with related threads &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;issues&#x2F;5597&quot;&gt;here&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;python&#x2F;mypy&#x2F;issues&#x2F;5650&quot;&gt;here&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Are there other opportunities to spot the error? Here&#x27;s the relevant bit of source code from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;blob&#x2F;2e3b7576b17e92080319e08c0c0ebf566935636c&#x2F;sydent&#x2F;http&#x2F;servlets&#x2F;msisdnservlet.py#L93-L98&quot;&gt;before the fix&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;            sid = self.sydent.validators.msisdn.requestToken(
&lt;&#x2F;span&gt;&lt;span&gt;                phone_number_object, clientSecret, sendAttempt, brand
&lt;&#x2F;span&gt;&lt;span&gt;            )
&lt;&#x2F;span&gt;&lt;span&gt;            resp = {
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;success&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;sid&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: str(sid),
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;msisdn&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: msisdn,
&lt;&#x2F;span&gt;&lt;span&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;intl_fmt&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: intl_fmt,
&lt;&#x2F;span&gt;&lt;span&gt;            }
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The call to &lt;code&gt;requestToken&lt;&#x2F;code&gt; produces a value of type &lt;code&gt;Awaitable[int]&lt;&#x2F;code&gt;. If we tried to assign that to an expression of type &lt;code&gt;int&lt;&#x2F;code&gt; we&#x27;d get an error that mypy can spot.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;$ cat example.py
&lt;&#x2F;span&gt;&lt;span&gt;async def foo() -&amp;gt; int:
&lt;&#x2F;span&gt;&lt;span&gt;    return 1
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;async def bar():
&lt;&#x2F;span&gt;&lt;span&gt;    x = foo()      # no error
&lt;&#x2F;span&gt;&lt;span&gt;    y: int = foo() # error: rhs is Awaitable[int], but lhs expects int
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;$ mypy --check-untyped-defs example.py
&lt;&#x2F;span&gt;&lt;span&gt;example.py:6: error: Incompatible types in assignment (expression has type &amp;quot;Coroutine[Any, Any, int]&amp;quot;, variable has type &amp;quot;int&amp;quot;)
&lt;&#x2F;span&gt;&lt;span&gt;Found 1 error in 1 file (checked 1 source file)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Note that we have to specifically ask mypy to typecheck the body of &lt;code&gt;bar&lt;&#x2F;code&gt; by passing &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#cmdoption-mypy-check-untyped-defs&quot;&gt;--check-untyped-defs&lt;&#x2F;a&gt;; by default, &lt;code&gt;mypy&lt;&#x2F;code&gt; will only typecheck annotated code.&lt;&#x2F;p&gt;
&lt;p&gt;We might also have been able to detect the error by looking at how we used &lt;code&gt;sid&lt;&#x2F;code&gt;. Unfortunately, the only use of was in a conversion &lt;code&gt;str(sid)&lt;&#x2F;code&gt;, which is a perfectly type-safe call for both &lt;code&gt;sid: int&lt;&#x2F;code&gt; and &lt;code&gt;sid: Awaitable[int]&lt;&#x2F;code&gt;. But let&#x27;s put that aside for a second—suppose we added &lt;code&gt;&amp;quot;sid&amp;quot;: sid&lt;&#x2F;code&gt; directly into the &lt;code&gt;resp&lt;&#x2F;code&gt; dictionary. Could mypy have spotted there was a problem with &lt;em&gt;that&lt;&#x2F;em&gt;?&lt;&#x2F;p&gt;
&lt;p&gt;Unfortunately not. Because &lt;code&gt;resp&lt;&#x2F;code&gt; has no annotation, we have to rely on how it&#x27;s used to spot any type inconsistencies. There&#x27;s only one use of &lt;code&gt;resp&lt;&#x2F;code&gt;: as the return value from its enclosing function, &lt;code&gt;render_POST&lt;&#x2F;code&gt;. Mypy&#x27;s only chance to spot a type problem would be to compare the mypy&#x27;s inferred type for &lt;code&gt;resp&lt;&#x2F;code&gt; to the return type of &lt;code&gt;render_POST&lt;&#x2F;code&gt;. What are those types? We can use &lt;code&gt;reveal_type&lt;&#x2F;code&gt; to see the former is &lt;code&gt;Dict[str, object]&lt;&#x2F;code&gt;. For the latter:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;    @jsonwrap
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span&gt;render_POST(self, request: Request) -&amp;gt; JsonDict:
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The return type is &lt;code&gt;JsonDict&lt;&#x2F;code&gt;, which is an &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;blob&#x2F;2e3b7576b17e92080319e08c0c0ebf566935636c&#x2F;sydent&#x2F;types.py#L17&quot;&gt;alias&lt;&#x2F;a&gt; for &lt;code&gt;Dict[str, Any]&lt;&#x2F;code&gt;. This is bad news, because &lt;code&gt;Dict[str, object]&lt;&#x2F;code&gt; and &lt;code&gt;Dict[str, Any]&lt;&#x2F;code&gt; are compatible. Digging a level deeper, this is because &lt;code&gt;sid: Any&lt;&#x2F;code&gt; holds true for both &lt;code&gt;sid: int&lt;&#x2F;code&gt; and &lt;code&gt;sid: Awaitable[int]&lt;&#x2F;code&gt;—so there&#x27;s no error to spot here. The &lt;code&gt;Any&lt;&#x2F;code&gt; type is compatible with any other type whatsoever! Mypy uses &lt;code&gt;Any&lt;&#x2F;code&gt; as a way to &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;kinds_of_types.html#the-any-type&quot;&gt;defer all type checking to runtime&lt;&#x2F;a&gt;; mypy won&#x27;t (and can&#x27;t!) statically analyse the usage of an expression of type &lt;code&gt;Any&lt;&#x2F;code&gt;. Indeed, mypy&#x27;s reports will tell you how many &lt;code&gt;Any&lt;&#x2F;code&gt;s you&#x27;re working with, and offer a variety of options to &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;command_line.html#disallow-dynamic-typing&quot;&gt;warn or error on usages of &lt;code&gt;Any&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;If we were inserting &lt;code&gt;sid&lt;&#x2F;code&gt; directly into a dictionary, we could do better by annotating the dictionary (or the function&#x27;s return type) as a &lt;a href=&quot;https:&#x2F;&#x2F;docs.python.org&#x2F;3&#x2F;library&#x2F;typing.html#typing.TypedDict&quot;&gt;TypedDict&lt;&#x2F;a&gt;. This is a way to specify a dictionary with a fixed set of keys, each with a fixed type. It comes in really handy for Sydent, Sygnal and Synapse—all of &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;spec&#x2F;&quot;&gt;the Matrix APIs&lt;&#x2F;a&gt; exchange JSON dictionaries, so anything we can do to teach mypy about their shape and types is gold dust.&lt;&#x2F;p&gt;
&lt;p&gt;In short, there were options for detecting this with some code changes, but no magic wand that would have spotted the error in the code as written.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;the-strings-bytes-confusion&quot;&gt;The strings&#x2F;bytes confusion&lt;&#x2F;h3&gt;
&lt;p&gt;Our &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;415&#x2F;files#diff-4b3e0551612818927c87fe0100262ec230e0342def9d3f09214b93dea3efacb8L103-R107&quot;&gt;error&lt;&#x2F;a&gt; was here:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;        headers = dict(resp.headers.getAllRawHeaders())
&lt;&#x2F;span&gt;&lt;span&gt;        request_id = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;None
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;X-Request-Id&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;in &lt;&#x2F;span&gt;&lt;span&gt;headers:
&lt;&#x2F;span&gt;&lt;span&gt;            request_id = headers[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;X-Request-Id&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;][&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b5cea8;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;In this sample, &lt;code&gt;resp.headers&lt;&#x2F;code&gt; is a &lt;a href=&quot;https:&#x2F;&#x2F;twistedmatrix.com&#x2F;documents&#x2F;current&#x2F;api&#x2F;twisted.web.http_headers.Headers.html&quot;&gt;twisted.web.http_headers.Headers&lt;&#x2F;a&gt; instance. &lt;code&gt;getAllRawHeaders&lt;&#x2F;code&gt; is &lt;a href=&quot;https:&#x2F;&#x2F;twistedmatrix.com&#x2F;documents&#x2F;current&#x2F;api&#x2F;twisted.web.http_headers.Headers.html#getAllRawHeaders&quot;&gt;documented&lt;&#x2F;a&gt; as returning an iterable of &lt;code&gt;(bytes, Sequence[bytes])&lt;&#x2F;code&gt; pairs. Even better, mypy can see this because &lt;code&gt;getAllRawHeaders&lt;&#x2F;code&gt; is &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;twisted&#x2F;twisted&#x2F;blob&#x2F;5c24e99e671c4082a1ddc8dbeb869402294bd0dc&#x2F;src&#x2F;twisted&#x2F;web&#x2F;http_headers.py#L261&quot;&gt;annotated&lt;&#x2F;a&gt; (many thanks to the twisted authors for this). Mypy should be able to deduce that we build a dictionary &lt;code&gt;headers: Dict[bytes, Sequence[bytes]&lt;&#x2F;code&gt;. We can check this using &lt;a href=&quot;https:&#x2F;&#x2F;mypy.readthedocs.io&#x2F;en&#x2F;stable&#x2F;cheat_sheet_py3.html#when-you-re-puzzled-or-when-things-are-complicated&quot;&gt;&lt;code&gt;reveal_type&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;        headers = dict(resp.headers.getAllRawHeaders())
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(headers)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;$ mypy
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:110: note: Revealed type is &amp;quot;builtins.dict[builtins.bytes*, typing.Sequence*[builtins.bytes]]&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;(The &lt;code&gt;*&lt;&#x2F;code&gt; in &lt;code&gt;builtins.bytes*&lt;&#x2F;code&gt; here means mypy has &lt;a href=&quot;https:&#x2F;&#x2F;stackoverflow.com&#x2F;a&#x2F;50499509&#x2F;5252017&quot;&gt;inferred&lt;&#x2F;a&gt; that the dictionary&#x27;s keys are bytes, rather than being told explicitly that they must be bytes.)&lt;&#x2F;p&gt;
&lt;p&gt;That&#x27;s all fine and dandy. But why didn&#x27;t we spot this before if the annotations were all in place in twisted? Let&#x27;s put aside the fact that, erm, we weren&#x27;t running mypy in Sydent&#x27;s CI &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;416&quot;&gt;until the recent sprint&lt;&#x2F;a&gt;, unlike our &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;5640992d176a499204a0756b1677c9b1575b0a49&#x2F;.github&#x2F;workflows&#x2F;tests.yml#L21&quot;&gt;other&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sygnal&#x2F;blob&#x2F;4a7367e84476a4b1054b1fe20e9e06f9f66e27f8&#x2F;.github&#x2F;workflows&#x2F;pipeline.yml#L18-L26&quot;&gt;projects&lt;&#x2F;a&gt;. Checking out the problematic version, we can run mypy on the file we know to contain the bug.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;$ git checkout v2.4.0
&lt;&#x2F;span&gt;&lt;span&gt;$ mypy --strict sydent&#x2F;sms&#x2F;openmarket.py
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:82: error: Dict entry 0 has incompatible type &amp;quot;str&amp;quot;: &amp;quot;int&amp;quot;; expected &amp;quot;str&amp;quot;: &amp;quot;str&amp;quot;  [dict-item]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Huh. Mypy spots something, but not the error we were hoping for. What&#x27;s going on here? We can ask mypy to show its working with &lt;code&gt;reveal_type&lt;&#x2F;code&gt; again.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;        resp = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#569cd6;&quot;&gt;await &lt;&#x2F;span&gt;&lt;span&gt;self.http_cli.post_json_get_nothing(
&lt;&#x2F;span&gt;&lt;span&gt;            API_BASE_URL, send_body, {&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d69d85;&quot;&gt;&amp;quot;headers&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;: req_headers}
&lt;&#x2F;span&gt;&lt;span&gt;        )
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(resp)
&lt;&#x2F;span&gt;&lt;span&gt;        headers = dict(resp.headers.getAllRawHeaders())
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(resp.headers)
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(resp.headers.getAllwRawHeaders())
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(headers)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This yields:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;$ mypy sydent&#x2F;sms&#x2F;openmarket.py
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:82: error: Dict entry 0 has incompatible type &amp;quot;str&amp;quot;: &amp;quot;int&amp;quot;; expected &amp;quot;str&amp;quot;: &amp;quot;str&amp;quot;  [dict-item]
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:102: note: Revealed type is &amp;quot;twisted.web.iweb.IResponse*&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:104: note: Revealed type is &amp;quot;Any&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:105: note: Revealed type is &amp;quot;Any&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:106: note: Revealed type is &amp;quot;builtins.dict[Any, Any]&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;Found 1 error in 1 file (checked 1 source file)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Ahh, the &lt;code&gt;Any&lt;&#x2F;code&gt; type. As mentioned above, this represents a value whose type can&#x27;t be statically determined. We&#x27;re left to runtime checks to detect the problem. But we won&#x27;t detect it at runtime, because dictionaries don&#x27;t enforce any kind of type requirements on their keys and values.&lt;&#x2F;p&gt;
&lt;p&gt;The problem here is that mypy can&#x27;t see that &lt;code&gt;resp.headers&lt;&#x2F;code&gt; is a twisted &lt;code&gt;Headers&lt;&#x2F;code&gt; object. If we could inform it of this, mypy would spot our bug:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;python&quot; style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot; class=&quot;language-python &quot;&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#9b9b9b;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span&gt;twisted.web.http_headers
&lt;&#x2F;span&gt;&lt;span&gt;        raw_headers: twisted.web.http_headers.Headers = resp.headers
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(resp)
&lt;&#x2F;span&gt;&lt;span&gt;        headers = dict(raw_headers.getAllRawHeaders())
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(raw_headers)
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(raw_headers.getAllRawHeaders())
&lt;&#x2F;span&gt;&lt;span&gt;        reveal_type(headers)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;pre style=&quot;background-color:#1e1e1e;color:#dcdcdc;&quot;&gt;&lt;code&gt;&lt;span&gt;$ mypy sydent&#x2F;sms&#x2F;openmarket.py
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:82: error: Dict entry 0 has incompatible type &amp;quot;str&amp;quot;: &amp;quot;int&amp;quot;; expected &amp;quot;str&amp;quot;: &amp;quot;str&amp;quot;  [dict-item]
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:104: note: Revealed type is &amp;quot;twisted.web.iweb.IResponse*&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:106: note: Revealed type is &amp;quot;twisted.web.http_headers.Headers&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:107: note: Revealed type is &amp;quot;typing.Iterator[Tuple[builtins.bytes, typing.Sequence[builtins.bytes]]]&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:108: note: Revealed type is &amp;quot;builtins.dict[builtins.bytes*, typing.Sequence*[builtins.bytes]]&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:114: error: Invalid index type &amp;quot;str&amp;quot; for &amp;quot;Dict[bytes, Sequence[bytes]]&amp;quot;; expected type &amp;quot;bytes&amp;quot;  [index]
&lt;&#x2F;span&gt;&lt;span&gt;sydent&#x2F;sms&#x2F;openmarket.py:114: error: Argument 1 to &amp;quot;split&amp;quot; of &amp;quot;bytes&amp;quot; has incompatible type &amp;quot;str&amp;quot;; expected &amp;quot;Optional[bytes]&amp;quot;  [arg-type]
&lt;&#x2F;span&gt;&lt;span&gt;Found 3 errors in 1 file (checked 1 source file)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;There it is, on line 114: &lt;code&gt;Invalid index type &amp;quot;str&amp;quot; for &amp;quot;Dict[bytes, Sequence[bytes]]&amp;quot;; expected type &amp;quot;bytes&amp;quot;&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Unfortunately it&#x27;d be a pain to annotate our application code to mark every use of &lt;code&gt;IResponse.headers&lt;&#x2F;code&gt; as a &lt;code&gt;Headers&lt;&#x2F;code&gt; object. We&#x27;ll see a better way to do things in this &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;12&#x2F;10&#x2F;type-coverage-for-sydent-annotation&quot;&gt;the next post&lt;&#x2F;a&gt;, which discusses the nitty-gritty details of adding annotations file-by-file.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;Many thanks for reading! If you&#x27;ve got any corrections, comments or queries, I&#x27;m available on Matrix at &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;@dmrobertson:matrix.org&quot;&gt;@dmrobertson:matrix.org&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>How the UK&#x27;s Online Safety Bill threatens Matrix</title>
		<published>2021-05-19T15:47:03+00:00</published>
		<updated>2021-05-19T14:48:44+00:00</updated>
		<link rel="alternate" href="/blog/2021/05/19/how-the-uk-s-online-safety-bill-threatens-matrix/" type="text/html"/>
		<id>/blog/2021/05/19/how-the-uk-s-online-safety-bill-threatens-matrix/</id>
		<content type="html">&lt;p&gt;Last week the UK government published a &lt;a href=&quot;https:&#x2F;&#x2F;www.gov.uk&#x2F;government&#x2F;publications&#x2F;draft-online-safety-bill&quot;&gt;draft of the proposed Online Safety
Bill,&lt;&#x2F;a&gt;
after having initially introduced &lt;a href=&quot;https:&#x2F;&#x2F;www.gov.uk&#x2F;government&#x2F;consultations&#x2F;online-harms-white-paper&#x2F;public-feedback&#x2F;online-harms-white-paper-initial-consultation-response&quot;&gt;formal proposals for said bill in early
2020&lt;&#x2F;a&gt;.
With this post we aim to shed some light on its potential impacts and explain
why we think that this bill - despite having great intentions - may actually
be setting a dangerous precedent when it comes to our rights to privacy,
freedom of expression and self determination.&lt;&#x2F;p&gt;
&lt;p&gt;The proposed bill aims to provide a legal framework to address illegal and
harmful content online. This focus on “not illegal, but harmful” content is at
the centre of our concerns - it puts responsibility on organisations
themselves to arbitrarily decide what might be harmful, without any legal
backing. The bill itself does not actually provide a definition of harmful,
instead relying on service providers to assess and decide on this. This
requirement to identify what is “likely to be harmful” applies to all users,
children and adults. Our question here is - would you trust a service provider
to decide what might be harmful to you and your children, with zero input from
you as a user?&lt;&#x2F;p&gt;
&lt;p&gt;Additionally, the bill incentivises the use of privacy-invasive age
verification processes which come with their own set of problems. This
complete disregard of people’s right to privacy is a reflection of the
privileged perspectives of those in charge of the drafting of this bill, which
fails to acknowledge how &lt;em&gt;actually&lt;&#x2F;em&gt; harmful it would be for certain groups of
the population to have their real life identity associated with their online
identity.&lt;&#x2F;p&gt;
&lt;p&gt;Our view of the world, and of the internet, is largely different from the one
presented by this bill. Now, this categorically does not mean we don’t care
about online safety (it is quite literally our bread and butter) - we just
fundamentally disagree with the approach taken.&lt;&#x2F;p&gt;
&lt;p&gt;Whilst we sympathise with the government’s desire to show action in this space
and to do something about children’s safety (everyone’s safety really), we
cannot possibly agree with the methods.&lt;&#x2F;p&gt;
&lt;p&gt;Back in October of 2020 we presented &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2020&#x2F;10&#x2F;19&#x2F;combating-abuse-in-matrix-without-backdoors&quot;&gt;our proposed approach to online safety&lt;&#x2F;a&gt; -
ironically also in response to a government proposal, albeit about encryption
backdoors. In it, we briefly discussed the dangers of absolute determinations
of morality from a single cultural perspective:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2020&#x2F;10&#x2F;19&#x2F;combating-abuse-in-matrix-without-backdoors&quot;&gt;As uncomfortable as it may be, one man’s terrorist is another man’s freedom fighter, and different jurisdictions have different laws - and it’s not up to the Matrix.org Foundation to play God and adjudicate.&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;We now find ourselves reading a piece of legislation that essentially demands
these determinations from tech companies. The beauty of the human experience
lies with its diversity and when we force technology companies to make calls
about what is right or wrong - or what is “likely to have adverse
psychological or physical impacts” on children - we end up in a dangerous
place of centralising and regulating relative morals. Worst of all, when the
consequence of getting it wrong is criminal liability for senior managers what
do we think will happen?&lt;&#x2F;p&gt;
&lt;p&gt;Regardless of how omnipresent it is in our daily lives, technology is still
not a solution for human problems. Forcing organisations to be judge and jury
of human morals for the sake of “free speech” will, ironically, have severe
consequences on free speech, as risk profiles will change for fear of
liability.&lt;&#x2F;p&gt;
&lt;p&gt;Forcing a “duty of care” responsibility on organisations which operate online
will not only drown small and medium sized companies in administrative tasks
and costs, it will further accentuate the existing monopolies by Big Tech.
Plainly, Big Tech can afford the regulatory burden - small start-ups can’t.
Future creators will have their wings clipped from the offset and we might
just miss out on new ideas and projects for fear of legal repercussions. This
is a threat to the technology sector, particularly those building on emerging
technologies like Matrix. In some ways, it is a threat to democracy and some
of the freedoms this bill claims to protect.&lt;&#x2F;p&gt;
&lt;p&gt;These are, quite frankly, steps towards an authoritarian dystopia. If Trust &amp;amp;
Safety managers start censoring something as natural as a nipple on the off
chance it might cause “adverse psychological impacts” on children, whose
freedom of expression are we actually protecting here?&lt;&#x2F;p&gt;
&lt;p&gt;More specifically on the issue of content moderation: the &lt;a href=&quot;https:&#x2F;&#x2F;assets.publishing.service.gov.uk&#x2F;government&#x2F;uploads&#x2F;system&#x2F;uploads&#x2F;attachment_data&#x2F;file&#x2F;985283&#x2F;Draft_Online_Safety_Bill_-_Impact_Assessment_Web_Accessible.pdf&quot;&gt;impact assessment
provided by the government alongside this
bill&lt;&#x2F;a&gt;
predicts that the additional costs for companies directly related to the bill
will be in the billions, over the course of 10 years. The cost for the
government? £400k, in every proposed policy option. Our question is - why are
these responsibilities being placed on tech companies, when evidently this is
a societal problem?&lt;&#x2F;p&gt;
&lt;p&gt;We are not saying it is up to the government to single-handedly end the
existence of Child Sexual Abuse and Exploitation (CSAE) or extremist content
online. What we are saying is that it takes more than content filtering, risk
assessments and (faulty) age verification processes for it to end. More
funding for tech literacy organisations and schools, to give children (and
parents) the tools to stay safe is the first thing that comes to mind. Further
investment in law enforcement cyber units and the judicial system, improving
tech companies’ routes for abuse reporting and allowing the actual judges to
do the judging seems pretty sensible too. What is absolutely egregious is the
degradation of the digital rights of the majority, due to the wrongdoings of a
few.&lt;&#x2F;p&gt;
&lt;p&gt;Our goal with this post is not to be dramatic or alarmist. However, we want to
add our voices to the countless &lt;a href=&quot;https:&#x2F;&#x2F;www.openrightsgroup.org&#x2F;blog&#x2F;online-abuse-why-management-liability-isnt-the-answer&#x2F;&quot;&gt;digital rights
campaigners&lt;&#x2F;a&gt;,
individuals and organisations that have been raising the alarm since the early
days of this bill. Just like with coercive control and abuse, the degradation
of our rights does not happen all at once. It is a slippery slope that starts
with something as (seemingly) innocuous as &lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;matthew_d_green&#x2F;status&#x2F;1392823038920564736&quot;&gt;mandatory content scanning for
CSAE content and ends with authoritarian surveillance
infrastructure&lt;&#x2F;a&gt;.
It is our duty to put a stop to this before it even begins.&lt;&#x2F;p&gt;
&lt;small style=&quot;display: block; text-align: right&quot;&gt;
Twitter card image credit from &lt;a href=&quot;https:&#x2F;&#x2F;film-grab.com&#x2F;2010&#x2F;10&#x2F;04&#x2F;brazil&#x2F;#bwg644&#x2F;39614&quot;&gt;Brazil&lt;&#x2F;a&gt;, which feels all too familiar right now.
&lt;&#x2F;small&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>The Matrix Space Beta!</title>
		<published>2021-05-17T17:50:17+00:00</published>
		<updated>2021-05-17T17:35:09+00:00</updated>
		<link rel="alternate" href="/blog/2021/05/17/the-matrix-space-beta/" type="text/html"/>
		<id>/blog/2021/05/17/the-matrix-space-beta/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;As many know, over the years we&#x27;ve experimented with how to let users locate
and curate sets of users and rooms in Matrix. &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@RiotChat&#x2F;communities-aka-groups-are-here-announcing-riot-web-0-13-riot-ios-0-6-and-riot-android-0-7-4-933cb193a28e&quot;&gt;Back in Nov
2017&lt;&#x2F;a&gt;
we added &#x27;groups&#x27; (aka &#x27;communities&#x27;) as a custom mechanism for this -
introducing identifiers beginning with a + symbol to represent sets of rooms
and users, like &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;+matrix:matrix.org&quot;&gt;+matrix:matrix.org&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;However, it rapidly became obvious that Communities had some major
shortcomings.  They ended up being an extensive and entirely new API surface
(designed around letting you dynamically bridge the membership of a group
through to a single source of truth like LDAP) - while in practice groups
have enormous overlap with rooms: managing membership, inviting by email,
access control, power levels, names, topics, avatars, etc.  Meanwhile the
custom groups API re-invented the wheel for things like pushing updates
to the client (causing a whole suite of
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;element-web&#x2F;issues&#x2F;5235&quot;&gt;problems&lt;&#x2F;a&gt;).  So clients
and servers alike ended up reimplementing large chunks of similar
functionality for both rooms and groups.&lt;&#x2F;p&gt;
&lt;p&gt;And so almost before Communities were born, we started thinking about whether
it would make more sense to model them as a special type of room, rather than
being their own custom primitive.
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1215&quot;&gt;MSC1215&lt;&#x2F;a&gt; had the first
thoughts on this in 2017, and then a formal proposal emerged at
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1772&quot;&gt;MSC1772&lt;&#x2F;a&gt; in Jan 2019. We
started working on this in earnest at the end of 2020, and christened the new
way of handling groups of rooms and users as... Spaces!&lt;&#x2F;p&gt;
&lt;p&gt;Spaces work as follows:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;You can designate specific rooms as &#x27;spaces&#x27;, which contain other rooms.&lt;&#x2F;li&gt;
&lt;li&gt;You can have a nested hierarchy of spaces.&lt;&#x2F;li&gt;
&lt;li&gt;You can rapidly navigate around that hierarchy using the new &#x27;space summary&#x27;
(aka space-nav) API - &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;blob&#x2F;kegan&#x2F;spaces-summary&#x2F;proposals&#x2F;2946-spaces-summary.md&quot;&gt;MSC2946&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Spaces can be shared with other people publicly, or invite-only, or private
for your own curation purposes.&lt;&#x2F;li&gt;
&lt;li&gt;Rooms can appear in multiple places in the hierarchy.&lt;&#x2F;li&gt;
&lt;li&gt;You can have &#x27;secret&#x27; spaces where you group your own personal rooms and
spaces into an existing hierarchy.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Today, we&#x27;re ridiculously excited to be launching Space support as a beta in
matrix-react-sdk and matrix-android-sdk2 (and thus Element Web&#x2F;Desktop and
Element Android) and Synapse
&lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2021&#x2F;05&#x2F;17&#x2F;synapse-1-34-0-released&quot;&gt;1.34.0&lt;&#x2F;a&gt; - so head
over to your nearest Element, make sure it&#x27;s connected to the latest Synapse
(and that Synapse has Spaces enabled in its config) and find some Space to
explore! &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#community:matrix.org&quot;&gt;#community:matrix.org&lt;&#x2F;a&gt;
might be a good start :)&lt;&#x2F;p&gt;
&lt;p&gt;The beta today gives us the bare essentials: and we haven&#x27;t yet finished
space-based access controls such as setting powerlevels in rooms based on
space membership
(&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;blob&#x2F;matthew&#x2F;msc2962&#x2F;proposals&#x2F;2962-spaces-access-control.md&quot;&gt;MSC2962&lt;&#x2F;a&gt;)
or limiting who can join a room based on their space membership
(&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;blob&#x2F;clokep&#x2F;restricted-rooms&#x2F;proposals&#x2F;3083-restricted-rooms.md&quot;&gt;MSC3083&lt;&#x2F;a&gt;) -
but these will be coming asap.  We also need to figure out how to implement
Flair on top of Spaces rather than Communities.&lt;&#x2F;p&gt;
&lt;p&gt;This is also a bit of a turning point in Matrix&#x27;s architecture: we are now
using rooms more and more as a generic way of modelling new features in
Matrix.  For instance, rooms could be used as a structured way of storing
files (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;3089&quot;&gt;MSC3089&lt;&#x2F;a&gt;);
Reputation data
(&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2313&quot;&gt;MSC2313&lt;&#x2F;a&gt;) is stored in
rooms; Threads can be stored in rooms
(&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2836&quot;&gt;MSC2836&lt;&#x2F;a&gt;); Extensible
Profiles are proposed as rooms too
(&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1769&quot;&gt;MSC1769&lt;&#x2F;a&gt;).  As such,
this pushes us towards ensuring rooms are as lightweight as possible in Matrix -
and that things like sync and changing profile scale independently of the
number of rooms you&#x27;re in.  Spaces effectively gives us a way of creating a
global decentralised filesystem hierarchy on top of Matrix - grouping the
existing rooms of all flavours into an epic multiplayer tree of realtime data.
It&#x27;s like USENET had a baby with the Web!&lt;&#x2F;p&gt;
&lt;p&gt;For lots more info from the Element perspective, head over to the &lt;a href=&quot;https:&#x2F;&#x2F;element.io&#x2F;blog&#x2F;p&#x2F;4ff44807-fe9a-4363-8521-9eab7efd4365&#x2F;&quot;&gt;Element
blog&lt;&#x2F;a&gt;. 
Finally, the point of the beta is to gather feedback and fix bugs - so please
go wild in Element reporting your first impressions and help us make Spaces as
awesome as they deserve to be!&lt;&#x2F;p&gt;
&lt;p&gt;Thanks for flying Matrix into Space;&lt;&#x2F;p&gt;
&lt;p&gt;Matthew &amp;amp; the whole Spaces (and Matrix) team.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Introducing the Pinecone overlay network</title>
		<published>2021-05-06T00:00:00+00:00</published>
		<updated>2021-05-06T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2021/05/06/introducing-the-pinecone-overlay-network/" type="text/html"/>
		<id>/blog/2021/05/06/introducing-the-pinecone-overlay-network/</id>
		<content type="html">&lt;p&gt;Since the end of 2019, we have spent quite a bit of time thinking about and exploring different technologies whilst building various demos for P2P Matrix.  Our mission for P2P Matrix is to evolve Matrix into a hybrid between today&#x27;s server-oriented network and a pure P2P network - empowering users to have &lt;strong&gt;total&lt;&#x2F;strong&gt; autonomy and privacy over their data if they want (by storing it in P2P Matrix, by embedding their server into their Matrix client), while also letting users store their data in serverside nodes if they so desire.&lt;&#x2F;p&gt;
&lt;p&gt;The goal is to protect metadata much better (as users no longer have to depend on a server run by someone else to communicate), as well as drive new features such as account portability, multi-homed accounts, low-bandwidth Matrix and smarter federation transports - and provide support for internet-less mesh communication via Matrix which can also interoperate with the wider network.  You can read more about it in our &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2020&#x2F;06&#x2F;02&#x2F;introducing-p-2-p-matrix&#x2F;&quot;&gt;Introducing P2P Matrix&lt;&#x2F;a&gt; blog post from last summer, or watch our &lt;a href=&quot;https:&#x2F;&#x2F;fosdem.org&#x2F;2021&#x2F;schedule&#x2F;event&#x2F;matrix_pinecones&#x2F;&quot;&gt;FOSDEM 2021 talk&lt;&#x2F;a&gt; where we previewed Pinecone.  It&#x27;s important to note that this has been a small but important long-term project for Matrix, and has been progressing entirely outside our business-as-usual work of improving the core protocol and reference implementations.&lt;&#x2F;p&gt;
&lt;p&gt;As the project has progressed, we&#x27;ve built a variety of prototypes using existing libraries (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;libp2p&#x2F;go-libp2p&quot;&gt;go-libp2p&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;libp2p&#x2F;js-libp2p&quot;&gt;js-libp2p&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;yggdrasil-network&#x2F;yggdrasil-go&quot;&gt;Yggdrasil&lt;&#x2F;a&gt;), demonstrating what an early P2P Matrix might feel like if it were running on a mobile device, in the web browser and so on using such an overlay network. Each of these demos has taught us something new, and so in October 2020 we decided to take this knowledge to build an experimental new overlay network of our own.&lt;&#x2F;p&gt;
&lt;p&gt;Pinecone is designed to provide end-to-end encrypted communications between devices, regardless of how they are connected to one another, in a lightweight and self-arranging fashion. The routing protocol is a hybrid, taking inspiration from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;yggdrasil-network&#x2F;yggdrasil-go&quot;&gt;Yggdrasil&lt;&#x2F;a&gt; by building a global spanning tree, but rather than forwarding all traffic using the spanning tree topology, we use it as a bootstrap routing mechanism for a line&#x2F;snake topology, ordered by their ed25519 public keys, which we have affectionately named SNEK (Sequentially Networked Edwards Key) routing.&lt;&#x2F;p&gt;
&lt;p&gt;Nodes seek out their closest keyspace neighbours on the network and paths are built between these pairs of nodes, similar to how a Chord DHT functions, populating the routing tables of intermediate nodes in the process. These paths are then used to forward traffic without having to perform up-front searches, allowing for very fast connection setups between overlay nodes. These paths are resilient to network topology changes and handle node mobility considerably better than any other name-independent routing scheme that we have seen — early results are very promising so far. We have also been experimenting with a combination of the μTP (Micro Transport Protocol) and TLS to provide stateful connection setup, congestion control and end-to-end encryption for all federation traffic carried over the Pinecone network.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;blog&#x2F;img&#x2F;2021-05-06-pineconesim.png&quot; alt=&quot;Pinecone simulator showing line&#x2F;snake logical network topology&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;If Pinecone works out, our intention is to collaborate with the libp2p and IPFS team to incorporate Pinecone routing into libp2p (if they&#x27;ll have us!) while incorporating their gossipsub routing to improve Matrix federation... and get the best of both worlds :)&lt;&#x2F;p&gt;
&lt;p&gt;Today we&#x27;re releasing the source code for our current early implementation of Pinecone — you can &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;pinecone&quot;&gt;get it from GitHub&lt;&#x2F;a&gt; right now! It&#x27;s very experimental still and not very well optimised yet, but it is the foundation of our latest mobile P2P Matrix demos, which support P2P Matrix over both &lt;strong&gt;Bluetooth Low Energy&lt;&#x2F;strong&gt; mesh networks, &lt;strong&gt;multicast DNS&lt;&#x2F;strong&gt; discovery within a LAN, and&#x2F;or by routing through &lt;strong&gt;static Pinecone peers&lt;&#x2F;strong&gt; on the Internet:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Android: https:&#x2F;&#x2F;appdistribution.firebase.dev&#x2F;i&#x2F;394600067ea8ba37&lt;&#x2F;li&gt;
&lt;li&gt;iOS: https:&#x2F;&#x2F;testflight.apple.com&#x2F;join&#x2F;Tgh2MEk6&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Building a routing overlay is only the first step in the journey towards P2P Matrix. We will also be looking closely in the coming months at improving the Matrix federation protocol to work well in mixed-connectivity scenarios (rather than the full mesh approach used today) as well as decentralised identities, hybrid deployments with existing homeservers and getting Dendrite (the Matrix homeserver which is embedded into the current P2P demos) more stable and feature-complete.&lt;&#x2F;p&gt;
&lt;p&gt;The long-term plan could look something like this:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;blog&#x2F;img&#x2F;2021-05-06-pinecone.png&quot; alt=&quot;Diagram showing possible P2P Matrix stack&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Most discussion around P2P Matrix takes place in &lt;a href=&quot;http:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#p2p:matrix.org&quot;&gt;#p2p:matrix.org&lt;&#x2F;a&gt;, so if you are interested in what&#x27;s going on, please join us there!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Privacy improvements in Synapse 1.4 and Riot 1.4</title>
		<published>2019-09-27T00:00:00+00:00</published>
		<updated>2019-09-27T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2019/09/27/privacy-improvements-in-synapse-1-4-and-riot-1-4/" type="text/html"/>
		<id>/blog/2019/09/27/privacy-improvements-in-synapse-1-4-and-riot-1-4/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Back in June we wrote about our &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2019&#x2F;06&#x2F;30&#x2F;tightening-up-privacy-in-matrix&quot;&gt;plans to tighten up data
privacy&lt;&#x2F;a&gt;
in Matrix after some areas for improvement were brought to our attention.  To
quickly recap: the primary concern was that the default config for Riot
specifies identity servers and integration managers run by New Vector (the
company which the original Matrix team set up to build Riot and fund Matrix
dev) - and so folks using a standalone homeserver may end up using external
services without realising it.  There were some other legitimate issues raised
too (e.g. contact information should be obfuscated when checking if your
contacts are on Matrix; Riot defaulted to using Google for STUN (firewall
detection) if no TURN server had been set up on their server; Synapse defaults
to using matrix.org as a key notary server).&lt;&#x2F;p&gt;
&lt;p&gt;We’ve been working away at this fairly solidly over the last few months.  Some
of the simpler items shipped quickly (e.g. Riot&#x2F;Web had a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-react-sdk&#x2F;pull&#x2F;3115&quot;&gt;stupid
bug&lt;&#x2F;a&gt; where it kept
incorrectly loading the integration manager; Riot&#x2F;Android &lt;a href=&quot;https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=20181515&quot;&gt;wasn’t clear
enough&lt;&#x2F;a&gt; about when contact
discovery was happening; Riot&#x2F;Web &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10216&quot;&gt;wasn’t clear
enough&lt;&#x2F;a&gt; about the fact
device names are publicly visible; etc) - but other bits have turned out to be
incredibly time-consuming to get right.&lt;&#x2F;p&gt;
&lt;p&gt;However, we’re in the process today of releasing Synapse 1.4.0 and Riot&#x2F;Web
1.4.0 (it’s coincidence the version numbers have lined up!) which resolve the
majority of the remaining issues.  The main changes are as follows:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Riot no longer automatically uses identity servers by default&lt;&#x2F;strong&gt;.
Identity servers are only useful when inviting users by email address, or when
discovering whether your contacts are on Matrix.  Therefore, we now wait until
the user tries to perform one of these operations before explaining that they
need an identity server to do so, and we prompt them to select one if they
want to proceed. This makes it abundantly clear that the user is connecting to
an independent service, and why.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Integration Managers and identity servers now have the ability to force
users to accept terms of use before using them&lt;&#x2F;strong&gt;.  This means they can
explicitly spell out the data privacy &amp;amp; usage policy of the server as required
by GDPR, and it should now be impossible for a user to use these services
without realising it.  This was particularly fun in the case of identity
servers, which previously had no concept of users and so couldn’t track
whether users had agreed to their terms &amp;amp; conditions or not… and because
homeservers sometimes talk to the identity server on behalf of users rather
than the user talking direct, the privacy policy flow gets even hairier.  But
it’s solved now, and a nice side-effect of this is that users can now
explicitly select their Integration Manager in Riot, in case they want to use
&lt;a href=&quot;https:&#x2F;&#x2F;dimension.t2bot.io&quot;&gt;Dimension&lt;&#x2F;a&gt; or similar rather than the default
provided by &lt;a href=&quot;https:&#x2F;&#x2F;modular.im&quot;&gt;Modular&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Synapse no longer uses identity servers for verifying registrations or
verifying password reset.&lt;&#x2F;strong&gt; Originally, Synapse made use of the fact that the
Identity Service contains email&#x2F;msisdn verification logic to handle identity
verification in general on behalf of the homeserver. However, in retrospect
this was a mistake: why should the entity running your identity server have
the right to verify password resets or registration details on your
homeserver?  So, we have moved this logic into Synapse.  &lt;strong&gt;This means Synapse
1.4.0 requires new configuration for email&#x2F;msisdn verification to work -
please see the upgrade notes for full details.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Sydent now supports discovering contacts based on hashed identifiers.&lt;&#x2F;strong&gt;
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;blob&#x2F;hs&#x2F;hash-identity&#x2F;proposals&#x2F;2134-identity-hash-lookup.md&quot;&gt;MSC2134&lt;&#x2F;a&gt;
specifies entirely new IS APIs for discovering contacts using a hash of their
identifier rather than directly exposing the raw identifiers being searched
for.  This is implemented in
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2652&quot;&gt;Riot&#x2F;iOS&lt;&#x2F;a&gt; and
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3257&quot;&gt;Riot&#x2F;Android&lt;&#x2F;a&gt; and
should be in the next major release;
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10556&quot;&gt;Riot&#x2F;Web&lt;&#x2F;a&gt; 1.4.0 has it
already.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Synapse now &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6090&#x2F;files&quot;&gt;warns in its
logs&lt;&#x2F;a&gt; if you are using
matrix.org as a default trusted key server, in case you wish to use a
different server to help discover other servers’ keys.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Synapse now &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1287&quot;&gt;garbage collects redacted
messages&lt;&#x2F;a&gt; after N days (7
days by default).  (It doesn’t yet garbage collect attachments referenced from
redacted messages; we’re still working on that).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Synapse now &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6098&#x2F;files&quot;&gt;deletes account access
data&lt;&#x2F;a&gt; (IP addresses and
User Agent) after N days (28 days by default) of a device being deleted.&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Riot warns before falling back to using STUN (and defaults to
turn.matrix.org rather than stun.google.com) for firewall discovery (STUN)
when placing VoIP calls, and makes it clear that this is an emergency fallback
for misconfigured servers which are missing TURN support.  (We originally
deleted the fallback entirely, but this broke things for too many people, so
we’ve kept it but warn instead).&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;All of this is implemented in Riot&#x2F;Web 1.4.0 and Synapse 1.4.0.  Riot&#x2F;Web
1.4.0 shipped today (Fri Sept 27th) and we have a release candidate
for Synapse 1.4 (1.4.0rc1) today which fully ship on Monday.&lt;&#x2F;p&gt;
&lt;p&gt;For full details please go check out the &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@RiotChat&#x2F;new-privacy-controls-for-riot-dc3661888563&quot;&gt;Riot 1.4.0&lt;&#x2F;a&gt;
and &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2019&#x2F;10&#x2F;03&#x2F;synapse-1-4-0-released&quot;&gt;Synapse 1.4.0&lt;&#x2F;a&gt; blog posts.&lt;&#x2F;p&gt;
&lt;p&gt;Riot&#x2F;Mobile is following fast behind - most of the above has been implemented
and everything should land in the next release.  RiotX&#x2F;Android doesn’t really
have any changes to make given it hadn’t yet implemented Identity Service or
Integration Manager APIs.&lt;&#x2F;p&gt;
&lt;p&gt;This has involved a surprisingly large amount of spec work; no fewer than 9
new Matrix Spec Changes (MSC) have been required as part of the project.  In
particular, this results in a massive update to the Identity Service API,
which will be released very shortly with the new MSCs.  You can see the
upcoming changes on the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;spec&#x2F;identity_service&#x2F;unstable&quot;&gt;unstable
branch&lt;&#x2F;a&gt; and compare
with the &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;spec&#x2F;identity_service&#x2F;r0.2.1&quot;&gt;previous 0.2.1 stable
release&lt;&#x2F;a&gt;, as well as
checking the detailed MSCs as follows:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1961&quot;&gt;MSC1961: Integration manager authentication APIs&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2078&quot;&gt;MSC2078: Sending Third-Party Request Tokens via the Homeserver&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2134&quot;&gt;MSC2134: Identity Hash Lookups&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2140&quot;&gt;MSC2140: Terms of Service for ISes and IMs&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2229&quot;&gt;MSC2229: Allowing 3PID Owners to Rebind&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2230&quot;&gt;MSC2230: Store Identity Server in Account Data&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2263&quot;&gt;MSC2263: Give homeservers the ability to handle their own 3PID registrations&#x2F;password resets&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2264&quot;&gt;MSC2264: Add an unstable feature flag to MSC2140 for clients to detect support&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2290&quot;&gt;MSC2290: Separate Endpoints for Threepid Binding&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;This said, there is still some work remaining for us to do here.  The main
things which haven’t made it into this release are:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Preferring to get server keys from the source server rather than the notary server by default (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6110&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6110&lt;&#x2F;a&gt;). This almost made it in, but we need to test it more first - until then, your specified notary server will see roughly what servers your servers are trying to talk to.  In future this will be mitigated properly by &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1228&quot;&gt;MSC1228 (removing mxids from events)&lt;&#x2F;a&gt;.&lt;&#x2F;li&gt;
&lt;li&gt;Configurable data retention periods for rooms.  We are tantalisingly close with this - &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5815&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5815&lt;&#x2F;a&gt; is an implementation that the French Govt deployment is using; we need to port it into mainline Synapse.&lt;&#x2F;li&gt;
&lt;li&gt;Authenticating access to the media repository - for now, we still rely on media IDs being almost impossible to guess to protect the data rather than authenticating the user.&lt;&#x2F;li&gt;
&lt;li&gt;Deleting items from the media repository - we still need to hook up deletion APIs.&lt;&#x2F;li&gt;
&lt;li&gt;Garbage collecting forgotten rooms.  If everyone leaves &amp;amp; forgets a room, we should delete it from the DB.&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1280&quot;&gt;Communicating erasure requests over federation &lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We’ll continue to work on these as part of our ongoing maintenance backlog.&lt;&#x2F;p&gt;
&lt;p&gt;Separately to the data privacy concerns, we’ve had a &lt;a href=&quot;https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=20515069&quot;&gt;separate wave of
feedback&lt;&#x2F;a&gt; regarding how we
handle GDPR Data Subject Access Requests (DSARs). Particularly: whether DSAR
responses should contain solely the info your have directly keyed by the
requesting Matrix ID - or if we should provide all the data “visible” to that
ID (i.e. the history of the conversations they’ve been part of).  We went and
got professional legal advice on this one, and the conclusion is that we
should keep our responses to DSARs as tightly scoped as possible. We &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;policies&#x2F;pull&#x2F;7&#x2F;files?short_path=09dc019#diff-09dc019b94b6efb90fa9f6e5c836f310&quot;&gt;updated
Matrix.org’s privacy
policy&lt;&#x2F;a&gt;
and DSAR tools to reflect the new legal input.&lt;&#x2F;p&gt;
&lt;p&gt;Finally, it’s really worth calling out the amount of effort that went into
this project. Huge huge thanks to everyone involved (given it’s cut across
pretty much every project &amp;amp; subteam we have working on the core of Matrix) who
have soldiered through the backlog.  We’ve been tracking progress using our
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;feature-dashboard&quot;&gt;feature-dashboard&lt;&#x2F;a&gt; tool which
summarises Github issues based on labels &amp;amp; issue lifecycle, and for better or
worse it’s ended up being the biggest project board we’ve ever had.  You can
see the live data
&lt;a href=&quot;https:&#x2F;&#x2F;vector-im.github.io&#x2F;feature-dashboard&#x2F;#&#x2F;plan?label=privacy-sprint&amp;amp;repo=vector-im&#x2F;riot-web&amp;amp;repo=vector-im&#x2F;riot-ios&amp;amp;repo=vector-im&#x2F;riot-android&amp;amp;repo=vector-im&#x2F;riotX-android&amp;amp;repo=matrix-org&#x2F;matrix-doc&amp;amp;repo=matrix-org&#x2F;sydent&amp;amp;repo=matrix-org&#x2F;synapse&quot;&gt;here&lt;&#x2F;a&gt;
(warning, it takes tens of seconds to spider Github to gather the data) - or,
for posterity and ease of reference, I’ve included the current issue list
below.  The issues which are completed have “done” after them; the ones still
in progress say “in progress”, and ones which haven’t started yet have
nothing. We split the project into 3 phases - phases 1 and 2 represent the
items needed to fully solve the privacy concerns, phase 3 is right now a mix
of &amp;quot;nice to have&amp;quot; polish and some more speculative items.  At this point we’ve
effectively finished phase 1 on Synapse &amp;amp; Riot&#x2F;Web, and Riot&#x2F;Mobile is
following close behind.  We&#x27;re continuing to work on phase 2, and we’ll work
through phase 3 (where appropriate) as part of our general maintenance
backlog.&lt;&#x2F;p&gt;
&lt;p&gt;I hope this gives suitable visibility on how we’re considering privacy; after
all, Matrix is useless as an open communication protocol if the openness comes
at the expense of user privacy.  We’ll give another update once the remaining
straggling issues are closed out; and meanwhile, now the bulk of the privacy
work is out of the way on Riot&#x2F;Web, we can &lt;strong&gt;finally&lt;&#x2F;strong&gt; get back to
implementing the UI E2E cross-signing verification and improving first time
user experience.&lt;&#x2F;p&gt;
&lt;p&gt;Thanks for your patience and understanding while we’ve sorted this stuff out;
and thanks once again for flying Matrix :)&lt;&#x2F;p&gt;
&lt;p&gt;&lt;em&gt;In the absence of comments on the current blog, please feel free to discuss
over at &lt;a href=&quot;https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=21091908&quot;&gt;HN&lt;&#x2F;a&gt;, or alternatively come ask stuff in
our AMA over at
&lt;a href=&quot;https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;privacy&#x2F;comments&#x2F;da219t&#x2F;im_project_lead_for_matrixorg_the_open_protocol&#x2F;&quot;&gt;&#x2F;r&#x2F;privacy&lt;&#x2F;a&gt;
(starting ~5pm GMT+1 (UK) on Friday Sept 27th).&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;the-privacy-project-dashboard-of-doom&quot;&gt;The Privacy Project Dashboard Of Doom&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;phase:1
&lt;ul&gt;
&lt;li&gt;vector-im&#x2F;riot-web
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;5846&quot;&gt;5846 Riot duplicates calls to Scalar&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;5921&quot;&gt;5921 Ability to disable all identity server functionality via the config file&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;6802&quot;&gt;6802 riot shouldn&#x27;t try to load integrations from an integration manager unless the user has accepted that manager&#x27;s privacy policies&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10088&quot;&gt;10088 Prompt to accept integration manager polices on use&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10090&quot;&gt;10090 Make sure there are no ugly edge cases running Riot without an integrations manager&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10091&quot;&gt;10091 Decouple setting an email for password reset from publishing your threepid to the identity server and support choice of identity server (on registration)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10092&quot;&gt;10092 Prompt to accept Identity Server policies on registration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10093&quot;&gt;10093 Prompt to accept identity server policies before inviting them to a room&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10094&quot;&gt;10094 Store identity server in Account Data and support choosing identity server integration in User Settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10159&quot;&gt;10159 Enable toggling a threepid&#x27;s association with the current IS in User Settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10173&quot;&gt;10173 VoIP: Stop falling back to Google for STUN&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10216&quot;&gt;10216 We should make it clear in the UI that device names are publicly readable&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10386&quot;&gt;10386 Terms modal prompt should appear without a flash of the integration manager portal first&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10408&quot;&gt;10408 Identity server v2 API authentication&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10423&quot;&gt;10423 Deploy a develop environment for t&#x27;s and c&#x27;s flows for IM and IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10424&quot;&gt;10424 Remove the bind true flag from 3PID calls on registration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10425&quot;&gt;10425 Ability to disconnect from the identity server by pressing buttons in user settings.&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10452&quot;&gt;10452 Test IS v2 access tokens for validity&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10497&quot;&gt;10497 Integration manager terms hides terms that need signing&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10510&quot;&gt;10510 Remove the bind true flag from 3PID adds in settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10519&quot;&gt;10519 Update discovery and account 3PID sections when either changes&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10522&quot;&gt;10522 Handle terms agreement in the Discovery section of settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10525&quot;&gt;10525 IS interactions proxied through the HS also need terms agreement&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10528&quot;&gt;10528 don&#x27;t try &amp;amp; show threepids in discovery section if we don&#x27;t have an ID server&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10539&quot;&gt;10539 Inline terms agreement on change IS and IM&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10540&quot;&gt;10540 When using Riot without an IS, identity requests are sent to server hosting Riot&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10546&quot;&gt;10546 Prompt for fallback VOIP should only happen when the user tries to make a call&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10550&quot;&gt;10550 warn when disconnecting ID server if there are any current bindings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10552&quot;&gt;10552 Allow email registration, password reset &amp;amp; adding 3pids when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10553&quot;&gt;10553 Remove the ability to set an IS at login&#x2F;registration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10556&quot;&gt;10556 Use the hashed v2 lookup API for 3PIDs&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10561&quot;&gt;10561 Scalar should serve a .well-known file&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10566&quot;&gt;10566 Use nicer APIs for toggling a 3PID&#x27;s shared status&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10571&quot;&gt;10571 Allow email registration when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10572&quot;&gt;10572 Allow password reset when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10573&quot;&gt;10573 Allow adding 3pids when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10574&quot;&gt;10574 Placeholder issue for MSCs that should land prior to the privacy release&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10593&quot;&gt;10593 Placeholder issue for privacy migration path&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10597&quot;&gt;10597 Ensure IS in account data is read &#x2F; written as specced&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10599&quot;&gt;10599 Send IS for adding MSISDNs only when required by HS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10603&quot;&gt;10603 Getting a terms prompt when inviting an email address clears the address picker&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10619&quot;&gt;10619 Handle the case of no IS in features that require IS to lookup&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10620&quot;&gt;10620 Change auth flows so that you default to no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10634&quot;&gt;10634 Changing to vector.im IS in Settings fails because &#x2F;terms 404s&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10635&quot;&gt;10635 Inline terms agreement in Discovery should still show change and do not use&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10636&quot;&gt;10636 The UX is a little confusing if you haven&#x27;t accepted the terms of the default identity server.&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10637&quot;&gt;10637 Unable to add email address to HS account without IS set&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10660&quot;&gt;10660 Sydent implementation: Unauthed v1, clone all endpoints, auth v2&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10666&quot;&gt;10666 In login&#x2F;register, riot freezes if you go to Advanced, remove the IS url and click next&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10669&quot;&gt;10669 Checking email invite account is unclear when no IS set&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10674&quot;&gt;10674 Email help text on registration should be updated without binding&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10677&quot;&gt;10677 Change text about other users being able to invite you by email on registration page&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10744&quot;&gt;10744 Only set terms URLs in the account when they change&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10749&quot;&gt;10749 Changing from one IS to another does not trigger bound 3PID warning&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10750&quot;&gt;10750 Bound 3PIDs warning should better explain what&#x27;s being left behind&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10754&quot;&gt;10754 Lowercase emails during IS lookup calls&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10755&quot;&gt;10755 Terms account data is meant to be additive, but currently sets only new URLs&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10756&quot;&gt;10756 After changing IS to termstest.matrix.org the text field isn&#x27;t cleared and the button remains active&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10757&quot;&gt;10757 After changing IS back to vector.im the text field isn&#x27;t cleared and the button remains active&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10758&quot;&gt;10758 Revoke may be too vague for unbinding a 3PID&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10779&quot;&gt;10779 When publishing a threepid to an IS, if you click &#x27;continue&#x27; before clicking the link in your email, we delete your threepid from the HS.&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10800&quot;&gt;10800 Community invite should not talk about ISes at all.&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10823&quot;&gt;10823 IS with unagreed terms will block you from adding even unshared 3PIDs to your HS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10839&quot;&gt;10839 Use the new backend APIs for adding-3pid-to-homeserver and binding-3pid-on-identity-server when they exist.&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10878&quot;&gt;10878 UX regression when trying to invite by email if no IS is configured&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10883&quot;&gt;10883 Riot should check for r0.6.0 server support alongside feature flags&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10923&quot;&gt;10923 Send validation tokens to submit_url from HS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10933&quot;&gt;10933 Do not include ID server or access token when HS supports MSC2290&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10939&quot;&gt;10939 Registration with MSISDN needs to use submit_url&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10941&quot;&gt;10941 threepid_creds for registration and password reset still include id_server&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10959&quot;&gt;10959 Remove id_server from email threepid_creds&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10604&quot;&gt;10604 QA: Re-test ALL of the identity server interactions&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10958&quot;&gt;10958 Terms of Service nitpicks&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10704&quot;&gt;10704 We treat an empty string identity server as not having one&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;vector-im&#x2F;riot-ios
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2518&quot;&gt;2518 Make sure there are no ugly edge cases running Riot without an integrations manager&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2521&quot;&gt;2521 Privacy: Improve wording on contact upload UI&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2532&quot;&gt;2532 VoIP: Stop falling back to Google for STUN&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2600&quot;&gt;2600 Prompt to accept integration manager polices on use&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2601&quot;&gt;2601 Decouple setting an email for password reset from publishing your threepid to the identity server and support choice of identity server (on registration)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2602&quot;&gt;2602 Prompt to accept identity server policies before inviting them to a room&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2603&quot;&gt;2603 Identity server v2 API authentication&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2606&quot;&gt;2606 Settings: Add a Discovery section&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2608&quot;&gt;2608 Registration: Update consents flow&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2643&quot;&gt;2643 Ability to disable all identity server functionality via the config file&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2646&quot;&gt;2646 VoIP: Fallback to matrix.org STUN server with a confirmation dialog&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2647&quot;&gt;2647 MXRestClient: Move IS API to its own&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2648&quot;&gt;2648 Remove the bind true flag from 3PID calls on registration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2650&quot;&gt;2650 Remove the bind true flag from 3PID adds in settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2651&quot;&gt;2651 Store identity server in Account Data and support choosing identity server integration in User Settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2652&quot;&gt;2652 Use the hashed v2 lookup API for 3PIDs&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2653&quot;&gt;2653 Allow email registration, password reset &amp;amp; adding 3pids when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2654&quot;&gt;2654 Use nicer APIs for toggling a 3PID&#x27;s shared status&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2657&quot;&gt;2657 Allow email registration when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2658&quot;&gt;2658 Allow password reset when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2659&quot;&gt;2659 Allow adding 3pids when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2660&quot;&gt;2660 Handle terms agreement in the Discovery section of settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2661&quot;&gt;2661 Remove the ability to set an IS at login&#x2F;registration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2662&quot;&gt;2662 We should make it clear in the UI that device names are publicly readable&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2664&quot;&gt;2664 Placeholder issue for privacy migration path&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2665&quot;&gt;2665 Ensure IS in account data is read &#x2F; written as specced&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2672&quot;&gt;2672 Handle the case of no IS in features that require IS to lookup&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2675&quot;&gt;2675 Email help text on registration should be updated without binding&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2682&quot;&gt;2682 Send IS for adding MSISDNs only when required by HS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2686&quot;&gt;2686 Use wellknown to discover the IS of a custom HS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2696&quot;&gt;2696 Lowercase emails during IS lookup calls&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2704&quot;&gt;2704 Use &lt;code&gt;id_access_token&lt;&#x2F;code&gt; in CS API when required&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2604&quot;&gt;2604 Settings: Ability to change the identity server&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2649&quot;&gt;2649 Ability to disconnect from the identity server by pressing buttons in user settings&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2713&quot;&gt;2713 Use the new backend APIs for adding-3pid-to-homeserver and binding-3pid-on-identity-server when they exist.&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2718&quot;&gt;2718 Riot should check for r0.6.0 server support alongside feature flags&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2683&quot;&gt;2683 Checking email invite account is unclear when no IS set&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2731&quot;&gt;2731 Send validation tokens to submit_url from HS&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2732&quot;&gt;2732 Do not include ID server or access token when HS supports MSC2290&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2736&quot;&gt;2736 IS terms cannot be accepted anymore&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;vector-im&#x2F;riot-android
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3223&quot;&gt;3223 VoIP: Stop falling back to Google for STUN&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3224&quot;&gt;3224 Make sure there are no ugly edge cases running Riot without an integrations manager&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3225&quot;&gt;3225 Prompt to accept integration manager polices on use &lt;&#x2F;a&gt;(done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3226&quot;&gt;3226 Decouple setting an email for password reset from publishing your threepid to the identity server and support choice of identity server (on registration)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3227&quot;&gt;3227 Prompt to accept identity server policies before inviting them to a room&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3228&quot;&gt;3228 Identity server v2 API authentication&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3229&quot;&gt;3229 Settings: Ability to change the identity server&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3230&quot;&gt;3230 Settings: Add a Discovery section&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3231&quot;&gt;3231 Registration: Update consents flow&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3252&quot;&gt;3252 Remove the bind true flag from 3PID calls on registration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3253&quot;&gt;3253 Ability to disconnect from the identity server by pressing buttons in user settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3254&quot;&gt;3254 Remove the bind true flag from 3PID adds in settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3256&quot;&gt;3256 Store identity server in Account Data and support choosing identity server integration in User Settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3257&quot;&gt;3257 Use the hashed v2 lookup API for 3PIDs&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3258&quot;&gt;3258 Allow email registration, password reset &amp;amp; adding 3pids when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3260&quot;&gt;3260 Allow email registration when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3261&quot;&gt;3261 Allow password reset when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3262&quot;&gt;3262 Allow adding 3pids when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3263&quot;&gt;3263 Handle terms agreement in the Discovery section of settings&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3264&quot;&gt;3264 Remove the ability to set an IS at login&#x2F;registration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3265&quot;&gt;3265 We should make it clear in the UI that device names are publicly readable&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3268&quot;&gt;3268 Placeholder issue for privacy migration path&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3269&quot;&gt;3269 Ensure IS in account data is read &#x2F; written as specced&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3277&quot;&gt;3277 Handle the case of no IS in features that require IS to lookup&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3278&quot;&gt;3278 Email help text on registration should be updated without binding&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3281&quot;&gt;3281 Send IS for adding MSISDNs only when required by HS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3283&quot;&gt;3283 Use wellknown to discover the IS of a custom HS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3289&quot;&gt;3289 Lowercase emails during IS lookup calls&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3295&quot;&gt;3295 Use &lt;code&gt;id_access_token&lt;&#x2F;code&gt; in CS API when required&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3300&quot;&gt;3300 Use the new backend APIs for adding-3pid-to-homeserver and binding-3pid-on-identity-server when they exist. &lt;&#x2F;a&gt;(done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3312&quot;&gt;3312 Riot should check for r0.6.0 server support alongside feature flags&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3316&quot;&gt;3316 Implement MSC2290&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3324&quot;&gt;3324 id_server param sent when registering an email on server that does not requires one&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3326&quot;&gt;3326 Discovery Settings &#x2F; infinite loading if terms not signed on existing IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3327&quot;&gt;3327 vector.im is seen as having no terms, but it does&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3251&quot;&gt;3251 VoIP: Fallback to matrix.org STUN server with a confirmation dialog&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3248&quot;&gt;3248 Ability to disable all identity server functionality via the config file&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3318&quot;&gt;3318 Send validation tokens to submit_url from HS&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3322&quot;&gt;3322 Do not include ID server or access token when HS supports MSC2290&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;vector-im&#x2F;riotX-android
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;490&quot;&gt;490 Allow email registration, password reset &amp;amp; adding 3pids when no IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;432&quot;&gt;432 Prompt to accept integration manager polices on use&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;431&quot;&gt;431 Make sure there are no ugly edge cases running Riot without an integrations manager&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;433&quot;&gt;433 Decouple setting an email for password reset from publishing your threepid to the identity server and support choice of identity server (on registration)&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;434&quot;&gt;434 Prompt to accept identity server policies before inviting them to a room&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;435&quot;&gt;435 Identity server v2 API authentication&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;436&quot;&gt;436 Settings: Ability to change the identity server&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;438&quot;&gt;438 Settings: Add a Discovery section&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;439&quot;&gt;439 Registration: Update consents flow&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riotX-android&#x2F;issues&#x2F;489&quot;&gt;489 Use the hashed v2 lookup API for 3PIDs&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;matrix-org&#x2F;matrix-doc
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1961&quot;&gt;1961 MSC1961: Integration manager authentication APIs&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2078&quot;&gt;2078 MSC2078: Sending Third-Party Request Tokens via the Homeserver&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;2130&quot;&gt;2130 Identity service should do lookups based on hashed 3PIDs, not plaintext ones.&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2134&quot;&gt;2134 MSC2134: Identity Hash Lookups&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;2139&quot;&gt;2139 Method for ISes and Integration managers to provide terms of service&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2140&quot;&gt;2140 MSC2140: Terms of Service for ISes and IMs&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2229&quot;&gt;2229 MSC2229: Allowing 3PID Owners to Rebind&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2230&quot;&gt;2230 MSC2230: Store Identity Server in Account Data&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2263&quot;&gt;2263 MSC2263: Give homeservers the ability to handle their own 3PID registrations&#x2F;password resets&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2264&quot;&gt;2264 MSC2264: Add an unstable feature flag to MSC2140 for clients to detect support&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;2290&quot;&gt;2290 MSC2290: Separate Endpoints for Threepid Binding&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;matrix-org&#x2F;sydent
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;178&quot;&gt;178 Support for MSC2140&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;179&quot;&gt;179 Support testing with matrix-is-tester&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;180&quot;&gt;180 Support for MSC2140&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;181&quot;&gt;181 Deny bindings to anything other than the mxid you&#x27;re authed as&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;184&quot;&gt;184 Hash 3PID lookups&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;186&quot;&gt;186 Don&#x27;t fail the unbind request if the binding doesn&#x27;t exist&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;187&quot;&gt;187 Add more tweaks to terms branch&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;189&quot;&gt;189 Redact looked-up threepids from the application logs.&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;191&quot;&gt;191 Add OpenID auth to 3PID hash lookup&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;197&quot;&gt;197 Have &#x27;mappings&#x27; contain medium as well as address&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;198&quot;&gt;198 Throw exception on bad args &amp;amp; catch in wrapper&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;199&quot;&gt;199 Return algorithm, lookup_pepper in M_INVALID_PEPPER response&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;200&quot;&gt;200 Support MSC2140 register&#x2F;terms endpoints&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;201&quot;&gt;201 Port v1 endpoints to v2&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;202&quot;&gt;202 Deny bindings to anything other than the mxid you&#x27;re authed as&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;204&quot;&gt;204 Fix the signing servlet&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;205&quot;&gt;205 Correct API v1 path check in get_args&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;206&quot;&gt;206 Fix terms POST&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;207&quot;&gt;207 Deploy policy file&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;208&quot;&gt;208 Remove PII logging from log-level INFO&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;pull&#x2F;213&quot;&gt;213 Delete threepid assocs on unbind and remove existing with migration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;217&quot;&gt;217 Allow non-matrix.org MXIDs via v2 only once terms are enabled&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;218&quot;&gt;218 Unbind fails to remove the binding on matrix.org IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;220&quot;&gt;220 Unbind fails to work for bindings where it was attempted with #213&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;192&quot;&gt;192 Sydent doesn&#x27;t delete 3PIDs from DB on unbind&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;matrix-org&#x2F;synapse
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1287&quot;&gt;1287 We need to actually censor redactions from the DB (SYN-284)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5751&quot;&gt;5751 Make homeservers able to handle registration-with-email without depending on an Identity Server&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5786&quot;&gt;5786 Support IS v2 API with authentication for requests proxied to the IS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5827&quot;&gt;5827 Add 3PID unbind API for MSC2140&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5835&quot;&gt;5835 [1&#x2F;2] Allow homeservers to send registration emails | Sending the email&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5861&quot;&gt;5861 Use the v2 lookup API for 3PID invites&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5862&quot;&gt;5862 Allow account owners to rebind 3PIDs as in MSC2229&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5868&quot;&gt;5868 Add flag in &#x2F;versions for whether clients should send id_server params&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5874&quot;&gt;5874 Placeholder issue for privacy migration path&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5875&quot;&gt;5875 Remove trusted_third_party_id_servers functionality&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5876&quot;&gt;5876 Replace trust_identity_server_for_password_resets with account_threepid_delegate&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5892&quot;&gt;5892 Switch to using v2 Identity Service APIs other than lookup (MSC 2140)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5897&quot;&gt;5897 Use the v2 lookup API for 3PID invites&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5927&quot;&gt;5927 Add a m.id_access_token flag to unstable_features&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5928&quot;&gt;5928 Split account_threepid_handler into a msisdn and email versions&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5929&quot;&gt;5929 Use account_threepid_delegate for sending SMS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5930&quot;&gt;5930 Add m.id_access_token flag&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5934&quot;&gt;5934 Censor redactions in DB after a month&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5935&quot;&gt;5935 Use federation blacklist for requests to identity servers&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5937&quot;&gt;5937 Revert &amp;quot;Use the v2 lookup API for 3PID invites&amp;quot;&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5940&quot;&gt;5940 [2&#x2F;2] Allow homeservers to send registration emails | Accepting the verification&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5945&quot;&gt;5945 Revert &amp;quot;Add m.id_access_token flag&amp;quot;&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5948&quot;&gt;5948 Support v2 Identity Server APIs&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5964&quot;&gt;5964 Remove bind_email and bind_msisdn&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5968&quot;&gt;5968 Set m.require_identity_server to always be False&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5969&quot;&gt;5969 Change account_threepid_delegate to a dictionary&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5972&quot;&gt;5972 Add m.require_identity_server to &#x2F;versions unstable_flags&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5974&quot;&gt;5974 Add m.id_access_token to &#x2F;versions unstable_features (MSC2264)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5976&quot;&gt;5976 Use the v2 Identity Service API for lookups (MSC2134 + MSC2140)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5979&quot;&gt;5979 v2 3PID Invites (part of MSC2140)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5980&quot;&gt;5980 Add POST &#x2F;_matrix&#x2F;client&#x2F;r0&#x2F;account&#x2F;3pid&#x2F;unbind (MSC2140)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5987&quot;&gt;5987 Allow Synapse to send registration emails + choose Synapse or an external server to handle 3pid validation&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;5996&quot;&gt;5996 Allow users to rebind 3pids they own (MSC2229)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6000&quot;&gt;6000 Use the federation blacklist for requests to untrusted Identity Servers&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6011&quot;&gt;6011 Use account_threepid_delegate for 3pid validation&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6013&quot;&gt;6013 Fix existing v2 identity server calls (MSC2140)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6042&quot;&gt;6042 Allow HS to send emails when adding an email to the HS&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6043&quot;&gt;6043 Implement MSC2290&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6044&quot;&gt;6044 Add an unstable feature flag for separate add&#x2F;bind 3pid APIs&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6062&quot;&gt;6062 Use unstable prefix for 3PID unbind API&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6067&quot;&gt;6067 Drop support for bind param on POST &#x2F;account&#x2F;3pid (MSC2290)&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;6076&quot;&gt;6076 Synapse doesn&#x27;t give clients a submit_url on requestToken breaking msisdn adding&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6078&quot;&gt;6078 Add POST submit_token endpoint for MSISDN&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6079&quot;&gt;6079 Add submit_url response parameter to msisdn &#x2F;requestToken&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;6087&quot;&gt;6087 Remove hardcoded defaults of matrix.org and vector.im in configuration&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;6090&quot;&gt;6090 Explicitly log when a homeserver does not have a trusted key server configured &lt;&#x2F;a&gt;(done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;6096&quot;&gt;6096 Riot Web expects the email validation next_link to have the sid appended&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;6100&quot;&gt;6100 Remove email from registration flows if it’s unsupported&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;6103&quot;&gt;6103 _check_threepid in auth.py incorrect for MSISDN&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;6045&quot;&gt;6045 Support Client-Server API r0.6.0&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1263&quot;&gt;1263 When we redact events, any mxc content they refer to should be redacted too (SYN-216)&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;4565&quot;&gt;4565 Metadata resistance.&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;6086&quot;&gt;6086 Fetch signing-keys directly from servers before falling back to the trusted_key_servers&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;phase:2
&lt;ul&gt;
&lt;li&gt;vector-im&#x2F;riot-web
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;4913&quot;&gt;4913 Option for homeservers to set a default integration manager&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10161&quot;&gt;10161 Store Integration Manager preferences in account data and allow user to change them somewhere sensible&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10967&quot;&gt;10967 Disconnect from identity server fails&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10443&quot;&gt;10443 Remove v1 IS API fallbacks once servers are updated&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10557&quot;&gt;10557 Prompt users each time before sending data to an Identity Server that doesn&#x27;t have a terms of service (unless you have actively set that IS in your account data).&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10696&quot;&gt;10696 Allow users to disconnect from an integration manager entirely in the same way that we support doing this for identity servers&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10909&quot;&gt;10909 Unable to disconnect from IS if the server is unavailable&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10936&quot;&gt;10936 Refine submit_url handling to only activate with separate add and bind&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;vector-im&#x2F;riot-ios
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2711&quot;&gt;2711 Provide a better UX for users considering sharing their contact list with an IS to discover people they know already using Matrix&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;vector-im&#x2F;riot-android
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3282&quot;&gt;3282 Checking email invite account is unclear when no IS set&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-android&#x2F;issues&#x2F;3323&quot;&gt;3323 Post MSC2290 bug &#x2F; Clicking on the validation mail link fails registration&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;matrix-org&#x2F;matrix-doc
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1957&quot;&gt;1957 MSC1957: Integration manager discovery&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;matrix-org&#x2F;sydent
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sydent&#x2F;issues&#x2F;196&quot;&gt;196 Remove the lookup_hash field from local_threepid_associations&lt;&#x2F;a&gt; (in progress)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;matrix-org&#x2F;synapse
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5881&quot;&gt;5881 Remove trust_identity_server_for_password_resets and account_threepid_delegate options&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;phase:3
&lt;ul&gt;
&lt;li&gt;vector-im&#x2F;riot-web
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10563&quot;&gt;10563 Add better domain for turn.matrix.org use as STUN server&lt;&#x2F;a&gt; (done)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10087&quot;&gt;10087 Prompt to accept integration manager policies on registration&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10167&quot;&gt;10167 Present an aggregated terms of service dialogue at registration if possible&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10168&quot;&gt;10168 If a user has disabled the identity server integration on their account, we should make invite user handle this nicely&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10401&quot;&gt;10401 Invite new users to publish their threepids to the identity server&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10422&quot;&gt;10422 Use more contextual prompt for integration manager polices on use&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10453&quot;&gt;10453 Log out from IM on Riot log out and IM removal&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10455&quot;&gt;10455 Log out from IS on Riot log out and IS removal&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10487&quot;&gt;10487 Store the date of users having read and accepted the IM policies in the IM db&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10488&quot;&gt;10488 Store the date of users having read and accepted the IS policies in the IS db&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10498&quot;&gt;10498 Terms test scalar requires the legacy ?v query param on the new account route&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10575&quot;&gt;10575 We should show the &#x27;must configure TURN&#x27; warning when a call fails, even after using the fallback turn.matrix.org&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10615&quot;&gt;10615 Change all IS access token APIs to use getIdentityAccessToken only&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10671&quot;&gt;10671 riot submits sign-ed25519 requests as POST requests with params in query string and empty body&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10746&quot;&gt;10746 &#x2F;invite doesn&#x27;t force terms with older homeservers&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10830&quot;&gt;10830 Show IS policy links in user settings somewhere.&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-web&#x2F;issues&#x2F;10950&quot;&gt;10950 Unhelpful 400 error when adding MSISDN and server doesn’t delegate&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;vector-im&#x2F;riot-ios
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;vector-im&#x2F;riot-ios&#x2F;issues&#x2F;2710&quot;&gt;2710 Show IS policy links in user settings somewhere.&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;matrix-org&#x2F;matrix-doc
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;447&quot;&gt;447 We need a way to be able to expire data from a HS. (SPEC-141)&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;matrix-org&#x2F;synapse
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;5830&quot;&gt;5830 &lt;code&gt;pushers&lt;&#x2F;code&gt; table contains user device names, which may include user real names&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Publishing the Backend Roadmap</title>
		<published>2019-02-15T00:00:00+00:00</published>
		<updated>2019-02-15T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2019/02/15/publishing-the-backend-roadmap/" type="text/html"/>
		<id>/blog/2019/02/15/publishing-the-backend-roadmap/</id>
		<content type="html">&lt;p&gt;Good people, &lt;&#x2F;p&gt;
&lt;p&gt;2019 is a big year for Matrix, in the next month we will have shipped:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Matrix spec 1.0 (including the first stable release of the Server to Server Spec)
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Synapse 1.0
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Riot 1.0
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
This is huge in itself, but is really only the beginning, and now we want to grow the ecosystem as quickly as possible. This means landing a mix of new features, enhancing existing ones, some big performance improvements as well as generally making life easier for our regular users, homeserver admins and community developers.
&lt;p&gt;Today we are sharing the Matrix core team&#x27;s backend roadmap. The idea is that this will make it easier for anyone to understand where the project is going, what we consider to be important, and why.&lt;&#x2F;p&gt;
&lt;p&gt;To see the roadmap in its full glory, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;orgs&#x2F;matrix-org&#x2F;projects&#x2F;9&quot;&gt;take a look here&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;what-is-a-roadmap-and-why-is-it-valuable&quot;&gt;What is a roadmap and why is it valuable?&lt;&#x2F;h3&gt;
&lt;p&gt;A roadmap is a set of high level projects that the team intend to work on and a rough sense of the relative priority. It is essential to focus on specific goals, which inevitably means consciously not working on other initiatives.&lt;&#x2F;p&gt;
&lt;p&gt;Our roadmap is not a delivery plan - there are explicitly no dates. The reason for this is that we know that other projects will emerge, developers will be needed to support other urgent initiatives, matrix.org use continues to grow exponentially and will require performance tweaking. &lt;&#x2F;p&gt;
&lt;p&gt;So simply, based on what we know now, this is the order we will work on our projects.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;why-are-we-sharing-it&quot;&gt;Why are we sharing it?&lt;&#x2F;h3&gt;
&lt;p&gt;We already share our &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;orgs&#x2F;matrix-org&#x2F;projects&#x2F;8&quot;&gt;day to day todo list&lt;&#x2F;a&gt;, and of course our commit history, but it can be difficult for a casual observer to see the bigger picture from such granular data. The purpose of sharing is that we want anyone from the community to understand where our priorities lie. &lt;&#x2F;p&gt;
&lt;p&gt;We are often asked ‘Why are you not working on X, it is really important&#x27; where the answer is often ‘We agree that X is really important, but A, B and C are more important and must come first&#x27;. &lt;&#x2F;p&gt;
&lt;p&gt;The point of sharing the roadmap is to make that priority trade off more transparent and consumable.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;how-did-we-build-it&quot;&gt;How did we build it?&lt;&#x2F;h3&gt;
&lt;p&gt;The core contributors to Synapse and Dendrite are 6 people, of 5 nationalities spread across 3 locations. After shipping the &lt;a href=&quot;&#x2F;docs&#x2F;spec&#x2F;server_server&#x2F;r0.1.1.html&quot;&gt;r0 release of the Server to Server spec&lt;&#x2F;a&gt; last month we took some time to step back and have a think about what to do after Synapse 1.0 lands. This meant getting everyone in one place to talk it through. &lt;&#x2F;p&gt;
&lt;p&gt;We also had Ben (benpa) contribute from a community perspective and took input from speaking to so many of you at FOSDEM.&lt;&#x2F;p&gt;
&lt;p&gt;In the end we filled a wall with post-its, each post-it representing a sizeable project. The position of the post-it was significant in that the vertical axis being a sense of how valuable we thought the task would be, and the horizontal axis being a rough guess on how complex we considered it to be.&lt;&#x2F;p&gt;
&lt;p&gt;We found this sort of grid approach to be really helpful in determining relative priority.&lt;&#x2F;p&gt;
&lt;p&gt;After many hours and plenty of blood, sweat and tears we ended up with something we could live with and wrote it up in the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;orgs&#x2F;matrix-org&#x2F;projects&#x2F;9&quot;&gt;shared board&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2019&#x2F;02&#x2F;IMG_2247.jpg&quot;&gt;&lt;img class=&quot;alignnone size-medium wp-image-3996&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2019&#x2F;02&#x2F;IMG_2247-300x225.jpg&quot; alt=&quot;&quot; width=&quot;300&quot; height=&quot;225&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2019&#x2F;02&#x2F;IMG_2245.jpg&quot;&gt;&lt;img class=&quot;alignnone size-medium wp-image-3990&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2019&#x2F;02&#x2F;IMG_2245-300x225.jpg&quot; alt=&quot;&quot; width=&quot;300&quot; height=&quot;225&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h3 id=&quot;and-this-is-written-in-blood-right&quot;&gt;And this is written in blood right?&lt;&#x2F;h3&gt;
&lt;p&gt;Not at all (it&#x27;s written in board marker). This is simply a way to express our plan of action and we are likely to make changes to it dynamically. However, this means that at any given moment, if someone wants to know what we are working on then the roadmap is the place to go.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;but-wait-i-want-to-know-more&quot;&gt;But wait I want to know more!&lt;&#x2F;h3&gt;
&lt;p&gt;Here is a video of myself and Matthew to talk you through the projects&lt;&#x2F;p&gt;
&lt;iframe src=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;LfyQ6cNGbLk&quot; width=&quot;560&quot; height=&quot;315&quot; frameBorder=&quot;0&quot; allowFullScreen=&quot;allowfullscreen&quot;&gt;&lt;&#x2F;iframe&gt;
&lt;h3 id=&quot;interesting-but-i-have-questions&quot;&gt;Interesting, but I have questions ...&lt;&#x2F;h3&gt;
&lt;p&gt;Any feedback gratefully received, come and ask questions in &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#synapse:matrix.org&quot;&gt;#synapse&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#dendrite:matrix.org&quot;&gt;#dendrite&lt;&#x2F;a&gt; or feel free to ping me direct at @neilj:matrix.org&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Porting Synapse to Python 3</title>
		<published>2018-12-21T00:00:00+00:00</published>
		<updated>2018-12-21T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/12/21/porting-synapse-to-python-3/" type="text/html"/>
		<id>/blog/2018/12/21/porting-synapse-to-python-3/</id>
		<content type="html">&lt;p&gt;Matrix&#x27;s reference homeserver, Synapse, is written in Python and uses the Twisted networking framework to power its bitslinging across the Internet. The Python version used has been strictly Python 2.7, the last supported version of Python 2, but as of this week that changes! Since Twisted and our other upstream dependencies now support the newest version of Python, Python 3, we are now able to finish the jump and port Synapse to use it by default. The port has been done in a backwards compatible way, written in a subset of Python that is usable in both Python 2 and Python 3, meaning your existing Synapse installs still work on Python 2, while preparing us for a Python 3 future.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;why-port&quot;&gt;Why port?&lt;&#x2F;h2&gt;
&lt;p&gt;Porting Synapse to Python 3 prepares Synapse for a post-Python 2 world, currently scheduled for 2020. After the 1st of January in 2020, Python 2 will no longer be supported by the core Python developers and no bugfixes (even critical security ones) will be issued. As the security of software depends very much on the runtime and libraries it is running on top of, this means that by then all Python 2 software in use should have moved to Python 3 or other runtimes.&lt;&#x2F;p&gt;
&lt;p&gt;The Python 3 port has benefits other than just preparing for the End of Life of Python 2.7. Successive versions of Python 3 have improved the standard library, provided newer and clearer syntax for asynchronous code, added opt-in static typing to reduce bugs, and contained incremental performance and memory management improvements. These features, once Synapse stops supporting Python 2, can then be fully utilised to make Synapse&#x27;s codebase clearer and more performant. One bonus that we get immediately, though, is Python 3&#x27;s memory compaction of Unicode strings. Rather than storing as UCS-2&#x2F;UTF-16 or UCS-4&#x2F;UTF-32, it will instead store it in the smallest possible representation giving a 50%-75% memory improvement for strings only containing Latin-1 characters, such as nearly all dictionary keys, hashes, IDs, and a large proportion of messages being processed from English speaking countries. Non-English text will also see a memory improvement, as it can be commonly stored in only two bytes instead of the four in a UCS-4 “wide” Python 2 build.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;i&gt;Editor&#x27;s note: If you were wondering how this fits in with Dendrite (the next-gen golang homeserver): our plan is to use Synapse as the reference homeserver for all the current work going on with landing a 1.0 release of the Matrix spec: it makes no sense to try to iterate and converge on 1.0 on both Synapse and Dendrite in parallel. In order to prove that the 1.0 spec is indeed fit for purpose we then also need Synapse to exit beta and hit a 1.0 too, hence the investment to get it there. It&#x27;s worth noting that over the last year we&#x27;ve been plugging away solidly improving Synapse in general (especially given the increasing number of high-profile deployments out there), so we&#x27;re committed to getting Synapse to a formal production grade release and supporting it in the long term. Meanwhile, Dendrite development is still progressing - currently acting as a place to experiment with more radical blue-sky architectural changes, especially in low-footprint or even clientside homeservers. We expect it to catch up with Synapse once 1.0 is out the door; and meanwhile Synapse is increasingly benefiting from performance work inspired by Dendrite.
&lt;&#x2F;i&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;when-will-the-port-be-released&quot;&gt;When will the port be released?&lt;&#x2F;h2&gt;
&lt;p&gt;The port is has been released in a “production ready” form in &lt;a href=&quot;&#x2F;blog&#x2F;2018&#x2F;12&#x2F;20&#x2F;synapse-0-34-0-released&#x2F;&quot;&gt;Synapse 0.34.0&lt;&#x2F;a&gt;, supporting Python 3.5, 3.6, and 3.7. This will work on installations with and without workers.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;what-s-it-like-in-the-real-world&quot;&gt;What&#x27;s it like in the real world?&lt;&#x2F;h2&gt;
&lt;p&gt;Beta testers of the Python 3 port have reported lower memory usage, including lower memory “spikes” and slower memory growth. You can see this demonstrated on matrix.org:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;12&#x2F;image3.png&quot;&gt;&lt;img class=&quot;alignnone size-large wp-image-3830&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;12&#x2F;image3-1024x223.png&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;223&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;See 10&#x2F;15, ~20:00 for the Python 3 migration. This is on some of the Synchrotrons on matrix.org.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;12&#x2F;image1.png&quot;&gt;&lt;img class=&quot;alignnone size-large wp-image-3824&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;12&#x2F;image1-1024x237.png&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;237&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;See ~11&#x2F;8 for the Python 3 migration. This is on the Synapse master on matrix.org.&lt;&#x2F;p&gt;
&lt;p&gt;We have also noticed some better CPU utilisation:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;span style=&quot;font-weight: 400;&quot;&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;12&#x2F;image2.png&quot;&gt;&lt;img class=&quot;alignnone size-large wp-image-3822&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;12&#x2F;image2-1024x296.png&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;296&quot; &#x2F;&gt;&lt;&#x2F;a&gt;
&lt;&#x2F;span&gt;
See 21:30 for the migration of federation reader 1, and 21:55 for the others. The federation reader is a particular pathological case, where the replacement of lists with iterators internally on Python 3 has given us some big boosts.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;12&#x2F;image4.png&quot;&gt;&lt;img class=&quot;alignnone size-large wp-image-3829&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;12&#x2F;image4-1024x296.png&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;296&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;See 10&#x2F;15, 4:00.The CPU utilisation has gone down on synchrotron 1 after the Python 3 migration, but not as dramatically as the federation reader. Synchrotron 3 was migrated a few days later.&lt;&#x2F;p&gt;
&lt;p&gt;As some extra data-points, my personal HS consumes about 300MB now at initial start, and grows to approximately 800MB -- under Python 2 the growth would be near-immediate to roughly 1.4GB.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;where-to-from-here&quot;&gt;Where to from here?&lt;&#x2F;h2&gt;
&lt;p&gt;Python 2 is still a supported platform for running Synapse for the time being. We plan on ending mainstream support on 1st April 2019, where upon Python 3.5+ will be the only officially supported platform. Additionally, we will give notice ahead of time once we are ready to remove Python 2.7 compatibility from the codebase (which will be no sooner than 1st April). Although slightly inconvenient, we hope that this gives our users and integrators adequate time to migrate, whilst giving us the flexibility to use modern Python features and make Synapse a better piece of software to help power the Matrix community.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;how-can-i-try-it&quot;&gt;How can I try it?&lt;&#x2F;h2&gt;
&lt;p&gt;The port is compatible with existing homeservers and configurations, so if you install Synapse inside a Python 3 virtualenv, you can run it from there. Of course, this differs based on your installation method, operating system, and what version of Python 3 you wish to use. Full upgrade notes live &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;release-v0.34.0&#x2F;UPGRADE.rst#upgrading-to-v0340&quot;&gt;here&lt;&#x2F;a&gt; but if you&#x27;re having problems or want to discuss specific packagings of Synapse please come ask in &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#synapse:matrix.org&quot;&gt;#synapse:matrix.org&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;thanks&quot;&gt;Thanks&lt;&#x2F;h2&gt;
&lt;p&gt;Many thanks go to fellow Synapse developers Erik and Rich for code review, as well as community contributors such as notafile and krombel for laying the foundations many months ago allowing this port to happen. Without them, this wouldn&#x27;t have happened.&lt;&#x2F;p&gt;
&lt;p&gt;Happy Matrixing,&lt;&#x2F;p&gt;
&lt;p&gt;Amber Brown (hawkowl)&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Olm 3.0.0 released!</title>
		<published>2018-10-25T00:00:00+00:00</published>
		<updated>2018-10-25T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/10/25/olm-3-0-0-released/" type="text/html"/>
		<id>/blog/2018/10/25/olm-3-0-0-released/</id>
		<content type="html">&lt;p&gt;Olm 3.0.0 has been released, which features several big changes. It can be downloaded from &lt;a href=&quot;https:&#x2F;&#x2F;git.matrix.org&#x2F;git&#x2F;olm&#x2F;&quot;&gt;https:&#x2F;&#x2F;git.matrix.org&#x2F;git&#x2F;olm&#x2F;&lt;&#x2F;a&gt;. The npm package for JavaScript can be downloaded from &lt;a href=&quot;&#x2F;packages&#x2F;npm&#x2F;olm&#x2F;olm-3.0.0.tgz&quot;&gt;https:&#x2F;&#x2F;matrix.org&#x2F;packages&#x2F;npm&#x2F;olm&#x2F;olm-3.0.0.tgz&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;python&quot;&gt;Python&lt;&#x2F;h2&gt;
&lt;p&gt;The biggest change is the merge of &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;poljar&#x2F;&quot;&gt;poljar&#x27;s&lt;&#x2F;a&gt; improved Python bindings. These bindings should be much easier to use for Python programmers, and are used by &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Zil0&#x2F;&quot;&gt;Zil0&#x27;s&lt;&#x2F;a&gt; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Zil0&#x2F;matrix-python-sdk&#x2F;tree&#x2F;e2e_sample&quot;&gt;E2E support in the Matrix Python SDK&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Since the binding API has changed, existing Python code will need to be rewritten in order to work with this release.&lt;&#x2F;p&gt;
&lt;p&gt;poljar has also included &lt;a href=&quot;https:&#x2F;&#x2F;poljar.github.io&#x2F;python-olm&#x2F;html&#x2F;index.html&quot;&gt;comprehensive documentation&lt;&#x2F;a&gt; for the new API.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;cmake&quot;&gt;CMake&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;mujx&#x2F;&quot;&gt;mujx&lt;&#x2F;a&gt; contributed support for building olm using CMake. This should allow for easier building on different platforms. Currently the library can be built using either make or CMake. In the future, make support may be removed.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;javascript&quot;&gt;JavaScript&lt;&#x2F;h2&gt;
&lt;p&gt;The JavaScript bindings now use &lt;a href=&quot;https:&#x2F;&#x2F;webassembly.org&#x2F;&quot;&gt;WebAssembly&lt;&#x2F;a&gt; by default. WebAssembly is much faster than the previous &lt;a href=&quot;http:&#x2F;&#x2F;asmjs.org&#x2F;&quot;&gt;asm.js&lt;&#x2F;a&gt; build, and is supported by recent versions of the most popular browsers. For compatibility with browsers that do not support WebAssembly, the asm.js version is still provided.&lt;&#x2F;p&gt;
&lt;p&gt;Due to adding support for WebAssembly, the API had to be changed slightly.
There is now an &lt;code&gt;init&lt;&#x2F;code&gt; function that must be called before the library can be used. This function will return a promise that will resolve once the library is ready to be used. The &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&quot;&gt;matrix-js-sdk&lt;&#x2F;a&gt; has not yet been updated to do this, so users of matrix-js-sdk should continue using olm 2.x until it has been updated.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;key-backups&quot;&gt;Key backups&lt;&#x2F;h2&gt;
&lt;p&gt;The public key API has been updated to support the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1538&quot;&gt;proposal for server-side key backups&lt;&#x2F;a&gt;. More details on how to use these functions will be published in the future.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Matrix Spec Update August 2018</title>
		<published>2018-09-03T00:00:00+00:00</published>
		<updated>2018-09-03T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/09/03/matrix-spec-update-august-2018/" type="text/html"/>
		<id>/blog/2018/09/03/matrix-spec-update-august-2018/</id>
		<content type="html">&lt;h2 id=&quot;introducing-client-server-api-0-4-and-the-first-ever-stable-is-as-and-push-apis-spec-releases&quot;&gt;Introducing Client Server API 0.4, and the first ever stable IS, AS and Push APIs spec releases!&lt;&#x2F;h2&gt;
&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;As many know, we&#x27;ve been on a massive sprint to improve the spec - both fixing omissions where features have been implemented in the reference servers but were never formalised in the spec, and fixing bugs where the spec has thinkos which stop us from being able to ratify it as stable and thus fit for purpose .&lt;&#x2F;p&gt;
&lt;p&gt;In practice, our target has been to cut stable releases of all the primary Matrix APIs by the end of August - effectively declaring Matrix out of beta, at least at the specification level.  For context: historically only one API has ever been released as stable - the Client Server API, which was the result of a similar sprint back in Jan 2016. This means that the Server Server (SS) API, Identity Service (IS) API, Application Service (AS) API and Push Gateway API have never had an official stable release - which has obviously been problematic for those implementing them.&lt;&#x2F;p&gt;
&lt;p&gt;However, as of the end of Friday Aug 31, we&#x27;re proud to announce the first ever stable releases of the &lt;a href=&quot;&#x2F;docs&#x2F;spec&quot;&gt;IS, AS and Push APIs&lt;&#x2F;a&gt;!&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;docs&#x2F;spec&quot;&gt;&lt;img src=&quot;&#x2F;_matrix&#x2F;media&#x2F;v1&#x2F;download&#x2F;t2l.io&#x2F;587a1a86905b1e0e8f9342d76e57ffbe&quot; &#x2F;&gt;&lt;&#x2F;a&gt;
To the best of our knowledge, these API specs are now complete and accurately describe all the current behaviour implemented in the reference implementations (sydent, synapse and sygnal) and are fit for purpose. Any deviation from the spec in the reference implementations should probably be considered a bug in the impl. All changes take the form of filling in spec omissions and adding clarifications to the existing behaviour in order to get things to the point that an independent party can implement these APIs without having to refer to anything other than the spec.&lt;&#x2F;p&gt;
&lt;p&gt;This is the result of a lot of work which spans the whole Spec Core Team, but has been particularly driven by TravisR, who has taken the lead on this whole mission to improve the spec.  Huge thanks are due to Travis for his work here, and also massive thanks to everyone who has 
&lt;del&gt;suffered
&lt;&#x2F;del&gt; &lt;del&gt;endured
&lt;&#x2F;del&gt; reviewed his PRs and contributed to the releases.  The spec is looking unrecognisably better for it - and Matrix 1.0 is feeling closer than ever!&lt;&#x2F;p&gt;
&lt;p&gt;Alongside the work on the IS&#x2F;AS&#x2F;Push APIs, there has also been a massive attempt to plug all the spec omissions in the Client Server API.  Historically the CS API releases have missed some of the newer APIs (and of course always miss the ones which postdate a given release), but we&#x27;ve released the APIs which &#x2F;have&#x2F; been specified as stable in order to declare them stable.  However, in this release we&#x27;ve tried to go through and fill in as many remaining gaps as possible.&lt;&#x2F;p&gt;
&lt;p&gt;The result is the release of &lt;a href=&quot;&#x2F;docs&#x2F;spec&#x2F;client_server&#x2F;r0.4.0.html&quot;&gt;Client Server API version 0.4&lt;&#x2F;a&gt;. This is a huge update - increasing the size of the CS API by ~40%. The biggest new stuff includes fully formalising support for end-to-end encryption (thanks to Zil0!), versioning for rooms (so we can upgrade rooms to new versions of the protocol), synchronised read markers, user directories, server ACLs, MSISDN 3rd party ids, and .well-known server discovery (not that it&#x27;s widely used yet), but for the full picture, best bet is to look at &lt;a href=&quot;&#x2F;docs&#x2F;spec&#x2F;client_server&#x2F;r0.4.0.html#changelog&quot;&gt;the changelog&lt;&#x2F;a&gt; (now managed by &lt;a href=&quot;https:&#x2F;&#x2F;pypi.org&#x2F;project&#x2F;towncrier&#x2F;&quot;&gt;towncrier&lt;&#x2F;a&gt;!).  It&#x27;s probably fair to say that the CS API is growing alarmingly large at this point - Chrome says that it&#x27;d be 223 A4 pages if printed. Our solution to this will be to refactor it somehow (and perhaps switch to a more compact representation of the contents).&lt;&#x2F;p&gt;
&lt;p&gt;Some things got deliberately missed from the CS 0.4 release: particularly membership Lazy Loading (because we&#x27;re still testing it out and haven&#x27;t released it properly in the wild yet), the various GDPR-specific APIs (because they may evolve a bit as we refine them since the original launch), finalising ID grammars in the overall spec (because this is surprisingly hard and subtle and we don&#x27;t want to rush it) and finally Communities (aka Groups), as they are still somewhat in flux.&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, on the Server to Server API, there has also been a massive amount of work.  Since the beginning of July it&#x27;s 
&lt;b&gt;tripled&lt;&#x2F;b&gt; in size as we&#x27;ve filled in the gaps, over the course of &amp;gt;200 commits (&amp;gt;150 of which from Travis).  If you take a look at the &lt;a href=&quot;&#x2F;docs&#x2F;spec&#x2F;server_server&#x2F;unstable.html&quot;&gt;current snapshot&lt;&#x2F;a&gt; it&#x27;s pretty unrecognisable from the historical draft; with the main changes being:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Adding the new State Resolution algorithm to address flaws in the original one.  This has been where much of our time has gone - see &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1441&quot;&gt;MSC1442&lt;&#x2F;a&gt; for full details.  Adopting the new algorithm requires rooms to be recreated; we&#x27;ll write more about this in the near future when we actually roll it out.
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Adding room versioning so we can upgrade to the new State Resolution algorithm.
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Everything is now properly expressed as Swagger (OpenAPI), just like the CS API
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Adding all the details for E2E encryption (including dependencies like to-device messaging and device-list synchronisation)
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Improvements in specifying how to authorize inbound events over federation
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document federation APIs such as &#x2F;event_auth and &#x2F;query_auth and &#x2F;get_missing_events
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document 3rd party invites over federation
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document the &#x2F;user&#x2F;* federation endpoints
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document Server ACLs
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document read receipts over federation
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document presence over federation
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document typing notifications over federation
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document content repository over federation
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Document room directory over federation
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;...and many many other minor bug fixes, omission fixes, and restructuring for coherency - see &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1464&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1464&lt;&#x2F;a&gt; for an even longer list :)
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
However, we haven&#x27;t finished it all: despite our best efforts we&#x27;re running slightly past the original target of Aug 31.  The current state of play for the r0 release overall (in terms of pending issues) is:
&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;Screen-Shot-2018-09-03-at-16.56.18.png&quot;&gt;&lt;img class=&quot;aligncenter size-full wp-image-3525&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;Screen-Shot-2018-09-03-at-16.56.18.png&quot; alt=&quot;&quot; width=&quot;576&quot; height=&quot;214&quot; &#x2F;&gt;&lt;&#x2F;a&gt;...and you can see the full breakdown over at the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;projects&#x2F;1&quot;&gt;public Github project dashboard&lt;&#x2F;a&gt;.
&lt;p&gt;The main stuff we still have remaining on the Server&#x2F;Server API at this point is:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Better specifying how we validate inbound events. See &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1646&quot;&gt;MSC1646&lt;&#x2F;a&gt; for details &amp; progress.
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Switching event IDs to be hashes. See &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1640&quot;&gt;MSC1640&lt;&#x2F;a&gt; for details and progress.
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Various other remaining security considerations (e.g. how to handle malicious auth events in the DAG; how to better handle DoS situations).
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Merging in the changes to authoring m.room.power_levels (as per &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1304&quot;&gt;MSC1304&lt;&#x2F;a&gt;)
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Formally specifying the remaining identifiers which lack a formal grammar - &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1598&quot;&gt;MSC1597&lt;&#x2F;a&gt; and particularly room aliases (
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1607&quot;&gt;MSC1608&lt;&#x2F;a&gt;)
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
The plan here is to continue speccing and implementing these at top priority (with Travis continuing to work fulltime on spec work), and we&#x27;ll obviously keep you up-to-date on progress.  Some of the changes here (e.g. event IDs) are quite major and we definitely want to implement them before speccing them, so we&#x27;re just going to have to keep going as fast as we can. Needless to say we want to cut an r0 of the S2S API alongside the others asap and declare Matrix out of beta (at least at the spec level :)
&lt;p&gt;In terms of visualising progress on this spec mission it&#x27;s interesting to look at the rate at which we&#x27;ve been closing PRs: this graph shows the total number of PRs which are in state ‘open&#x27; or ‘closed&#x27; on any given day:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;Screen-Shot-2018-09-03-at-00.56.38.png&quot;&gt;&lt;img class=&quot;aligncenter size-large wp-image-3526&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;Screen-Shot-2018-09-03-at-00.56.38-1024x722.png&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;722&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;...which clearly shows the original sprint to get the r0 of the CS API out the door at the end 2015, and then a more leisurely pace until the beginning of July 2018 since which the pace has picked up massively.  Other ways of looking at include the number of open issues...&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;image-1.png&quot;&gt;&lt;img class=&quot;aligncenter size-large wp-image-3527&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;image-1-1024x691.png&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;691&quot; &#x2F;&gt;&lt;&#x2F;a&gt;
...or indeed the number of commits per week…&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;Screen-Shot-2018-09-03-at-01.02.27.png&quot;&gt;&lt;img class=&quot;aligncenter wp-image-3528&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;Screen-Shot-2018-09-03-at-01.02.27-1024x195.png&quot; alt=&quot;&quot; width=&quot;710&quot; height=&quot;135&quot; &#x2F;&gt;&lt;&#x2F;a&gt;
...or the overall Github Project activity for August.  (It&#x27;s impressive to see Zil0 sneaking in there on second place on the commit count, thanks to all his GSoC work documenting E2E encryption in the spec as part of implementing it in matrix-python-sdk!)&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;Screen-Shot-2018-09-03-at-01.03.57.png&quot;&gt;&lt;img class=&quot;aligncenter wp-image-3529&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;09&#x2F;Screen-Shot-2018-09-03-at-01.03.57-1024x925.png&quot; alt=&quot;&quot; width=&quot;744&quot; height=&quot;672&quot; &#x2F;&gt;&lt;&#x2F;a&gt;
Anyway, enough numerology.  It&#x27;s worth noting that all of the dev for r0 has generally followed the proposed &lt;a href=&quot;&#x2F;blog&#x2F;2018&#x2F;06&#x2F;20&#x2F;towards-open-governance-for-matrix-org&#x2F;&quot;&gt;Open Governance Model for Matrix&lt;&#x2F;a&gt;, with the core spec team made up of both historical core team folk (erik, richvdh, dave &amp;amp; matthew), new core team folk (uhoreg &amp;amp; travis) and community folk (kitsune, anoa &amp;amp; mujx) working together to review and approve the changes - and we&#x27;ve been doing MSCs (albeit with an accelerated pace) for anything which we feel requires input from the wider community.  Once the Server&#x2F;Server r0 release is out the door we&#x27;ll be finalising the open governance model and switching to a slightly more measured (but productive!) model of spec development as outlined there.&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, Matrix 1.0 gets ever closer.  With (almost) all this spec mission done, our plan is to focus more on improving the reference implementations - particularly performance in Synapse, 
UX in matrix-{&#x27;{&#x27;}react,ios,android{&#x27;}&#x27;}-sdk as used by Riot (especially for E2E encryption), and then declare a 1.0 and get back to implementing new features (particularly Editable Messages and Reactions) at last.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;d like to thank everyone for your patience whilst we&#x27;ve been playing catch up on the spec, and hope you agree it&#x27;s been worth the effort :)&lt;&#x2F;p&gt;
&lt;p&gt;Matthew &amp;amp; the core spec team.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>GSOC: Implementing End-to-End Encryption in the Matrix Python SDK</title>
		<published>2018-08-01T00:00:00+00:00</published>
		<updated>2018-08-01T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/08/01/gsoc-implementing-end-to-end-encryption-in-the-matrix-python-sdk/" type="text/html"/>
		<id>/blog/2018/08/01/gsoc-implementing-end-to-end-encryption-in-the-matrix-python-sdk/</id>
		<content type="html">&lt;p&gt;Following on from the previous post, we have an update from zil0 on his &lt;a href=&quot;https:&#x2F;&#x2F;summerofcode.withgoogle.com&#x2F;organizations&#x2F;6091058287476736&#x2F;#5468043765874688&quot;&gt;GSoC project&lt;&#x2F;a&gt;, which entailed implementing E2E support in the Matrix Python SDK.&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;The goal of my project is to implement Matrix&#x27;s end-to-end encryption protocol in Python, as part of &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-python-sdk&quot;&gt;matrix-python-sdk&lt;&#x2F;a&gt;. My mentors are Richard van der Hoff (richvdh) and Hubert Chathi (uhoreg).&lt;&#x2F;p&gt;
&lt;p&gt;It was easy to get started on the project, since the simple parts came first (adding API calls), and then the whole process to follow is documented in an &lt;a href=&quot;&#x2F;docs&#x2F;guides&#x2F;e2e_implementation.html&quot;&gt;implementation guide&lt;&#x2F;a&gt;, while there is also the reference implementation in JavaScript. And most importantly, the community is nice. :)&lt;&#x2F;p&gt;
&lt;p&gt;Some parts of the work consist in wrapping around the cryptographic primitives implemented in &lt;a href=&quot;https:&#x2F;&#x2F;git.matrix.org&#x2F;git&#x2F;olm&#x2F;&quot;&gt;libolm&lt;&#x2F;a&gt; (via &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;poljar&#x2F;python-olm&quot;&gt;Python bindings&lt;&#x2F;a&gt;), in order to handle encrypted events. Others are less straightforward, such as tracking device lists of users, or finding the right way to persist keys and related data between startups.&lt;&#x2F;p&gt;
&lt;p&gt;An interesting aspect of this project is that I am working on a new part of the Python SDK, while also having to integrate with existing code, which is a cool balance between freedom and guidelines.&lt;&#x2F;p&gt;
&lt;p&gt;As the encryption documentation is a bit outdated and incomplete, one (fun) difficulty is to look for information across old issues, Gdocs and source code (and asking my mentor when in doubt). For anyone trying to implement E2E, it should be better by the end of the project, as I am currently working on documenting the missing bits.&lt;&#x2F;p&gt;
&lt;p&gt;I have had a great experience so far. Working on an open source project differs from my previous coding experiences, as people are actually going to use what I write! I have learnt to think about the best design from a usability point of view, discuss different approaches, and I had to write tests and document my code, which sadly is not something I do on personal projects. I enjoyed reviews, and the discussions they led to. And of course I have learnt quite an interesting lot about the E2E voodoo, along with some new Python tricks.&lt;&#x2F;p&gt;
&lt;p&gt;Currently, the implementation is in a working state. Some of the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-python-sdk&#x2F;pulls?utf8=%E2%9C%93&amp;q=is%3Apr+author%3AZil0&quot;&gt;code&lt;&#x2F;a&gt; is merged, and some is awaiting review. It is possible to try it &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-python-sdk&#x2F;issues&#x2F;100#issuecomment-402508438&quot;&gt;here&lt;&#x2F;a&gt; before everything is merged.
The project will be finished in about one week, after some tidying up and when I release device verification and key sharing, which should be the last missing features compared to Riot.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Dendrite Progress Update</title>
		<published>2018-07-30T00:00:00+00:00</published>
		<updated>2018-07-30T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/07/30/dendrite-progress-update/" type="text/html"/>
		<id>/blog/2018/07/30/dendrite-progress-update/</id>
		<content type="html">&lt;p&gt;As you may know, for the last few months anoa (Andrew) and APWhiteHat have been working on Dendrite, the next generation Matrix homeserver, written in Go. We asked for an update on their progress, and Andrew provided the blog post below. Serious progress has been made on Dendrite this summer!&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;Hey everyone, my name is Andrew Morgan and I&#x27;ve been working full-time over the summer on Dendrite, our next-generation Matrix homeserver. Over the last two months, I&#x27;ve seen the project transform from a somewhat functioning toy server to a near-production-ready homeserver that is working towards complete feature support. I&#x27;ve appreciated the thought put into the project since day one, and enjoy the elegance of the multi-component design. Documentation is fairly decent at the moment, but comments are plentiful throughout the codebase, while the code itself tends towards simple and maintainable rather than complex and unmanageable.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;application-service-integration&quot;&gt;Application Service Integration&lt;&#x2F;h2&gt;
&lt;p&gt;The main focus of my time here has been on the implementation of application service support for Dendrite. Application services are external programs that act as privileged extensions to a homeserver, allowing such functionality as bots in rooms and bridges to third-party networks. Supporting application services requires a few different bits and pieces to be set up. Currently all planned features have a PR for them, with the bold items already merged:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;&lt;strong&gt;Sending events to application services&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
 	&lt;li&gt;&lt;strong&gt;Support user masquerading for events&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
 	&lt;li&gt;&lt;strong&gt;Support editing event timestamps&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
 	&lt;li&gt;Support room alias querying&lt;&#x2F;li&gt;
 	&lt;li&gt;Support user ID querying
&lt;&#x2F;li&gt;
 	&lt;li&gt;Support third party lookup proxying
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
As you can see a decent portion of the functionality is already in master! The rest will hopefully follow after some further back and forth.
&lt;h2 id=&quot;google-summer-of-code&quot;&gt;Google Summer of Code&lt;&#x2F;h2&gt;
&lt;p&gt;I certainly haven&#x27;t been going at this all on my own. Alongside extensive help from Erik, who&#x27;s been mentoring me, our resident Google Summer of Code student, APWhiteHat, has been tackling feature after feature in Dendrite wherever he can find them. Application services received a good deal of help on client-server endpoint authentication side, however, APWhiteHat has mostly been focusing on federation and some other very useful pieces. While his GSoC period still has a week or so before its conclusion, he has so far implemented:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Idempotency to roomserver event processing to prevent duplication
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Username auto generation
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Tokens library based on macaroons
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Lots of left-over federation stuff: state API &amp; get missing events being the major ones
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;AS support to clientapi auth
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;Typing server: handling of PUT &#x2F;typing by clientapi
&lt;&#x2F;li&gt;
 	&lt;li style=&quot;font-weight: 400;&quot;&gt;More typing server stuff on its way
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
From my perspective, APWhiteHat was an excellent developer to work with. He asked good questions and was quick to answer any myself or the community had as well. His code reviews were also very comprehensive. I learned a lot from working with him and everyone else :)
&lt;h2 id=&quot;opentracing-and-prometheus-monitoring&quot;&gt;OpenTracing and Prometheus Monitoring&lt;&#x2F;h2&gt;
&lt;p&gt;Placing any large server into a production environment requires extensive monitoring capabilities in order to ensure operations are running smoothly. To that effect, Dendrite has been both the addition of OpenTracing and Prometheus support. Prometheus, also used heavily in Synapse, allows a homeserver operator to track a wide range of data including endpoint usage, resource management as well as user statistics over any given range of time.&lt;&#x2F;p&gt;
&lt;p&gt;In Dendrite, we are taking this one step further by introducing &lt;a href=&quot;https:&#x2F;&#x2F;opentracing.io&#x2F;&quot;&gt;OpenTracing&lt;&#x2F;a&gt;, a language and platform-agnostic framework for tracking the journey of an endpoint call from incoming request to outgoing response, with every method, hierarchy change and database call in between. It will be immensely useful in tracking down performance issues, as well as providing insight into the most critical paths throughout the codebase and where we should focus most of our optimization efforts on. It also comes with a lovely dashboard courtesy of &lt;a href=&quot;https:&#x2F;&#x2F;www.jaegertracing.io&#x2F;&quot;&gt;Jaeger&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;07&#x2F;image1.png&quot;&gt;&lt;img class=&quot;alignnone size-large wp-image-3432&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;07&#x2F;image1-1024x527.png&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;527&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;community&quot;&gt;Community&lt;&#x2F;h2&gt;
&lt;p&gt;We&#x27;ve also seen some encouraging interest and development work from the community in the past couple months. While PR review from our own side is admittedly slow due to our focus on getting the foundational work in place, that hasn&#x27;t stopped both old and new developers from sending in PRs and performing code reviews. A huge thank you to everyone involved! From this we&#x27;ve gotten API implementations and application service fixes from @turt2live, &lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg&#x2F;status&#x2F;1022887733931520001&quot;&gt;an end-to-end encryption implementation from @fadeAce&lt;&#x2F;a&gt;, filtering support from @CromFr, and some PRs and numerous helpful review comments from @krombel.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ve also started to see some people running Dendrite in live environments, which is incredibly exciting for us to see! While Dendrite is not considered production-ready yet (though it moves closer every day), if you are interested in giving it a go please consult the quickstart &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;dendrite&#x2F;blob&#x2F;master&#x2F;INSTALL.md&quot;&gt;installation guide&lt;&#x2F;a&gt;. We look forward to any feedback you may have!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.33.0 is here!!</title>
		<published>2018-07-19T00:00:00+00:00</published>
		<updated>2018-07-19T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/07/19/synapse-0-33-0-is-here/" type="text/html"/>
		<id>/blog/2018/07/19/synapse-0-33-0-is-here/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ve just released &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.33.0&quot;&gt;Synapse 0.33.0&lt;&#x2F;a&gt;!  This is a &lt;strong&gt;major performance upgrade&lt;&#x2F;strong&gt; which speeds up &#x2F;sync (i.e. receiving messages) by a factor of almost 2x!  This has already made a massive difference to the CPU usage and snappiness of the matrix.org homeserver since we rolled it out a few days ago - you can see the drop in sync worker CPU just before midday on July 17th; previously we were regularly hitting the CPU ceiling (at which point everything grinds to a halt) - now we&#x27;re back down hovering between 40% and 60% CPU (at the current load).  This is actually fixing a bug which crept in around Synapse 0.31, so please upgrade - especially if Synapse has been feeling slower than usual recently, and especially if you are still on Synapse 0.31.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;07&#x2F;Screen-Shot-2018-07-19-at-13.00.01-1.png&quot;&gt;&lt;img class=&quot;aligncenter wp-image-3406&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;07&#x2F;Screen-Shot-2018-07-19-at-13.00.01-1-1024x639.png&quot; alt=&quot;&quot; width=&quot;813&quot; height=&quot;507&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile we have a &lt;strong&gt;lot&lt;&#x2F;strong&gt; of new stuff coming on the horizon - a whole new algorithm for state resolution (watch this space for details); incremental state resolution (at last!) to massively speed up state resolution and mitigate extremities build up (and speed up the synapse master process, which is now the bottleneck again on the matrix.org homeserver); better admin tools for managing resource usage, and all the Python3 porting work (with associated speedups and RAM &amp;amp; GC improvements).  Fun times ahead!&lt;&#x2F;p&gt;
&lt;p&gt;The full changelog follows below; as always you can grab Synapse from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt;.   Thanks for flying Matrix!&lt;&#x2F;p&gt;
&lt;h3 id=&quot;synapse-0-33-0-2018-07-19&quot;&gt;Synapse 0.33.0 (2018-07-19)&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;bugfixes&quot;&gt;Bugfixes&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Disable a noisy warning about logcontexts. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3561&quot;&gt;#3561&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;synapse-0-33-0rc1-2018-07-18&quot;&gt;Synapse 0.33.0rc1 (2018-07-18)&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;features&quot;&gt;Features&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Enforce the specified API for report_event. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3316&quot;&gt;#3316&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Include CPU time from database threads in request&#x2F;block metrics. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3496&quot;&gt;#3496&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3501&quot;&gt;#3501&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add CPU metrics for _fetch_event_list. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3497&quot;&gt;#3497&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Optimisation to make handling incoming federation requests more efficient. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3541&quot;&gt;#3541&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;bugfixes-1&quot;&gt;Bugfixes&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix a significant performance regression in &#x2F;sync. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3505&quot;&gt;#3505&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3521&quot;&gt;#3521&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3530&quot;&gt;#3530&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3544&quot;&gt;#3544&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Use more portable syntax in our use of the attrs package, widening the supported versions. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3498&quot;&gt;#3498&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix queued federation requests being processed in the wrong order. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3533&quot;&gt;#3533&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Ensure that erasure requests are correctly honoured for publicly accessible rooms when accessed over federation. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3546&quot;&gt;#3546&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h4 id=&quot;misc&quot;&gt;Misc&lt;&#x2F;h4&gt;
&lt;ul&gt;
 	&lt;li&gt;Refactoring to improve testability. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3351&quot;&gt;#3351&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3499&quot;&gt;#3499&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Use &lt;code&gt;isort&lt;&#x2F;code&gt; to sort imports. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3463&quot;&gt;#3463&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3464&quot;&gt;#3464&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3540&quot;&gt;#3540&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Use parse and asserts from http.servlet. (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3534&quot;&gt;#3534&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;3535&quot;&gt;#3535&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security update: Synapse 0.31.2</title>
		<published>2018-06-14T00:00:00+00:00</published>
		<updated>2018-06-14T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/06/14/security-update-synapse-0-31-2/" type="text/html"/>
		<id>/blog/2018/06/14/security-update-synapse-0-31-2/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;On Monday (2018-06-11) we had an incident where #matrix:matrix.org was hijacked by a malicious user pretending to join the room immediately after its creation in 2014 and then setting an m.room.power_levels event ‘before&#x27; the correct initial power_level for the room.&lt;&#x2F;p&gt;
&lt;p&gt;Under normal circumstances this should be impossible because the initial m.room.power_levels for a room should be set before its m.room.join_rules event, meaning users who join the room are subject to its power levels. However, back before we&#x27;d even released Synapse, the first two rooms ever created in Matrix (#test:matrix.org and #matrix:matrix.org) were manually created and set the join_rules before the power_levels event, letting users join before the room&#x27;s power_levels were defined, and so were vulnerable to this attack. We&#x27;ve since re-created #matrix:matrix.org - please re-&#x2F;join the room if you haven&#x27;t already!&lt;&#x2F;p&gt;
&lt;p&gt;As a defensive measure, we are releasing a security update of Synapse (0.31.2) today which changes the rules used to authenticate power_level events, such that we fail-safe rather than fail-deadly if the existing auth mechanisms fail. In practice this means changing the default power level required to set state to be 50 rather than 0 if there is no power_levels event present, thus meaning that only the room creator can set the initial power_levels event.&lt;&#x2F;p&gt;
&lt;p&gt;We are not aware of anyone abusing this (other than the old #matrix:matrix.org room) but we&#x27;d rather be safe than sorry, so would recommend that everyone upgrade as soon as possible.&lt;&#x2F;p&gt;
&lt;p&gt;This of course constitutes a change to the spec, so full technical details and ongoing discussion around the Matrix Spec Change proposal can be followed over at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1304&quot;&gt;MSC1304&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;EDIT&lt;&#x2F;strong&gt;: if you are aware of your server participating in rooms whose first power_levels event is deliberately set by a different user to their creator, please let us know asap (and don&#x27;t upgrade!)&lt;&#x2F;p&gt;
&lt;p&gt;This work is all part of a general push to finalise and harden and fully specify the Server-Server API as we push towards a long-awaited stable release of Matrix!&lt;&#x2F;p&gt;
&lt;p&gt;As always, you can get the new update from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.31.2&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.31.2&lt;&#x2F;a&gt; or from any of the sources mentioned at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;thanks, and apologies for the inconvenience.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-31-2-2018-06-14&quot;&gt;Changes in synapse v0.31.2 (2018-06-14)&lt;&#x2F;h3&gt;
&lt;p&gt;SECURITY UPDATE: Prevent unauthorised users from setting state events in a room when there is no &lt;code&gt;m.room.power_levels&lt;&#x2F;code&gt; event in force in the room. (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;3397&quot;&gt;#3397&lt;&#x2F;a&gt;)&lt;&#x2F;p&gt;
&lt;p&gt;Discussion around the Matrix Spec change proposal for this change can be followed at &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1304&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1304&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Introducing Matrix Specification Changes</title>
		<published>2018-05-17T00:00:00+00:00</published>
		<updated>2018-05-17T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/05/17/introducing-matrix-specification-changes/" type="text/html"/>
		<id>/blog/2018/05/17/introducing-matrix-specification-changes/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ve been able to start investing more time in advancing the Matrix Specification itself over the last month or so thanks to &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;@benpa:matrix.org&quot;&gt;Ben&lt;&#x2F;a&gt; joining the core team (and should be able to accelerate even more with &lt;a href=&quot;https:&#x2F;&#x2F;www.uhoreg.ca&#x2F;blog&#x2F;20180507-1019&quot;&gt;uhoreg joining in a few weeks&lt;&#x2F;a&gt;!)  The first step in the new wave of work has been to provide much better infrastructure for the process of actually evolving the spec - whether that&#x27;s from changes proposed by the core team or the wider Matrix Community.&lt;&#x2F;p&gt;
&lt;p&gt;So, without further ado, we&#x27;d like to introduce &lt;a href=&quot;&#x2F;docs&#x2F;spec&#x2F;proposals&quot;&gt;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;spec&#x2F;proposals&lt;&#x2F;a&gt; - a dashboard for all the spec change proposals we&#x27;ve accumulated so far (ignoring most of the ones which have already been merged), as well as a clearer workflow for how everyone can help improve the Matrix spec itself.  Part of this is introducing a formal numbering system - e.g. &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&#x2F;1228&quot;&gt;MSC1228&lt;&#x2F;a&gt; stands for Matrix Spec Change 1228 (where 1228 is the ID of the Github issue on the &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&quot;&gt;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;issues&lt;&#x2F;a&gt; repository that tracks the proposal).&lt;&#x2F;p&gt;
&lt;p&gt;Please note that these are &lt;em&gt;NOT&lt;&#x2F;em&gt; like XEPs or RFCs - i.e. optional proposals or add-ons to the protocol; instead they are literally proposals for changes to the Matrix Spec itself.  Once merged into the spec, they are only of historical interest.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ve also created a new room: &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#matrix-spec:matrix.org&quot;&gt;#matrix-spec:matrix.org&lt;&#x2F;a&gt; to discuss specific spec proposal changes - please join if you want to track how proposals are evolving! (Conversation is likely to fork off into per-proposal rooms or overflow into &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#matrix-dev:matrix.org&quot;&gt;#matrix-dev:matrix.org&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#matrix-architecture:matrix.org&quot;&gt;#matrix-architecture:matrix.org&lt;&#x2F;a&gt; depending on traffic levels, however).&lt;&#x2F;p&gt;
&lt;p&gt;Feedback would be much appreciated on this - so please head over to &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#matrix-spec:matrix.org&quot;&gt;#matrix-spec:matrix.org&lt;&#x2F;a&gt; and let us know how it feels and how it could do better.&lt;&#x2F;p&gt;
&lt;p&gt;This is also a major step towards properly formalising Matrix.org&#x27;s governance model - hopefully the changes above are sufficient to improve the health of the evolution of the Spec as we work towards an initial stable release later this year, and then you should expect to see a spec proposal for formal governance once we&#x27;ve (at last!) exited beta :)&lt;&#x2F;p&gt;
&lt;p&gt;Huge thanks to Ben for putting this together, and thanks to everyone who&#x27;s contributed so far to the spec - we&#x27;re looking forward to working through the backlog of proposals and turning them all into merged spec PRs!!&lt;&#x2F;p&gt;
&lt;p&gt;Matthew&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>SECURITY UPDATE: Synapse 0.28.1</title>
		<published>2018-05-01T00:00:00+00:00</published>
		<updated>2018-05-01T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/05/01/security-update-synapse-0-28-1/" type="text/html"/>
		<id>/blog/2018/05/01/security-update-synapse-0-28-1/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Many people will have noticed disruption in #matrix:matrix.org and #matrix-dev:matrix.org on Sunday, when a validation bug in Synapse was exploited which allowed a malicious event to be inserted into the room with &#x27;depth&#x27; value that made the rooms temporarily unusable. Whilst a transient workaround was found at the time (thanks to &#x2F;dev&#x2F;ponies, kythyria and Po Shamil for the workaround and to Half-Shot for working on a proposed fix), we&#x27;re doing an urgent release of Synapse 0.28.1 to provide a temporary solution which will mitigate the attack across all rooms in upgraded servers and un-break affected ones.  Meanwhile we have a full long-term fix on the horizon (hopefully) later this week.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;This vulnerability has already been exploited in the wild; please upgrade as soon as possible.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.28.1 is available from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.28.1&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.28.1&lt;&#x2F;a&gt; as normal.&lt;&#x2F;p&gt;
&lt;p&gt;The &#x27;depth&#x27; parameter is used primarily as a way for servers to signal the intended cosmetic order of their events within a room (particularly when the room&#x27;s message graph has gaps in it due to the server being offline, or due to users backfilling old disconnected chunks of conversation). This means that affected rooms may experience message ordering problems until a full long-term fix is provided, which we&#x27;re working on currently (and tentatively involves no longer trusting &#x27;depth&#x27; information from servers).  For full details you can see the proposal documents for the &lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;document&#x2F;d&#x2F;1I3fi2S-XnpO45qrpCsowZv8P8dHcNZ4fsBsbOW7KABI&#x2F;edit#&quot;&gt;temporary fix in 0.28.1&lt;&#x2F;a&gt; and the options for the&lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;document&#x2F;d&#x2F;16ofbjluy8ZKYL6nt7WLHG4GqSodJUWLUxHhI6xPEjr4&#x2F;edit#&quot;&gt; imminent long-term fix&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;d like to acknowledge jzk for identifying the vulnerability, and Max Dor for providing feedback on the fixes.&lt;&#x2F;p&gt;
&lt;p&gt;As a general reminder, Synapse is still beta (as is the Matrix spec) and the federation API particularly is still being debugged and refined and is pre-r0.0.0. For the benefit of the whole community, please disclose vulnerabilities and exploits responsibly by emailing security@ or DMing someone from +matrix:matrix.org. Thanks.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-28-1-2018-05-01&quot;&gt;Changes in synapse v0.28.1 (2018-05-01)&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;strong&gt;SECURITY UPDATE&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Clamp the allowed values of event depth received over federation to be [0, 2^63 - 1]. This mitigates an attack where malicious events injected with depth = 2^63 - 1 render rooms unusable. Depth is used to determine the cosmetic ordering of events within a room, and so the ordering of events in such a room will default to using stream_ordering rather than depth (topological_ordering). This is a temporary solution to mitigate abuse in the wild, whilst a long solution is being implemented to improve how the depth parameter is used.Full details at &lt;a href=&quot;https:&#x2F;&#x2F;docs.google.com&#x2F;document&#x2F;d&#x2F;1I3fi2S-XnpO45qrpCsowZv8P8dHcNZ4fsBsbOW7KABI&quot; rel=&quot;nofollow&quot;&gt;https:&#x2F;&#x2F;docs.google.com&#x2F;document&#x2F;d&#x2F;1I3fi2S-XnpO45qrpCsowZv8P8dHcNZ4fsBsbOW7KABI&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
 	&lt;li&gt;Pin Twisted to &amp;lt;18.4 until we stop using the private _OpenSSLECCurve API.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Security update: Riot&#x2F;Web 0.13.5 released - fixing XSS vulnerability</title>
		<published>2018-02-09T00:00:00+00:00</published>
		<updated>2018-02-09T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/02/09/security-update-riotweb-0-13-5-released-fixing-xss-vulnerability/" type="text/html"/>
		<id>/blog/2018/02/09/security-update-riotweb-0-13-5-released-fixing-xss-vulnerability/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Heads up that we made an emergency release of Riot&#x2F;Web 0.13.5 a few hours ago to fix a XSS vulnerability found and reported by walle303 - many thanks for disclosing it responsibly.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;strong&gt;Please upgrade to Riot&#x2F;Web 0.13.5 asap. If you&#x27;re using &lt;a href=&quot;https:&#x2F;&#x2F;riot.im&#x2F;app&quot;&gt;riot.im&#x2F;app&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;riot.im&#x2F;develop&quot;&gt;riot.im&#x2F;develop&lt;&#x2F;a&gt; this simply means hitting Refresh; otherwise please upgrade your Riot deployment as soon as possible. &lt;&#x2F;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;pkgs.alpinelinux.org&#x2F;packages?name=riot-web&amp;branch=edge&quot;&gt;Alpine&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;riot.im&#x2F;desktop&quot;&gt;Debian&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;taw00&#x2F;riot-rpm&quot;&gt;Fedora&#x2F;RPM&lt;&#x2F;a&gt; packages are already updated - huge thanks to the maintainers for the fast turnaround.&lt;&#x2F;p&gt;
&lt;p&gt;The issue lies in the relatively obscure external_url feature, which lets bridges specify a URL for bridged events, letting Riot&#x2F;Web users link through to the &#x27;original&#x27; event (e.g. a twitter URL on a bridged tweet).  The option is hidden in a context menu and labelled &amp;quot;Source URL&amp;quot;, and is only visible on events which have the external_url field set.  Unfortunately Riot&#x2F;Web didn&#x27;t sanitise the URL correctly, allowing a malicious URL to be injected - and this has been the case since the feature landed in Riot 0.9.0 (Nov 2016).&lt;&#x2F;p&gt;
&lt;p&gt;If you&#x27;re not able to upgrade to Riot&#x2F;Web 0.13.5 for some reason, then please do not click on the &#x27;Source URL&#x27; feature on the event context menu:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;02&#x2F;xss.png&quot;&gt;&lt;img class=&quot;aligncenter size-large wp-image-3001&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2018&#x2F;02&#x2F;xss-1024x352.png&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;352&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Apologies for the inconvenience,&lt;&#x2F;p&gt;
&lt;p&gt;thanks,&lt;&#x2F;p&gt;
&lt;p&gt;Matthew&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.26 released!</title>
		<published>2018-01-05T00:00:00+00:00</published>
		<updated>2018-01-05T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2018/01/05/synapse-0-26-released/" type="text/html"/>
		<id>/blog/2018/01/05/synapse-0-26-released/</id>
		<content type="html">&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.26 is here (with no changes since RC1 which we released just before Christmas).  It&#x27;s a general maintenance release, albeit with a few new features but mainly lots of bugfixes and general refinements.  Enjoy!&lt;&#x2F;p&gt;
&lt;p&gt;As always, you can get it from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.26.0&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.26.0&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-26-0-2018-01-05&quot;&gt;Changes in synapse v0.26.0 (2018-01-05)&lt;&#x2F;h3&gt;
&lt;p&gt;No changes since v0.26.0-rc1&lt;&#x2F;p&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-26-0-rc1-2017-12-13&quot;&gt;Changes in synapse v0.26.0-rc1 (2017-12-13)&lt;&#x2F;h3&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add ability for ASes to publicise groups for their users (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2686&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;274583719&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2686&quot;&gt;#2686&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add all local users to the user_directory and optionally search them (PR
&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2723&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;277862997&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2723&quot;&gt;#2723&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add support for custom login types for validating users (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2729&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;279071778&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2729&quot;&gt;#2729&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Update example Prometheus config to new format (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2648&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;271817293&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2648&quot;&gt;#2648&lt;&#x2F;a&gt;) Thanks to
&lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;krombel&quot;&gt;@krombel&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Rename redact_content option to include_content in Push API (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2650&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;272152108&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2650&quot;&gt;#2650&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Declare support for r0.3.0 (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2677&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;274218233&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2677&quot;&gt;#2677&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Improve upserts (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2684&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;274561033&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2684&quot;&gt;#2684&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2688&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;274610868&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2688&quot;&gt;#2688&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2689&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;274611631&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2689&quot;&gt;#2689&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2713&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;276994305&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2713&quot;&gt;#2713&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Improve documentation of workers (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2700&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;275710165&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2700&quot;&gt;#2700&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Improve tracebacks on exceptions (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2705&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;276410346&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2705&quot;&gt;#2705&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Allow guest access to group APIs for reading (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2715&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;277349107&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2715&quot;&gt;#2715&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Support for posting content in federation_client script (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2716&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;277381003&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2716&quot;&gt;#2716&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Delete devices and pushers on logouts etc (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2722&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;277826542&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2722&quot;&gt;#2722&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix database port script (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2673&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;273841564&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2673&quot;&gt;#2673&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix internal server error on login with ldap_auth_provider (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2678&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;274315963&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2678&quot;&gt;#2678&lt;&#x2F;a&gt;) Thanks
to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;jkolo&quot;&gt;@jkolo&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix error on sqlite 3.7 (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2697&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;275673530&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2697&quot;&gt;#2697&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix OPTIONS on preview_url (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2707&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;276447844&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2707&quot;&gt;#2707&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix error handling on dns lookup (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2711&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;276665577&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2711&quot;&gt;#2711&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix wrong avatars when inviting multiple users when creating room (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2717&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;277422674&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2717&quot;&gt;#2717&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix 500 when joining matrix-dev (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2719&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;277434890&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2719&quot;&gt;#2719&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.25 is out... as is Matrix Specification 0.3(!!!)</title>
		<published>2017-11-15T00:00:00+00:00</published>
		<updated>2017-11-15T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/11/15/synapse-0-25-is-out-as-is-matrix-specification-0-3/" type="text/html"/>
		<id>/blog/2017/11/15/synapse-0-25-is-out-as-is-matrix-specification-0-3/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Today is a crazy release day here - not only do we have Synapse 0.25, but we&#x27;ve also made a formal release of the Matrix Specification (CS API) for the first time in 16 months!&lt;&#x2F;p&gt;
&lt;h3 id=&quot;matrix-cs-api-0-3&quot;&gt;Matrix CS API 0.3&lt;&#x2F;h3&gt;
&lt;p&gt;Talking first about the spec update: the workflow of the Matrix spec is that new experimental features get added to an &#x2F;unstable API prefix, and then whenever we release the Matrix spec, these get moved over to being part of the &#x2F;r0 prefix (or whatever version we happen to be on).  We&#x27;ve been &lt;strong&gt;very&lt;&#x2F;strong&gt; constrained on manpower to work on the spec over the last ~18 months, but we&#x27;ve been keeping it up-to-date on a best effort basis, with a bit of help from the wider community.  &lt;b&gt; &lt;&#x2F;b&gt;As such, this latest release does not contain all the latest APIs (and certainly not experimental ones like Groups&#x2F;Communities which are still evolving), but it does release all of the unstable ones which we&#x27;ve managed to document and which are considered stable enough to become part of the &#x27;r0&#x27; prefix.  Going forwards, we&#x27;re hoping that the wider community will help us fill in the remaining gaps (i.e. propose PRs against the matrix-org&#x2F;matrix-doc repository to formalise the various spec drafts flying around the place) - and we&#x27;re also hoping (if&#x2F;when funding crisis is abated) to locate full-time folk to work on the spec.&lt;&#x2F;p&gt;
&lt;p&gt;The full changelog for 0.3 of the spec is:&lt;&#x2F;p&gt;
&lt;ul class=&quot;simple&quot;&gt;
 	&lt;li&gt;Breaking changes:
&lt;ul&gt;
 	&lt;li&gt;Change the rule kind of &lt;cite&gt;.m.rule.contains_display_name&lt;&#x2F;cite&gt; from &lt;cite&gt;underride&lt;&#x2F;cite&gt; to &lt;cite&gt;override&lt;&#x2F;cite&gt;. This works with all known clients which support push rules, but any other clients implementing the push rules API should be aware of this change. This makes it simple to mute rooms correctly in the API (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;373&quot;&gt;#373&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Remove &lt;tt class=&quot;docutils literal&quot;&gt;&#x2F;tokenrefresh&lt;&#x2F;tt&gt; from the API (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;395&quot;&gt;#395&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Remove requirement that tokens used in token-based login be macaroons (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;395&quot;&gt;#395&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
 	&lt;li&gt;Changes to the API which will be backwards-compatible for clients:
&lt;ul&gt;
 	&lt;li&gt;Add &lt;tt class=&quot;docutils literal&quot;&gt;filename&lt;&#x2F;tt&gt; parameter to &lt;tt class=&quot;docutils literal&quot;&gt;POST &#x2F;_matrix&#x2F;media&#x2F;r0&#x2F;upload&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;364&quot;&gt;#364&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Document CAS-based client login and the use of &lt;tt class=&quot;docutils literal&quot;&gt;m.login.token&lt;&#x2F;tt&gt; in &lt;tt class=&quot;docutils literal&quot;&gt;&#x2F;login&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;367&quot;&gt;#367&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Make &lt;tt class=&quot;docutils literal&quot;&gt;origin_server_ts&lt;&#x2F;tt&gt; a mandatory field of room events (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;370&quot;&gt;#379&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add top-level &lt;tt class=&quot;docutils literal&quot;&gt;account_data&lt;&#x2F;tt&gt; key to the responses to &lt;tt class=&quot;docutils literal&quot;&gt;GET &#x2F;sync&lt;&#x2F;tt&gt; and &lt;tt class=&quot;docutils literal&quot;&gt;GET &#x2F;initialSync&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;380&quot;&gt;#380&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add &lt;tt class=&quot;docutils literal&quot;&gt;is_direct&lt;&#x2F;tt&gt; flag to &lt;tt class=&quot;docutils literal&quot;&gt;POST &#x2F;createRoom&lt;&#x2F;tt&gt; and invite member event. Add &#x27;Direct Messaging&#x27; module (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;389&quot;&gt;#389&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add &lt;tt class=&quot;docutils literal&quot;&gt;contains_url&lt;&#x2F;tt&gt; option to &lt;tt class=&quot;docutils literal&quot;&gt;RoomEventFilter&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;390&quot;&gt;#390&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add &lt;tt class=&quot;docutils literal&quot;&gt;filter&lt;&#x2F;tt&gt; optional query param to &lt;tt class=&quot;docutils literal&quot;&gt;&#x2F;messages&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;390&quot;&gt;#390&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add &#x27;Send-to-Device messaging&#x27; module (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;386&quot;&gt;#386&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add &#x27;Device management&#x27; module (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;402&quot;&gt;#402&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Require that User-Interactive auth fallback pages call &lt;tt class=&quot;docutils literal&quot;&gt;window.postMessage&lt;&#x2F;tt&gt; to notify apps of completion (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;398&quot;&gt;#398&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add pagination and filter support to &lt;tt class=&quot;docutils literal&quot;&gt;&#x2F;publicRooms&lt;&#x2F;tt&gt;. Change response to omit fields rather than return &lt;tt class=&quot;docutils literal&quot;&gt;null&lt;&#x2F;tt&gt;. Add estimate of total number of rooms in list. (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;388&quot;&gt;#388&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Allow guest accounts to use a number of endpoints which are required for end-to-end encryption. (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;751&quot;&gt;#751&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add key distribution APIs, for use with end-to-end encryption. (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;894&quot;&gt;#894&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add &lt;tt class=&quot;docutils literal&quot;&gt;m.room.pinned_events&lt;&#x2F;tt&gt; state event for rooms. (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1007&quot;&gt;#1007&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add mention of ability to send Access Token via an Authorization Header.&lt;&#x2F;li&gt;
 	&lt;li&gt;New endpoints:
&lt;ul&gt;
 	&lt;li&gt;&lt;tt class=&quot;docutils literal&quot;&gt;GET &#x2F;joined_rooms&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;999&quot;&gt;#999&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;&lt;tt class=&quot;docutils literal&quot;&gt;GET &lt;span class=&quot;pre&quot;&gt;&#x2F;rooms&#x2F;{&#x27;{&#x27;}roomId{&#x27;}&#x27;}&#x2F;joined_members&lt;&#x2F;span&gt;
&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;999&quot;&gt;#999&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;&lt;tt class=&quot;docutils literal&quot;&gt;GET &#x2F;account&#x2F;whoami&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1063&quot;&gt;#1063&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;&lt;tt class=&quot;docutils literal&quot;&gt;GET &lt;span class=&quot;pre&quot;&gt;&#x2F;media&#x2F;{&#x27;{&#x27;}version{&#x27;}&#x27;}&#x2F;preview_url&lt;&#x2F;span&gt;
&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1064&quot;&gt;#1064&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
 	&lt;li&gt;Spec clarifications:
&lt;ul&gt;
 	&lt;li&gt;Add endpoints and logic for invites and third-party invites to the federation spec and update the JSON of the request sent by the identity server upon 3PID binding (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;997&quot;&gt;#997&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix &quot;membership&quot; property on third-party invite upgrade example (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;995&quot;&gt;#995&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix response format and 404 example for room alias lookup (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;960&quot;&gt;#960&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix examples of &lt;tt class=&quot;docutils literal&quot;&gt;m.room.member&lt;&#x2F;tt&gt; event and room state change, and added a clarification on the membership event sent upon profile update (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;950&quot;&gt;#950&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Spell out the way that state is handled by &lt;tt class=&quot;docutils literal&quot;&gt;POST &#x2F;createRoom&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;362&quot;&gt;#362&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Clarify the fields which are applicable to different types of push rule (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;365&quot;&gt;#365&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;A number of clarifications to authentication (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;371&quot;&gt;#371&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Correct references to &lt;tt class=&quot;docutils literal&quot;&gt;user_id&lt;&#x2F;tt&gt; which should have been &lt;tt class=&quot;docutils literal&quot;&gt;sender&lt;&#x2F;tt&gt; (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;376&quot;&gt;#376&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Correct inconsistent specification of &lt;tt class=&quot;docutils literal&quot;&gt;redacted_because&lt;&#x2F;tt&gt; fields and their values (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;378&quot;&gt;#378&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Mark required fields in response objects as such (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;394&quot;&gt;#394&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Make &lt;tt class=&quot;docutils literal&quot;&gt;m.notice&lt;&#x2F;tt&gt; description a bit harder in its phrasing to try to dissuade the same issues that occurred with IRC (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;750&quot;&gt;#750&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;&lt;tt class=&quot;docutils literal&quot;&gt;GET &lt;span class=&quot;pre&quot;&gt;&#x2F;user&#x2F;{&#x27;{&#x27;}userId{&#x27;}&#x27;}&#x2F;filter&#x2F;{&#x27;{&#x27;}filterId{&#x27;}&#x27;}&lt;&#x2F;span&gt;
&lt;&#x2F;tt&gt; requires authentication (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1003&quot;&gt;#1003&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Add some clarifying notes on the behaviour of rooms with no &lt;tt class=&quot;docutils literal&quot;&gt;m.room.power_levels&lt;&#x2F;tt&gt; event (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1026&quot;&gt;#1026&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Clarify the relationship between &lt;tt class=&quot;docutils literal&quot;&gt;username&lt;&#x2F;tt&gt; and &lt;tt class=&quot;docutils literal&quot;&gt;user_id&lt;&#x2F;tt&gt; in the &lt;tt class=&quot;docutils literal&quot;&gt;&#x2F;register&lt;&#x2F;tt&gt; API (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1032&quot;&gt;#1032&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
 	&lt;li&gt;Clarify rate limiting and security for content repository. (&lt;a class=&quot;reference external&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;1064&quot;&gt;#1064&lt;&#x2F;a&gt;).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
...and you can read the spec itself of course over at &lt;a href=&quot;&#x2F;docs&#x2F;spec&quot;&gt;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;spec&lt;&#x2F;a&gt;.  It&#x27;s worth noting that we have slightly bent the rules by including three very minor &#x27;breaking changes&#x27; in 0.3, but all for features which to our knowledge nobody is depending on in the wild.  Technically this should mean bumping the major version prefix (i.e. moving to r1), but given how minor and nonimpacting these are we&#x27;re turning a blind eye this time.
&lt;h3 id=&quot;meanwhile-synapse-0-25-is-out&quot;&gt;Meanwhile, Synapse 0.25 is out!&lt;&#x2F;h3&gt;
&lt;p&gt;This is a medium-sized release; the main thing being to support configurable room visibility within groups (so that whenever you add a room to a group, you&#x27;re not forced into sharing their existence with the general public, but can choose to just tell group members about them).  There&#x27;s also a bunch of useful bug fixes and some performance improvements, including lots of contributions from the community this release (thank you!).  Full release notes are:&lt;&#x2F;p&gt;
&lt;h5 id=&quot;changes-in-synapse-v0-25-0-2017-11-15&quot;&gt;Changes in synapse v0.25.0 (2017-11-15)&lt;&#x2F;h5&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix port script (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2673&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;273841564&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2673&quot;&gt;#2673&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h5 id=&quot;changes-in-synapse-v0-25-0-rc1-2017-11-14&quot;&gt;Changes in synapse v0.25.0-rc1 (2017-11-14)&lt;&#x2F;h5&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add is_public to groups table to allow for private groups (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2582&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268816516&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2582&quot;&gt;#2582&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add a route for determining who you are (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2668&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;273327989&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2668&quot;&gt;#2668&lt;&#x2F;a&gt;) Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;turt2live&quot;&gt;@turt2live&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Add more features to the password providers (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2608&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;269913170&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2608&quot;&gt;#2608&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2610&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;269969920&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2610&quot;&gt;#2610&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2620&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270352778&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2620&quot;&gt;#2620&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2622&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270373940&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2622&quot;&gt;#2622&lt;&#x2F;a&gt;,
&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2623&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270374613&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2623&quot;&gt;#2623&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2624&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270374846&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2624&quot;&gt;#2624&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2626&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270676451&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2626&quot;&gt;#2626&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2628&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270677175&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2628&quot;&gt;#2628&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link tooltipped tooltipped-ne&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2629&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270721791&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2629&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add a hook for custom rest endpoints (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2627&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270676740&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2627&quot;&gt;#2627&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add API to update group room visibility (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2651&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;272257429&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2651&quot;&gt;#2651&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Ignore tags when generating URL preview descriptions (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2576&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268596188&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2576&quot;&gt;#2576&lt;&#x2F;a&gt;)
Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;maximevaillancourt&quot;&gt;@maximevaillancourt&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Register some &#x2F;unstable endpoints in &#x2F;r0 as well (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2579&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268761262&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2579&quot;&gt;#2579&lt;&#x2F;a&gt;) Thanks to
&lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;krombel&quot;&gt;@krombel&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Support &#x2F;keys&#x2F;upload on &#x2F;r0 as well as &#x2F;unstable (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2585&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268842938&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2585&quot;&gt;#2585&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Front-end proxy: pass through auth header (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2586&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268843185&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2586&quot;&gt;#2586&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Allow ASes to deactivate their own users (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2589&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268938259&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2589&quot;&gt;#2589&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Remove refresh tokens (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2613&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270111173&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2613&quot;&gt;#2613&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Automatically set default displayname on register (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2617&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270304979&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2617&quot;&gt;#2617&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Log login requests (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2618&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270316951&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2618&quot;&gt;#2618&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Always return &lt;code&gt;is_public&lt;&#x2F;code&gt; in the &lt;code&gt;&#x2F;groups&#x2F;:group_id&#x2F;rooms&lt;&#x2F;code&gt; API (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2630&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270724819&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2630&quot;&gt;#2630&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Avoid no-op media deletes (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2637&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;271174567&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2637&quot;&gt;#2637&lt;&#x2F;a&gt;) Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;spantaleev&quot;&gt;@spantaleev&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix various embarrassing typos around user_directory and add some doc. (PR
&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2643&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;271218429&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2643&quot;&gt;#2643&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Return whether a user is an admin within a group (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2647&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;271795951&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2647&quot;&gt;#2647&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Namespace visibility options for groups (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2657&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;272604541&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2657&quot;&gt;#2657&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Downcase UserIDs on registration (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2662&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;272746677&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2662&quot;&gt;#2662&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Cache failures when fetching URL previews (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2669&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;273404602&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2669&quot;&gt;#2669&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix port script (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2577&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268680457&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2577&quot;&gt;#2577&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix error when running synapse with no logfile (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2581&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268813288&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2581&quot;&gt;#2581&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix UI auth when deleting devices (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2591&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;268938993&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2591&quot;&gt;#2591&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix typo when checking if user is invited to group (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2599&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;269155496&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2599&quot;&gt;#2599&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix the port script to drop NUL values in all tables (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2611&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270038737&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2611&quot;&gt;#2611&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix appservices being backlogged and not receiving new events due to a bug in
notify_interested_services (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2631&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;270787064&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2631&quot;&gt;#2631&lt;&#x2F;a&gt;) Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;xyzz&quot;&gt;@xyzz&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix updating rooms avatar&#x2F;display name when modified by admin (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2636&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;271057913&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2636&quot;&gt;#2636&lt;&#x2F;a&gt;)
Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;farialima&quot;&gt;@farialima&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug in state group storage (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2649&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;271901224&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2649&quot;&gt;#2649&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix 500 on invalid utf-8 in request (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2663&quot; data-error-text=&quot;Failed to load issue title&quot; data-id=&quot;272868148&quot; data-permission-text=&quot;Issue title is private&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2663&quot;&gt;#2663&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;finally&quot;&gt;Finally...&lt;&#x2F;h2&gt;
&lt;p&gt;If you haven&#x27;t noticed already, Riot&#x2F;Web 0.13 is out today, as is Riot&#x2F;iOS 0.6.2 and Riot&#x2F;Android 0.7.4.  These contain massive improvements across the board - particularly mainstream Communities support at last on Riot&#x2F;Web; CallKit&#x2F;PushKit on Riot&#x2F;iOS thanks to Denis Morozov (GSoC 2017 student for Matrix) and Share Extension on iOS thanks to Aram Sargsyan (also GSoC 2017 student!); and End-to-end Key Sharing on Riot&#x2F;Android and a full rewrite of the VoIP calling subsystem on Android.&lt;&#x2F;p&gt;
&lt;p&gt;Rather than going on about it here, though, there&#x27;s a &lt;a href=&quot;https:&#x2F;&#x2F;medium.com&#x2F;@RiotChat&#x2F;communities-aka-groups-are-here-announcing-riot-web-0-13-riot-ios-0-6-and-riot-android-0-7-4-933cb193a28e&quot;&gt;full write-up over on the Riot Blog.&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;And so there you go - new releases for eeeeeeeeveryone!  Enjoy! :)&lt;&#x2F;p&gt;
&lt;p&gt;--Matthew, Amandine &amp;amp; the team.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.22.0 released!</title>
		<published>2017-07-06T00:00:00+00:00</published>
		<updated>2017-07-06T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/07/06/synapse-0-22-0-released/" type="text/html"/>
		<id>/blog/2017/07/06/synapse-0-22-0-released/</id>
		<content type="html">&lt;p&gt;Hi Synapsefans,&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.22.0 has just been released! This release lands a few interesting features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;The new User directory API which supports Matrix clients&#x27; providing a much more intuitive and effective user search capability by exposing a list of:
&lt;ul&gt;
 	&lt;li&gt;Everybody your user shares a room with, and&lt;&#x2F;li&gt;
 	&lt;li&gt;Everybody in a public room your homeserver knows about&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
 	&lt;li&gt;New support for server admins, including a Shutdown Room API (to remove a room from a local server) and a Media Quarrantine API (to render a media item inaccessible without its actually being deleted)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
As always there are lots of bug fixes and performance improvements, including increasing the default cache factor size from 0.1 to 0.5 (should improve performance for those running their own homeservers).
&lt;p&gt;You can get Synapse 0.22.0 from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.22.0&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.22.0&lt;&#x2F;a&gt; as normal.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-22-0-2017-07-06&quot;&gt;Changes in synapse v0.22.0 (2017-07-06)&lt;&#x2F;h2&gt;
&lt;p&gt;No changes since v0.22.0-rc2&lt;&#x2F;p&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-22-0-rc2-2017-07-04&quot;&gt;Changes in synapse v0.22.0-rc2 (2017-07-04)&lt;&#x2F;h2&gt;
&lt;p&gt;Changes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Improve performance of storing user IPs (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2307&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2307&quot; data-id=&quot;238837177&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2307&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2308&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2308&quot; data-id=&quot;238864014&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2308&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Slightly improve performance of verifying access tokens (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2320&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2320&quot; data-id=&quot;239486219&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2320&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Slightly improve performance of event persistence (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2321&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2321&quot; data-id=&quot;239502265&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2321&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Increase default cache factor size from 0.1 to 0.5 (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2330&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2330&quot; data-id=&quot;240356521&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2330&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix bug with storing registration sessions that caused frequent CPU churn
(PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2319&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2319&quot; data-id=&quot;239472982&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2319&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-22-0-rc1-2017-06-26&quot;&gt;Changes in synapse v0.22.0-rc1 (2017-06-26)&lt;&#x2F;h2&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add a user directory API (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2252&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2252&quot; data-id=&quot;232602331&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2252&lt;&#x2F;a&gt;, and many more)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add shutdown room API to remove room from local server (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;Add shutdown room API&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2291&quot; data-id=&quot;236863021&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2291&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add API to quarantine media (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2292&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2292&quot; data-id=&quot;236951215&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2292&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add new config option to not send event contents to push servers (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;Add configuration parameter to allow redaction of content from push m…&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2301&quot; data-id=&quot;238111730&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2301&lt;&#x2F;a&gt;)
Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;cjdelisle&quot;&gt;@cjdelisle&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Various performance fixes (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2177&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2177&quot; data-id=&quot;225644418&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2177&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2233&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2233&quot; data-id=&quot;229717425&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2233&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2230&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2230&quot; data-id=&quot;229354438&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2230&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2238&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2238&quot; data-id=&quot;230015890&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2238&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2248&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2248&quot; data-id=&quot;231384660&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2248&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2256&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2256&quot; data-id=&quot;234157222&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2256&lt;&#x2F;a&gt;,
&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2274&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2274&quot; data-id=&quot;235482780&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2274&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Deduplicate sync filters (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2219&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2219&quot; data-id=&quot;228004726&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2219&lt;&#x2F;a&gt;) Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;krombel&quot;&gt;@krombel&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Correct a typo in UPGRADE.rst (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2231&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2231&quot; data-id=&quot;229539435&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2231&lt;&#x2F;a&gt;) Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;aaronraimist&quot;&gt;@aaronraimist&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Add count of one time keys to sync stream (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2237&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2237&quot; data-id=&quot;229999204&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2237&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Only store event_auth for state events (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2247&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2247&quot; data-id=&quot;231038843&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2247&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Store URL cache preview downloads separately (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2299&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2299&quot; data-id=&quot;238100783&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2299&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix users not getting notifications when AS listened to that user_id (PR
&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2216&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2216&quot; data-id=&quot;227919645&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2216&lt;&#x2F;a&gt;) Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;slipeer&quot;&gt;@slipeer&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix users without push set up not getting notifications after joining rooms
(PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2236&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2236&quot; data-id=&quot;229977772&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2236&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix preview url API to trim long descriptions (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2243&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2243&quot; data-id=&quot;230506502&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2243&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where we used cached but unpersisted state group as prev group,
resulting in broken state of restart (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2263&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2263&quot; data-id=&quot;234489302&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2263&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix removing of pushers when using workers (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;Fix removing of pushers when using workers&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2267&quot; data-id=&quot;234785628&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2267&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix CORS headers to allow Authorization header (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;allow Authorization header&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2285&quot; data-id=&quot;236427727&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2285&lt;&#x2F;a&gt;) Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;krombel&quot;&gt;@krombel&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.21.1 released!</title>
		<published>2017-06-22T00:00:00+00:00</published>
		<updated>2017-06-22T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/06/22/synapse-0-21-1-released/" type="text/html"/>
		<id>/blog/2017/06/22/synapse-0-21-1-released/</id>
		<content type="html">&lt;p&gt;Hi folks - we forgot to mention that Synapse 0.21.1 was released last week.  This contains a important fix to the &lt;code&gt;report-stats&lt;&#x2F;code&gt; option, which was otherwise failing to report any usage stats for folks who had the option turned on.&lt;&#x2F;p&gt;
&lt;p&gt;This is a good opportunity to note that the &lt;code&gt;report-stats&lt;&#x2F;code&gt; option is &lt;b&gt;really really important&lt;&#x2F;b&gt; for the ongoing health of the Matrix ecosystem: when raising funding to continue working on Matrix we &lt;b&gt;have&lt;&#x2F;b&gt; to be able to demonstrate how the ecosystem is growing and why it&#x27;s a good idea to support us to work on it.  In practice, the data we collect is: hostname, synapse version &amp;amp; uptime, total_users, total_nonbridged users, total_room_count, daily_active_users, daily_active_rooms, daily_messages and daily_sent_messages.&lt;&#x2F;p&gt;
&lt;p&gt;Folks: if you have turned off report-stats for whatever reason, &lt;b&gt;please&lt;&#x2F;b&gt; consider upgrading to 0.21.1 and turning it back on.&lt;&#x2F;p&gt;
&lt;p&gt;In return, the plan is that we&#x27;ll start to publish an official Grafana of the anonymised aggregate stats, probably embedded into the frontpage of Matrix.org, and then you and everyone else can have a view of the state of the Matrix universe.  And critically, it&#x27;ll really help us continue to justify $ to spend on growing the project!&lt;&#x2F;p&gt;
&lt;p&gt;You can get Synapse 0.21.1 from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; or &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.21.1&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.21.1&lt;&#x2F;a&gt; as normal.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.21.0 is released!</title>
		<published>2017-05-18T00:00:00+00:00</published>
		<updated>2017-05-18T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/05/18/synapse-0-21-0-is-released/" type="text/html"/>
		<id>/blog/2017/05/18/synapse-0-21-0-is-released/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.21.0 was released a moment ago. This release lands a number of performance improvements and stability fixes, plus a couple of small features.&lt;&#x2F;p&gt;
&lt;p&gt;For those of you upgrading &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; has the details as usual.  Full changelog follows:&lt;&#x2F;p&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-21-0-2017-05-17&quot;&gt;Changes in synapse v0.21.0 (2017-05-17)&lt;&#x2F;h2&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add per user rate-limiting overrides (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2208&quot;&gt;#2208&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add config option to limit maximum number of events requested by &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; and &lt;code&gt;&#x2F;messages&lt;&#x2F;code&gt; (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2221&quot;&gt;#2221&lt;&#x2F;a&gt;) Thanks to @psaavedra!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Various small performance fixes (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2201&quot;&gt;#2201&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2202&quot;&gt;#2202&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2224&quot;&gt;#2224&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2226&quot;&gt;#2226&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2227&quot;&gt;#2227&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2228&quot;&gt;#2228&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2229&quot;&gt;#2229&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Update username availability checker API (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2209&quot;&gt;#2209&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2213&quot;&gt;#2213&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;When purging, don&#x27;t de-delta state groups we&#x27;re about to delete (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2214&quot;&gt;#2214&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Documentation to check synapse version (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2215&quot;&gt;#2215&lt;&#x2F;a&gt;) Thanks to @hamber-dick!&lt;&#x2F;li&gt;
 	&lt;li&gt;Add an index to event_search to speed up purge history API (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2218&quot;&gt;#2218&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix API to allow clients to upload one-time-keys with new sigs (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2206&quot;&gt;#2206&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;a name=&quot;user-content-changes-in-synapse-v0-21-0-rc2-2017-05-08&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-21-0-rc2-2017-05-08&quot;&gt;Changes in synapse v0.21.0-rc2 (2017-05-08)&lt;&#x2F;h2&gt;
&lt;p&gt;Changes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Always mark remotes as up if we receive a signed request from them (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2190&quot;&gt;#2190&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix bug where users got pushed for rooms they had muted (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2200&quot;&gt;#2200&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;a name=&quot;user-content-changes-in-synapse-v0-21-0-rc1-2017-05-08&quot;&gt;&lt;&#x2F;a&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-21-0-rc1-2017-05-08&quot;&gt;Changes in synapse v0.21.0-rc1 (2017-05-08)&lt;&#x2F;h2&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add username availability checker API (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2183&quot;&gt;#2183&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add read marker API (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2120&quot;&gt;#2120&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Enable guest access for the 3pl&#x2F;3pid APIs (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1983&quot;&gt;#1986&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add setting to support TURN for guests (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2011&quot;&gt;#2011&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Various performance improvements (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2075&quot;&gt;#2075&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2076&quot;&gt;#2076&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2080&quot;&gt;#2080&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2083&quot;&gt;#2083&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2108&quot;&gt;#2108&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2158&quot;&gt;#2158&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2176&quot;&gt;#2176&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2185&quot;&gt;#2185&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Make synctl a bit more user friendly (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2078&quot;&gt;#2078&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2127&quot;&gt;#2127&lt;&#x2F;a&gt;) Thanks @APwhitehat!&lt;&#x2F;li&gt;
 	&lt;li&gt;Replace HTTP replication with TCP replication (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2082&quot;&gt;#2082&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2097&quot;&gt;#2097&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2098&quot;&gt;#2098&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2099&quot;&gt;#2099&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2103&quot;&gt;#2103&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2014&quot;&gt;#2014&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2016&quot;&gt;#2016&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2115&quot;&gt;#2115&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2116&quot;&gt;#2116&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2117&quot;&gt;#2117&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Support authenticated SMTP (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2102&quot;&gt;#2102&lt;&#x2F;a&gt;) Thanks @DanielDent!&lt;&#x2F;li&gt;
 	&lt;li&gt;Add a counter metric for successfully-sent transactions (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2121&quot;&gt;#2121&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Propagate errors sensibly from proxied IS requests (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2147&quot;&gt;#2147&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add more granular event send metrics (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2178&quot;&gt;#2178&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix nuke-room script to work with current schema (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1927&quot;&gt;#1927&lt;&#x2F;a&gt;) Thanks @zuckschwerdt!&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix db port script to not assume postgres tables are in the public schema (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2024&quot;&gt;#2024&lt;&#x2F;a&gt;) Thanks @jerrykan!&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix getting latest device IP for user with no devices (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2118&quot;&gt;#2118&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix rejection of invites to unreachable servers (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2145&quot;&gt;#2145&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix code for reporting old verify keys in synapse (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2156&quot;&gt;#2156&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix invite state to always include all events (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2163&quot;&gt;#2163&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where synapse would always fetch state for any missing event (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2170&quot;&gt;#2170&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix a leak with timed out HTTP connections (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2180&quot;&gt;#2180&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where we didn&#x27;t time out HTTP requests to ASes (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2192&quot;&gt;#2192&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Docs:
&lt;ul&gt;
 	&lt;li&gt;Clarify doc for SQLite to PostgreSQL port (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1961&quot;&gt;#1961&lt;&#x2F;a&gt;) Thanks @benhylau!&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix typo in synctl help (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2107&quot;&gt;#2107&lt;&#x2F;a&gt;) Thanks @HarHarLinks!&lt;&#x2F;li&gt;
 	&lt;li&gt;&lt;code&gt;web_client_location&lt;&#x2F;code&gt; documentation fix (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2131&quot;&gt;#2131&lt;&#x2F;a&gt;) Thanks @matthewjwolff!&lt;&#x2F;li&gt;
 	&lt;li&gt;Update README.rst with FreeBSD changes (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2132&quot;&gt;#2132&lt;&#x2F;a&gt;) Thanks @feld!&lt;&#x2F;li&gt;
 	&lt;li&gt;Clarify setting up metrics (PR &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2149&quot;&gt;#2149&lt;&#x2F;a&gt;) Thanks @encks!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Update on Matrix.org homeserver reliability</title>
		<published>2017-05-12T00:00:00+00:00</published>
		<updated>2017-05-12T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/05/12/update-on-matrix-org-homeserver-reliability/" type="text/html"/>
		<id>/blog/2017/05/12/update-on-matrix-org-homeserver-reliability/</id>
		<content type="html">&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ve had a few outages over the last week on the Matrix.org homeserver which have caused problems for folks using bridges or accounts hosted on matrix.org itself - we&#x27;d like to apologise to everyone who&#x27;s been caught in the crossfire.  In the interests of giving everyone visibility on what&#x27;s going on and what we&#x27;re doing about it (and so folks can learn from our mistakes! :), here&#x27;s a quick writeup (all times are UTC):&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;2017-05-04 21:05: The datacenter where we host matrix.org performs an emergency unscheduled upgrade of the VM host where the main matrix.org HS &amp; DB master lives.  This means a live-migration of the VM onto another host, which freezes the (huge) VM for 9 minutes, during which service is (obviously) down.  Monitoring fires; we start investigating and try to get in on the console, but by the point we&#x27;re considering failing over to the hot-spare, the box has come back and recovers fine other than a load spike as all the traffic catches up.  The clock however is off by 9 minutes due to its world having paused.&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-04 22:30: We step NTP on the host to fix the clock (maximum clock skew on ISC ntpd is 500ppm, meaning it would take weeks to reconverge naturally, during which time we&#x27;re issuing messages with incorrect timestamps).&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-05 01:25: Network connectivity breaks between the matrix.org homeserver and the DC where all of our bridges&#x2F;bots are hosted.&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-05 01:40: Monitoring alerts fire for bridge traffic activity and are picked up.  After trying to restart the VPN between the DC a few times, it turns out that the IP routes needed for the VPN have mysteriously disappeared.&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-05 02:23: Routes are manually readded and VPN recovers and traffic starts flowing again.  It turns out that the routes are meant to be maintained by a post-up script in &#x2F;etc&#x2F;network&#x2F;interfaces, which assumes that &#x2F;sbin&#x2F;ip is on the path.  Historically this hasn&#x27;t been a problem as the DHCP lease on the host has never expired (only been renewed every 6 hours) - but the time disruption caused by the live-migration earlier means that on this renewal cycle the lease actually expires and the routes are lost and not-readded.  Basic bridging traffic checks are done (e.g. Freenode-&amp;gt;Matrix).&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-05 08:30: Turns out that whilst Freenode-&amp;gt;Matrix traffic was working, Matrix-&amp;gt;Freenode was wedged due to a missing HTTP timeout in the AS logic on Synapse.  Synapse is restarted and the bug fixed.&lt;&#x2F;li&gt;
 	&lt;li&gt;...the week goes by...&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-11 18:00: (Unconnected to the rest of this outage, an IRC DDoS on GIMPnet cause intermittent load problems and delayed messages on matrix.org; we turn off the bridge for a few hours until it subsides).&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-12 02:50: The postgres partition on the matrix.org DB master diskfills and postgres halts.  Monitoring alerts fire (once, phone alerts), but the three folks on call manage to sleep through their phone ringing.&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-12 04:45: Folks get woken up and notice the outage; clear up diskspace; restart postgres. Meanwhile, synapse appears to recover, other than mysteriously refusing to send messages from local users.  Investigation commences in the guts of the database to try to see what corruption has happened.&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-12 06:00: We realise that nobody has actually restarted synapse since the DB outage begun, and the failure is probably a known issue where worker replication can get fail and cause the master synapse process to fail to process writes.  Synapse is restarted; everything recovers (including bridges).&lt;&#x2F;li&gt;
 	&lt;li&gt;2017-05-12 06:20: Investigation into the cause of the diskfill reveals it to be due to postgres replication logs (WALs) stacking up on the DB master, due to replication having broken to a DB slave during the previous networking outage.  Monitoring alerts triggered but weren&#x27;t escalated due to a problem in PagerDuty.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Lessons learned:
&lt;ul&gt;
 	&lt;li&gt;Test your networking scripts and always check your box self-recovers after a restart (let alone a DHCP renewal).&lt;&#x2F;li&gt;
 	&lt;li&gt;Don&#x27;t use DHCP in production datacenters unless you really have no choice; it just adds potential ways for everything to break.&lt;&#x2F;li&gt;
 	&lt;li&gt;We need better end-to-end monitoring for bridged traffic.&lt;&#x2F;li&gt;
 	&lt;li&gt;We need to ensure HS&amp;lt;-&amp;gt;Bridge traffic is more reliable (improved by fixing timeout logic in synapse).&lt;&#x2F;li&gt;
 	&lt;li&gt;We need better monitoring and alerting of DB replication traffic.&lt;&#x2F;li&gt;
 	&lt;li&gt;We need to escalate PagerDuty phone alerts more aggressively (done).&lt;&#x2F;li&gt;
 	&lt;li&gt;We need better alerting for disk fill thresholds (especially &quot;time until fill&quot;, remembering to take into account the emergency headroom reserved by the filesystem for the superuser).&lt;&#x2F;li&gt;
 	&lt;li&gt;We should probably have scripts to rapidly (or even automatedly) switch between synapse master &amp; hot-spare, and to promote DB slaves in the event of a master failure.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Hopefully this is the last we&#x27;ve seen of this root cause; we&#x27;ll be working through the todo list above.  Many apologies again for the instability - however please do remember that you can (and should!) run your own homeserver &amp; bridges to stay immune to whatever operational dramas we have with the matrix.org instance!
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.20.0 is released!</title>
		<published>2017-04-11T00:00:00+00:00</published>
		<updated>2017-04-11T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/04/11/synapse-0-20-0-is-released/" type="text/html"/>
		<id>/blog/2017/04/11/synapse-0-20-0-is-released/</id>
		<content type="html">&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.20.0 was released a few hours ago - this is a major new release with loads of stability and performance fixes and some new features too. The main headlines are:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Support for using phone numbers as 3rd party identifiers as well as email addresses!  This is huge: letting you discover other users on Matrix based on whether they&#x27;ve linked their phone number to their matrix account, and letting you log in using your phone number as your identifier if you so desire.  Users of systems like WhatsApp should find this both familiar and useful ;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fixes some very nasty failure modes where the state of a room could be reset if a homeserver received an event it couldn&#x27;t verify.  Folks who have suffered rooms suddenly losing their name&#x2F;icon&#x2F;topic should particularly upgrade - this won&#x27;t fix the rooms retrospectively (your server will need to rejoin the room), but it should fix the problem going forwards.&lt;&#x2F;li&gt;
 	&lt;li&gt;Improves the retry schedule over federation significantly - previously there were scenarios where synapse could try to retry aggressively on servers which were offline.  This fixes that.&lt;&#x2F;li&gt;
 	&lt;li&gt;Significant performance improvements to &#x2F;publicRooms, &#x2F;sync, and other endpoints.&lt;&#x2F;li&gt;
 	&lt;li&gt;Lots of juicy bug fixes.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
We highly recommend upgrading (or installing!) asap - &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; has the details as usual.  Full changelog follows:
&lt;h3 id=&quot;changes-in-synapse-v0-20-0-2017-04-11&quot;&gt;Changes in synapse v0.20.0 (2017-04-11)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix joining rooms over federation where not all servers in the room saw the
new server had joined (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2094&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2094&quot; data-id=&quot;218965094&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2094&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-20-0-rc1-2017-03-30&quot;&gt;Changes in synapse v0.20.0-rc1 (2017-03-30)&lt;&#x2F;h3&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add delete_devices API (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1993&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1993&quot; data-id=&quot;213824583&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1993&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add phone number registration&#x2F;login support (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1994&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1994&quot; data-id=&quot;213848637&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1994&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2055&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2055&quot; data-id=&quot;216534040&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2055&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Use JSONSchema for validation of filters. Thanks &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;pik&quot;&gt;&lt;span class=&quot;ghh-user-x tooltipstered&quot; title=&quot;&quot;&gt;@pik&lt;&#x2F;span&gt;&lt;&#x2F;a&gt;! (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1783&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1783&quot; data-id=&quot;199444033&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1783&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Reread log config on SIGHUP (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1982&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1982&quot; data-id=&quot;213371227&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1982&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Speed up public room list (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1989&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1989&quot; data-id=&quot;213745739&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1989&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add helpful texts to logger config options (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1990&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1990&quot; data-id=&quot;213753788&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1990&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Minor &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; performance improvements. (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2002&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2002&quot; data-id=&quot;214132328&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2002&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2013&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2013&quot; data-id=&quot;214406942&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2013&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2022&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2022&quot; data-id=&quot;214680616&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2022&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add some debug to help diagnose weird federation issue (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2035&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2035&quot; data-id=&quot;215462812&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2035&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Correctly limit retries for all federation requests (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2050&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2050&quot; data-id=&quot;216250274&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2050&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2061&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2061&quot; data-id=&quot;216778245&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2061&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Don&#x27;t lock table when persisting new one time keys (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2053&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2053&quot; data-id=&quot;216424415&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2053&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Reduce some CPU work on DB threads (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2054&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2054&quot; data-id=&quot;216518578&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2054&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Cache hosts in room (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2060&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2060&quot; data-id=&quot;216759034&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2060&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Batch sending of device list pokes (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2063&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2063&quot; data-id=&quot;216807144&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2063&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Speed up persist event path in certain edge cases (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2070&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2070&quot; data-id=&quot;217311121&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2070&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix bug where current_state_events renamed to current_state_ids (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1849&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1849&quot; data-id=&quot;202563705&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1849&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix routing loop when fetching remote media (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1992&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1992&quot; data-id=&quot;213822848&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1992&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix current_state_events table to not lie (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1996&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1996&quot; data-id=&quot;214035508&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1996&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix CAS login to handle PartialDownloadError (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1997&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1997&quot; data-id=&quot;214074229&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1997&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix assertion to stop transaction queue getting wedged (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2010&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2010&quot; data-id=&quot;214372154&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2010&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix presence to fallback to last_active_ts if it beats the last sync time.
Thanks &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Half-Shot&quot;&gt;&lt;span class=&quot;ghh-user-x tooltipstered&quot; title=&quot;&quot;&gt;@Half-Shot&lt;&#x2F;span&gt;&lt;&#x2F;a&gt;! (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;Add fallback to last_active_ts if it beats the last sync time on a presence timeout.&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2014&quot; data-id=&quot;214424439&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2014&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug when federation received a PDU while a room join is in progress (PR
&lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2016&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2016&quot; data-id=&quot;214476894&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2016&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix resetting state on rejected events (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2025&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2025&quot; data-id=&quot;215024206&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2025&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix installation issues in readme. Thanks &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ricco386&quot;&gt;&lt;span class=&quot;ghh-user-x tooltipstered&quot; title=&quot;&quot;&gt;@ricco386&lt;&#x2F;span&gt;&lt;&#x2F;a&gt; (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2037&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2037&quot; data-id=&quot;215522808&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2037&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix caching of remote servers&#x27; signature keys (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2042&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2042&quot; data-id=&quot;216072789&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2042&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix some leaking log context (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2048&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2048&quot; data-id=&quot;216246880&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2048&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;Fix a couple of logcontext leaks&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2049&quot; data-id=&quot;216247053&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2049&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2057&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2057&quot; data-id=&quot;216590150&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2057&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2058&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2058&quot; data-id=&quot;216594461&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2058&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix rejection of invites not reaching sync (PR &lt;a class=&quot;issue-link js-issue-link ghh-issue-x tooltipstered&quot; title=&quot;&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;2056&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;2056&quot; data-id=&quot;216535804&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#2056&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Opening up cyberspace with Matrix and WebVR!</title>
		<published>2017-04-04T00:00:00+00:00</published>
		<updated>2017-04-04T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/04/04/opening-up-cyberspace-with-matrix-and-webvr/" type="text/html"/>
		<id>/blog/2017/04/04/opening-up-cyberspace-with-matrix-and-webvr/</id>
		<content type="html">&lt;p&gt;TL;DR: &lt;a href=&quot;&#x2F;vrdemo&quot;&gt;here&#x27;s the demo&lt;&#x2F;a&gt;!&lt;&#x2F;p&gt;
&lt;p&gt;Hi everyone,&lt;&#x2F;p&gt;
&lt;p&gt;Today is a special day, the sort of day where you take a big step towards an ultimate dream. Starting Matrix and seeing it gaining momentum is already huge for us, a once in a lifetime opportunity. But one of the crazier things which drove us to create Matrix is the dream of creating cyberspace; the legendary promised land of the internet.&lt;&#x2F;p&gt;
&lt;p&gt;Whether it&#x27;s the Matrix of &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Neuromancer&quot;&gt;Neuromancer&lt;&#x2F;a&gt;, the &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Metaverse&quot;&gt;Metaverse&lt;&#x2F;a&gt; of &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Snow_Crash&quot;&gt;Snow Crash&lt;&#x2F;a&gt; or the Other Plane of &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;True_Names&quot;&gt;True Names&lt;&#x2F;a&gt;, an immersive 3D environment where people can meet from around the world to communicate, create and share is the ultimate expression of the Internet&#x27;s potential as a way to connect: the idea of an open, neutral, decentralised virtual reality within the &#x27;net&lt;b&gt;.&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;
&lt;p&gt;This is essentially the software developer equivalent of lying on your back at night, looking up at the stars, and wondering if you&#x27;ll ever fly among them... and Matrix is not alone in dreaming of this!  There have been many walled-garden virtual worlds over the years - &lt;a href=&quot;http:&#x2F;&#x2F;secondlife.com&#x2F;&quot;&gt;Second Life&lt;&#x2F;a&gt;, &lt;a href=&quot;http:&#x2F;&#x2F;habbo.com&quot;&gt;Habbo Hotel&lt;&#x2F;a&gt;, all of the &lt;a href=&quot;http:&#x2F;&#x2F;www.mmorpg.com&#x2F;games-list&quot;&gt;MMORPGs&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;www.sansar.com&#x2F;&quot;&gt;Project Sansar&lt;&#x2F;a&gt; etc.  And there have been decentralised worlds which lack the graphics but share the vision - whether it&#x27;s &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;FidoNet&quot;&gt;FidoNet&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Usenet&quot;&gt;Usenet&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Internet_Relay_Chat&quot;&gt;IRC&lt;&#x2F;a&gt; servers, &lt;a href=&quot;http:&#x2F;&#x2F;xmpp.org&#x2F;&quot;&gt;XMPP&lt;&#x2F;a&gt;, the &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Blogosphere&quot;&gt;blogosphere&lt;&#x2F;a&gt; or Matrix as it&#x27;s used today.  And there are a few ambitious projects like &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Croquet_Project&quot;&gt;Croquet&lt;&#x2F;a&gt;&#x2F;&lt;a href=&quot;http:&#x2F;&#x2F;www.opencobalt.net&#x2F;&quot;&gt;OpenCobalt&lt;&#x2F;a&gt;, &lt;a href=&quot;http:&#x2F;&#x2F;opensimulator.org&#x2F;&quot;&gt;Open Simulator&lt;&#x2F;a&gt;, &lt;a href=&quot;http:&#x2F;&#x2F;www.janusvr.com&quot;&gt;JanusVR&lt;&#x2F;a&gt; or &lt;a href=&quot;http:&#x2F;&#x2F;highfidelity.com&quot;&gt;High Fidelity&lt;&#x2F;a&gt; which aim for a decentralised cyberspace, albeit without defining an open standard.&lt;&#x2F;p&gt;
&lt;p&gt;But despite all this activity, where is the open cyberspace? Where is the universal fabric which could weave these worlds together?  Where is the VR equivalent of The Web itself?  Where is the neutral communication layer that could connect the galaxies of different apps and users into a coherent reality?  How do you bridge between today&#x27;s traditional web apps and their VR equivalents?&lt;&#x2F;p&gt;
&lt;p&gt;Aside from cultural ones, we believe there are three missing ingredients which have been technically holding back the development of an open cyberspace so far:&lt;&#x2F;p&gt;
&lt;ol&gt;
 	&lt;li&gt; The hardware&lt;&#x2F;li&gt;
 	&lt;li&gt; Client software support (i.e. apps)&lt;&#x2F;li&gt;
 	&lt;li&gt; A universal real-time data layer to store the space&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
Nowadays the hardware problem is effectively solved: the &lt;a href=&quot;https:&#x2F;&#x2F;www.vive.com&quot;&gt;HTC Vive&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;www.oculus.com&#x2F;&quot;&gt;Oculus Rift&lt;&#x2F;a&gt; and even &lt;a href=&quot;https:&#x2F;&#x2F;vr.google.com&#x2F;cardboard&#x2F;&quot;&gt;Google Cardboard&lt;&#x2F;a&gt; have brought VR displays to the general public.  Meanwhile, accelerometers and head-tracking turn normal screens into displays for immersive content without even needing goggles, giving &lt;i&gt;everyone&lt;&#x2F;i&gt; a window into a virtual world.
&lt;p&gt;Client software is a more interesting story:  If there are many custom and proprietary VR apps that already exist out there, almost none of them can connect to other servers than the ones ran by their own vendors, or even other services and apps.   An open neutral cyberspace is just like the web: it needs the equivalent of web browsers, i.e. ubiquitous client apps which can connect to any servers and services written by any vendors and hosted by any providers, communicating together via an open common language.   And while web browsers of course exist, until very recently there was no way to link them into VR hardware.&lt;&#x2F;p&gt;
&lt;p&gt;This has changed with the creation of &lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;WebVR&quot;&gt;WebVR&lt;&#x2F;a&gt; by Mozilla - defining an API to let browsers render VR content, gracefully degrading across hardware and platforms such that you get the best possible experience all the way from a top-end gaming PC + Vive, down to tapping on a link on a simple smartphone.  WebVR is a genuine revolution: suddenly every webapp on the planet can create a virtual world! And frameworks like &lt;a href=&quot;https:&#x2F;&#x2F;aframe.io&#x2F;&quot;&gt;A-Frame&lt;&#x2F;a&gt;, &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;ngokevin&#x2F;aframe-react&quot;&gt;aframe-react&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;facebookincubator.github.io&#x2F;react-vr&#x2F;&quot;&gt;React VR&lt;&#x2F;a&gt; make it incredibly easy and fun to do.&lt;&#x2F;p&gt;
&lt;p&gt;So looking back at our list, the final missing piece is nothing less than a backbone: some kind of data layer to link these apps together.  Right now, &lt;b&gt;all&lt;&#x2F;b&gt; the WebVR apps out there are little islands - each its own isolated walled garden and there is no standard way to provide shared experiences.  There is no standard way for users to communicate between these worlds (or between the VR and non-VR web) - be that by messaging, VoIP, Video or even VR interactions.  There is no standard way to define an avatar, its location and movement within a world, or how it might travel between worlds.  And finally, there is no standard way to describe the world&#x27;s state in general: each webapp is free to manage its scene and its content any way it likes; there is nowhere to expose the realtime scene-graph of the world such that other avatars, bots, apps, services etc. can interact with it. The same way there is no standard way to exchange messages or reuse a user profile between messaging apps today: if the cyberspace is taking shape as we speak, it is definitely not taking the path of openness. At least not yet.&lt;&#x2F;p&gt;
&lt;p&gt;Predictably enough, it&#x27;s this last point of the &#x27;missing data layer for cyberspace&#x27; which we&#x27;ve been thinking about with Matrix: an open, neutral, decentralised meta-network powering or connecting these worlds.  To start with, we&#x27;ve made Matrix available as a generic communications layer for VR, taking WebVR (via A-Frame) and combining it with &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&quot;&gt;matrix-js-sdk, &lt;&#x2F;a&gt;as an open, secure and decentralised way to place voip calls, video calls and instant messaging both within and between WebVR apps and the rest of the existing Matrix ecosystem (e.g. apps like Riot).&lt;&#x2F;p&gt;
&lt;p&gt;In fact, the best way is to test it live: we&#x27;ve put together a quick demo at &lt;a href=&quot;&#x2F;vrdemo&quot;&gt;https:&#x2F;&#x2F;matrix.org&#x2F;vrdemo&lt;&#x2F;a&gt; to show it off, so please &lt;a href=&quot;&#x2F;vrdemo&quot;&gt;give it a go!&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;vrdemo&quot;&gt;&lt;img class=&quot;aligncenter size-large wp-image-2424&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2017&#x2F;04&#x2F;table-1024x333.jpg&quot; alt=&quot;&quot; width=&quot;1024&quot; height=&quot;333&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;&#x2F;vrdemo&quot;&gt;In the demo&lt;&#x2F;a&gt; you get:&lt;&#x2F;p&gt;
&lt;ol&gt;
 	&lt;li&gt; a virtual lobby, providing a 1:1 WebRTC video call via Matrix through to a ‘guide&#x27; user of your choice anywhere else in Matrix (VR or not).  From the lobby you can jump into two other apps:&lt;&#x2F;li&gt;
 	&lt;li&gt; a video conference, calling between all the participants of a given Matrix room in VR (no interop yet with other Matrix apps)&lt;&#x2F;li&gt;
 	&lt;li&gt; a &#x27;virtual tourism&#x27; example, featuring a 1:1 WebRTC video call with a guide, superimposed over the top of the user going skiing through 360 degree video footage.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
Video calling requires a WebRTC-capable browser (Chrome or Firefox). Unfortunately no iOS browsers support it yet. If you have dedicated VR hardware (Vive or Rift), you&#x27;ll have to configure your browser appropriately to use the demo - see &lt;a href=&quot;https:&#x2F;&#x2F;webvr.rocks&quot;&gt;https:&#x2F;&#x2F;webvr.rocks&lt;&#x2F;a&gt; for the latest details.
&lt;p&gt;Needless to say, the demo&#x27;s open sourced under the Apache License like all things Matrix - you can check out the code from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-vr-demo&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-vr-demo&lt;&#x2F;a&gt;.  Huge kudos to Richard Lewis, Rob Swain and Ben Lewis for building this out - and to Aidan Taub and Tom Elliott for providing the 360 degree video footage!&lt;&#x2F;p&gt;
&lt;p&gt;The demo is quite high-bandwidth and hardware intensive, so here&#x27;s a video of it in action, just in case:&lt;&#x2F;p&gt;
&lt;iframe src=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;nk0nMlVXkbk&quot; width=&quot;560&quot; height=&quot;315&quot; frameBorder=&quot;0&quot; allowFullScreen=&quot;allowfullscreen&quot;&gt;&lt;&#x2F;iframe&gt;
&lt;p&gt;Now, it&#x27;s important to understand that here we&#x27;re using Matrix as a standard communications API for VR, but we&#x27;re not using Matrix to store any VR world data (yet).  The demo uses plain A-Frame via aframe-react to render its world: we are not providing an API which exposes the world itself onto the network for folks to interact with and extend.  This is because Matrix is currently optimised for storing and synchronising two types of data structure: decentralised timelines of conversation data, and arbitrary decentralised key-value data (e.g. room names, membership, topics).&lt;&#x2F;p&gt;
&lt;p&gt;However, the job of storing arbitrary world data requires storing and flexibly querying it as an object graph of some kind - e.g. as a scene graph hierarchy.  Doing this efficiently whilst supporting Matrix&#x27;s decentralised eventual consistency model is tantamount to evolving Matrix into being a generic decentralised object-graph database (whilst upholding the constraints of that virtual world).  This is tractable, but it&#x27;s a bunch more work than just supporting the eventually-consistent timeline &amp;amp; key-value store we have today.  It&#x27;s something we&#x27;re thinking about though. :)&lt;&#x2F;p&gt;
&lt;p&gt;Also, Matrix is currently not super low-latency - on a typical busy Synapse deployment event transmission between clients has a latency of 50-200ms (ignoring network).  This is fine for instant messaging and setting up VoIP calls etc, but useless for publishing the realtime state of a virtual world: having to wait 200ms to be told that something happened in an interactive virtual world would be a terrible experience.  However, there are various fixes we can do here: Matrix itself is getting faster; Dendrite is expected to be one or two orders of magnitude faster than Synapse.  We could also use Matrix simply as a signalling layer in order to negotiate a lower latency realtime protocol to describe world data updates (much as we use Matrix as a signalling layer for setting up RTP streams for VoIP calls or MIDI sessions).&lt;&#x2F;p&gt;
&lt;p&gt;Finally, you need somewhere to store the world assets themselves (textures, sounds, Collada or GLTF assets, etc).  This is no different to using attachments in Matrix today - this could be as plain HTTP, or via the Matrix decentralised content store (mxc:&#x2F;&#x2F; URLs), or via something like IPFS.&lt;&#x2F;p&gt;
&lt;p&gt;This said, it&#x27;s only a matter of time before someone starts storing world data itself in Matrix.  We have more work to do before it&#x27;s a tight fit, but this has always been one of the long-term goals of the project and we&#x27;re going to do everything we can to support it well.&lt;&#x2F;p&gt;
&lt;p&gt;So: this is the future we&#x27;re thinking of.  Obviously work on today&#x27;s Matrix servers, clients, spec &amp;amp; bridges is our focus and priority right now and we lots of work left there - but the longer term plan is critical too.  Communication in VR is pretty much a blank canvas right now, and Matrix can be &lt;em&gt;the&lt;&#x2F;em&gt; connecting fabric for it - which is unbelievably exciting.  Right now our demo is just a PoC - we&#x27;d encourage all devs reading this to have a think about how to extend it, and how we all can build together the new frontier of cyberspace!&lt;&#x2F;p&gt;
&lt;p&gt;Finally, if you&#x27;re interested in chatting more about VR on Matrix, come hang out over at &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#vr:matrix.org&quot;&gt;#vr:matrix.org&lt;&#x2F;a&gt;!&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Matthew, Amandine &amp;amp; the Matrix team&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;blockquote&gt;
&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Amandine grins at the future in the newest skunkworks zone of the London &lt;a href=&quot;https:&#x2F;&#x2F;t.co&#x2F;y2YCHNIbgU&quot;&gt;https:&#x2F;&#x2F;t.co&#x2F;y2YCHNIbgU&lt;&#x2F;a&gt; HQ... :&amp;gt; :D 😈 &lt;a href=&quot;https:&#x2F;&#x2F;t.co&#x2F;K5xBz7U9o2&quot;&gt;pic.twitter.com&#x2F;K5xBz7U9o2&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;&amp;mdash; Matrix (@matrixdotorg) &lt;a href=&quot;https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg&#x2F;status&#x2F;843181984448991232?ref_src=twsrc%5Etfw&quot;&gt;March 18, 2017&lt;&#x2F;a&gt;
&lt;&#x2F;blockquote&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Dendrite receives its first messages!!!</title>
		<published>2017-03-15T00:00:00+00:00</published>
		<updated>2017-03-15T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/03/15/dendrite-receives-its-first-messages/" type="text/html"/>
		<id>/blog/2017/03/15/dendrite-receives-its-first-messages/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;We hit a major milestone today on &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;dendrite&quot;&gt;Dendrite&lt;&#x2F;a&gt;, our next-generation golang homeserver: &lt;b&gt;Dendrite received its first messages!!&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Before you get too excited, please understand that Dendrite is still a pre-alpha work in progress - whilst we successfully created some rooms on an instance and sent a bunch of messages into them via the Client-Server API, most other functionality (e.g. receiving messages via &#x2F;sync, logging in, registering, federation etc) is yet to exist. &lt;b&gt;It cannot yet be used as a homeserver&lt;&#x2F;b&gt;.  However, this is still a huge step in the right direction, as it demonstrates the core DAG functionality of Matrix is intact, and the beginnings of a usable Client-Server API are hooked up.&lt;&#x2F;p&gt;
&lt;p&gt;The architecture of Dendrite is genuinely interesting - please check out the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;dendrite&#x2F;blob&#x2F;master&#x2F;WIRING.md&quot;&gt;wiring diagram&lt;&#x2F;a&gt; if you haven&#x27;t already.  The idea is that the server is broken down into a series of components which process streams of data stored in Kafka-style append-only logs.  Each component scales horizontally (you can have as many as required to handle load), which is an enormous win over Synapse&#x27;s monolithic design.  Each component is also decoupled from each other by the logs, letting them run on entirely different machines as required.  Please note that whilst the initial implementation is using Kafka for convenience, the actual append-only log mechanism is abstracted away - in future we expect to see configurations of Dendrite which operate entirely from within a single go executable (using go channels as the log mechanism), as well as alternatives to Kafka for distributed solutions.&lt;&#x2F;p&gt;
&lt;p&gt;The components which have taken form so far are the central &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;dendrite&#x2F;tree&#x2F;master&#x2F;src&#x2F;github.com&#x2F;matrix-org&#x2F;dendrite&#x2F;roomserver&quot;&gt;roomserver&lt;&#x2F;a&gt; service, which is responsible (as the name suggests) for maintaining the state and integrity of one or more rooms - authorizing events into the room DAG; storing them in postgres, tracking the auth chain of events where needed; etc.  Much of the core matrix DAG logic of the roomserver is provided by &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;gomatrixserverlib&quot;&gt;gomatrixserverlib&lt;&#x2F;a&gt;.  The roomserver receives events sent by users via the &#x27;client room send&#x27; component (and &#x27;federation backfill&#x27; component, when that exists).  The &#x27;client room send&#x27; component (and in future also &#x27;client sync&#x27;) is provided by the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;dendrite&#x2F;tree&#x2F;master&#x2F;src&#x2F;github.com&#x2F;matrix-org&#x2F;dendrite&#x2F;clientapi&quot;&gt;clientapi&lt;&#x2F;a&gt; service - which is what as of today is successfully creating rooms and events and relaying them to the roomserver!&lt;&#x2F;p&gt;
&lt;p&gt;The actual events we&#x27;ve been testing with are the history of the Matrix Core room: around 10k events.  Right now the roomserver (and the postgres DB that backs it) are the main bottleneck in the pipeline rather than clientapi, so it&#x27;s been interesting to see how rapidly the roomserver can consume its log of events.  As of today&#x27;s benchmark, on a generic dev workstation and an entirely unoptimised roomserver (i.e. no caching whatsoever) running on a single core, we&#x27;re seeing it ingest the room history at over &lt;b&gt;350 events per second&lt;&#x2F;b&gt;.  The vast majority of this work is going into encoding&#x2F;decoding JSON or waiting for postgres: with a simple event cache to avoid repeatedly hitting the DB for every auth and state event, we expect this to increase significantly.  And then as we increase the number of cores, kafka partitions and roomserver instances it should scale fairly arbitrarily(!)&lt;&#x2F;p&gt;
&lt;p&gt;For context, the main synapse process for Matrix.org currently maxes out persisting events at around 15 and 20 per second (although it is also spending a bunch of time relaying events to the various worker processes, and other miscellanies).  As such, an initial benchmark for Dendrite of 350 msgs&#x2F;s really does look incredibly promising.&lt;&#x2F;p&gt;
&lt;p&gt;You may be wondering where this leaves Synapse?  Well, a major driver for implementing Dendrite has been to support the growth of the main matrix.org server, which currently persists around 10 events&#x2F;s (whilst emitting around 1500 events&#x2F;s).  We have exhausted most of the low-hanging fruit for optimising Synapse, and have got to point where the architectural fixes required are of similar shape and size to the work going into Dendrite.  So, whilst Synapse is going to be around for a while yet, we&#x27;re putting the majority of our long-term plans into Dendrite, with a distinct degree of urgency as we race against the ever-increasing traffic levels on the Matrix.org server!&lt;&#x2F;p&gt;
&lt;p&gt;Finally, you may be wondering what happened to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;dendron&quot;&gt;Dendron&lt;&#x2F;a&gt;, our original experiment in Golang servers.  Well: Dendron was an attempt at a &lt;a href=&quot;https:&#x2F;&#x2F;www.martinfowler.com&#x2F;bliki&#x2F;StranglerApplication.html&quot;&gt;strangler pattern&lt;&#x2F;a&gt; rewrite of Synapse, acting as an shim in front of Synapse which could gradually swap out endpoints with their golang implementations.  In practice, the operational complexity it introduced, as well as the amount of room for improvement (at the time) we had in Synapse, and the relatively tight coupling to Synapse&#x27;s existing architecture, storage &amp;amp; schema, meant that it was far from a clear win - and effectively served as an excuse to learn Go.  As such, we&#x27;ve finally formally killed it off as of last week - Matrix.org is now running behind a normal haproxy, and Dendron is dead.  Meanwhile, Dendrite (aka Dendron done Right ;) is very much alive, progressing fast, free from the shackles of Synapse.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ll try to keep the blog updated with progress on Dendrite as it continues to grow!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>How do I bridge thee?  Let me count the ways...</title>
		<published>2017-03-11T00:00:00+00:00</published>
		<updated>2017-03-11T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/03/11/how-do-i-bridge-thee-let-me-count-the-ways/" type="text/html"/>
		<id>/blog/2017/03/11/how-do-i-bridge-thee-let-me-count-the-ways/</id>
		<content type="html">&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;xkcd.com&#x2F;1810&quot;&gt;&lt;img class=&quot;aligncenter wp-image-2297&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2017&#x2F;03&#x2F;xkcd1810-matrixified-v2-1024x842.png&quot; width=&quot;753&quot; height=&quot;619&quot; &#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;p id=&quot;types-of-bridging&quot;&gt;Bridges come in many flavours, and we need consistent terminology within the Matrix community to ensure everyone (users, developers, core team) is on the same page. This post is primarily intended for bridge developers to refer to when building bridges.&lt;&#x2F;p&gt;
&lt;em&gt;The most recent version of this document is &lt;a href=&quot;&#x2F;docs&#x2F;guides&#x2F;types-of-bridging.html&quot;&gt;here&lt;&#x2F;a&gt; (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;blob&#x2F;master&#x2F;supporting-docs&#x2F;guides&#x2F;2017-03-11-types-of-bridging.md&quot;&gt;source&lt;&#x2F;a&gt;) but we&#x27;re also posting it as a blog post for visibility.&lt;&#x2F;em&gt;
&lt;h3 id=&quot;types-of-rooms&quot;&gt;Types of rooms&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;portal-rooms&quot;&gt;Portal rooms&lt;&#x2F;h4&gt;
&lt;p&gt;Bridges can register themselves as controlling chunks of room aliases namespace, letting Matrix users join remote rooms transparently if they &lt;code&gt;&#x2F;join #freenode_#wherever:matrix.org&lt;&#x2F;code&gt; or similar. The resulting Matrix room is typically automatically bridged to the single target remote room. Access control for Matrix users is typically managed by the remote network&#x27;s side of the room. This is called a portal room, and is useful for jumping into remote rooms without any configuration needed whatsoever - using Matrix as a ‘bouncer&#x27; for the remote network.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;plumbed-rooms&quot;&gt;Plumbed rooms&lt;&#x2F;h4&gt;
&lt;p&gt;Alternatively, an existing Matrix room can be can plumbed into one or more specific remote rooms by configuring a bridge (which can be run by anyone). For instance, #matrix:matrix.org is plumbed into #matrix on Freenode, matrixdotorg&#x2F;#matrix on Slack, etc. Access control for Matrix users is necessarily managed by the Matrix side of the room. This is useful for using Matrix to link together different communities.&lt;&#x2F;p&gt;
&lt;p&gt;Migrating rooms between a portal &amp;amp; plumbed room is currently a bit of a mess, as there&#x27;s not yet a way for users to remove portal rooms once they&#x27;re created, so you can end up with a mix of portal &amp;amp; plumbed users bridged into a room, which looks weird from both the Matrix and non-Matrix viewpoints. https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;issues&#x2F;387 tracks this.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;types-of-bridges-simplest-first&quot;&gt;Types of bridges (simplest first):&lt;&#x2F;h3&gt;
&lt;h4 id=&quot;bridgebot-based-bridges&quot;&gt;Bridgebot-based bridges&lt;&#x2F;h4&gt;
&lt;p&gt;The simplest way to exchange messages with a remote network is to have the bridge log into the network using one or more predefined users called bridge bots - typically called MatrixBridge or MatrixBridge[123] etc. These relay traffic on behalf of the users on the other side, but it&#x27;s a terrible experience as all the metadata about the messages and senders is lost. This is how the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;SijmenSchoon&#x2F;telematrix&quot;&gt;telematrix&lt;&#x2F;a&gt; matrix&amp;lt;-&amp;gt;telegram bridge currently works.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;bot-api-aka-virtual-user-based-bridges&quot;&gt;Bot-API (aka Virtual user) based bridges&lt;&#x2F;h4&gt;
&lt;p&gt;Some remote systems support the idea of injecting messages from ‘fake&#x27; or ‘virtual&#x27; users, which can be used to represent the Matrix-side users as unique entities in the remote network. For instance, Slack&#x27;s inbound webhooks lets remote bots be created on demand, letting Matrix users be shown cosmetically correctly in the timeline as virtual users. However, the resulting virtual users aren&#x27;t real users on the remote system, so don&#x27;t have presence&#x2F;profile and can&#x27;t be tab-completed or direct-messaged etc. They also have no way to receive typing notifs or other richer info which may not be available via bot APIs. This is how the current &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-slack&quot;&gt;matrix-appservice-slack&lt;&#x2F;a&gt; bridge works.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;simple-puppeted-bridge&quot;&gt;Simple puppeted bridge&lt;&#x2F;h4&gt;
&lt;p&gt;This is a richer form of bridging, where the bridge logs into the remote service as if it were a real 3rd party client for that service. As a result, the Matrix user has to already have a valid account on the remote system. In exchange, the Matrix user ‘puppets&#x27; their remote user, such that other users on the remote system aren&#x27;t even aware they are speaking to a user via Matrix. The full semantics of the remote system are available to the bridge to expose into Matrix. However, the bridge has to handle the authentication process to log the user into the remote bridge.&lt;&#x2F;p&gt;
&lt;p&gt;This is essentially how the current &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&quot;&gt;matrix-appservice-irc&lt;&#x2F;a&gt; bridge works (if you configure it to log into the remote IRC network as your ‘real&#x27; IRC nickname). &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-gitter&quot;&gt;matrix-appservice-gitter&lt;&#x2F;a&gt; is being extended to support both puppeted and bridgebot-based operation. It&#x27;s how the experimental &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-tg&quot;&gt;matrix-appservice-tg&lt;&#x2F;a&gt; bridge works.&lt;&#x2F;p&gt;
&lt;p&gt;Going forwards we&#x27;re aiming for all bridges to be at least simple puppeted, if not double-puppeted.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;double-puppeted-bridge&quot;&gt;Double-puppeted bridge&lt;&#x2F;h4&gt;
&lt;p&gt;A simple ‘puppeted bridge&#x27; allows the Matrix user to control their account on their remote network. However, ideally this puppeting should work in both directions, so if the user logs into (say) their native telegram client and starts conversations, sends messages etc, these should be reflected back into Matrix as if the user had done them there. This requires the bridge to be able to puppet the Matrix side of the bridge on behalf of the user.&lt;&#x2F;p&gt;
&lt;p&gt;This is the holy-grail of bridging; &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-hacks&#x2F;matrix-puppet-bridge&quot;&gt;matrix-puppet-bridge&lt;&#x2F;a&gt; is a community project that tries to facilitate development of double puppeted bridges, having done so for &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-hacks&#x2F;matrix-puppet-bridge#examples&quot;&gt;several networks&lt;&#x2F;a&gt;. The main obstacle is working out an elegant way of having the bridge auth with Matrix as the matrix user (which requires some kind of scoped access_token delegation).&lt;&#x2F;p&gt;
&lt;h4 id=&quot;server-to-server-bridging&quot;&gt;Server-to-server bridging&lt;&#x2F;h4&gt;
&lt;p&gt;Some remote protocols (IRC, XMPP, SIP, SMTP, NNTP, GnuSocial etc) support federation - either open or closed. The most elegant way of bridging to these protocols would be to have the bridge participate in the federation as a server, directly bridging the entire namespace into Matrix.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;re not aware of anyone who&#x27;s done this yet.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;sidecar-bridge&quot;&gt;Sidecar bridge&lt;&#x2F;h4&gt;
&lt;p&gt;Finally: the types of bridging described above assume that you are synchronising the conversation history of the remote system into Matrix, so it may be decentralised and exposed to multiple users within the wider Matrix network.&lt;&#x2F;p&gt;
&lt;p&gt;This can cause problems where the remote system may have arbitrarily complicated permissions (ACLs) controlling access to the history, which will then need to be correctly synchronised with Matrix&#x27;s ACL model, without introducing security issues such as races. We already see some problems with this on the IRC bridge, where history visibility for +i and +k channels have to be carefully synchronised with the Matrix rooms.&lt;&#x2F;p&gt;
&lt;p&gt;You can also hit problems with other network-specific features not yet having equivalent representation in the Matrix protocol (e.g. ephemeral messages, or op-only messages - although arguably that&#x27;s a type of ACL).&lt;&#x2F;p&gt;
&lt;p&gt;One solution could be to support an entirely different architecture of bridging, where the Matrix client-server API is mapped directly to the remote service, meaning that ACL decisions are delegated to the remote service, and conversations are not exposed into the wider Matrix. This is effectively using the bridge purely as a 3rd party client for the network (similar to Bitlbee). The bridge is only available to a single user, and conversations cannot be shared with other Matrix users as they aren&#x27;t actually Matrix rooms. (Another solution could be to use Active Policy Servers at last as a way of centralising and delegating ACLs for a room)&lt;&#x2F;p&gt;
&lt;p&gt;This is essentially an entirely different product to the rest of Matrix, and whilst it could be a solution for some particularly painful ACL problems, we&#x27;re focusing on non-sidecar bridges for now.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.19 is here, just in time for FOSDEM!</title>
		<published>2017-02-04T00:00:00+00:00</published>
		<updated>2017-02-04T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/02/04/synapse-0-19-is-here-just-in-time-for-fosdem/" type="text/html"/>
		<id>/blog/2017/02/04/synapse-0-19-is-here-just-in-time-for-fosdem/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;re happy to announce the release of Synapse 0.19.0 (same as 0.19.0-rc4) today, just in time for anyone discovering Matrix for the first time at FOSDEM 2017!  In fact, here&#x27;s Erik doing the release right now (with moral support from Luke):&lt;&#x2F;p&gt;
&lt;img class=&quot;aligncenter size-large wp-image-1900&quot; src=&quot;&#x2F;blog&#x2F;wp-content&#x2F;uploads&#x2F;2017&#x2F;02&#x2F;release-1024x768.jpg&quot; alt=&quot;release&quot; width=&quot;1024&quot; height=&quot;768&quot; &#x2F;&gt;
&lt;p&gt;This is a pretty big release, with a bunch of new features and lots and lots of debugging and optimisation work following on some of the dramas that we had with 0.18 over the Christmas break.  The biggest things are:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;IPv6 Support (unless you have an IPv6 only resolver), thanks to contributions from Glyph from Twisted and Kyrias!&lt;&#x2F;li&gt;
 	&lt;li&gt;A new API for tracking the E2E devices present in a room (required for fixing many of the remaining E2E bugs...)&lt;&#x2F;li&gt;
 	&lt;li&gt;Rewrite the &#x27;state resolution&#x27; algorithm to be orders of magnitude more performant&lt;&#x2F;li&gt;
 	&lt;li&gt;Lots of tuning to the caching logic.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
If you&#x27;re already running a server, please upgrade!  And if you&#x27;re not, go grab yourself a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;brand new Synapse&lt;&#x2F;a&gt; from Github. Debian packages will follow shortly (as soon as Erik can figure out the necessary backporting required for Twisted 16.6.0)
&lt;p&gt;And here&#x27;s the full changelog...&lt;&#x2F;p&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-19-0-2017-02-04&quot;&gt;Changes in synapse v0.19.0 (2017-02-04)&lt;&#x2F;h2&gt;
&lt;div class=&quot;markdown-body&quot;&gt;
&lt;p&gt;No changes since RC 4.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-19-0-rc4-2017-02-02&quot;&gt;Changes in synapse v0.19.0-rc4 (2017-02-02)&lt;&#x2F;h2&gt;
&lt;ul&gt;
 	&lt;li&gt;Bump cache sizes for common membership queries (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1879&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1879&quot; data-id=&quot;204961298&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1879&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-19-0-rc3-2017-02-02&quot;&gt;Changes in synapse v0.19.0-rc3 (2017-02-02)&lt;&#x2F;h2&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix email push in pusher worker (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1875&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1875&quot; data-id=&quot;204840617&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1875&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Make presence.get_new_events a bit faster (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1876&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1876&quot; data-id=&quot;204868725&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1876&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Make &#x2F;keys&#x2F;changes a bit more performant (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1877&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1877&quot; data-id=&quot;204905372&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1877&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-19-0-rc2-2017-02-02&quot;&gt;Changes in synapse v0.19.0-rc2 (2017-02-02)&lt;&#x2F;h2&gt;
&lt;ul&gt;
 	&lt;li&gt;Include newly joined users in &#x2F;keys&#x2F;changes API (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1872&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1872&quot; data-id=&quot;204651600&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1872&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-19-0-rc1-2017-02-02&quot;&gt;Changes in synapse v0.19.0-rc1 (2017-02-02)&lt;&#x2F;h2&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add support for specifying multiple bind addresses (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1709&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1709&quot; data-id=&quot;196299310&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1709&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1712&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1712&quot; data-id=&quot;196557084&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1712&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1795&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1795&quot; data-id=&quot;199882750&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1795&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1835&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1835&quot; data-id=&quot;202121261&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1835&lt;&#x2F;a&gt;). Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;kyrias&quot;&gt;@kyrias&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Add &#x2F;account&#x2F;3pid&#x2F;delete endpoint (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1714&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1714&quot; data-id=&quot;196744832&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1714&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add config option to configure the Riot URL used in notification emails (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;Allow configuring the Riot URL used in notification emails&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1811&quot; data-id=&quot;200657367&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1811&lt;&#x2F;a&gt;). Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;aperezdc&quot;&gt;@aperezdc&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Add username and password config options for turn server (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1832&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1832&quot; data-id=&quot;201858252&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1832&lt;&#x2F;a&gt;). Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;xsteadfastx&quot;&gt;@xsteadfastx&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Implement device lists updates over federation (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1857&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1857&quot; data-id=&quot;203413361&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1857&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1861&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1861&quot; data-id=&quot;204067531&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1861&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1864&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1864&quot; data-id=&quot;204251726&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1864&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Implement &#x2F;keys&#x2F;changes (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1869&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1869&quot; data-id=&quot;204547521&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1869&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1872&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1872&quot; data-id=&quot;204651600&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1872&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Improve IPv6 support (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1696&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1696&quot; data-id=&quot;195001361&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1696&lt;&#x2F;a&gt;). Thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;kyrias&quot;&gt;@kyrias&lt;&#x2F;a&gt; and &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;glyph&quot;&gt;@glyph&lt;&#x2F;a&gt;!&lt;&#x2F;li&gt;
 	&lt;li&gt;Log which files we saved attachments to in the media_repository (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1791&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1791&quot; data-id=&quot;199834508&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1791&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Linearize updates to membership via PUT &#x2F;state&#x2F; to better handle multiple joins (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1787&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1787&quot; data-id=&quot;199625078&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1787&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Limit number of entries to prefill from cache on startup (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1792&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1792&quot; data-id=&quot;199837759&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1792&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Remove full_twisted_stacktraces option (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1802&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1802&quot; data-id=&quot;200333064&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1802&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Measure size of some caches by sum of the size of cached values (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1815&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1815&quot; data-id=&quot;201019660&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1815&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Measure metrics of string_cache (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1821&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1821&quot; data-id=&quot;201347397&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1821&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Reduce logging verbosity (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1822&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1822&quot; data-id=&quot;201347914&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1822&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1823&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1823&quot; data-id=&quot;201350918&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1823&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1824&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1824&quot; data-id=&quot;201351456&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1824&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Don&#x27;t clobber a displayname or avatar_url if provided by an m.room.member event (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1852&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1852&quot; data-id=&quot;202898869&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1852&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Better handle 401&#x2F;404 response for federation &#x2F;send&#x2F; (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1866&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1866&quot; data-id=&quot;204298485&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1866&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1871&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1871&quot; data-id=&quot;204619103&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1871&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix ability to change password to a non-ascii one (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1711&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1711&quot; data-id=&quot;196303488&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1711&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix push getting stuck due to looking at the wrong view of state (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1820&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1820&quot; data-id=&quot;201302378&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1820&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix email address comparison to be case insensitive (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1827&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1827&quot; data-id=&quot;201573837&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1827&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix occasional inconsistencies of room membership (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1836&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1836&quot; data-id=&quot;202122666&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1836&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1840&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1840&quot; data-id=&quot;202175956&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1840&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Performance:
&lt;ul&gt;
 	&lt;li&gt;Don&#x27;t block messages sending on bumping presence (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1789&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1789&quot; data-id=&quot;199812171&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1789&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Change device_inbox stream index to include user (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1793&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1793&quot; data-id=&quot;199845292&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1793&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Optimise state resolution (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot; Optimise state resolution&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1818&quot; data-id=&quot;201285644&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1818&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Use DB cache of joined users for presence (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1862&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1862&quot; data-id=&quot;204068613&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1862&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add an index to make membership queries faster (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1867&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1867&quot; data-id=&quot;204327354&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1867&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;div&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Matrix.org homeserver outage (25th Jan 2017)</title>
		<published>2017-01-25T00:00:00+00:00</published>
		<updated>2017-01-25T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/01/25/matrix-org-homeserver-outage-25th-jan-2017/" type="text/html"/>
		<id>/blog/2017/01/25/matrix-org-homeserver-outage-25th-jan-2017/</id>
		<content type="html">&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;As many will have noticed there was a major outage on the Matrix homeserver for matrix.org last night (UK-time).  This impacted anyone with an account on the matrix.org server, as well as anyone using matrix.org-hosted bots &amp;amp; bridges.  As Matrix rooms are shared over all participants, rooms with participants on other servers were unaffected (for users on those servers). Here&#x27;s a quick explanation of what went wrong (times are UTC):&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;2017-01-24 16:00 - We notice that we&#x27;re badly running out of diskspace on the matrix.org backup postgres replica.  (Turns out the backup box, whilst identical hardware to the master, had been built out as RAID-10 rather than RAID-5 and so has less disk space).
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-24 17:00 - We decide to drop a large DB index: &lt;code&gt;event_push_actions(room_id, event_id, user_id, profile_tag)&lt;&#x2F;code&gt;, which was taking up a disproportionate amount of disk space, on the basis that it didn&#x27;t appear to be being used according to the postgres stats.  All seems good.
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-24 ~23:00 - The core matrix.org team go to bed.
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-24 23:33 - Someone redacts an event in a very active room (probably #matrix:matrix.org) which necessitates redacting the associated push notification from the event_push_actions table.  This takes out a lock within persist_event, which is then blocked on deleting the push notification.  It turns out that this deletion requires the missing DB constraint, causing the query to run for hours whilst holding the transaction lock.  The symptoms are that anything reading events from the DB was blocked on the transaction, causing messages not to be relayed to other clients or servers despite appearing to send correctly.  Meanwhile, the fact that events are being received by the server fine (including over federation) makes the monitoring graphs look largely healthy.
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-24 23:35 - End-to-end monitoring detects problems, and sends alerts into pagerduty and various Matrix rooms.  Unfortunately we&#x27;d failed to upgrade the pageduty trial into a paid account a few months ago, however, so the alerts are lost.
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-25 08:00 - Matrix team starts to wake up and spot problems, but confusion over the right escalation process (especially with Matthew on holiday) means folks assume that other members of the team must already be investigating.
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-25 09:00 - Server gets restarted, service starts to resume, although box suffers from load problems as traffic tries to catch up.
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-25 09:45 - Normal service on the homeserver itself is largely resumed (other than bridges; see below)
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-25 10:41 - Root cause established and the redaction path is patched on matrix.org to stop a recurrence.
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-25 11:15 - Bridges are seen to be lagging and taking much longer to recover than expected.   Decision made to let them continue to catch up normally rather than risk further disruption (e.g. IRC join&#x2F;part spam) by restarting them.
&lt;&#x2F;li&gt;&lt;li&gt;2017-01-25 13:00 - All hosted bridges returned to normal.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Obviously this is rather embarrassing, and a huge pain for everyone using the matrix.org homeserver - many apologies indeed for the outage. On the plus side, all the other Matrix homeservers out there carried on without noticing any problems (which actually complicated spotting that things had broken, given many of the core team primarily use their personal homeservers).&lt;&#x2F;p&gt;
&lt;p&gt;In some ways the root cause here is that the core team has been focusing all its energy recently on improving the overall Matrix codebase rather than operational issues on matrix.org itself, and as a result our ops practices have fallen behind (especially as the health of the Matrix ecosystem as a whole is arguably more important than the health of a single homeserver deployment).  However, we clearly need to improve things here given the number of people (&amp;gt;750K at the last count) dependent on the Matrix.org homeserver and its bridges &amp;amp; bots.&lt;&#x2F;p&gt;
&lt;p&gt;Lessons learnt on our side are:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Make sure that even though we had monitoring graphs &amp; thresholds set up on all the right things... monitoring alerts actually have to be routed somewhere useful - i.e. phone calls to the team&#x27;s phones.  Pagerduty is now set up and running properly to this end.&lt;&#x2F;li&gt;
&lt;li&gt;Make sure that people know to wake up the right people anyway if the monitoring alerting system fails.&lt;&#x2F;li&gt;
&lt;li&gt;To be even more paranoid about hotfixes to production at 5pm, especially if they can wait &#x27;til the next day (as this one could have).&lt;&#x2F;li&gt;
&lt;li&gt;To investigate ways to rapidly recover bridges without causing unnecessary disruption.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Apologies again to everyone who was bitten by this - we&#x27;re doing everything we can to ensure it doesn&#x27;t happen again.&lt;&#x2F;p&gt;
&lt;p&gt;Matthew &amp;amp; the team.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.18.7 is out - Please upgrade, especially if on 0.18.5 or 0.18.6.</title>
		<published>2017-01-06T00:00:00+00:00</published>
		<updated>2017-01-06T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2017/01/06/synapse-0-18-6-is-out-please-upgrade-especially-if-on-0-18-5/" type="text/html"/>
		<id>/blog/2017/01/06/synapse-0-18-6-is-out-please-upgrade-especially-if-on-0-18-5/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;&lt;del&gt;TL;DR: Please upgrade to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.18.6&quot;&gt;Synapse 0.18.6&lt;&#x2F;a&gt;, especially if you are on 0.18.5 which is a bad release.&lt;&#x2F;del&gt;&lt;&#x2F;p&gt;
&lt;p&gt;TL;DR: Please upgrade to &lt;strong&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.18.7&quot;&gt;Synapse 0.18.7&lt;&#x2F;a&gt; &lt;&#x2F;strong&gt;- especially if you are on 0.18.5 or 0.18.6 which both have serious federation bugs.&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.18.5 contained a really nasty regression in the federation code which causes servers to echo transactions that they receive back out to the other servers participating in a room. This has effectively resulted in a gradual amplification of federation traffic as more people have installed 0.18.5, causing every transaction to be received N times over where N is the number of servers in the room.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ll do a full write-up once we&#x27;re happy we&#x27;ve tracked down all the root problems here, but the short story is that this hit critical mass around Dec 26, where typical Synapses started to fail to keep up with the traffic - especially when requests hit some of the more inefficient or buggy codepaths in Synapse.  As servers started to overload with inbound connections, this in turn started to slow down and consume resources on the connecting servers - especially due to an architectural mistake in Synapse which blocks inbound connections until the request has been fully processed (which could require the receiving server in turn to make outbound connections), rather than releasing the inbound connection asap.  This hit the point that servers were running out of file descriptors due to all the outbound and inbound connections, at which point they started to entirely tarpit inbound connections, resulting in a slow feedback loop making the whole situation even worse.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ve spent the last two weeks hunting all the individual inefficient requests which were mysteriously starting to cause more problems than they ever had before; then trying to understand the feedback misbehaviour; before finally discovering the regression in 0.18.5 as the plausible root cause of the problem.  Troubleshooting has been complicated by most of the team having unplugged for the holidays, and because this is the first (and hopefully last!) failure mode to be distributed across the whole network, making debugging something of a nightmare - especially when the overloading was triggering a plethora of different exotic failure modes.  Huge thanks to everyone who has shared their server logs with the team to help debug this.&lt;&#x2F;p&gt;
&lt;p&gt;Some of these failure modes are still happening (and we&#x27;re working on fixing them), but we believe that if everyone upgrades away from the bad 0.18.5 release most of the symptoms will go away, or at least go back to being as bad as they were before.  Meanwhile, if you find your server suddenly grinding to a halt after upgrading to &lt;del&gt;0.18.6&lt;&#x2F;del&gt; 0.18.7 please come tell us in &lt;a href=&quot;https:&#x2F;&#x2F;matrix.to&#x2F;#&#x2F;#matrix-dev:matrix.org&quot;&gt;#matrix-dev:matrix.org&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;re enormously sorry if you&#x27;ve been bitten by the federation instability this has caused - and many many thanks for your patience whilst we&#x27;ve hunted it down.  On the plus side, it&#x27;s given us a lot of &lt;em&gt;very&lt;&#x2F;em&gt; useful insight into how to implement federation in future homeservers to not suffer from any of these failure modes.  It&#x27;s also revealed the root cause of why Synapse&#x27;s RAM usage is quite so bad - it turns out that it actually idles at around 200MB with default caching, but there&#x27;s a particular codepath which causes it to spike temporarily by 1GB or so - and that RAM is then not released back to the OS.  We&#x27;re working on a fix for this too, but it&#x27;ll come after 0.18.7.&lt;&#x2F;p&gt;
&lt;p&gt;Unfortunately the original release of 0.18.6 still exhibits the root bug, but 0.18.7 (originally released as 0.18.7-rc2) should finally fix this.  Sorry for all the upgrades :(&lt;&#x2F;p&gt;
&lt;p&gt;So &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;releases&#x2F;tag&#x2F;v0.18.7&quot;&gt;please upgrade as soon as possible&lt;&#x2F;a&gt; to 0.18.7.  &lt;a href=&quot;&#x2F;packages&#x2F;debian&quot;&gt;Debian packages&lt;&#x2F;a&gt; are available as normal.&lt;&#x2F;p&gt;
&lt;p&gt;thanks,&lt;&#x2F;p&gt;
&lt;p&gt;Matthew&lt;&#x2F;p&gt;
&lt;div class=&quot;markdown-body&quot;&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-7-2017-01-09&quot;&gt;Changes in synapse v0.18.7 (2017-01-09)&lt;&#x2F;h3&gt;
&lt;ul&gt;
&lt;li&gt;No changes from v0.18.7-rc2&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-7-rc2-2017-01-07&quot;&gt;Changes in synapse v0.18.7-rc2 (2017-01-07)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix error in rc1&#x27;s discarding invalid inbound traffic logic that was incorrectly discarding missing events
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-7-rc1-2017-01-06&quot;&gt;Changes in synapse v0.18.7-rc1 (2017-01-06)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix error in #PR 1764 to actually fix the nightmare #1753 bug.
&lt;&#x2F;li&gt;
 	&lt;li&gt;Improve deadlock logging further
&lt;&#x2F;li&gt;
 	&lt;li&gt;Discard inbound federation traffic from invalid domains, to immunise 
against #1753
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-6-2017-01-06&quot;&gt;Changes in synapse v0.18.6 (2017-01-06)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix bug when checking if a guest user is allowed to join a room - thanks to Patrik Oldsberg (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;handlers&#x2F;room_member: fix guest access check when joining rooms&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1772&quot; data-id=&quot;199209215&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1772&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-6-rc3-2017-01-05&quot;&gt;Changes in synapse v0.18.6-rc3 (2017-01-05)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix bug where we failed to send ban events to the banned server (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1758&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1758&quot; data-id=&quot;198709898&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1758&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where we sent event that didn&#x27;t originate on this server to other servers (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1764&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1764&quot; data-id=&quot;198934605&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1764&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where processing an event from a remote server took a long time because we were making long HTTP requests (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1765&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1765&quot; data-id=&quot;198940353&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1765&lt;&#x2F;a&gt;, PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1744&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1744&quot; data-id=&quot;198236017&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1744&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Improve logging for debugging deadlocks (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1766&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1766&quot; data-id=&quot;198946790&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1766&lt;&#x2F;a&gt;, PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1767&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1767&quot; data-id=&quot;198958245&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1767&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-6-rc2-2016-12-30&quot;&gt;Changes in synapse v0.18.6-rc2 (2016-12-30)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix memory leak in twisted by initialising logging correctly (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1731&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1731&quot; data-id=&quot;198134635&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1731&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where fetching missing events took an unacceptable amount of time in large rooms (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1734&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1734&quot; data-id=&quot;198178611&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1734&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-6-rc1-2016-12-29&quot;&gt;Changes in synapse v0.18.6-rc1 (2016-12-29)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Make sure that outbound connections are closed (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;Wrap connections in an N minute timeout to ensure they get reaped correctly&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1725&quot; data-id=&quot;197934419&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1725&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;div&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>matrix-appservice-irc 0.7.0 is out!</title>
		<published>2016-12-19T00:00:00+00:00</published>
		<updated>2016-12-19T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2016/12/19/matrix-appservice-irc-0-7-0-is-out/" type="text/html"/>
		<id>/blog/2016/12/19/matrix-appservice-irc-0-7-0-is-out/</id>
		<content type="html">&lt;p&gt;Also, we&#x27;ve just released a major update to the IRC bridge codebase after trialling it on the matrix.org-hosted bridges for the last few days.&lt;&#x2F;p&gt;
&lt;p&gt;The big news is:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;The bridge uses Synapse 0.18.5&#x27;s new APIs for managing the public room list (improving performance a bunch)&lt;&#x2F;li&gt;
 	&lt;li&gt;Much faster startup using the new &#x2F;joined_rooms and &#x2F;joined_members APIs in Synapse 0.18.5&lt;&#x2F;li&gt;
 	&lt;li&gt;The bridge will now remember your NickServ password (encrypted at rest) if you want it to via the &lt;code&gt;!storepass&lt;&#x2F;code&gt; command&lt;&#x2F;li&gt;
 	&lt;li&gt;You can now set arbitrary user modes for IRC clients on connection (to mitigate PM spam etc)&lt;&#x2F;li&gt;
 	&lt;li&gt;After a split, the bridge will drop Matrix-&amp;gt;IRC messages older than N seconds, rather than try to catch the IRC room up on everything they missed on Matrix :S&lt;&#x2F;li&gt;
 	&lt;li&gt;Operational metrics are now implemented using Prometheus rather than statsd&lt;&#x2F;li&gt;
 	&lt;li&gt;New &lt;code&gt;!quit&lt;&#x2F;code&gt; command to nuke your user from the remote IRC network&lt;&#x2F;li&gt;
 	&lt;li&gt;Membership list syncing for IRC-&amp;gt;Matrix is enormously improved, and enabled for all matrix.org-hosted bridges apart from Freenode.  &amp;lt;b&amp;gt;At last, membership lists should be in sync between IRC and Matrix; please let us know if they&#x27;re not&amp;lt;&#x2F;b&amp;gt;.&lt;&#x2F;li&gt;
 	&lt;li&gt;Better error logging&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
For full details, please see &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;blob&#x2F;master&#x2F;CHANGELOG.md&quot;&gt;the changelog&lt;&#x2F;a&gt;.
&lt;p&gt;With things like NickServ-pass storing, !quit support and full bi-directional membership list syncing, it&#x27;s never been a better time to run your own IRC bridge.  Please install or upgrade today from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&lt;&#x2F;a&gt;!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.18.5 released!</title>
		<published>2016-12-19T00:00:00+00:00</published>
		<updated>2016-12-19T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2016/12/19/synapse-0-18-5-released/" type="text/html"/>
		<id>/blog/2016/12/19/synapse-0-18-5-released/</id>
		<content type="html">&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;We released synapse 0.18.5 on Friday.  This is mainly about fixing performance problems with the unread room counts and the public room directory; polishing the E2E endpoints based on beta feedback; and general minor bits and bobs.&lt;&#x2F;p&gt;
&lt;p&gt;Get it whilst it&#x27;s (almost) hot from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt;!  Changelog follows:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-5-2016-12-16&quot;&gt;Changes in synapse v0.18.5 (2016-12-16)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Fix federation &#x2F;backfill returning events it shouldn&#x27;t (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1700&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1700&quot; data-id=&quot;195535459&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1700&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix crash in url preview (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1701&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1701&quot; data-id=&quot;195654621&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1701&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-5-rc3-2016-12-13&quot;&gt;Changes in synapse v0.18.5-rc3 (2016-12-13)&lt;&#x2F;h3&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add support for E2E for guests (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1653&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1653&quot; data-id=&quot;191729740&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1653&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add new API appservice specific public room list (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1676&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1676&quot; data-id=&quot;193810881&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1676&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Add new room membership APIs (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1680&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1680&quot; data-id=&quot;194337450&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1680&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Enable guest access for private rooms by default (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;653&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;653&quot; data-id=&quot;141629328&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#653&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Limit the number of events that can be created on a given room concurrently (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1620&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1620&quot; data-id=&quot;188559220&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1620&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Log the args that we have on UI auth completion (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;Log the args that we have on UI auth completion&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1649&quot; data-id=&quot;191480434&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1649&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Stop generating refresh_tokens (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1654&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1654&quot; data-id=&quot;191730725&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1654&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Stop putting a time caveat on access tokens (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1656&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1656&quot; data-id=&quot;191962876&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1656&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Remove unspecced GET endpoints for e2e keys (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1694&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1694&quot; data-id=&quot;194929277&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1694&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix handling of 500 and 429&#x27;s over federation (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1650&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1650&quot; data-id=&quot;191542366&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1650&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix Content-Type header parsing (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1660&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1660&quot; data-id=&quot;192589052&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1660&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix error when previewing sites that include unicode, thanks to &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;kyrias&quot;&gt;@kyrias&lt;&#x2F;a&gt; (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1664&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1664&quot; data-id=&quot;192830301&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1664&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix some cases where we drop read receipts (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1678&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1678&quot; data-id=&quot;194321090&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1678&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where calls to &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; didn&#x27;t correctly timeout (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1683&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1683&quot; data-id=&quot;194627488&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1683&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug where E2E key query would fail if a single remote host failed (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1686&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1686&quot; data-id=&quot;194665373&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1686&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-5-rc2-2016-11-24&quot;&gt;Changes in synapse v0.18.5-rc2 (2016-11-24)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Don&#x27;t send old events over federation, fixes bug in -rc1.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-5-rc1-2016-11-24&quot;&gt;Changes in synapse v0.18.5-rc1 (2016-11-24)&lt;&#x2F;h3&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Implement &quot;event_fields&quot; in filters (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1638&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1638&quot; data-id=&quot;190978482&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1638&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
 	&lt;li&gt;Use external ldap auth package (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1628&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1628&quot; data-id=&quot;189389095&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1628&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Split out federation transaction sending to a worker (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1635&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1635&quot; data-id=&quot;190696205&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1635&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fail with a coherent error message if &lt;code&gt;&#x2F;sync?filter=&lt;&#x2F;code&gt; is invalid (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1636&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1636&quot; data-id=&quot;190714631&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1636&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;More efficient notif count queries (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1644&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1644&quot; data-id=&quot;191311986&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1644&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.18.4</title>
		<published>2016-11-22T00:00:00+00:00</published>
		<updated>2016-11-22T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2016/11/22/synapse-0-18-4/" type="text/html"/>
		<id>/blog/2016/11/22/synapse-0-18-4/</id>
		<content type="html">&lt;p&gt;Uncharacteristically, we&#x27;re actually remembering to announce a new release of Synapse!&lt;&#x2F;p&gt;
&lt;p&gt;Major performance fixes on federation, as well as the changes required to support E2E encrypted attachments (yay!)&lt;&#x2F;p&gt;
&lt;p&gt;Please install or upgrade from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; :)&lt;&#x2F;p&gt;
&lt;div class=&quot;markdown-body&quot;&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-4-2016-11-22&quot;&gt;Changes in synapse v0.18.4 (2016-11-22)&lt;&#x2F;h3&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Add workaround for buggy clients that the fail to register (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1632&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1632&quot; data-id=&quot;190371942&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1632&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-18-4-rc1-2016-11-14&quot;&gt;Changes in synapse v0.18.4-rc1 (2016-11-14)&lt;&#x2F;h3&gt;
&lt;p&gt;Changes:&lt;&#x2F;p&gt;
&lt;ul&gt;
 	&lt;li&gt;Various database efficiency improvements (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1188&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1188&quot; data-id=&quot;186341262&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1188&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1192&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1192&quot; data-id=&quot;187084488&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1192&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Update default config to blacklist more internal IPs, thanks to Euan Kemp &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;euank&quot;&gt;@euank&lt;&#x2F;a&gt; (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1198&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1198&quot; data-id=&quot;187605325&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1198&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Allow specifying duration in minutes in config, thanks to Daniel Dent &lt;a class=&quot;user-mention&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;DanielDent&quot;&gt;@DanielDent&lt;&#x2F;a&gt; (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1625&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1625&quot; data-id=&quot;188899917&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1625&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
 	&lt;li&gt;Fix media repo to set CORs headers on responses (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1190&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1190&quot; data-id=&quot;186776121&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1190&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix registration to not error on non-ascii passwords (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1191&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1191&quot; data-id=&quot;187025542&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1191&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix create event code to limit the number of prev_events (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1615&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1615&quot; data-id=&quot;187962678&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1615&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
 	&lt;li&gt;Fix bug in transaction ID deduplication (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;1624&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;1624&quot; data-id=&quot;188782596&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#1624&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;div&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Matrix-IRC Bridge reaches v0.4.0</title>
		<published>2016-08-15T00:00:00+00:00</published>
		<updated>2016-08-15T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2016/08/15/matrix-irc-bridge-reaches-v0-4-0/" type="text/html"/>
		<id>/blog/2016/08/15/matrix-irc-bridge-reaches-v0-4-0/</id>
		<content type="html">&lt;p&gt;A new version of the IRC bridge has been released onto NPM and the matrix.org bridges!&lt;&#x2F;p&gt;
&lt;p&gt;The IRC bridge has undergone quite a number of modifications since its &lt;a href=&quot;&#x2F;blog&#x2F;2015&#x2F;04&#x2F;22&#x2F;matrix-irc-application-service&#x2F;&quot;&gt;original inception&lt;&#x2F;a&gt; over a year ago. Version 0.4 introduces a number of additional features and improvements, which can be found in the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;blob&#x2F;master&#x2F;CHANGELOG.md&quot;&gt;changelog&lt;&#x2F;a&gt;. These include automatically linkifying large blocks of text and mirroring kicks&#x2F;bans to and from Matrix.&lt;&#x2F;p&gt;
&lt;p&gt;With a plethora of protocol gotchas and non-standard features on well-known IRC networks, IRC is a challenging protocol to work with. It&#x27;s inevitable that some corner cases are not handled well by the bridge. Over time, the bridge has been hardened by edge cases which we have encountered and patched. These releases signify the continual improvement in the robustness of the bridge, which we aim to continue with into the foreseeable future.&lt;&#x2F;p&gt;
&lt;p&gt;Performance wise, our busiest bridge which we host is the bridge to &lt;a href=&quot;http:&#x2F;&#x2F;freenode.net&#x2F;&quot;&gt;Freenode&lt;&#x2F;a&gt;. We now have over 1300 active connections to it and have a steady rate of about 240 messages per minute going through to Matrix. We expect to see this number increase significantly over the next few months. Let&#x27;s see what the next year will bring!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.14 is released!</title>
		<published>2016-03-30T00:00:00+00:00</published>
		<updated>2016-03-30T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2016/03/30/synapse-0-14-is-released/" type="text/html"/>
		<id>/blog/2016/03/30/synapse-0-14-is-released/</id>
		<content type="html">&lt;p&gt;We just released Synapse 0.14.0 - a major update which incorporates lots of work on making Synapse more RAM efficient. There&#x27;s still a lot of room for further improvements, but the main headlines are reducing the resident memory footprint dramatically by interning strings and deduplicating events across the many different caches. It also adds a much-needed &lt;code&gt;SYNAPSE_CACHE_FACTOR&lt;&#x2F;code&gt; environment variable that can be used to globally decrease or increase the sizing of all of Synapse&#x27;s various caches (with an associated slow-down or speed-up in performance). Quite how improved the new memory footprint seems to very much depend on your own use case, but it&#x27;s certainly a step in the right direction.&lt;&#x2F;p&gt;
&lt;p&gt;For more details on recent Synapse performance work (and a general state of the union for the whole Matrix ecosystem), check out &lt;a href=&quot;&#x2F;blog&#x2F;2016&#x2F;03&#x2F;26&#x2F;the-matrix-spring-special&#x2F;&quot;&gt;our Spring update&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Get all new synapse from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; - we recommend upgrading (or installing!) asap :)&lt;&#x2F;p&gt;
&lt;p&gt;Full changelog follows:&lt;&#x2F;p&gt;
&lt;div class=&quot;markdown-body&quot;&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-14-0-2016-03-30&quot;&gt;Changes in synapse v0.14.0 (2016-03-30)&lt;&#x2F;h2&gt;
&lt;p&gt;No changes from v0.14.0-rc2&lt;&#x2F;p&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-14-0-rc2-2016-03-23&quot;&gt;Changes in synapse v0.14.0-rc2 (2016-03-23)&lt;&#x2F;h2&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
	&lt;li&gt;Add published room list API (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;657&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;657&quot; data-id=&quot;142376806&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#657&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
	&lt;li&gt;Change various caches to consume less memory (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;656&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;656&quot; data-id=&quot;141883503&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#656&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;658&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;658&quot; data-id=&quot;142428334&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#658&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;660&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;660&quot; data-id=&quot;142630190&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#660&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;662&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;662&quot; data-id=&quot;142908266&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#662&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;663&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;663&quot; data-id=&quot;142922725&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#663&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;665&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;665&quot; data-id=&quot;142938097&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#665&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Allow rooms to be published without requiring an alias (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;664&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;664&quot; data-id=&quot;142929970&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#664&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Intern common strings in caches to reduce memory footprint (&lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;666&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;666&quot; data-id=&quot;143009852&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#666&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
	&lt;li&gt;Fix reject invites over federation (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;Persist rejection of invites over federation&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;646&quot; data-id=&quot;140973458&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#646&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Fix bug where registration was not idempotent (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;649&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;649&quot; data-id=&quot;141252178&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#649&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Update aliases event after deleting aliases (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;Update aliases event after deletion&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;652&quot; data-id=&quot;141592232&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#652&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Fix unread notification count, which was sometimes wrong (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;661&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;661&quot; data-id=&quot;142657556&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#661&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;changes-in-synapse-v0-14-0-rc1-2016-03-14&quot;&gt;Changes in synapse v0.14.0-rc1 (2016-03-14)&lt;&#x2F;h2&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
	&lt;li&gt;Add event_id to response to state event PUT (PR &lt;a class=&quot;issue-link js-issue-link&quot; title=&quot;client&#x2F;v1&#x2F;room: include event_id in response to state event PUT&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;581&quot; data-id=&quot;134248706&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#581&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Allow guest users access to messages in rooms they have joined (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;587&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;587&quot; data-id=&quot;134846121&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#587&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Add config for what state is included in a room invite (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;598&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;598&quot; data-id=&quot;135736142&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#598&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Send the inviter&#x27;s member event in room invite state (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;607&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;607&quot; data-id=&quot;136466943&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#607&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Add error codes for malformed&#x2F;bad JSON in &#x2F;login (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;608&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;608&quot; data-id=&quot;136642285&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#608&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Add support for changing the actions for default rules (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;609&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;609&quot; data-id=&quot;136680904&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#609&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Add environment variable SYNAPSE_CACHE_FACTOR, default it to 0.1 (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;612&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;612&quot; data-id=&quot;137568719&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#612&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Add ability for alias creators to delete aliases (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;614&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;614&quot; data-id=&quot;137594003&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#614&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Add profile information to invites (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;624&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;624&quot; data-id=&quot;138490446&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#624&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Changes:
&lt;ul&gt;
	&lt;li&gt;Enforce user_id exclusivity for AS registrations (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;572&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;572&quot; data-id=&quot;133037977&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#572&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Make adding push rules idempotent (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;587&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;587&quot; data-id=&quot;134846121&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#587&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Improve presence performance (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;582&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;582&quot; data-id=&quot;134315572&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#582&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;586&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;586&quot; data-id=&quot;134829627&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#586&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Change presence semantics for &lt;code&gt;last_active_ago&lt;&#x2F;code&gt; (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;582&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;582&quot; data-id=&quot;134315572&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#582&lt;&#x2F;a&gt;, &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;586&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;586&quot; data-id=&quot;134829627&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#586&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Don&#x27;t allow &lt;code&gt;m.room.create&lt;&#x2F;code&gt; to be changed (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;596&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;596&quot; data-id=&quot;135558604&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#596&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Add 800x600 to default list of valid thumbnail sizes (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;616&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;616&quot; data-id=&quot;137914530&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#616&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Always include kicks and bans in full &#x2F;sync (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;625&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;625&quot; data-id=&quot;138502688&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#625&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Send history visibility on boundary changes (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;626&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;626&quot; data-id=&quot;138524888&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#626&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Register endpoint now returns a refresh_token (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;637&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;637&quot; data-id=&quot;139811456&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#637&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Bug fixes:
&lt;ul&gt;
	&lt;li&gt;Fix bug where we returned incorrect state in &#x2F;sync (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;573&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;573&quot; data-id=&quot;133215098&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#573&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Always return a JSON object from push rule API (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;606&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;606&quot; data-id=&quot;136392145&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#606&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Fix bug where registering without a user id sometimes failed (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;610&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;610&quot; data-id=&quot;137394765&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#610&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Report size of ExpiringCache in cache size metrics (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;611&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;611&quot; data-id=&quot;137537841&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#611&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Fix rejection of invites to empty rooms (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;615&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;615&quot; data-id=&quot;137638777&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#615&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Fix usage of &lt;code&gt;bcrypt&lt;&#x2F;code&gt; to not use &lt;code&gt;checkpw&lt;&#x2F;code&gt; (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;619&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;619&quot; data-id=&quot;137949188&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#619&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Pin &lt;code&gt;pysaml2&lt;&#x2F;code&gt; dependency (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;634&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;634&quot; data-id=&quot;139556355&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#634&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
	&lt;li&gt;Fix bug in &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; where timeline order was incorrect for backfilled events (PR &lt;a class=&quot;issue-link js-issue-link&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;pull&#x2F;635&quot; data-url=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;issues&#x2F;635&quot; data-id=&quot;139635294&quot; data-error-text=&quot;Failed to load issue title&quot; data-permission-text=&quot;Issue title is private&quot;&gt;#635&lt;&#x2F;a&gt;)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;div&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.13 released!</title>
		<published>2016-02-10T00:00:00+00:00</published>
		<updated>2016-02-10T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2016/02/10/synapse-0-13-released/" type="text/html"/>
		<id>/blog/2016/02/10/synapse-0-13-released/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.13 was released this afternoon, bringing a new wave of features, bug fixes and performance fixes.  The main headlines include: huge performance increases (big catchup &#x2F;syncs that were taking 20s now take 0.3s!), support for server-side per-room unread message and notification badge counts, ability for guest accounts to upgrade into fully-fledged accounts, change default push rules back to notifying for group chats, and loads of bug fixes.  This release incorporates what-was 0.12.1-rc1.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;b&gt;Please note that on first launch after upgrading a pre-0.13 server to 0.13 or later, synapse will add a large database index which may take several minutes to complete.  Whilst the index is added the service will be unresponsive.&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Please get the new release from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; and have fun!&lt;&#x2F;p&gt;
&lt;p&gt;Matthew&lt;&#x2F;p&gt;
&lt;p&gt;Full release notes:&lt;&#x2F;p&gt;
&lt;code&gt;
Changes in synapse v0.13.1 (2016-02-10)
=======================================
&lt;ul&gt;
&lt;li&gt;Bump matrix-angular-sdk (matrix web console) dependency to 0.6.8 to
pull in the fix for SYWEB-361 so that the default client can display
HTML messages again(!)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-13-0-2016-02-10&quot;&gt;Changes in synapse v0.13.0 (2016-02-10)&lt;&#x2F;h1&gt;
&lt;p&gt;This version includes an upgrade of the schema, specifically adding an index to
the &lt;code&gt;events&lt;&#x2F;code&gt; table. This may cause synapse to pause for several minutes the
first time it is started after the upgrade.&lt;&#x2F;p&gt;
&lt;p&gt;Changes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Improve general performance (PR #540, #543. #544, #54, #549, #567)&lt;&#x2F;li&gt;
&lt;li&gt;Change guest user ids to be incrementing integers (PR #550)&lt;&#x2F;li&gt;
&lt;li&gt;Improve performance of public room list API (PR #552)&lt;&#x2F;li&gt;
&lt;li&gt;Change profile API to omit keys rather than return null (PR #557)&lt;&#x2F;li&gt;
&lt;li&gt;Add &lt;code&gt;&#x2F;media&#x2F;r0&lt;&#x2F;code&gt; endpoint prefix, which is equivalent to &lt;code&gt;&#x2F;media&#x2F;v1&#x2F;&lt;&#x2F;code&gt;
(PR #595)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug with upgrading guest accounts where it would fail if you opened the
registration email on a different device (PR #547)&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where unread count could be wrong (PR #568)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-12-1-rc1-2016-01-29&quot;&gt;Changes in synapse v0.12.1-rc1 (2016-01-29)&lt;&#x2F;h1&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add unread notification counts in &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; (PR #456)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for inviting 3pids in &lt;code&gt;&#x2F;createRoom&lt;&#x2F;code&gt; (PR #460)&lt;&#x2F;li&gt;
&lt;li&gt;Add ability for guest accounts to upgrade (PR #462)&lt;&#x2F;li&gt;
&lt;li&gt;Add &lt;code&gt;&#x2F;versions&lt;&#x2F;code&gt; API (PR #468)&lt;&#x2F;li&gt;
&lt;li&gt;Add &lt;code&gt;event&lt;&#x2F;code&gt; to &lt;code&gt;&#x2F;context&lt;&#x2F;code&gt; API (PR #492)&lt;&#x2F;li&gt;
&lt;li&gt;Add specific error code for invalid user names in &lt;code&gt;&#x2F;register&lt;&#x2F;code&gt; (PR #499)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for push badge counts (PR #507)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for non-guest users to peek in rooms using &lt;code&gt;&#x2F;events&lt;&#x2F;code&gt; (PR #510)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Changes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Change &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; so that guest users only get rooms they&#x27;ve joined (PR #469)&lt;&#x2F;li&gt;
&lt;li&gt;Change to require unbanning before other membership changes (PR #501)&lt;&#x2F;li&gt;
&lt;li&gt;Change default push rules to notify for all messages (PR #486)&lt;&#x2F;li&gt;
&lt;li&gt;Change default push rules to not notify on membership changes (PR #514)&lt;&#x2F;li&gt;
&lt;li&gt;Change default push rules in one to one rooms to only notify for events that
are messages (PR #529)&lt;&#x2F;li&gt;
&lt;li&gt;Change &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; to reject requests with a &lt;code&gt;from&lt;&#x2F;code&gt; query param (PR #512)&lt;&#x2F;li&gt;
&lt;li&gt;Change server manhole to use SSH rather than telnet (PR #473)&lt;&#x2F;li&gt;
&lt;li&gt;Change server to require AS users to be registered before use (PR #487)&lt;&#x2F;li&gt;
&lt;li&gt;Change server not to start when ASes are invalidly configured (PR #494)&lt;&#x2F;li&gt;
&lt;li&gt;Change server to require ID and &lt;code&gt;as_token&lt;&#x2F;code&gt; to be unique for AS&#x27;s (PR #496)&lt;&#x2F;li&gt;
&lt;li&gt;Change maximum pagination limit to 1000 (PR #497)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug where &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; didn&#x27;t return when something under the leave key
changed (PR #461)&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where we returned smaller rather than larger than requested
thumbnails when &lt;code&gt;method=crop&lt;&#x2F;code&gt; (PR #464)&lt;&#x2F;li&gt;
&lt;li&gt;Fix thumbnails API to only return cropped thumbnails when asking for a
cropped thumbnail (PR #475)&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where we occasionally still logged access tokens (PR #477)&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where &lt;code&gt;&#x2F;events&lt;&#x2F;code&gt; would always return immediately for guest users
(PR #480)&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; unexpectedly returned old left rooms (PR #481)&lt;&#x2F;li&gt;
&lt;li&gt;Fix enabling and disabling push rules (PR #498)&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where &lt;code&gt;&#x2F;register&lt;&#x2F;code&gt; returned 500 when given unicode username
(PR #513)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.12 released!</title>
		<published>2016-01-04T00:00:00+00:00</published>
		<updated>2016-01-04T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2016/01/04/synapse-0-12-released/" type="text/html"/>
		<id>/blog/2016/01/04/synapse-0-12-released/</id>
		<content type="html">&lt;p&gt;Happy 2016 everyone!&lt;&#x2F;p&gt;
&lt;p&gt;To greet the new year, we bring you all new Synapse 0.12. The focus here has been a wide range of polishing, bugfixes, performance improvements and feature tweaks. The biggest news are that the &#x27;v2&#x27; sync APIs are now production ready; the search APIs now work much better; 3rd party ID invites now work; and we now mount the whole client-server API under the &lt;code&gt;&#x2F;_matrix&#x2F;client&#x2F;r0&lt;&#x2F;code&gt; URI prefix, as per the &lt;a href=&quot;&#x2F;docs&#x2F;spec&#x2F;r0.0.0&#x2F;client_server.html&quot;&gt;r0.0.0 release of the Client Server API&lt;&#x2F;a&gt; from a few weeks ago. The &lt;code&gt;r0&lt;&#x2F;code&gt; release unifies what were previously the somewhat confusing mix of &#x27;v1&#x27; and &#x27;v2&#x27; APIs as a single set of endpoints which play nice together.&lt;&#x2F;p&gt;
&lt;p&gt;We highly recommend all homeservers upgrading to v0.12.0 as soon as possible. Get it now from &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;&lt;&#x2F;a&gt; or via our shiny new Debian packages at &lt;a href=&quot;&#x2F;packages&#x2F;debian&#x2F;&quot;&gt;https:&#x2F;&#x2F;matrix.org&#x2F;packages&#x2F;debian&#x2F;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Full changelog follows:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-12-0-2016-01-04&quot;&gt;Changes in synapse v0.12.0 (2016-01-04)&lt;&#x2F;h3&gt;
&lt;ul&gt;
    &lt;li&gt;Expose &lt;code&gt;&#x2F;login&lt;&#x2F;code&gt; under &lt;code&gt;r0&lt;&#x2F;code&gt; (PR #459)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;a name=&quot;user-content-changes-in-synapse-v0-12-0-rc3-2015-12-23&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-12-0-rc3-2015-12-23&quot;&gt;Changes in synapse v0.12.0-rc3 (2015-12-23)&lt;&#x2F;h3&gt;
&lt;ul&gt;
    &lt;li&gt;Allow guest accounts access to &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; (PR #455)&lt;&#x2F;li&gt;
    &lt;li&gt;Allow filters to include&#x2F;exclude rooms at the room level rather than just from the components of the sync for each room. (PR #454)&lt;&#x2F;li&gt;
    &lt;li&gt;Include urls for room avatars in the response to &lt;code&gt;&#x2F;publicRooms&lt;&#x2F;code&gt; (PR #453)&lt;&#x2F;li&gt;
    &lt;li&gt;Don&#x27;t set a identicon as the avatar for a user when they register (PR #450)&lt;&#x2F;li&gt;
    &lt;li&gt;Add a &lt;code&gt;display_name&lt;&#x2F;code&gt; to third-party invites (PR #449)&lt;&#x2F;li&gt;
    &lt;li&gt;Send more information to the identity server for third-party invites so that it can send richer messages to the invitee (PR #446)&lt;&#x2F;li&gt;
    &lt;li&gt;Cache the responses to &lt;code&gt;&#x2F;initialSync&lt;&#x2F;code&gt; for 5 minutes. If a client retries a request to &lt;code&gt;&#x2F;initialSync&lt;&#x2F;code&gt; before the a response was computed to the first request then the same response is used for both requests (PR #457)&lt;&#x2F;li&gt;
    &lt;li&gt;Fix a bug where synapse would always request the signing keys of remote servers even when the key was cached locally (PR #452)&lt;&#x2F;li&gt;
    &lt;li&gt;Fix 500 when pagination search results (PR #447)&lt;&#x2F;li&gt;
    &lt;li&gt;Fix a bug where synapse was leaking raw email address in third-party invites (PR #448)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;a name=&quot;user-content-changes-in-synapse-v0-12-0-rc2-2015-12-14&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-12-0-rc2-2015-12-14&quot;&gt;Changes in synapse v0.12.0-rc2 (2015-12-14)&lt;&#x2F;h3&gt;
&lt;ul&gt;
    &lt;li&gt;Add caches for whether rooms have been forgotten by a user (PR #434)&lt;&#x2F;li&gt;
    &lt;li&gt;Remove instructions to use &lt;code&gt;--process-dependency-link&lt;&#x2F;code&gt; since all of the dependencies of synapse are on PyPI (PR #436)&lt;&#x2F;li&gt;
    &lt;li&gt;Parallelise the processing of &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; requests (PR #437)&lt;&#x2F;li&gt;
    &lt;li&gt;Fix race updating presence in &lt;code&gt;&#x2F;events&lt;&#x2F;code&gt; (PR #444)&lt;&#x2F;li&gt;
    &lt;li&gt;Fix bug back-populating search results (PR #441)&lt;&#x2F;li&gt;
    &lt;li&gt;Fix bug calculating state in &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; requests (PR #442)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;a name=&quot;user-content-changes-in-synapse-v0-12-0-rc1-2015-12-10&quot;&gt;&lt;&#x2F;a&gt;
&lt;h3 id=&quot;changes-in-synapse-v0-12-0-rc1-2015-12-10&quot;&gt;Changes in synapse v0.12.0-rc1 (2015-12-10)&lt;&#x2F;h3&gt;
&lt;ul&gt;
    &lt;li&gt;Host the client APIs released as r0 by &lt;a href=&quot;&#x2F;docs&#x2F;spec&#x2F;r0.0.0&#x2F;client_server.html&quot;&gt;https:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;spec&#x2F;r0.0.0&#x2F;client_server.html&lt;&#x2F;a&gt; on paths prefixed by&lt;code&gt;&#x2F;_matrix&#x2F;client&#x2F;r0&lt;&#x2F;code&gt;. (PR #430, PR #415, PR #400)&lt;&#x2F;li&gt;
    &lt;li&gt;Updates the client APIs to match r0 of the matrix specification.
&lt;ul&gt;
    &lt;li&gt;All APIs return events in the new event format, old APIs also include the fields needed to parse the event using the old format for compatibility. (PR #402)&lt;&#x2F;li&gt;
    &lt;li&gt;Search results are now given as a JSON array rather than a JSON object (PR #405)&lt;&#x2F;li&gt;
    &lt;li&gt;Miscellaneous changes to search (PR #403, PR #406, PR #412)&lt;&#x2F;li&gt;
    &lt;li&gt;Filter JSON objects may now be passed as query parameters to &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; (PR #431)&lt;&#x2F;li&gt;
    &lt;li&gt;Fix implementation of &lt;code&gt;&#x2F;admin&#x2F;whois&lt;&#x2F;code&gt; (PR #418)&lt;&#x2F;li&gt;
    &lt;li&gt;Only include the rooms that user has left in &lt;code&gt;&#x2F;sync&lt;&#x2F;code&gt; if the client requests them in the filter (PR #423)&lt;&#x2F;li&gt;
    &lt;li&gt;Don&#x27;t push for &lt;code&gt;m.room.message&lt;&#x2F;code&gt; by default (PR #411)&lt;&#x2F;li&gt;
    &lt;li&gt;Add API for setting per account user data (PR #392)&lt;&#x2F;li&gt;
    &lt;li&gt;Allow users to forget rooms (PR #385)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
    &lt;li&gt;Performance improvements and monitoring:
&lt;ul&gt;
    &lt;li&gt;Add per-request counters for CPU time spent on the main python thread. (PR #421, PR #420)&lt;&#x2F;li&gt;
    &lt;li&gt;Add per-request counters for time spent in the database (PR #429)&lt;&#x2F;li&gt;
    &lt;li&gt;Make state updates in the C+S API idempotent (PR #416)&lt;&#x2F;li&gt;
    &lt;li&gt;Only fire &lt;code&gt;user_joined_room&lt;&#x2F;code&gt; if the user has actually joined. (PR #410)&lt;&#x2F;li&gt;
    &lt;li&gt;Reuse a single http client, rather than creating new ones (PR #413)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
    &lt;li&gt;Fixed a bug upgrading from older versions of synapse on postgresql (PR #417)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Matrix: One year in.</title>
		<published>2015-09-07T00:00:00+00:00</published>
		<updated>2015-09-07T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/09/07/matrix-one-year-in/" type="text/html"/>
		<id>/blog/2015/09/07/matrix-one-year-in/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Just realised that the release of Synapse 0.10.0 on Sept 3rd 2015 was precisely one year from the &lt;a href=&quot;http:&#x2F;&#x2F;matrix.org&#x2F;blog&#x2F;2014&#x2F;09&#x2F;03&#x2F;welcome-to-the-matrix-blog&#x2F;&quot;&gt;initial launch of Matrix&lt;&#x2F;a&gt;. As such, it feels only right to have a quick update on where we&#x27;ve got to so far, and where we expect things to go from here!&lt;&#x2F;p&gt;
&lt;p&gt;Back at the original launch, all we had was a &lt;em&gt;very&lt;&#x2F;em&gt; rough and ready Synapse homeserver, an early draft of the spec, and precisely one client - the Angular webclient, much of which was mainly written at the last minute on the plane to TechCrunch Disrupt SF (and has never quite recovered :S). From this initial seed it&#x27;s been incredibly exciting and slightly scary to see how much things have advanced and grown - the big headlines for the past year (in roughly chronological order) include:&lt;&#x2F;p&gt;
&lt;ul&gt;
	&lt;li&gt;Making Federation Work:
&lt;ul&gt;
	&lt;li&gt;Switching all of federation over to SSL, using perspectives for key management&lt;&#x2F;li&gt;
	&lt;li&gt;Crypto-signing all the events in a room&#x27;s message graph to assert integrity&lt;&#x2F;li&gt;
	&lt;li&gt;Sorting out &#x27;power levels&#x27; and &#x27;auth events&#x27; to allow totally decentralised kicks&#x2F;bans&#x2F;etc to work in an open federated environment&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
	&lt;li&gt;Decentralised content repository and thumbnailing&lt;&#x2F;li&gt;
	&lt;li&gt;Reference mobile &quot;Matrix Console&quot; clients for iOS and Android&lt;&#x2F;li&gt;
	&lt;li&gt;Official client SDKs for iOS and Android - both at the API wrapping layer and the reusable UI component layer&lt;&#x2F;li&gt;
	&lt;li&gt;Push notifications for APNS and GCM (both on server &amp; clients)&lt;&#x2F;li&gt;
	&lt;li&gt;Official client SDKs for JavaScript, Python and Perl&lt;&#x2F;li&gt;
	&lt;li&gt;Typing notifications&lt;&#x2F;li&gt;
	&lt;li&gt;The sytest integration test harness&lt;&#x2F;li&gt;
	&lt;li&gt;Proper WebRTC support for VoIP, including TURN.&lt;&#x2F;li&gt;
	&lt;li&gt;Application Services and Bots - actually letting Matrix defragment communications :)
&lt;ul&gt;
	&lt;li&gt;Bridging to all of Freenode, Moznet and other IRC networks&lt;&#x2F;li&gt;
	&lt;li&gt;Matrix&amp;lt;-&amp;gt;SMS bridge from OpenMarket&lt;&#x2F;li&gt;
	&lt;li&gt;SIP bridges via FreeSWITCH and Verto&lt;&#x2F;li&gt;
	&lt;li&gt;Parrot Bebop Drone &amp;lt;-&amp;gt; Matrix bridge via Janus&lt;&#x2F;li&gt;
	&lt;li&gt;ODB2 telemetry &amp;lt;-&amp;gt;  Matrix bridge via Android SDK&lt;&#x2F;li&gt;
	&lt;li&gt;Reusable bridging framework in Node&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
	&lt;li&gt;Many iterations and refinements to the spec, including designing v2 of the client SDK&lt;&#x2F;li&gt;
	&lt;li&gt;Switching from Angular to React for all of our web-client development&lt;&#x2F;li&gt;
	&lt;li&gt;Customisable skins and embedding support for the matrix-react-sdk&lt;&#x2F;li&gt;
	&lt;li&gt;End-to-end encryption (not quite formally released yet, but it&#x27;s written, specced and it works!)&lt;&#x2F;li&gt;
	&lt;li&gt;VoIP support on mobile (landed in Android; still experimenting with different WebRTC stacks on iOS)&lt;&#x2F;li&gt;
	&lt;li&gt;History ACLs&lt;&#x2F;li&gt;
	&lt;li&gt;Delivery reports&lt;&#x2F;li&gt;
	&lt;li&gt;Switching from access_tokens to macaroons for authentication (not yet released)&lt;&#x2F;li&gt;
	&lt;li&gt;Lots and lots of performance work on Synapse, as we&#x27;ve tried to get the most out of Twisted.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
...and last but not least, the evolution of the #matrix:matrix.org community - including loads of 3rd party clients, SDKs and application services, synapse packaging and even experimental home servers :)
&lt;p&gt;Overall the last year was an exercise in actually fleshing out the whole ecosystem of Matrix and getting it to a stable usable beta acceptable to early adopters. The plan for the next 12 months is then to make the transition from stable beta to a properly production grade environment that can be used to run large scale services used by normal end-users. In practice, this means:&lt;&#x2F;p&gt;
&lt;ul&gt;
	&lt;li&gt;A major rearchitecture of Synapse.
&lt;ul&gt;
	&lt;li&gt;Synapse currently has no support for horizontal scaling or clustering within a single instance, and many will have seen the performance problems we&#x27;ve hit with a relatively monolithic Twisted app architecture. Profiling deferreds in Twisted has been a particular nightmare.&lt;&#x2F;li&gt;
	&lt;li&gt;During September we are starting the process of splitting Synapse apart into separate services (e.g. separating reading eventstreams from writing messages) both to allow horizontal scalability and to experiment with implementing the services in more efficient languages than Python&#x2F;Twisted.&lt;&#x2F;li&gt;
	&lt;li&gt;We will continue the normal Synapse release process in parallel with this work.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
	&lt;li&gt;Ensuring Matrix can support a genuinely excellent UX for normal end-users on glossy clients, and supporting glossy client development as required.  The days of Matrix being just for powerusers are numbered... :)&lt;&#x2F;li&gt;
	&lt;li&gt;Switching to use 3rd party IDs as the primary means of referring to users in Matrix, hiding matrix IDs as a feature for powerusers and developers.&lt;&#x2F;li&gt;
	&lt;li&gt;Finishing the spec. You may have noticed the spec has been quietly evolving over the last few months - finally gaining a versioning system, and with larger chunks of it being automatically generated from formal API spec descriptions. We will be finishing off and filling in the remaining holes.&lt;&#x2F;li&gt;
	&lt;li&gt;Improving the documentation (and FAQ!) on matrix.org in general by switching to a git-backed jekyll system for all the staticish content&lt;&#x2F;li&gt;
	&lt;li&gt;Replace the Angular-based reference webapp bundled with Synapse entirely with a matrix-react-sdk based reference app, and providing better examples and documentation for using it to embed Matrix functionality into existing websites.&lt;&#x2F;li&gt;
	&lt;li&gt;Moving to v2 of the client-server API. This fixes some significant limitations in the v1 API that everyone&#x27;s been using all year, and should improve performance significantly for many use cases (especially when launching apps). The v1 API will hang around for a very very long time for backwards compatibility.&lt;&#x2F;li&gt;
	&lt;li&gt;Writing *lots* more bridges and integrations to other protocols, now we have a nice framework for rapidly developing them.&lt;&#x2F;li&gt;
	&lt;li&gt;General security audits and double-checking the security model.&lt;&#x2F;li&gt;
	&lt;li&gt;New features, including:
&lt;ul&gt;
	&lt;li&gt;Multiway VoIP and Video conferencing, most likely using FreeSWITCH&#x27;s new conferencing capabilities via an Application Service bridge (should be ready very shortly!)&lt;&#x2F;li&gt;
	&lt;li&gt;Getting E2E crypto reviewed&#x2F;audited and putting it live across the board.&lt;&#x2F;li&gt;
	&lt;li&gt;Adding VoIP to iOS&lt;&#x2F;li&gt;
	&lt;li&gt;Implementing delivery reports in all clients&lt;&#x2F;li&gt;
	&lt;li&gt;Improving how invites work (ability to reject them; metadata about where they came from)&lt;&#x2F;li&gt;
	&lt;li&gt;Search API&lt;&#x2F;li&gt;
	&lt;li&gt;Improved file management&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
	&lt;li&gt;...and an awful lot of bug fixing as we work through the backlog we&#x27;ve accumulated on JIRA.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Hopefully this won&#x27;t take up all year(!) and is just a beginning - there&#x27;s a huge list of interesting ideas beyond this baseline which we&#x27;ll be looking at assuming the core stuff above is on track. For instance, we need to work out how to decentralise the identity services that mapping 3rd party IDs to matrix IDs. We need to work out how to avoid spam. And it could be fascinating to start bridging more internet-of-things devices and ecosystems into Matrix, or decentralising user accounts between homeservers, or perhaps using Matrix for synchronising more sophisticated data structures than timelines and key-value state dictionaries...
&lt;p&gt;Finally, we also want to save as much time as possible to help support the wider community in building out clients, services and servers on top of Matrix. Just like the web itself, Matrix is only as useful as the content and services built on top of it - and we will do everything we can to help the pioneers who are interested in colonising this brave new world :)&lt;&#x2F;p&gt;
&lt;p&gt;Huge thanks to everyone over the last year who have supported us - whether that&#x27;s by creating an account and using the system, running a homeserver, hacking on top of the platform, contributing to the core project, enduring one of our presentations, or even paying for us to work on this. The coming year should prove incredibly interesting, and we hope you&#x27;ll stay and bring along all your friends, family and colleagues for the ride as the adventure continues!&lt;&#x2F;p&gt;
&lt;p&gt;Matthew, Amandine &amp;amp; the whole Matrix.org team.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.10.0 is released!!</title>
		<published>2015-09-03T00:00:00+00:00</published>
		<updated>2015-09-03T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/09/03/synapse-0-10-0-is-released/" type="text/html"/>
		<id>/blog/2015/09/03/synapse-0-10-0-is-released/</id>
		<content type="html">&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;Whilst the blog has been a bit quiet, we&#x27;ve actually had an incredibly busy summer refining Synapse, building the new matrix-react-sdk and example apps, building an entirely new matrix-appservice-bridge framework for rapidly creating Matrix&amp;lt;-&amp;gt;other-protocol bridges, getting end-to-end encryption ready for primetime and lots more fun stuff as we keep chipping away to take Matrix out of beta.  We&#x27;ll write about all of these once they&#x27;re ready, but right now the big news is that after 6 release candidates we have a major new update for Synapse out today - version 0.10.0.  This also includes 0.9.4, which we never quite got around to releasing and ended up skipping from 0.9.4-rc1 straight to 0.10.0-rc1.&lt;&#x2F;p&gt;
&lt;p&gt;The release focuses mainly on performance, bugfixes, and infrastructure work to support forthcoming features like end-to-end encryption, read receipts, etc.  Some of the more exciting new features include preset ACLs for room creation; history visibility ACLs; SAML2 single-sign-on login (courtesy of Ericsson, thanks guys!), filename support when sending files, support for specifying a canonical alias for a room, support for intermediary SSL certificates, etc.&lt;&#x2F;p&gt;
&lt;p&gt;The full changelog is below.&lt;&#x2F;p&gt;
&lt;p&gt;To upgrade, go read &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;UPGRADE.rst&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;UPGRADE.rst&lt;&#x2F;a&gt; - to install for the first time, go to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;README.rst&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;README.rst&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;code&gt;
Changes in synapse v0.10.0 (2015-09-03)
=======================================
&lt;p&gt;No change from release candidate.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-10-0-rc6-2015-09-02&quot;&gt;Changes in synapse v0.10.0-rc6 (2015-09-02)&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;Remove some of the old database upgrade scripts.&lt;&#x2F;li&gt;
&lt;li&gt;Fix database port script to work with newly created sqlite databases.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-10-0-rc5-2015-08-27&quot;&gt;Changes in synapse v0.10.0-rc5 (2015-08-27)&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug that broke downloading files with ascii filenames across federation.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-10-0-rc4-2015-08-27&quot;&gt;Changes in synapse v0.10.0-rc4 (2015-08-27)&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;Allow UTF-8 filenames for upload. (PR #259)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-10-0-rc3-2015-08-25&quot;&gt;Changes in synapse v0.10.0-rc3 (2015-08-25)&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Add &lt;code&gt;--keys-directory&lt;&#x2F;code&gt; config option to specify where files such as
certs and signing keys should be stored in, when using &lt;code&gt;--generate-config&lt;&#x2F;code&gt;
or &lt;code&gt;--generate-keys&lt;&#x2F;code&gt;. (PR #250)&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Allow &lt;code&gt;--config-path&lt;&#x2F;code&gt; to specify a directory, causing synapse to use all
\*.yaml files in the directory as config files. (PR #249)&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Add &lt;code&gt;web_client_location&lt;&#x2F;code&gt; config option to specify static files to be
hosted by synapse under &lt;code&gt;&#x2F;_matrix&#x2F;client&lt;&#x2F;code&gt;. (PR #245)&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Add helper utility to synapse to read and parse the config files and extract
the value of a given key. For example::&lt;&#x2F;p&gt;
&lt;p&gt;$ python -m synapse.config read server_name -c homeserver.yaml
localhost&lt;&#x2F;p&gt;
&lt;p&gt;(PR #246)&lt;&#x2F;p&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-10-0-rc2-2015-08-24&quot;&gt;Changes in synapse v0.10.0-rc2 (2015-08-24)&lt;&#x2F;h1&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug where we incorrectly populated the &lt;code&gt;event_forward_extremities&lt;&#x2F;code&gt;
table, resulting in problems joining large remote rooms (e.g.
&lt;code&gt;#matrix:matrix.org&lt;&#x2F;code&gt;)&lt;&#x2F;li&gt;
&lt;li&gt;Reduce the number of times we wake up pushers by not listening for presence
or typing events, reducing the CPU cost of each pusher.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-10-0-rc1-2015-08-21&quot;&gt;Changes in synapse v0.10.0-rc1 (2015-08-21)&lt;&#x2F;h1&gt;
&lt;p&gt;Also see v0.9.4-rc1 changelog, which has been amalgamated into this release.&lt;&#x2F;p&gt;
&lt;p&gt;General:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Upgrade to Twisted 15 (PR #173)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for serving and fetching encryption keys over federation.
(PR #208)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for logging in with email address (PR #234)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for new &lt;code&gt;m.room.canonical_alias&lt;&#x2F;code&gt; event. (PR #233)&lt;&#x2F;li&gt;
&lt;li&gt;Change synapse to treat user IDs case insensitively during registration and
login. (If two users already exist with case insensitive matching user ids,
synapse will continue to require them to specify their user ids exactly.)&lt;&#x2F;li&gt;
&lt;li&gt;Error if a user tries to register with an email already in use. (PR #211)&lt;&#x2F;li&gt;
&lt;li&gt;Add extra and improve existing caches  (PR #212, #219, #226, #228)&lt;&#x2F;li&gt;
&lt;li&gt;Batch various storage request (PR #226, #228)&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where we didn&#x27;t correctly log the entity that triggered the request
if the request came in via an application service (PR #230)&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where we needlessly regenerated the full list of rooms an AS is
interested in. (PR #232)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for AS&#x27;s to use v2_alpha registration API (PR #210)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Configuration:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add &lt;code&gt;--generate-keys&lt;&#x2F;code&gt; that will generate any missing cert and key files in
the configuration files. This is equivalent to running &lt;code&gt;--generate-config&lt;&#x2F;code&gt;
on an existing configuration file. (PR #220)&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;--generate-config&lt;&#x2F;code&gt; now no longer requires a &lt;code&gt;--server-name&lt;&#x2F;code&gt; parameter
when used on existing configuration files. (PR #220)&lt;&#x2F;li&gt;
&lt;li&gt;Add &lt;code&gt;--print-pidfile&lt;&#x2F;code&gt; flag that controls the printing of the pid to stdout
of the demonised process. (PR #213)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Media Repository:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug where we picked a lower resolution image than requested. (PR #205)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for specifying if a the media repository should dynamically
thumbnail images or not. (PR #206)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Metrics:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add statistics from the reactor to the metrics API. (PR #224, #225)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Demo Homeservers:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix starting the demo homeservers without rate-limiting enabled. (PR #182)&lt;&#x2F;li&gt;
&lt;li&gt;Fix enabling registration on demo homeservers (PR #223)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-v0-9-4-rc1-2015-07-21&quot;&gt;Changes in synapse v0.9.4-rc1 (2015-07-21)&lt;&#x2F;h1&gt;
&lt;p&gt;General:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add basic implementation of receipts. (SPEC-99)&lt;&#x2F;li&gt;
&lt;li&gt;Add support for configuration presets in room creation API. (PR  #203)&lt;&#x2F;li&gt;
&lt;li&gt;Add auth event that limits the visibility of history for new users.
(SPEC-134)&lt;&#x2F;li&gt;
&lt;li&gt;Add SAML2 login&#x2F;registration support. (PR  #201. Thanks Muthu Subramanian!)&lt;&#x2F;li&gt;
&lt;li&gt;Add client side key management APIs for end to end encryption. (PR #198)&lt;&#x2F;li&gt;
&lt;li&gt;Change power level semantics so that you cannot kick, ban or change power
levels of users that have equal or greater power level than you. (SYN-192)&lt;&#x2F;li&gt;
&lt;li&gt;Improve performance by bulk inserting events where possible. (PR #193)&lt;&#x2F;li&gt;
&lt;li&gt;Improve performance by bulk verifying signatures where possible. (PR #194)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Configuration:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add support for including TLS certificate chains.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Media Repository:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add Content-Disposition headers to content repository responses. (SYN-150)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Micropub support as an Application Service!</title>
		<published>2015-07-29T00:00:00+00:00</published>
		<updated>2015-07-29T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/07/29/micropub-support-as-an-application-service/" type="text/html"/>
		<id>/blog/2015/07/29/micropub-support-as-an-application-service/</id>
		<content type="html">&lt;p&gt;I was at &lt;a href=&quot;http:&#x2F;&#x2F;indiewebcamp.com&#x2F;2015&#x2F;Edinburgh&quot;&gt;IndieWebCamp Edinburgh&lt;&#x2F;a&gt; last week and during the hack day I &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Kegsay&#x2F;matrix-as-micropub&quot;&gt;created a Matrix Application Service&lt;&#x2F;a&gt; (AS) which could act as an IndieWeb &lt;a href=&quot;http:&#x2F;&#x2F;indiewebcamp.com&#x2F;Micropub&quot;&gt;Micropub&lt;&#x2F;a&gt; client. Any Matrix message sent to the AS (&lt;code&gt;@micropub:domain&lt;&#x2F;code&gt;) would be converted to a request to a Micropub endpoint.&lt;&#x2F;p&gt;
&lt;p&gt;This required the AS to support &lt;a href=&quot;http:&#x2F;&#x2F;indiewebcamp.com&#x2F;IndieAuth&quot;&gt;IndieAuth&lt;&#x2F;a&gt; - which it does by sending &lt;code&gt;!indieauth http:&#x2F;&#x2F;yourdomain.dom&lt;&#x2F;code&gt; to &lt;code&gt;@micropub:domain&lt;&#x2F;code&gt; which then returns an OAuth2 URL to login via. Currently, the AS just supports a 1:1 mapping from &lt;code&gt;m.text&lt;&#x2F;code&gt; to &lt;code&gt;h:entry&lt;&#x2F;code&gt; but in the future, it can be expanded to include categories and potentially the reverse mapping (where Micropub clients can act as Matrix users!).&lt;&#x2F;p&gt;
&lt;p&gt;Overall, it was a &lt;a href=&quot;http:&#x2F;&#x2F;rhiaro.co.uk&#x2F;2015&#x2F;07&#x2F;indiewebcamp-edinburgh-closes&quot;&gt;great weekend&lt;&#x2F;a&gt; and I look forward to adding more support for IndieWeb protocols in the future.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.9.3 is out! (as of a few weeks ago)</title>
		<published>2015-07-10T00:00:00+00:00</published>
		<updated>2015-07-10T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/07/10/synapse-0-9-3-is-out-as-of-a-few-weeks-ago/" type="text/html"/>
		<id>/blog/2015/07/10/synapse-0-9-3-is-out-as-of-a-few-weeks-ago/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;We seem to have done that thing again where we were too busy writing new stuff (E2E crypto, all-new React-based Web SDK, long-awaited iOS Console update) to remember that we&#x27;d released a new version of Synapse - sorry!&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.9.3 was released on July 1st (actually on June 23rd as 0.9.3-rc1, but was released without changes).  It&#x27;s a fairly minor release but does provide some performance improvements and bug fixes - see below for details.  Get it from &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; if you haven&#x27;t already.&lt;&#x2F;p&gt;
&lt;code&gt;
Changes in synapse v0.9.3 (2015-07-01)
======================================
&lt;p&gt;General:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix a memory leak in the notifier. (SYN-412)&lt;&#x2F;li&gt;
&lt;li&gt;Improve performance of room initial sync. (SYN-418)&lt;&#x2F;li&gt;
&lt;li&gt;General improvements to logging.&lt;&#x2F;li&gt;
&lt;li&gt;Remove &lt;code&gt;access_token&lt;&#x2F;code&gt; query params from &lt;code&gt;INFO&lt;&#x2F;code&gt; level logging.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Configuration:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add support for specifying and configuring multiple listeners. (SYN-389)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Application services:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug where synapse failed to send user queries to application services.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>The matrix.org IRC bridge now bridges all of Freenode!</title>
		<published>2015-06-22T00:00:00+00:00</published>
		<updated>2015-06-22T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/06/22/the-matrix-org-irc-bridge-now-bridges-all-of-freenode/" type="text/html"/>
		<id>/blog/2015/06/22/the-matrix-org-irc-bridge-now-bridges-all-of-freenode/</id>
		<content type="html">&lt;p&gt;We&#x27;ve been running an IRC gateway from Matrix to Freenode almost since day 1 - originally it was a &lt;a href=&quot;&#x2F;blog&#x2F;project&#x2F;perl-matrix-ircbridge&#x2F;&quot;&gt;simple perl bot&lt;&#x2F;a&gt; written by tm604 using Net::Async::Matrix; later it was rewritten by LeoNerd to be a bit more modular, and nowadays it&#x27;s a full &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&quot;&gt;IRC&#x2F;Matrix Application Service&lt;&#x2F;a&gt; written in Node.js by Kegan.&lt;&#x2F;p&gt;
&lt;p&gt;Up until the end of last week the bridge was limited to synchronising a fixed number of channels between Freenode and Matrix (#matrix, #matrix-dev, #openwebrtc, #vuc and #hypothes.is, to be precise), as well as any PMs.  But as of Friday, with huge thanks to the admins over at Freenode, we can now bridge &lt;em&gt;any&lt;&#x2F;em&gt; channel in Freenode through to Matrix.&lt;&#x2F;p&gt;
&lt;p&gt;Doing this is trivial - you just &lt;code&gt;&#x2F;join #freenode_#channelname:matrix.org&lt;&#x2F;code&gt; from a typical Matrix client - e.g. &lt;code&gt;&#x2F;join #freenode_#Node.js:matrix.org&lt;&#x2F;code&gt; will give you access to all of #Node.js via Matrix, effectively using Matrix as a great big distributed IRC bouncer in the sky ;)&lt;&#x2F;p&gt;
&lt;p&gt;There are a few limitations in the current setup:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;We only incrementally synchronise the membership lists when folks speak in either IRC or Matrix.  This is to avoid flooding either IRC or Matrix with lurkers when the bridge initially joins a channel.  We have some plans to improve this in future - see &lt;a href=&quot;&#x2F;jira&#x2F;browse&#x2F;BOTS-53&quot;&gt;BOTS-53&lt;&#x2F;a&gt; for some of the sordid details.&lt;&#x2F;li&gt;
&lt;li&gt;We don&#x27;t synchronise joins&#x2F;parts currently to avoid flooding Matrix with lots of IRC join&#x2F;part spam.  Again, this will improve in future.&lt;&#x2F;li&gt;
&lt;li&gt;You can&#x27;t join +k channels.&lt;&#x2F;li&gt;
&lt;li&gt;Kicks&#x2F;bans&#x2F;invites and other ACLs currently don&#x27;t propagate between IRC &amp;amp; Matrix.  (I.e. a Matrix user can be kicked from IRC, but it&#x27;ll continue to sit in Matrix unless also kicked for there).  +i chanmode supported however.&lt;&#x2F;li&gt;
&lt;li&gt;Bridged public IRC rooms are not yet advertised in the public room list on matrix.org.&lt;&#x2F;li&gt;
&lt;li&gt;It should be possible to change the nickname of your IRC user by messaging &lt;code&gt;!nick irc.freenode.net MrFlibble&lt;&#x2F;code&gt; to @appservice-irc:matrix.org.  (This isn&#x27;t actually turned on right now, but should be fixed shortly.  See &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;blob&#x2F;master&#x2F;HOWTO.md#changing-nicks&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&#x2F;blob&#x2F;master&#x2F;HOWTO.md#changing-nicks&lt;&#x2F;a&gt; for details.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We&#x27;ll keep chipping away at making the IRC&amp;lt;-&amp;gt;Matrix mapping perfect, but in its current state it&#x27;s still really usable.  It&#x27;s obviously beta still, but please give it a go and let us know in #matrix:matrix.org how you get on with it!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Android Matrix Console 0.4.0</title>
		<published>2015-06-19T00:00:00+00:00</published>
		<updated>2015-06-19T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/06/19/android-matrix-console-0-4-0/" type="text/html"/>
		<id>/blog/2015/06/19/android-matrix-console-0-4-0/</id>
		<content type="html">&lt;p&gt;Matrix Console 0.4.0 for Android has been pushed to the &lt;a href=&quot;https:&#x2F;&#x2F;play.google.com&#x2F;store&#x2F;apps&#x2F;details?id=org.matrix.androidsdk.alpha&quot; title=&quot;Google Play store&quot;&gt;Google Play store&lt;&#x2F;a&gt; and shall be available shortly. &lt;&#x2F;p&gt;
&lt;p&gt;This release contains a whole lot of bugfixes, new features, and nicer UI and UX - see the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-android-console&#x2F;blob&#x2F;master&#x2F;CHANGES.rst#changes-in-console-040-2015-06-19&quot; title=&quot;changes&quot;&gt;changes&lt;&#x2F;a&gt; file for details, but in summary:&lt;&#x2F;p&gt;
&lt;ul&gt;
	&lt;li&gt;Lots of UI and UX improvements (inc. long click on images)&lt;&#x2F;li&gt;
	&lt;li&gt;Added GCM support (can be enabled&#x2F;disabled)&lt;&#x2F;li&gt;
	&lt;li&gt;Added Google analytics support&lt;&#x2F;li&gt;
	&lt;li&gt;Added badges management&lt;&#x2F;li&gt;
	&lt;li&gt;Added &quot;orientation&quot; management for images&lt;&#x2F;li&gt;
	&lt;li&gt;Now offering image resizing before upload&lt;&#x2F;li&gt;
	&lt;li&gt;Lots of bugfixes!&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Introducing all new matrix-js-sdk v0.1.0</title>
		<published>2015-06-12T00:00:00+00:00</published>
		<updated>2015-06-12T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/06/12/introducing-all-new-matrix-js-sdk-v0-1-0/" type="text/html"/>
		<id>/blog/2015/06/12/introducing-all-new-matrix-js-sdk-v0-1-0/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;If things seem a bit quiet here at the moment it&#x27;s because most of the Matrix team is in the &#x27;build&#x27; phase across the board on a bunch of major new projects - including the long-awaited reusable UI component library for the Web, end-to-end encryption support, stable VoIP on mobile and a few other surprises.  The first wave of all this new work landed today in the form of a new major version release (0.1.0) of &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&quot;&gt;matrix-js-sdk&lt;&#x2F;a&gt;: our javascript SDK library.&lt;&#x2F;p&gt;
&lt;p&gt;The history of JS client support on Matrix is that in the original rush to get a PoC webclient out the door back in September, we jumped straight to talking to the Matrix HTTP API from Angular controllers in &#x27;syweb&#x27;.  This then got split into an Angular SDK (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-angular-sdk&quot;&gt;matrix-angular-sdk&lt;&#x2F;a&gt;) containing a bunch of services for handling the Matrix client state with the actual webapp sitting alongside as an example of the SDK.  This then in turn got split into a basic matrix-js-sdk (wrapping the Matrix client-server HTTP API) and matrix-angular-sdk (handling the clientside state and exposing it as Angular services) - and this is how the current demo Angular webapp works at &lt;a href=&quot;http:&#x2F;&#x2F;matrix.org&#x2F;beta&quot;&gt;http:&#x2F;&#x2F;matrix.org&#x2F;beta&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;However, this poses a major problem if you want a richer client SDK but don&#x27;t want to use Angular - e.g. if you prefer another framework (or no framework at all), or are using the SDK in an Application Service or similar.  So, this has prompted a major upgrade to the matrix-js-sdk in order to extend it to act both as a simple wrapper of the Matrix Client-Server HTTP API, but also expose a full object and event model to describe the state of a Matrix client together with all the higher level functions to drive it.  To quote from the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&#x2F;blob&#x2F;master&#x2F;README.md&quot;&gt;README&lt;&#x2F;a&gt;:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;This SDK provides a full object model around the Matrix Client-Server API and emits events for incoming data and state changes. Aside from wrapping the HTTP API, it:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Handles syncing (via &#x2F;initialSync and &#x2F;events)&lt;&#x2F;li&gt;
&lt;li&gt;Handles the generation of &quot;friendly&quot; room and member names.&lt;&#x2F;li&gt;
&lt;li&gt;Handles historical RoomMember information (e.g. display names).&lt;&#x2F;li&gt;
&lt;li&gt;Manages room member state across multiple events (e.g. it handles typing, power levels and membership changes).&lt;&#x2F;li&gt;
&lt;li&gt;Exposes high-level objects like Rooms, RoomState, RoomMembers and Users which can be listened to for things like name changes, new messages, membership changes, presence changes, and more.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Later versions of the SDK will:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Automatically retry requests to send messages due to network errors.&lt;&#x2F;li&gt;
&lt;li&gt;Automatically retry requests to send messages due to rate limiting errors.&lt;&#x2F;li&gt;
&lt;li&gt;Mark events&#x27; sent status (e.g. &#x27;not sent&#x27;).&lt;&#x2F;li&gt;
&lt;li&gt;Handle &quot;local echo&quot; of messages sent.&lt;&#x2F;li&gt;
&lt;li&gt;Handle queueing of messages.&lt;&#x2F;li&gt;
&lt;li&gt;Handle pagination.&lt;&#x2F;li&gt;
&lt;li&gt;Expose a RoomSummary which would be suitable for a recents page.&lt;&#x2F;li&gt;
&lt;li&gt;Provide different pluggable storage layers (e.g. local storage, database-backed)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;It also is designed to provide an API that abstracts both version 1 of the client-server API and the upcoming version 2 (which fixes various thinkos we&#x27;ve discovered along the way in v1).&lt;&#x2F;p&gt;
&lt;p&gt;This is incredibly exciting stuff as it now gives a really robust yet lightweight API for client-side and application-service development in JavaScript.  Predictably enough we&#x27;re using it to develop our new reusable web UI components, and I suspect we&#x27;ll see new Node-based application services making use of in the near future.  Meanwhile, it&#x27;s more than topical as it should run straight on top of the &lt;a href=&quot;http:&#x2F;&#x2F;tessel.io&quot;&gt;Tessel&lt;&#x2F;a&gt; JavaScript hardware modules we&#x27;re giving away this weekend as our prize for the best hack built on Matrix at &lt;a href=&quot;&#x2F;blog&#x2F;2015&#x2F;06&#x2F;05&#x2F;global-tadhack-hackathon&#x2F;&quot;&gt;TADHack&lt;&#x2F;a&gt; - letting the little Tessel ARM system-on-a-chip speak a very rich and native Matrix dialect!&lt;&#x2F;p&gt;
&lt;p&gt;The new matrix-js-sdk comes with comprehensive jsdoc detailing the new API which you can find at &lt;a href=&quot;http:&#x2F;&#x2F;matrix-org.github.io&#x2F;matrix-js-sdk&#x2F;global.html&quot;&gt;http:&#x2F;&#x2F;matrix-org.github.io&#x2F;matrix-js-sdk&#x2F;global.html&lt;&#x2F;a&gt;.  There are also some &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&#x2F;tree&#x2F;master&#x2F;examples&quot;&gt;basic examples&lt;&#x2F;a&gt; available, including a new simple node-powered command-line client designed for testing the SDK.  Finally, if you&#x27;re interested in reading the design process by which we&#x27;ve converged on the current API, all the details may be found in JIRA on &lt;a href=&quot;&#x2F;jira&#x2F;browse&#x2F;SYJS-5&quot;&gt;SYJS-5&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;So: if you&#x27;ve been itching to get your hands on a much more powerful pure-JS Matrix SDK, now&#x27;s your chance!  It&#x27;s very early days for the new API so we expect to see a few incompatible changes on the horizon, but we encourage you to have a play and &lt;a href=&quot;http:&#x2F;&#x2F;matrix.org&#x2F;beta&#x2F;#&#x2F;room&#x2F;#matrix:matrix.org&quot;&gt;tell us what you think!&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;To find out more, go check out the project at &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&quot;&gt;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-js-sdk&lt;&#x2F;a&gt;, or if you&#x27;re feeling daring just grab the library with &lt;code&gt;npm install matrix-js-sdk&lt;&#x2F;code&gt; and get hacking!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.9.1 released</title>
		<published>2015-06-01T00:00:00+00:00</published>
		<updated>2015-06-01T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/06/01/synapse-0-9-1-released/" type="text/html"/>
		<id>/blog/2015/06/01/synapse-0-9-1-released/</id>
		<content type="html">&lt;p&gt;In the excitement of KamailioWorld last week we completely forgot to mention that we released Synapse 0.9.1.&lt;&#x2F;p&gt;
&lt;p&gt;This is a pretty important performance and stability update of all the new stuff that landed in 0.9.0, as well as landing a major new feature in the form of &#x27;backfill&#x27;: we finally have the ability to correctly sync in historical conversation history over federation for newly federated rooms.  In other words, if you join a remote room you should be able to navigate its history as intended.&lt;&#x2F;p&gt;
&lt;p&gt;We highly recommend upgrading to 0.9.1 for all the performance improvements and backfill support - get it now from &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;code&gt;
Changes in synapse v0.9.1 (2015-05-26)
======================================
&lt;p&gt;General:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add support for backfilling when a client paginates. This allows servers to
request history for a room from remote servers when a client tries to
paginate history the server does not have - SYN-36&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where you couldn&#x27;t disable non-default pushrules - SYN-378&lt;&#x2F;li&gt;
&lt;li&gt;Fix &lt;code&gt;register_new_user&lt;&#x2F;code&gt; script - SYN-359&lt;&#x2F;li&gt;
&lt;li&gt;Improve performance of fetching events from the database, this improves both
initialSync and sending of events.&lt;&#x2F;li&gt;
&lt;li&gt;Improve performance of event streams, allowing synapse to handle more
simultaneous connected clients.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Federation:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug with existing backfill implementation where it returned the wrong
selection of events in some circumstances.&lt;&#x2F;li&gt;
&lt;li&gt;Improve performance of joining remote rooms.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Configuration:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add support for changing the bind host of the metrics listener via the &lt;code&gt;metrics_bind_host&lt;&#x2F;code&gt; option.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>iOS Console 0.4.0 released!</title>
		<published>2015-05-04T00:00:00+00:00</published>
		<updated>2015-05-04T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/05/04/ios-console-0-4-0-released/" type="text/html"/>
		<id>/blog/2015/05/04/ios-console-0-4-0-released/</id>
		<content type="html">&lt;p&gt;As a follow-on to the previous post, Apple approved version 0.4.0 of the iOS Matrix Console app over the weekend - &lt;a href=&quot;https:&#x2F;&#x2F;itunes.apple.com&#x2F;gb&#x2F;app&#x2F;matrix-console&#x2F;id970074271?mt=8&quot;&gt;grab it now from the app store!&lt;&#x2F;a&gt;.  Whilst cosmetically it looks almost identical to 0.3.x, the architecture is completely different given the app is now built using &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-ios-kit&quot;&gt;MatrixKit&lt;&#x2F;a&gt; - and stability has improved considerably as a result.  Please install and let us know how you get on!&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>The All New Matrix-IRC Application Service</title>
		<published>2015-04-22T00:00:00+00:00</published>
		<updated>2015-04-22T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/04/22/matrix-irc-application-service/" type="text/html"/>
		<id>/blog/2015/04/22/matrix-irc-application-service/</id>
		<content type="html">&lt;p&gt;&lt;strong&gt;This post has now been edited into a guide - you can find &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;blob&#x2F;master&#x2F;supporting-docs&#x2F;guides&#x2F;2015-08-21-application_services.md&quot;&gt;the source in github&lt;&#x2F;a&gt;, and the &lt;a href=&quot;http:&#x2F;&#x2F;matrix.org&#x2F;docs&#x2F;guides&#x2F;application_services.html&quot;&gt;formatted guide on the matrix.org website&lt;&#x2F;a&gt;!&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;hr &#x2F;&gt;
&lt;p&gt;Like a lot of open source projects, we use IRC a lot. Naturally, we also use Matrix to communicate with each other. For some time now we&#x27;ve had an IRC bot sitting on specific channels to &amp;quot;bridge&amp;quot; together IRC and Matrix. This bot simply sent IRC messages when it received Matrix messages and vice versa. As we started to rely on it more and more though, we realised that there were things that were impossible for simple client-side bots to do by themselves. This spurred the development of Application Services which &lt;a href=&quot;&#x2F;blog&#x2F;2015&#x2F;03&#x2F;02&#x2F;introduction-to-application-services&#x2F;&quot;&gt;I introduced in my previous post&lt;&#x2F;a&gt;. In this blog post, I want to outline some of the features and techniques of the IRC application service which we&#x27;ve been working on over the past few weeks.&lt;&#x2F;p&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;strong&gt;Specific channel-to-matrix room bridging&lt;&#x2F;strong&gt; : This is what the original IRC bot did. You can specify specific channels and specific room IDs, and messages will be bridged.&lt;&#x2F;li&gt;
	&lt;li&gt;&lt;strong&gt;Dynamic channel-to-matrix room bridging&lt;&#x2F;strong&gt; : This allows Matrix users to join any channel on an IRC network, rather than being forced to use one of the specific channels configured.&lt;&#x2F;li&gt;
	&lt;li&gt;&lt;strong&gt;Two-way PM support&lt;&#x2F;strong&gt; : IRC users can PM the virtual &quot;M-&quot; users and private Matrix rooms will be created. Likewise, Matrix users can invite the virtual &quot;@irc_Nick:domain&quot; user IDs to a room and a PM to the IRC nick will be made.&lt;&#x2F;li&gt;
	&lt;li&gt;&lt;strong&gt;IRC nick changing support &lt;&#x2F;strong&gt;: Matrix users are no longer forced to use &quot;M-&quot; nicks and can change them by sending &quot;!nick&quot; messages directly to the bridge.&lt;&#x2F;li&gt;
	&lt;li&gt;&lt;strong&gt;Ident support&lt;&#x2F;strong&gt; : This allows usernames to be authenticated for virtual IRC clients, which means IRC bans can be targeted at the Matrix user rather than the entire application service.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
The use of the Application Services API means:
&lt;ul&gt;
	&lt;li&gt;The bot can reserve user IDs. This prevents humans from registering for @irc_... user IDs which would then clash with the operation of the bot.&lt;&#x2F;li&gt;
	&lt;li&gt;The bot can reserve room aliases. This prevents humans from register for #irc_... aliases which would then clash with the operation of the bot.&lt;&#x2F;li&gt;
	&lt;li&gt;The bot can trivially manage hundreds of users. Events are pushed to the application service directly. If you tried to do this as a client-side bot, you would need one event stream connection per virtual user.&lt;&#x2F;li&gt;
	&lt;li&gt;The bot can lazily create rooms on demand. This means Matrix users can join non-existent room aliases and have the application service quickly track an IRC channel and create a room with that alias, allowing the join request to succeed.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
Implementation details:
&lt;ul&gt;
	&lt;li&gt;Written in Node.js, designed to be run using &lt;code&gt;forever&lt;&#x2F;code&gt;.&lt;&#x2F;li&gt;
        &lt;li&gt;Built on the generic &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-node&quot;&gt;matrix-appservice-node&lt;&#x2F;a&gt; framework.&lt;&#x2F;li&gt;
	&lt;li&gt;Supports sending metrics in statsd format.&lt;&#x2F;li&gt;
	&lt;li&gt;Uses matrix-appservice-node to provide a standardised interface when writing application services, rather than an explicit web framework (though under the hood matrix-appservice-node is using Express).&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
At present, the IRC application service is in beta, and is being run on #matrix and #matrix-dev. If you want to give it a go, &lt;a title=&quot;Matrix-IRC Application Service&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-appservice-irc&quot;&gt;check it out on Github&lt;&#x2F;a&gt; - it is not currently released on npm. &lt;b&gt;N.B. it requires features from the develop branch of synapse; either run your own synapse off the develop branch or wait a few days for us to release Synapse 0.9.0&lt;&#x2F;b&gt;.
&lt;p&gt;Needless to say, we look forward to this being the first of many full network&amp;lt;-&amp;gt;network bridges into Matrix - come chat on &lt;a href=&quot;&#x2F;beta&#x2F;#&#x2F;room&#x2F;#matrix:matrix.org&quot;&gt;#matrix:matrix.org&lt;&#x2F;a&gt; if you&#x27;d like to write or run your own!  Next up is Lync and XMPP...&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Android 0.2.3 SDK and Application released</title>
		<published>2015-03-10T00:00:00+00:00</published>
		<updated>2015-03-10T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/03/10/android-0-2-3-sdk-and-application-released/" type="text/html"/>
		<id>/blog/2015/03/10/android-0-2-3-sdk-and-application-released/</id>
		<content type="html">&lt;p&gt;Hi folks,&lt;&#x2F;p&gt;
&lt;p&gt;We released a new version (0.2.3) of the &lt;a href=&quot;https:&#x2F;&#x2F;play.google.com&#x2F;store&#x2F;apps&#x2F;details?id=org.matrix.androidsdk.alpha&quot;&gt;Android Matrix Console&lt;&#x2F;a&gt; application today - this is a decent upgrade over 0.2.2.  Changelog below.&lt;&#x2F;p&gt;
&lt;p&gt;If you&#x27;re an Android user, please install the app from the Play Store and give it a go and give us some feedback on #android:matrix.org or Google Play.&lt;&#x2F;p&gt;
&lt;p&gt;thanks!&lt;&#x2F;p&gt;
&lt;code&gt;
Changes in Matrix Android SDK in 0.2.3 (2015-03-10)
===================================================
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;sdk&quot;&gt;SDK&lt;&#x2F;h2&gt;
&lt;hr &#x2F;&gt;
&lt;h2 id=&quot;matrix-console&quot;&gt;Matrix Console&lt;&#x2F;h2&gt;
&lt;p&gt;Improvements:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Avoid refreshing the home page when it is not displayed.&lt;&#x2F;li&gt;
&lt;li&gt;Display a piechart while uploading a media.&lt;&#x2F;li&gt;
&lt;li&gt;Refresh the display when some messages are automatically resent (after retrieving a data network connection for example).&lt;&#x2F;li&gt;
&lt;li&gt;Update the user rename message to be compliant with the web client.&lt;&#x2F;li&gt;
&lt;li&gt;Use the local media files instead of downloading them when they are acknowledged (messages sending).&lt;&#x2F;li&gt;
&lt;li&gt;Create a medias management class.&lt;&#x2F;li&gt;
&lt;li&gt;Display the offline status in the members list.&lt;&#x2F;li&gt;
&lt;li&gt;Avoid creating new homeActivity instance when joining a room from member details sheet.&lt;&#x2F;li&gt;
&lt;li&gt;The public rooms list are now saved in the bundle state : it should avoid having a spinner when rotated the device.&lt;&#x2F;li&gt;
&lt;li&gt;The animated GIFs are now supported.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add the rate limits error management. The server could request to delay the messages sending because they were too many messages sent in a short time (to avoid spam).&lt;&#x2F;li&gt;
&lt;li&gt;Can take a photo to send it.&lt;&#x2F;li&gt;
&lt;li&gt;A chat room page is automatically paginated to fill. It used to get only the ten latest messages : it displayed half filled page on tablet.&lt;&#x2F;li&gt;
&lt;li&gt;Add the sending failure reason in the message details (long tap on a message, “Message details”).&lt;&#x2F;li&gt;
&lt;li&gt;The user is not anymore notified it the push rules are not fulfilled.&lt;&#x2F;li&gt;
&lt;li&gt;Add some room settings (Display all events, hide unsupported events, sort members by last seen time, display left members, display public rooms in the home page).&lt;&#x2F;li&gt;
&lt;li&gt;Add various accessibility tweaks.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;The media downloads&#x2F;uploads were sometimes stuck.&lt;&#x2F;li&gt;
&lt;li&gt;The private room creation was broken.&lt;&#x2F;li&gt;
&lt;li&gt;SYAND-33 : number of unread messages disappears when entering another room.&lt;&#x2F;li&gt;
&lt;li&gt;The RoomActivity creation used to crash when it was cancelled because the Room id param was not provided.&lt;&#x2F;li&gt;
&lt;li&gt;The client used to crash when the home server was invalid but started with http.&lt;&#x2F;li&gt;
&lt;li&gt;The account creation used to fail if the home server had a trailing slash.&lt;&#x2F;li&gt;
&lt;li&gt;SYAND-44 In progress text entry could be saved across crashes.&lt;&#x2F;li&gt;
&lt;li&gt;SYAND-38 Inline image viewer in Android app.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.7.0 and matrix-angular-sdk 0.6.2 released!</title>
		<published>2015-02-12T00:00:00+00:00</published>
		<updated>2015-02-12T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/02/12/synapse-0-7-0-and-matrix-angular-sdk-0-6-2-released/" type="text/html"/>
		<id>/blog/2015/02/12/synapse-0-7-0-and-matrix-angular-sdk-0-6-2-released/</id>
		<content type="html">&lt;p&gt;We just pushed out a major new release of &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;Synapse 0.7.0&lt;&#x2F;a&gt;, the python reference server for Matrix, and a minor maintenance update for &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-angular-sdk&quot;&gt;matrix-angular-sdk 0.6.2&lt;&#x2F;a&gt;, the reference web client implementation.&lt;&#x2F;p&gt;
&lt;p&gt;The emphasis here has been on federation performance and stability - with all the recent interest from &lt;a href=&quot;https:&#x2F;&#x2F;fosdem.org&#x2F;2015&#x2F;schedule&#x2F;event&#x2F;matrix&#x2F;&quot;&gt;FOSDEM&lt;&#x2F;a&gt; and &lt;a href=&quot;http:&#x2F;&#x2F;lwn.net&#x2F;Articles&#x2F;632572&quot;&gt;LWN&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=8997844&quot;&gt;HackerNews&lt;&#x2F;a&gt; we&#x27;ve been getting a lot of traffic on matrix.org and new servers federating up, so we&#x27;ve been busy profiling and fixing performance on some of the hot paths by adding in-memory caches and similar.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;b&gt;This release is &lt;em&gt;highly&lt;&#x2F;em&gt; recommended if you are running a federated server, as it fixes many denial-of-service failure modes in the federation implementation, as well as many performance improvements&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Behind the scenes, there&#x27;s also lots of work going on for v2 of the Client-Server API (which lets you filter the events your client subscribes to in a room, and combines the &#x27;initial sync&#x27; and &#x27;eventstream&#x27; APIs into a single simplified &#x27;&#x2F;sync&#x27; API) - the alpha of this has landed in 0.7.0, but we don&#x27;t recommend trying to use it yet. Meanwhile the Application Service API is effectively finished, but hasn&#x27;t landed on the master branch yet. Synapse also finally has initial support for push notifications for the iOS client now via the &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;sygnal&quot;&gt;sygnal&lt;&#x2F;a&gt; APNS gateway, although we need to actually document how to set this up to be usable in general.&lt;&#x2F;p&gt;
&lt;p&gt;Finally, we have switched to recommending that synapse is installed in a virtualenv rather than into ~&#x2F;.local, due to various problems with how setup.py&#x27;s dependency management works. Instructions on setting up a virtualenv can be found in the &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;README.rst&quot;&gt;README&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;On the clientside: we&#x27;ve improved performance, enabled identicons for unknown users, and now fully support OpenWebRTC for VoIP calling from Safari, Bowser, and other OpenWebRTC-capable browsers!&lt;&#x2F;p&gt;
&lt;p&gt;Thanks to everyone running servers - please upgrade, tell your friends, and help us grow Matrix!&lt;&#x2F;p&gt;
&lt;pre&gt;
Changes in synapse v0.7.0 (2015-02-12)
======================================

* Add initial implementation of the query auth federation API, allowing
  servers to agree on whether an event should be allowed or rejected.
* Persist events we have rejected from federation, fixing the bug where
  servers would keep requesting the same events.
* Various federation performance improvements, including:
  - Add in memory caches on queries such as:
     * Computing the state of a room at a point in time, used for
       authorization on federation requests.
     * Fetching events from the database.
     * User&#x27;s room membership, used for authorizing presence updates.
  - Upgraded JSON library to improve parsing and serialisation speeds.
* Add default avatars to new user accounts using pydenticon library.
* Correctly time out federation requests.
* Retry federation requests against different servers.
* Add support for push notifications and push rules.
* Add alpha versions of proposed new CSv2 APIs, including ``&#x2F;sync`` API.

&lt;&#x2F;pre&gt;
&lt;pre&gt;
Changes in Matrix Angular SDK 0.6.2 (2015-02-12)
================================================
Bug fixes:
 - Fixed a bug which caused OpenWebRTC to occasionally fail.
 - Fixed a bug which caused multiple room initial syncs to occur in rapid
   succession.

Features:
 - Display a &quot;Joining Room&quot; dialog when joining rooms.
 - Display identicons for users with no avatar.
 - Display m.notice events with full formatting.
 - Add push notification rules to settings.

Improvements:
 - Modified the red&#x2F;blue notification colours to be more noticeable on a wider
   range of displays.
 - Highlight room invitations in blue.
 - Calculate room names for rooms of 3+ members.
 - Improved page load performance.
 
&lt;&#x2F;pre&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>iOS: SDK and Matrix Console 0.2.2 released</title>
		<published>2015-02-05T00:00:00+00:00</published>
		<updated>2015-02-05T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/02/05/ios-sdk-and-matrix-console-0-2-2-released/" type="text/html"/>
		<id>/blog/2015/02/05/ios-sdk-and-matrix-console-0-2-2-released/</id>
		<content type="html">&lt;p&gt;A new release of the iOS SDK and the iOS Matrix Console app is available on GitHub: &lt;a title=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-ios-sdk&quot; href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-ios-sdk&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-ios-sdk&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;If you use CocoaPods to manage your application dependencies, note that the Matrix SDK pod has been updated too.&lt;&#x2F;p&gt;
&lt;p&gt;The changes since the last release are:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;sdk&quot;&gt;SDK&lt;&#x2F;h3&gt;
&lt;dl&gt;&lt;dt&gt;Improvements:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;ul&gt;
	&lt;li&gt;MXFileStore stores data on a separated thread to avoid blocking the UI thread.&lt;&#x2F;li&gt;
	&lt;li&gt;MXRestClient: Callback blocks in all MXRestClient methods are now optional.&lt;&#x2F;li&gt;
	&lt;li&gt;MXEvent: Cleaned up exposed properties and added a description for each of them.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;&lt;dt&gt;Features:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;ul&gt;
	&lt;li&gt;Added API for registering for push notifications.&lt;&#x2F;li&gt;
	&lt;li&gt;Added generic API methods to make any kind of registration or login flow.&lt;&#x2F;li&gt;
	&lt;li&gt;Added Identity server API: lookup3pid, requestEmailValidation, validateEmail and bind3PID.&lt;&#x2F;li&gt;
	&lt;li&gt;Management of event redaction: there is a new method in the SDK to redact an event and the SDK updates its data on redaction event.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;&lt;dt&gt;Bug fixes:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;ul&gt;
	&lt;li&gt;SYIOS-5 - Expose registration API&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-44 - Credentials persist across logout&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-54 - Matrix Console app slightly freezes when receiving a message&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-59 - Infinite loop in case of back pagination on new created room&lt;&#x2F;li&gt;
	&lt;li&gt;MXRoom: Fixed [MXRoom sendTextMessage]&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;&lt;&#x2F;dl&gt;
&lt;h3 id=&quot;matrix-console&quot;&gt;Matrix Console&lt;&#x2F;h3&gt;
&lt;dl&gt;&lt;dt&gt;Improvements:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;ul&gt;
	&lt;li&gt;When long pressing on a message, the app shows the JSON string of the Matrix event.&lt;&#x2F;li&gt;
	&lt;li&gt;On this screen, the user can redact the event - if he has enough power level.&lt;&#x2F;li&gt;
	&lt;li&gt;Use home server media repository facilities to use lower image size for thumbnails and avatars&lt;&#x2F;li&gt;
	&lt;li&gt;Settings screen: show build version with the app version.&lt;&#x2F;li&gt;
	&lt;li&gt;Settings screen: added an option to hide information related to redacted event.&lt;&#x2F;li&gt;
	&lt;li&gt;Settings screen: added an option to enable reading of local phonebook. The country is required to internationalise phone numbers.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;&lt;dt&gt;Features:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;ul&gt;
	&lt;li&gt;Push notifications.&lt;&#x2F;li&gt;
	&lt;li&gt;Added a contacts screen that displays Matrix users the user had interactions with and contacts from the device phonebook.&lt;&#x2F;li&gt;
	&lt;li&gt;Contacts from the device phonebook who have an email linked to a Matrix user id are automatically recognised.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;&lt;dt&gt;Bug fixes:&lt;&#x2F;dt&gt;&lt;dd&gt;
&lt;ul&gt;
	&lt;li&gt;SYIOS-53 - multilines text input that expands as you type mutiplines would be nice&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-45 - Need to check the thumbnail params requested by iOS&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-55 - High resolution avatars create memory pressure&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-57 - Back pagination does not work well for self chat&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-56 - add cache size handling in settings&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-60 - In a self chat, Console takes ages to paginate back even if messages are in cache&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-61 - Chat room : cannot scroll to bottom when keyboard is opened whereas the growing textview contains multi-lines text.&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-63 - calculate room names for 3+ members if no room name&#x2F;alias&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-44 - Credentials persist across logout&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-64 - Chat room : unexpected blank lines are added into history when user types in growing textview&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-65 - IOS8 : in case of search in recents, keyboard is not dismisssed when user selects a room.&lt;&#x2F;li&gt;
	&lt;li&gt;SYIOS-16 Add option in Console to join room thanks to its alias&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;dd&gt;&lt;&#x2F;dl&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.6.1 released and other news!</title>
		<published>2015-01-07T00:00:00+00:00</published>
		<updated>2015-01-07T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2015/01/07/synapse-0-6-1-released-and-other-news/" type="text/html"/>
		<id>/blog/2015/01/07/synapse-0-6-1-released-and-other-news/</id>
		<content type="html">&lt;p&gt;Happy 2015 from everyone at Matrix.org!&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;re excited to kick off the new year with a major performance upgrade for Synapse: having had a chance to do some profiling over the Christmas break, Synapse 0.6.1 improves performance by up to an order of magnitude thanks to optimising the way events are constructed and manipulated, DB optimisations, etc.  Suddenly things are feeling &lt;em&gt;much&lt;&#x2F;em&gt; more snappy and less of a PoC and more of a real system, which hopefully bodes well for 2015!  Please upgrade if you&#x27;re running a homeserver, or install one if you&#x27;re not - grab the code from &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;The iOS SDK and demo app has also been improving lots in the last few weeks - grab the latest code from &lt;a href=&quot;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-ios-sdk&quot;&gt;http:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-ios-sdk&lt;&#x2F;a&gt;.  We have zoomable image support; full support for the new media repository in Synapse 0.6.0; file transfer status UI; offline support; snappy message synchronisation and more...&lt;&#x2F;p&gt;
&lt;p&gt;We also released a new simple Python SDK client library for Python called &lt;a href=&quot;https:&#x2F;&#x2F;pypi.python.org&#x2F;pypi&#x2F;matrix-client&quot;&gt;matrix-client&lt;&#x2F;a&gt;, which is now being used by &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Kegsay&#x2F;Matrix-NEB&quot;&gt;NEB&lt;&#x2F;a&gt; (our general-purpose Matrix helper bot).&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, our (constantly evolving) plan for the beginning of 2015 is:&lt;&#x2F;p&gt;
&lt;ul&gt;
	&lt;li&gt;Finish v2 of the client-server API based on all the lessons learnt since launch: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;4&quot;&gt;draft in progress here&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;	 
        &lt;li&gt;Finish the Application Services API to allow proper gateways and services in and out of Matrix at last:&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix-doc&#x2F;pull&#x2F;5&quot;&gt;draft in progress here&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
        &lt;li&gt;Re-release the spec based on the above&lt;&#x2F;li&gt;
        &lt;li&gt;Build robust gateways (IRC, XMPP, SIP and more) on top of the AS API&lt;&#x2F;li&gt;
        &lt;li&gt;Polish and release the iOS, Android demo clients - including push notification and VoIP support!&lt;&#x2F;li&gt;
        &lt;li&gt;Overhaul the identity server architecture and add end-to-end crypto&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Given the rate at which Matrix is maturing, the next few months should be really exciting - please come join us on &lt;a href=&quot;http:&#x2F;&#x2F;matrix.org&#x2F;beta&quot;&gt;#matrix:matrix.org&lt;&#x2F;a&gt; and get involved!&lt;&#x2F;p&gt;
&lt;code&gt;
Changes in synapse 0.6.1 (2015-01-07)
=====================================
&lt;ul&gt;
&lt;li&gt;Major optimizations to improve performance of initial sync and event sending
in large rooms (by up to 10x)&lt;&#x2F;li&gt;
&lt;li&gt;Media repository now includes a Content-Length header on media downloads.&lt;&#x2F;li&gt;
&lt;li&gt;Improve quality of thumbnails by changing resizing algorithm.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.6.0a released!</title>
		<published>2014-12-19T00:00:00+00:00</published>
		<updated>2014-12-19T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2014/12/19/synapse-0-6-0a-released/" type="text/html"/>
		<id>/blog/2014/12/19/synapse-0-6-0a-released/</id>
		<content type="html">&lt;p&gt;We&#x27;re proud to announce the new 0.6.0 major release of Synapse: the Python reference implementation of Matrix - as well as 0.6.0 of the AngularJS example Matrix client, as a special early Christmas present from the Matrix team :)&lt;&#x2F;p&gt;
&lt;p&gt;The main priority here has been hunting down stability bugs whilst also adding in a few more features.  The most exciting new feature is the new Media&#x2F;Content API: this allows every homeserver to replicate, cache and thumbnail any files associated with Matrix rooms, rather than relying on retrieving them from the origin homeserver as was previously the case.  This is really cool, as it effectively makes Matrix a distributed content distribution network and gives the same replication semantics to file attachments as to the rest of JSON in rooms.&lt;&#x2F;p&gt;
&lt;p&gt;We&#x27;ve also landed a major new branch which changes the way events are represented internally in order to make them immutable, and fixes a whole range of minor stability issues.  In other news, performance issues are still a work in progress...&lt;&#x2F;p&gt;
&lt;p&gt;To get involved, head over to &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&lt;&#x2F;a&gt; and install and upgrade today!&lt;&#x2F;p&gt;
&lt;code&gt;
Changes in synapse 0.6.0 (2014-12-19)
=====================================
&lt;ul&gt;
&lt;li&gt;Add new API for media upload and download that supports thumbnailing.&lt;&#x2F;li&gt;
&lt;li&gt;Replicate media uploads over multiple homeservers so media is always served
to clients from their local homeserver.  This obsoletes the
--content-addr parameter and confusion over accessing content directly
from remote homeservers.&lt;&#x2F;li&gt;
&lt;li&gt;Implement exponential backoff when retrying federation requests when
sending to remote homeservers which are offline.&lt;&#x2F;li&gt;
&lt;li&gt;Implement typing notifications.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bugs where we sent events with invalid signatures due to bugs where
we incorrectly persisted events.&lt;&#x2F;li&gt;
&lt;li&gt;Improve performance of database queries involving retrieving events.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
&lt;code&gt;
Changes in Matrix Angular SDK 0.6.0 (2014-12-19)
================================================
&lt;p&gt;Breaking changes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Uploading files in the web client will now hit the new content repository URL
introduced in Synapse 0.6, and be incompatible with previous Matrix clients.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Bug fixes:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fixed a bug which caused the event stream to become wedged when the computer is asleep.&lt;&#x2F;li&gt;
&lt;li&gt;Fixed a bug which caused the recents to update but not the message window.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Features:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Typing notifications will now be sent.&lt;&#x2F;li&gt;
&lt;li&gt;Typing notifications will now be displayed for other users.&lt;&#x2F;li&gt;
&lt;li&gt;Use the new content repository introduced in Synapse 0.6 when uploading files.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Improvements:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Display more error dialogs rather than silently failing.&lt;&#x2F;li&gt;
&lt;li&gt;Display loading spinners on signup.&lt;&#x2F;li&gt;
&lt;li&gt;Display feedback when joining a room.&lt;&#x2F;li&gt;
&lt;li&gt;CTRL + clicking on a recents entry will now open that room in a new tab.&lt;&#x2F;li&gt;
&lt;li&gt;Clicking on links in messages will now open them in a new tab.&lt;&#x2F;li&gt;
&lt;li&gt;Provide a progress dialog when uploading files.&lt;&#x2F;li&gt;
&lt;li&gt;Display a red bar when the event stream connection is lost for an extended period of time.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.5.4 released</title>
		<published>2014-12-03T00:00:00+00:00</published>
		<updated>2014-12-03T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2014/12/03/synapse-0-5-4-released/" type="text/html"/>
		<id>/blog/2014/12/03/synapse-0-5-4-released/</id>
		<content type="html">&lt;p&gt;We just pushed a bugfix update to Synapse 0.5, mainly to fix a memory leak where federated events could get leaked whilst retrying to send them to a remote server which is unavailable.  Please upgrade, especially if you&#x27;ve noticed synapse hogging RAM!&lt;&#x2F;p&gt;
&lt;code&gt;
Changes in synapse 0.5.4 (2014-12-03)
=====================================
&lt;ul&gt;
&lt;li&gt;Fix presence bug where some rooms did not display presence updates for
remote users.&lt;&#x2F;li&gt;
&lt;li&gt;Do not log SQL timing log lines when started with &amp;quot;-v&amp;quot;&lt;&#x2F;li&gt;
&lt;li&gt;Fix potential memory leak.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;code&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.5.3a released!</title>
		<published>2014-11-29T00:00:00+00:00</published>
		<updated>2014-11-29T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2014/11/29/synapse-0-5-3a-released/" type="text/html"/>
		<id>/blog/2014/11/29/synapse-0-5-3a-released/</id>
		<content type="html">&lt;p&gt;Since we exited alpha and released Synapse 0.5.0 last week there&#x27;s been a flurry of bug fix releases as we ran around firefighting some of the more exciting problems which popped up thanks to merging the federation-auth and event-signing branches.&lt;&#x2F;p&gt;
&lt;p&gt;We released 0.5.3a on Nov 27, which seems to now be pretty stable - if you were holding off on upgrading your homeserver and trying to federate with the new 0.5 release branch, now would be a great time to press the button!&lt;&#x2F;p&gt;
&lt;p&gt;Most excitingly, we believe we have &lt;strong&gt;finally fixed the PyNaCL dependency problems&lt;&#x2F;strong&gt; which have plagued pretty much anyone setting up a homeserver.  This was a problem in PyNaCL itself - huge thanks to Mark for hunting it down and sending the PyNaCL team &lt;a href=&quot;http:&#x2F;&#x2F;git.io&#x2F;1Rr5OA&quot;&gt;pull&lt;&#x2F;a&gt; &lt;a href=&quot;http:&#x2F;&#x2F;git.io&#x2F;SUHmBA&quot;&gt;requests&lt;&#x2F;a&gt; to get it fixed.  As a result, installing synapse as of 0.5.3a really should be a one-liner at last (please let us know if it isn&#x27;t!):&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;pip install --user --process-dependency-links https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;tarball&#x2F;master&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;The full changelog of what&#x27;s been going on since 0.5.0 is as follows:&lt;&#x2F;p&gt;
&lt;pre&gt;
Changes in synapse 0.5.3a (2014-11-27)
=====================================

 * Depend on a fixed version of PyNaCL
 * Fix bug that caused joining a remote room to fail if a single event was not
   signed correctly.
 * Fix bug which caused servers to continuously try and fetch events from other
   servers.

Changes in synapse 0.5.2 (2014-11-26)
=====================================

 * Fix major bug that caused rooms to disappear from people&#x27;s initial sync.

Changes in synapse 0.5.1 (2014-11-26)
=====================================
See UPGRADES.rst for specific instructions on how to upgrade.

 * Fix bug where we served up an Event that did not match its signatures.
 * Fix regression where we no longer correctly handled the case where a
   homeserver receives an event for a room it doesn&#x27;t recognise (but is in.)
&lt;&#x2F;pre&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse enters beta with the release of v0.5.0!</title>
		<published>2014-11-20T00:00:00+00:00</published>
		<updated>2014-11-20T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2014/11/20/synapse-enters-beta-with-the-release-of-v0-5-0/" type="text/html"/>
		<id>/blog/2014/11/20/synapse-enters-beta-with-the-release-of-v0-5-0/</id>
		<content type="html">&lt;p&gt;We&#x27;re really excited to release the biggest update yet to Synapse (the python&#x2F;twisted reference Matrix homeserver implementation) - version 0.5.0 is out!&lt;&#x2F;p&gt;
&lt;p&gt;This effectively concludes our alpha testing phase - Synapse&#x27;s security model is now feature complete and we are now cautiously encouraging people to run their own Synapse installation on the &#x27;net; federate up; and help us squash all and any bugs as we get beta testing.&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.5.0 has huge database schema changes from previous versions as we have landed both the event-signing and federation-authorisation branches and so added full cryptographic signing of all matrix events and unified the client-server and server-server model of events&#x2F;PDUs.  As a result, migrating history is Hard - we recommend a clean start if possible; if not, come talk to us in #matrix:matrix.org.  UPGRADE.rst has the details.&lt;&#x2F;p&gt;
&lt;p&gt;The full changelog is as per below - please upgrade your homeserver or install a new one if you&#x27;re new here and join Matrix and help us create a robust open distributed messaging fabric for the web!&lt;&#x2F;p&gt;
&lt;pre&gt;
Changes in synapse 0.5.0 (2014-11-19)
=====================================
This release includes changes to the federation protocol and client-server API
that is not backwards compatible.

This release also changes the internal database schemas and so requires servers to
drop their current history. See UPGRADES.rst for details.

Homeserver:
 * Add authentication and authorization to the federation protocol. Events are
   now signed by their originating homeservers.
 * Implement the new authorization model for rooms.
 * Split out web client into a separate repository: matrix-angular-sdk.
 * Change the structure of PDUs.
 * Fix bug where user could not join rooms via an alias containing 4-byte
   UTF-8 characters.
 * Merge concept of PDUs and Events internally.
 * Improve logging by adding request ids to log lines.
 * Implement a very basic room initial sync API.
 * Implement the new invite&#x2F;join federation APIs.

Webclient:
 * The webclient has been moved to a separate repository.
&lt;&#x2F;pre&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.3.4 released!</title>
		<published>2014-09-25T00:00:00+00:00</published>
		<updated>2014-09-25T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2014/09/25/synapse-0-3-4-released/" type="text/html"/>
		<id>/blog/2014/09/25/synapse-0-3-4-released/</id>
		<content type="html">&lt;p&gt;Hi all,&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.3.4 is out! The main changes here are a huge fleet of bugfixes to the webclient, and the addition of TURN support for VoIP relaying. This makes VoIP&#x2F;Video call setup much more reliable (although the UI still needs some love).&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, we set an IRC bridge (&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;tm604&#x2F;Matrix-IRCBridge&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;tm604&#x2F;Matrix-IRCBridge&lt;&#x2F;a&gt;) running linking #matrix:matrix.org and #matrix-dev:matrix.org to their Freenode counterparts (#matrix &amp;amp; #matrix-dev respectively) - much fun to see innocent IRC users assimilated up into Matrix, and for us to now be using Matrix for &#x2F;all&#x2F; our development chat and interaction (whether it&#x27;s through a Matrix client or an IRC client).&lt;&#x2F;p&gt;
&lt;p&gt;To upgrade to the latest homeserver, just &lt;code&gt;git pull &amp;amp;&amp;amp; .&#x2F;synctl restart&lt;&#x2F;code&gt;.  If you want to start playing with VoIP in earnest on your own homeserver, you&#x27;ll need to install a TURN server - see &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse&#x2F;blob&#x2F;master&#x2F;docs&#x2F;turn-howto.rst&quot;&gt;docs&#x2F;turn-howto.rst&lt;&#x2F;a&gt; for details on how to set one up.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;a href=&quot;http:&#x2F;&#x2F;matrix.org&#x2F;alpha&quot;&gt;http:&#x2F;&#x2F;matrix.org&#x2F;alpha&lt;&#x2F;a&gt; has already been upgraded to 0.3.4, so feel free to play with all the new stuff there.&lt;&#x2F;p&gt;
&lt;p&gt;thanks,&lt;&#x2F;p&gt;
&lt;p&gt;Matthew&lt;&#x2F;p&gt;
&lt;h1 id=&quot;changes-in-synapse-0-3-4-2014-09-25&quot;&gt;Changes in synapse 0.3.4 (2014-09-25)&lt;&#x2F;h1&gt;
&lt;p&gt;This version adds support for using a TURN server. See docs&#x2F;turn-howto.rst on
how to set one up.&lt;&#x2F;p&gt;
&lt;p&gt;Homeserver:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add support for redaction of messages.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where inviting a user on a remote home server could take up to
20-30s.&lt;&#x2F;li&gt;
&lt;li&gt;Implement a get current room state API.&lt;&#x2F;li&gt;
&lt;li&gt;Add support specifying and retrieving turn server configuration.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Webclient:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add button to send messages to users from the home page.&lt;&#x2F;li&gt;
&lt;li&gt;Add support for using TURN for VoIP calls.&lt;&#x2F;li&gt;
&lt;li&gt;Show display name change messages.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where the client didn&#x27;t get the state of a newly joined room
until after it has been refreshed.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bugs with tab complete.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where holding down the down arrow caused chrome to chew 100% CPU.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where desktop notifications occasionally used &amp;quot;Undefined&amp;quot; as the
display name.&lt;&#x2F;li&gt;
&lt;li&gt;Fix more places where we sometimes saw rooms as IDs rather than aliases.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug which caused lag when entering text in the text box.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.3.3 released</title>
		<published>2014-09-22T00:00:00+00:00</published>
		<updated>2014-09-22T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2014/09/22/synapse-0-3-3-released/" type="text/html"/>
		<id>/blog/2014/09/22/synapse-0-3-3-released/</id>
		<content type="html">&lt;p&gt;Hello world,&lt;&#x2F;p&gt;
&lt;p&gt;Synapse 0.3.3 was released today, concentrating on both feature &amp;amp; stability improvements on the webclient.  The big news is that 1:1 video calling via WebRTC is implemented (although we&#x27;re still working on some stability issues, and Synapse doesn&#x27;t support TURN yet.  This will be coming in the next few days however!).&lt;&#x2F;p&gt;
&lt;p&gt;Play with the demo server at http:&#x2F;&#x2F;matrix.org&#x2F;alpha, or update your own homeserver with a &lt;code&gt;git pull &amp;amp;&amp;amp; .&#x2F;synctl restart&lt;&#x2F;code&gt; or by cloning a new checkout with &lt;code&gt;git clone https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse.git&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;--Matthew&lt;&#x2F;p&gt;
&lt;h1 id=&quot;changes-in-synapse-0-3-3-2014-09-22&quot;&gt;Changes in synapse 0.3.3 (2014-09-22)&lt;&#x2F;h1&gt;
&lt;p&gt;Homeserver:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug where you continued to get events for rooms you had left.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Webclient:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Add support for video calls with basic UI.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where one to one chats were named after your display name rather
than the other person&#x27;s.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug which caused lag when typing in the textarea.&lt;&#x2F;li&gt;
&lt;li&gt;Refuse to run on browsers we know won&#x27;t work.&lt;&#x2F;li&gt;
&lt;li&gt;Trigger pagination when joining new rooms.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where we sometimes didn&#x27;t display invitations in recents.&lt;&#x2F;li&gt;
&lt;li&gt;Automatically join room when accepting a VoIP call.&lt;&#x2F;li&gt;
&lt;li&gt;Disable outgoing and reject incoming calls on browsers we don&#x27;t support
VoIP in.&lt;&#x2F;li&gt;
&lt;li&gt;Don&#x27;t display desktop notifications for messages in the room you are
non-idle and speaking in.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse 0.3.2 released</title>
		<published>2014-09-18T00:00:00+00:00</published>
		<updated>2014-09-18T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2014/09/18/synapse-0-3-2-released/" type="text/html"/>
		<id>/blog/2014/09/18/synapse-0-3-2-released/</id>
		<content type="html">&lt;p&gt;We just pushed out a major new release (0.3.0) of Synapse: the current reference Matrix homeserver, swiftly followed by some hotfixes (0.3.1, 0.3.2).&lt;&#x2F;p&gt;
&lt;p&gt;The big changes are:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Change the VoIP setup API to be more efficient (bundling together media stream candidates into a single setup object). &lt;strong&gt;API breaking change!&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Change the Registration API to be more consistent. &lt;strong&gt;API breaking change!&lt;&#x2F;strong&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Lots of nice usability refinements to webclient - e.g. per-message notifications; cursor-key history navigation; faster room loading&lt;&#x2F;li&gt;
&lt;li&gt;More bugfixes and stability fixes on the homeserver&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Please reload the page if you&#x27;re lurking on http:&#x2F;&#x2F;matrix.org&#x2F;alpha to pull in the new webclient.&lt;&#x2F;p&gt;
&lt;p&gt;If you&#x27;re running a homeserver - please upgrade with a quick &lt;code&gt;git pull &amp;amp;&amp;amp; .&#x2F;synctl restart&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;If you&#x27;re not running a homeserver... why not? ;D&lt;&#x2F;p&gt;
&lt;p&gt;--Matthew&lt;&#x2F;p&gt;
&lt;h1 id=&quot;changes-in-synapse-0-3-2-2014-09-18&quot;&gt;Changes in synapse 0.3.2 (2014-09-18)&lt;&#x2F;h1&gt;
&lt;p&gt;Webclient:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix regression where an empty &amp;quot;bing words&amp;quot; list in old accounts didn&#x27;t send
notifications when it should have done.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-0-3-1-2014-09-18&quot;&gt;Changes in synapse 0.3.1 (2014-09-18)&lt;&#x2F;h1&gt;
&lt;p&gt;This is a release to hotfix v0.3.0 to fix two regressions.&lt;&#x2F;p&gt;
&lt;p&gt;Webclient:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix a regression where we sometimes displayed duplicate events.&lt;&#x2F;li&gt;
&lt;li&gt;Fix a regression where we didn&#x27;t immediately remove rooms you were
banned in from the recents list.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;changes-in-synapse-0-3-0-2014-09-18&quot;&gt;Changes in synapse 0.3.0 (2014-09-18)&lt;&#x2F;h1&gt;
&lt;p&gt;See UPGRADE for information about changes to the client server API, including
breaking backwards compatibility with VoIP calls and registration API.&lt;&#x2F;p&gt;
&lt;p&gt;Homeserver:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;When a user changes their displayname or avatar the server will now update
all their join states to reflect this.&lt;&#x2F;li&gt;
&lt;li&gt;The server now adds &amp;quot;age&amp;quot; key to events to indicate how old they are. This
is clock independent, so at no point does any server or webclient have to
assume their clock is in sync with everyone else.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where we didn&#x27;t correctly pull in missing PDUs.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where prev_content key wasn&#x27;t always returned.&lt;&#x2F;li&gt;
&lt;li&gt;Add support for password resets.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Webclient:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Improve page content loading.&lt;&#x2F;li&gt;
&lt;li&gt;Join&#x2F;parts now trigger desktop notifications.&lt;&#x2F;li&gt;
&lt;li&gt;Always show room aliases in the UI if one is present.&lt;&#x2F;li&gt;
&lt;li&gt;No longer show user-count in the recents side panel.&lt;&#x2F;li&gt;
&lt;li&gt;Add up &amp;amp; down arrow support to the text box for message sending to step
through your sent history.&lt;&#x2F;li&gt;
&lt;li&gt;Don&#x27;t display notifications for our own messages.&lt;&#x2F;li&gt;
&lt;li&gt;Emotes are now formatted correctly in desktop notifications.&lt;&#x2F;li&gt;
&lt;li&gt;The recents list now differentiates between public &amp;amp; private rooms.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bug where when switching between rooms the pagination flickered before
the view jumped to the bottom of the screen.&lt;&#x2F;li&gt;
&lt;li&gt;Add support for password resets.&lt;&#x2F;li&gt;
&lt;li&gt;Add bing word support.&lt;&#x2F;li&gt;
&lt;li&gt;Update VoIP implementation to use new API&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Registration API:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;The registration API has been overhauled to function like the login API. In
practice, this means registration requests must now include the following:
&#x27;type&#x27;:&#x27;m.login.password&#x27;. See UPGRADE for more information on this.&lt;&#x2F;li&gt;
&lt;li&gt;The &#x27;user_id&#x27; key has been renamed to &#x27;user&#x27; to better match the login API.&lt;&#x2F;li&gt;
&lt;li&gt;There is an additional login type: &#x27;m.login.email.identity&#x27;.&lt;&#x2F;li&gt;
&lt;li&gt;The command client and web client have been updated to reflect these changes.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>Synapse v0.2.3 released</title>
		<published>2014-09-13T00:00:00+00:00</published>
		<updated>2014-09-13T00:00:00+00:00</updated>
		<link rel="alternate" href="/blog/2014/09/13/synapse-v0-2-3-released/" type="text/html"/>
		<id>/blog/2014/09/13/synapse-v0-2-3-released/</id>
		<content type="html">&lt;p&gt;We&#x27;re back home from TechCrunch where we had a great time arguing the pros and cons of Matrix versus XMPP with anyone and everyone - thanks to all who came to talk to us!&lt;&#x2F;p&gt;
&lt;p&gt;Meanwhile, Synapse v0.2.3 was released yesterday: the emphasis this week has been on improving stability issues on the server, and lots of cosmetic and functionality fixes on the webclient.&lt;&#x2F;p&gt;
&lt;p&gt;If you&#x27;re running a homeserver, please upgrade asap - upgrading has never been easier - assuming you&#x27;ve checked out the master branch, simply:&lt;&#x2F;p&gt;
&lt;pre&gt;
git pull
.&#x2F;synctl restart
&lt;&#x2F;pre&gt;
&lt;p&gt;...and you will be up and running on 0.2.3.  We keep the master branch tracking the latest release.  &lt;a class=&quot;moz-txt-link-freetext&quot; href=&quot;http:&#x2F;&#x2F;matrix.org&#x2F;alpha&quot;&gt;http:&#x2F;&#x2F;matrix.org&#x2F;alpha&lt;&#x2F;a&gt; is already on the latest release should you wish to experiment first!&lt;&#x2F;p&gt;
&lt;p&gt;Alternatively, if you&#x27;re installing from scratch, try:&lt;&#x2F;p&gt;
&lt;pre&gt;
git clone https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;synapse.git
python setup.py develop --user
.&#x2F;synctl start # to generate a default config
.&#x2F;synctl start # to actually set it running
&lt;&#x2F;pre&gt;
&lt;p&gt;and then head over to http:&#x2F;&#x2F;localhost:8008 to play with your very own Matrix homeserver!&lt;&#x2F;p&gt;
&lt;h1 id=&quot;changes-in-synapse-0-2-3-2014-09-12&quot;&gt;Changes in synapse 0.2.3 (2014-09-12)&lt;&#x2F;h1&gt;
&lt;p&gt;Homeserver:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Fix bug where we stopped sending events to remote home servers if a
user from that home server left, even if there were some still in the
room.&lt;&#x2F;li&gt;
&lt;li&gt;Fix bugs in the state conflict resolution where it was incorrectly
rejecting events.&lt;&#x2F;li&gt;
&lt;li&gt;Many stability fixes&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Webclient:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Display room names and topics.&lt;&#x2F;li&gt;
&lt;li&gt;Allow setting&#x2F;editing of room names and topics.&lt;&#x2F;li&gt;
&lt;li&gt;Display information about rooms on the main page.&lt;&#x2F;li&gt;
&lt;li&gt;Handle ban and kick events in real time.&lt;&#x2F;li&gt;
&lt;li&gt;VoIP UI and reliability improvements.&lt;&#x2F;li&gt;
&lt;li&gt;Add glare support for VoIP.&lt;&#x2F;li&gt;
&lt;li&gt;Improvements to initial startup speed.&lt;&#x2F;li&gt;
&lt;li&gt;Don&#x27;t display duplicate join events.&lt;&#x2F;li&gt;
&lt;li&gt;Show message sent&#x2F;sending state via opacity&lt;&#x2F;li&gt;
&lt;li&gt;Multiline message sending support&lt;&#x2F;li&gt;
&lt;li&gt;Many other bug &amp;amp; stability fixes&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
	</entry>
</feed>
