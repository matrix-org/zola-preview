<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Blog</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <link rel="stylesheet" href="/style.css" />

    </head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            current">
            Blog
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="docs-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true" >
            <label for="docs-submenu-checkbox" class="submenu-title">Documentation <div class="arrow"></div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    
                    <a href="&#x2F;docs&#x2F;chat_basics&#x2F;">Chat basics</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;communities&#x2F;">Communities</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;technical&#x2F;">Technical docs</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;legacy&#x2F;">Legacy documentation</a>
                    
                </div>
            </div>
        </div>
        
        
        
        
        
        <div class="section-wrap">
            <input id="ecosystem-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true" >
            <label for="ecosystem-submenu-checkbox" class="submenu-title">Ecosystem <div class="arrow"></div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        <div class="content">
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2022&#x2F;01&#x2F;07&#x2F;this-week-in-matrix-2022-01-07&#x2F;" title="This Week in Matrix 2022-01-07">This Week in Matrix 2022-01-07</a></h1>
            <span>
                07.01.2022 19:58
                —
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                —
                <a href="/author/thib">
                    Thib
                </a>
            </span>
            <br>
            <small>Last update: 07.01.2022 19:18</small>
        </header>
        <div>
            <h2 id="matrix-live">Matrix Live 🎙</h2>
<p>What a pleasure it is to be back with the community for the new year! This week Erlend is detailing what Commune is, and I'm flabbergasted by how well thought-through the project is.</p>
<iframe src="https://www.youtube.com/embed/T0bm6JWV1js" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="dept-of-we-ve-been-away-for-holidays">Dept of we've been away for holidays</h2>
<p>This week in Matrix should be called Three Weeks in Matrix, since there hasn't been TWIM updates during the holiday season. <a href="https://matrix.to/#/@deepbluev7:neko.dev">Nico</a> has published a <a href="https://blog.neko.dev/posts/bootleg-twim.html">first</a> and <a href="https://blog.neko.dev/posts/inofficial-twim-2021-12-31.html">second communitwim</a> while I was away. All the news reports since the last official TWIM still made it to the post you're currently reading!</p>
<h2 id="dept-of-spec-scroll">Dept of Spec 📜</h2>
<p><a href="https://matrix.to/#/@travis:t2l.io">TravisR</a> says</p>
<blockquote>
<p><em>Your regular spec person, anoa, is out today so you're stuck with me, not-anoa. This time I got the script to work though 😇</em></p>
<p>Here's your weekly spec update! The heart of Matrix is the specification - and this is modified by Matrix Spec Change (MSC) proposals. Learn more about how the process works at https://matrix.org/docs/spec/proposals.</p>
<h2 id="msc-status">MSC Status</h2>
<p><em>Note</em>: This is for the last 3 weeks given TWIM holiday :)</p>
<p><strong>Merged MSCs:</strong></p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3550">MSC3550: Allow HTTP 403 as a response to profile lookups</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3442">MSC3442: Move the prev_content key to unsigned</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3419">MSC3419: Allow guests to send more event types</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3283">MSC3283: Expose capabilities for profile actions</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3231">MSC3231: Token authenticated registration</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3173">MSC3173: Expose stripped state events to any potential joiner</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3069">MSC3069: Allow guests to use /account/whoami</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2778">MSC2778: Providing authentication method for appservice users</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2758">MSC2758: Proposal for common identifier grammar</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2732">MSC2732: Olm fallback keys</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2312">MSC2312: Matrix URI scheme proposal</a></li>
</ul>
<p><strong>MSCs in Final Comment Period:</strong></p>
<ul>
<li><em>No MSCs are in FCP.</em></li>
</ul>
<p><strong>New MSCs:</strong></p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3618">MSC3618: Add proposal to simplify federation /send response</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3613">MSC3613: Combinatorial join rules</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3604">[WIP: Not ready for review/impl] MSC3604: Room Version 10</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3593">MSC3593: Safety Controls through a generic Administration API</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3592">MSC3592: Markup locations for PDF documents</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3589">MSC3589: Room version 9 as the default room version</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3588">WIP: MSC3588: Stories As Rooms</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3582">MSC3582: Remove m.room.message.feedback</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3575">MSC3575 Sliding Sync (aka Sync v3)</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3574">MSC3574: Marking up resources</a></li>
</ul>
<p><strong>Closed MSCs:</strong>
<em>Sadly, not every MSC makes it to the end.</em></p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3585">MSC3585: Allow the base event to be omitted from /federation/v1/event_auth response</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2516">MSC2516: Add a new message type for voice messages</a></li>
</ul>
<h2 id="spec-core-team">Spec Core Team</h2>
<p>In terms of Spec Core Team MSC focus for <del>this week</del> the last little bit, we've been working on getting MSCs merged into the formal spec itself in preparation for v1.2 this quarter. We expect the release to happen quite soon and to contain <a href="https://github.com/matrix-org/matrix-doc/pull/3610">Spaces</a>, <a href="https://github.com/matrix-org/matrix-doc/pull/3387">room versions 8 and 9</a>, and <a href="https://github.com/matrix-org/matrix-doc/pull/2918">refresh tokens</a> (no spec PR yet) in addition to all the other wonderful stuff which has landed.</p>
<p>The merged MSCs can be seen over at <a href="https://spec.matrix.org/unstable/">https://spec.matrix.org/unstable/</a> where they're queued up for the next release. Look out for <code>Added in v1.2</code> labels throughout the spec, denoting what is new and exciting.</p>
<h2 id="random-msc-of-the-week">Random MSC of the week</h2>
<p>The random MSC this week is <a href="https://github.com/matrix-org/matrix-doc/pull/2192">MSC2192: Inline widgets</a> (I promise it was random, after a few re-rolls). Inline widgets are a concept that allows for rich functionality in the timeline without needing to necessarily specify an explicit event type. For example, video embeds, minigames, etc could all be represented by inline widgets instead of dedicated event types.</p>
<p>The MSC needs updating to handle <a href="https://github.com/matrix-org/matrix-doc/pull/1767">MSC1767: Extensible Events</a> (and friends), but once there it could be a very powerful bit of functionality, with free fallback thanks to Extensible Events. </p>
<h2 id="the-graph">The graph</h2>
<p>Here's a stacked graph of MSC progress:</p>
<p><img src="/blog/img/732a07fb40babb01f102bf5bc700fa046457aa45.png" alt="" /></p>
</blockquote>
<p><a href="https://matrix.to/#/@kegan:matrix.org">Kegan</a> announces</p>
<blockquote>
<p>Sliding sync (aka sync v3) is described in <a href="https://github.com/matrix-org/matrix-doc/pull/3575">MSC3575</a> - it's still very early days for the proposal which means a lot can change: and YOU can be a part of that. Please take a look at the MSC and provide any and all feedback, be it on the names of keys, format of JSON objects, or the kinds of operations that can be performed. I'm particularly interested in feedback from client developers who have complex room list sort orders or room list filtering requirements and bot/bridge developers who typically don't have a visible room list UI. Any and all feedback at this stage is welcome, visit <a href="https://matrix.to/#/#sliding-sync:matrix.org">#sliding-sync:matrix.org</a> to join the discussion.</p>
</blockquote>
<h2 id="dept-of-servers-europea">Dept of Servers 🏢</h2>
<h3 id="synapse-website">Synapse (<a href="https://github.com/matrix-org/synapse/">website</a>)</h3>
<p>Synapse is the reference homeserver for Matrix</p>
<p><a href="https://matrix.to/#/@callahad:matrix.org">callahad</a> announces</p>
<blockquote>
<p>We're back! New year, new release candidate: we published <a href="https://github.com/matrix-org/synapse/releases/tag/v1.50.0rc1">Synapse 1.50.0rc1</a> today, marking the end of life for our Python 3.6 and PostgreSQL 9.6 support. We've also extracted some shared utilities into their own package, <a href="https://pypi.org/project/matrix-common/">matrix-common</a>, which is used by Synapse, Sygnal, and Sydent.</p>
<p>We'll talk more about what's in 1.50 next week when it formally releases.</p>
<p>The Synapse team is expecting to spend most of January on behind-the-scenes work as we gear up to virtually host FOSDEM again! Members of the team will be presenting two talks this year: Shay on <a href="https://fosdem.org/2022/schedule/event/matrix_events_uninitiatied/">Events for the Uninitiated</a>, and Brendan on <a href="https://fosdem.org/2022/schedule/event/matrix_extend_synapse/">Beyond the Matrix: Extend the capabilities of your Synapse homeserver</a>. Check out the full devroom schedule <a href="https://fosdem.org/2022/schedule/track/matrixorg_foundation_and_community/">here</a>.</p>
</blockquote>
<h3 id="matrix-media-repo-website">matrix-media-repo (<a href="https://github.com/turt2live/matrix-media-repo">website</a>)</h3>
<p>Matrix media repository with multi-domain in mind.</p>
<p><a href="https://matrix.to/#/@travis:t2l.io">TravisR</a> says</p>
<blockquote>
<p><del><a href="https://github.com/turt2live/matrix-media-repo/releases/tag/v1.2.9">v1.2.9</a></del> <a href="https://github.com/turt2live/matrix-media-repo/releases/tag/v1.2.10">v1.2.10</a> got released as a maintenance update. With early support for Matrix 1.1, S3 storage classes, and blurhash fixes it's worth the upgrade though there are other goodies - check out the changelog, and report bugs to the issue tracker 🙂</p>
</blockquote>
<h2 id="homeserver-deployment-inbox-tray">Homeserver Deployment 📥️</h2>
<h3 id="helm-chart-website">Helm Chart (<a href="https://gitlab.com/ananace/charts">website</a>)</h3>
<p>Matrix Kubernetes applications packaged into helm charts</p>
<p><a href="https://matrix.to/#/@ace:kittenface.studio">Ananace</a> reports</p>
<blockquote>
<p>And as a end-of-year update, <a href="https://gitlab.com/ananace/charts">my Helm Charts</a> have gotten updated yet again. With element-web ending up on 1.9.8, matrix-synapse on 1.49.2 (and .1 before that), and matrix-media-repo on 1.2.10</p>
</blockquote>
<h3 id="dendrite-helm-chart-website">Dendrite Helm Chart (<a href="https://github.com/k8s-at-home/charts/tree/master/charts/incubator/dendrite">website</a>)</h3>
<p>Helm Chart to deploy Dendrite on Kubernetes</p>
<p><a href="https://matrix.to/#/@gh-jonnobrow:matrix.org">jonnobrow</a> reports</p>
<blockquote>
<p>The first iteration of a Dendrite Helm Chart has been released under the <a href="https://github.com/k8s-at-home/charts">k8s-at-home charts repository</a>. It currently supports a full monolithic deployment and requires minimal configuration to get up and running (just need to generate a matrix key and mount it as per the instructions).</p>
<p>If polylith is your thing then I recommend <a href="https://github.com/S7evinK/dendrite-helm">the chart by S7evinK</a> for now, although it is likely these charts will merge in the future.</p>
<p>The chart and documentation are available here: <a href="https://github.com/k8s-at-home/charts/tree/master/charts/incubator/dendrite">https://github.com/k8s-at-home/charts/tree/master/charts/incubator/dendrite</a></p>
</blockquote>
<h2 id="dept-of-bridges-bridge-at-night">Dept of Bridges 🌉</h2>
<h3 id="matrix-webhook-receiver-website">Matrix Webhook Receiver (<a href="https://github.com/HarHarLinks/matrix-webhook-receiver">website</a>)</h3>
<p>An add-on for the matrix-appservice-webhooks bridge. Webhooks are essentially web interfaces for applications to &quot;push&quot; data to. The bridge can receive messages in a certain format, which is nice if the notifying app can be configured. Often it cannot.</p>
<p><a href="https://matrix.to/#/@kim:sosnowkadub.de">kim</a> says</p>
<blockquote>
<p><a href="https://github.com/HarHarLinks/matrix-webhook-receiver">matrix-webhook-receiver</a> has hit 1.1.0!
Give feedback or talk to us about it over in <a href="https://matrix.to/#/#matrix-webhook-receiver:matrix.org">#matrix-webhook-receiver:matrix.org</a>! 🙂</p>
<h3 id="features">Features</h3>
<ul>
<li><a href="https://github.com/HarHarLinks/matrix-webhook-receiver#advanced-templating">Advanced Templating</a>! It is now possible to set <code>format</code> and <code>msgtype</code> based on arbitrary values from the webhook JSON via Jinja2. Shoutout to <strong>qg</strong> for suggesting this and giving their feedback!</li>
<li>compatibility with matrix-appservice-webhooks forks that read <code>avatarUrl</code> instead of <code>avatar_url</code></li>
<li>allow mxc:// URL avatars</li>
<li>improvements to the GUI, including automatically resizing text areas and msc:// avatar URL preview</li>
<li>improvements to templates/examples including making use of above features</li>
<li>more documentation, including <a href="https://github.com/HarHarLinks/matrix-webhook-receiver#tips--tricks">Tips &amp; Tricks</a> and <a href="https://github.com/HarHarLinks/matrix-webhook-receiver#related-projects">Related Projects</a></li>
</ul>
<h3 id="notable-fixes">Notable Fixes</h3>
<ul>
<li>ability to properly set no avatar</li>
<li>work around <a href="https://github.com/turt2live/matrix-appservice-webhooks/issues/97">upstream's newline issue</a> when not using a template</li>
</ul>
<p><strong>Full Changelog</strong>: https://github.com/HarHarLinks/matrix-webhook-receiver/compare/1.0.0...1.1.0</p>
</blockquote>
<h3 id="matrix-hookshot-website">matrix-hookshot (<a href="https://github.com/Half-Shot/matrix-hookshot">website</a>)</h3>
<p>A multi purpose multi platform bridge, formerly known as matrix-github</p>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> says</p>
<blockquote>
<p>Howdy folks, it is the time of the year where everyone scarpers! Anyway, perfect time to announce that <strong>matrix-hookshot has gotten it's first major release!</strong>. 1.0.0 is here!</p>
<p>For those not in the know, the hookshot bridge is used to bridge GitHub, GitLab, JIRA and Generic Webhooks into Matrix rooms. It doesn't just bridge into existing rooms, but can also spawn dynamic rooms based on aliases, send you your notifications in a DM and do lots of other wonderful things!</p>
<p>The notable changes from the 0.1.0 release are:</p>
<ul>
<li>The bridge has now been renamed from matrix-github to matrix-hookshot.</li>
<li>Now supports JIRA and Generic Webhooks in addition to GitHub and GitLab.</li>
<li>Includes new commands and metrics reporting.</li>
<li>Includes <a href="https://half-shot.github.io/matrix-hookshot">complete documentation</a>.</li>
</ul>
<p>You can get involved and start playing with it by checking out the release <a href="https://github.com/Half-Shot/matrix-hookshot/releases/tag/1.0.0">here</a></p>
<p>And that will be my last TWIM entry of the year. Have a good one and stay safe all 🐶</p>
</blockquote>
<p>That was in 2021! <a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> is back in 2022 with more news</p>
<blockquote>
<p>Hey folks! It was only last year we released the 1.0 release of hookshot, after many years of work to get it that far. I'm happy to announce that this week we've got <a href="https://github.com/Half-Shot/matrix-hookshot/releases/tag/1.1.0">another release</a>. There are a number of buxfixes and improved documentation pieces landing (special shoutout to HarHarLinks for ensuring the docs are competent). The highlights are as follows:</p>
<ul>
<li>Added support for Figma webhooks. this also means the archival of my old project <a href="https://github.com/Half-Shot/matrix-figma">matrix-figma</a></li>
<li>Support GitLab wiki page change events.</li>
<li>Added a new script <code>validate-config</code> which allows you to check your config file for simple errors. Handy for people writing ansible roles!</li>
<li>Add support for a html key on generic webhooks to set the HTML content of a Matrix message.</li>
</ul>
<p>The project can be found over at https://github.com/Half-Shot/matrix-hookshot/, with pretty pretty docs at https://half-shot.github.io/matrix-hookshot. We're also in <a href="https://matrix.to/#/#hookshot:half-shot.uk">#hookshot:half-shot.uk</a> if you prefer using Matrix to learn about these things!</p>
</blockquote>
<h3 id="heisenbridge-website">Heisenbridge (<a href="https://github.com/hifi/heisenbridge/">website</a>)</h3>
<p>Heisenbridge is a bouncer-style Matrix IRC bridge.</p>
<p><a href="https://matrix.to/#/@hifi:vi.fi">hifi</a> announces</p>
<blockquote>
<p>Heisenbridge roundup!</p>
<p>Release <del>v1.8.0</del> <del>v1.8.1</del> <del>v1.8.2</del> v1.9.0 🥳</p>
<ul>
<li>Spaces support 🌃</li>
<li>Sort NAMES reply nicks 🔤</li>
<li><code>UNPLUMB</code> network command to force unplumbing without being in the room</li>
<li>Proper SASL external with CertFP with mechanism override option (see notes)</li>
<li>Disconnect and cleanup from networks that have no rooms open ♻️</li>
<li>Reply (and reject) DM requests to ghosts with <code>QUERY</code> command ↪️</li>
<li>Try to keep IRC users in the room at all costs if they are on the IRC channel</li>
<li>Fix assumption of all IRC replies to have arguments</li>
<li>Prevent accidental namespace changes to cause mayhem</li>
<li>Finally convert from homegrown Matrix API stuff to Mautrix</li>
<li>Bump Mautrix requirement to 0.12=&gt;0.14</li>
<li>Conduit support was broken in 1.8.x but fixed again in 1.9.0, sorry</li>
</ul>
<p>Finally there's network level spaces support with a new <code>SPACE</code> command. This creates a new bridge controlled space for the network and automatically manages rooms in and out. There's an issue/feature with Element that all rooms that have been converted to DMs with <code>/converttodm</code> will appear in all bridge spaces. The workaround is to convert them back to regular rooms.</p>
<p>CertFP SASL has been updated to do SASL external flow by default. If you are upgrading and have used CertFP with OFTC you need to run <code>SASL --mechanism=none</code> for it to connect again.</p>
<p>Abandoned networks where the user has left all rooms including the network room will now automatically disconnect and cleanup. This is more in line what people would expect and prevents idle connections from hanging around.</p>
<p>Get your third vaccination from <a href="https://github.com/hifi/heisenbridge/releases">GitHub</a>, <a href="https://pypi.org/project/heisenbridge/">PyPI</a> or <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">matrix-docker-ansible-deploy</a>!</p>
<p>Thanks!</p>
</blockquote>
<h2 id="dept-of-clients-iphone">Dept of Clients 📱</h2>
<h3 id="nheko-website">Nheko (<a href="https://nheko-reborn.github.io">website</a>)</h3>
<p>Desktop client for Matrix using Qt and C++17.</p>
<p><a href="https://matrix.to/#/@deepbluev7:neko.dev">Nico</a> announces</p>
<blockquote>
<p>We just released 0.9.1!</p>
<p>This is a small bug fix release. If you reported an issue, there is a 15% chance it is fixed now! This release also supports pinned messages, although those will only show up after someone changed the pinned messages in a room currently (we didn't want to force a full resync just for such a small feature). The spaces list is also now nested, Nheko offers you quick access to your recently used reactions and Nheko will show you your direct chats in the sidebar. Apart from that there are quite a few bugfixes and smaller improvements, you can find the full changelog and downloads here: https://github.com/Nheko-Reborn/nheko/releases/tag/v0.9.1</p>
<p>Thank you everyone, who helped shape this release!</p>
</blockquote>
<p><a href="https://matrix.to/#/@deepbluev7:neko.dev">Nico</a> reports</p>
<blockquote>
<p>Nheko now is a lot more efficient. We now use one Threadpool instead of 3, got rid of more than 60% of the allocations when scrolling through messages, layout half as much content when scrolling, blurhashes decode in 10% of the time and jdenticons allocate ~10% as much temporary buffers. We also deleted around 1000 lines of unused code. Tooltips also shouldn't steal the mouse focus when scrolling anymore, which could lead to sudden stalls when scrolling.</p>
<p>Additionally edits now replace existing notifications, tastytea added a manpage and fixed blurry or incorrectly sized custom emoji, you can now send custom emotes via the inline completer using ~ and completers now show a scrollable list with more Elements than before. Advanced users can also now opt into an insecure client side secrets storage via a hidden setting.</p>
</blockquote>
<p><a href="https://matrix.to/#/@deepbluev7:neko.dev">Nico</a> says</p>
<blockquote>
<p>We're baaaaack! Anyway, last week Drake just translated all of Nheko into Spanish, you can now zoom in and pan in the image viewer, emojis shouldn't split up into their segments anymore and Nheko should always be sending the qualified version of it (according the to the unicode test files, not by just appending FE0F). Blurhashes should be even faster still and we now have support for running the call event loop on macOS and Windows (although call support is still disabled there for now). </p>
<p>We are also now working to restructure our README. It has a lot of outdated stuff in it and you really want to see screenshots pretty early in the README! You can sneak a peak here: https://nheko.im/nheko-reborn/nheko/-/tree/README_updates</p>
</blockquote>
<h3 id="element-website">Element (<a href="https://element.io">website</a>)</h3>
<p>Everything related to Element but not strictly bound to a client</p>
<p><a href="https://matrix.to/#/@daniellekirkwood:one.ems.host">Danielle</a> reports</p>
<blockquote>
<p>Welcome to a new year at Element!</p>
<p><strong>Threads</strong></p>
<ul>
<li>This week the Threads team has focussed their efforts on improving some of the smaller details and pesky bugs we’ve found in our first rounds of testing.
<ul>
<li>If you’d like to help us test Threads we’ll be asking for help in the Community Testing room over the next few weeks. Join#element-community-testing:matrix.org to stay in the loop.</li>
</ul>
</li>
</ul>
<p><strong>Polls</strong></p>
<ul>
<li>Polls is available in Labs on all clients! While we know there are some minor improvements to be made, we’re proud of where we are and would love for you to start using it!</li>
</ul>
<p><strong>Community Testing</strong></p>
<ul>
<li>Our next session will be on Wednesday, 12th January at 16:00 UTC (17:00 CET). We will be testing the new release candidates on all three platforms! Join us at#element-community-testing:matrix.org</li>
</ul>
</blockquote>
<h3 id="element-web-desktop-website">Element Web/Desktop (<a href="https://github.com/vector-im/element-web">website</a>)</h3>
<p>Secure and independent communication, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-web:matrix.org">#element-web:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@daniellekirkwood:one.ems.host">Danielle</a> reports</p>
<blockquote>
<ul>
<li>Work continues on the integration of PostHog analytics. With your explicit permissions we’ll receive anonymous usage data that will allow us to understand the areas of Element that are helpful (or not). This info will help fuel things like our Information Architecture project.</li>
<li>In labs (you can enable labs in settings on develop.element.io or on Nightly)
<ul>
<li><a href="https://github.com/vector-im/element-meta/issues/56">Information Architecture</a> improvements are still being worked on - try it out by enabling things like the new Spotlight search and Breadcrumbs.</li>
<li>Message Bubbles are improving; We’ve been hard at work preparing them for a release in the coming weeks.</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="element-ios-website">Element iOS (<a href="https://github.com/vector-im/element-ios">website</a>)</h3>
<p>Secure and independent communication for iOS, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-ios:matrix.org">#element-ios:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@daniellekirkwood:one.ems.host">Danielle</a> announces</p>
<blockquote>
<ul>
<li>During the Christmas break we increase the speed of the app launch by 7x! Once stabilised this update will land with you.</li>
<li>Analytics changes have been merged into the RC and opt-in will be available soon.</li>
<li>In development:
<ul>
<li>More Spaces improvements are underway; You’ll soon be able to add rooms to Spaces, update room settings, and have room interactions on the ‘long-press’. </li>
<li>Improved onboarding! We’re hoping to make the first few steps in Element easy by simplifying some of the first tasks users take in the app, including signing up.</li>
<li>We’ve started building Message Bubbles on iOS. This will help to distinguish the messages you send from the messages you receive.</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="element-android-website">Element Android (<a href="https://github.com/vector-im/element-android">website</a>)</h3>
<p>Secure and independent communication for Android, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-android:matrix.org">#element-android:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@daniellekirkwood:one.ems.host">Danielle</a> says</p>
<blockquote>
<ul>
<li>For Android we now have a <a href="https://github.com/vector-im/element-android/projects/7">PR review board</a> to increase visibility into the state of PRs submitted by external contributors!</li>
<li>The new Opt-in screen for PostHog analytics tracking will be released soon.</li>
<li>Work on Message Bubbles has started and we can’t wait to share it with you! 
<ul>
<li>If you have any feedback or questions about Messages Bubbles, please let us know now. </li>
</ul>
</li>
<li>We’re also working on improving the sign up and sign in experience with some micro-improvements landing in the product soon.</li>
<li>We’re sorry for the delay of Element on F-Droid store, it will be available next week.</li>
</ul>
</blockquote>
<h2 id="dept-of-non-chat-clients-control-knobs">Dept of Non Chat Clients 🎛️</h2>
<h3 id="populus-viewer-website">Populus Viewer (<a href="https://github.com/opentower/populus-viewer">website</a>)</h3>
<p>A Social Annotation Tool Powered by Matrix</p>
<p><a href="https://matrix.to/#/@gleachkr:matrix.org">gleachkr</a> says</p>
<blockquote>
<p>A lot has happened with <a href="https://github.com/opentower/populus-viewer">populus-viewer</a>! </p>
<ul>
<li>We now implement <a href="https://github.com/matrix-org/matrix-doc/pull/3574">MSC2574</a>! This MSC proposes a standard format for marking up resources (PDFs, other document formats, audiovisual media, websites, geospatial data...) using Matrix.</li>
<li>Room avatars are now displayed in the welcome view for PDF rooms</li>
<li>There's now a UI for using spaces to manage and share PDF collections</li>
<li>Reactions now work like element-web: click to mirror an existing reaction or redact your previous reaction</li>
</ul>
<p>Next, I'm aiming to implement <a href="https://github.com/matrix-org/matrix-doc/pull/3592">MSC3592</a>, which proposes a standard format for basic markup on PDFs. Stay tuned! And if you're interested in learning more, come visit <a href="https://matrix.to/#/#opentower:matrix.org">#opentower:matrix.org</a>.</p>
</blockquote>
<blockquote>
<p><img src="/blog/img/TRQKbPOZFUovnoqEoEdwFgek.png" alt="" /></p>
</blockquote>
<h3 id="matrix-wrench-website">Matrix Wrench (<a href="https://gitlab.com/jaller94/matrix-wrench/">website</a>)</h3>
<p>Matrix Wrench is a web client to tweak Matrix rooms.</p>
<p><a href="https://matrix.to/#/@christianp:vector.modular.im">ChristianP</a> announces</p>
<blockquote>
<p>Matrix Wrench is a web client to tweak Matrix rooms. After formerly calling it Matrix Navigator or Matrix Screwdriver, I finally settled on the name Matrix Wrench. <code>¯\_(ツ)_/¯</code>
Version v0.2.0 comes with a Network Log which displays <code>curl</code> equivalents for all network requests. It also allows to easily add and remove room aliases.
https://gitlab.com/jaller94/matrix-wrench/</p>
</blockquote>
<h3 id="matrix-streamchat-website">matrix-streamchat (<a href="https://git.pixie.town/f0x/matrix-streamchat">website</a>)</h3>
<p>Matrix powered stream overlay for OBS, to integrate live chat in your favorite (selfhosted) streaming setups.</p>
<p><a href="https://matrix.to/#/@f0x:pixie.town">f0x</a> says</p>
<blockquote>
<p>there's a pink theme and irc styling for matrix-streamchat now</p>
</blockquote>
<blockquote>
<p><img src="/blog/img/yOedqpx8C73ql5ZxgMaNsFrm.png" alt="" /></p>
</blockquote>
<h3 id="cactus-comments-website">Cactus Comments (<a href="https://cactus.chat">website</a>)</h3>
<p>Cactus Comments is a federated comment system for the web, based on the Matrix protocol.</p>
<p><a href="https://matrix.to/#/@asbjorn:olli.ng">Asbjørn</a> reports</p>
<blockquote>
<p>Cactus Comments is a comment system for the open web, built on Matrix.</p>
<p>We released version v0.11.0 of the client!</p>
<p>The client has been relicensed to LGPL. This means that you can now use Cactus Comments in non-GPL compatible projects.
But mainly, this release brings a bunch of CSS improvements: introducing automatic dark mode, and making it easier to change colors with CSS variables.</p>
<p>Here's the changelog:</p>
<ul>
<li>Relicense from GPLv3 to LGPLv3.</li>
<li>Rewrite large parts of the stylesheet to use flexbox.</li>
<li>Introduce CSS variables to the stylesheet.</li>
<li><code>.dark</code> and <code>.light</code> CSS classes with default values for dark/light mode.</li>
<li>Bugfix: &quot;View More&quot; button no longer blinks when auto-refreshing short comment sections.</li>
</ul>
<p>v0.11.0 changelog and IPFS links <a href="https://matrix.org/blog/2021/05/07/this-week-in-matrix-2021-05-07">here</a>.</p>
<p><a href="https://latest.cactus.chat/">/ipns/latest.cactus.chat</a> is updated to point to the latest release, so sites linking there should already be using the new version.</p>
<p>Try out a live demo: <a href="https://cactus.chat/demo">cactus.chat/demo</a></p>
<p>Join our Matrix room: <a href="https://matrix.org/blog/2021/05/07/this-week-in-matrix-2021-05-07">#cactus:cactus.chat</a></p>
</blockquote>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks 🧰</h2>
<h3 id="simplematrixbotlib-website">simplematrixbotlib (<a href="https://github.com/KrazyKirby99999/simple-matrix-bot-lib">website</a>)</h3>
<p>simplematrixbotlib is an easy to use bot library for the Matrix ecosystem written in Python and based on matrix-nio.</p>
<p><a href="https://matrix.to/#/@krazykirby99999:matrix.org">krazykirby99999</a> reports</p>
<blockquote>
<p>Happy New Year! </p>
<p>Since the last post of TWIM, versions 2.5.1 and 2.6.0 of simplematrixbotlib were released.</p>
<h2 id="version-2-5-1-released">Version 2.5.1 Released!</h2>
<h3 id="new-fixes">New Fixes:</h3>
<ul>
<li>Fixed <a href="https://github.com/KrazyKirby99999/simple-matrix-bot-lib/issues/101">#101</a> 'Api' object has no attribute 'async_client' </li>
</ul>
<h2 id="version-2-6-0-released">Version 2.6.0 Released!</h2>
<h3 id="new-features">New Features:</h3>
<ul>
<li>A listener for handling m.reaction events has been added. Bot developers can now use <code>Listener.on_reaction_event</code> to smoothly handle reactions.</li>
</ul>
<p>Example usage is shown below:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>&quot;&quot;&quot;
</span><span>Example Usage:
</span><span>
</span><span>random_user
</span><span>      !echo something
</span><span>
</span><span>random_user2
</span><span>      *reacts with 👍️
</span><span>
</span><span>echo_reaction_bot
</span><span>      Reaction: 👍️
</span><span>&quot;&quot;&quot;
</span><span>
</span><span>import simplematrixbotlib as botlib
</span><span>
</span><span>creds = botlib.Creds(&quot;https://example.com&quot;, &quot;echo_reaction_bot&quot;, &quot;password&quot;)
</span><span>bot = botlib.Bot(creds)
</span><span>
</span><span>
</span><span>@bot.listener.on_reaction_event
</span><span>async def echo_reaction(room, event, reaction):
</span><span>    resp_message = f&quot;Reaction: {reaction}&quot;
</span><span>    await bot.api.send_text_message(room.room_id, resp_message)
</span><span>
</span><span>
</span><span>bot.run()
</span><span>
</span></code></pre>
<p>Request additional features <a href="https://github.com/KrazyKirby99999/simple-matrix-bot-lib/issues/new?assignees=&amp;labels=&amp;template=feature_request.md&amp;title=">here</a>.</p>
<p>Source: https://github.com/KrazyKirby99999/simple-matrix-bot-lib</p>
<p>Package: https://pypi.org/project/simplematrixbotlib/</p>
<p>Documentation: https://simple-matrix-bot-lib.readthedocs.io/en/latest/</p>
<p>Matrix Room: https://matrix.to/#/#simplematrixbotlib:matrix.org</p>
</blockquote>
<h3 id="matrix-bot-sdk-website">matrix-bot-sdk (<a href="https://github.com/turt2live/matrix-bot-sdk">website</a>)</h3>
<p>A TypeScript/JavaScript SDK for Matrix bots</p>
<p><a href="https://matrix.to/#/@travis:t2l.io">TravisR</a> announces</p>
<blockquote>
<p><a href="https://github.com/turt2live/matrix-bot-sdk">matrix-bot-sdk</a> has had a v0.6.0-beta.3 release with beta support for crypto! It even includes documentation!</p>
<p>The crypto is considered beta quality at the moment: good enough to use for somewhat unimportant bots, but not fully recommended for production just yet. With that being said, I'm interested in bugs you run into - please use the issue tracker if you run into crypto not working.</p>
<p>Tutorials for the crypto setup are at https://turt2live.github.io/matrix-bot-sdk/tutorial-encryption.html</p>
<p>Note for appservice support to work then you'll need a Synapse with these PRs enabled (may require manual merge too):</p>
<ul>
<li>https://github.com/matrix-org/synapse/pull/11538</li>
<li>https://github.com/matrix-org/synapse/pull/11617</li>
<li>https://github.com/matrix-org/synapse/pull/11215</li>
</ul>
<p>For non-linux platforms, the rust-sdk will try to build itself which means you might need a working Rust stack. The Rust SDK repo itself has more information: </p>
<ul>
<li>https://github.com/matrix-org/matrix-rust-sdk/blob/travis/node-bindings/crates/matrix-sdk-crypto-nodejs/README.md</li>
<li>https://github.com/matrix-org/matrix-rust-sdk/blob/travis/node-bindings/README.md</li>
</ul>
<p>Bots and appservices don't automatically support encryption, but adding encryption <em>should</em> be easy. The Rust SDK dependency is required in either case, sorry.</p>
</blockquote>
<h3 id="complement-website">Complement (<a href="https://github.com/matrix-org/complement">website</a>)</h3>
<p>Matrix compliance test suite</p>
<p><a href="https://matrix.to/#/@kegan:matrix.org">Kegan</a> reports</p>
<blockquote>
<p><a href="https://github.com/matrix-org/complement">Complement</a> has seem some updates this week in the test output that is produced onto the CLI. Details on how to add this to your CI process are contained in the README. Here's the difference when viewed using Github Actions:</p>
<p>Before:</p>
<p><img src="/blog/img/nBSBdEyeRwPXksvquIinsCmw.png" alt="" /></p>
<p>After:</p>
<p><img src="/blog/img/fWvudyuDIcTtgwtgdOQShInx.png" alt="" /></p>
</blockquote>
<h3 id="polyjuice-website">Polyjuice (<a href="https://gitlab.com/polyjuice">website</a>)</h3>
<p>Elixir libraries related to the Matrix communications protocol.</p>
<p><a href="https://matrix.to/#/@hubert:uhoreg.ca">uhoreg</a> reports</p>
<blockquote>
<p><a href="https://gitlab.com/polyjuice/polyjuice_newt">Polyjuice Newt</a>, the newest addition to the Polyjuice project, is an Elixir binding for <a href="https://github.com/matrix-org/vodozemac/">vodozemac</a>, the new Olm/Megolm implementation in Rust.  At the time of writing, Polyjuice Newt supports encryption and decryption using Olm and Megolm, but by the time you read this next year, it may also support the SAS verification functions and pickling/unpickling.</p>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops 🛠</h2>
<h3 id="nixos-deployment-website">NixOS Deployment (<a href="https://nixos.org">website</a>)</h3>
<p>Matrix packaging for NixOS</p>
<p><a href="https://matrix.to/#/@piegames:matrix.org">piegames</a> announces</p>
<blockquote>
<p>I don't think we've previously had any <a href="https://nixos.org">Nix/NixOS/nixpkgs</a> related entries in TWIM, so I'll start ^^</p>
<p>The current unstable channel has extended its Matrix ecosystem support to also include <a href="https://github.com/hifi/heisenbridge">Heisenbridge</a> and <a href="https://conduit.rs/">Conduit</a> packages and modules. This makes it super easy to deploy any of those services: For example, my configuration for Heisenbridge is 21 lines long, and Conduit is only 11 lines. You can browse the available configuration options online: <a href="https://search.nixos.org/options?channel=unstable&amp;query=services.matrix-conduit"><code>services.matrix-conduit</code></a>, <a href="https://search.nixos.org/options?channel=unstable&amp;query=services.heisenbridge"><code>services.heisenbridge</code></a> (note that some of them are freeform and simply forward to the upstream configuration).</p>
<p>For those that are not into NixOS, a module is the code that turns the declarative configuration files into your running system setup. As an example, if you enable <code>services.heisenbridge</code> the following things are done for you:</p>
<ul>
<li>Create a new <code>heisenbridge</code> user and group for the service</li>
<li>Create and manage the registration file for the homeserver (i.e. automatically regenerate it after the configuration changed)</li>
<li>Create a systemd service that runs the <code>heisenbridge</code> command with the requested bridge configuration. The unit also sets a few systemd security hardening options.</li>
</ul>
<p>For support, join our Matrix space at <a href="https://matrix.to/#/#community:nixos.org">#community:nixos.org</a> and its Matrix-Nix channel: <a href="https://matrix.to/#/#matrix-nix:transformierende-gesellschaft.org">#matrix-nix:transformierende-gesellschaft.org</a></p>
</blockquote>
<h3 id="matrix-docker-ansible-deploy-website">matrix-docker-ansible-deploy (<a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">website</a>)</h3>
<p>Matrix server setup using Ansible and Docker</p>
<p><a href="https://matrix.to/#/@slavi:devture.com">Slavi</a> says</p>
<blockquote>
<p>Thanks to <a href="https://gitlab.com/etke.cc">Aine</a> of <a href="https://etke.cc/">etke.cc</a>, <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">matrix-docker-ansible-deploy</a> can now help you set up <a href="https://gitlab.com/etke.cc/honoroit">Honoroit</a> - a helpdesk bot.</p>
<p>See our <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook-bot-honoroit.md">Setting up Honoroit</a> documentation to get started.</p>
</blockquote>
<p><a href="https://matrix.to/#/@slavi:devture.com">Slavi</a> says</p>
<blockquote>
<p>Thanks to <a href="https://gitlab.com/etke.cc">Aine</a> of <a href="https://etke.cc/">etke.cc</a>, <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">matrix-docker-ansible-deploy</a> now supports <a href="https://cinny.in/">Cinny</a> - a new simple, elegant and secure Matrix client.</p>
<p>To try it out, see our <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook-client-cinny.md">Setting up Cinny</a> documentation page.</p>
</blockquote>
<p><a href="https://matrix.to/#/@slavi:devture.com">Slavi</a> announces</p>
<blockquote>
<p>At <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">matrix-docker-ansible-deploy</a>, we believe that 2022 will be the year of the non-Synapse Matrix server!</p>
<p><a href="https://github.com/Dekker1">Jip J. Dekker</a> did the <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/pull/818">initial work</a> of adding <a href="https://github.com/matrix-org/dendrite">Dendrite</a> support to the playbook back in January 2021. Lots of work (and time) later, Dendrite support is finally ready for testing.</p>
<p>The playbook was previously quite <a href="https://github.com/matrix-org/synapse">Synapse</a>-centric, but can now accommodate multiple homeserver implementations, with Synapse still remaining the default.</p>
<p>To learn more, see <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/CHANGELOG.md#dendrite-support">our changelog entry about Dendrite</a>.</p>
</blockquote>
<p><a href="https://matrix.to/#/@slavi:devture.com">Slavi</a> announces</p>
<blockquote>
<p>Thanks to <a href="https://github.com/mattcen">Matthew Cengia</a> and <a href="https://github.com/shreyasajj">Shreyas Ajjarapu</a>, <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">matrix-docker-ansible-deploy</a> can now bridge to <a href="https://twitter.com/">Twitter</a> using the <a href="https://github.com/mautrix/twitter">mautrix-twitter</a> bridge. </p>
<p>Note: the playbook already supports another Twitter bridge - <a href="https://github.com/Sorunome/mx-puppet-twitter">mx-puppet-twitter</a>.</p>
<p>To get started with this bridge, see <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook-bridge-mautrix-twitter.md">Setting up Mautrix Twitter bridging</a> in our documentation.</p>
<p>This brings the total number of bridges supported by the playbook up to 22. See all supported bridges <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook.md#bridging-other-networks">here</a>.</p>
</blockquote>
<h3 id="matrix-commit-website">matrix-commit (<a href="https://github.com/KrazyKirby99999/matrix-commit">website</a>)</h3>
<p>A Github Action for sending messages to a Matrix Room.</p>
<p><a href="https://matrix.to/#/@krazykirby99999:matrix.org">krazykirby99999</a> says</p>
<blockquote>
<h2 id="version-1-2-2-released">Version 1.2.2 Released!</h2>
<p>A Github Action for sending messages to a Matrix Room. Changes should apply automatically if you are using tag <code>v1</code>.</p>
<h2 id="new-features-1">New Features:</h2>
<ul>
<li>Link to repository added</li>
<li>Link to commit added</li>
</ul>
<h3 id="before">Before:</h3>
<p><img src="/blog/img/matrix-commit-before.png" alt="" /></p>
<h3 id="after">After:</h3>
<p><img src="/blog/img/matrix-commit-after.png" alt="" /></p>
</blockquote>
<h2 id="dept-of-guides">Dept of Guides 🧭</h2>
<p><a href="https://matrix.to/#/@austin:tchncs.de">Austin Huang</a> says</p>
<blockquote>
<p>A new Matrix guide has come into town: https://joinmatrix.org</p>
<p>In the hopes to expand Matrix's reach to the non-technical population, this guide is intended to give quick directions on how to use Matrix, as well as clear comparison between Matrix and other dominant platforms.</p>
<p>The pages are available <a href="https://github.com/austinhuang0131/joinmatrix/">on GitHub</a>. Open to contributions!</p>
</blockquote>
<h2 id="dept-of-ping-table-tennis-paddle-and-ball">Dept of Ping 🏓</h2>
<p>Here we reveal, rank, and applaud the homeservers with the lowest ping, as measured by <a href="https://github.com/maubot/echo">pingbot</a>, a <a href="https://github.com/maubot/maubot">maubot</a> that you can host on your own server.</p>
<h3 id="ping-maunium-net"><a href="https://matrix.to/#/#ping:maunium.net">#ping:maunium.net</a></h3>
<p>Join <a href="https://matrix.to/#/#ping:maunium.net">#ping:maunium.net</a> to experience the fun live, and to find out how to add YOUR server to the game.</p>
<table><thead><tr><th style="text-align: center">Rank</th><th style="text-align: center">Hostname</th><th style="text-align: center">Median MS</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center">envs.net</td><td style="text-align: center">599.5</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">thomcat.rocks</td><td style="text-align: center">768</td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">matrix.spooks.cyou</td><td style="text-align: center">862</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">matrix.nicfab.it</td><td style="text-align: center">955</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center">aria-net.org</td><td style="text-align: center">1300</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">aletheia.moe</td><td style="text-align: center">1611.5</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center">trygve.me</td><td style="text-align: center">1617</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">mtx.koyax.org</td><td style="text-align: center">1703.5</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center">rollyourown.xyz</td><td style="text-align: center">1808</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">microelectro.de</td><td style="text-align: center">1996</td></tr>
</tbody></table>
<h3 id="ping-no-synapse-maunium-net"><a href="https://matrix.to/#/#ping-no-synapse:maunium.net">#ping-no-synapse:maunium.net</a></h3>
<p>Join <a href="https://matrix.to/#/#ping-no-synapse:maunium.net">#ping-no-synapse:maunium.net</a> to experience the fun live, and to find out how to add YOUR server to the game.</p>
<table><thead><tr><th style="text-align: center">Rank</th><th style="text-align: center">Hostname</th><th style="text-align: center">Median MS</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center">matrix.spooks.cyou</td><td style="text-align: center">366</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">dendrite.matrix.org</td><td style="text-align: center">440</td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">sspaeth.de</td><td style="text-align: center">466</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">rustybever.be</td><td style="text-align: center">546.5</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center">grin.hu</td><td style="text-align: center">966</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">matrix.awesomesheep48.me</td><td style="text-align: center">1294</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center">dendrite.neilalexander.dev</td><td style="text-align: center">1537</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">dendrite.beckmeyer.us</td><td style="text-align: center">1744</td></tr>
</tbody></table>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know 🏁</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#twim:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;22&#x2F;the-mega-matrix-holiday-special-2021&#x2F;" title="The Mega Matrix Holiday Special 2021">The Mega Matrix Holiday Special 2021</a></h1>
            <span>
                22.12.2021 23:27
                —
                <a href="/category/general">
                    General
                </a>
                —
                <a href="/author/matthew-hodgson">
                    Matthew Hodgson
                </a>
            </span>
            <br>
            <small>Last update: 22.12.2021 17:54</small>
        </header>
        <div>
            <p>Hi all,</p>
<p>If you’re reading this - congratulations; you made it through another year :)  Every winter we sit down and review Matrix’s progress over the last twelve months, and look forward to the next - for it’s all too easy to get lost in the day-to-day development and fail to realise how much the overall project is evolving, especially when it’s one as large and ambitious as Matrix!</p>
<p>Looking back at 2021, it’s unbelievable how much stuff has been going on in the core team (as you can tell by the length of this post - sorry!).  There’s been a really interesting mix of activity too - between massive improvements to the core functionality and baseline features that Matrix provides, and also major breakthroughs on next generation work.  But first, let’s check out what’s been happening in the wider ecosystem…</p>
<h2 id="the-matrix-ecosystem">The Matrix Ecosystem</h2>
<p>Over 2021 the Matrix ecosystem has expanded unrecognisably.  This time last year we were aware of 2 governments who were seriously adopting Matrix at scale (France and Germany), with the UK and US starting to roll out initial deployments.  12 months later, and we are now aware of <strong>12</strong> governments who are adopting Matrix in various capacities - and we hope to be able to talk about at least some of them in public in 2022!  The UK and US have both progressed significantly too.</p>
<p>Meanwhile, one of the most exciting new public sector stories this year has been <a href="https://www.gematik.de/anwendungen/ti-messenger">gematik</a>: Germany’s national healthcare agency, who <a href="https://matrix.org/blog/2021/07/21/germanys-national-healthcare-system-adopts-matrix">announced Matrix</a> as the basis for interoperable secure messaging throughout the whole healthcare sector.  This is a genuine step change for Matrix: rather than a government putting out tenders for “a secure messaging solution”, instead we are seeing tenders for Matrix solution providers.  The Matrix industry is real; it exists today, and we’re seeing more and more new providers such as <a href="https://famedly.com/">Famedly</a> (building on the <a href="https://gitlab.com/famedly/company/frontend">Flutter/Dart stack</a> which powers <a href="https://fluffychat.im">FluffyChat</a>) and <a href="https://folivo.net/portfolio/timmy-messenger/">Folivonet</a> (building on the <a href="https://gitlab.com/benkuly/trixnity">Trixnity</a> Kotlin Multiplatform stack) stepping up to get involved - as well as many more big incumbents.  We created Matrix in order to bootstrap a new decentralised communication industry, and frankly it’s amazing to see it actually taking shape.</p>
<p>Another big step change has been the number of existing chat providers looking to become part of the wider Matrix network. Back in September our friends at <a href="https://www.youtube.com/watch?v=jBtBiUXLqAk&amp;t=1691s">Rocket.Chat announced that they’re working on Matrix support</a> for federation, perhaps inspired by our case study in making <a href="https://matrix.org/blog/2020/12/07/gitter-now-speaks-matrix">Gitter speak Matrix</a> - and meanwhile Matrix comes up a lot in the context of Twitter’s Bluesky initiative, and a few big players we can’t yet mention have also been in touch wanting to natively talk Matrix too.</p>
<p>We’ve also seen a huge shift in big enterprises adopting Matrix for self-sovereign secure communication (although we can’t drop any names yet 😔). This may have been spurred on by such misadventures as Electronic Arts being compromised via a <a href="https://www.vice.com/en/article/7kvkqb/how-ea-games-was-hacked-slack">leaked Slack access token</a>, but it feels like many of the biggest organisations now realise that unquestioningly handing their data to Slack or Teams is a bad idea, when they could have an end-to-end encrypted deployment of their own instead.</p>
<p>There has also been a turning point in legislation in favour of Matrix - with the EU Digital Markets Act <a href="https://twitter.com/matrixdotorg/status/1471191916838633481">pushing hard for interoperability</a> for ‘big tech’ communication services in the EU (see <a href="https://interoperability.news/2021/12/eu-parliament-upgrades-dma-to-open-gatekeepers-gates/">Amandine’s take</a> here), and meanwhile Eric Migicovsky, CEO at <a href="https://www.beeper.com/">Beeper</a> has been busy <a href="https://www.c-span.org/video/?c4992173/user-clip-eric-migicovsky-testimony">testifying to US Congress</a> on the merits of interoperability too. It’s not inconceivable that we will soon live in a world where governments mandate that the walled gardens will finally have to open up, and we may see a whole new level of interest in communication providers wanting to join Matrix!</p>
<p>Communities themselves have also been embracing Matrix more and more over the last year: we were incredibly proud to host <a href="https://matrix.org/blog/2021/02/15/how-we-hosted-fosdem-2021-on-matrix">FOSDEM 2021</a>, the world’s biggest open source conference via Matrix (all 35K attendees!) - and we’re gearing up to do it again in February for <a href="https://twitter.com/fosdem/status/1451475324684980241">FOSDEM 2022</a> (this time with our <a href="https://matrix.org/blog/2021/12/02/call-for-participation-for-the-fosdem-2022-matrix-dev-room">very first FOSDEM Matrix dev room</a>!). We were also really glad that <a href="https://libera.chat/">Libera.chat</a> let us point a dedicated homeserver and IRC bridge at their new IRC network (meaning you can join anywhere on Libera from Matrix as #channel:libera.chat, and talk to anyone as @nick:libera.chat). High profile open source projects have been adopting Matrix all over the place - <a href="https://wiki.debian.org/Teams/DebianSocial/Matrix">Debian</a>, <a href="https://fedoramagazine.org/multiple-matrix-sessions-with-element-on-fedora-linux/">Fedora</a>, <a href="https://nixos.wiki/wiki/Matrix">NixOS</a>, <a href="https://wiki.archlinux.org/title/Matrix">Arch</a>, <a href="https://blog.torproject.org/entering-the-matrix/">Tor</a>, <a href="https://ansible.github.io/community/posts/matrix_and_ansible.html">Ansible</a>, <a href="https://whatwg.org/chat">WHATWG</a> and many others (check out <a href="https://www.ubuntubuzz.com/2021/10/matrix-chat-adoption-by-community-in.html">this list</a>!) now have their own Matrix servers and spaces.  (You know things are busy when we haven’t had time to do a big blog post to announce folk as important as these joining the network!)</p>
<p>Finally, there has been an explosion of new projects and milestones in the wider community - <a href="https://conduit.rs">Conduit</a> entered <a href="https://conduit.rs/release-0-2-0/">beta</a> as a super exciting lightweight Rust homeserver implementation; <a href="https://fluffychat.im">FluffyChat</a> hit 1.0 with an impressively polished Flutter-based experience; <a href="https://beeper.com">Beeper</a> pre-launched to huge amounts of mainstream excitement; <a href="https://cinny.in/">Cinny</a> exploded out of the blue as an incredibly elegant next-generation web client; <a href="https://keanu.im/">Keanu</a> materialised from <a href="https://guardianproject.info/">The Guardian Project</a> as their glossy Matrix client suite; <a href="https://commune.chat/">Commune</a> appeared as a hybrid messageboard/chatroom interface; <a href="https://github.com/Nheko-Reborn/nheko/">Nheko</a> has matured significantly with huge E2EE improvements and feature and VoIP polish; <a href="https://apps.kde.org/en-gb/neochat/">NeoChat</a> and <a href="https://github.com/quotient-im/libQuotient">libQuotient</a> development is progressing solidly; <a href="https://gitlab.gnome.org/GNOME/fractal">Fractal</a> is busy with the <a href="https://gitlab.gnome.org/GNOME/fractal/-/tree/fractal-next">fractal-next</a> rewrite to move everything over to matrix-rust-sdk and GTK 4;  <a href="https://syphon.org/">Syphon</a> continues to forge ahead as a privacy-focused Flutter-based client, and non-chat clients like <a href="https://github.com/toger5/TheBoard">The Board</a>, <a href="https://github.com/opentower/populus-viewer">Populus</a> and <a href="https://github.com/DanilaFe/matrix-highlight">Matrix Highlight</a> have started to appear in earnest too!  We also had a super successful <a href="https://matrix.org/blog/2021/05/20/google-summer-of-code-2021">Google Summer of Code</a> this year, with a record number of 7 students participating in both core team and community projects.</p>
<p>Please note this is just a random sample of all the community news over the last year - to get more colour on what’s been going on, we highly recommend flipping through the <a href="https://matrix.org/blog/category/this-week-in-matrix">This Week In Matrix archives</a>!</p>
<h2 id="the-matrix-spec">The Matrix Spec</h2>
<p>The Matrix spec is the single source of truth of what Matrix actually is, and this year it got some major improvements thanks to a beautiful new website at <a href="https://spec.matrix.org">https://spec.matrix.org</a> thanks to Will Bamberg, formerly of <a href="https://developer.mozilla.org/">MDN</a> (and who’s now back fighting the good fight with the MDN team at <a href="https://opencollective.com/open-web-docs/updates/will-bamberg-joins-open-web-docs-staff">OWD</a>).</p>
<p>Aside from the new spec site, we also released our first official point release in a while - <a href="https://matrix.org/blog/2021/11/09/matrix-v-1-1-release">Matrix 1.1</a>, and we’re going to aim to keep regular releases happening once a quarter from here on in.  It’s also worth noting that it’s very much a feature and not a bug that spec releases lag behind the various <a href="https://matrix.org/docs/spec/proposals">spec proposals</a> which fly around as the core team and community experiment with new features like spaces, threads, etc.  We very deliberately only merge change proposals to the spec which have been proven to work in real life implementations, and which have fully passed the spec review process (along with any dependencies they might have!).</p>
<p>Talking of which, in 2021 we saw a record <strong>109</strong> Matrix Spec Change proposals (MSCs) created. Even better, we closed <strong>62</strong> MSCs - so while the backlog is still growing, we’re still making very concrete progress.  Of the 109 new MSCs: 34 were from the wider Matrix community, 34 were from ex-community contributors who are now part of the core team, 13 were from the founding Matrix team, and 28 were from folks hired to work on Matrix by Element on behalf of the Matrix.org Foundation.  This feels like a pretty healthy blend of contributions, and while it’s true that spec work could always progress faster, things do seem to be heading in the right direction.</p>
<p><img src="/blog/img/2021-12-22-spec.png" alt="The latest MSC stats" /></p>
<p>In the new year, the Spec Core Team (responsible for reviewing MSCs and voting on what gets merged to the spec) is going to make a concerted effort to carve out more dedicated time for spec work - thankfully one of the side-effects of Matrix growing is that there are now a lot more people around with whom we can share other work, hopefully meaning that we can put significantly more hours into keeping the spec growing healthily.</p>
<h2 id="synapse">Synapse</h2>
<p>Synapse is the primary homeserver implementation published by the Matrix core team, and its maturity is unrecognisable from where we were a year ago.  One of the big breakthroughs has been stabilising memory usage through caching improvements - the Matrix.org synapse now reliably only uses 2-3GB of RAM on its main process, despite its activity having more than doubled over the last year (up from 513K monthly active users to 1.11M!).</p>
<p><img src="/blog/img/2021-12-22-perf.jpg" alt="Synapse memory performance fixes" /></p>
<p>Further signs of maturity include Synapse’s radically improved new <a href="https://matrix-org.github.io/synapse/latest/">documentation</a> and the new <a href="https://matrix-org.github.io/synapse/latest/modules/index.html">module API</a>, the fact that mypy type-safety coverage has improved from ~75% to over 89.7% (across 151,903 lines of code!), and the fact that Open Tracing support has matured to the point that visualising complex cross-worker behaviour is nowadays a genuine pleasure.  Frankly, Synapse should be feeling robust and stable these days - if you see folks claiming otherwise, please check they’re not basing that on outdated info (or failing that, get them to file bug reports that we can jump on!).</p>
<p>Meanwhile, on the feature side, we’ve landed a huge spate of long-awaited core functionality.  Probably the best way to track it is by the Matrix Spec Change proposals (MSCs) which have been implemented (although I dare you to also go and check out Synapse’s <a href="https://github.com/matrix-org/synapse/blob/develop/CHANGES.md">changelog</a>, all 675KB of it, which is frankly a thing of beauty and will take you down a rabbithole all the way back to v0.0.0 in Aug 2014 if you so desire ;P). Major MSCs which we’ve landed include:</p>
<ul>
<li>Spaces! It’s hard to overstate how positive this has been for Matrix’s usability: at last, we can group our rooms together however we please, both for our own edification and to share with others - and we can view space hierarchies over federation, complete with pagination (<a href="https://github.com/matrix-org/matrix-doc/pull/2946">MSC2946</a>) as well as specify who can join a room based on whether they’re a member of a given space/room (<a href="https://github.com/matrix-org/matrix-doc/pull/3083">MSC3083</a>).</li>
<li>Threads! Yes, that’s right - coming any day now to a Matrix client close to you, we have ‘classic’ threaded messaging landing, providing sidebars of conversation through the new m.thread relation type (<a href="https://github.com/matrix-org/matrix-doc/pull/3440">MSC3440</a>), building on Matrix’s existing aggregation API as used for edits and reactions.  We’ve chosen to prioritise single-level-deep-threads rather than arbitrarily-deep-trees (<a href="https://github.com/matrix-org/matrix-doc/pull/2836">MSC2836</a>) as it maps more easily to a chat UX, although the two approaches are not mutually exclusive.</li>
<li>Aggregations! Everyone’s favourite bête noire in Matrix tends to be that aggregations for edits &amp; reactions predate today’s Matrix Spec Change process and went mainstream without using a vendor prefix before their spec had been stabilised.  Better late than never, we’ve taken advantage of Threads to go back and fix what once went wrong - and now <a href="https://github.com/matrix-org/matrix-doc/pull/2674">MSC2674</a> and <a href="https://github.com/matrix-org/matrix-doc/pull/2675">MSC2675</a> and friends are hopefully on a much better track to provide a basis for how aggregations work - both in the spec and in the reference implementation in Synapse.</li>
</ul>
<p><img src="/blog/img/2021-12-22-aggs.png" alt="Anatomy of a bête noire" /></p>
<ul>
<li>Social Login via multiple SSO providers (<a href="https://github.com/matrix-org/matrix-doc/pull/2858">MSC2858</a>) - almost 50% of new registrations on the Matrix.org homeserver now use social login!  Interestingly the split of SSO usage is roughly 70% Google, 12% GitHub, 11% Apple, 6% Facebook and 1% GitLab. Make of that what you will!</li>
<li>Knocking (<a href="https://github.com/matrix-org/matrix-doc/pull/2403">MSC2403</a>)! Huge thanks to Sorunome and Anoa, we now support the ability to knock to ask to join a room if not yet invited. If this sounds unfamiliar, it may be because it hasn’t landed in Element yet, but expect it to land next year.</li>
<li>Refresh tokens (<a href="https://github.com/matrix-org/matrix-doc/pull/2918">MSC2918</a>)! At last, we have a standard way for clients to refresh their access tokens, so that if your access token leaks it will not give access to your account indefinitely.  (This also has yet to land in Element, but has been proved on a branch on Hydrogen).</li>
</ul>
<p>Finally, last but not least, Eric from Gitter has been fearlessly hacking his way through some of Matrix’s gnarliest problems in his quest to bring Matrix+Element up to full feature parity with Gitter. In practice, this means adding the ability to incrementally import old history into existing Matrix rooms (<a href="https://github.com/matrix-org/matrix-doc/pull/2716">MSC2716</a>), so we can expose the vast amounts of knowledge in Gitter’s archives directly into Matrix - and in future provide bridging in general of existing archives (Slack, Discord, mailing lists, newsgroups, forums, etc.) into Matrix.</p>
<p>This is a <em>tough</em> problem, as Matrix rooms are fundamentally immutable - events sent into a room cannot be changed.  However, we can bend time a bit and add old chapters of history to the room as if we’d just discovered them down the back of the sofa - and this is what <a href="https://github.com/matrix-org/matrix-doc/pull/2716">MSC2716</a> does.  The (rewritten!) <a href="https://github.com/matrix-org/matrix-doc/blob/matthew/%5BMSC2716%5D(https://github.com/matrix-org/matrix-doc/pull/2716)/proposals/2716-batch-send-historical-messages.md">spec proposal</a> is a thing of beauty and well worth a look, and you can see an early preview in action back on <a href="https://youtu.be/gSrqj2IzJew?t=529">Matrix Live in June</a>. Over the last few months it’s been merging and maturing in Synapse and we should see it in the wild in the near future!  And for bonus points Eric’s also just added in Jump-to-date support (<a href="https://github.com/matrix-org/matrix-doc/pull/3030">MSC3030</a>), letting clients jump around room history by timestamp - another Gitter feature that we sorely need, and will also help us publish excellent Gitter-style online chat archives in future.  You can see it in action in last week’s <a href="https://youtu.be/Hsyqa5ozWIo?t=581">Matrix Live</a>!</p>
<h2 id="element">Element</h2>
<p>Meanwhile, on the client side, Element continues to act as a flagship client to drive the development of the official client SDKs we ship as the Matrix.org Foundation - and our focus more than ever before has been to ensure that Matrix can be used to create mainstream-usable polished glossy apps.  After all, Matrix will only succeed if clients emerge which can punch their weight against the enormous incumbents - be they Slack, Teams, WhatsApp or Discord.</p>
<p>This year, improving UX quality has been front and center - and hopefully the shift has been obvious in the app (and huge thanks to everyone who tweeted/tooted/enthused about improvements when they saw them!).  Part of this has been ensuring that all new features are built in a design- and product-led fashion by folks who are explicitly focused on product engineering - with product design involved from the outset and with coordination and focus provided by product management folks. This is far from the typical way that FOSS operates, but if we’re to succeed against the incumbents we have to beat them at their own game (just as, for instance, Mozilla wields conventional product management in their browser wars).</p>
<p>More recently, there’s also been a major shift towards structured <a href="https://twitter.com/element_hq/status/1470798993122807809">user testing</a> in order to evaluate new features and analyse how users trip over the app in general, including radically improved analytics (for those who opt in!) to help visualise which bits of the app aren’t working.  In the new year, the expectation is to double down on user testing: quite simply, if you can hand Element to a casual mainstream user and they can get the core jobs done (sign up, chat to someone, call someone, etc.) without tripping over, then mission successful :)</p>
<p>The <a href="https://element.io/blog/">Element blog</a> covers the work this year from the Element side, but from the Matrix side, the key changes include:</p>
<ul>
<li>finalising <a href="https://element.io/blog/spaces-blast-out-of-beta/">Spaces</a> as a way to group together rooms - providing the equivalent of Discord servers or Slack workspaces, or alternatively letting you gather your own rooms together into a private space.</li>
<li>building out Threads (available in labs; launching soon!)</li>
<li>Social Login!</li>
<li>radically improving Element’s Information Architecture (i.e. the layout of the UI, so that the panels and buttons are correctly semantically grouped together in a visual hierarchy)</li>
<li>adding <a href="https://element.io/blog/introducing-voice-messages-and-so-much-more/">Voice Messages</a> as a really beautiful polished feature powered by <a href="https://github.com/matrix-org/matrix-doc/pull/3245">MSC3245</a></li>
<li>adding Location Share (available in labs; launching soon!) powered by <a href="https://github.com/matrix-org/matrix-doc/pull/3488">MSC3488</a> (and in future <a href="https://github.com/matrix-org/matrix-doc/pull/3489">MSC3489</a> for live-location sharing - in dev on iOS right now!)</li>
<li>adding <a href="https://element.io/blog/element-1-9-1-export-is-finally-here/">Chat Export</a>, thanks to the amazing GSOC work by Jaiwanth </li>
<li>adding Polls via <a href="https://github.com/matrix-org/matrix-doc/pull/3381">MSC3381</a>.</li>
</ul>
<p><img src="/blog/img/2021-12-22-spaces.gif" alt="Spaces in all their glory" /></p>
<p>From a spec perspective, it’s been particularly exciting to be finally using Extensible Events (<a href="https://github.com/matrix-org/matrix-doc/pull/1767">MSC1767</a>) for many of these new features: voice messages, location sharing and polls are all experimenting with this new idiom for expressing richer structured data over Matrix while presenting a consistent and useful ‘fallback’ representation for clients which don’t know how to natively render the richer data.</p>
<p>We’ve also done a huge amount of work this year in improving 1:1 VoIP - both via <a href="https://github.com/matrix-org/matrix-doc/pull/2746">MSC2746</a> and within the JS, iOS &amp; Android Matrix SDKs. If you haven’t tried doing a 1:1 call via Matrix recently we’d highly recommend giving it a go - probably the main remaining bug at this point is that we need to find a better default ringtone for Element(!). Huge thanks go to Šimon Brandner both for his community contributions to VoIP and across all of Element Web - including proper screensharing for 1:1 (and group!) VoIP calls. This has also laid excellent groundwork for native Group VoIP/Video over Matrix - more on that later.</p>
<p>On Element Mobile, work on all the above features has been balanced by fighting against the various platform’s quirks, and lots of under-the-hood work improving performance. iOS has gone through a long journey to get back to stability after iOS’s push notification API changes, while also improving incremental sync performance by rearchitecting the local cache in the client.  Android meanwhile has been working away improving the app; reworking Notifications, migrating to Kotlin coroutines and Hilt, and closing over 690 GH issues.  Android has also had its fair <a href="https://element.io/blog/element-on-google-play-store/">share of dramas</a>, including some recent long Play Store review times, but we’ve come through the other side intact.</p>
<p>However, we’ve been thinking more and more about the nightmarish pain point that is the amount of time we spend implementing the same features across the three different platforms. This becomes particularly apparent for security-sensitive features such as end-to-end encryption, or major API changes such as aggregations, spaces or sync v3 (more on that later). Or simply rapidly sharing improvements to implementation best practices between platforms.</p>
<p>Historically we consciously built platform-native Matrix SDKs in order to provide entirely idiomatic SDKs for other Matrix developers to use - and also to better dogfood the protocol and ensure that the heterogenous implementations could interoperate successfully. However, in practice, relatively few third party projects other than Element build on top of matrix-ios-sdk and matrix-android-sdk2 - and meanwhile there are more than enough other Matrix clients out there nowadays to dogfood interoperability against (including alternative experimental clients from the core team such as Hydrogen).</p>
<p>So, we’ve been thinking increasingly seriously about how to solve this…</p>
<h2 id="a-new-hope-matrix-rust-sdk">A new hope: matrix-rust-sdk</h2>
<p><a href="https://github.com/matrix-org/matrix-rust-sdk">matrix-rust-sdk</a> is an attempt to build a new reference client SDK for Matrix which can be used by as many platforms as possible - hopefully forever stopping us from reimplementing the wheel more than we need to. Work began towards the end of 2019, building on top of <a href="https://www.ruma.io/">Ruma</a>’s excellent Matrix rust crates, and poljar has been working away solidly at it ever since.  We teased matrix-rust-sdk in last year’s update, but as of this year it is properly coming of age and we’ve started using it in earnest - beginning by swapping out Element Android’s encryption implementation for matrix-rust-sdk-crypto (the E2EE cryptography crate provided by the SDK).</p>
<p>If you’re not familiar with Rust, the main benefits we get here are a heavy emphasis on safety and security without compromising performance; while providing a single codebase which can be used equally from iOS, native Desktop apps such as Fractal, Android (with native bindings) and even Web (via WASM, in future).  While technically this results in a “non-native” SDK relative to matrix-js-sdk, matrix-ios-sdk and matrix-android-sdk - in practice, it’s become so common to depend on native-code shared libraries (outside the web, at least) that it’s not really a problem.</p>
<p>Initial results look wildly promising here: “Element R” (formerly known as Corroded Element - the codename for the Rust-enhanced version of Element Android) builds are now out there, and out-perform the kotlin E2EE implementation by <a href="https://github.com/matrix-org/matrix-rust-sdk/pull/170">roughly 10x</a>, thanks to using native code and Rust’s improved parallelisation.</p>
<p>Our next step is to start using it on iOS, and we’ll be experimenting with a next-generation of Element iOS shortly in the new year with the SDK provided exclusively by matrix-rust-sdk.  Element will also be funding more people to work fulltime on matrix-rust-sdk itself, and to see what the developer experience is like when you use it seriously on the Web - watch this space!</p>
<h2 id="bridges-bots-widgets-and-integration-managers">Bridges, Bots, Widgets and Integration Managers</h2>
<p>Elsewhere in Matrix, the Bridge Crew has busy polishing bridges like crazy - working away on encrypted application services (<a href="https://github.com/matrix-org/matrix-doc/pull/3202">MSC3202</a>), massively improving the IRC bridge (particularly in the fallout of the great Freenode-&gt;Libera migration), stabilising and extending <a href="https://github.com/matrix-org/matrix-bifrost">matrix-bifrost</a> (our XMPP-and-more bridge), getting libpurple bridging working properly in bifrost, getting <a href="https://github.com/matrix-org/matrix-appservice-slack">matrix-appservice-slack</a> and <a href="https://github.com/Half-Shot/matrix-appservice-discord">matrix-appservice-discord</a> stable enough to be hosted by <a href="https://element.io/blog/slack-bridging/">EMS</a>, experimenting with <a href="https://github.com/turt2live/matrix-bot-sdk">matrix-bot-sdk</a> as an alternative bridging API, and even looking at adding <a href="https://github.com/matrix-org/matrix-rust-sdk/tree/main/crates/matrix-sdk-crypto">matrix-rust-sdk-crypto</a> into matrix-bot-sdk as an elegant way to power robust encrypted bridges (thus replacing Panatalaimon for that use case).</p>
<p>There’s also a new kid in town: <a href="https://github.com/Half-Shot/matrix-hookshot">matrix-hookshot</a> (formerly known as matrix-github) is a new all-singing-all-dancing general purpose integration built on matrix-bot-sdk, coming soon to an integration manager near you, which can bridge through to GitHub, GitLab, JIRA and freeform webhooks! Check it out a few weeks ago on <a href="https://youtu.be/55P-NdDa-UI?t=1018">Matrix Live</a>. matrix-hookshot is primarily Node, but is also getting in on the Rust action with some functions being implemented in native code.</p>
<p>Meanwhile, change is afoot for integration managers, which have been screaming out for an overhaul for years. There was a cheeky hint in last week’s <a href="https://youtu.be/Hsyqa5ozWIo?t=724">Matrix Live</a> where <a href="https://dimension.t2bot.io/">Dimension</a> did an unexpected cameo looking particularly swish…  All shall be revealed next year!</p>
<p><img src="/blog/img/2021-12-22-dimension.png" alt="A whole new Dimension" /></p>
<h2 id="dendrite-low-bandwidth-matrix-and-peer-to-peer-matrix">Dendrite, Low bandwidth Matrix and Peer-to-Peer Matrix</h2>
<p>Dendrite is our next-generation homeserver implementation written in Go, and having shipped the first beta in Oct 2020, we’ve cut another 11 releases over the course of this year - adding in features such as E2EE key backups, cross-signing, support for room versions 7, 8 and 9 (knocking and restricted join rules), massive state resolution performance improvements, an entirely new state storage implementation that uses ~15x less disk space, sync filtering, experimental support for peeking-over-federation (<a href="https://github.com/matrix-org/matrix-doc/pull/2444">MSC2444</a>) - not to mention huge numbers of bug fixes. Even more excitingly, we’re in the process of ditching Kafka in favour of native-Go message queuing in the form of <a href="https://github.com/matrix-org/dendrite/compare/nats">NATS</a>!</p>
<p>However, it’s been a bit of a weird year as the team has been repeatedly pulled onto other projects due to competing priorities - and there’s still a bunch of stuff left which is keeping us in beta.  Some of this is plain old missing features (search, push rules/notifications, room upgrades, presence etc) - but we’ve also run up against some problems over the last few months while implementing new room versions and similar thanks to the sheer number of different microservices which Dendrite is made out of. In retrospect, it feels like Dendrite has ended up too granular, and when hacking on it you get slowed down badly by all the boilerplate required to glue the various services together.  Therefore, we’ve just started to <a href="https://github.com/matrix-org/dendrite/pull/2055">merge some of the services together</a> - still preserving horizontal scaling of course, but refactoring the architecture a bit while we’re still in beta to help speed up development again. So far things are looking promising!  We’re also really looking forwards to <a href="https://github.com/matrix-org/dendrite/pulls?q=+is%3Apr+author%3As7evinK">s7evinK</a> joining the team to work on Dendrite fulltime in the coming weeks :)</p>
<p>Talking of competing priorities, there have been three other big missions going on at the same time as Dendrite dev: firstly - formalising Low Bandwidth Matrix. LB Matrix is super important for maximising battery life on mobile, as well as (obviously) supporting worse network conditions - and it’s effectively a prerequisite for P2P Matrix.  We did a bunch of experiments around it back in <a href="https://matrix.org/blog/2019/03/12/breaking-the-100-bps-barrier-with-matrix-meshsim-coap-proxy">2019</a>, but earlier in the year we needed it <a href="https://twitter.com/element_hq/status/1418632867626770433">for real</a> and <a href="https://github.com/matrix-org/matrix-doc/pull/3079">MSC3079</a> was the result. The low bandwidth dialect which we’ve proposed in the MSC is designed for use on the real Internet using standard IETF protocols (CoAP + DTLS + CBOR) and so isn’t quite as exotic as the 2019 version, but still gives a ~10-20x bandwidth improvement over normal HTTP+JSON based Matrix.  It hasn’t made it to Element yet, but if you’re interested go <a href="https://matrix.org/blog/2021/06/10/low-bandwidth-matrix-an-implementation-guide">check out the blog post</a>!</p>
<p>Secondly, we’ve been sidetracked by the entirety of P2P Matrix.  This is our long-term mission to let Matrix run peer-to-peer without the need for any servers (or indeed Internet connectivity, thanks to Bluetooth Low Energy) by embedding servers such as Dendrite into clients such as Element and so let each Matrix Client have its own personal local homeserver.  We’ve made massive progress over the course of the year on P2P - the biggest breakthroughs being <a href="https://matrix.org/blog/2021/05/06/introducing-the-pinecone-overlay-network">Pinecone</a> as an entirely new P2P overlay network, with the novel SNEK (sequentially networked edwards key) routing topology.  (The animation below shows a P2P network arranging itself into a SNEK!)</p>
<p><img src="/blog/img/2021-12-22-pinecone.gif" alt="SNEK" /></p>
<p>You can read all about it in <a href="https://matrix.org/blog/2021/05/06/introducing-the-pinecone-overlay-network">the blog post</a>, but suffice it to say that Pinecone outperformed all the other P2P overlay networks in <a href="https://github.com/mwarning/meshnet-lab">meshnet-lab</a>’s <a href="https://github.com/mwarning/meshnet-lab/tree/master/tests/mobility2">Mobility2</a> test:</p>
<p><img src="/blog/img/2021-12-22-pinecone-perf.png" alt="Pinecone perf benchmarks" /></p>
<p>You can play with P2P Matrix today on iOS and Android (head over to <a href="https://matrix.to/#/#p2p:matrix.org">#p2p:matrix.org</a> for builds), but there is some major work still to be done:</p>
<ul>
<li>We need to bridge to today’s Matrix network. Right now, having a weird experimental test network for P2P means that in practice nobody actually uses it other than for demos - whereas if you could actually talk to everything else in Matrix, it’d be way more compelling and interesting to use and dogfood.  We’re currently thinking about how best to do this!</li>
<li>We need to standardise the actual transport to be used over Pinecone.  Currently it uses HTTPS over <a href="https://en.wikipedia.org/wiki/Micro_Transport_Protocol">μTP</a> (purely because empirically it handled packet loss and congestion well, and LB Matrix wasn’t ready at the time).  We’re currently experimenting with switching to LB Matrix using our own CoAP implementation called PineCoAP (potentially using pCoCoA congestion control, given CoAP doesn’t provide any congestion control out of the box), but this is early days.</li>
<li>We still need to finalise store-and-forward: if your destination is offline, do you buffer your transactions in the network somehow, or do you use another Matrix node to buffer them?</li>
<li>Relatedly, we need to tweak federation so that if events get lost, federation for a room can recover more gracefully than it does today - for instance, by bundling redundant auth events on transactions, or by providing more recovery mechanisms.</li>
<li>We still need to spec and implement multihomed accounts, so that your identity on your phone is not divorced from your identity on your laptop.</li>
<li>…and obviously, we need a robust post-beta Dendrite to act as the local homeserver!</li>
</ul>
<p>Right now focus is going back to Dendrite for a bit, but P2P work will resume again in the new year :)</p>
<p>Finally, the third big distraction from Dendrite has been… sync v3.</p>
<h2 id="sync-v3">Sync v3</h2>
<p>Sync v3 is shaping up to be the single most significant improvement to Matrix since we began.</p>
<p>Syncing data from the homeserver to the client is obviously fundamental to Matrix - and the current behaviour (sync v2) is far from perfect, as it’s designed around the assumption that your client wants to receive information for every room that it’s in.  In the early days of Matrix, this was fine: a typical user might be in tens of conversations, and it’s useful to have them all available for offline access.  Nowadays, however, it’s a disaster: users can easily accumulate hundreds or thousands of rooms - especially with rooms used to describe spaces or profiles and other structured realtime data.  Moreover, the number of rooms you’re in typically increases linearly over time, unbounded, as nobody wants to archive their old conversations.</p>
<p>So, the idea of sync v3 is that you only sync the strict subset of data that your client actually cares about to display in its UI - effectively making both initial and incremental sync instant, incredibly low bandwidth, and completely independent of the number of rooms you’re in (just as filesystem performance should be independent of the number of directories or files present).</p>
<p>For instance, the full initial sync for @matthew:matrix.org in sync v2 is 417MB of JSON uncompressed - or ~100MB if gzipped, and takes about 5 minutes to calculate on matrix.org (during which it murders the sync worker responsible and hammers the database like crazy).  By contrast, sync v3’s initial sync is 15KB uncompressed, or 5106 bytes compressed - and synced in 250 microseconds from a local sync-v3 server.  <strong>Yes folks, that’s somewhere between a 30,000x to 1,200,000x improvement over sync v2, depending on how you count it.</strong></p>
<p>Sync v3 gets this unbelievable performance by the client defining a sliding window into the server’s datasets, sized and ordered as needed for the client’s UI. This effectively performs real-time serverside pagination, so that as the client scrolls around or filters their roomlist or membership list, the client requests new views from the server.  Meanwhile the server sends incremental updates to the client if they intersect with the sliding window.  This may sound unwieldy, but in practice it works fine (although we’ll have some interesting challenges when we get around to encrypting state events, given serverside ordering and filtering will become distinctly harder).  It also doesn’t design out offline access, as the client caches its view of the world so even if you do go offline you can still work with all the data that has sent to your client so far (and the client could even proactively paginate in other content, if it wanted to, similar to an email client synchronising for offline access).</p>
<p>Sync v3 exists today as a proxy called <a href="https://github.com/matrix-org/sync-v3">sync-v3</a> which sits between any existing homeserver and a sync-v3-capable Matrix client.  It’s very early days, but Hydrogen has <a href="https://github.com/vector-im/hydrogen-web/compare/kegan/syncv3">basic v3 support</a> on a branch which we’ve been using to experiment with the API and flesh it out - and you can see a demo and intro talk in <a href="https://youtu.be/Hsyqa5ozWIo?t=59">last week’s Matrix Live</a>!</p>
<iframe src="https://www.youtube.com/embed/Hsyqa5ozWIo?t=59" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>The API itself is still in flux, but those interested can see the initial spec design at <a href="https://github.com/matrix-org/sync-v3/blob/main/api.md">https://github.com/matrix-org/sync-v3/blob/main/api.md</a> and also an MSC is emerging at <a href="https://github.com/matrix-org/matrix-doc/blob/kegan/sync-v3/proposals/3575-sync.md">MSC3575</a>.  Next steps will be to finish hooking up to Hydrogen (including filtering the room list), finish the MSC, and then start thinking about implementing it in other clients and servers!</p>
<h2 id="fast-joins-over-federation">Fast Joins over Federation</h2>
<p>While we’re on the subject of speeding up Matrix… it’s all very well being able to sync your client instantly, but the other big complaint everyone has about Matrix is how long it takes to join rooms - especially big ones.  As most people will know, it can easily take 5-10 minutes to join a large room like Matrix HQ on a new homeserver - and given this is the first experience most users have of running their own homeserver, it can prove pretty disastrous and we are determined to fix it.  It will become even more relevant when we implement peeking over federation, as the last thing you want is to have to wait 5 minutes to temporarily dip into some random federated room to see if you want to join it or not (or to sniff its room state for things like extensible profiles or <a href="https://github.com/matrix-org/matrix-doc/pull/2313">MSC2313</a> reputation rooms).</p>
<p>So, to address this, we’re currently in the middle of experimenting with <a href="https://github.com/matrix-org/matrix-doc/pull/2775">MSC2775</a> (Lazyloading over Federation) in Synapse. This MSC lets servers participate in a room before they’ve received the full room state by defining a subset of state which is mandatory for participation, and then letting the rest get added lazily.  It’s quite a violent change as it means the assumption that room state is complete (to the best of the server’s knowledge) is no longer true - but given Matrix already has to handle incomplete room state, it’s not necessarily a showstopper.</p>
<p>Watch this space for how well it works in practice, but we’re hoping for a ~20x speed improvement in joining Matrix HQ.</p>
<h2 id="hydrogen">Hydrogen</h2>
<p>2021 has been a busy year for Hydrogen - our ultra-lightweight Matrix Client, which provides a small but perfectly formed progressive web app for us to experiment on! There have been no fewer than 56 releases over the course of the year, with loads of contributions from Bruno, Midhun (who joined first as a GSOCcer and then as a fulltime Element employee) and also Danila who interned at Element on Hydrogen over the summer.</p>
<p>People often ask why Hydrogen exists as well as Element Web - and the reason is because Element Web is (for now at least) very far from a progressive web app and is stuffed full of features, whereas Hydrogen is intended to be as lightweight and simple and efficient as possible while also targeting as wide a range of web browsers as possible (even Internet Explorer!).  It also provides a simpler platform for experimenting with new approaches such as sync v3 or OIDC without getting entangled in the constant hive of activity around Element Web.  Finally, it gives us a playground to experiment with embeddable chat clients thanks to Hydrogen’s strict <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel">MVVM</a> component model.</p>
<p>In terms of features, 2021 has seen huge steps forwards as Hydrogen converges on feature parity with Element - proper mentions and replies; rich formatted linkified messages; reactions; redactions; memberlist; member info; webpush notifications; proper image, video &amp; file uploads; SSO login; sync v3(!) and so much more. Can’t wait to see what 2022 will bring!</p>
<h2 id="end-to-end-encryption">End-to-End Encryption</h2>
<p>2021 saw the long-awaited creation of a dedicated cryptography team to focus exclusively on improving encryption in Matrix: previously encryption expertise was split across various different areas, meaning that it could prove hard to carve out time to tackle the bigger remaining encryption challenges.</p>
<p>So far the team has been busy digging deep into the few remaining causes of UISIs (undecryptable messages), including automated UISI reporting and tracing E2EE flows end-to-end (from client to server to server to client).  There’s also been an initial wave of UX work - with much more to come next year as we overhaul cross-signing and device backups to make it way more user friendly.</p>
<p>Meanwhile, on the more foundational side of things, we’re continuing to define Decentralised MLS as a potential next-generation form of end-to-end encryption, building on the IETF’s <a href="https://datatracker.ietf.org/wg/mls/about/">MLS</a> work - providing much better scalability for large chat rooms and potentially helping with some causes of encryption failures.  Hubert (uhoreg) has been leading the charge here, with his <a href="https://gitlab.matrix.org/matrix-org/mls-ts/-/blob/decentralised2/decentralised.org">latest thoughts emerging here</a> alongside a <a href="https://www.youtube.com/watch?v=UiUyWZg3J7k">brand new demo</a> showing his <a href="https://gitlab.matrix.org/uhoreg/mls-demo">DMLS simulator</a> - which under the hood is actually sending real Matrix events over DMLS!</p>
<p><img src="/blog/img/2021-12-22-dmls.png" alt="DMLS" /></p>
<p>Otherwise, the team has had three big projects: adding matrix-rust-sdk-crypto into Element Android (which we already covered above), arranging a fresh security audit of Matrix’s end-to-end encryption (due to complete January 2022)… and, most excitingly: vodozemac.</p>
<p><a href="https://github.com/matrix-org/vodozemac">Vodozemac</a> (pronounced roughly vod-oz-eh-matz) is an entirely new implementation of our Olm and Megolm end-to-end encryption system, written from scratch in pure Rust, aiming to replace the original reference C/C++11 implementation in <a href="https://gitlab.matrix.org/matrix-org/olm">libolm</a>.  Originally written as an <a href="https://github.com/matrix-org/matrix-rust-sdk/compare/vodozemac-bench">experiment for matrix-rust-sdk</a> at the beginning of the year, in the last week it’s received a <a href="https://github.com/matrix-org/vodozemac/graphs/contributors">huge explosion of attention</a> from poljar and dkasak to bring it up to production quality… for we decided that if we are doing a full E2EE audit for Matrix, we should target the new and future codebase rather than burn money on re-auditing the legacy libolm library (much as the <a href="https://matrix.org/blog/2016/11/21/matrixs-olm-end-to-end-encryption-security-assessment-released-and-implemented-cross-platform-on-riot-at-last">original 2016 review of libolm</a> happened when the library was fresh and new).</p>
<p>The motivation for vodozemac in general is to benefit from the intrinsic type and memory safety and fearless parallelism provided by Rust - and also maintain full type &amp; memory safety throughout the matrix-rust-sdk stack, including encryption.  Over the last year we’ve been taking<a href="https://matrix.org/blog/2021/06/14/adventures-in-fuzzing-libolm"> more and more of a careful look at libolm</a>, and despite our best efforts a <a href="https://matrix.org/blog/2021/12/13/disclosure-buffer-overflow-in-libolm-and-matrix-js-sdk">few</a> memory management bugs have crept in - which vodozemac should be immune to.  Vodozemac will solve another embarrassing problem with libolm: that its default cryptography primitives are designed for correctness rather than performance or safety.  By switching to Rust’s ed25519-dalek and rustCrypto AES primitives we should be in a much better position in terms of performance and safety.</p>
<p>Next up, we’ll be fully integrating vodozemac into matrix-rust-sdk, and figuring out how best to provide it as a libolm replacement in general.</p>
<h2 id="matrix-security">Matrix Security</h2>
<p>Alongside the new Cryptography team we’ve also established a new dedicated Security team for Matrix, led by dkasak.  As well as <a href="https://matrix.org/blog/2021/06/14/adventures-in-fuzzing-libolm">fuzzing excursions</a> into libolm and similar research, Denis has been handling all our <a href="https://matrix.org/security-disclosure-policy">security disclosure policy</a> submissions, managing the <a href="https://blog.intigriti.com/matrix/">Intigriti bug bounty</a> programme, helping coordinate all our security releases, and coordinating the upcoming external independent security audit of vodozemac, matrix-rust-sdk, Element and Synapse.  It’s a huge step forwards to be able to fund full-time infosec researchers to focus exclusively on Matrix, and this is just the beginning!</p>
<h2 id="trust-and-safety">Trust and Safety</h2>
<p>Another place where we’ve created a dedicated team this year is around Trust &amp; Safety: building tools to fight spam and abuse on our own servers, while also empowering the wider network of users, moderators and admins to manage abuse as they see fit.  This includes lots of work on Mjolnir, our primary moderation bot, but also defining MSCs such as <a href="https://github.com/matrix-org/matrix-doc/pull/3215">MSC3215</a> (Aristotle: Moderation in all things) and <a href="https://github.com/matrix-org/matrix-doc/pull/3531">MSC3531</a> (Letting moderators hide messages pending moderation) and internal tooling as we experiment with different approaches.</p>
<p>We’ll have more updates on this in the coming year as we release the tools we’ve been working on, but suffice it to say that the goal is to empower mainstream users in the wider Matrix network to apply their own rules as they see fit, directly from the comfort of their favourite Matrix client - without having to know what a Mjolnir is (or how to run one), and without having to be a moderation expert.</p>
<h2 id="openid-connect">OpenID Connect</h2>
<p>A new project brewing throughout 2021 has been the investigation into replacing the entirety of Matrix’s authentication APIs with industry standard OpenID Connect.  Spearheaded by Quentin, this has proved to be a fascinating and challenging endeavour, but we’re starting to see some really interesting results.  The problem we’re trying to solve here is:</p>
<ul>
<li>As Matrix grows, we’re seeing more and more clients and services appearing which you might want to log into with your Matrix account.  But do you really want to trust each app with your account password?  And what if you only want to give it access to a small subset of your account?</li>
<li>Similarly, we’re seeing more and more login mechanisms used to access Matrix - it’s no longer just a matter just a username + password; many servers use single-sign-on (e.g. mozilla.org) or social login (fosdem.org, matrix.org), or layer on 2FA or MFA hardware tokens and similar to access their accounts via an SSO provider.  We also see passwordless login on the horizon.</li>
</ul>
<p>So, do we really want to mandate each new Matrix client to have to implement custom flows to handle this explosion of login/registration mechanisms?  And is it even really the client’s problem in the first place?  You’re securing access to your account on your chosen server, which isn’t really a client-specific thing at all.</p>
<p>The real turning point for the project however has been our recent experiences building out a new wave of single-use domain-specific clients (see below) for video conferencing, whiteboarding, metaverse-browsing etc… where by <em>far</em> the most painful bit of the project has been hooking up the UI for login, registration, guest access, incremental signup, password reset, email verification, CAPTCHA, SSO, etc.  And that’s even when building on top of matrix-react-sdk, which theoretically has it all already thanks to Element Web!</p>
<p>Frankly, it has become blindingly obvious that it’s crazy for clients to reimplement this every time, and they should instead chuck the user over to a sign-on portal provided by their homeserver - just like Google and everyone else’s single-sign-on does.  And rather than inventing our own homebrew way of doing that, we should just use the existing industry standard SSO best practices defined by OpenID Connect.</p>
<p>The main objections which have come up against this are: “what if my Matrix client doesn’t have a web browser, or what if I want to provide my own native login UI”, and “does this design out the idea of using a single password to access your account as well as your E2EE history”?  In both instances, we have workarounds: in practice, there are so many Matrix clients around that we won’t be removing today’s legacy login/registration APIs any time soon (just like HTTP Basic Auth is still very much a thing on the web!).  And in terms of “cryptographic login”, there are ways we could daisychain the auth required to unlock your E2EE storage to also authenticate you with your server - although this would be a major extension (much as cryptographic login is already today!)</p>
<p>The current status is that we’ve defined a set of initial MSCs (<a href="https://github.com/matrix-org/matrix-doc/pull/2964">MSC2964</a>, <a href="https://github.com/matrix-org/matrix-doc/pull/2965">MSC2965</a>, <a href="https://github.com/matrix-org/matrix-doc/pull/2966">MSC2966</a> and <a href="https://github.com/matrix-org/matrix-doc/pull/2967">MSC2967</a>), and are implementing an initial Open ID Connect auth server (in Rust!) called <a href="https://github.com/matrix-org/matrix-authentication-service">matrix-authentication-service</a> (better name suggestions welcome!) designed to sit alongside your homeserver, and we’re experimenting with hooking <a href="https://github.com/sandhose/hydrogen-web/tree/sandhose/oidc-login">Hydrogen</a> (and some of the new domain-specific clients) up to see how it feels.  But if it goes as well as we think it might, folks should prepare for 2022 to be the year where Matrix’s authentication system finally gets fixed!</p>
<h2 id="native-matrix-video-voip-conferencing">Native Matrix Video/VoIP Conferencing</h2>
<p>One of the most anticipated features in Matrix over the years has been the prospect of native, decentralised, end-to-end encrypted video and voice conferencing.  Today, voice and video conferencing in Matrix works by embedding Jitsi as a third party centralised service into your chatroom.  This works fairly well - but Jitsi is an entirely separate service with lots of moving parts, and its own concept of users and access control (provided by XMPP!) and its megolm-based end-to-end-encryption doesn’t actually integrate with Matrix’s own Olm identities, verification or cross-signing.  The fact that the conference is then logically centralised on whoever is hosting the Jitsi service also misses one Matrix’s main goals - that users should be able to hold a conversation without being dependent on any single service or provider.  Plus it’s really confusing that Matrix has proper native 1:1 calls for DMs… but then switches to a totally different system in group chats.</p>
<p>So, this year we set out to fix it - and succeeded :D  The solution hinges around <a href="https://github.com/matrix-org/matrix-doc/blob/matthew/group-voip/proposals/3401-group-voip.md">MSC3401</a> - a spec proposal that describes how to extend native 1:1 calls to work for groups, while providing real flexibility on how to actually mix the calls together.  At the simplest extreme, it defines how full mesh calls work (where every client simply calls every other client simultaneously) - but then also defines how you can mix calls together either using a single focus (conferencing server) or multiple foci run by different parties, where foci can either be Selective Forwarding Units (SFUs, like Jitsi) or Multipoint Conferencing Units (MCUs, like FreeSWITCH).  The end result is to give us decentralised, cascading, end-to-end encrypted conferencing which even has direct compatibility with today’s 1:1 Matrix calling, letting you easily hook in bots and bridges which already support 1:1 Matrix calls!</p>
<p>Robert Long has been frantically hacking away at the <a href="https://github.com/vector-im/matrix-video-chat">initial implementation</a> over the last few months, fleshing out full-mesh conferencing at first and getting it running in as many browsers as possible (including Mobile Safari and Chrome Android!).  We were hoping to fully unveil the end result in time for Christmas, but in practice we hit some last minute snags (turns out Matthew forgot guest users can’t use TURN, who knew? so much for incremental login! 😰) which have pushed the launch to early next year.  But hopefully in a few weeks, you’ll be able to start jumping on a native group call in Matrix!</p>
<p>Meanwhile, those interested can see all the gory details from our CommCon 2021 talk a few weeks ago, complete with a demo of the shape of things to come…</p>
<iframe src="https://www.youtube.com/embed/A4k7DVIK5TE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Next up, we’ll be working on building an <a href="https://github.com/matrix-org/matrix-doc/pull/3401">MSC3401</a>-compatible SFU so we can go beyond full mesh (which typically supports a maximum of ~7 callers).  Our candidates right now are mediasoup, ion-sfu, janus and signal-calling-service - we’ll let you know how it goes!  Also, if you’re interested in helping us build this out quicker, we are frantically searching for more WebRTC &amp; VoIP gurus to <a href="https://apply.workable.com/elementio/j/25BB112FBD/">join the team at Element</a> working on this.</p>
<h2 id="applications-beyond-chat">Applications Beyond Chat</h2>
<p>Finally, 2021 was the year where we seriously started building out functionality on Matrix which goes far beyond plain old chat rooms.</p>
<p>Work began in the summer as a research project led by Ryan, formerly tech lead for Element Web - looking at ways to store hierarchical structured data into Matrix while preserving real-time semantics; effectively using Matrix as a collaborative decentralised object tree, providing CRDT (Conflict-free Replicated Data Types) to allow richer applications to be built on Matrix.  This journey led him to create <a href="https://github.com/matrix-org/patience">Patience</a> as a test environment for building out these sort of clients, and meanwhile Timo (famous of <a href="https://github.com/toger5/TheBoard">The Board</a>) joined the team to build out <a href="https://youtu.be/Hsyqa5ozWIo?t=1054">Full Screen Widgets</a> in Element, providing a much better UI for beyond-chat experiments.</p>
<p>Meanwhile, Matthew Weidner and the Composable Systems Lab at CMU stunned us all by presenting a complete CRDT solution using Matrix named <a href="https://github.com/composablesys/collabs">Collabs</a> at <a href="https://youtu.be/Exr0iY_D-vw?t=382">Strange Loop 2021</a>.  This is <em>really</em> impressive stuff - the brave of heart can go and embed a Matrix-powered end-to-end-encrypted collaborative markdown editor straight into Element via Collabs by following the <a href="https://compoventuals-tests.herokuapp.com/">instructions here</a>.  In practice, Collabs works by serialising the CRDT updates as base64 blobs inside Matrix timeline events (hello <a href="https://svn.apache.org/repos/asf/incubator/wave/whitepapers/federation/wavespec.html#anchor35">Wave</a>, is that you?), but we’re now investigating how you might reconcile this with maintaining a proper realtime object tree in Matrix.</p>
<p>It’s hard to overstate how powerful storing freeform tree CRDTs in Matrix would be.  It could open up everything from decentralised encrypted collaborative document editing to collaborative whiteboarding and collaborative <a href="https://figma.com/">Figma</a>-style (or <a href="https://penpot.app/">Penpot</a>- or <a href="https://www.blender.org/">Blender</a>-style) design.  You could even start storing an HTML DOM into a room, alongside its binary assets, giving you a multiplayer DOM to build on… and then imagine if you could store the <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format">syntax tree</a> of the code operating on that DOM alongside it, in the same room.  Before you know it, we will have created kind of some incredible <a href="https://en.wikipedia.org/wiki/Smalltalk">Smalltalk</a> / <a href="https://en.wikipedia.org/wiki/Croquet_Project">Croquet</a> / <a href="https://en.wikipedia.org/wiki/Alan_Kay">Alan Kay</a> nirvana where code is data and data is code and it’s all running live in some kind of decentralised encrypted multiplayer Metaverse :D</p>
<p>While we’ve been looking at storing object trees in Matrix, another obvious angle that has emerged is to use Matrix for encrypted decentralised file storage. <a href="https://github.com/matrix-org/matrix-doc/pull/3089">MSC3089</a> is a proposal on how you might represent hierarchies of files in Matrix - where each room acts effectively as a directory of files, with spaces forming a directory structure (much as they do already in today’s Matrix), leveraging Matrix’s existing decentralised access control mechanisms to control who can access what.  Combine such a file storage system with the collaborative editing capabilities mentioned above, and suddenly a really exciting proposition starts to emerge.  We’re investigating this right now, and all will be revealed early next year…</p>
<p>Finally, and last but not least, Robert Long has been building on top of our shiny new Native Matrix Voice/Video Conferencing capabilities to use Matrix as the communication backbone for a truly open, equitable and interoperable vision of the Metaverse.  The best way of describing it is to look at his awesome <a href="https://www.youtube.com/watch?v=e26UJRCGfGk&amp;t=2263s">Third Room demo from the Open Metaverse Interoperability Group demo session</a> in September:</p>
<iframe src="https://www.youtube.com/embed/e26UJRCGfGk?t=2263s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Now, some folks will recall that since day one (in fact, since before day one) the hope for Matrix was that it might end up as the communications fabric of the Metaverse.  We were about 4 years early when we <a href="https://matrix.org/blog/2017/04/04/opening-up-cyberspace-with-matrix-and-webvr">first starting enthusing about this</a>, and then still ahead of our time when we did the world’s first <a href="https://matrix.org/blog/2018/02/05/3-d-video-calling-with-matrix-webrtc-and-webvr-at-fosdem-2018">3D Video calling</a> over Matrix.  However, it now feels like the world has finally caught up - and we’re in grave danger of being overtaken by a dystopia where the big tech companies balkanize the Metaverse into a series of closed proprietary user-exploiting walled gardens, much like today’s incumbent chat silos - but even worse.</p>
<p><strong>This is our chance to fix it before it’s too late</strong>, and <a href="https://element.io/careers">Element is funding a small but highly targeted team</a> to focus exclusively on building out open interoperable Metaverse over Matrix - ensuring that collaboration in 3D (and 2D) spatial environments in future is decentralised, secure and standards-based.  This obviously ties in directly with the rest of the Beyond Chat projects listed above: it’s early days, but it’s incredibly exciting to imagine where we could end up if this works!</p>
<p>Finally, a question which has kept coming up while working on Beyond Chat projects has been whether to implement this new functionality as Matrix widgets, bake them into existing Matrix clients, or build them as domain-specific dedicated Matrix clients.  But perhaps we’re thinking about this all wrong: what if your Matrix client was just a browser for Matrix rooms?  Some of these could be chatrooms.  Some of these could be VoIP/Video conferences or Discord-style voice/video rooms.  Some of these could be message boards or mailing lists.  Some of these could be collaborative editors or whiteboards.  Some of these could be 3D views into the metaverse.  Some of these could be rendered via widgets; some could be rendered natively if the client knows how.  And some of these could even be good old web pages(!!!).</p>
<p>Imagine if your Matrix client was effectively a genuine browser of arbitrary decentralised realtime content?  If your view into a Matrix room was just that: a full window view into that room, be it textual or 2D or 3D - and your Matrix client was just a browser which added the necessary chrome and navigation to help you tab between rooms, login and logout, manage your encryption, track who’s in the room, track your notifications, etc.?</p>
<p>Meanwhile, if you’re in a web browser, you might hop into a lightweight single-page domain-specific webapp which happens to use Matrix for collaboration.  Or if you’re in a Matrix client/browser, you could hop to the same matrix URL to get at the same functionality with all the supporting chrome and UI overlays sliding in as needed…</p>
<p>Perhaps the vision of Matrix as the missing communication layer of the open Web is more literal than we ever thought.  Eitherway, it will be fascinating to see how Applications Beyond Chat evolves over the next year.</p>
<h2 id="2022">2022</h2>
<p>Now, I dare you to cross-reference all of the above with <a href="https://matrix.org/blog/2020/12/25/the-matrix-holiday-special-2020#2021">last year’s predictions for 2021</a> to see how we did :D In practice, the only things from the list we haven’t got to are peeking-over-federation (although arguably fast joins are a key part of that), account portability, and restoring incremental sign-up (although our new clients have it!).</p>
<p>So, here go the predictions for 2022 (keeping it short, otherwise it’ll be 2023 before this blog post gets finished…):</p>
<ul>
<li><strong>Client polish and performance</strong> - our prime directive is to ensure that Matrix clients can be built with UX polish and quality which exceeds our centralised alternatives.  In practice, this means:
<ul>
<li><strong>Element must spark joy</strong>.  Ensuring Element’s Information Architecture continues to be simplified and refined, and that <em>nobody</em> who knows how to use a computer hits a WTF moment when first using the app.  Never again do we want to see someone on Twitter saying “I have no idea how to use Matrix”.</li>
<li><strong>Instant launch</strong>.  With Sync v3 and matrix-rust-sdk we hope to make Element launch instantly on all platforms - including initial sync.</li>
<li><strong>Fast joins</strong>.  We should never get bored while waiting to join a room or accept an invite.</li>
<li><strong>Spaces</strong>.  While Spaces are already a huge improvement in letting users organise and discover rooms, there’s still much more to be done:
<ul>
<li><strong>Flair</strong> - Users who are members of a space should be able to announce it loud and proud with a Flair badge on their avatar, like we used to with the old pre-spaces Communities feature (<a href="https://github.com/matrix-org/matrix-doc/pull/3219">MSC3219</a> being the potential proposal).</li>
<li><strong>Synchronising access controls</strong> - You should be able to apply access controls based on whether a user is a member of a given group (so that if you invite them to #moderators:example.com, they automatically get made moderator in all the rooms in a given space).  It looks likely that this will be implemented at last using joepie91’s <a href="https://github.com/matrix-org/matrix-doc/pull/3216">MSC3216</a> proposal for Synchronized access control for Spaces (rather than Matthew’s original <a href="https://github.com/matrix-org/matrix-doc/pull/2962">MSC2962</a> - an excellent example of the community steering the spec process :)</li>
<li><strong>Bulk joins</strong> - It should be a one-button operation to join all the rooms in a space.</li>
<li>**Subspaces **- as more and more spaces emerge, the ability to navigate them as a hierarchy becomes more and more useful.  We want to get to the point where we can turn off the Matrix.org public rooms list, and instead present a Space tree of all the good rooms we know about in Matrix… delegating over curation to the wider community; building a huge USENET-style hierarchy of where to go in Matrix.  To do that, we need subspaces to sing!</li>
<li><strong>Removing communities/groups</strong>, which will then be entirely superseded by spaces.</li>
</ul>
</li>
<li>**Threads **go-live!</li>
<li><strong>Location share</strong> go-live</li>
<li><strong>Pinned messages</strong>, so the most important messages are always visible to everyone n the room</li>
<li><strong>Starred messages</strong>, so you never lose a message ever again</li>
<li><strong>Custom emoji</strong>, finally merging in all the custom emoji work from the community.</li>
</ul>
</li>
<li><strong>matrix-rust-sdk</strong>
<ul>
<li><strong>Element iOS on rust-sdk</strong></li>
<li><strong>Element Android on rust-sdk-crypto</strong></li>
<li>…and experiment to see how matrix-rust-sdk feels on Web? It’s a real shame that <a href="https://github.com/daydream-mx/Daydream">Daydream</a> got archived…</li>
</ul>
</li>
<li><strong>Encryption</strong>
<ul>
<li><strong>Vodozemac</strong> in matrix-rust-sdk, maybe even elsewhere.</li>
<li>**Updated E2EE Audit **spanning vodozemac, olm+megolm, matrix-rust-sdk… and a representative sample of a typical Element+Synapse deployment.</li>
<li><strong>DMLS</strong> - getting to the point where we can experiment with it in real clients.</li>
<li><strong>Encryption Agility</strong> - the ability to <a href="https://github.com/matrix-org/matrix-doc/issues/3516">migrate encrypted history</a> is going to become really important as we evolve our E2EE, whether that’s by adding in post-quantum algorithms, or moving from Megolm to MLS, or any other shifts.  We will need to start thinking about it in 2022.</li>
</ul>
</li>
<li><strong>Next-generation MSCs</strong>
<ul>
<li><strong>Aggregations</strong> - finalising the foundational MSCs for aggregations, at last</li>
<li><strong>Extensible events</strong> - finalising the foundational MSCs for extensible events, at last</li>
<li>**Sync v3 **- finalising the MSC and implementing it in matrix-rust-sdk</li>
<li><strong>Fast joins</strong> - getting them implemented in Synapse and Dendrite</li>
<li><strong>Peeking over federation</strong> - getting them implemented in Synapse and Dendrite</li>
<li><strong>Extensible profiles</strong> - who needs a facebook wall when you have a profile room on Matrix?</li>
<li><strong>Open ID Connect</strong> - using OIDC as an alternative auth mechanism for new clients.</li>
</ul>
</li>
<li><strong>Gitter parity</strong>
<ul>
<li><strong>Importing the Gitter archives into Matrix</strong> via <a href="https://github.com/matrix-org/matrix-doc/pull/2716">MSC2716</a></li>
<li><strong>Implementing excellent public static Matrix archives</strong> (replacing both view.matrix.org and gitter.im’s static views)</li>
<li><strong>Transfiguring Gitter into a Gitter-themed Element</strong></li>
</ul>
</li>
<li><strong>Dendrite</strong>
<ul>
<li>**Parity with Synapse **- and out of beta, with any luck!</li>
</ul>
</li>
<li><strong>P2P Matrix</strong>
<ul>
<li><strong>Exposing the normal Matrix network via P2P!</strong></li>
<li><strong>Multihomed accounts</strong></li>
<li><strong>Store and forward</strong> (if only by relaying via other P2P Matrix nodes)</li>
<li>**Low bandwidth transports **- via PineCoAP or similar</li>
<li><strong>Making federation robust in a highly disconnected network.</strong></li>
</ul>
</li>
<li><strong>Hydrogen</strong>
<ul>
<li>**Daily Driver **- making sure that Hydrogen can be readily used as a daily driver Matrix client, even if it lacks full parity with Element.</li>
<li>**Embeddable Hydrogen **- making the most of Hydrogen as a tiny lightweight PWA to embed it into existing websites.</li>
</ul>
</li>
<li><strong>Bots and Bridges</strong>
<ul>
<li>**Landing End-to-Bridge-Encryption **for all existing matrix-appservice-bridge based bridges</li>
<li><strong>All the integrations!</strong></li>
<li><strong>First-class UI for configuring integrations!</strong></li>
</ul>
</li>
<li><strong>Trust &amp; Safety</strong>
<ul>
<li><strong>Empower users to manage abuse within their communities</strong>.</li>
</ul>
</li>
<li><strong>Native Group Voice/Video Conferencing</strong>
<ul>
<li><strong>Launch a standalone conferencing app!</strong></li>
<li><strong>Build a <a href="https://github.com/matrix-org/matrix-doc/pull/3401">MSC3401</a>-capable SFU</strong></li>
<li><strong>Add native group calling to Element</strong></li>
</ul>
</li>
<li><strong>Border gateways</strong>
<ul>
<li>Something we didn’t mention in 2021 is the increasing interest in building border gateways and hardware cross domain gateways to safely link different Matrix federations together.  We expect to see a lot of activity in this space in 2022, and there should be some new MSCs too :)</li>
</ul>
</li>
<li><strong>Beyond Chat</strong>
<ul>
<li>**Metaverse on Matrix **- building out the dream as per above!</li>
<li>**Collaborative editing **- extending Matrix to store trees of events, and collaborate on them in realtime - starting with a collaborative editor!</li>
<li><strong>File storage in Matrix</strong> - building out real-life file storage on top of Matrix.</li>
</ul>
</li>
</ul>
<p>So, there you have it. If you’ve got this far… it’s incredible; you’re amazing: thank you for reading!  The sheer length of this update shows just how much Matrix has grown in 2021 relative to previous years; it’s frankly terrifying to imagine how long the equivalent post will be next year.  We may have to change the format a little :)</p>
<p>And that’s a wrap for 2021: we hope you stay safe and have an excellent end of the year.  Huge thanks for flying Matrix and supporting the project - we literally wouldn’t be here without you.</p>
<p>- Matthew, Amandine &amp; the whole Matrix core team.</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;17&#x2F;this-week-in-matrix-2021-12-17&#x2F;" title="This Week in Matrix 2021-12-17">This Week in Matrix 2021-12-17</a></h1>
            <span>
                17.12.2021 00:00
                —
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                —
                <a href="/author/thib">
                    Thib
                </a>
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live">Matrix Live 🎙</h2>
<iframe src="https://www.youtube.com/embed/Hsyqa5ozWIo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>A supercharged episode this week with five super exciting demos!</p>
<h2 id="dept-of-spec-scroll">Dept of Spec 📜</h2>
<p><a href="https://matrix.to/#/@travis:t2l.io">TravisR</a> reports</p>
<blockquote>
<p>Hey all, it's me again, not-anoa, with your spec update. I don't have a graph for you this week, but I do have curated content which hopefully holds you over until next week 🙂 </p>
<p>This week we've seen a few new MSCs get opened up:</p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3567">MSC3567 - Allow requesting events from the start/end of the room history</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3570">MSC3570 - Room history visibility changes for relations</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3571">MSC3571 - Relation aggregation pagination</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3572">MSC3572 - Relation aggregation cleanup</a></li>
</ul>
<p>As demonstrated, a few of them are follow-on work from aggregations. A lot of the work is an effort to get <a href="https://github.com/matrix-org/matrix-doc/pull/2675">MSC2675 - Serverside aggregations of message relationships</a> through FCP - it's changed quite a bit in the last week, so if you reviewed it before then please give it a quick read! </p>
<p>We're also gearing up for <a href="https://github.com/matrix-org/matrix-doc/pull/1767">MSC1767 - Extensible event types &amp; fallback in Matrix</a> receiving attention early next year. This is currently being evaluated by features like <a href="https://github.com/matrix-org/matrix-doc/pull/3245">MSC3245 - Voice messages</a>, <a href="https://github.com/matrix-org/matrix-doc/pull/3381">MSC3381 - Polls</a>, and <a href="https://github.com/matrix-org/matrix-doc/pull/3488">MSC3488 - Static location sharing</a>. If all goes according to plan, the first pieces of Extensible Events will land soon.</p>
<p>Thib has caught me quite close to the deadline on TWIM, so while I don't have a random MSC for you this week I do recommend some light reading around aggregations and extensible events - these are both major features for Matrix and help shape the future for other, even more exciting, features.</p>
</blockquote>
<p><a href="https://matrix.to/#/@deepbluev7:neko.dev">Nico</a> announces</p>
<blockquote>
<h2 id="random-msc">Random MSC</h2>
<p>Since the script didn't run, I manually generated random numbers until I actually got one, that matches an MSC and is not a draft!</p>
<p>So the random MSC is: <a href="https://github.com/matrix-org/matrix-doc/pull/2461">MSC2461: Proposal for Authenticated Content Repository API</a></p>
<p>The goal of this MSC is to restrict who can access files in your content repository, which is used to share files, images, voice messages and more on Matrix. Currently this is secured by using random identifiers, but this MSC wants to add a few more restrictions: A signed-in user can still access everything, but if you don't provide an access token, when downloading media, you either can access no media, only media that was sent from that server, only media which the server already downloaded or everything. The level of access can be set by the server admin.</p>
<p>I think this would be really nice to have, but it has various challenges when implementing it in clients and when it needs to work across federation. It could limit how much random users can fill up your disk though, which is especially important for small server admins!</p>
</blockquote>
<h2 id="dept-of-servers-europea">Dept of Servers 🏢</h2>
<h3 id="synapse">Synapse <a href="https://github.com/matrix-org/synapse/">↗</a></h3>
<p>Synapse is the reference homeserver for Matrix</p>
<p><a href="https://matrix.to/#/@callahad:matrix.org">callahad</a> reports</p>
<blockquote>
<p>Happy holidays! This week we <a href="https://matrix.org/blog/2021/12/14/synapse-1-49-0-released">released Synapse 1.49.0</a>, our last planned release of the year. This is the last release that supports Python 3.6 or PostgreSQL 9.6; if you've not upgraded, now is the time!</p>
<p>Most notably, this release includes stable support for <a href="https://github.com/matrix-org/matrix-doc/pull/2918">MSC2918: Refresh tokens</a>. This is a more secure alternative to long-lived access tokens, and we'd encourage clients to implement support for refresh tokens as described in the MSC.</p>
<p>We also released <a href="https://github.com/matrix-org/sygnal/releases/">Sygnal 0.11</a>, which includes <em>loads</em> of bugfixes. For the Element-managed Sygnal instances, this release has reduced our daily Sentry error rate by over 99%, dramatically improving the signal-to-noise ratio of our monitoring.</p>
<p>See you in January with Synapse 1.50! 🎄</p>
</blockquote>
<h3 id="sydent">Sydent <a href="https://github.com/matrix-org/sydent">↗</a></h3>
<p>Sydent is the reference Matrix Identity server. It provides a lookup service, so that you can find a Matrix user via their email address or phone number (if they have chosen to share it).</p>
<p><a href="https://matrix.to/#/@dmrobertson:matrix.org">dmr</a> announces</p>
<blockquote>
<p>I've just published the <a href="https://matrix.org/blog/2021/12/17/type-coverage-for-sydent-evaluation">third and final</a> post on Sydent's type annotations (<a href="https://matrix.org/blog/2021/12/03/type-coverage-for-sydent-motivation">part 1</a>, <a href="https://matrix.org/blog/2021/12/03/type-coverage-for-sydent-motivation">part 2</a>).  This one is more reflective and tries to quantify our efforts: how well have we done?</p>
<p>Thanks for reading---I hope it's been useful.</p>
</blockquote>
<h2 id="homeserver-deployment-inbox-tray">Homeserver Deployment 📥️</h2>
<h3 id="helm-chart">Helm Chart <a href="https://gitlab.com/ananace/charts">↗</a></h3>
<p>Matrix Kubernetes applications packaged into helm charts</p>
<p><a href="https://matrix.to/#/@ace:kittenface.studio">Ananace</a> announces</p>
<blockquote>
<p>And yet again more updates have been done on <a href="https://gitlab.com/ananace/charts">my Helm Charts</a> - bringing element-web up to 1.9.7 and matrix-synapse up to 1.49.0</p>
</blockquote>
<h2 id="dept-of-clients-iphone">Dept of Clients 📱</h2>
<h3 id="nheko">Nheko <a href="https://nheko-reborn.github.io">↗</a></h3>
<p>Desktop client for Matrix using Qt and C++17.</p>
<p><a href="https://matrix.to/#/@deepbluev7:neko.dev">Nico</a> reports</p>
<blockquote>
<p>We are planning to have a small release next week, that fixes a few issues with the 0.9.0 release. It would be lovely if some of you could test one of our <a href="https://matrix-static.neko.dev/room/!TshDrgpBNBDmfDeEGN:neko.dev/">nightlies</a> or could check if the translations for a language you speak are up to date in <a href="https://weblate.nheko.im/projects/nheko/nheko-master/#translations">our weblate</a>.</p>
<p>Some of the fixes this week include another crash fix for handling matrix links from your browser, notification bubbles that can show values over 9000(!), better preview images for sticker and emote packs created in Nheko, allowing you to click links in replies, a few layout and click area fixes. Nheko now also keeps track of your latest reactions and gives you easy access to them in the hover menu.</p>
<p>Nheko now also finally supports pinned messages! Most of you probably don't know, but that feature has pretty much always been in the matrix spec, but very few clients expose it. Today Nheko joins that rank! It's part of our goal to provide better support for building communities. Topics can be quite limiting, because they can only contain plain text. Pinned messages allow for much more creative freedom! They can also be encrypted, while state events currently never are, but the key for that isn't reshared, so currently experience in encrypted rooms is a tradeoff. Maybe we'll go for an encrypted description event in the future, but for now this seems to be a good solution to bridge the gap.</p>
<p>Let's hope the current master branch is good and we'll have a release with ALL THE FIXES next week! And thank you everyone, who already translated and reported issues! It took less than 10 hours to have 5 languages updated to 100%! Last year we didn't even have that many languages at 100%! You guys are AMAZING! &lt;3</p>
<p><img src="/blog/img/RNnSTOGBVtfiaOCHOQqGolHU.png" alt="" /></p>
<p><img src="/blog/img/PTyCXJMeTKobmwZOtWipMTon.png" alt="" /></p>
</blockquote>
<h3 id="element">Element <a href="https://element.io">↗</a></h3>
<p>Everything related to Element but not strictly bound to a client</p>
<p><a href="https://matrix.to/#/@kittykat:matrix.org">kittykat</a> announces</p>
<blockquote>
<p>Development has kicked off for location sharing! Watch this space for more news in the new year.</p>
<h3 id="threads">Threads</h3>
<ul>
<li>List of threads in a room is now more accurate and viewing very long threads has improved with the integration with the homeserver APIs. (These APIs are not enabled on matrix.org yet.)</li>
<li>Threads on mobile platforms are catching up to Web, with many changes in review.</li>
<li>Iterated on the design for restricted history threads and search results across all platforms.</li>
<li>Design for thread previews in room list has been improved for mobile platforms.</li>
<li>Improved Android bottom sheet expandable and scrollable behaviour design.</li>
<li>We’ve created <a href="https://github.com/matrix-org/matrix-doc/blob/clokep/messages-from/proposals/3567-optional-from-on-messages.md">MSC3567</a> to fix some edge cases with API calls</li>
</ul>
<h3 id="polls">Polls</h3>
<ul>
<li>Only one Android bug is outstanding!</li>
<li>Gathering feedback to incorporate into the next phase of development, join us for the community testing session on Monday at 17:00 in <a href="https://matrix.to/#/#element-community-testing:matrix.org">#element-community-testing:matrix.org</a></li>
</ul>
<h3 id="voip">VoIP</h3>
<ul>
<li>Continuing with polishing &amp; bug fixing for full mesh calling app. One remaining bug somewhere causing members to not connect properly. Finalising how much of registration &amp; login we can/want to implement for the short term until it’s replaced by OAuth login.</li>
</ul>
<h3 id="community-testing-sessions">Community testing sessions</h3>
<ul>
<li>Tested all three Release Candidates (RCs) at the same time for the first time! Did not find any new web issues when testing first time user experiences and basic interactions on Web. We found 6 new issues on Android and 9 on iOS.</li>
<li>Tried out the Information Architecture changes on web with the Delight team. Very exciting to see these changes available in Labs already!</li>
<li>Closed 33 out of 60 re-tested encryption issues on Web and prioritised a few to be considered for upcoming work.</li>
<li>Next sessions, join <a href="https://matrix.to/#/#element-community-testing:matrix.org">#element-community-testing:matrix.org</a> :
<ul>
<li>17:00 UTC / 18:00 CET on Monday 20th December to test the new Polls feature</li>
<li>16:30 UTC / 17:30 CET on Tuesday 21st December to squash more encryption bugs!
<img src="/blog/img/ArjkIIisnkKvKLfmKOoeLgGl.gif" alt="" /></li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="element-web-desktop">Element Web/Desktop <a href="https://github.com/vector-im/element-web">↗</a></h3>
<p>Secure and independent communication, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-web:matrix.org">#element-web:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@kittykat:matrix.org">kittykat</a> announces</p>
<blockquote>
<ul>
<li>We’ve been working on auto-generating code and documentation for events raised by our client analytics (code <a href="https://github.com/matrix-org/matrix-analytics-events/">here</a>, PR for documentation generation <a href="https://github.com/matrix-org/matrix-analytics-events/">here</a>). This allows us to publish a comprehensive list of everything our analytics capture, which is great both for end users and for people doing analysis.</li>
<li>In labs (you can enable labs features in settings on develop.element.io or on Nightly)
<ul>
<li>First milestone reached on<a href="https://github.com/vector-im/element-meta/issues/56"> Information Architecture</a>! To try it out, enable “Threaded messaging”, “Use new room breadcrumbs” and “New spotlight search experience” in the Labs settings.</li>
<li>We’re actively collecting feedback on IA to review in the new year.</li>
<li>Starting work on Message Bubble defects</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="element-ios">Element iOS <a href="https://github.com/vector-im/element-ios">↗</a></h3>
<p>Secure and independent communication for iOS, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-ios:matrix.org">#element-ios:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@kittykat:matrix.org">kittykat</a> reports</p>
<blockquote>
<ul>
<li>Fixed an issue around some voice messages not playing in bridged rooms.</li>
<li>Polls changes are in this week’s release candidate (RC) and will be available behind a Labs flag in the next release.</li>
<li>Analytics changes have been merged into the RC and opt-in will be available soon.</li>
<li>In development:
<ul>
<li>Spaces is coming closer to completion: we’re there on space creation, adding rooms to spaces, space management and more. Release coming in the new year!</li>
<li>Work on implementing new login flow continues, with more improvements incoming.</li>
</ul>
</li>
</ul>
<p><img src="/blog/img/KdSaHslcYIIeqsUrscQsshAA.png" alt="" /></p>
</blockquote>
<h3 id="element-android">Element Android <a href="https://github.com/vector-im/element-android">↗</a></h3>
<p>Secure and independent communication for Android, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-android:matrix.org">#element-android:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@kittykat:matrix.org">kittykat</a> announces</p>
<blockquote>
<ul>
<li>Improvements to the timeline performance (faster display, faster scroll) after updates to the way we store timeline events.</li>
<li>Analytics framework has been merged, opt-in request will be shown to users once more translations have landed. For now, you can enable it in the settings.</li>
<li>Work on Message Bubbles has started!</li>
</ul>
</blockquote>
<h3 id="cinny">Cinny <a href="https://cinny.in">↗</a></h3>
<p>Cinny is a Matrix client focused on simplicity, elegance and security</p>
<p><a href="https://matrix.to/#/@ajbura:matrix.org">ajbura</a> says</p>
<blockquote>
<h1 id="cinny-v1-6-0">Cinny v1.6.0</h1>
<h3 id="features">Features</h3>
<ul>
<li>Room Timeline
<ul>
<li>Add pagination in room timeline</li>
<li>Replies link back to original message event</li>
<li>Use formatted_body to parse markdown</li>
<li>Support rich replies</li>
<li>Separation of read/unread messages in the room</li>
<li>Typing outside of an input box should focus the message field</li>
<li>Spoiler display support</li>
<li>User pill display support</li>
<li>Custom emoji display support </li>
<li>Performance improvements</li>
</ul>
</li>
<li>Export E2E key for decrypting history in another client</li>
<li>Replaced go-to commands with Room search modal (Ctrl + k)</li>
<li>Remember people panel state</li>
<li>Twemojified all kind of text (except inputs)</li>
<li>Add option to hide membership and user events from timeline</li>
<li>Messages now span to full viewport width</li>
<li>Add animation on hover in sidebar/avatar</li>
</ul>
<h3 id="bugs">Bugs</h3>
<ul>
<li>Fix defer typing notifications until it can't be a command</li>
<li>Fix checkbox in register page</li>
<li>Fix app sending read receipt in background</li>
<li>Fix crash on creating room</li>
<li>Fix dark theme colors</li>
</ul>
<h3 id="security-update">Security update</h3>
<ul>
<li>Matrix-js-sdk to v15.2.1</li>
<li>Olm to v3.2.8
This release include <a href="https://matrix.org/blog/2021/12/13/disclosure-buffer-overflow-in-libolm-and-matrix-js-sdk">security release of libolm and matrix-js-sdk</a>, so down-streamers please update ASAP.</li>
</ul>
<p>Find more about Cinny at https://cinny.in/
Join our channel at: <a href="https://matrix.to/#/#cinny:matrix.org">#cinny:matrix.org</a>
Github: https://github.com/ajbura/cinny
Twitter: https://twitter.com/@cinnyapp
<img src="/blog/img/tSdPEWxSdqCyONfgAVmjMeRK.png" alt="" /></p>
</blockquote>
<h2 id="dept-of-non-clients-control-knobs">Dept of Non Clients 🎛️</h2>
<h3 id="matrix-highlight">Matrix Highlight <a href="https://github.com/DanilaFe/matrix-highlight">↗</a></h3>
<p>A decentralized and federated way of annotating the web based on Matrix.</p>
<p><a href="https://matrix.to/#/@daniel:matrix.danilafe.com">Daniel</a> announces</p>
<blockquote>
<p>I've been working on a matrix-based tool for highlighting and annotating websites. By building on top of matrix, we can effectively have a decentralized, federated and collaborative way to leave notes and highlights on pages. I wrote a <a href="https://danilafe.com/blog/introducing_highlight/">brief introduction on my blog</a>, as well as made a little bit of a simple <a href="https://youtu.be/Q3h5A0DsE1s">demo video</a>. Here's a copy-pasted list of planned and existing features:</p>
<ul>
<li><strong>Current</strong>: Create and send website annotations over Matrix.</li>
<li><strong>Current</strong>: Store data in a decentralized and federated manner.</li>
<li><strong>Current</strong>: Share highlights with other users, including those on other servers.</li>
<li><strong>Current</strong>: Group annotations together and create multiple annotation groups</li>
<li><strong>Planned</strong>: Use Matrix's End-to-End encryption to ensure the secure transmission and storage of highlight data.</li>
<li><strong>Planned</strong>: Leverage the new <a href="https://github.com/matrix-org/matrix-doc/blob/gsouquet/threading-via-relations/proposals/3440-threading-via-relations.md">m.thread MSC</a> to allow users to comment on and discuss
highlights.</li>
<li><strong>Planned</strong>: Use something like <a href="https://archivebox.io/">ArchiveBox</a> to cache the current version of a website and prevent annotations from breaking.</li>
<li><strong>Planned</strong> Highlight PDFs in addition to web pages.</li>
</ul>
<p>Come join <a href="https://matrix.to/#/#matrix-highlight:matrix.danilafe">#matrix-highlight:matrix.danilafe</a>.com to receive updates about the project!</p>
<p>I haven't published the code just yet, but I'm going to as soon as the tool is in better shape.
<img src="/blog/img/iNQhWZroTXrGCTBslRLoFjQC.png" alt="" />
<img src="/blog/img/npsGwapwwnSHcenQaCnWoTyi.png" alt="" /></p>
</blockquote>
<p><a href="https://matrix.to/#/@daniel:matrix.danilafe.com">Daniel</a> announces</p>
<blockquote>
<p>Matrix highlight for probably the last time this week. Highlight comments and self-editing are implemented, though I'm not sure I'll stick with this particular model.</p>
</blockquote>
<h3 id="populus-viewer">Populus Viewer <a href="https://github.com/opentower/populus-viewer">↗</a></h3>
<p>A Social Annotation Tool Powered by Matrix</p>
<p><a href="https://matrix.to/#/@gleachkr:matrix.org">gleachkr</a> announces</p>
<blockquote>
<p>I've been teaching a class this semester using a tool built on the matrix-js-sdk and tentatively entitled <a href="https://github.com/opentower/populus-viewer">populus-viewer</a>. Populus-viewer uses Matrix as a backend for the social annotation of PDFs, with the goal of helping matrix become a platform for teaching and scholarly collaboration. If you're interested in learning more, or adopting populus-viewer in your teaching, come visit <a href="https://matrix.to/#/#opentower:matrix.org">#opentower:matrix.org</a>! </p>
<p>Populus-Viewer currently supports:</p>
<ul>
<li>Annotation of PDFs with highlights and pin-drops</li>
<li>Matrix conversations based on annotations</li>
<li>Audio and video messages</li>
<li>Replies, reactions, and redactions</li>
<li>Markdown for rich text</li>
<li>LaTeX for mathematical notation</li>
<li>Typing notifications</li>
<li>Synchronized reading position across devices</li>
<li>SSO, with single-click links for embedding in an LMS like Canvas or Blackboard.</li>
</ul>
<p>As the project develops, I'm hoping to continue to polish the reading experience, and to add support for other mime types (audio and video especially).</p>
</blockquote>
<iframe src="https://www.youtube.com/embed/WM_JGbEffIg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h3 id="matrix-streamchat">matrix-streamchat <a href="https://git.pixie.town/f0x/matrix-streamchat">↗</a></h3>
<p>Matrix powered stream overlay for OBS, to integrate live chat in your favorite (selfhosted) streaming setups.</p>
<p><a href="https://matrix.to/#/@f0x:pixie.town">f0x</a> announces</p>
<blockquote>
<p>TWIM I got started on the chat part of <a href="https://git.pixie.town/f0x/matrix-streamchat">matrix-streamchat</a>, to provide a lightweight embeddable Matrix client to be used alongside streams in Owncast and PeerTube. It will use guest access, and lots more features to come like extensive custom emote support. For now refactoring a bunch of things first before adding more flashy things, but who knows, you might see me do it live on https://stream.pixie.town</p>
</blockquote>
<iframe src="https://www.youtube.com/embed/c8mWsQzZow0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks 🧰</h2>
<h3 id="vodozemac">vodozemac <a href="https://github.com/matrix-org/vodozemac">↗</a></h3>
<p>An implementation of Olm and Megolm in pure Rust.</p>
<p><a href="https://matrix.to/#/@matthew:matrix.org">Matthew</a> says</p>
<blockquote>
<p>Introducing vodozemac (https://github.com/matrix-org/vodozemac) - a rewrite of libolm in Rust by poljar and dkasak!  The intention is for this to become the reference Olm implementation going forwards, and to get it audited asap (and benefit from all of Rust’s nice safety and parallelism features, and better crypto primitives!)</p>
</blockquote>
<h3 id="simplematrixbotlib">simplematrixbotlib <a href="https://github.com/KrazyKirby99999/simple-matrix-bot-lib">↗</a></h3>
<p>simplematrixbotlib is an easy to use bot library for the Matrix ecosystem written in Python and based on matrix-nio.</p>
<p><a href="https://matrix.to/#/@krazykirby99999:matrix.org">krazykirby99999</a> says</p>
<blockquote>
<h2 id="version-2-5-0-released">Version 2.5.0 Released!</h2>
<p>simplematrixbotlib is an easy to use bot library for the Matrix ecosystem written in Python and based on matrix-nio. Version 2.5.0 adds improvements to the config feature.</p>
<h3 id="feature-changes">Feature Changes:</h3>
<ul>
<li>Add allow/block lists: This allows bot developers to specify allow/block lists of users who have permission to interact with the bot using regex.</li>
<li>Permissions can checked with <code>Match.is_from_allowed_user()</code>, which lets the bot developer choose which responses are restricted.</li>
<li>The allow/block lists can by modified at runtime via the <code>Config.add_allowlist()</code>, <code>Config.remove_allowlist()</code>, <code>Config.add_blocklist()</code>, and <code>Config.remove_blocklist()</code> methods.</li>
</ul>
<p>A thank you to HarHarLinks for their contributions to version 2.5.0!</p>
<p>Request additional features <a href="https://github.com/KrazyKirby99999/simple-matrix-bot-lib/issues/new?assignees=&amp;labels=&amp;template=feature_request.md&amp;title=">here</a>.</p>
<p><a href="https://github.com/KrazyKirby99999/simple-matrix-bot-lib">View source on Github</a>
<a href="https://pypi.org/project/simplematrixbotlib/">View package on PyPi</a>
<a href="https://simple-matrix-bot-lib.readthedocs.io/en/latest/">View docs on readthedocs.io</a>
https://matrix.to/#/#simplematrixbotlib:matrix.org</p>
</blockquote>
<h3 id="dimension">Dimension <a href="https://github.com/turt2live/matrix-dimension">↗</a></h3>
<p>An open source integration manager for matrix clients, like Element.</p>
<p><a href="https://matrix.to/#/@travis:t2l.io">TravisR</a> announces</p>
<blockquote>
<p><a href="https://github.com/turt2live/matrix-dimension">Dimension</a>, an integration manager alternative for Element, has received a bunch of updates over the last couple weeks:</p>
<ul>
<li>Added (early) support for <a href="https://github.com/Half-Shot/matrix-hookshot">matrix-hookshot</a>'s GitHub, Jira, and Webhooks bridging. </li>
<li>Most of a redesign complete to make it feel more like an Element UI rather than something special and third party.</li>
</ul>
<p>If you're interested in helping out in getting the redesign finished, please check out https://github.com/turt2live/matrix-dimension/issues/458 which has reference mockups and linked issues. The major parts are the &quot;complex bots&quot; (Travis CI, RSS, etc) and the sticker integration. Unfortunately, I don't have enough free time to work on it myself in the near term, but will get back to it eventually 🙂 </p>
<p>And now, a complementary screenshot of the Good™ parts:
<img src="/blog/img/83fb70def97801c405383cbe0da72baa0d0bff1c.png" alt="" /></p>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops 🛠</h2>
<h3 id="matrix-commit">matrix-commit <a href="https://github.com/KrazyKirby99999/matrix-commit">↗</a></h3>
<p>A Github Action for sending messages to a Matrix Room.</p>
<p><a href="https://matrix.to/#/@krazykirby99999:matrix.org">krazykirby99999</a> reports</p>
<blockquote>
<h2 id="example-usage">Example Usage:</h2>
<pre data-lang="yaml" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#608b4e;"># .github/workflows/matrix-commit.yml
</span><span style="color:#569cd6;">on</span><span>:
</span><span>  </span><span style="background-color:#282828;color:#569cd6;">push</span><span>:
</span><span>    </span><span style="background-color:#282828;color:#569cd6;">branches</span><span>:
</span><span>      - </span><span style="background-color:#282828;color:#d69d85;">master</span><span>
</span><span>
</span><span style="background-color:#282828;color:#569cd6;">jobs</span><span>:
</span><span>  </span><span style="background-color:#282828;color:#569cd6;">matrix_action_job</span><span>:
</span><span>    </span><span style="background-color:#282828;color:#569cd6;">runs-on</span><span>: </span><span style="background-color:#282828;color:#d69d85;">ubuntu-latest</span><span>
</span><span>    </span><span style="background-color:#282828;color:#569cd6;">name</span><span>: </span><span style="background-color:#282828;color:#d69d85;">Send Message to Matrix Room</span><span>
</span><span>    </span><span style="background-color:#282828;color:#569cd6;">steps</span><span>:
</span><span>
</span><span>    - </span><span style="background-color:#282828;color:#569cd6;">name</span><span>: </span><span style="background-color:#282828;color:#d69d85;">Checkout</span><span>
</span><span>      </span><span style="background-color:#282828;color:#569cd6;">uses</span><span>: </span><span style="background-color:#282828;color:#d69d85;">actions/checkout@v2</span><span>
</span><span>
</span><span>    - </span><span style="background-color:#282828;color:#569cd6;">name</span><span>: </span><span style="background-color:#282828;color:#d69d85;">matrix-commit</span><span>
</span><span>      </span><span style="background-color:#282828;color:#569cd6;">uses</span><span>: </span><span style="background-color:#282828;color:#d69d85;">krazykirby99999/matrix-commit@v1</span><span>
</span><span>
</span><span>      </span><span style="background-color:#282828;color:#569cd6;">with</span><span>:
</span><span>        </span><span style="background-color:#282828;color:#569cd6;">homeserver</span><span>: </span><span style="background-color:#282828;color:#d69d85;">${{ secrets.BOT_HOMESERVER }}</span><span>
</span><span>        </span><span style="background-color:#282828;color:#569cd6;">username</span><span>: </span><span style="background-color:#282828;color:#d69d85;">${{ secrets.BOT_USERNAME }}</span><span>
</span><span>        </span><span style="background-color:#282828;color:#569cd6;">access_token</span><span>: </span><span style="background-color:#282828;color:#d69d85;">${{ secrets.BOT_ACCESS_TOKEN }}</span><span>
</span><span>
</span><span>        </span><span style="background-color:#282828;color:#569cd6;">room_id</span><span>: </span><span style="background-color:#282828;color:#d69d85;">${{ secrets.ROOM_ID }}</span><span>
</span><span>        </span><span style="background-color:#282828;color:#569cd6;">message</span><span>: </span><span style="color:#d69d85;">&quot;#### New Commit:&quot;
</span><span>
</span></code></pre>
<h2 id="notes">Notes:</h2>
<h3 id="syntax">Syntax:</h3>
<ul>
<li>The homeserver should be in the form of <code>https://domain.tld</code></li>
<li>The username should be the username, not the user id. (<code>krazykirby99999</code>, not <code>@krazykirby99999:matrix.org</code>)</li>
<li>The room_id should be the internal room id of the room, not the published address. (<code>!QQpfJfZvqxbCfeDgCj:matrix.org</code>, not <code>#thisweekinmatrix:matrix.org</code>) This can be found under Room Options &gt; Advanced &gt; Room Information in the Element Client.</li>
</ul>
<h3 id="other">Other</h3>
<ul>
<li>If the room_id is not specified, the bot will send the message to all joined rooms.</li>
<li>If the message is not specified, it will default to <code>Commit:</code>.</li>
<li>The bot will join all invited rooms upon the start of an action.</li>
</ul>
<p>Contributions are welcome - https://github.com/KrazyKirby99999/matrix-commit</p>
<p><img src="https://matrix-client.matrix.org/_matrix/media/r0/download/matrix.org/pHEBXSjdXSKpGDFsrdkttAbh" alt="Example Image" /></p>
</blockquote>
<h2 id="dept-of-bots-robot-face">Dept of Bots 🤖</h2>
<h3 id="matrix-imposter-bot">matrix-imposter-bot <a href="https://github.com/mrjohnson22/matrix-imposter-bot">↗</a></h3>
<p>A Matrix appservice for relaying messages.</p>
<p><a href="https://matrix.to/#/@mr_johnson22:matrix.org">mr_johnson22</a> says</p>
<blockquote>
<p><strong><a href="https://github.com/mrjohnson22/matrix-imposter-bot">matrix-imposter-bot</a></strong> - A bot that uses your account to repeat other people's messages. This gives relay-bot capabilities to puppet-only bridges.</p>
<p>I made this project a while ago to hack in a relay mode to the <a href="https://github.com/mautrix/facebook">mautrix Facebook bridge</a>. But as of this week, that bridge supports relaying natively! 🎉 Thus, my main motivation for maintaining imposter-bot is obsolete, and the project will be on indefinite hiatus.</p>
<p>With that said, it can (mostly) still be used to add relay support to any bridges that don't yet support a relay mode themselves--but native relay support is always better!</p>
<p>Thanks to everyone who's shown interest in the project, and to tulir  for making such great bridges!</p>
</blockquote>
<h2 id="dept-of-interesting-projects">Dept of Interesting Projects 🛰️</h2>
<h3 id="chatstat">ChatStat <a href="https://github.com/GregSutcliffe/ChatStat/">↗</a></h3>
<p>An R package To Gather Stats From Chat Platforms</p>
<p><a href="https://matrix.to/#/@gwmngilfen:matrix.org">Gwmngilfen</a> announces</p>
<blockquote>
<p>A project has started to re-implement the venerable mIRCstats for Matrix! It's in very early stages, right now it only does &quot;getting a data-frame of events for a list of rooms&quot; and has no <em>actual</em> visualisations baked in <strong>yet</strong>. However, we're moving quickly, and I hope to have some initial easy-to-use viz in place over the Christmas break.</p>
<p>The project is written in R (because I am an R user, and its good for data and viz work :P) and you can find it <a href="https://github.com/GregSutcliffe/ChatStat/">here</a>. If you're new to R and want to give it a go, check out the <em>extremely</em> brief howto I just wrote <a href="https://github.com/GregSutcliffe/ChatStat/wiki/A-non-R-user&#x27;s-guide-to-ChatStat">here</a>. I look forward to all the ways you will tell me it's broken!</p>
<p><img src="/blog/img/2021-12-17-chatstat.png" alt="" /></p>
</blockquote>
<h2 id="dept-of-built-on-matrix">Dept of <em>Built on Matrix</em> 🏗️</h2>
<h3 id="saint-petersburg-widget-a-board-game-build-on-matrix">Saint Petersburg Widget <a href="https://github.com/toger5/st-petersburg-widget">(A Board Game build on Matrix)</a></h3>
<p><a href="https://matrix.to/#/@toger5:matrix.org">Timo K.</a> announces</p>
<blockquote>
<p>Board games are great. And Matrix and its widget api turned out to be an excellent environment to create collaborative board games. With some really impressive conditions:</p>
<ul>
<li>I don't have to maintain a server with a database.</li>
<li>I don't have to create a custom account systems user need to register. They play with their matrix account, which also makes accessibility great. Someone invites you in a room with the game and you can play!</li>
<li>I just need to host one static file and ppl will be able to play as long as that static site exists.</li>
</ul>
<p>This project tries to be two things. A tech demo and inspiration to what is possible with widgets (Especially, with the changes on how widgets can be displayed in element (Check the &quot;matrix live&quot; Demos! 😊) )
Second it should serve as source and resource. For ideas and solutions on how no trust games can be executed without server (third party) side logic. And, for the ones interested, also as a resource on how widgets are implemented.</p>
<p>Last but not least the game Saint Petersburg is really fun. It takes a couple of minutes to grasp the rules but it is one of those games where there are so many things that can be considered with simple rules that it becomes more and more exciting with each round. So I really invite you to check out the <a href="https://www.fgbradleys.com/rules/rules4/Saint%20Petersburg%20-%20rules.pdf">rules</a> and give it a try. Its best to start in the <a href="https://github.com/toger5/st-petersburg-widget">Git Repo</a> or join the this room: <a href="https://matrix.to/#/#st-petersburg-auth:matrix.org">#st-petersburg-auth:matrix.org</a></p>
<p>To put it simple, the widget works like this: The game state is stored in the room state and is updated through the widget directly.
This of course raises <strong>questions</strong>: How is it still possible to prohibit users from cheating and manually changing parameters like, how much money they own. Everyone (who has the permission) is always able to send whatever state events they want?
How is it possible to draw random cards if there is no third party involved. Could I not just send a state event with the cards that I hope are going to be drawn and are beneficial for me. Can we make card drawing deterministic? Not really since then everyone know what is going to happen. Which kind of breaks the game...</p>
<p>I would be super happy, if someone is interested and wants to find answer to the questions above by checking out the <a href="https://github.com/toger5/st-petersburg-widget/blob/main/README.md">README</a>.
<img src="/blog/img/xEMkNtlvWhazgWCSjDfxREVB.png" alt="" /></p>
</blockquote>
<h2 id="matrix-in-the-news-newspaper">Matrix in the News 📰</h2>
<p><a href="https://matrix.to/#/@kim:sosnowkadub.de">kim</a> says</p>
<blockquote>
<p>There is an article (exclusive to paid subscribers) in the German tech news/magazine website heise.de about
&quot;Running your own messaging service using the matrix server&quot;
https://www.heise.de/ratgeber/Eigener-Chatserver-Mit-dem-Matrix-Server-einen-Messaging-Dienst-betreiben-6289020.html</p>
<p>I'm not a subscriber but sounds like they go over how to set up using the Ansible playbook <a href="https://matrix.to/#/#matrix-docker-ansible-deploy:devture.com">#matrix-docker-ansible-deploy:devture.com</a></p>
</blockquote>
<h2 id="dept-of-ping-table-tennis-paddle-and-ball">Dept of Ping 🏓</h2>
<p>Here we reveal, rank, and applaud the homeservers with the lowest ping, as measured by <a href="https://github.com/maubot/echo">pingbot</a>, a <a href="https://github.com/maubot/maubot">maubot</a> that you can host on your own server.</p>
<h3 id="ping-maunium-net"><a href="https://matrix.to/#/#ping:maunium.net">#ping:maunium.net</a></h3>
<p>Join <a href="https://matrix.to/#/#ping:maunium.net">#ping:maunium.net</a> to experience the fun live, and to find out how to add YOUR server to the game.</p>
<table><thead><tr><th style="text-align: center">Rank</th><th style="text-align: center">Hostname</th><th style="text-align: center">Median MS</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center">envs.net</td><td style="text-align: center">451.5</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">cri.epita.fr</td><td style="text-align: center">1019</td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">aria-net.org</td><td style="text-align: center">1446.5</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">flueren.eu</td><td style="text-align: center">1576</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center">matrix.home.boris-wach.de</td><td style="text-align: center">3181</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">trygve.me</td><td style="text-align: center">3519</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center">utzutzutz.net</td><td style="text-align: center">4038</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">matx.myecloud.org</td><td style="text-align: center">4855.5</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center">rollyourown.xyz</td><td style="text-align: center">4989.5</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">grimneko.de</td><td style="text-align: center">5127</td></tr>
</tbody></table>
<h3 id="ping-no-synapse-maunium-net"><a href="https://matrix.to/#/#ping-no-synapse:maunium.net">#ping-no-synapse:maunium.net</a></h3>
<p>Join <a href="https://matrix.to/#/#ping-no-synapse:maunium.net">#ping-no-synapse:maunium.net</a> to experience the fun live, and to find out how to add YOUR server to the game.</p>
<table><thead><tr><th style="text-align: center">Rank</th><th style="text-align: center">Hostname</th><th style="text-align: center">Median MS</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center">rustybever.be</td><td style="text-align: center">461</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">conduit.supercable.onl</td><td style="text-align: center">524</td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">dendrite.supercable.onl</td><td style="text-align: center">539</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">conduit.cyberdi.sk</td><td style="text-align: center">953.5</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center">matrix.awesomesheep48.me</td><td style="text-align: center">1434.5</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">s2.toldi.eu</td><td style="text-align: center">1593</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center">0x1a8510f2.space</td><td style="text-align: center">2125</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">dendrite.beckmeyer.us</td><td style="text-align: center">8497</td></tr>
</tbody></table>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know 🏁</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#twim:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;17&#x2F;type-coverage-for-sydent-evaluation&#x2F;" title="Type coverage for Sydent: evaluation">Type coverage for Sydent: evaluation</a></h1>
            <span>
                17.12.2021 00:00
                —
                <a href="/category/tech">
                    Tech
                </a>
                —
                <a href="/author/david-robertson">
                    David Robertson
                </a>
            </span>
            
        </header>
        <div>
            <p>This is the third in a series of three posts which discuss recent work to improve type annotations in <a href="https://github.com/matrix-org/sydent">Sydent</a>, the reference Matrix Identity server. <a href="https://matrix.org/blog/2021/12/10/type-coverage-for-sydent-annotation">Last time</a> we discussed the mechanics of how we added type coverage. Now I want to reflect on how well we did. What information and guarantees did we gain from <code>mypy</code>? How could we track our progress and measure the effect of our work? And lastly, what other tools are out there apart from <code>mypy</code>?</p>
<h2 id="the-best-parts-of-strict">The best parts of <code>--strict</code></h2>
<p>While the primary goal was to improve Sydent's coverage and robustness, to some extent this was an experiment too. How much could we get out of typing and static analysis, if we <em>really</em> invested in thorough annotations? Sydent is a small project that would make for a good testbed! I decided my goal would be to get Sydent passing mypy under <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-strict">--strict mode</a>. This is a command line option which turns on a number of extra checks (though not everything); it feels similar to passing <code>-Wall -Wextra -Werror</code> to <code>gcc</code>. It's a little extreme, but Sydent is a small project and this would be a good chance to see how hard it would be. In my view, the most useful options implied by strict mode were as follows.</p>
<h3 id="check-untyped-defs"><a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-check-untyped-defs">--check-untyped-defs</a></h3>
<p>By default, mypy will only analyze the implementation of functions that are annotated. On the one hand, without annotations for inputs and the return type, it's going to be hard for mypy to thoroughly check the soundness of your function. On the other, it can still do good work with the type information it has from other sources. Mypy can</p>
<ul>
<li>infer the type of literals, e.g. deducing <code>x: str</code> from  <code>x = &quot;hello&quot;</code>;</li>
<li>lookup the return types of standard library calls, via <code>typeshed</code>; and similarly</li>
<li>lookup the return types of any annotated functions in your code or dependencies.</li>
</ul>
<p>The information is already available for free: we may as well try to use it to spot problems.</p>
<h3 id="disallow-untyped-defs-and-friends"><a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-disallow-untyped-defs">--disallow-untyped-defs</a> and <a href="https://mypy.readthedocs.io/en/stable/command_line.html#untyped-definitions-and-calls">friends</a></h3>
<p>This flag forces you to fully annotate every function. There are less extreme versions available, e.g. <code>--disallow-incomplete-defs</code>; but I think this is a good option to ensure full coverage of your module. It means you can rely on mypy's error output as a to-do list.</p>
<p>One downside to this: sometimes I felt like I was writing obvious boilerplate annotations, e.g.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>    </span><span style="color:#569cd6;">def </span><span>__str__(self) -&gt; str:
</span><span>        </span><span style="color:#569cd6;">...
</span></code></pre>
<p>There was one particular example of this that crops up a lot. Mypy has a special exception for a class's <code>__init__</code> and <code>__init_subclass__</code> methods. If a return type annotation is missing, it will <a href="https://github.com/python/mypy/issues/604#issuecomment-348525995">assume these functions return None</a> instead of <code>Any</code>. (See  here for <a href="https://github.com/python/mypy/pull/5677">its implementation</a>.) This is normally compatible with <code>--disallow-untyped-defs</code> and <code>--disallow-incomplete-defs</code>, with one exception. If your <code>__init__</code> function takes no arguments other than <code>self</code>, mypy won't consider it annotated, and you'll need to write <code>-&gt; None</code> explicitly.</p>
<p>It's also worth mentioning <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-disallow-untyped-calls">--disallow-untyped-calls</a>, which will cause an error if an annotated function calls an unannotated function. Again, it helps to ensure that mypy has a complete picture of the types in your function's implementation. It also helps to highlight dependencies—if you see errors from this, it might be more practical to annotate the functions and modules it's calling first.</p>
<h3 id="warn-return-any"><a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-warn-return-any">--warn-return-any</a></h3>
<p>If I've written a function and annotated it to return an <code>int</code>, mypy will rightly complain if its implementation actually goes on to return a <code>str</code>.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">def </span><span>foo() -&gt; int:
</span><span>    </span><span style="color:#608b4e;"># error: Incompatible return value type (got &quot;str&quot;, expected &quot;int&quot;)
</span><span>    </span><span style="color:#569cd6;">return </span><span style="color:#d69d85;">&quot;hello&quot;
</span></code></pre>
<p>If mypy isn't sure what type I'm returning though, i.e. if I'm returning an expression of type <code>Any</code>, then by default mypy will trust that we've done the right thing.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">def </span><span>i_promise_this_is_an_int():
</span><span>    </span><span style="color:#569cd6;">return </span><span style="color:#d69d85;">&quot;hello&quot;
</span><span>
</span><span style="color:#569cd6;">def </span><span>bar() -&gt; int:
</span><span>    reveal_type(i_promise_this_is_an_int()) </span><span style="color:#608b4e;"># Any
</span><span>    </span><span style="color:#569cd6;">return </span><span>i_promise_this_is_an_int()
</span></code></pre>
<p>Enabling <code>--warn-return-any</code> will disable this behaviour; to make this error pass we'll have to prove to mypy that <code>i_promise_this_is_an_int()</code> really is an <code>int</code>. Sometimes that will be the case, and an extra annotation will provide the necessary proof. At other times (like in this example), investigation will prove that there really is a bug!</p>
<h3 id="strict-equality"><a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-strict-equality">--strict-equality</a></h3>
<p>This is a bit like a limited form of gcc's <a href="https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html">-Wtautological-compare</a>. Mypy will report and reject equality tests between incompatible types. If mypy can spot that an equality is always <code>False</code>, there's a good chance of there being a bug in your program, or else an incorrect annotation.</p>
<p>I'm not sure how general this check is, since users can define their own types with their own rules for equality by overriding <a href="https://docs.python.org/3/reference/datamodel.html?highlight=__eq__#object.__eq__"><strong>eq</strong></a>. Perhaps it only applies to built-in types?</p>
<h2 id="quantifying-coverage">Quantifying coverage</h2>
<p>It was important to have some way to numerically evaluate our efforts to improve type coverage. It's a fairly abstract piece of work: there's nothing user-visible about it, unless we happen to discover a bug and fix it.</p>
<p>The most obvious metric is the number of total errors reported by mypy. Before the recent sprint, we had roughly 600 errors total.</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>dmr on titan in sydent on  HEAD (3dde3ad) via 🐍 v3.9.7 (env)
</span><span>2021-11-08 12:35:37 ✔  $ mypy --strict sydent
</span><span>Found 635 errors in 59 files (checked 78 source files)
</span></code></pre>
<p>This is a decent way to measure your progress when working on a particular module or package, but it's not perfect, because the errors aren't independent. Fixing one could fix another ten or reveal another twenty—the numeric value can be erratic.</p>
<h3 id="reports">Reports</h3>
<p>I found mypy's various <a href="https://mypy.readthedocs.io/en/stable/command_line.html#report-generation">reports</a> to be a better approach here. There were three reports I found particularly useful.</p>
<h4 id="html-report"><code>--html-report</code></h4>
<p>This produces a main index page showing the &quot;imprecision&quot; of each module. At the bottom of the table is a total imprecision value across the entire project.</p>
<p><img src="/blog/img/2021-12-17-sydent-typing-html-report-index.png" alt="HTML report, index page. A table showing each module's precision and number of lines of code." /></p>
<p>The precision for each module is broken down line-by-line and colour-coded accordingly, which is useful for getting an intuition for what makes a line imprecise. More on that shortly.</p>
<p><img src="/blog/img/2021-12-17-sydent-typing-html-report-module.png" alt="HTML report, module page. Most lines of source code are highlighted green; a minority are highlighted red." /></p>
<h4 id="txt-report"><code>--txt-report</code></h4>
<p>This reproduces the index page from the <code>html</code> report as a plain text file. It's slightly easier to parse—that's how I got the data for the precision line graphs in <a href="https://matrix.org/blog/2021/12/03/type-coverage-for-sydent-motivation">part one</a> of this series. That was a quick and dirty hack, though; a proper analysis of precision probably ought to read from the json or xml output formats. Here's a truncated sample:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>+-----------------------------------+-------------------+----------+
</span><span>| Module                            | Imprecision       | Lines    |
</span><span>+-----------------------------------+-------------------+----------+
</span><span>| sydent                            |   0.00% imprecise |    1 LOC |
</span><span>| sydent.config                     |   0.00% imprecise |  266 LOC |
</span><span>| sydent.config._base               |   0.00% imprecise |   31 LOC |
</span><span>| sydent.config.crypto              |  15.94% imprecise |   69 LOC |
</span><span>| ...                               |               ... |      ... |
</span><span>| sydent.validators                 |   0.00% imprecise |   61 LOC |
</span><span>| sydent.validators.common          |   7.35% imprecise |   68 LOC |
</span><span>| sydent.validators.emailvalidator  |   1.30% imprecise |  154 LOC |
</span><span>| sydent.validators.msisdnvalidator |   1.34% imprecise |  149 LOC |
</span><span>+-----------------------------------+-------------------+----------+
</span><span>| Total                             |   5.95% imprecise | 9707 LOC |
</span><span>+-----------------------------------+-------------------+----------+
</span></code></pre>
<h4 id="any-exprs-report"><code>--any-exprs-report</code></h4>
<p>Selecting this option generate two reports: <code>any-exprs.txt</code> and <code>types-of-anys.txt</code>. The latter is interesting to understand where the <code>Anys</code> come from, but the former is more useful for quantifying the progress of typing. Another sample:</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>                  Name   Anys   Exprs   Coverage
</span><span>-------------------------------------------------
</span><span>                sydent      0       2    100.00%
</span><span>         sydent.config      0     185    100.00%
</span><span>   sydent.config._base      0       3    100.00%
</span><span>  sydent.config.crypto     34      80     57.50%
</span><span>sydent.config.database      0       8    100.00%
</span><span>   sydent.config.email      0      86    100.00%
</span><span>                   ...    ...     ...        ...
</span><span>-------------------------------------------------
</span><span>                 Total    544   11366     95.21%
</span></code></pre>
<p>The breakdown in <code>types-of-anys.txt</code> has more gory detail. I found the &quot;Unimported&quot; column particularly interesting: it lets us see how exposed we are to a lack of typing in our dependencies.</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>                             Name   Unannotated   Explicit   Unimported   Omitted Generics   Error   Special Form   Implementation Artifact
</span><span>-------------------------------------------------------------------------------------------------------------------------------------------
</span><span>                           sydent             0          0            0                  0       0              0                         0
</span><span>                    sydent.config             0          3            0                  0       0              0                         0
</span><span>              sydent.config._base             0          0            0                  0       0              0                         0
</span><span>                              ...           ...        ...          ...                ...     ...            ...                       ...
</span><span>        sydent.util.versionstring             0         80            0                  0       0              0                         0
</span><span>                sydent.validators             0          4            0                  0       0              0                         0
</span><span>         sydent.validators.common             0         20            0                  0       0              0                         0
</span><span> sydent.validators.emailvalidator             0          8            0                  0       0              0                         0
</span><span>sydent.validators.msisdnvalidator             0          8            0                  0       0              0                         0
</span><span>-------------------------------------------------------------------------------------------------------------------------------------------
</span><span>                            Total             9       1276          273                  0      37              0                        17
</span><span>
</span></code></pre>
<h3 id="the-meaning-of-precision">The meaning of precision</h3>
<p>There are two metrics I chose to focus on:</p>
<ul>
<li>the proportion of &quot;imprecise&quot; lines across the project; I also used the complement, <code>precision = 100% - imprecision</code>, and</li>
<li>the proportion of expressions whose type is not <code>Any</code>.</li>
</ul>
<p>These are plotted in the graph at the top of this writeup. I could see that precision and the proportion of typed expressions were correlated, but I didn't understand how they differed. I couldn't see an explanation in the mypy docs, so I went <a href="https://github.com/python/mypy/blob/d807e097d142a88a48af93314d15ad87e41d2f19/mypy/stats.py">digging</a> into the mypy source code. My understanding is as follows.</p>
<ol>
<li>There are <a href="https://github.com/python/mypy/blob/d807e097d142a88a48af93314d15ad87e41d2f19/mypy/stats.py#L27-L31">five kinds of precision</a>. Full details are visible in the <code>--lineprecision-report</code>.</li>
<li>Two kinds of precision, <code>EMPTY</code> and <code>UNANALYZED</code> convey no information, because there's nothing to analyze.</li>
<li>A line is marked as precise, imprecise or any based on the expressions it uses.
<ul>
<li>An expression that has type <code>Any</code> leads to precision <code>ANY</code>.</li>
<li>I <em>think</em> an expression that <a href="https://github.com/python/mypy/blob/2907a4dea939e20ff39ef7d9ff85ae1a199a0ee8/mypy/stats.py#L422-L423">involves <code>Any</code> but is not <code>Any</code></a> counts as imprecise. For instance, <code>Dict[str, Any]</code>.</li>
<li>Remaining expressions have precision <code>PRECISE</code>.</li>
</ul>
</li>
<li>A line's precision is the worst of all its expressions' precisions.
<ul>
<li><code>ANY</code> is worse than <code>IMPRECISE</code>, which is worse than <code>PRECISE</code>.</li>
</ul>
</li>
</ol>
<p>The &quot;imprecision&quot; number reported by mypy counts the number of lines <a href="https://github.com/python/mypy/blob/3bdef9fe6d401f3d2e0cacf4964bd315550c3394/mypy/xml/mypy-txt.xslt#L77-L78">classified as <code>IMPRECISE</code> or <code>ANY</code></a>.</p>
<p>On balance, my preferred metric is the line-level (im)precision percentage. There wasn't much difference between the two in my experience, but the colour-coded visualisation in the HTML report is a neat feature to have. Maybe in the future there could be a version of the HTML report that colour-codes each <em>expression</em>?</p>
<h2 id="the-larger-typing-ecosystem">The larger typing ecosystem</h2>
<p>There are plenty of articles out there about the typing. As well as the <a href="http://mypy-lang.blogspot.com/">mypy blog itself</a>, see Daniele Varrazzo's <a href="https://www.varrazzo.com/blog/2020/03/31/first-experience-mypy/">post on <code>psycopg3</code> (2020)</a>, Dropbox's <a href="https://dropbox.tech/application/our-journey-to-type-checking-4-million-lines-of-python">blog post (2019)</a>, Zulip's <a href="https://blog.zulip.com/2016/10/13/static-types-in-python-oh-mypy/">blog post (2016)</a>, Glyph's <a href="https://glyph.twistedmatrix.com/2020/07/new-duck.html">blog post on <code>Protocols</code> (2020)</a> and a follow-up <a href="https://glyph.twistedmatrix.com/2021/03/interfaces-and-protocols.html">comparing them to <code>zope.interface</code> (2021)</a> and Nylas's <a href="https://www.nylas.com/blog/not-your-pie-mypy/">blog (2019)</a>. I'm sure there's plenty more out there.</p>
<p>It's worth highlighting the <code>typeshed</code> project, which maintains stubs for the standard library, plus popular third-party libraries. I <a href="https://github.com/python/typeshed/pull/6150">submitted a PR</a> to add a single type hint—it was a very pleasant experience! Microsoft has an <a href="https://github.com/microsoft/python-type-stubs">incubator</a> of sorts for stubs too.</p>
<h3 id="other-typecheckers">Other typecheckers</h3>
<p>After the sprint to improve coverage, I spent a short amount of time trying the alternative type checkers out there. Mypy isn't the <em>only</em> typechecker out there—other companies have built and open-sourced their own tools, with different strengths, weaknesses and goals. This is by no means an authoritative, exhaustive survey—just my quick notes.</p>
<h4 id="pyre-facebook"><a href="https://pyre-check.org/">Pyre</a> (Facebook)</h4>
<ul>
<li>I couldn't work out how to configure paths to resolve import errors; in the end, I wasn't able to process much of Sydent's source code.</li>
<li>Couldn't get it to process annotations like <code>syd: &quot;Sydent&quot;</code> where &quot;Sydent&quot; is an import guarded by <a href="https://docs.python.org/3/library/typing.html?highlight=type_checking#typing.TYPE_CHECKING">TYPE_CHECKING</a>.</li>
<li>No plugin system that I could see. That said, it has a separate mode/program for running <a href="https://pyre-check.org/docs/pysa-basics">&quot;Taint Analysis&quot;</a> to spot security issues.</li>
<li>Seemed stricter by default compared to mypy: there was less inference of types.</li>
<li>Also has its own strict mode.</li>
</ul>
<h4 id="pyright-microsoft"><a href="https://github.com/microsoft/pyright">Pyright</a> (Microsoft)</h4>
<ul>
<li>Didn't seem to recognise <code>getLogger</code> as being imported from <code>logging</code>. Not sure what happened there—maybe something wrong with its bundled version of <code>typeshed</code>?</li>
<li>In a few places, Sydent uses <code>urllib.parse.quote</code> but only imports <code>urllib</code>. We must be unintentionally relying on our dependencies to <code>import urllib.parse</code> somewhere! Mypy didn't complain about this; pyright did.</li>
<li>Seemed to give a better explanations of why complex types were incompatible. For example:<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>/home/dmr/workspace/sydent/sydent/replication/pusher.py
</span><span>   /home/dmr/workspace/sydent/sydent/replication/pusher.py:77:16 - error: Expression of type &quot;DeferredList&quot; cannot be assigned to return type &quot;Deferred[List[Tuple[bool, None]]]&quot;
</span><span>     TypeVar &quot;_DeferredResultT@Deferred&quot; is contravariant
</span><span>       TypeVar &quot;_T@list&quot; is invariant
</span><span>         Tuple entry 2 is incorrect type
</span><span>           Type &quot;None&quot; cannot be assigned to type &quot;_DeferredResultT@_DeferredListResultItemT&quot; (reportGeneralTypeIssues)
</span><span> /home/dmr/workspace/sydent/sydent/sms/openmarket.py
</span><span>   /home/dmr/workspace/sydent/sydent/sms/openmarket.py:93:13 - error: Argument of type &quot;dict[_KT@dict, list[bytes]]&quot; cannot be assigned to parameter &quot;rawHeaders&quot; of type &quot;Mapping[AnyStr@__init__, Sequence[AnyStr@__init__]] | None&quot; in function &quot;__init__&quot;
</span><span>     Type &quot;dict[_KT@dict, list[bytes]]&quot; cannot be assigned to type &quot;Mapping[AnyStr@__init__, Sequence[AnyStr@__init__]] | None&quot;
</span><span>       TypeVar &quot;_KT@Mapping&quot; is invariant
</span><span>         Type &quot;_KT@dict&quot; is incompatible with constrained type variable &quot;AnyStr&quot;
</span><span>       Type cannot be assigned to type &quot;None&quot; (reportGeneralTypeIssues)
</span></code></pre>
This would have been really helpful when interpreting mypy's error reports; I'd love to see something like it in mypy.
Here's another example where I tried running against a Synapse file.<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>/home/dmr/workspace/synapse/synapse/storage/databases/main/cache.py
</span><span>/home/dmr/workspace/synapse/synapse/storage/databases/main/cache.py:103:53 - error: Expression of type &quot;list[tuple[Unknown, Tuple[Unknown, ...]]]&quot; cannot be assigned to declared type &quot;List[Tuple[int, _CacheData]]&quot;
</span><span>  TypeVar &quot;_T@list&quot; is invariant
</span><span>    Tuple entry 2 is incorrect type
</span><span>      Tuple size mismatch; expected 3 but received indeterminate number (reportGeneralTypeIssues)
</span></code></pre>
This is really valuable information. It's worth considering Pyright as an option to get a second opinion!</li>
<li>It looks like Pyright's name for <code>Any</code> is <code>Unknown</code>. I think that does a better job of emphasising that <code>Unknown</code> won't be type checked. I'd certainly be more reluctant to type <code>x: Unknown</code> versus <code>x: Any</code>!</li>
<li>Pyright is the machinery behind <a href="https://github.com/microsoft/pylance-release">Pylance</a>, which drives <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.vscode-pylance">VS Code's Python extension</a>. That alone probably makes it worthy of more eyes.</li>
<li>Seemed like it was the best-placed alternative typechecker to challenge mypy (the de-facto standard).</li>
</ul>
<h4 id="pytype-google"><a href="https://github.com/google/pytype">Pytype</a> (Google)</h4>
<ul>
<li>Google internal? Seems to be maintained by one person semiregularly by &quot;syncing&quot; from Google.</li>
<li>Apparently contains a script <a href="https://github.com/google/pytype/tree/master/pytype/tools/merge_pyi">merge-pyi</a> to annotate a source file given a stub file.</li>
<li>No support for TypedDict: as soon as it saw one in Sydent, it stopped all analysis.</li>
<li>No Python 3.10 support (according to the README anyway).</li>
<li>I think it might use a different kind of typing semantics; its <a href="https://google.github.io/pytype/typing_faq.html">typing FAQ</a> speaks of &quot;descriptive typing&quot; and a more lenient approach.</li>
</ul>
<h4 id="pycharm"><a href="https://www.jetbrains.com/pycharm/">PyCharm</a></h4>
<p>PyCharm has its own means to typechecking code as you write it. It's definitely caught bugs before, and having the instant feedback as you type is really nice! I have seen it struggle with <code>zope.interface</code> and some uses of <code>Generic</code>s though.</p>
<h3 id="runtime-uses-of-annotations">Runtime uses of annotations</h3>
<p>When annotations <a href="https://www.python.org/dev/peps/pep-3107/">were first introduced</a>, they were a generic means to associate Python objects with parts of a program. (It was only later that the community agreed that we really want to use them to annotate <em>types</em>). These annotations are available at runtime in the <code>__annotations__</code> attribute. There's also a helper function in <code>typing</code> which will help resolve forward references.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>&gt;&gt;&gt; </span><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>get_type_hints
</span><span>&gt;&gt;&gt; </span><span style="color:#ff3333;">def </span><span>foo(x: int) -&gt; str: </span><span style="color:#569cd6;">pass
</span><span style="color:#569cd6;">...
</span><span>&gt;&gt;&gt; get_type_hints(foo)
</span><span>{</span><span style="color:#d69d85;">&#39;x&#39;</span><span>: &lt;</span><span style="color:#ff3333;">class </span><span style="color:#d69d85;">&#39;int&#39;</span><span>&gt;, </span><span style="color:#d69d85;">&#39;return&#39;</span><span>: &lt;</span><span style="color:#ff3333;">class </span><span style="color:#d69d85;">&#39;str&#39;</span><span>&gt;}
</span></code></pre>
<p>Programs and libraries are free to use these annotations at runtime as they see fit. The most well-known examples are probably <a href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a>, <a href="https://www.attrs.org/en/stable/">attrs</a> with <a href="https://www.attrs.org/en/stable/types.html">auto_attribs=True</a> and <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a>. I'd be interested to learn if anyone else is consuming annotations at runtime!</p>
<h2 id="summary">Summary</h2>
<p>All in all, in a two-week sprint we were able to get Sydent's mypy coverage from a precision of 83% up to 94%. Our work would have spotted the <a href="https://github.com/matrix-org/sydent/pull/415">bytes-versus-strings bug</a>; we understand why <a href="https://github.com/matrix-org/sydent/pull/413">the missing await</a> wasn't detected. We <a href="https://github.com/matrix-org/sydent/issues/419">fixed</a> <a href="https://github.com/matrix-org/sydent/issues/449">other</a> <a href="https://github.com/matrix-org/sydent/issues/447">small</a> <a href="https://github.com/matrix-org/sydent/issues/445">bugs</a> too as part of the process. As well as fix bugs, I've hopefully made the source code clearer for future readers (but that one is hard to quantify).</p>
<p>There's room to spin out contributions upstream too. I submitted <a href="https://github.com/twisted/twisted/pull/1669">two</a> <a href="https://github.com/twisted/twisted/pull/1668">PRs</a> to twisted upstream; have started to work on annotations for <a href="https://github.com/pyca/pynacl/pull/693">pynacl</a> <a href="https://github.com/pyca/pynacl/pull/694">in my</a> <a href="https://github.com/pyca/pynacl/pull/695">spare time</a>; and submitted a quick fix to <a href="https://github.com/python/typeshed/pull/6150">typeshed</a>.</p>
<p>Looking forward, I think we'd get a quick gain from ensuring that our smaller libraries (<a href="https://github.com/matrix-org/python-signedjson">signedjson</a>, <a href="https://github.com/matrix-org/python-canonicaljson">canonicaljson</a>) are annotated. We'll be sticking with mypy for now—the <code>mypy-zope</code> plugin is crucial given our reliance on twisted. We're also working to improve Sygnal and Synapse—though not to the extreme standard of <code>--strict</code> across everything.</p>
<p>I'd say the biggest outstanding hole is our processing of JSON objects. There's too much <code>Dict[str, Any]</code> flying around. The ideal for me would be to define <code>dataclass</code> or <code>attr.s</code> class <code>C</code>, and be able to deserialise a JSON object to <code>C</code>, including automatic (deep) type checking. <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a> sounds really close to what we want, but I'm told it will by default gladly interpret the json string <code>&quot;42&quot;</code> as the Python integer <code>42</code>, which isn't what we'd like. More investigation needed there. There are other avenues to explore too, like <a href="https://github.com/erickpeirson/jsonschema-typed">jsonschema-typed</a>, <a href="https://pypi.org/project/typedload/">typedload</a> or <a href="https://github.com/bloomberg/attrs-strict">attrs-strict</a>.</p>
<p>To end, I'd like to add a few personal thoughts. Having types available in the source code is definitely A Good Thing. But there is a part of me that wonders if it might have been worth writing our projects in a language which incorporates types from day one. There are always trade-offs, of course: runtime performance, build times, iteration speed, ease of onboarding new contributors, ease of deployment, availability of libraries, ability to shoot yourself in the foot... the list goes on. </p>
<p>On a more upbeat note, adding typing is a great way to get familiar with new source code. It involves a mixture of reading, cross-referencing, deduction, analysis, all across a wide variety of files. It'd be a <em>lot</em> easier to type as you write from the get-go, but typing after the fact is still a worthy use of time and effort. </p>
<hr />
<p>Many thanks for reading! If you've got any corrections, comments or queries, I'm available on Matrix at <a href="https://matrix.to/#/@dmrobertson:matrix.org">@dmrobertson:matrix.org</a>.</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;15&#x2F;on-matrix-and-the-log4j-vulnerabilities&#x2F;" title="On Matrix and the log4j vulnerabilities">On Matrix and the log4j vulnerabilities</a></h1>
            <span>
                15.12.2021 12:58
                —
                <a href="/category/security">
                    Security
                </a>
                —
                <a href="/author/matrix-security">
                    Matrix Security
                </a>
            </span>
            
        </header>
        <div>
            <p>There is currently a lot of buzz and uncertainty around a number of vulnerabilities discovered in the log4j library in the Java ecosystem. These vulnerabilities are collectively known as &quot;Log4Shell&quot; and currently encompass CVE-2021-44228 and CVE-2021-45046.</p>
<p>First and foremost, there are to our knowledge no Matrix homeservers written in Java. <a href="https://github.com/matrix-org/synapse/">Synapse</a>, the canonical implementation developed by the Matrix Foundation and the implementation that is backing matrix.org, is written in Python and thus unaffected. P2P Matrix relies on <a href="https://github.com/matrix-org/dendrite">Dendrite</a>, our next-gen homeserver which is written in Go and is unaffected. <a href="https://gitlab.com/famedly/conduit/">Conduit</a>, a community homeserver, is written in Rust and also unaffected. Supporting components like <a href="https://github.com/matrix-org/sygnal">Sygnal</a> and <a href="https://github.com/matrix-org/sydent">Sydent</a> are written in Python and unaffected.</p>
<p>There are two components that are commonly used in the Matrix ecosystem that do rely on Java. These are Jitsi, specifically the <a href="https://github.com/jitsi/jitsi-videobridge">Jitsi Videobridge</a> for VoIP, and <a href="https://gitlab.com/signald/signald">signald</a> used by the Signal bridge. Both components pull in log4j as part of their (transitive) dependencies. We're not aware of other bridges that are dependent on Java-based components.</p>
<p>For both of these projects updates have been published that integrate log4j 2.15.0 covering the initial CVE and we're currently waiting for additional updates to be published that integrate log4j 2.16.0 to cover the second. In the meantime, we've put all mitigations we are aware of in place on our systems and we strongly recommend everyone do the same.</p>
<p>For what mitigations to put in place, we recommend following the <a href="https://www.lunasec.io/docs/blog/log4j-zero-day-mitigation-guide/">recommendations provided by LunaSec</a>. They also provide a lot of background information on the vulnerabilities and how to audit for them.</p>
<p>Please keep an eye out for releases from the Jitsi and signald projects and follow their upgrade instructions to update your own deployments as soon as possible.</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;14&#x2F;synapse-1-49-0-released&#x2F;" title="Synapse 1.49.0 released">Synapse 1.49.0 released</a></h1>
            <span>
                14.12.2021 00:00
                —
                <a href="/category/releases">
                    Releases
                </a>
                —
                <a href="/author/brendan-abolivier">
                    Brendan Abolivier
                </a>
            </span>
            
        </header>
        <div>
            <p><a href="https://github.com/matrix-org/synapse/releases/tag/v1.49.0">Synapse 1.49.0</a> is out now!</p>
<h2 id="platform-deprecations">Platform deprecations</h2>
<p>Synapse 1.49.0 is the last version of Synapse to officially support Python 3.6 and PostgreSQL 9.6. This follows our <a href="https://matrix-org.github.io/synapse/v1.49/deprecation_policy.html">platform dependency deprecation policy</a>.</p>
<p>As a consequence of this, Synapse 1.49.0 is the last version of Synapse to support Ubuntu 18.04 LTS (Bionic Beaver), as it ships with Python 3.6.</p>
<p>On the topic of supported Ubuntu releases, please note that Ubuntu 21.04 (Hirsute Hippo) reaches its own end of life <a href="https://lists.ubuntu.com/archives/ubuntu-announce/2021-December/000275.html">on January 20, 2022</a>. Past this date we will stop producing new packages for Ubuntu 21.04.</p>
<h2 id="improved-documentation">Improved documentation</h2>
<p>Up until now, a lot of very useful information was stored on the <a href="https://github.com/matrix-org/synapse/wiki">Synapse repo's wiki</a>, which wasn't well advertised nor well reviewed.</p>
<p>With this release, we have migrated most of this information to Synapse's <a href="https://matrix-org.github.io/synapse/latest">documentation website</a>, so all the information you need to set up, maintain and troubleshoot a Synapse instance lives at the same place. Included in these new pages are the <a href="https://matrix-org.github.io/synapse/v1.49/usage/administration/admin_faq.html">server admin FAQ</a> and a <a href="https://matrix-org.github.io/synapse/v1.49/usage/administration/understanding_synapse_through_grafana_graphs.html">guide to Synapse's Grafana dashboard</a>.</p>
<p>The <a href="https://matrix-org.github.io/synapse/v1.49/media_repository.html">media repository</a> documentation has also been updated with a lot of details about how Synapse stores media files.</p>
<h2 id="refresh-tokens">Refresh tokens</h2>
<p>When a Matrix client needs to authenticate a request to a homeserver, it uses what is called an access token. Sometimes server administrators might not want a user's access token to live forever (e.g. for security reasons). To address this concern, <a href="https://github.com/matrix-org/matrix-doc/pull/2918">MSC2918</a> introduces the concept of refresh tokens to Matrix.</p>
<p>Initial support for refresh tokens in Synapse was introduced in <a href="https://github.com/matrix-org/synapse/releases/tag/v1.38.0">version 1.38.0</a>. Synapse 1.49.0 finalises and stabilises this implementation, allowing any client that supports this feature to use it as it is currently described in the related MSC.</p>
<h2 id="everything-else">Everything else</h2>
<p>This release introduces the last changes needed to Synapse for basic threading support. It also introduces support for <a href="https://github.com/matrix-org/matrix-doc/pull/3030">MSC3030</a>, which allows clients to jump to a specific date in a room's history (expect a sneak peek of this in the next episode of Matrix Live!).</p>
<p>Another interesting point is the addition of a couple of <a href="https://matrix-org.github.io/synapse/v1.49/usage/administration/admin_api/federation.html">admin APIs for federation</a>. More specifically, they allow you to visualise all of the other homeservers your Synapse instance has been interacting with, as well as how successful the last attempts at communicating with them have been.</p>
<p>Please see the Synapse <a href="https://github.com/matrix-org/synapse/blob/v1.49.0/CHANGES.md">release notes</a> for a complete list of changes in this release.</p>
<p>Synapse is a Free and Open Source Software project, and we'd like to extend our thanks to everyone who contributed to this release, including <a href="https://github.com/dklimpel">Dirk Klimpel</a>, <a href="https://github.com/Ma27">Maximilian Bosch</a> and <a href="https://github.com/tulir">Tulir Asokan</a>.</p>
<h2 id="till-next-year">Till next year</h2>
<p>This is the last release of Synapse of 2021! The Synapse team will take a break for the holidays, pushing the next release of Synapse (1.50.0) to January 11, 2022.</p>
<p>We'd like to thank everyone who has been using Synapse, contributing to it, and/or supporting us for the past year, and we hope to see you again in 2022! 🎆</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;13&#x2F;disclosure-buffer-overflow-in-libolm-and-matrix-js-sdk&#x2F;" title="Disclosure: buffer overflow in libolm and matrix-js-sdk">Disclosure: buffer overflow in libolm and matrix-js-sdk</a></h1>
            <span>
                13.12.2021 18:35
                —
                <a href="/category/security">
                    Security
                </a>
                —
                <a href="/author/matrix-security">
                    Matrix Security
                </a>
            </span>
            <br>
            <small>Last update: 13.12.2021 16:11</small>
        </header>
        <div>
            <p>Today we are releasing security updates to libolm, matrix-js-sdk, and several clients including Element Web / Desktop. Users are encouraged to upgrade as soon as possible. This resolves the <a href="https://matrix.org/blog/2021/12/03/pre-disclosure-upcoming-security-release-of-libolm-and-matrix-js-sdk">pre-disclosure</a> issued on December 3rd.</p>
<p>Fixed library versions are:</p>
<ul>
<li>libolm: <a href="https://gitlab.matrix.org/matrix-org/olm/-/tree/3.2.8">3.2.8</a></li>
<li>matrix-js-sdk: <a href="https://github.com/matrix-org/matrix-js-sdk/releases/tag/v15.2.1">15.2.1</a></li>
</ul>
<p>Client versions incorporating the fixes are:</p>
<ul>
<li>Element Web / Desktop: <a href="https://github.com/vector-im/element-web/releases/tag/v1.9.7">1.9.7</a></li>
<li>SchildiChat Web / Desktop: <a href="https://github.com/SchildiChat/schildichat-desktop/releases/tag/v1.9.7-sc.1">1.9.7-sc.1</a></li>
<li>Cinny: <a href="https://github.com/ajbura/cinny/releases/tag/v1.6.0">1.6.0</a></li>
</ul>
<p>These releases mitigate a buffer overflow in <code>olm_session_describe</code>, a libolm debugging function used by matrix-js-sdk in its end-to-end encryption (E2EE) implementation. If you rely on matrix-js-sdk for E2EE, you are affected. This vulnerability has been assigned <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44538">CVE-2021-44538</a>.</p>
<p>Clients which do <em>not</em> use matrix-js-sdk for E2EE, like FluffyChat or Element Android / iOS, are <em>not</em> affected.</p>
<p>This issue has been present since the introduction of the <code>olm_session_describe</code> function in October 2019 (commits: <a href="https://gitlab.matrix.org/matrix-org/olm/-/commit/39a1ee0b18f0fced6d7bc293cc9a46ea70ec9e96">libolm</a>, <a href="https://github.com/matrix-org/matrix-js-sdk/commit/e6699c5424a856a639baa6d6f78d44594baaf404">matrix-js-sdk</a>).</p>
<p>We do not believe it is practical to successfully exploit this issue. However, upgrading remains important as the overflow <em>can</em> be triggered remotely.</p>
<p>Separately from the above vulnerability, we noticed during an internal audit that the libolm bindings in matrix-js-sdk were not zeroing out certain arrays containing entropy for cryptographic operations. This causes the entropy to remain resident in memory longer than necessary. As a defense-in-depth measure, this release of libolm now proactively overwrites those arrays when it is safe to do so.</p>
<p>Lastly, we are also taking this opportunity to update the version of Electron bundled with Element Desktop, pulling in the latest backported security fixes there.</p>
<p>The buffer overflow was found and reported by GitHub user <a href="https://github.com/brevilo">@brevilo</a> in the course of developing <a href="https://github.com/brevilo/jolm/">jOlm</a>, a library of Java bindings to libolm; thank you. If you believe you've discovered a security vulnerability in Matrix or its implementations, please see our <a href="https://matrix.org/security-disclosure-policy/">Security Disclosure Policy</a> for how to get in touch.</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;10&#x2F;this-week-in-matrix-2021-12-10&#x2F;" title="This Week in Matrix 2021-12-10">This Week in Matrix 2021-12-10</a></h1>
            <span>
                10.12.2021 19:24
                —
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                —
                <a href="/author/thib">
                    Thib
                </a>
            </span>
            <br>
            <small>Last update: 10.12.2021 19:09</small>
        </header>
        <div>
            <h2 id="the-adventures-of-twim-bot">The Adventures of TWIM bot</h2>
<p>Last week the Matrix Scientists had turned this room into a portal to TWIM bot's ship tank so we could all fuel it with news about our work. The spec and hookshot news were reported late when the tank was already full, sending TWIM bot's ship into hyperspeed mode 🚀</p>
<p>We lost contact with the bot for a few days but managed to restore a connection with it. It appeared to have crashed on the green planet of Fuj'ehr. Its ship shattered in pieces at impact! 💥</p>
<p>The bot managed to find most of them, but some critical pieces of the engine were missing. We needed to find those pieces quickly before the mushy ground of Fuj'ehr swallows them forever! 😱</p>
<p>The Editor has asked the Matrix Scientists to reconfigure the room and bridge it to TWIM bot's navigation tools. Each news report highlighted the position of a piece of engine on its map. 🗺️</p>
<h2 id="matrix-live">Matrix Live 🎙</h2>
<iframe src="https://www.youtube.com/embed/tLlSGqzgzhg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>This week my guests are the FluffyChat and MinesTRIX maintainers, following the v1 release of the simple and beautiful FluffyChat… and they want to work together!</p>
<h2 id="dept-of-status-of-matrix-face-with-th">Dept of <em>Status of Matrix</em> 🌡️</h2>
<p><a href="https://matrix.to/#/@austin:tchncs.de">Austin Huang</a> reports</p>
<blockquote>
<p>Version numbers of each homeserver, updated daily using a <a href="https://github.com/austinhuang0131/austinhuang0131.github.io/blob/master/.github/workflows/matrix_ver.yml">GitHub Action</a>, are now added onto my <a href="https://austinhuang.me/matrix-homeservers.html">public homeserver list</a>, in hopes that it will further aid those choosing a homeserver to use Matrix on.</p>
</blockquote>
<p>Very handy to quickly know if a server is well maintained or not before making it your new home!</p>
<h2 id="dept-of-spec-scroll">Dept of Spec 📜</h2>
<p><a href="https://matrix.to/#/@andrewm:amorgan.xyz">anoa</a> says</p>
<blockquote>
<p>Here's your weekly spec update! The heart of Matrix is the specification - and this is modified by Matrix Spec Change (MSC) proposals. Learn more about how the process works at https://spec.matrix.org/unstable/proposals.</p>
<h2 id="msc-status">MSC Status</h2>
<p><strong>New MSCs:</strong></p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3554">MSC3554: Extensible Events - Translatable Text</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3553">MSC3553: Extensible Events - Videos</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3552">MSC3552: Extensible Events - Images and Stickers</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3551">MSC3551: Extensible Events - Files</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3550">MSC3550: Allow HTTP 403 as a response to profile lookups</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3548">MSC3547: Allow appservice bot user to read any rooms the appserice is part of</a></li>
</ul>
<p><strong>MSCs with proposed Final Comment Period:</strong></p>
<ul>
<li><em>No MSCs entered proposed FCP state this week.</em></li>
</ul>
<p><strong>MSCs in Final Comment Period:</strong></p>
<ul>
<li><em>No MSCs are in FCP.</em></li>
</ul>
<p><strong>Merged MSCs:</strong></p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/3419">MSC3419: Allow guests to send more event types</a></li>
</ul>
<h2 id="spec-updates">Spec Updates</h2>
<p>Extensible events are coming! With lots of potential usecases to be built on top of the concept (such as threading, polls, and any type of data one would like to through on top of existing room events), extensible events are finally getting some love. New MSCs are available above, which detail some of these usecases. Exciting times!</p>
<p>A small correction from last week's issue: the next aggregations MSC to be focused on (after <a href="https://github.com/matrix-org/matrix-doc/pull/2675">MSC2675</a> (serverside aggregations) is <a href="https://github.com/matrix-org/matrix-doc/pull/2677">MSC2677</a> (annotations and reactions), as it's a more pressing blocker for usecases such as threading and polls.</p>
<p>Otherwise, the Spec Core Team is continuing to wind down in preparation for the holidays ☃️</p>
<h2 id="random-msc-of-the-week">Random MSC of the Week</h2>
<p>The random spec of the week is... <a href="https://github.com/matrix-org/matrix-doc/pull/3015">MSC3015: Room state personal overrides</a>.</p>
<p>Quite a novel concept, and one that would enable many usecases, such as the ones described in the MSC itself.
Check it out if that's something that interests you!
<img src="/blog/img/5c2f21a5f2f17106aad9fd177c973720bb611cd0.png" alt="" /></p>
</blockquote>
<h2 id="dept-of-servers-europea">Dept of Servers 🏢</h2>
<h3 id="synapse">Synapse <a href="https://github.com/matrix-org/synapse/">↗</a></h3>
<p>Synapse is the reference homeserver for Matrix</p>
<p><a href="https://matrix.to/#/@dmrobertson:matrix.org">dmr</a> reports</p>
<blockquote>
<p>This week we cut Synapse release candidate <a href="https://github.com/matrix-org/synapse/releases/tag/v1.49.0rc1">1.49.0rc1</a> It includes a bunch of work to supporta plethora of MSCs (<a href="https://github.com/matrix-org/matrix-doc/pull/2675/">MSC 2675</a>, <a href="https://github.com/matrix-org/matrix-doc/pull/3030">MSC3030</a>, <a href="https://github.com/matrix-org/matrix-doc/blob/main/proposals/2918-refreshtokens.md#msc2918-refresh-tokens">MSC2918</a>, <a href="https://github.com/matrix-org/matrix-doc/pull/2946">MSC2946</a>), a crop of bugfixes and improvements to our documentation which incorporate Synapse's old wiki. And as ever, there's a bunch of internal type hinting to keep the Synapse team's blood pressure at healthy levels.</p>
<p>The formal release of Synapse 1.49.0 is scheduled for the coming Tuesday. This will be the last Synapse release of 2021 as the Synapse team prepare for a break over the Christmas period. Releases will continue at the usual pace in the new year, with 1.50.0rc1 slated for 2022/01/04 and 1.50.0 for 2022/01/11.</p>
<p><strong>Please note:</strong> Synapse 1.49 will be the last version to support Python 3.6, PostrgreSQL 9.6, and Ubuntu 18.04 LTS (Bionic): by our next release, these will have reached their upstream end-of-life. If you're reliant on any of these platforms, please ensure you have plans to upgrade.</p>
<p>In other news, we're <a href="https://github.com/matrix-org/sygnal/blob/main/CHANGELOG.md#sygnal-0110-2021-12-09">preparing</a> to release a new version of <a href="https://github.com/matrix-org/sygnal">Sygnal</a> with a series of fixes for common errors. This should make Sygnal administrators much happier by removing an awful lot of error spam from logs!</p>
</blockquote>
<h3 id="sydent">Sydent <a href="https://github.com/matrix-org/sydent">↗</a></h3>
<p>Sydent is the reference Matrix Identity server. It provides a lookup service, so that you can find a Matrix user via their email address or phone number (if they have chosen to share it).</p>
<p><a href="https://matrix.to/#/@dmrobertson:matrix.org">dmr</a> says</p>
<blockquote>
<p>The second <a href="https://matrix.org/blog/2021/12/10/type-coverage-for-sydent-annotation">blog post</a> on improving Sydent's type coverage should be published now. See the first post <a href="https://matrix.org/blog/2021/12/03/type-coverage-for-sydent-motivation">here</a> from last week.</p>
</blockquote>
<h2 id="homeserver-deployment-inbox-tray">Homeserver Deployment 📥️</h2>
<h3 id="helm-chart">Helm Chart <a href="https://gitlab.com/ananace/charts">↗</a></h3>
<p>Matrix Kubernetes applications packaged into helm charts</p>
<p><a href="https://matrix.to/#/@ace:kittenface.studio">Ananace</a> reports</p>
<blockquote>
<p>This week has seen yet another set of updates to <a href="https://gitlab.com/ananace/charts">my Helm Charts</a>, with element-web being bumped to 1.9.6 and matrix-synapse seeing fixes to non-standard port configurations and better support for modern ingressClass handling.</p>
</blockquote>
<h2 id="dept-of-clients-iphone">Dept of Clients 📱</h2>
<h3 id="nheko">Nheko <a href="https://nheko-reborn.github.io">↗</a></h3>
<p>Desktop client for Matrix using Qt and C++17.</p>
<p><a href="https://matrix.to/#/@deepbluev7:neko.dev">Nico</a> reports</p>
<blockquote>
<p>If you are using Nheko on a mobile device like the PinePhone, you should now be able to swipe between the room list and the spaces list. Since I don't use a PinePhone, feedback will be appreciated!</p>
</blockquote>
<h3 id="neochat">Neochat <a href="https://invent.kde.org/network/neochat">↗</a></h3>
<p>A client for matrix, the decentralized communication protocol</p>
<p><a href="https://matrix.to/#/@tobiasfella:kde.org">Tobias Fella</a> announces</p>
<blockquote>
<p>NeoChat version 21.12 is out! You may have noticed that this version number is roughly twenty times higher than the previous one. This means that NeoChat is now twenty times as good as the last version. Or it means that version numbers are utterly meaningless and we switched to a date-based version number system since NeoChat is now released together with many other plasma-mobile related apps. This also means that new versions will arrive monthly from now on. New features and fixes in this version include - but are not limited to:</p>
<ul>
<li>Spell checking while writing a message</li>
<li>Improved markdown to html conversion when sending a message</li>
<li>Built-in theme switching</li>
<li>Various fixes to login, logout and account switching</li>
<li>Support for custom emojis</li>
<li>Support for Spoilers</li>
<li>Support for Blurhashes</li>
</ul>
<p><img src="/blog/img/6dd2cd893f050b850d598dac0a04eb6cbe655dc3.png" alt="" />
<img src="/blog/img/c740e976129867e670cad45ffffc08beeb802387.png" alt="" /></p>
</blockquote>
<h3 id="element">Element <a href="https://element.io">↗</a></h3>
<p>Everything related to Element but not strictly bound to a client</p>
<p><a href="https://matrix.to/#/@daniellekirkwood:one.ems.host">Danielle Kirkwood</a> announces</p>
<blockquote>
<h2 id="threads">Threads</h2>
<ul>
<li>Threads is making excellent progress; This week we held 2 internal testing sessions, both of which went swimmingly.</li>
<li>We’re continuing our hard-work on Notifications to fix those up as best we can.</li>
<li>Also, we started work on the Threads Filter. The filter will allow you to choose between all the threads in a room and threads you’ve actively participated in.</li>
<li>If you’re using the Labs version of Threads, let us know what you think so far!</li>
</ul>
<h2 id="polls">Polls</h2>
<ul>
<li>Exciting news on Polls; All development on Polls MVP is nearly complete, and will soon be making their way to a production environment near you!</li>
<li>Polls will be available behind Labs flags at first. We're excited to see people using it and we’re looking forward to hearing any feedback/comments.</li>
</ul>
<h2 id="community-testing">Community Testing</h2>
<ul>
<li>Closed 20 out of 36 issues in encryption and verification (E2EE) this week.</li>
<li>We are planning three testing sessions for next week:
<ul>
<li>Tuesday 17:00-18:00 UTC - first time user experience on iOS, Android and Web</li>
<li>Wednesday: 16:00-17:30 UTC - information architecture changes on Web (with Michael and Nique joining us from the Delight team)</li>
<li>Thursday 16:30-18:00 UTC - bug squash edition on encryption, can we get the issue count to an all new low?</li>
</ul>
</li>
<li>Join us! We’re at <a href="https://matrix.to/#/#element-community-testing:matrix.org">#element-community-testing:matrix.org</a></li>
</ul>
</blockquote>
<h3 id="element-web-desktop">Element Web/Desktop <a href="https://github.com/vector-im/element-web">↗</a></h3>
<p>Secure and independent communication, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-web:matrix.org">#element-web:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@daniellekirkwood:one.ems.host">Danielle Kirkwood</a> announces</p>
<blockquote>
<ul>
<li>We are monitoring and triaging feedback, which is submitted through the new feedback interface in the app. </li>
<li>In Labs:
<ul>
<li>Work continues on <a href="https://github.com/vector-im/element-meta/issues/56">Information Architecture</a>: this week we’ve made a spotlight search labs feature that we’ll be testing to replace the current filter.</li>
<li>We’re also starting to test preferences per space, so keep your eyes peeled for those.</li>
</ul>
</li>
</ul>
</blockquote>
<p><a href="https://matrix.to/#/@madlittlemods:matrix.org">madlittlemods (Eric Eastwood)</a> reports:</p>
<blockquote>
<h2 id="jump-to-date-headers-soon-in-element">Jump to date headers soon in Element</h2>
<p>From the <a href="https://matrix.org/blog/2021/12/03/this-week-in-matrix-2021-12-03#gitter">experimental MSC3030 implementation merge to Synapse update</a> in TWIM last week, we now also have the start of some <a href="https://github.com/matrix-org/matrix-react-sdk/pull/7317">client usage in Element</a> to make featureful jump to date headers!</p>
<p>If you've ever tried to find a message back in the past, you've experienced the burdensome task of having to scroll back manually for days, even months! With the jump to date headers, that will be a thing of the past 😌. Clicking any date separator in the room timeline, will give shortcuts to jump to last week, last month, jump to any date using the date picker, or even the beginning of the room to follow a room upgrade chain.</p>
<p><img src="/blog/img/2021-12-10-jumptodate.png" alt="" /></p>
<p>This is currently still in a <a href="https://github.com/matrix-org/matrix-react-sdk/pull/7317">draft pull request state</a> but will give another update when it lands in Element Labs for everyone to use.</p>
</blockquote>
<h3 id="element-ios">Element iOS <a href="https://github.com/vector-im/element-ios">↗</a></h3>
<p>Secure and independent communication for iOS, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-ios:matrix.org">#element-ios:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@daniellekirkwood:one.ems.host">Danielle Kirkwood</a> reports</p>
<blockquote>
<ul>
<li>On iOS it’s been a week of completing things!</li>
<li>We’ve made some final changes to PostHog analytics and MatrixKit has been integrated in element-ios.</li>
<li>There have also been lots of bug fixes - especially around an app crash.</li>
<li>Don’t forget! As per our update from last week, our release candidates are now prepared on Tuesdays (not Wednesdays).</li>
</ul>
</blockquote>
<h3 id="element-android">Element Android <a href="https://github.com/vector-im/element-android">↗</a></h3>
<p>Secure and independent communication for Android, connected via Matrix. Come talk with us in <a href="https://matrix.to/#/#element-android:matrix.org">#element-android:matrix.org</a>!</p>
<p><a href="https://matrix.to/#/@daniellekirkwood:one.ems.host">Danielle Kirkwood</a> reports</p>
<blockquote>
<ul>
<li>Element Android 1.3.9 has been released on the PlayStore and is available for the beta testers:
<ul>
<li>This version adds support for draft voice messages and a new design for URL previews.</li>
</ul>
</li>
<li>Opt-in PostHog analytics will land soon, and will be included in the next release. </li>
<li>A new &quot;Legals” screen has been added to Settings in order for users to see all legal info pages for Element, the user's homeserver and the user's identity server (if any).</li>
<li>The next release candidate will be prepared next Tuesday.</li>
</ul>
</blockquote>
<h3 id="commune">Commune <a href="https://github.com/commune-org/commune">↗</a></h3>
<p>Commune is a communications suite built on top of matrix. Commune aims to bring together chat, discussions, email and other interactive apps into a single matrix client.</p>
<p><a href="https://matrix.to/#/@erlend_sh:matrix.org">erlend_sh</a> says</p>
<blockquote>
<p>So here’s the thing ahq (dev) and I (product) have been working on: https://github.com/commune-org/commune
It’s a chat/forum hybrid. Still in pre-alpha, proof-of-concept stage.</p>
<p><img src="/blog/img/2021-12-10-commune-1.png" alt="" /></p>
<p><img src="/blog/img/2021-12-10-commune-2.png" alt="" /></p>
<p><img src="/blog/img/2021-12-10-commune-3.png" alt="" /></p>
</blockquote>
<h2 id="dept-of-non-clients-control-knobs">Dept of Non Clients 🎛️</h2>
<h3 id="matrix-streamchat">matrix-streamchat <a href="https://git.pixie.town/f0x/matrix-streamchat">↗</a></h3>
<p>Matrix powered stream overlay for OBS, to integrate live chat in your favorite (selfhosted) streaming setups.</p>
<p><a href="https://matrix.to/#/@f0x:pixie.town">f0x</a> announces</p>
<blockquote>
<p>TWIM I wrote a Matrix powered stream overlay for OBS, to integrate live chat in your favorite (selfhosted) streaming setups. Was a great little 2 evening project to develop while livestreaming it's development :)</p>
<p>You can find the code and instructions at https://git.pixie.town/f0x/matrix-streamchat
and a hosted instance at https://streamchat.pixie.town</p>
</blockquote>
<iframe src="https://www.youtube.com/embed/03F8Bv2_leM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks 🧰</h2>
<h3 id="jolm">jOlm <a href="https://github.com/brevilo/jolm">↗</a></h3>
<p>Olm bindings for Java</p>
<p><a href="https://matrix.to/#/@brevilo:matrix.org">brevilo</a> announces</p>
<blockquote>
<p><a href="https://github.com/brevilo/jolm">jOlm</a> has seen two releases since the previous update, <a href="https://github.com/brevilo/jolm/releases/tag/1.0.7">v1.0.7</a> and <a href="https://github.com/brevilo/jolm/releases/tag/1.0.8">v1.0.8</a>. jOlm now supports (and requires at least) the latest <code>libolm</code> version 3.2.7. Please note that we deprecated a number of methods in favor of renamed siblings. The majority of the old ones will be removed in the upcoming jOlm 1.1 release, likely published soon after <code>libolm</code>'s <a href="https://matrix.org/blog/2021/12/03/pre-disclosure-upcoming-security-release-of-libolm-and-matrix-js-sdk">announced</a> security release on Dec. 13th. Please follow suit and update your implementations accordingly.</p>
<h2 id="summary">Summary:</h2>
<ul>
<li>🧰 Maintenance and upstream update releases</li>
<li>⚠️ Renamed methods for improved coherence and due to upstream changes (old ones deprecated)</li>
<li>✅ Up to date with Olm 3.2.7 (new minimum requirement)</li>
</ul>
<h2 id="changelog"><a href="https://github.com/brevilo/jolm/compare/1.0.4...1.0.8">Changelog</a>:</h2>
<ul>
<li>Deprecated methods (see the individual <a href="https://github.com/brevilo/jolm/releases">release notes</a> for full details):
<ul>
<li><code>Account.markOneTimeKeysAsPublished()</code></li>
<li><code>Account.fallbackKey()</code></li>
<li><code>InboundGroupSession.export()</code></li>
<li><code>InboundGroupSession.importer()</code></li>
<li><code>Utility.ed25519_verify()</code></li>
</ul>
</li>
<li>Refined unit tests</li>
<li>Updated dependencies</li>
</ul>
<p>Cheers!</p>
</blockquote>
<h2 id="dept-of-videos-video-camera">Dept of Videos 📹</h2>
<p><a href="https://matrix.to/#/@matthew:matrix.org">Matthew</a> reports</p>
<blockquote>
<p>We previewed yet more native Matrix VoIP conferencing at CommCon: https://www.youtube.com/watch?v=A4k7DVIK5TE&amp;list=PLvNS4EBAxmJJbvGW-PfXdXOSy9AjHjCLV</p>
</blockquote>
<iframe src="https://www.youtube.com/embed/A4k7DVIK5TE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> says</p>
<blockquote>
<p>If you've got room for more video content, I also said more things about bridges. In this one, we do a live code session for a twilio bridge and watch it fly! https://www.youtube.com/watch?v=S5q3FLLvRn4</p>
</blockquote>
<iframe src="https://www.youtube.com/embed/S5q3FLLvRn4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="dept-of-interesting-projects">Dept of Interesting Projects 🛰️</h2>
<p><a href="https://matrix.to/#/@hp:hq.wily.im">Henri</a> says</p>
<blockquote>
<p>Wily Messenger Matrix client</p>
<p>Wily has launched an iOS Matrix client to enable messaging in restricted- or poor networks. mText and Room events are transferred as DNS payload, thus bypassing most captive portals, while message headers are minimized to enable messaging in very low bandwidth/high latency networks.</p>
<p>Wily Messenger is in POC stage, missing i.e. encryption at the moment, among others. We are committed to develop it further and invite a Kotlin developer to join our journey. DM @hp:hq.wily.im</p>
<p>Download: https://apps.apple.com/lv/app/id1576476396</p>
</blockquote>
<h2 id="room-of-the-week-calendar">Room of the Week 📆</h2>
<p><a href="https://matrix.to/#/@travis:t2l.io">TravisR</a> says</p>
<blockquote>
<p>We've set up a new Element Space for the Element family of clients and projects, finally. Feel free to join it at <a href="https://matrix.to/#/#community:element.io">#community:element.io</a> and be sure to check out  <a href="https://matrix.to/#/#community:matrix.org">#community:matrix.org</a> while you're there for everything Matrix related. </p>
<p>There's also <a href="https://matrix.to/#/#element-translators:matrix.org">#element-translators:matrix.org</a> for the Element Translators community out there.</p>
</blockquote>
<h2 id="dept-of-ping-table-tennis-paddle-and-ball">Dept of Ping 🏓</h2>
<p>Here we reveal, rank, and applaud the homeservers with the lowest ping, as measured by <a href="https://github.com/maubot/echo">pingbot</a>, a <a href="https://github.com/maubot/maubot">maubot</a> that you can host on your own server.</p>
<h3 id="ping-maunium-net"><a href="https://matrix.to/#/#ping:maunium.net">#ping:maunium.net</a></h3>
<p>Join <a href="https://matrix.to/#/#ping:maunium.net">#ping:maunium.net</a> to experience the fun live, and to find out how to add YOUR server to the game.</p>
<table><thead><tr><th style="text-align: center">Rank</th><th style="text-align: center">Hostname</th><th style="text-align: center">Median MS</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center">envs.net</td><td style="text-align: center">494.5</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">nicoll.xyz</td><td style="text-align: center">548</td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">matrix.markshorten.co.uk</td><td style="text-align: center">857.5</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">helderferreira.io</td><td style="text-align: center">1373</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center">almum.de</td><td style="text-align: center">1886.5</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">diasp.in</td><td style="text-align: center">2958.5</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center">matrix.liamgooch.com</td><td style="text-align: center">2982</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">mailstation.de</td><td style="text-align: center">3030.5</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center">kde.org</td><td style="text-align: center">3234</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">matrix.org</td><td style="text-align: center">3415</td></tr>
</tbody></table>
<h3 id="ping-no-synapse-maunium-net"><a href="https://matrix.to/#/#ping-no-synapse:maunium.net">#ping-no-synapse:maunium.net</a></h3>
<p>Join <a href="https://matrix.to/#/#ping-no-synapse:maunium.net">#ping-no-synapse:maunium.net</a> to experience the fun live, and to find out how to add YOUR server to the game.</p>
<table><thead><tr><th style="text-align: center">Rank</th><th style="text-align: center">Hostname</th><th style="text-align: center">Median MS</th></tr></thead><tbody>
<tr><td style="text-align: center">1</td><td style="text-align: center">envs.net</td><td style="text-align: center">138.5</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">construct.supercable.onl</td><td style="text-align: center">165</td></tr>
<tr><td style="text-align: center">3</td><td style="text-align: center">weasy-is-my.name</td><td style="text-align: center">317</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">grin.hu</td><td style="text-align: center">403</td></tr>
<tr><td style="text-align: center">5</td><td style="text-align: center">dendrite.supercable.onl</td><td style="text-align: center">531</td></tr>
<tr><td style="text-align: center">6</td><td style="text-align: center">spacedn.com</td><td style="text-align: center">534.5</td></tr>
<tr><td style="text-align: center">7</td><td style="text-align: center">matrix.org</td><td style="text-align: center">828</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">matrix.awesomesheep48.me</td><td style="text-align: center">1084</td></tr>
<tr><td style="text-align: center">9</td><td style="text-align: center">dendrite.s3cr3t.me</td><td style="text-align: center">1103.5</td></tr>
<tr><td style="text-align: center">10</td><td style="text-align: center">0x1a8510f2.space</td><td style="text-align: center">1332</td></tr>
</tbody></table>
<h2 id="the-adventures-of-twim-bot-continued">The Adventures of TWIM bot continued</h2>
<p>The members of the Federation have been very active and helped TWIM bot to find all the pieces of its ship! TWIM bot assembled everything together and put the engine back in its place... but at the last moment, as it was ready to take off, another bright spot appeared on the map following madlittlemods late report!</p>
<p>How could this happen? All the pieces of the engine were already there! Unsure of what to do, the bot asked Earth for directions. Earth confirmed: it was worth going to that new bright spot on the map.</p>
<p>The bot welded back the plate of the engine casing, made sure nothing could get into the ship in its absence, and started heading to the mysterious spot. The signal of our communication tools with TWIM bot weakens as it enters in the thick forest of Fuj'ehr…</p>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know 🏁</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#twim:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;10&#x2F;type-coverage-for-sydent-annotation&#x2F;" title="Type coverage for Sydent: annotation">Type coverage for Sydent: annotation</a></h1>
            <span>
                10.12.2021 00:00
                —
                <a href="/category/tech">
                    Tech
                </a>
                —
                <a href="/author/david-robertson">
                    David Robertson
                </a>
            </span>
            
        </header>
        <div>
            <p>This is the second in a series of three posts which discuss recent work to improve type annotations in <a href="https://github.com/matrix-org/sydent">Sydent</a>, the reference Matrix Identity server. <a href="https://matrix.org/blog/2021/12/03/type-coverage-for-sydent-motivation">Last time</a> we discussed the motivation for doing this work in the first place: the <em>why</em>. Now I want to talk about the <em>how</em>. How did we add annotations to individual files, and across the project as whole? What common idioms did we learn on the way?</p>
<h2 id="the-process-of-improving-coverage">The process of improving coverage</h2>
<p>From experience adding typing to Synapse, we decided to annotate one module at a time. We configured a list of files in <code>pyproject.toml</code> which we knew passed mypy's checks. We could run <code>mypy</code> in CI to check that new PRs didn't introduce type problems in modules already covered.</p>
<p>From there, the workflow was</p>
<ol>
<li>Choose a new module to annotate. Add it to the list of <code>files</code> in mypy's configuration.</li>
<li>Run <code>mypy</code>. See how many errors you get.</li>
<li>Choose an error. Fix it. Re-run <code>mypy</code>.</li>
<li>Repeat until no errors remaining.</li>
<li>Submit for review.</li>
</ol>
<p>There are two parts in there which involve a choice. Being honest, I made those choices unscientifically: I tried to choose the easy tasks to do first. My first target was actually the entire <a href="https://github.com/matrix-org/sydent/pull/418">sydent.util</a> subpackage. Probably a bit too large for a first bite! My thinking was that <code>util</code> sounded like something with few dependencies that would have impact across the whole source tree.</p>
<p>Within a given module, I'd try to fix easier errors first: partly for confidence, partly to build up momentum, and partly to get myself familiar with that piece of source code. For example, I'd often start by telling mypy that <code>mylist = []</code> was actually was a <code>List[str]</code> (rather than the generic <code>List[Any]</code> which it would use otherwise).</p>
<p>Picking and choosing easy targets works fairly well, but sometimes that means you end up fixing an error that's really a symptom of an earlier one. Other times fixing one error, e.g. by giving a return type annotation to a function—would solve a series of other errors throughout the file. Watching the total number of errors mypy reports bob up and down was intriguing!</p>
<p>In retrospect, I think it would be smoother to generate some kind of dependency graph for the package. I'm imagining a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">DAG</a> where whose vertices are modules, and there's an edge <code>A -&gt; B</code> if <code>A</code> imports from <code>B</code>. The sinks of this DAG (i.e. modules which don't depend on any others in the package) are the ideal place to start: you can get something strictly typechecked there without having to annotate a long chain of dependencies across other files. Another strategy would be to see which modules were the least precise according to mypy's reports—but more on those <a href="https://matrix.org/blog/2021/12/17/type-coverage-for-sydent-evaluation">next time</a>.</p>
<h3 id="you-re-at-the-mercy-of-your-dependencies">You're at the mercy of your dependencies</h3>
<p>I think this is my single biggest takeaway from the process of adding annotations to Sydent.
I'll admit the phrasing is melodramatic, but I think it rings true. </p>
<p>Improving coverage boils down to giving the typechecker more information about your program. The more information it has, the more it can check—and the more errors it can spot. (Hopefully this doesn't make typing come across like a pyramid scheme.) If your dependencies aren't typed, mypy can't validate you're correctly providing inputs and correctly consuming outputs. You might have a bigger impact on overall typing coverage by annotating a dependency (directly or via stubs). I have a hunch that bugs are more likely in code that uses an external dependency: we're much more familiar with the details of our own source code compared to that of a third party we trust.</p>
<p>It's worth looking to see if your dependencies have a newer version including type annotations. Failing that, they may have a stub package added to <a href="https://github.com/python/typeshed/tree/master/stubs">typeshed</a> and published on PyPI. I saw example of both cases when choosing how to configure mypy for Sydent. If some of your dependencies are under your control, consider annotating them—you'll feel the benefits across multiple projects pretty quickly.</p>
<h3 id="annotations-when-working-with-twisted">Annotations when working with twisted</h3>
<p>Twisted is Sydent's biggest dependency, and I certainly felt at its mercy! In particular, it has a few quirks which make it trickier to annotate applications using it. Here's a summary of the work we had to do to get those annotations working.</p>
<h4 id="partially-typed-modules-and-stubs">Partially typed modules and stubs</h4>
<p>Early into the process, mypy reported that calling the function <a href="https://twistedmatrix.com/documents/current/api/twisted.python.log.html#err">twisted.python.log.err</a> was an error. It did so because I was running mypy in <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-strict">--strict mode</a>. We'll talk more about why I did so and what this means <a href="https://matrix.org/blog/2021/12/17/type-coverage-for-sydent-evaluation">next time</a>; for now, it's enough to know that calling a function that isn't fully annotated from within a function that is constitutes an error under strict mode. <code>twisted</code> is partially annotated: many key modules and functions have type annotations, but others don't. I was reluctant to give up on <code>--strict</code>. Instead, I decided to stub the <code>err</code> function myself.</p>
<p>A stub is a cut-down version of a python function, class or module which lives in a <code>.pyi</code> file. All implementation details are removed; only type annotations remain. Stubs are useful when you want to write annotations for code you don't control. The <a href="https://github.com/python/typeshed">typeshed</a> library is probably the best example: a collection of third party stubs for the standard library, plus some popular third party packages. Microsoft's <a href="https://github.com/microsoft/python-type-stubs">python-type-stubs</a> is another example. They'd also solve the problem I mentioned at the end of the <a href="https://matrix.org/blog/2021/12/03/type-coverage-for-sydent-motivation">first part</a>: I could use a stub to <em>teach</em> mypy that <code>IResponse.headers</code> was a <code>Headers</code> object. </p>
<p>Writing a stub for <code>log.err</code> was straightforward, thanks mainly to Twisted's thorough documentation. I chose to write it by hand, rather than use <a href="https://mypy.readthedocs.io/en/stable/stubgen.html">stubgen</a>. I'd heard of the latter, but was reluctant to use it for a few reasons.</p>
<ul>
<li>Twisted is a big project with many big files. I didn't want to commit huge stub files for me and my colleagues to maintain.</li>
<li>The more our stubs cover, the larger the risk of a stub becoming out-of-date with twisted itself. Upstream twisted is the best place for these annotations.</li>
<li>We only need annotations for the bits of twisted that we're using.</li>
<li>And, being honest: I wanted the low-level experience of writing stubs, cross-referencing between the source and working how to best capture its type semantics.</li>
</ul>
<p>I think this decision to write a targeted stub made sense at the time. After all, <code>twisted.python.logging.err</code> is just one simple function! But for the project as a whole, I regret not using <code>stubgen</code> to generate module-level stubs. The reason for this is that a <code>.pyi</code> stub file accounts for an entire module: <a href="https://github.com/python/mypy/issues/5880#issuecomment-439237176">no more and no less</a>. This means that the stubs I was writing for parts of twisted only covered the functions and classes I'd stubbed. Any existing annotations in the twisted source code would be ignored, along with any types that mypy was able to infer for itself.</p>
<p>I think it would have been more efficient to use <code>stubgen</code> to generate stubs and patch them up, rather than writing them. That would have helped avoid a few cases I encountered where stubbing one function would cause additional typechecking failures (because mypy was no longer examining the twisted source for that file). It would also have meant that I could just faithfully stub Twisted as it is; in practice, I would sometimes hesitate to stub to avoid having to cover another module. <code>sydent.http</code> was the most painful part of the source tree for this: that's where we make the most use of Twisted.</p>
<h4 id="defer-inlinecallbacks"><a href="https://twistedmatrix.com/documents/current/api/twisted.internet.defer.html#inlineCallbacks">defer.inlineCallbacks</a></h4>
<p>This is a decorator which allows us to write code in the style of <code>async</code>/<code>await</code> without actually using that syntax. (Twisted predates <code>asyncio</code> and the <code>async</code>/<code>await</code> syntax, introduced in Python 3.4 and 3.5 respectively. It was originally released in 2002, back when Python had released version 2.2.) We only use it in <a href="https://github.com/matrix-org/sydent/blob/e4b4dbbdf25255d19effceae7061ad9b3eefc374/sydent/http/matrixfederationagent.py#L125-L132">one place in Sydent</a> nowadays, but I've seen used across Synapse too. I mention it here because it was a bit fiddly to annotate. Here's its use in Sydent:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>    @defer.inlineCallbacks
</span><span>    </span><span style="color:#569cd6;">def </span><span>request(
</span><span>        self,
</span><span>        method: bytes,
</span><span>        uri: bytes,
</span><span>        headers: Optional[</span><span style="color:#d69d85;">&quot;Headers&quot;</span><span>] = </span><span style="color:#569cd6;">None</span><span>,
</span><span>        bodyProducer: Optional[</span><span style="color:#d69d85;">&quot;IBodyProducer&quot;</span><span>] = </span><span style="color:#569cd6;">None</span><span>,
</span><span>    ) -&gt; Generator[</span><span style="color:#d69d85;">&quot;defer.Deferred[Any]&quot;</span><span>, Any, IResponse]:
</span></code></pre>
<p>Here, <code>request</code> is a <a href="https://docs.python.org/3/glossary.html#term-generator">generator function</a> because its body uses the <code>yield</code> keyword. Yielding allows the function to relinquish control back to twisted's reactor, only for its execution to be resumed asynchronously in the future. The <a href="https://docs.python.org/3/library/typing.html?highlight=typing%20generator#typing.Generator">Generator</a> type takes three parameters:</p>
<ul>
<li>a <code>YieldType</code>, <code>Deferred[Any]</code>;</li>
<li>a <code>SendType</code>, <code>Any</code>; and</li>
<li>a <code>ReturnType</code>, <code>IResponse</code>.</li>
</ul>
<p>Why have I opted to use <code>Any</code> here, when we've seen (and will see) that this limits mypy's ability to run checks? The answer is that we yield two different types within the function. Firstly a <a href="https://github.com/matrix-org/sydent/blob/e4b4dbbdf25255d19effceae7061ad9b3eefc374/sydent/http/matrixfederationagent.py#L152-L153">routing result</a>:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>        routing: _RoutingResult
</span><span>        routing = </span><span style="color:#569cd6;">yield </span><span>defer.ensureDeferred(self._route_matrix_uri(parsed_uri))
</span></code></pre>
<p>and later, <a href="https://github.com/matrix-org/sydent/blob/e4b4dbbdf25255d19effceae7061ad9b3eefc374/sydent/http/matrixfederationagent.py#L194-L195">the IResponse</a> we go on to return:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>        res: IResponse
</span><span>        res = </span><span style="color:#569cd6;">yield </span><span>agent.request(method, uri, headers, bodyProducer)
</span></code></pre>
<ul>
<li>
<p>In this example:</p>
</li>
<li>
<p>We yield a value <code>y: Deferred[Any]</code>.</p>
</li>
<li>
<p>That will later be resolved by twisted to an <code>x: Any</code> value. Twisted will send that value to <code>request</code>, and the execution continues.</p>
</li>
<li>
<p>This repeats, until we eventually return an <code>IResponse</code>.</p>
</li>
</ul>
<p>I could more correctly annotate the <code>YieldType</code> as <code>Deferred[Union[_RoutingResult, IResponse]]</code> so that the <code>SendType</code> was <code>Union[_RoutingResult, IResponse]</code>. But this would mean we end up having some kind of type check at each yield point: a <code>cast</code>, or a <code>type: ignore</code>, or a runtime <code>isinstance</code> check. It didn't feel like it was worth the boilerplate, especially since I could narrow e.g. <code>res: Any</code> to <code>res: IResponse</code> with minimal effort.</p>
<p>This problem doesn't arise with using the <code>async/await</code> syntax:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">async def </span><span>foo() -&gt; int:
</span><span>    </span><span style="color:#569cd6;">return </span><span style="color:#b5cea8;">1
</span><span>
</span><span style="color:#569cd6;">async def </span><span>bar() -&gt; </span><span style="color:#569cd6;">None</span><span>:
</span><span>    x = </span><span style="color:#569cd6;">await </span><span>foo()
</span><span>    reveal_type(foo())
</span><span>    reveal_type(x)
</span></code></pre>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>$ mypy example.py
</span><span>example.py:6: note: Revealed type is &quot;typing.Coroutine[Any, Any, builtins.int]&quot;
</span><span>example.py:7: note: Revealed type is &quot;builtins.int*&quot;
</span></code></pre>
<p>Behind the scenes, I <em>think</em> that <code>x = await foo()</code> is really using the same mechanism as the <code>inlineCallbacks</code> approach.</p>
<ul>
<li>An <code>async def</code> function is really a generator function behind the scenes.</li>
<li>When we <code>await foo()</code>, we yield the expression <code>foo()</code></li>
<li>Then the machinery running our coroutine <code>c</code> will call <code>c.send(x)</code> to resume execution, where <code>x</code> is the value produced by waiting for <code>foo()</code>.</li>
</ul>
<p>With the <code>await</code> form, mypy knows two things:</p>
<ul>
<li>the value <code>foo()</code> which was yielded should be <code>Awaitable[T]</code>, and</li>
<li>the value <code>x</code> send to the coroutine should come from awaiting <code>foo()</code>, and therefore be of type <code>T</code>.</li>
</ul>
<p>Mypy can't assume or enforce these rules for the yield form, which can yield and send whatever it likes. There's no reason why the send type should be related to the yield type. Here's a toy example:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>Any, Dict, Generator
</span><span>
</span><span>
</span><span style="color:#569cd6;">def </span><span>generator_function() -&gt; Generator[int, str, Dict[str, Any]]:
</span><span>  y: int = </span><span style="color:#b5cea8;">10
</span><span>  x: str = </span><span style="color:#569cd6;">yield </span><span>y
</span><span>  print(</span><span style="color:#d69d85;">&quot;Coroutine was sent&quot;</span><span>, x)  </span><span style="color:#608b4e;"># -&gt; Coroutine was sent hello
</span><span>  </span><span style="color:#569cd6;">return </span><span>{</span><span style="color:#d69d85;">&quot;got&quot;</span><span>: x, </span><span style="color:#d69d85;">&quot;done&quot;</span><span>: </span><span style="color:#569cd6;">True</span><span>}
</span><span>
</span><span>coroutine = generator_function()
</span><span>y = next(coroutine)
</span><span>
</span><span style="color:#569cd6;">try</span><span>:
</span><span>  coroutine.send(</span><span style="color:#d69d85;">&quot;hello&quot;</span><span>)
</span><span style="color:#569cd6;">except </span><span>StopIteration </span><span style="color:#569cd6;">as </span><span>e:
</span><span>  return_value = e.value
</span><span>  print(return_value)  </span><span style="color:#608b4e;"># -&gt; {&#39;got&#39;: &#39;hello&#39;, &#39;done&#39;: True}
</span></code></pre>
<p>All in all, the handling of <code>inlineCallbacks</code> is a situation specific to working with (older?) twisted code. It's still nice to understand what's going on behind the scenes though!</p>
<h4 id="zope-interface-interface"><code>zope.interface.Interface</code></h4>
<p>Twisted makes use of <code>zope</code>'s <code>Interface</code> to define a number of abstract interface classes. Speaking personally, I've not seen it used outside twisted, and I think that means it's not supported by much of the typechecking tooling. For example, I've definitely seen PyCharm struggle to realise that it's okay to pass a <code>Response</code> to a function which expects an <code>IResponse</code>! Here's a more complicated example where <code>PyCharm</code> isn't happy with me widening the type <code>LoggingHostnameEndpoint</code> to <code>IStreamClientEndpoint</code>, even though <a href="https://github.com/matrix-org/sydent/blob/92ff7a878a25696365b10cc49e32f5cba32c5960/sydent/http/matrixfederationagent.py#L379-L380">the latter implements the former</a>.</p>
<p><img src="/blog/img/2021-12-10-pycharm-false-positive.png" alt="Screenshot from pycharm showing a false positive warning" /></p>
<p>Mypy out of the box doesn't play well with a zope <code>Interface</code> (nor does any other typechecker I tried). Fortunately, the excellent <a href="https://github.com/Shoobx/mypy-zope">mypy-zope</a> plugin helps here: it teaches mypy that any class like <code>Response</code> which <code>@implements(IResponse)</code>  can be passed in place of an <code>IResponse</code>.</p>
<h3 id="tricks-of-the-trade">Tricks of the trade</h3>
<p>At this point I'd like to share a few generic lessons about typing I'd picked up. Nothing ground-breaking here: I think these are all fairly well-known. Hopefully they're the start of a good cheat sheet for annotating—though it pales in comparison to the <a href="https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html">Mypy cheat sheet</a>.</p>
<h4 id="annotating-decorators">Annotating decorators</h4>
<p>Annotating decorators is fiddly, but it's also vitally important. An unannotated decorator will mask or throw away your decoratee's annotations! The way to write the annotation is best explained by the <a href="https://mypy.readthedocs.io/en/stable/generics.html#declaring-decorators">mypy docs</a>, but briefly: it involves a <code>TypeVar</code> and sometimes a <code>cast</code> too. Here's an example.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>TypeVar, Callable, Any, cast
</span><span>
</span><span>F = TypeVar(</span><span style="color:#d69d85;">&quot;F&quot;</span><span>, bound=Callable[</span><span style="color:#569cd6;">...</span><span>, Any])
</span><span>
</span><span style="color:#569cd6;">def </span><span>decorator(input: F) -&gt; F:
</span><span>    </span><span style="color:#569cd6;">def </span><span>wrapped(</span><span style="color:#569cd6;">*</span><span>args: Any, </span><span style="color:#569cd6;">**</span><span>kwargs: Any) -&gt; Any:
</span><span>        print(</span><span style="color:#569cd6;">f</span><span style="color:#d69d85;">&quot;Calling </span><span>{f.__name__}</span><span style="color:#d69d85;">&quot;</span><span>)
</span><span>        </span><span style="color:#569cd6;">return </span><span>input_func(*args, </span><span style="color:#569cd6;">**</span><span>kwargs)
</span><span>    </span><span style="color:#569cd6;">return </span><span>cast(F, wrapped)
</span></code></pre>
<p>The idea here is</p>
<ol>
<li>Use <code>Callable[..., Any]</code> to describe a generic function with no particular signature.</li>
<li>Use that as a bound on a type variable <code>F</code>. At each usage of <code>@decorator</code>, mypy will deduce a more specific version of <code>F</code>, e.g. <code>Callable[[int], str]</code>.</li>
<li>Within that usage of <code>@decorator</code>, <code>F</code> is fixed to that specific type. We use <code>-&gt; F</code> to express that &quot;we return a function with the same signature as the decoratee&quot;.</li>
<li>Unfortunately, we don't have a good way to tell <code>mypy</code> that <code>wrapped</code> also has that signature <code>F</code>. We resort to a <code>cast</code> to force mypy to accept this without proof.</li>
</ol>
<p>This might change in the future, e.g. when <a href="https://docs.python.org/3/library/typing.html?highlight=paramspec#typing.ParamSpec">ParamSpec</a> is <a href="https://github.com/python/mypy/issues/8645">fully understood</a> by mypy.</p>
<h4 id="prefer-object-over-any">Prefer <code>object</code> over <code>Any</code></h4>
<p>Both of these are general types for expressing &quot;I don't know anything about this expression&quot;. But only the former will undergo static type checks. We want those type checks to guard against bugs accidentally introduced in the future. For instance, imagine a class with an <code>Any</code> attribute.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>Any
</span><span style="color:#9b9b9b;">import </span><span>dataclasses
</span><span>
</span><span>@dataclasses.dataclass
</span><span style="color:#569cd6;">class </span><span>C:
</span><span>    label: Any
</span></code></pre>
<p>Imagine in the future we add a new method which assumes that <code>label</code> is a string:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>    </span><span style="color:#569cd6;">def </span><span>greeting(self) -&gt; str:
</span><span>        </span><span style="color:#569cd6;">return </span><span style="color:#d69d85;">&quot;My name is &quot; </span><span>+ self.label
</span></code></pre>
<p>Mypy will consider this valid, because no type-checking is done on an <code>Any</code> value. It will complain that it can't prove that <code>greeting</code> returns a <code>str</code>, if <code>--warn-return-any</code> is enabled; but putting that aside, it can't identify the call site as a bug. The bug slips through to runtime.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>C(</span><span style="color:#b5cea8;">123</span><span>).greeting()  </span><span style="color:#608b4e;"># TypeError: can only concatenate str (not &quot;int&quot;) to str
</span></code></pre>
<p>Replacing the <code>Any</code> with <code>object</code> does allow mypy to spot the problem.</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>error: Unsupported operand types for + (&quot;str&quot; and &quot;object&quot;)  [operator]
</span></code></pre>
<h4 id="type-ignore-and-cast-sparingly"><code># type: ignore</code> and <code>cast</code> sparingly</h4>
<p>There's a good chance that mypy knows better than we do, so we should only overrule it if there's no better option. There are two techniques for this. One option is to tell mypy to just silence the error, by appending a <code># type: ignore</code> comment to the erroneous line. The other is to force it to accept that a certain expression has a given type: that's what <a href="https://docs.python.org/3/library/typing.html?highlight=paramspec#typing.cast">cast</a> is for.</p>
<p>I never like using either of these, but sometimes they're the most practical choice. I'd recommend two best practices for their use, however:</p>
<ol>
<li>Only ignore a specific error code, e.g. <code># type: ignore[assignment]</code>.  Those codes can be displayed by passing <code>--show-error-codes</code> to mypy.</li>
<li>Leave a comment before every <code>#type: ignore[...]</code> and every <code>cast</code> to justify their correctness. I don't think this is a widely-held practice. I picked it up from the Rust world, where it's <a href="https://rust-lang.github.io/api-guidelines/documentation.html#function-docs-include-error-panic-and-safety-considerations-c-failure">encouraged</a> as a way to justify <code>unsafe</code> source code.</li>
</ol>
<h4 id="there-s-good-stuff-in-typing">There's good stuff in <code>typing</code></h4>
<p>It's worth a read through the <a href="https://docs.python.org/3/library/typing.html">module documentation</a>—plenty of things in there I wish I'd known about sooner. There's lots in the toolkit to chose from. Some bits I use fairly often include:</p>
<ul>
<li><a href="https://docs.python.org/3/library/typing.html?highlight=typing%20protocol#typing.Protocol">Protocol</a>: lets you formalise duck typing. To use it, define a class that inherits from <code>Protocol</code>. Its methods and attributes are all stubs which describe what you require of objects belonging to this type. It's like an <a href="https://docs.python.org/3/library/abc.html?highlight=abc#module-abc">abstract base class</a> or interface, but purely at typecheck time.</li>
<li><a href="https://docs.python.org/3/library/typing.html?highlight=typing%20generic#typing.Generic">Generic</a>: define your own generic types. A bit of a slippery slope to type mania!</li>
<li>[Optional<code>](https://docs.python.org/3/library/typing.html?highlight=typing%20generic#typing.Optional): I use this all the time. It's always good to make your </code>None`s explicit!</li>
<li><a href="https://docs.python.org/3/library/typing.html?highlight=typing%20generic#typing.NewType">NewType</a>: I haven't had a chance to use it much. As I understand it, it's a way to define a &quot;strong typedef&quot;. For example, we can use it to distinguish lengths from durations, even if they're both represented by a <code>float</code> at runtime.</li>
</ul>
<p>I want to call out two parts of <code>typing</code> in particular:</p>
<h4 id="overload"><a href="https://docs.python.org/3/library/typing.html?highlight=typing%20generic#typing.overload">overload</a></h4>
<p><code>overload</code> is a way to provide extra information about a function depending on how it's called. For instance, consider this function which takes a <code>str</code> or <code>bytes</code> as input and returns its uppercase version.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">def </span><span>upper(x: Union[bytes, str]) -&gt; Union[bytes, str]:
</span><span>    </span><span style="color:#569cd6;">return </span><span>x.upper()
</span></code></pre>
<p>The problem with this annotation is that we'll have to check at every call site to see if the return value was a <code>bytes</code> or a <code>str</code> object. But we know that uppercasing a <code>str</code> gives us a <code>str</code>, and uppercasing a <code>bytes</code> gives us a <code>bytes.</code> We can use <code>overload</code> to express this.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>overload
</span><span>
</span><span>@overload
</span><span style="color:#569cd6;">def </span><span>upper(x: str) -&gt; str: </span><span style="color:#569cd6;">...
</span><span>
</span><span>@overload
</span><span style="color:#569cd6;">def </span><span>upper(x: bytes) -&gt; bytes: </span><span style="color:#569cd6;">...
</span><span>
</span><span style="color:#569cd6;">def </span><span>upper(x: Union[bytes, str]) -&gt; Union[bytes, str]:
</span><span>    </span><span style="color:#569cd6;">return </span><span>x.upper()
</span></code></pre>
<p>The first two <code>@overload</code> definitions are like stubs: they're purely used for their annotations. The actual runtime implementation is specified at the end, undecorated. (<strong>NB</strong>: this specific example is better expressed without overloads, by using <a href="https://docs.python.org/3/library/typing.html?highlight=typing%20generic#typing.AnyStr">AnyStr</a>.)</p>
<p>I was really impressed to see how <code>mypy</code> could use this overloading information. Here's an example:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>overload, Literal
</span><span>
</span><span>@overload
</span><span style="color:#569cd6;">def </span><span>f(x: int) -&gt; Literal[</span><span style="color:#b5cea8;">1</span><span>]: </span><span style="color:#569cd6;">...
</span><span>
</span><span>@overload
</span><span style="color:#569cd6;">def </span><span>f(x: str) -&gt; Literal[</span><span style="color:#b5cea8;">2</span><span>]: </span><span style="color:#569cd6;">...
</span><span>
</span><span style="color:#569cd6;">def </span><span>f(x: object) -&gt; int:
</span><span>    </span><span style="color:#569cd6;">if </span><span>isinstance(x, int):
</span><span>        </span><span style="color:#569cd6;">return </span><span style="color:#b5cea8;">1
</span><span>    </span><span style="color:#569cd6;">elif </span><span>isinstance(x, str):
</span><span>        </span><span style="color:#569cd6;">return </span><span style="color:#b5cea8;">2
</span><span>    </span><span style="color:#569cd6;">return </span><span style="color:#b5cea8;">3
</span><span>
</span><span style="color:#569cd6;">if </span><span>f(</span><span style="color:#b5cea8;">10</span><span>) == </span><span style="color:#b5cea8;">2</span><span>:
</span><span>    print(</span><span style="color:#d69d85;">&quot;potato&quot;</span><span>)
</span></code></pre>
<p>We can see that <code>f(10) == 1</code> and so the equality is always <code>False</code>: we'll never print the word &quot;potato&quot;. Mypy can reason through this too, if we ask it nicely.</p>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>$ mypy example.py
</span><span>Success: no issues found in 1 source file
</span><span>
</span><span>$ mypy --strict-equality --warn-unreachable example.py
</span><span>example.py:16: error: Non-overlapping equality check (left operand type: &quot;Literal[1]&quot;, right operand type: &quot;Literal[2]&quot;)
</span><span>example.py:17: error: Statement is unreachable
</span><span>Found 2 errors in 1 file (checked 1 source file)
</span></code></pre>
<h4 id="typeddict"><a href="https://docs.python.org/3/library/typing.html?highlight=typeddict#typing.TypedDict">TypedDict</a></h4>
<p>I mentioned this <a href="https://matrix.org/blog/2021/12/03/type-coverage-for-sydent-motivation">in last week's post</a>) when talking about the missing <code>await</code> bug.
Subclassing from <code>TypedDict</code> allows us to define a new type whose values are dictionaries with</p>
<ul>
<li>a fixed set of keys (some mandatory, some not), and</li>
<li>a fixed type for each key's value.</li>
</ul>
<p><a href="https://www.python.org/dev/peps/pep-0589/">PEP 589</a> can best describe the motivation, but in short: there's a lot of source code out there that passes dictionaries around. <code>TypedDict</code> is a way to gradually add typechecking to that code, without having to refactor it to use e.g. a <a href="https://docs.python.org/3/library/dataclasses.html">dataclass</a> or a <a href="https://docs.python.org/3/library/typing.html#typing.NamedTuple">NamedTuple</a>. Let's have a quick example.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>List, TypedDict
</span><span>
</span><span style="color:#569cd6;">class </span><span>Person(</span><span style="color:#4ec9b0;">TypedDict</span><span>):
</span><span>    full_name: str
</span><span>    nicknames: List[str]
</span><span>    age: int
</span><span>
</span><span>p: Person = {
</span><span>    </span><span style="color:#d69d85;">&quot;full_name&quot;</span><span>: </span><span style="color:#d69d85;">&quot;David Matthew Robertson&quot;</span><span>,
</span><span>    </span><span style="color:#d69d85;">&quot;nicknames&quot;</span><span>: [</span><span style="color:#d69d85;">&quot;dmr&quot;</span><span>],
</span><span>    </span><span style="color:#d69d85;">&quot;age&quot;</span><span>: </span><span style="color:#b5cea8;">29</span><span>,
</span><span>}
</span></code></pre>
<p>Mypy will detect if you delete or omit a required key, or if you insert a key that's not part of the type.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#608b4e;"># error: Key &quot;age&quot; of TypedDict &quot;Person&quot; cannot be deleted
</span><span style="color:#569cd6;">del </span><span>p[</span><span style="color:#d69d85;">&quot;age&quot;</span><span>]
</span><span>
</span><span style="color:#608b4e;"># error: Missing keys (&quot;full_name&quot;, &quot;nicknames&quot;, &quot;age&quot;) for TypedDict &quot;Person&quot;
</span><span>p2: Person = {}
</span><span>
</span><span style="color:#608b4e;"># error: TypedDict &quot;Person&quot; has no key &quot;eye_colour&quot;
</span><span>p[</span><span style="color:#d69d85;">&quot;eye_colour&quot;</span><span>] = </span><span style="color:#d69d85;">&quot;brown&quot;
</span></code></pre>
<p><code>TypedDict</code> is a useful tool, but there are a few important gotchas to be aware of. In my view, these are all minor and worth putting up with, to benefit from the extra type information that a <code>TypedDict</code> provides. Let's take a look.</p>
<h5 id="typeddict-is-incompatible-with-dict"><code>TypedDict</code> is incompatible with <code>Dict</code></h5>
<p>This one surprised me at first. Why can't I pass my <code>TypedDict</code> to a function that accepts a generic dictionary?</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">import </span><span>json
</span><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>Dict, TypedDict
</span><span>
</span><span style="color:#569cd6;">class </span><span>Foo(</span><span style="color:#4ec9b0;">TypedDict</span><span>):
</span><span>    bar: str
</span><span>
</span><span style="color:#569cd6;">def </span><span>print_size(d: Dict[object, object]) -&gt; </span><span style="color:#569cd6;">None</span><span>:
</span><span>    print(len(d))
</span><span>
</span><span>f: Foo = {</span><span style="color:#d69d85;">&quot;bar&quot;</span><span>: </span><span style="color:#d69d85;">&quot;baz&quot;</span><span>}
</span><span style="color:#608b4e;"># error: Argument 1 to &quot;print_size&quot; has incompatible type &quot;Foo&quot;; expected &quot;Dict[object, object]&quot;
</span><span>print_size(f)
</span></code></pre>
<p>The answer is that it wouldn't be type-safe! For all we know, the function <code>print_size</code> might mutate its argument <code>d</code>. It might add a key, remove a key, or change the type of a value. Each of those would break the contract that <code>TypedDict</code> is supposed to enforce, so mypy is correct to flag this as an error. <a href="https://github.com/python/mypy/issues/4976">This GitHub issue</a> has more discussion.</p>
<p>There are few workarounds for this kind of problem.</p>
<ul>
<li>The function might be able to accept a <code>TypedDict</code> directly.</li>
<li>The function could accept a <code>Mapping</code> instead of a <code>Dict</code>. This is type-safe because the <code>Mapping</code> type does not offer mutating methods such as <code>pop</code>, <code>__setitem__</code>, <code>__del__</code>; but it only works if the function does not mutate the dictionary.</li>
<li>A more drastic approach would discard the <code>TypedDict</code> information with a <code>cast</code> to <code>Dict[str, object]</code> or similar. If so, I'd strongly recommend a comment explaining why the cast is correct and safe.</li>
</ul>
<h5 id="mixing-mandatory-and-required-fields">Mixing mandatory and required fields</h5>
<p>Secondly, defining a <code>TypedDict</code> with a mixture of optional and required keys is a little fiddly. All keys can be made optional by passing <code>total=False</code> in the class definition. To have some keys optional and others mandatory, we have to make <em>two</em> TypedDicts. Say for instance we wanted to allow a potentially-missing <code>favourite_colour</code> field to <code>Person</code>. We can't add an annotation <code>favourite_colour: Optional[str]</code> to the first class body. That's optional in a different sense: it would mean that <code>favourite_colour</code> is a mandatory field which is allowed to be <code>None</code>. Instead, we apply <code>total=False</code> to a subclass:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>List, TypedDict
</span><span>
</span><span style="color:#569cd6;">class </span><span>_PersonRequired(</span><span style="color:#4ec9b0;">TypedDict</span><span>):
</span><span>    full_name: str
</span><span>    nicknames: List[str]
</span><span>    age: int
</span><span>
</span><span style="color:#569cd6;">class </span><span>Person(</span><span style="color:#4ec9b0;">_PersonRequired</span><span>, total=</span><span style="color:#4ec9b0;">False</span><span>):
</span><span>    favourite_colour: str
</span></code></pre>
<p>This means that a valid <code>Person</code> dictionary may have no <code>favourite_colour</code> key. If it is present, it must be a <code>str</code>.</p>
<p>The syntax is unfortunately a little clunky. <a href="https://www.python.org/dev/peps/pep-0655/">PEP 655</a> acknowledges this and proposes an alternative.</p>
<h5 id="typeddict-is-typecheck-time-only"><code>TypedDict</code> is typecheck-time only</h5>
<p>One final note: a <code>TypedDict</code> does no validation or conversion whatsoever. If mypy can't know the keys and values a dictionary will have a typecheck-time, you'll need to validate it by hand at runtime. We see this a lot because when deserialising json objects into a dictionary. Here's an example.</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">import </span><span>json
</span><span style="color:#9b9b9b;">from </span><span>typing </span><span style="color:#9b9b9b;">import </span><span>TypedDict
</span><span>
</span><span style="color:#569cd6;">class </span><span>Foo(</span><span style="color:#4ec9b0;">TypedDict</span><span>):
</span><span>    bar: str
</span><span>
</span><span style="color:#608b4e;"># note: Revealed type is &quot;Any&quot;
</span><span>reveal_type(json.loads(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>))
</span><span style="color:#608b4e;"># no error. mypy can&#39;t do analysis on Any.
</span><span>f: Foo = json.loads(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">{}</span><span style="color:#d69d85;">&quot;</span><span>)
</span></code></pre>
<h2 id="next-time">Next time</h2>
<p>This covers a lot of the machinery and the day-to-day process of annotating Sydent. The <a href="https://matrix.org/blog/2021/12/17/type-coverage-for-sydent-evaluation">last part of this series</a> will give us a chance to quantify our efforts and reflect on the wider typing ecosystem.</p>
<hr />
<p>Many thanks for reading! If you've got any corrections, comments or queries, I'm available on Matrix at <a href="https://matrix.to/#/@dmrobertson:matrix.org">@dmrobertson:matrix.org</a>.</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2021&#x2F;12&#x2F;03&#x2F;pre-disclosure-upcoming-security-release-of-libolm-and-matrix-js-sdk&#x2F;" title="Pre-disclosure: upcoming security release of libolm and matrix-js-sdk">Pre-disclosure: upcoming security release of libolm and matrix-js-sdk</a></h1>
            <span>
                03.12.2021 00:00
                —
                <a href="/category/security">
                    Security
                </a>
                —
                <a href="/author/matrix-security">
                    Matrix Security
                </a>
            </span>
            
        </header>
        <div>
            <p>On <strong>Monday, 13th December</strong> we plan to publish a security release of libolm at 15:00 UTC to address a single high severity issue. To the best of our knowledge, only matrix-js-sdk and clients relying on it for E2EE are affected by this issue. This includes Element Web/Desktop and their forks (like SchildiChat). The release of libolm will be immediately followed by a security release of matrix-js-sdk and the affected clients. Users of these clients are encouraged to <strong>upgrade as soon as the patched versions are released</strong>.</p>
<p>We will be reaching out to downstream packagers to ensure they can prepare patched versions of the affected packages at the time of the release. The details of the vulnerability will be disclosed in a blog post on the day of the release. There is so far no evidence of the vulnerability being exploited in the wild.</p>
<p>The patched version numbers will be as follows:</p>
<ul>
<li>libolm 3.2.8</li>
<li>matrix-js-sdk 15.2.1</li>
<li>Element Web/Desktop 1.9.7</li>
</ul>
<p>Thank you for your patience while we work to resolve this issue.</p>
<p><em>Edit, 2021-12-13: Added patched release numbers.</em></p>

        </div>
    </article>
    
    <nav class="pagination">
    <div class="prev">
        
        <a href="&#x2F;blog&#x2F;page&#x2F;8&#x2F;">‹ Previous</a>
        
    </div>
    <span class="page-number">9 / 64</span>
    <div class="prev">
        
        <a href="&#x2F;blog&#x2F;page&#x2F;10&#x2F;">Next ›</a>
        
    </div>
</nav>

</div>
    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="&#x2F;code"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
