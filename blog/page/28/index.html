<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Blog</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <link rel="stylesheet" href="/style.css" />

    </head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            current">
            Blog
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;docs&#x2F;" class="section ">
                Documentation
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                </div>
            </div>
        </div>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;ecosystem&#x2F;" class="section ">
                Ecosystem
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        <div class="content">
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;26&#x2F;this-week-in-matrix-2019-07-26&#x2F;" title="This Week in Matrix 2019-07-26">This Week in Matrix 2019-07-26</a></h1>
            <span>
                26.07.2019 00:00
                ‚Äî
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                ‚Äî
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live-demos">Matrix Live - demos!</h2>
<p>We had a great demo session this afternoon, unfortunately the recording quality for some of the items was not good enough to share - and it was interesting stuff too! I cut everything from the RiotX and Riot iOS sections - but we'll make it up to you by getting more news from those projects soon.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/7CbDu_m2hS8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="dept-of-status-of-matrix-face-with-th">Dept of <em>Status of Matrix</em> üå°</h2>
<h3 id="opportunities-available-for-paid-matrix-related-work">Opportunities available for paid Matrix-related work</h3>
<p>Matthew informed the community:</p>
<blockquote>
<p>We're getting more and more folks reaching out for paid help setting up smaller self-hosted Matrix deployments. The core team has its hands full currently with helping out with larger deployments; so if anyone reading this wants to offer paid support to those getting up and running on Matrix then please make us aware so we can potentially route inquiries to you.</p>
</blockquote>
<p>This is a great step for Matrix, and a great opportunity for you the reader! There are already several people prepared to start work on Matrix-related endeavours, but the fact that there is <em>more work coming in than we can currently route</em> is amazing. If you'd like to be on an informal shortlist, <a href="mailto:support@matrix.org">contact support@</a>, or <a href="https://matrix.to/#/@benpa:matrix.org">come chat to me directly</a>.</p>
<h2 id="dept-of-servers-europea">Dept of Servers üè¢</h2>
<h3 id="synapse">Synapse</h3>
<p>So said Neil, who oversees the Synapse-makers:</p>
<blockquote>
<p>This week we shipped two new versions, 1.2 (<a href="https://matrix.org/blog/2019/07/25/synapse-1-2-0-released">https://matrix.org/blog/2019/07/25/synapse-1-2-0-released</a>) and 1.2.1(<a href="https://matrix.org/blog/2019/07/26/critical-security-update-synapse-1-2-1-released">https://matrix.org/blog/2019/07/26/critical-security-update-synapse-1-2-1-released</a>). 1.2.1 contains critical security updates, the bugs are long lived and not regressions introduced in 1.2 so all admins are encouraged to upgrade asap.</p>
<p>We‚Äôve also been having some success in improving database performance and hope to ship that rsn so everyone can benefit.</p>
<p>Next week</p>
<p>We‚Äôll continue on db perf, improving logging verbosity (through recategorising some log lines) and generally looking to improve the experience for those admins running on smaller instances.</p>
</blockquote>
<h3 id="ruma">Ruma</h3>
<p><a href="https://matrix.to/#/@jimmycuadra:matrix.org">Jimmy</a> released TWIR:</p>
<ul>
<li>This Week in Ruma: <a href="https://www.ruma.io/news/this-week-in-ruma-2019-07-21/">https://www.ruma.io/news/this-week-in-ruma-2019-07-21/</a></li>
<li>now with liberapay, to support Ruma: <a href="https://liberapay.com/ruma/">https://liberapay.com/ruma/</a></li>
</ul>
<h3 id="gsoc-project-matrix-visualisations-mortar-board">GSOC project: Matrix Visualisations üéì</h3>
<p><a href="https://matrix.to/#/@eisha:matrix.org">Eisha</a>:</p>
<blockquote>
<p>The GSoc project ‚ÄúMatrix Visualisations‚Äù has continued its progression during the second period:</p>
<p>A ‚Äúmulti-view‚Äù has been implemented for the frontend application. It means that it is now possible to independently view multiple DAGs at the same time in the same canvas. It can be useful for observing the same DAG but on different HS‚Äôs, at the same time. The only current limitation is that you have to use the same backend for every view (with CS API or with the backend talking to a Synapse PostgreSQL database). This change took a long time as it required to make a lot of changes in the code.</p>
<p>The implementation of the support of the Federation API within the backend is in progress. It is slowly progressing as it needed some discussion before starting the work on it and its implementation requires me to become familiar with a lot of new things, regarding the federation process and the authentication of requests between HS‚Äôs.</p>
</blockquote>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks üèó</h2>
<h3 id="matrix-shell-suite-taking-feature-requests">matrix-shell-suite taking feature requests</h3>
<p><a href="https://matrix.to/#/@darnir:talk.go7box.xyz">darnir</a>:</p>
<blockquote>
<p>Hey, I'd like to put out a call to everyone out there. If there's any script people desire for interacting with matrix homeservers, the <a href="https://matrix.to/#/#matrix-shell-suite:matrix.org">#matrix-shell-suite:matrix.org</a> project is taking feature requests.</p>
</blockquote>
<h3 id="olm-sas-interface-for-rubyolm">Olm SAS interface for RubyOlm</h3>
<p><a href="https://matrix.to/#/@willem:canarymod.net">Willem</a>:</p>
<blockquote>
<p>I had the code laying around for quite a while, but I just completed the Olm SAS interface for <a href="https://github.com/14mRh4X0r/ruby_olm">my fork of RubyOlm</a>. It also includes interfaces for generating the emoji! üòÄ</p>
</blockquote>
<h2 id="dept-of-clients-iphone">Dept of Clients üì±</h2>
<h3 id="pattle-0-10-0">Pattle 0.10.0</h3>
<p>I've been playing with Pattle 0.10 and have to say, it feels silky smooth to scroll with. It's really making me look again at Flutter development.</p>
<p>From <a href="https://matrix.to/#/@wilko:matrix.org">Wilko</a>, project lead:</p>
<blockquote>
<p>A new version has been pushed to F-droid and TestFlight!</p>
<p>Note that for TestFlight the new version will be available in a few days.</p>
<ul>
<li>Improve scrolling through chat messages!
<ul>
<li>Messages are now paginated under the hood, before the whole message list was rebuild when loading more messages, causing a jittery scrolling experience.</li>
</ul>
</li>
<li>Support typing notifications!
<ul>
<li>Typing notifications are shown and send while typing.</li>
</ul>
</li>
<li>Add chat settings screen
<ul>
<li>Currently you can see the chat name, avatar, description and members. More will be added in the future.</li>
<li>You can go to the chat settings screen by clicking on the title of the chat. This'll probably change in the future (at least to be easier).</li>
</ul>
</li>
<li>Reverse swipe direction of images (thanks Nathan!)</li>
<li>Fix ripple not showing on send button</li>
<li>Make UI refreshing more efficient</li>
<li>The App Store (iOS) name is now 'Pattle' instead of 'Pattle IM'</li>
<li>When a chat is open, the UI will only be rebuild if <em>that</em> chat has updates.</li>
<li>Lot's of code clean ups and improvements, mostly in the SDK</li>
</ul>
</blockquote>
<p>What's coming up?</p>
<blockquote>
<ul>
<li>A release on Google Play!</li>
<li>A release on the official F-droid repo!</li>
<li>Remove Cupertino specific styling on iOS
<ul>
<li>Will now use Material Design, but altered for iOS. Having the discrepancy between Cupertino and Material was also the reason why some things didn't show up in iOS or why some things would be blue instead of the Pattle red.</li>
</ul>
</li>
<li>Notifications!? (F-droid)</li>
</ul>
</blockquote>
<p>Follow development in <a href="https://matrix.to/#/#app:pattle.im">#app:pattle.im</a>!</p>
<p><img src="/blog/img/2019-07-26-pattle.png" alt="Pattle 0.10" /></p>
<h3 id="spectral-introduces-support-for-reactions">Spectral introduces support for reactions</h3>
<p><a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a>:</p>
<blockquote>
<p>Reaction support is coming to Spectral!</p>
</blockquote>
<p><img src="/blog/img/2019-07-26-spectral.png" alt="Reactions in Spectral" /></p>
<h3 id="riot-web">Riot Web</h3>
<p>From the team:</p>
<blockquote>
<p>The edit history of a message now shows differences also for formatted (html) messages.</p>
</blockquote>
<h3 id="riot-ios">Riot iOS</h3>
<p>From the team:</p>
<blockquote>
<ul>
<li>Reactions: We have now an Emoji picker and the screen that displays who reacted</li>
<li>Soft logout fully implemented</li>
</ul>
</blockquote>
<h3 id="riot-android">Riot Android</h3>
<p>From the team:</p>
<blockquote>
<ul>
<li>New release of Riot (0.9.3) to fix crash on Android 4.x</li>
<li>The package is bigger because we embed both 32bits and 64bits, which is now required by Play Store</li>
</ul>
</blockquote>
<h3 id="riotx-android">RiotX (Android)</h3>
<p>From the team:</p>
<blockquote>
<ul>
<li>Room screen: Manage cancel/resend of unsent messages</li>
<li>New DM room creation flow</li>
<li>Room upgrade support</li>
</ul>
</blockquote>
<h2 id="dept-of-encryption-closed-lock-with-key">Dept of Encryption üîê</h2>
<h3 id="new-pantalaimon-release">New Pantalaimon release</h3>
<p><a href="https://github.com/poljar">poljar</a> told us:</p>
<blockquote>
<p><a href="https://github.com/matrix-org/pantalaimon">Pantalaimon</a> got a new release. This release brings experimental support for search in E2E encrypted rooms, performance improvements in the database department, better support for true headless mode for all the bot lovers, and of course the usual bug fixes and small improvements.</p>
</blockquote>
<h2 id="dept-of-bridges-bridge-at-night">Dept of Bridges üåâ</h2>
<h3 id="matrix-appservice-slack">matrix-appservice-slack</h3>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> announced:</p>
<blockquote>
<p><a href="https://github.com/matrix-org/matrix-appservice-slack/releases/tag/0.3.1">0.3.1 of the slack bridge is out with a few bugfixes</a></p>
</blockquote>
<p>Be sure to watch <a href="https://matrix.to/#/@cadair:cadair.com">Cadair</a> provide a demo in the Matrix Live video above.</p>
<h3 id="picard-bot-slack-bridging">Picard Bot (slack bridging)</h3>
<p><a href="https://matrix.to/#/@cadair:cadair.com">Cadair</a>:</p>
<blockquote>
<p><a href="https://matrix.to/#/@SolarDrew:matrix.org">SolarDrew</a> and I have been working on re-writing our <a href="https://github.com/SolarDrew/skill-picard">Picard Bot</a> for a conference next week. Picard helps you bridge between a slack team and a matrix community.</p>
<p>This second version of Picard adds support for reacting to creation of new rooms on slack in real time as well as implementing a set of commands for creating new bridged rooms from either matrix or slack. In addition to this, Picard has matrix commands for inviting you to all the bridged rooms in the communtiy and automatically inviting you to new rooms as they are created. Finally, we have added support for sending welcome messages to all new members of your slack team or matrix community in a DM with the bot, which we are using to explain the chat setup to users and giving them a private place to issue commands.</p>
<p>This is uses <a href="https://github.com/SolarDrew/skill-picard">matrix-appservice-slack</a> for actually sending events in bridged rooms, and PIcard itself is a skill for the <a href="https://opsdroid.readthedocs.io/">opsdroid</a> bot framework #opsdroid-general:matrix.org  and uses the <a href="https://github.com/SolarDrew/database-matrix/">matrix-database</a> plugin for opsdroid which uses matrix room state to back the opsdroid memory.</p>
</blockquote>
<h3 id="mx-puppet-bridge-new-bridge-mx-puppet-instagram">mx-puppet-bridge, new bridge: mx-puppet-instagram</h3>
<blockquote>
<p>The work on mx-puppet-bridge things continue! The core library and the implementation received some bugfixes, however, a new bridge is there: <a href="https://github.com/Sorunome/mx-puppet-instagram">mx-puppet-instagram</a>. Currently it supports</p>
<ul>
<li>Auth currently only by username+password :(</li>
<li>basic message sending</li>
<li>I-&gt;M photoes, voice messages, animated image thingies</li>
<li>M-&gt;I images</li>
<li>M-&gt;I files as links only</li>
</ul>
</blockquote>
<h3 id="mautrix-whatsapp">mautrix-whatsapp</h3>
<p><a href="https://matrix.to/#/@tulir:maunium.net">tulir</a> has been putting a lot of time into WhatsApp bridging lately, the bridge is more stable than ever:</p>
<blockquote>
<p>There's a mysterious <a href="https://github.com/tulir/mautrix-whatsapp/tree/wasm">new mautrix-whatsapp branch</a>. Related to that, I made a <a href="https://github.com/matrix-org/matrix-doc/pull/2190">spec proposal</a> and a <a href="https://github.com/matrix-org/synapse/pull/5758">synapse PR</a> to allow appservice bots to use <code>/sync</code>.</p>
</blockquote>
<h3 id="gsoc-project-reliable-bridges">GSoC Project: Reliable Bridges</h3>
<p>Thanks for this update from <a href="https://matrix.to/#/@kai:nasnotfound.de">Kai</a>:</p>
<blockquote>
<p>It's all coming together now. While all pieces of the puzzle were roughly there, now they are put into the big picture.</p>
</blockquote>
<p>The <a href="https://github.com/matrix-org/matrix-appservice-bridge/pull/111">bridge SDK PR</a> has been merged to develop, now providing bridges the benefit of error reporting. The modifications to the SDK are non-breaking, but activation of the feature requires small changes to the bridge using it. But be warned, everything is still under an unstable prefix and rightly so ‚Äì the implementation is still subject to change.
&gt;</p>
<blockquote>
<p>The MSC didn't get much love in public, but the concepts required to evolve it are taking shape. It was contemplated to piggyback on <a href="https://github.com/matrix-org/matrix-doc/issues/1410">MSC 1410: Rich Bridging</a> and to add a retry mechanism. So heads up for more to come on this front.</p>
<p>The <a href="https://github.com/matrix-org/matrix-react-sdk/pull/3246">display of bridge errors</a> in Riot Web is now a PR and in the state of getting its last few kinks removed. It will start to be available under a lab flag soon.</p>
<p>With everything getting to play together nicely, there will be the first rooms enabling bridge errors to test the code in the wild. Stabilizing the code for everyday use and getting the MSC into a respectable form are the next goals for the project. Those will help in fostering broader adoption among bridges and clients.</p>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops üõ†</h2>
<h3 id="k8s-images">k8s images</h3>
<p><a href="https://github.com/ananace/">Ananace</a> made sure everything is up to date for Synapse with <a href="https://github.com/ananace/matrix-synapse">1.2.1 images now available</a>.</p>
<h2 id="dept-of-identity-passport-control">Dept of Identity üõÇ</h2>
<h3 id="ma1sd-identity-server-forked-from-mxisd-released">ma1sd, identity server forked from mxisd released</h3>
<p><a href="https://matrix.to/#/@ma1uta:matrix.org">ma1uta</a> has been working on <a href="https://github.com/ma1uta/ma1sd">ma1sd</a>, a fork of the discontinued mxisd:</p>
<blockquote>
<p>ma1sd (<a href="https://github.com/ma1uta/ma1sd">https://github.com/ma1uta/ma1sd</a>) is released.
ma1sd is a fork of the discontinued mxisd (<a href="https://github.com/kamax-matrix/mxisd">https://github.com/kamax-matrix/mxisd</a>) is a federated Matrix Identity Service.</p>
<p>Changes:</p>
<ul>
<li>rename the application name, configuration options to ma1sd. Internal names, packages still use old name mxisd</li>
<li>bump some dependencies to the latest versions</li>
<li>add openjdk-11 dependency for debian package due to debian 10 doesn't include openjdk-8 (yep, ma1sd can work with java 11).</li>
</ul>
<p>Downloads:</p>
<ul>
<li><a href="https://github.com/ma1uta/ma1sd/releases/tag/2.0.0">https://github.com/ma1uta/ma1sd/releases/tag/2.0.0</a> - deb package and tar/zip archives</li>
<li><a href="https://hub.docker.com/r/ma1uta/ma1sd">https://hub.docker.com/r/ma1uta/ma1sd</a> - docker images</li>
</ul>
<p>Feel free to ask me questions about ma1sd in #ma1sd:ru-matrix.org</p>
</blockquote>
<h2 id="final-thoughts-thought-balloon">Final thoughts üí≠</h2>
<p><a href="https://matrix.to/#/@kitsune:matrix.org">kitsune</a>: &quot;the latest versions of <a href="https://github.com/QMatrixClient/libqmatrixclient">libQMatrixClient</a> (0.5.2 - still under the old name) and <a href="https://github.com/QMatrixClient/Quaternion">Quaternion</a> (0.0.9.4) are now available in Debian unstable, thanks to <a href="https://matrix.to/#/@uhoreg:matrix.org">uhoreg</a>&quot;</p>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know üèÅ</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#TWIM:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;25&#x2F;synapse-1-2-0-released&#x2F;" title="Synapse 1.2.0 released">Synapse 1.2.0 released</a></h1>
            <span>
                25.07.2019 00:00
                ‚Äî
                <a href="/category/releases">
                    Releases
                </a>
                ‚Äî
                <a href="/author/neil-johnson">
                    Neil Johnson
                </a>
            </span>
            
        </header>
        <div>
            <p>Hey hey, Synapse 1.2.0 is here. It contains aggregations support, better error handling for  deactivated accounts and some important bug fixes for redacting messages. Special thanks to community members <a href="https://github.com/skalarproduktraum">skalarproduktraum</a> and <a href="https://github.com/Lrizika">Lrizika</a> for submissions to improve our documentation.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.2.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up <a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.1.0 follows:</p>
<h1 id="synapse-1-2-0-2019-07-25">Synapse 1.2.0 (2019-07-25)</h1>
<p>No significant changes.</p>
<h1 id="synapse-1-2-0rc2-2019-07-24">Synapse 1.2.0rc2 (2019-07-24)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix a regression introduced in v1.2.0rc1 which led to incorrect labels on some prometheus metrics. (<a href="https://github.com/matrix-org/synapse/issues/5734">#5734</a>)</li>
</ul>
<h1 id="synapse-1-2-0rc1-2019-07-22">Synapse 1.2.0rc1 (2019-07-22)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Add support for opentracing. (<a href="https://github.com/matrix-org/synapse/issues/5544">#5544</a>, <a href="https://github.com/matrix-org/synapse/issues/5712">#5712</a>)</li>
<li>Add ability to pull all locally stored events out of synapse that a particular user can see. (<a href="https://github.com/matrix-org/synapse/issues/5589">#5589</a>)</li>
<li>Add a basic admin command app to allow server operators to run Synapse admin commands separately from the main production instance. (<a href="https://github.com/matrix-org/synapse/issues/5597">#5597</a>)</li>
<li>Add <code>sender</code> and <code>origin_server_ts</code> fields to <code>m.replace</code>. (<a href="https://github.com/matrix-org/synapse/issues/5613">#5613</a>)</li>
<li>Add default push rule to ignore reactions. (<a href="https://github.com/matrix-org/synapse/issues/5623">#5623</a>)</li>
<li>Include the original event when asking for its relations. (<a href="https://github.com/matrix-org/synapse/issues/5626">#5626</a>)</li>
<li>Implement <code>session_lifetime</code> configuration option, after which access tokens will expire. (<a href="https://github.com/matrix-org/synapse/issues/5660">#5660</a>)</li>
<li>Return &quot;This account has been deactivated&quot; when a deactivated user tries to login. (<a href="https://github.com/matrix-org/synapse/issues/5674">#5674</a>)</li>
<li>Enable aggregations support by default (<a href="https://github.com/matrix-org/synapse/issues/5714">#5714</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix 'utime went backwards' errors on daemonization. (<a href="https://github.com/matrix-org/synapse/issues/5609">#5609</a>)</li>
<li>Various minor fixes to the federation request rate limiter. (<a href="https://github.com/matrix-org/synapse/issues/5621">#5621</a>)</li>
<li>Forbid viewing relations on an event once it has been redacted. (<a href="https://github.com/matrix-org/synapse/issues/5629">#5629</a>)</li>
<li>Fix requests to the <code>/store_invite</code> endpoint of identity servers being sent in the wrong format. (<a href="https://github.com/matrix-org/synapse/issues/5638">#5638</a>)</li>
<li>Fix newly-registered users not being able to lookup their own profile without joining a room. (<a href="https://github.com/matrix-org/synapse/issues/5644">#5644</a>)</li>
<li>Fix bug in #5626 that prevented the original_event field from actually having the contents of the original event in a call to <code>/relations</code>. (<a href="https://github.com/matrix-org/synapse/issues/5654">#5654</a>)</li>
<li>Fix 3PID bind requests being sent to identity servers as <code>application/x-form-www-urlencoded</code> data, which is deprecated. (<a href="https://github.com/matrix-org/synapse/issues/5658">#5658</a>)</li>
<li>Fix some problems with authenticating redactions in recent room versions. (<a href="https://github.com/matrix-org/synapse/issues/5699">#5699</a>, <a href="https://github.com/matrix-org/synapse/issues/5700">#5700</a>, <a href="https://github.com/matrix-org/synapse/issues/5707">#5707</a>)</li>
<li>Ignore redactions of m.room.create events. (<a href="https://github.com/matrix-org/synapse/issues/5701">#5701</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Base Docker image on a newer Alpine Linux version (3.8 -&gt; 3.10). (<a href="https://github.com/matrix-org/synapse/issues/5619">#5619</a>)</li>
<li>Add missing space in default logging file format generated by the Docker image. (<a href="https://github.com/matrix-org/synapse/issues/5620">#5620</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Add information about nginx normalisation to reverse_proxy.rst. Contributed by @skalarproduktraum - thanks! (<a href="https://github.com/matrix-org/synapse/issues/5397">#5397</a>)</li>
<li>--no-pep517 should be --no-use-pep517 in the documentation to setup the development environment. (<a href="https://github.com/matrix-org/synapse/issues/5651">#5651</a>)</li>
<li>Improvements to Postgres setup instructions. Contributed by @Lrizika - thanks! (<a href="https://github.com/matrix-org/synapse/issues/5661">#5661</a>)</li>
<li>Minor tweaks to postgres documentation. (<a href="https://github.com/matrix-org/synapse/issues/5675">#5675</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove support for the <code>invite_3pid_guest</code> configuration setting. (<a href="https://github.com/matrix-org/synapse/issues/5625">#5625</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Move logging code out of <code>synapse.util</code> and into <code>synapse.logging</code>. (<a href="https://github.com/matrix-org/synapse/issues/5606">#5606</a>, <a href="https://github.com/matrix-org/synapse/issues/5617">#5617</a>)</li>
<li>Add a blacklist file to the repo to blacklist certain sytests from failing CI. (<a href="https://github.com/matrix-org/synapse/issues/5611">#5611</a>)</li>
<li>Make runtime errors surrounding password reset emails much clearer. (<a href="https://github.com/matrix-org/synapse/issues/5616">#5616</a>)</li>
<li>Remove dead code for persiting outgoing federation transactions. (<a href="https://github.com/matrix-org/synapse/issues/5622">#5622</a>)</li>
<li>Add <code>lint.sh</code> to the scripts-dev folder which will run all linting steps required by CI. (<a href="https://github.com/matrix-org/synapse/issues/5627">#5627</a>)</li>
<li>Move RegistrationHandler.get_or_create_user to test code. (<a href="https://github.com/matrix-org/synapse/issues/5628">#5628</a>)</li>
<li>Add some more common python virtual-environment paths to the black exclusion list. (<a href="https://github.com/matrix-org/synapse/issues/5630">#5630</a>)</li>
<li>Some counter metrics exposed over Prometheus have been renamed, with the old names preserved for backwards compatibility and deprecated. See <code>docs/metrics-howto.rst</code> for details. (<a href="https://github.com/matrix-org/synapse/issues/5636">#5636</a>)</li>
<li>Unblacklist some user_directory sytests. (<a href="https://github.com/matrix-org/synapse/issues/5637">#5637</a>)</li>
<li>Factor out some redundant code in the login implementation. (<a href="https://github.com/matrix-org/synapse/issues/5639">#5639</a>)</li>
<li>Update ModuleApi to avoid register(generate_token=True). (<a href="https://github.com/matrix-org/synapse/issues/5640">#5640</a>)</li>
<li>Remove access-token support from <code>RegistrationHandler.register</code>, and rename it. (<a href="https://github.com/matrix-org/synapse/issues/5641">#5641</a>)</li>
<li>Remove access-token support from <code>RegistrationStore.register</code>, and rename it. (<a href="https://github.com/matrix-org/synapse/issues/5642">#5642</a>)</li>
<li>Improve logging for auto-join when a new user is created. (<a href="https://github.com/matrix-org/synapse/issues/5643">#5643</a>)</li>
<li>Remove unused and unnecessary check for FederationDeniedError in _exception_to_failure. (<a href="https://github.com/matrix-org/synapse/issues/5645">#5645</a>)</li>
<li>Fix a small typo in a code comment. (<a href="https://github.com/matrix-org/synapse/issues/5655">#5655</a>)</li>
<li>Clean up exception handling around client access tokens. (<a href="https://github.com/matrix-org/synapse/issues/5656">#5656</a>)</li>
<li>Add a mechanism for per-test homeserver configuration in the unit tests. (<a href="https://github.com/matrix-org/synapse/issues/5657">#5657</a>)</li>
<li>Inline issue_access_token. (<a href="https://github.com/matrix-org/synapse/issues/5659">#5659</a>)</li>
<li>Update the sytest BuildKite configuration to checkout Synapse in <code>/src</code>. (<a href="https://github.com/matrix-org/synapse/issues/5664">#5664</a>)</li>
<li>Add a <code>docker</code> type to the towncrier configuration. (<a href="https://github.com/matrix-org/synapse/issues/5673">#5673</a>)</li>
<li>Convert <code>synapse.federation.transport.server</code> to <code>async</code>. Might improve some stack traces. (<a href="https://github.com/matrix-org/synapse/issues/5689">#5689</a>)</li>
<li>Documentation for opentracing. (<a href="https://github.com/matrix-org/synapse/issues/5703">#5703</a>)</li>
</ul>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;24&#x2F;data-portability-tooling-bug&#x2F;" title="Data Portability Tooling Bug">Data Portability Tooling Bug</a></h1>
            <span>
                24.07.2019 00:00
                ‚Äî
                <a href="/category/privacy">
                    Privacy
                </a>
                ‚Äî
                <a href="/author/thomas-lant">
                    Thomas Lant
                </a>
            </span>
            
        </header>
        <div>
            <p>It was drawn to our attention this afternoon that there is a bug in our GDPR data portability tooling that resulted in the data dump including some events that should not have been included.</p>
<p>This tooling has recently been updated (<a href="https://github.com/matrix-org/synapse/blob/baf081cd3b040926e2d14dfd1c555307bba59245/synapse/handlers/admin.py#L98">here is the new code</a>), and the bug only affects reports generated with the updated tool. So far we have generated one report using the updated tooling.</p>
<p>The bug affects events which:</p>
<ul>
<li>were sent in rooms in which, at the point at which the message was sent, the message visibility was set to 'shared' or 'world readable', and</li>
<li>were pulled in over federation from another server after the data subject left the room</li>
</ul>
<p>As a reminder, 'shared' message visibility means <em>anyone in the room can view the message, from the point in time at which visibility was set to 'shared'</em> and 'world readable' means <em>anyone can read the messages without joining the room, from the point in time at which visibility was set to 'world readable'</em>.</p>
<p>Events are pulled onto a homeserver over federation when a user on that homeserver tries to access events which, for whatever reason, their homeserver does not already have a local copy. This most often happens when their homeserver is offline for any period of time, but can also happen when a user is the first user from their homeserver to join a room with active participants on other homeservers.</p>
<p>We're still analysing the data but so far it looks like the bug resulted in only a small number of events that were not publicly-accessible being shared (there were also publicly-accessible events mistakenly included). At this stage we have identified 19 events from 4 users across 2 rooms (the dump contained ~3.5 million events). This is not to diminish the severity of the bug - just to reassure that the scale of its impact appears to be extremely limited.</p>
<p>It is also worth noting that any encrypted events erroneously included in the dump will not have been decryptable (since the data subject would not have had access to the keys).</p>
<h3 id="update-2019-08-06">Update (2019-08-06)</h3>
<blockquote>
<p>In our original analysis we stated that 19 events were shared erroneously. On closer analysis we missed 5 other timeline events - the correct figure is 24 timeline events originating from 4 users over 2 rooms. However, this figure focused on timeline data and does not take into account all state events (such as user joins, parts, topic changes etc). When considering these too, a further 56 state events were erroneously shared, referencing 64 users across these 2 rooms (mainly detailing when users had joined/left the room after the requesting user themselves had left). These membership events contained avatar &amp; display name details which may not have been public (but in practice, the vast majority appear to be public data).</p>
<p>Aside from the events referenced above, the full dump contained ~20,000 events that also ought not to have been included; however <strong>these events were already publicly accessible due to being part of publicly accessible rooms</strong> (eg Matrix HQ) and so we do not consider them a breach of data.</p>
</blockquote>
<h2 id="what-caused-the-bug">What caused the bug?</h2>
<p>Events that are pulled in over federation are assigned a negative 'stream ordering' ID. This is designed to avoid their being sent down the sync (where they would likely be out of sequence). In normal operation (accessing your homeserver via a Matrix client) these events would be appropriately filtered, but a bug in the data dump tooling caused them to be included.</p>
<p>The bug was introduced as a result of two factors:</p>
<ul>
<li>The event filtering code assumes that the user is currently in the room - this was not intuitive, and was not called out in the documentation</li>
<li>When we fetched the events from the database, we tried to limit to events sent before the user left the room. On reflection, we used the wrong ordering mechanism (stream ordering instead of topological ordering), resulting in the inclusion of events that were fetched from a remote server after the data subject had left</li>
</ul>
<p>We are working to fix the bug, and we'll update here when it is resolved. As a reminder, please do report security bugs responsibly as per the <a href="https://matrix.org/security-disclosure-policy/">Security Disclosure Policy</a> so we can validate the issue and mitigate abuse.</p>
<p>As is standard practice for any data breach, we have notified the ICO.</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;19&#x2F;privacy-changes-to-new-vector-identity-servers&#x2F;" title="Privacy Changes to New Vector Identity Servers">Privacy Changes to New Vector Identity Servers</a></h1>
            <span>
                19.07.2019 16:35
                ‚Äî
                <a href="/category/privacy">
                    Privacy
                </a>
                ‚Äî
                <a href="/author/thomas-lant">
                    Thomas Lant
                </a>
            </span>
            
        </header>
        <div>
            <p>As a step towards implementing Terms of Service for Sydent Identity Servers (<a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a>), we're rolling out a couple of changes to the two Identity Servers run by New Vector (running at vector.im and matrix.org):</p>
<ol>
<li>We have erased all of the data where there is any chance that the data subject didn't understand how, why or with whom their data was being shared.</li>
<li>We've made a change to Sydent so that it no longer persists new associations relating to users on homeservers not run by New Vector.</li>
</ol>
<p>The impact of these changes is that users on homeservers not run by New Vector will no longer be discoverable by their email or telephone number via the Identity Servers running at vector.im and matrix.org. As we roll out the rest of the changes for Terms of Service for Identity Servers, this functionality will again be made available for users who make an informed choice to opt in.</p>
<h2 id="registration-with-email-and-password-reset">Registration with Email and Password Reset</h2>
<p>In the short term, the New Vector Identity Servers will continue to support registration with email (signing up with an email address as well as a matrix username) and password reset. However, as we continue to improve Identity Server data hygiene practices, we will phase out their use in registration with email and password reset entirely. We have already made the change to Synapse to support password reset without relying on an Identity Server (though this can optionally be re-enabled).</p>
<p>Once Synapse can support registration with email without relying on an Identity Server <strong>we will announce a schedule for disabling registration with email and password reset in our Identity Servers entirely</strong>. After this point, homeserver administrators will have to make sure their homeservers are configured to send email to keep registration with email and password reset working. More details on this to follow - please watch this space.</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;19&#x2F;this-week-in-matrix-2019-07-19&#x2F;" title="This Week in Matrix 2019-07-19">This Week in Matrix 2019-07-19</a></h1>
            <span>
                19.07.2019 00:00
                ‚Äî
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                ‚Äî
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live-smorgasbord">Matrix Live Sm√∂rg√•sbord üéô</h2>
<p>Featuring: Open Tracing, Synapse, Dendrite and Riot Web</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/uR17MSI_Iu4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="dept-of-spec-scroll">Dept of Spec üìú</h2>
<h3 id="spec-news">Spec News</h3>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2181">MSC2181: Add an Error Code for Signaling a Deactivated User</a>
<ul>
<li>New MSC, with FCP proposed.</li>
<li>Will allow matrix clients to differentiate between incorrect password entry and a user who has been deactivated.</li>
</ul>
</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2174">MSC2174: Move the <code>redacts</code> key to a sane place</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2175">MSC2175: Remove the <code>creator</code> field from <code>m.room.create</code> events</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2176">MSC2176: Update the redaction rules</a>
<ul>
<li><a href="https://matrix.to/#/@richvdh:sw1v.org">richvdh</a> storms in with 3 MSCs to fix some old spec issues relating to event redactions.</li>
</ul>
</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2184">MSC2184: Allow the use of the HTML <code>&lt;details&gt;</code> tag</a>
<ul>
<li><a href="https://github.com/ananace">ananace</a>‚Äôs first MSC!</li>
<li>Allowing expandable content within messages.</li>
<li>Would be very useful for logs dumps, bot help messages and for posting other large content without spamming the room.</li>
</ul>
</li>
</ul>
<h3 id="not-quite-matrix-feneas-call-for-comments-on-spec-for-metadata">(not quite matrix) feneas call for comments on spec for metadata</h3>
<p><a href="https://matrix.to/#/@jaywink:feneas.org">jaywink</a>:</p>
<blockquote>
<p><code>&lt;community-hat&gt;</code><br />
I'm working on a specification for exporting metadata and usage metrics out of federated servers. The aim is that the same specification could be re-used cross-protocol for example with not only Matrix servers but also ActivityPub, Diaspora and XMPP servers, as an example. Looking for comments here: <a href="https://talk.feneas.org/t/serverinfo-specification-for-server-metadata/99">https://talk.feneas.org/t/serverinfo-specification-for-server-metadata/99</a><br />
<code>&lt;/community-hat&gt;</code></p>
</blockquote>
<h2 id="dept-of-servers-europea">Dept of Servers üè¢</h2>
<h3 id="dendrite">Dendrite</h3>
<p><a href="https://matrix.to/#/@andrewm:amorgan.xyz">anoa</a>:</p>
<blockquote>
<h4 id="feature-updates">Feature Updates</h4>
<p>Dendrite continues along with more development from <a href="https://matrix.to/#/@andrewm:amorgan.xyz">anoa</a>, our resident GSoC student <a href="https://matrix.to/#/@cnly:matrix.org">cnly</a>, and a few community members. <a href="https://matrix.to/#/@cnly:matrix.org">cnly</a> has been working mainly on <a href="https://github.com/matrix-org/dendrite/pull/718">fixing</a> <a href="https://github.com/matrix-org/dendrite/pull/751">up</a> <a href="https://github.com/matrix-org/dendrite/pull/752">/sync issues</a> and <a href="https://github.com/matrix-org/dendrite/pull/732">other areas of the CS API</a>, fixing the various <a href="https://github.com/matrix-org/dendrite/issues?q=is%3Aissue+is%3Aopen+label%3Acomponent%3Afederation">federation issues</a>, mainly those dealing with <a href="https://matrix.org/docs/spec/server_server/unstable#room-state-resolution">room state</a>, and various other <a href="https://github.com/matrix-org/dendrite/pull/740">maintenance tasks</a> <a href="https://github.com/matrix-org/dendrite/pull/748">around the codebase</a> that are highly appreciated. <a href="https://matrix.to/#/@peekay_46:matrix.org">peekay_46</a> has been hard at work completing <a href="https://github.com/matrix-org/dendrite/pull/694">Dendrite‚Äôs implementation of room tagging</a> and <a href="https://matrix.to/#/@trion129:matrix.org">trion129</a> returned to continue with adding a <a href="https://github.com/matrix-org/dendrite/pull/405">fallback page for recaptcha</a> (for clients that can‚Äôt render web pages). We have a number of community PRs still with active members, but most are waiting for reviews, which <a href="https://matrix.to/#/@andrewm:amorgan.xyz">anoa</a> is working towards.</p>
<h4 id="the-plan">The Plan</h4>
<p>A couple TWIMs ago we <a href="https://matrix.org/blog/2019/07/05/this-week-in-matrix-2019-07-05">teased</a> that Dendrite had a plan in the works. Well one meeting later and here is the proposal:</p>
<p>It will take a while for Dendrite to become feature complete with Synapse, but we‚Äôd like people to be able to actually use Dendrite before then. Instead of waiting for feature-completeness, we propose a set of milestones for Dendrite development to reach and prioritize development for.</p>
<p>These milestones are currently listed on <a href="https://github.com/matrix-org/dendrite/milestones">Dendrite‚Äôs github</a>. The first is ‚ÄúBot Hosting‚Äù, which means, once complete, Dendrite would be suitable as a ‚Äúbot hub‚Äù, allowing server admins to run massive bridges on top of Dendrite while taking advantage of its horizontal-scaling capabilities. As written in the description, this goal includes basic CS API support, as well as federation with other homeservers. At this stage Dendrite should already be usable in rooms with other Synapse servers, which should make it a lot more interesting.</p>
<p>After that is several more milestones, each representing another use case that Dendrite can fill.</p>
<p>Don‚Äôt be alarmed at the currently quite small percentage of completeness, as these milestones have just been built from the open issue list. We‚Äôre actually quite far along to #1 already :)</p>
<p>We also want to mention that the milestones aren‚Äôt completely built yet - there‚Äôs still a few more issues to comb through. It‚Äôs taken a few days as <a href="https://matrix.to/#/@andrewm:amorgan.xyz">anoa</a> can‚Äôt help himself to fix things as he goes along. A few open issues have also been closed as they had already been fixed earlier.</p>
<p>This is all mentioned in this week‚Äôs Matrix Live above by the way, so be sure to catch for some extra details if you‚Äôre interested.</p>
<p>We look forward to shipping you a working Dendrite soon‚Ñ¢. And as always feel free to join us in <a href="https://matrix.to/#/!yjVgJUsMLYLAONsoii:jki.re?via=matrix.org&amp;via=privacytools.io&amp;via=ru-matrix.org">#dendrite-dev:matrix.org</a> for discussion.</p>
</blockquote>
<h3 id="synapse">Synapse</h3>
<p>Neil, who oversees the Synapse factory:</p>
<blockquote>
<p>This week we‚Äôve been working on improving database performance, shipping the new small hosted homeserver instances - expect a lot of improvements to come that will benefit the whole community and merged our recent OpenTracing support. We‚Äôve also made some changes to how Sydent processes and stores email - more details here <a href="https://matrix.org/blog/2019/07/19/privacy-changes-to-new-vector-identity-servers">https://matrix.org/blog/2019/07/19/privacy-changes-to-new-vector-identity-servers</a></p>
<p>Next week, expect a new release, more database performance improvements and general Synapse performance work.</p>
</blockquote>
<p>Listen to Matrix Live to hear Erik talking about his DB perf work ‚òùÔ∏è</p>
<h3 id="ruma">Ruma</h3>
<p><a href="https://www.ruma.io/news/this-week-in-ruma-2019-07-14/">This Week in Ruma</a>, from <a href="https://matrix.to/#/@jimmycuadra:matrix.org">Jimmy</a>:</p>
<blockquote>
<p>...<br />
While I was working on <a href="https://github.com/ruma/ruma-signatures/">ruma-signatures</a>, I decided to fill in the missing functionality‚Äîsigning and verifying events. In the process of doing that, I ended up with a significantly revised API for the crate, which has now been released as <a href="https://github.com/ruma/ruma-signatures/releases/tag/0.5.0">version 0.5.0</a>.<br />
...</p>
</blockquote>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks üèó</h2>
<h3 id="new-release-of-matrix-nio-python-sdk">New release of matrix-nio (Python SDK)</h3>
<p><a href="https://github.com/poljar">poljar</a> said:</p>
<blockquote>
<p>New <a href="https://github.com/poljar/matrix-nio">matrix-nio</a> release bringing you documentation improvements across the board, while the documentation is still not fully complete yet it should be much easier to get started with nio.<br />
Another highlight of this release is couroutine support for the event callbacks for the AsyncClient.</p>
</blockquote>
<p>Take a look at the <a href="https://matrix.org/docs/guides/usage-of-matrix-nio">getting started guide</a> too.</p>
<h3 id="ruby-sdk">Ruby SDK</h3>
<p><a href="https://github.com/ananace/">Ananace</a>:</p>
<blockquote>
<p>I just cut a 1.3.0 release of the <a href="https://github.com/ananace/ruby-matrix-sdk">Ruby SDK</a>, mainly focusing on solving an issue due to Ruby extensions polluting the global scope. It also adds a very slightly extended response handling, which recursively adds getters for the keys of the resulting objects.<br />
Many thanks to the people reporting issues to me so I can keep improving the SDK.</p>
</blockquote>
<h3 id="the-kotlin-library-koma">The Kotlin library koma</h3>
<p><a href="https://matrix.to/#/@uforia:matrix.org">yuforia</a>, author of <a href="https://github.com/koma-im/koma/">koma</a> and <a href="https://github.com/koma-im/continuum-desktop">Continuum</a>:</p>
<blockquote>
<ul>
<li>Fixed incorrect type casting in function KResult.map</li>
<li>Reorganize the structure of modules, separate APIs that don't require authentication, so that they can be used before signing in</li>
</ul>
</blockquote>
<h2 id="dept-of-bridges-bridge-at-night">Dept of Bridges üåâ</h2>
<h3 id="matrix-appservice-slack">matrix-appservice-slack</h3>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> announced:</p>
<blockquote>
<p>Today we've released <a href="https://github.com/matrix-org/matrix-appservice-slack/releases">0.3.0 of the slack bridge</a> since the last rc has proved to be stable. I hope you all enjoy the new features we've packed into this release. And as a reminder, there is another release right around the corner :)</p>
</blockquote>
<h2 id="dept-of-clients-iphone">Dept of Clients üì±</h2>
<h3 id="riotx-android">RiotX (Android)</h3>
<p>From the team (see Matrix Live from last week for more from them):</p>
<blockquote>
<ul>
<li>RiotX 0.2.0 has been released on Thursday. Main new features: room filtering, message editing in e2e rooms, view editing history. Also many small new features and bugfixes.
<ul>
<li>Full perimeter can be found here: <a href="https://github.com/vector-im/riotX-android/milestone/6?closed=1">https://github.com/vector-im/riotX-android/milestone/6?closed=1</a></li>
<li>Known limitation: crash on device running Android KitKat (4.4). We are considering supporting only device running Android Lollipop (5.0) and up (see/approve/comment <a href="https://github.com/vector-im/riotX-android/issues/405">https://github.com/vector-im/riotX-android/issues/405</a>)</li>
</ul>
</li>
<li>The team is still working on the main missing features: creation of direct chat, read receipt, along with UI/UX polishing.</li>
</ul>
</blockquote>
<p>If you're using Android, definitely start trying RiotX, you can even <a href="https://play.google.com/store/apps/details?id=im.vector.riotx&amp;rdid=im.vector.riotx">find it in the Play Store</a> now.</p>
<h3 id="riot-web">Riot Web</h3>
<p>From the team:</p>
<blockquote>
<p>Riot v1.3.0 was released with support for reactions and message editing enabled. Check out the <a href="https://medium.com/@RiotChat/%EF%B8%8Fmessage-editing-%EF%B8%8F-reactions-5cffec8f71a2">Riot blog post</a> for more details. No changes are needed to enable these features for self-hosted installs anymore (which is change from what was stated in last week‚Äôs TWIM update).</p>
<p>We‚Äôre continuing to work on several privacy improvements to related to integration managers and identity servers to give users more control over these.</p>
</blockquote>
<h3 id="riot-android">Riot Android</h3>
<p>From the team:</p>
<blockquote>
<p>Riot 0.9.2 has been released on Friday. It contains some bug fixes and new translations for many strings especially for the device verification feature.</p>
</blockquote>
<h3 id="riot-ios">Riot iOS</h3>
<p>From the team:</p>
<blockquote>
<ul>
<li>We released v0.9.1 with message editing, reactions and file upload.</li>
<li>We are continuing to work on reactions (emoji picker).</li>
<li>We have started to implement soft logout.</li>
</ul>
</blockquote>
<h3 id="fluffychat">FluffyChat</h3>
<p><a href="https://matrix.to/#/@krille:chat.regionetz.net">krille</a>:</p>
<blockquote>
<p>In the newest update FluffyChat now supports avatars in Push Notifications. Also translations have been updated and some minor design tweaks have been made.</p>
</blockquote>
<p>I know that E2EE for FluffyChat is continuing to be worked on, just not quite ready yet.</p>
<h3 id="continuum-client-based-on-koma">Continuum, client based on koma</h3>
<p><a href="https://matrix.to/#/@uforia:matrix.org">yuforia</a>, author of <a href="https://github.com/koma-im/koma/">koma</a> and <a href="https://github.com/koma-im/continuum-desktop">Continuum</a>:</p>
<blockquote>
<ul>
<li>Update GUI library openjfx from version 11 to 12</li>
<li>Rewrite build script in Kotlin, replacing Groovy</li>
</ul>
</blockquote>
<h3 id="fractal-gnome-client">Fractal, GNOME client</h3>
<p><a href="https://matrix.to/#/@afranke:matrix.org">Alexandre Franke</a> on <a href="https://wiki.gnome.org/Apps/Fractal">Fractal</a>:</p>
<blockquote>
<p>Several bugs were fixed in the past three weeks. We are also sending typing notifications now. With 4.1.1 out, we‚Äôre at the second beta on the way to 4.2.</p>
</blockquote>
<p>Also:</p>
<blockquote>
<p>some people might be interested in a <a href="https://gitlab.gnome.org/GNOME/fractal/commit/fba59402d37525285042f3ad38a577a225105349">tweak in our build config</a> that makes it so that crashes are aborts now (i.e. you get a trace and they are not silent anymore)</p>
</blockquote>
<h3 id="spectral">Spectral</h3>
<p><a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a> is changing Spectral's buildsystem from QMake to CMake.</p>
<h2 id="dept-of-ops">Dept of Ops üõ†</h2>
<h3 id="sendtomatrix-script">sendtomatrix script</h3>
<p><a href="https://matrix.to/#/@madic:geekbundle.org">Madic</a> has created a shell script to send messages to a room:</p>
<blockquote>
<p>I've written a <a href="https://github.com/Madic-/Scripts/tree/master/Linux/sendtomatrix">linux shell script</a> with which you can send (multiline) messages to a matrix room. It only needs a username / password or access token, server fqdn and roomid as argument or provided by a configuration file. Arguments can overwrite settings from the file, for e.g. using same credentials but different channel. If no access token is provided, a new one will be requested and used to send the message. You can use the script for e.g. cronjobs, nagios notifications or ci pipelines. An example for a cronjob and a nagios notification script is also provided.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Madic-/Scripts/master/Linux/sendtomatrix/nagios-notification.png" alt="shell script nagios" /></p>
<p>I have ended up with an similar file of my own containing a bunch of commented-out <code>curl</code> lines, but this is a lot cleaner!</p>
<p>You may also recall a similar project: <a href="https://gitlab.com/darnir/matrix-shell-suite">matrix-shell-suite</a>¬†(<a href="https://matrix.to/#/#matrix-shell-suite:matrix.org">#matrix-shell-suite:matrix.org</a>.)</p>
<h2 id="dept-of-bots-robot-face">Dept of Bots ü§ñ</h2>
<h3 id="maths-bot-s">Maths bot(s)</h3>
<p><a href="https://matrix.to/#/@thosgood:matrix.org">Tim</a> created a bot for rendering Maths:</p>
<blockquote>
<p>I was told that people here might be interested: I just wrote a small bot that can reply with PNG renderings of maths (<a href="https://github.com/thosgood/matrix-maths-bot">https://github.com/thosgood/matrix-maths-bot</a>)</p>
</blockquote>
<p>and then, <a href="https://matrix.to/#/@tulir:maunium.net">tulir</a> <del>blatantly ripped him off</del> was inspired to create a maubot providing the LaTeX to SVG rendering: <a href="https://github.com/maubot/tex">https://github.com/maubot/tex</a></p>
<h2 id="dept-of-services-rocket">Dept of Services üöÄ</h2>
<h3 id="new-room-for-t2bot-io">New room for t2bot.io</h3>
<p><a href="https://github.com/turt2live">TravisR</a>, who arranges and hosts the various bots and bridges on t2bot.io:</p>
<blockquote>
<p><a href="https://matrix.to/#/#news:t2bot.io">#news:t2bot.io</a> is now a room for people who want to follow along with news about t2bot.io which might be missed in <a href="https://matrix.to/#/#help:t2bot.io">#help:t2bot.io</a>. Stuff like when bridges are updated and new services will be announced in there. <a href="https://matrix.to/#/#status:t2bot.io">#status:t2bot.io</a> is where service stability is addressed during major problems with the service.</p>
</blockquote>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know üèÅ</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#TWIM:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;17&#x2F;5-user-matrix-homeserver-hosting-now-available-from-modular&#x2F;" title="5-user Matrix homeserver hosting now available from Modular">5-user Matrix homeserver hosting now available from Modular</a></h1>
            <span>
                17.07.2019 00:00
                ‚Äî
                <a href="/category/general">
                    General
                </a>
                ‚Äî
                <a href="/author/modular-im">
                    Modular.im
                </a>
            </span>
            
        </header>
        <div>
            <p>Hi all,</p>
<p>If you‚Äôve been looking for a way to have you own Matrix homeserver without having to run it yourself, you may be interested to hear that <a href="https://modular.im">Modular</a> (the Matrix hosting provider run by <a href="https://vector.im">New Vector</a>, the startup which hires many of the Matrix core team) is now offering a personal-sized small homeserver hosting service, supporting a minimum size of 5 user servers.</p>
<p>A lot of recent performance work on Synapse has been driven by the need to make smaller dedicated servers more efficient to run - and so if you run your own homeserver you‚Äôll be benefiting from all this work too :)  Meanwhile, if you choose to outsource your server hosting to Modular, you‚Äôll be indirectly supporting core Matrix and Synapse development, given most of the core Matrix team work for New Vector - it‚Äôs through buying services like this which lets us keep folks able to hack on Matrix as their day job.</p>
<p>See more details <a href="https://modular.im/personal-hosted-homeservers">over at the Modular blog post</a>!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;12&#x2F;this-week-in-matrix-2019-07-12&#x2F;" title="This Week in Matrix 2019-07-12">This Week in Matrix 2019-07-12</a></h1>
            <span>
                12.07.2019 00:00
                ‚Äî
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                ‚Äî
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live-riotx">Matrix Live: RiotX</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/eXNBpYOU5gY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Nice! Manu and Benoit, who work on the Riot Mobile, discuss the development status of RiotX.</p>
<h2 id="dept-of-servers-europea">Dept of Servers üè¢</h2>
<h3 id="synapse">Synapse</h3>
<blockquote>
<p>A bit of everything this week, we‚Äôve made changes to support the upcoming edits and reactions release, worked on soft log out, experimented with improving general perf for small homeservers, landed open tracing support, improved db query load.<br />
Next week we‚Äôll see about landing the small homeserver perf improvements, work on id hashing in sydent, fix some e2ee bugs (made easier to track down with OpenTracing), do some more database performance work and start gradually rolling out the new Sygnal instance.</p>
</blockquote>
<h3 id="construct">Construct</h3>
<p>Jason back on it:</p>
<blockquote>
<p>This week in Matrix, <a href="https://github.com/jevolk/charybdis">Construct</a> made the crazy-loading mode of client sync the default. Crazy-loading is an approach to initial sync that goes beyond lazy-loading for a better UX. It's even backwards compatible with clients that don't support lazy-loading.</p>
<p>Construct also made significant progress on implementing version 3 and 4 rooms during the week. This is nearly complete, and should be ready for testing by the weekend.</p>
</blockquote>
<p>Good to know there is progress with new room versions as more and more rooms start to be moved over to v4. <a href="https://matrix.to/#/#zemos-test:matrix.org">#zemos-test:matrix.org</a> for testing and more info.</p>
<h3 id="dendrite">Dendrite</h3>
<blockquote>
<p>This week we‚Äôve implemented profile retrieval over federation, single event retrieval, room tagging as well as host of bug fixes.<br />
Next week we‚Äôll be looking at state resolution and implementing our latest and greatest algorithm needed by modern room versions.</p>
</blockquote>
<h3 id="this-week-in-ruma">This Week in Ruma</h3>
<p><a href="https://matrix.to/#/@jimmycuadra:matrix.org">Jimmy</a> provided <a href="https://www.ruma.io/news/this-week-in-ruma-2019-07-07/">This Week in Ruma</a>:</p>
<blockquote>
<p>Work continues on the major revamp of ruma-events mentioned in the last update.<br />
...<br />
There are also a few modules that are somewhat blocked on an issue in ring. Some of the types in ruma-events contain types from ruma-signatures which don't implement Clone and PartialEq because they contain types from ring which don't.<br />
...<br />
Rust 1.36 was released, and it includes stabilization of the Future trait, one of the long-awaited building blocks for first-class async support in Rust. [...] the biggest reason for Ruma's development hiatus is waiting for async networking in Rust to mature, and this is one of the final pieces of foundational support we've been waiting for. The remaining pieces are async/await syntax, which is expected in either the next version or the one following it, and finally, waiting for important libraries like Hyper and Tokio, as well as web frameworks, to adopt the new stuff.</p>
</blockquote>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks üèó</h2>
<h3 id="libquotient-gets-well-known-support">libQuotient gets .well-known support</h3>
<p><a href="https://matrix.to/#/@kitsune:matrix.org">kitsune</a>:</p>
<blockquote>
<p>Thanks to <a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a>, <a href="https://github.com/quotient-im/libQuotient">libQuotient</a> gained support of .well-known - a very useful feature to connect to Modular-hosted homeservers!</p>
<p>Also, the first block of E2EE functionality from <a href="https://matrix.to/#/@aa13q:matrix.org">aa13q</a> has been merged to libQuotient master - so far it's just uploading the keys but receiving messages is already well in the works!</p>
</blockquote>
<h2 id="dept-of-bridges-bridge-at-night">Dept of Bridges üåâ</h2>
<h3 id="mautrix-telegram-v0-6-0">mautrix-telegram v0.6.0</h3>
<p><a href="https://matrix.to/#/@tulir:maunium.net">tulir</a>:</p>
<blockquote>
<p><a href="https://github.com/tulir/mautrix-telegram">mautrix-telegram</a> v0.6.0 was released. Recent changes include bridging strikethrough, underline and nested formatting to telegram and some bug fixes, including one security fix. <a href="https://github.com/tulir/mautrix-telegram/releases/tag/v0.6.0">Full changelog on GitHub</a>.</p>
<p>Debian 10 was also released recently, which means v0.6 is the last version with Python 3.5 support. Starting from v0.7.0, mautrix-telegram will only support Python 3.6 and up.</p>
</blockquote>
<p><a href="https://github.com/tulir/mautrix-telegram">mautrix-telegram</a> v0.6.0 also includes Native Matrix edit support, message editing between platforms.</p>
<h3 id="matrix-appservice-slack-0-3-0-rc2">matrix-appservice-slack 0.3.0-rc2</h3>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> and the Slack-bridge-gang have announced <a href="https://github.com/matrix-org/matrix-appservice-slack/tree/release-0.3.0">matrix-appservice-slack 0.3.0-rc2</a></p>
<blockquote>
<p>Hi folks, <a href="https://github.com/matrix-org/matrix-appservice-slack">the slack bridge</a> has had another RC release this week 0.3.0-rc2 which has been deployed onto matrix.org :). In other news, we are nearly done with the port of the bridge to Typescript (slated for the 0.4 release) which has allowed us to clean up the codebase significantly and <strong>splat</strong> a lot of bugs.</p>
</blockquote>
<p>I'm for any movement toward TypeScript - seems to be a winner in the JS-world. Says Half-Shot:</p>
<blockquote>
<p>I'm a bit fanatical about Typescript, it's objectively better to write things in TS than JS if you have the freedom to do so. It's also allowed us to keep the bug count down on the <a href="https://github.com/Half-Shot/matrix-appservice-discord">Discord bridge</a>, so I'm starting to look at the other bridges for typescript support too.</p>
</blockquote>
<h3 id="reliable-bridges-gsoc-project-mortar-board">Reliable Bridges GSoC project üéì</h3>
<p>Thanks <a href="https://matrix.to/#/@kai:nasnotfound.de">Kai</a> for this update!</p>
<blockquote>
<p>The new Spec proposal <a href="https://github.com/matrix-org/matrix-doc/pull/2162">MSC2162: Signaling Errors at Bridges</a> landed! It is about adding permanent errors: The ability of bridges to mark events as not delivered to all participants. While there is already code supporting the feature, the Spec process is important for getting everyone on board and finding potential problems with the current approach.</p>
<p>In spite of being a relatively small proposal, there were already a lot of suggestions and directions in which it can evolve. Shoutout and thanks to everyone who already contributed to it with their comments!</p>
<p>Meanwhile on the more practical front a <a href="https://github.com/V02460/matrix-react-sdk/tree/reliable_riot">fork of Riot Web</a> was extended to now support the actual visual display of bridge error markings on messages.</p>
</blockquote>
<p>See it in action:</p>
<p><img src="/blog/img/2019-05-12-bridge_error.png" alt="Bridge Error message" /></p>
<h2 id="dept-of-clients-iphone">Dept of Clients üì±</h2>
<h3 id="riotx-big-announcement">RiotX big announcement!</h3>
<blockquote>
<ul>
<li>We have released a beta version to the PlayStore on Thursday! You can download (and rate it) here: https://play.google.com/store/apps/details?id=im.vector.riotx . Also feel free to join https://matrix.to/#/#riotx:matrix.org to provide any feedback!</li>
<li>You will find more details about what RiotX can (and cannot yet) do here: https://medium.com/@RiotChat/introducing-the-riotx-beta-for-android-b17952e8f771</li>
<li>Now we are working on fixing bugs, and keep going implementing the missing features</li>
</ul>
</blockquote>
<p>I've been using RiotX a lot lately and find it great - really snappy.</p>
<h3 id="spectral">Spectral</h3>
<p><a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a>:</p>
<blockquote>
<p><a href="https://gitlab.com/spectral-im/spectral">Spectral</a> supports .well-known now obviously. <em>see <a href="https://github.com/quotient-im/libQuotient">libQuotient</a> update above</em><br />
Also a lot of changes:</p>
<ol>
<li>Bubble shapes for pending events are fixed.</li>
<li>You can set device name when logging in. This becomes important as libQuotient begins to upload one-time device key as part of E2EE implementation.</li>
<li>Markdown is parsed automatically by default, and works with replies.</li>
<li>Small UI improvements in timeline and room list.</li>
</ol>
</blockquote>
<h3 id="continuum">Continuum</h3>
<p><a href="https://matrix.to/#/@uforia:matrix.org">yuforia</a> has continued work on <a href="https://github.com/koma-im/continuum-desktop">Continuum</a>, a desktop client written in Kotlin:</p>
<blockquote>
<p>Continuum now preserves media content URI (mxc://) internally in order to treat them specially, instead of converting to all URI to http (or https) upon receiving.<br />
This week's version never considers cached mxc resources stale and no network request will be performed for refreshing.<br />
Continuum also loads previews for http image links in text messages automatically. The usual http cache control rules are still followed in those cases.</p>
</blockquote>
<p>Join <a href="https://matrix.to/#/#tkmc:matrix.org">#tkmc:matrix.org</a> to chat more about Continuum, or about <a href="https://github.com/koma-im/koma/">koma</a>, the underlying library.</p>
<h3 id="riot-web">Riot Web</h3>
<blockquote>
<p>Riot v1.3.0-rc.1 is now ready for testing at <a href="https://riot.im/staging">https://riot.im/staging</a>. This includes some last minute polish of reactions and edits, and also adds initial support for soft logout. This release will have reactions and message editing enabled via configuration on riot.im once it stabilises.<br />
Self-hosted installs that wish to do the same would need to alter their config.json in similar fashion. This is because these features currently depend on unstable APIs, and we don't want to move them out of labs and fully on by default until that is resolved.</p>
</blockquote>
<h3 id="riot-ios">Riot iOS</h3>
<blockquote>
<ul>
<li>Reactions and edits:
<ul>
<li>Enabled by default (no more LABS setting)</li>
<li>Reactions with non-unicode keys</li>
<li>Original event in the edit history (need homeserver update)</li>
</ul>
</li>
<li>Upgraded rooms are now autojoined when tapping on the upgraded banner</li>
<li>File upload from the room screen and from the share extension</li>
<li>Crypto: logs have been improved and a script has been created to help to debug e2e bugs (see the screenshot at <a href="https://github.com/matrix-org/matrix-ios-sdk/pull/692">https://github.com/matrix-org/matrix-ios-sdk/pull/692</a>)</li>
<li>This Friday TestFlight can be considered as a release candidate</li>
</ul>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops üõ†</h2>
<h3 id="matrix-docker-ansible-deploy-synapse-janitor-now-available">matrix-docker-ansible-deploy: synapse-janitor now available</h3>
<p><a href="https://matrix.to/#/@slavi:devture.com">Slavi</a>:</p>
<blockquote>
<p>Thanks to <a href="https://matrix.to/#/@aaron:raim.ist">Aaron</a>'s frequent mention of <a href="https://github.com/xwiki-labs/synapse_scripts">synapse-janitor</a> and other such cleanup methods, I've finally gotten inspired enough to give it a try.</p>
<p>The playbook now contains a new <strong>Synapse Maintenance</strong> documentation page and an easy/safe way to run <a href="https://github.com/xwiki-labs/synapse_scripts">synapse-janitor</a>.</p>
<p>To give an example, using <a href="https://github.com/xwiki-labs/synapse_scripts">synapse-janitor</a> and a full Postgres <code>VACUUM</code> yielded a 29% reduction in disk space used by Postgres on my personal homeserver (5.3GB -&gt; 3.8GB).</p>
</blockquote>
<p><a href="https://matrix.to/#/@murz:ru-matrix.org">Alexey Murz Korepov</a> also reminded us about <a href="https://github.com/djmaze/synapse-purge">synapse-purge</a>, which we've mentioned here before - but is designed for a similar purpose.</p>
<h3 id="avhost-docker-matrix">avhost/docker-matrix</h3>
<p><a href="https://matrix.to/#/@mathijs:matrix.vgorcum.com">Mathijs</a>:</p>
<blockquote>
<p>the <a href="https://hub.docker.com/r/avhost/docker-matrix/tags">avhost/docker-matrix</a> image has moved to a debian buster base image, which got us an upgrade from python 3.5 to python 3.7.3 and jemalloc1 to jemalloc2, which should improve the performance of synapse.</p>
</blockquote>
<h2 id="dept-of-articles-memo">Dept of Articles üìù</h2>
<p><a href="https://matrix.to/#/@kevin:potatofrom.space">Pneumaticat</a>: &quot;wrote a <a href="https://blog.scintillating.us/2019/07/11/the-making-of-delphus-chat-matrix-ethereum-end-to-end-encryption/">blog post on integrating Riot chat with our dapp &amp; scientific research auditing platform, Delphus</a>!&quot;</p>
<h2 id="final-thoughts-thought-balloon">Final thoughts üí≠</h2>
<p>I had/stole the idea to create a bot which uses message edits to send frames of an ASCII-art animation. I indeed created the bot, which works to a degree, but is quickly punished by rate-limiting, which limits the effectiveness. Still it's quite fun, you can <a href="https://github.com/benparsons/matrix-ascii-bot">check out the code here</a>.</p>
<p><a href="https://github.com/turt2live">TravisR</a>'s work on <a href="https://github.com/turt2live/matrix-bot-sdk">matrix-bot-sdk</a> is interesting for bot or other client devs, and there is a new guide available: <a href="http://matrix.org/docs/guides/usage-of-matrix-bot-sdk">http://matrix.org/docs/guides/usage-of-matrix-bot-sdk</a></p>
<p>A few weeks ago I mentioned <a href="https://play.matrix.org/matrix-enact/">matrix-enact</a>, which uses Web Audio API to play back room history. There is a guide to how it was built, looking at the <code>/context</code> endpoint now available: <a href="https://matrix.org/docs/guides/creating-a-simple-read-only-matrix-client">https://matrix.org/docs/guides/creating-a-simple-read-only-matrix-client</a></p>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> &quot;bridged <a href="https://matrix.to/#/#synapse:matrix.org">#synapse:matrix.org</a> to #matrix-synapse on freenode to help folks who might be experiencing issues with their homeserver and need a IRC based support channel&quot;</p>
<p><a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a> made a cool-looking thing: &quot;It basically shows all pictures in <a href="https://matrix.to/#/#TWIM:matrix.org">this room</a> in a waterfall, with 'infinite scroll'&quot;</p>
<p><img src="/blog/img/2019-05-12-waterfall.png" alt="Bridge Error message" /></p>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know üèÅ</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#TWIM:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;05&#x2F;this-week-in-matrix-2019-07-05&#x2F;" title="This Week in Matrix 2019-07-05">This Week in Matrix 2019-07-05</a></h1>
            <span>
                05.07.2019 00:00
                ‚Äî
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                ‚Äî
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live-featuring-erik-and-the-interns">Matrix Live, featuring Erik and the Interns üéô</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/qPIZSarU9zE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Thanks Erik, Jorik and Oliver!</p>
<p>Note that there is a audio hiccup around 2m30 - video is ok otherwise.</p>
<h2 id="dept-of-spec-scroll">Dept of Spec üìú</h2>
<h3 id="highlights">Highlights</h3>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140: Terms of Service for ISes and IMs</a>
<ul>
<li>Largely complete</li>
</ul>
</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2134">MSC2134: Identity Hash Lookups</a>
<ul>
<li>Largely complete</li>
<li>Going ahead with the simple hash lookup method</li>
</ul>
</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2154">Matthew/msc1849 rewrite</a>
<ul>
<li>Rewrite of the <a href="https://github.com/matrix-org/matrix-doc/pull/1849">Proposal for m.relates_to aggregations</a> MSC with new updates</li>
</ul>
</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2153">MSC2153: Add a default push rule to ignore m.reaction events</a>
<ul>
<li>Will help prevent ghost notifications appearing when a reaction is the last event in the room</li>
</ul>
</li>
</ul>
<h3 id="movement-on-matrix-uris">Movement on Matrix URIs</h3>
<p>Sudden interest in <a href="https://github.com/matrix-org/matrix.to/pull/47">matrix-org/matrix.to/pull#47</a> means we're getting a lot closer to agreement on Matrix URIs. <a href="https://matrix.to/#/@kitsune:matrix.org">Kitsune</a> even added support for them in <a href="https://github.com/QMatrixClient/Quaternion">Quaternion</a> (see below).</p>
<h2 id="dept-of-servers-europea">Dept of Servers üè¢</h2>
<h3 id="dendrite">Dendrite</h3>
<p><a href="https://matrix.to/#/@andrewm:amorgan.xyz">anoa</a>:</p>
<blockquote>
<p>Dendrite continues marching forward! As more attention is turned towards our fairly lengthy PR list, contributors who have not done so already are reminded to merge Dendrite's master branch into their PRs, as converting the project to go modules caused a lot of conflicts. A tag has been added to each PR that needs forward merging, <a href="https://github.com/matrix-org/dendrite/pulls?q=is%3Apr+is%3Aopen+label%3Aneeds-merge-foward">visible here</a>.</p>
<p>Our GSoC student <a href="https://matrix.to/#/@cnly:matrix.org">cnly</a> has been working away on <a href="https://github.com/matrix-org/dendrite/pull/726">implementing profile retrieval over federation</a> as well as updating his <a href="https://github.com/matrix-org/dendrite/pulls/Cnly">various other PRs</a> and would likely have a lot more if they were getting more reviews, but worry not as things look on track for that next week.</p>
<p>We've also got plans now! Plans for how to properly ship this thing over the coming months so look out for that soon!</p>
</blockquote>
<h3 id="synapse-1-1-0-released">Synapse 1.1.0 released</h3>
<blockquote>
<p>This week we <a href="https://matrix.org/blog/2019/07/04/synapse-1-1-0-released">shipped v1.1.0</a>, which provides an overhaul of docker configuration, more authentication options and improved db io. It‚Äôs worth noting that v1.1.0 is the first Synapse release to drop support for Python 2 (and Postgres 9.4), this paves the way for using Python 3 only functionality.</p>
<p>We‚Äôve been working on supporting soft logout, more edits and reactions support, open tracing support not to mention a complete rewrite of the push server Sygnal. We‚Äôll be rolling out new Sygnal gradually over the next week or two.</p>
<p>Finally, aided by dropping Python 2 support, we‚Äôve been putting in a bunch of work to improve Synapse in resource constrained environments. This will be a constant theme over the coming months.</p>
</blockquote>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks üèó</h2>
<h3 id="python-matrixbot">python-matrixbot</h3>
<p><a href="https://matrix.to/#/@blacksam:matrix.gibberfish.org">Brian √ì</a> appeared to tell us about <a href="https://pypi.org/project/python-matrixbot/">python-matrixbot</a>. This is a project that has existed for some time.</p>
<blockquote>
<p>A Python module meant to act as a base class for a Matrix bot.<br />
The MatrixBot class will connect to the Matrix server, start a listener on each joined room, and listen for room invites from other users. It also includes helper methods you can use to extend the functionality. It is built on the <a href="https://github.com/matrix-org/matrix-python-sdk">Matrix Python SDK</a> which can be directly accessed via MatrixBot.client</p>
</blockquote>
<h3 id="koma">koma</h3>
<p><a href="https://matrix.to/#/@uforia:matrix.org">yuforia</a>:</p>
<blockquote>
<p><a href="https://github.com/koma-im/koma-library">koma</a> got some improvements, based on what's learned developing Continuum, which is a desktop client based on it.</p>
<ul>
<li>Make api calls suspendable functions (which are like Kotlin's flavor of async). This way, the caller don't need to worry about forgetting to call await or a coroutine being left unstarted.</li>
<li>Borrowing from functional programming, model the outcome of a call as a discriminated union, which can be either a success or a failure. The successful case is optimized with inline classes, an experimental feature in Kotlin 1.3, and wrapping is avoided.</li>
<li>Make MatrixError a subclass of HttpError, because the http status code can be handy</li>
</ul>
</blockquote>
<h3 id="ruby-sdk">Ruby SDK</h3>
<p><a href="https://github.com/ananace/">Ananace</a>:</p>
<blockquote>
<p>Just released version 1.2.1 of the <a href="https://github.com/ananace/ruby-matrix-sdk">Ruby SDK</a>, fixing an error in the media download URL generation</p>
</blockquote>
<h2 id="dept-of-bridges-bridge-at-night">Dept of Bridges üåâ</h2>
<h3 id="matrix-appservice-bridge-release-1-9-0">matrix-appservice-bridge release 1.9.0</h3>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> was seen to exist IRL this week, he also found time for a new release:</p>
<blockquote>
<p>Today we have a new <a href="https://github.com/matrix-org/matrix-appservice-bridge/releases/tag/1.9.0">matrix-appservice-bridge release 1.9.0</a>. The bigname feature this week is a new store for mapping matrix events to remote ones, so bridges can handle changes made to sent events like reactions/threading/edits/redactions :). The reason for this feature appearing suddenly will become clear very soon.. üòà</p>
</blockquote>
<h3 id="mx-puppet-bridge-inc-slack-tox-discord">mx-puppet-bridge (inc slack, tox, discord)</h3>
<blockquote>
<p>Another week, which means more work on the mx-puppet-bridge ecosystem! A new &gt; bridge has been added, mx-puppet-discord. Soru finally added license files &gt; (Apache-2-0) and some readmes.</p>
<h4 id="mx-puppet-bridge"><a href="https://github.com/Sorunome/mx-puppet-bridge">mx-puppet-bridge</a></h4>
<ul>
<li>bugfixes</li>
<li>implement optional double-puppeting (also logging into your matrix acc)</li>
<li>relate remote event IDs to matrix event IDs</li>
<li>handle edits in both directions</li>
<li>handle redactions in both directions</li>
<li>initiating conversations from matrix! Invite a ghost for 1:1 or follow a &gt; room alias for rooms</li>
<li>bot provisioning: list users and rooms</li>
</ul>
<h4 id="mx-puppet-slack"><a href="https://github.com/Sorunome/mx-puppet-bridge">mx-puppet-slack</a></h4>
<ul>
<li>add linting</li>
<li>map channels and slack pills</li>
<li>handle message edits</li>
<li>handle message deletions</li>
<li>properly handle /me messages</li>
<li>handle ghost invites</li>
<li>handle room joins via alias</li>
</ul>
<h4 id="mx-puppet-tox"><a href="https://github.com/Sorunome/mx-puppet-tox">mx-puppet-tox</a></h4>
<ul>
<li>add linting</li>
<li>improve bootstrapping</li>
<li>improve file transfers</li>
<li>handle ghost invites</li>
</ul>
<h4 id="mx-puppet-discord"><a href="https://github.com/matrix-discord/mx-puppet-discord">mx-puppet-discord</a></h4>
<p>This is the new puppeting bridge! The idea is that, in the long run, this will &gt; be run in conjunction with <a href="https://github.com/">matrix-appservice-discord</a> Half-Shot/matrix-appservice-discord), where mx-puppet-discord handles DM &gt; puppeting and matrix-appservice-discord the remaining. For this, the message &gt; parsing was split in a new repository, <a href="https://github.com/matrix-discord/matrix-discord-parser">matrix-discord-parser</a>. The idea is that, in the &gt; future, when inviting a ghost on matrix-appservice-discord it'll initiate &gt; conversation within mx-puppet-discord</p>
<ul>
<li>basic text messages</li>
<li>handle files</li>
<li>handle edits, deletes</li>
</ul>
<p>mx-puppet-discord does only DMs, for non-DMs please use matrix-appservice-discord</p>
<p>If you have any questions for any of these, please join our channel &gt; <a href="https://matrix.to/#/#mx-puppet-bridge:sorunome.de">#mx-puppet-bridge:sorunome.de</a>. Software doesn't write itself, please consider &gt; <a href="https://liberapay.com/Sorunome/donate">donating on liberapay</a>!</p>
</blockquote>
<h3 id="matrix-appservice-slack">matrix-appservice-slack</h3>
<p><a href="https://matrix.to/#/@cadair:cadair.com">Cadair</a> and <a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> have been doing substantial work on <a href="https://github.com/matrix-org/matrix-appservice-slack">matrix-appservice-slack</a>.</p>
<blockquote>
<p>We've got a dedicated room for slack bridge development over at <a href="https://matrix.to/#/#matrix_appservice_slack:cadair.com">#matrix_appservice_slack:cadair.com</a>, since it's picked up in terms of community PRs and general interest. It's not currently being used as a support room, however.</p>
</blockquote>
<p>They mention,</p>
<blockquote>
<p>warning may contain ranting about the codebase</p>
</blockquote>
<p>But that could be any room, so it seems ok to me.</p>
<p><code>WARNING: LATE ADDITION</code></p>
<blockquote>
<p>Hi everyone! <a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Myself</a> and <a href="https://matrix.to/#/@cadair:cadair.com">Cadair</a> have been working hard on a new Slack bridge release, and we are finally ready to push out a release candidate for <strong>0.3</strong>.</p>
<p>The headline features are:</p>
<ul>
<li>Implement message deletion.</li>
<li>Add support for edits.</li>
<li>Add support for reactions.</li>
<li>Add support for threading (using replies).</li>
<li>Support displayname and avatar lookups for Slack bots.</li>
<li>Replace channel mentions with canonical aliases for bridged rooms.</li>
<li>Support for slack attachments (Thanks @umitalp for the initial groundwork and @Cadair for the cleanup)</li>
</ul>
<p>The new release is having very final minute checks, and will be available at <a href="https://github.com/matrix-org/matrix-appservice-slack/releases">https://github.com/matrix-org/matrix-appservice-slack/releases</a> shortly.</p>
</blockquote>
<h2 id="dept-of-clients-iphone">Dept of Clients üì±</h2>
<h3 id="riotx-android">RiotX (Android)</h3>
<blockquote>
<p>After an internal release, we are working on improving the performance, especially for initial sync and for navigation between rooms.<br />
Also we are fighting bugs.</p>
</blockquote>
<h3 id="pattle-0-9-0-and-testflight-available">Pattle 0.9.0 and Testflight available</h3>
<p><a href="https://matrix.to/#/@wilko:matrix.org">Wilko</a>:</p>
<blockquote>
<p>A new version of Pattle has been pushed to F-droid and TestFlight!</p>
<p>Changes:</p>
<ul>
<li>Fix the infamous <code>FormatException: Not a valid url: </code> error!</li>
<li>Room upgrades are now handled!
<ul>
<li>Upgraded rooms are now hidden from the overview</li>
<li>To access older messages from the previous room, simply scroll up: the timeline is seamless</li>
</ul>
</li>
<li>Improve performance of loading the overview.
Opening the app should be a lot quicker now!</li>
<li>Improve performance of loading a chat</li>
<li>Add ability to swipe through images in a chat (thanks to Nathan van Beelen!)
<a href="https://git.pattle.im/pattle/app/raw/v0.9.0/CHANGELOG/0.9.0.webm"><strong>See preview here!</strong></a></li>
</ul>
</blockquote>
<p>Get Pattle from F-droid for Android by adding this repo:</p>
<p><code>https://fdroid.pattle.im/?fingerprint=E91F63CA6AE04F8E7EA53E52242EAF8779559209B8A342F152F9E7265E3EA729</code></p>
<p>APK also in assets of this release.</p>
<p>For iOS: <a href="https://testflight.apple.com/join/uTytydST">join TestFlight here</a></p>
<p>Report issues to <a href="https://git.pattle.im/pattle/app/issues">the repo</a>, you can <a href="https://git.pattle.im/users/sign_in">login via GitHub and Gitlab.com</a>.</p>
<blockquote>
<p>Follow development in <a href="https://matrix.to/#/#app:pattle.im">#app:pattle.im</a>!</p>
</blockquote>
<p>To support Wilko: you can now do so via <a href="https://liberapay.com/wilko/">Liberapay</a> and <a href="https://www.patreon.com/pattle_app">Patreon</a>.</p>
<blockquote>
<p>I've invested a lot of money in making Pattle happen
on iOS: MacBook, Apple Developer Program, and an iPhone.
Pretty costly, so any donations will be greatly appreciated!</p>
<p>What to expect in the next release:</p>
<ul>
<li>Fix timeline jump issues</li>
<li>Remove redundant state messages when a room is upgraded</li>
<li>Start work on chat details screen (members, change name, etc.)</li>
</ul>
</blockquote>
<h3 id="quaternion-now-with-matrix-uri-support">Quaternion now with Matrix URI support</h3>
<p><a href="https://matrix.to/#/@kitsune:matrix.org">kitsune</a>:</p>
<blockquote>
<p>to push things forward on Matrix URIs front, <a href="https://github.com/QMatrixClient/Quaternion">Quaternion</a> master branch now supports matrix:user/userid, matrix:room/roomalias and matrix:roomid/roomid URIs. For example, Quotient/Quaternion room can be opened by a link <a href="matrix:room/quotient:matrix.org">matrix:room/quotient:matrix.org</a>.</p>
</blockquote>
<p>This will be so much easier to use! Also:</p>
<blockquote>
<p>Quaternion has got a new contributor, Roland Pallai (https://github.com/rpallai), who added colouring of messages sent by the local user and support of drag-n-drop of text and images on <a href="https://github.com/QMatrixClient/Quaternion">Quaternion</a>, along with general improvements on the timeline. Many thanks!</p>
<p>Windows builds of Quaternion (CI and future releases) come with Qt Keychain enabled, storing your access tokens in Windows secure storage.</p>
</blockquote>
<h3 id="spectral-news">Spectral news</h3>
<p><a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a>:</p>
<blockquote>
<p>A lot of improvements have been added to <a href="https://gitlab.com/spectral-im/spectral">Spectral</a> last week.</p>
<ol>
<li>Spectral uses QtKeychain now. Access tokens are stored in system keychain instead of in plain text.</li>
<li>Room list's filter has a better UX(aka TabBar). Switching between rooms and DMs is now as easy as switching between, well, tabs.</li>
<li>Notification count in system tray icon, implementation modified from nheko.</li>
<li>Display initial sync progress. Some people have been complaining about not knowing the progress of initial sync so I added an indicator.</li>
<li>A <em>better</em> room setting page. Specifically displaying aliases and changing room avatar are working.</li>
<li>Big emojis.</li>
<li>Typing indicator UI is tweaked and looks better.</li>
</ol>
</blockquote>
<h3 id="riot-ios">Riot iOS</h3>
<blockquote>
<ul>
<li>Reactions in e2e rooms</li>
<li>‚ÄúShow all‚Äù button when there are too many reactions</li>
<li>Support edition of emotes and replies</li>
<li>Edits history (even in e2e rooms)</li>
<li>Fix joining new upgraded room through federation</li>
<li>Use via parameters to join a new room (useful in case of federation)</li>
</ul>
</blockquote>
<h3 id="riot-web">Riot Web</h3>
<blockquote>
<ul>
<li>Allow resending edits, reactions and redactions through context menu, also better visualization of send errors.</li>
<li>Allow redacting and viewing source of edits in edit history dialog</li>
</ul>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops üõ†</h2>
<h3 id="k8s">K8s</h3>
<p><a href="https://github.com/ananace/">Ananace</a>:</p>
<blockquote>
<p>Bumped the <a href="https://github.com/ananace/matrix-synapse">K8s optimized Docker image</a> to 1.1.0, with the same dropping of Python 2 and Postgres 9.4 support as the official image.<br />
NB: The upstream docker configuration changes do not affect the K8s-optimized image, no configuration change is necessary to upgrade from 1.0.0 to 1.1.0</p>
</blockquote>
<h3 id="avhost-docker-matrix-image">avhost/docker-matrix image</h3>
<p><a href="https://matrix.to/#/@mathijs:matrix.vgorcum.com">Mathijs</a>:</p>
<blockquote>
<p>As announced last week, with the release of synapse 1.1.0 the <a href="https://hub.docker.com/r/avhost/docker-matrix">avhost/docker-matrix image</a> switched to running synapse with jemalloc by default</p>
</blockquote>
<h2 id="dept-of-services-rocket">Dept of Services üöÄ</h2>
<h3 id="modular-im-starting-to-make-small-instances-available">modular.im starting to make Small instances available</h3>
<p><a href="https://www.modular.im/">modular.im</a> are making the <em>much-asked-for</em> SMALL instances available. This service is rolling out starting with people who have previously enquired about availability, which I gather is a lot of people. Go sign up if you're interested!</p>
<blockquote class="twitter-tweet" data-cards="hidden" data-lang="en"><p lang="en" dir="ltr">The wait is almost over ... We&#39;re now rolling out our trial of Small Hosted Homeservers for Matrix. Have you got your golden ticket yet? üòÄüéüÔ∏è <a href="https://t.co/iUkAIHW9MY">pic.twitter.com/iUkAIHW9MY</a></p>&mdash; Modular (@ModularIM) <a href="https://twitter.com/ModularIM/status/1146477464488730624?ref_src=twsrc%5Etfw">July 3, 2019</a></blockquote>
<blockquote>
<p>we've been working on a v1 admin dashboard for managing your Synapse instances through Modular. This is now live on the site and provides a basic suite of functionality including:</p>
<ul>
<li>Viewing users of your synapse homeserver(s)</li>
<li>Creating users</li>
<li>Deleting users</li>
<li>Resetting user passwords</li>
<li>Viewing user profile and server access / activity</li>
<li>Sending messages to all system users as the system alerts user</li>
<li>Information about the synapse instance versions</li>
</ul>
</blockquote>
<h2 id="final-thoughts-thought-balloon">Final thoughts üí≠</h2>
<p><a href="https://github.com/ananace/">Ananace</a> is &quot;continuing the rewrite of <a href="https://github.com/ananace/matrix-releasetracker">the release tracker project</a>. Working towards getting it to only store state in Matrix so it can be run in a read-only environment like a K8s deployment.&quot;</p>
<p><a href="https://matrix.to/#/@lino:m.l1f.de">lino</a> &quot;wrote a <a href="https://github.com/l1f/riot-console/blob/master/riot.py">script to update riot</a>. It also works so far, but still needs some improvements&quot;</p>
<p><a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a> has been working &quot;to add .well-known support for <a href="https://github.com/quotient-im/libQuotient">libQuotient</a>&quot; - presumably this will come back to be used in <a href="https://gitlab.com/spectral-im/spectral">Spectral</a> when it's ready.</p>
<p>Somehow I had a tab open with a <a href="https://github.com/dvdgsng/UrbanMaubot">maubot for Urban Dictionary</a>.</p>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know üèÅ</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#TWIM:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;04&#x2F;synapse-1-1-0-released&#x2F;" title="Synapse 1.1.0 released">Synapse 1.1.0 released</a></h1>
            <span>
                04.07.2019 00:00
                ‚Äî
                <a href="/category/releases">
                    Releases
                </a>
                ‚Äî
                <a href="/author/neil-johnson">
                    Neil Johnson
                </a>
            </span>
            
        </header>
        <div>
            <p>Right folks, this is our first post 1.0 release, which means that we have now
officially <a href="https://matrix.org/blog/2019/04/08/synapse-deprecating-postgres-9-4-and-python-2-x">dropped support for Python 2 and Postgres
9.4</a>.
This means that we can start making use of Python 3 specific features and you
should expect lots of associated performance wins over the coming months. See the <a href="https://github.com/matrix-org/synapse/blob/master/UPGRADE.rst#upgrading-to-v110">upgrade notes</a> for more.</p>
<p>Synapse 1.1.0 also contains a reworked approach to the Docker image, as well lots
of performance improvements with special focus on DB IO - expect more to come
in this area.</p>
<p>Special thanks to community member <a href="https://github.com/galexrt">Alexander
Trost</a> for rounding out  our SAML support and also
to <a href="https://github.com/dhoffend">Daniel Hoffend</a> for contributing the ability
to disable local password authentication.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.1.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up <a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.0.0 follows:</p>
<h1 id="synapse-1-1-0-2019-07-04">Synapse 1.1.0 (2019-07-04)</h1>
<p>As of v1.1.0, Synapse no longer supports Python 2, nor Postgres version 9.4.
See the <a href="https://github.com/matrix-org/synapse/blob/master/UPGRADE.rst#upgrading-to-v110">upgrade notes</a> for more details.</p>
<p>This release also deprecates the use of environment variables to configure the
docker image. See the <a href="https://github.com/matrix-org/synapse/blob/release-v1.1.0/docker/README.md#legacy-dynamic-configuration-file-support">docker README</a>
for more details.</p>
<p>No changes since 1.1.0rc2.</p>
<h1 id="synapse-1-1-0rc2-2019-07-03">Synapse 1.1.0rc2 (2019-07-03)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix regression in 1.1rc1 where OPTIONS requests to the media repo would fail. (<a href="https://github.com/matrix-org/synapse/issues/5593">#5593</a>)</li>
<li>Removed the <code>SYNAPSE_SMTP_*</code> docker container environment variables. Using these environment variables prevented the docker container from starting in Synapse v1.0, even though they didn't actually allow any functionality anyway. (<a href="https://github.com/matrix-org/synapse/issues/5596">#5596</a>)</li>
<li>Fix a number of &quot;Starting txn from sentinel context&quot; warnings. (<a href="https://github.com/matrix-org/synapse/issues/5605">#5605</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Update github templates. (<a href="https://github.com/matrix-org/synapse/issues/5552">#5552</a>)</li>
</ul>
<h1 id="synapse-1-1-0rc1-2019-07-02">Synapse 1.1.0rc1 (2019-07-02)</h1>
<p>As of v1.1.0, Synapse no longer supports Python 2, nor Postgres version 9.4.
See the <a href="UPGRADE.rst#upgrading-to-v110">upgrade notes</a> for more details.</p>
<h2 id="features">Features</h2>
<ul>
<li>Added possibility to disable local password authentication. Contributed by Daniel Hoffend. (<a href="https://github.com/matrix-org/synapse/issues/5092">#5092</a>)</li>
<li>Add monthly active users to phonehome stats. (<a href="https://github.com/matrix-org/synapse/issues/5252">#5252</a>)</li>
<li>Allow expired user to trigger renewal email sending manually. (<a href="https://github.com/matrix-org/synapse/issues/5363">#5363</a>)</li>
<li>Statistics on forward extremities per room are now exposed via Prometheus. (<a href="https://github.com/matrix-org/synapse/issues/5384">#5384</a>, <a href="https://github.com/matrix-org/synapse/issues/5458">#5458</a>, <a href="https://github.com/matrix-org/synapse/issues/5461">#5461</a>)</li>
<li>Add --no-daemonize option to run synapse in the foreground, per issue #4130. Contributed by Soham Gumaste. (<a href="https://github.com/matrix-org/synapse/issues/5412">#5412</a>, <a href="https://github.com/matrix-org/synapse/issues/5587">#5587</a>)</li>
<li>Fully support SAML2 authentication. Contributed by <a href="https://github.com/galexrt">Alexander Trost</a> - thank you! (<a href="https://github.com/matrix-org/synapse/issues/5422">#5422</a>)</li>
<li>Allow server admins to define implementations of extra rules for allowing or denying incoming events. (<a href="https://github.com/matrix-org/synapse/issues/5440">#5440</a>, <a href="https://github.com/matrix-org/synapse/issues/5474">#5474</a>, <a href="https://github.com/matrix-org/synapse/issues/5477">#5477</a>)</li>
<li>Add support for handling pagination APIs on client reader worker. (<a href="https://github.com/matrix-org/synapse/issues/5505">#5505</a>, <a href="https://github.com/matrix-org/synapse/issues/5513">#5513</a>, <a href="https://github.com/matrix-org/synapse/issues/5531">#5531</a>)</li>
<li>Improve help and cmdline option names for --generate-config options. (<a href="https://github.com/matrix-org/synapse/issues/5512">#5512</a>)</li>
<li>Allow configuration of the path used for ACME account keys. (<a href="https://github.com/matrix-org/synapse/issues/5516">#5516</a>, <a href="https://github.com/matrix-org/synapse/issues/5521">#5521</a>, <a href="https://github.com/matrix-org/synapse/issues/5522">#5522</a>)</li>
<li>Add --data-dir and --open-private-ports options. (<a href="https://github.com/matrix-org/synapse/issues/5524">#5524</a>)</li>
<li>Split public rooms directory auth config in two settings, in order to manage client auth independently from the federation part of it. Obsoletes the &quot;restrict_public_rooms_to_local_users&quot; configuration setting. If &quot;restrict_public_rooms_to_local_users&quot; is set in the config, Synapse will act as if both new options are enabled, i.e. require authentication through the client API and deny federation requests. (<a href="https://github.com/matrix-org/synapse/issues/5534">#5534</a>)</li>
<li>The minimum TLS version used for outgoing federation requests can now be set with <code>federation_client_minimum_tls_version</code>. (<a href="https://github.com/matrix-org/synapse/issues/5550">#5550</a>)</li>
<li>Optimise devices changed query to not pull unnecessary rows from the database, reducing database load. (<a href="https://github.com/matrix-org/synapse/issues/5559">#5559</a>)</li>
<li>Add new metrics for number of forward extremities being persisted and number of state groups involved in resolution. (<a href="https://github.com/matrix-org/synapse/issues/5476">#5476</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix bug processing incoming events over federation if call to <code>/get_missing_events</code> fails. (<a href="https://github.com/matrix-org/synapse/issues/5042">#5042</a>)</li>
<li>Prevent more than one room upgrade happening simultaneously on the same room. (<a href="https://github.com/matrix-org/synapse/issues/5051">#5051</a>)</li>
<li>Fix a bug where running synapse_port_db would cause the account validity feature to fail because it didn't set the type of the email_sent column to boolean. (<a href="https://github.com/matrix-org/synapse/issues/5325">#5325</a>)</li>
<li>Warn about disabling email-based password resets when a reset occurs, and remove warning when someone attempts a phone-based reset. (<a href="https://github.com/matrix-org/synapse/issues/5387">#5387</a>)</li>
<li>Fix email notifications for unnamed rooms with multiple people. (<a href="https://github.com/matrix-org/synapse/issues/5388">#5388</a>)</li>
<li>Fix exceptions in federation reader worker caused by attempting to renew attestations, which should only happen on master worker. (<a href="https://github.com/matrix-org/synapse/issues/5389">#5389</a>)</li>
<li>Fix handling of failures fetching remote content to not log failures as exceptions. (<a href="https://github.com/matrix-org/synapse/issues/5390">#5390</a>)</li>
<li>Fix a bug where deactivated users could receive renewal emails if the account validity feature is on. (<a href="https://github.com/matrix-org/synapse/issues/5394">#5394</a>)</li>
<li>Fix missing invite state after exchanging 3PID invites over federaton. (<a href="https://github.com/matrix-org/synapse/issues/5464">#5464</a>)</li>
<li>Fix intermittent exceptions on Apple hardware. Also fix bug that caused database activity times to be under-reported in log lines. (<a href="https://github.com/matrix-org/synapse/issues/5498">#5498</a>)</li>
<li>Fix logging error when a tampered event is detected. (<a href="https://github.com/matrix-org/synapse/issues/5500">#5500</a>)</li>
<li>Fix bug where clients could tight loop calling <code>/sync</code> for a period. (<a href="https://github.com/matrix-org/synapse/issues/5507">#5507</a>)</li>
<li>Fix bug with <code>jinja2</code> preventing Synapse from starting. Users who had this problem should now simply need to run <code>pip install matrix-synapse</code>. (<a href="https://github.com/matrix-org/synapse/issues/5514">#5514</a>)</li>
<li>Fix a regression where homeservers on private IP addresses were incorrectly blacklisted. (<a href="https://github.com/matrix-org/synapse/issues/5523">#5523</a>)</li>
<li>Fixed m.login.jwt using unregistered user_id and added pyjwt&gt;=1.6.4 as jwt conditional dependencies. Contributed by Pau Rodriguez-Estivill. (<a href="https://github.com/matrix-org/synapse/issues/5555">#5555</a>, <a href="https://github.com/matrix-org/synapse/issues/5586">#5586</a>)</li>
<li>Fix a bug that would cause invited users to receive several emails for a single 3PID invite in case the inviter is rate limited. (<a href="https://github.com/matrix-org/synapse/issues/5576">#5576</a>)</li>
</ul>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Add ability to change Docker containers <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">timezone</a> with the <code>TZ</code> variable. (<a href="https://github.com/matrix-org/synapse/issues/5383">#5383</a>)</li>
<li>Update docker image to use Python 3.7. (<a href="https://github.com/matrix-org/synapse/issues/5546">#5546</a>)</li>
<li>Deprecate the use of environment variables for configuration, and make the use of a static configuration the default. (<a href="https://github.com/matrix-org/synapse/issues/5561">#5561</a>, <a href="https://github.com/matrix-org/synapse/issues/5562">#5562</a>, <a href="https://github.com/matrix-org/synapse/issues/5566">#5566</a>, <a href="https://github.com/matrix-org/synapse/issues/5567">#5567</a>)</li>
<li>Increase default log level for docker image to INFO. It can still be changed by editing the generated log.config file. (<a href="https://github.com/matrix-org/synapse/issues/5547">#5547</a>)</li>
<li>Send synapse logs to the docker logging system, by default. (<a href="https://github.com/matrix-org/synapse/issues/5565">#5565</a>)</li>
<li>Open the non-TLS port by default. (<a href="https://github.com/matrix-org/synapse/issues/5568">#5568</a>)</li>
<li>Fix failure to start under docker with SAML support enabled. (<a href="https://github.com/matrix-org/synapse/issues/5490">#5490</a>)</li>
<li>Use a sensible location for data files when generating a config file. (<a href="https://github.com/matrix-org/synapse/issues/5563">#5563</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Python 2.7 is no longer a supported platform. Synapse now requires Python 3.5+ to run. (<a href="https://github.com/matrix-org/synapse/issues/5425">#5425</a>)</li>
<li>PostgreSQL 9.4 is no longer supported. Synapse requires Postgres 9.5+ or above for Postgres support. (<a href="https://github.com/matrix-org/synapse/issues/5448">#5448</a>)</li>
<li>Remove support for cpu_affinity setting. (<a href="https://github.com/matrix-org/synapse/issues/5525">#5525</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Improve README section on performance troubleshooting. (<a href="https://github.com/matrix-org/synapse/issues/4276">#4276</a>)</li>
<li>Add information about how to install and run <code>black</code> on the codebase to code_style.rst. (<a href="https://github.com/matrix-org/synapse/issues/5537">#5537</a>)</li>
<li>Improve install docs on choosing server_name. (<a href="https://github.com/matrix-org/synapse/issues/5558">#5558</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Add logging to 3pid invite signature verification. (<a href="https://github.com/matrix-org/synapse/issues/5015">#5015</a>)</li>
<li>Update example haproxy config to a more compatible setup. (<a href="https://github.com/matrix-org/synapse/issues/5313">#5313</a>)</li>
<li>Track deactivated accounts in the database. (<a href="https://github.com/matrix-org/synapse/issues/5378">#5378</a>, <a href="https://github.com/matrix-org/synapse/issues/5465">#5465</a>, <a href="https://github.com/matrix-org/synapse/issues/5493">#5493</a>)</li>
<li>Clean up code for sending federation EDUs. (<a href="https://github.com/matrix-org/synapse/issues/5381">#5381</a>)</li>
<li>Add a sponsor button to the repo. (<a href="https://github.com/matrix-org/synapse/issues/5382">#5382</a>, <a href="https://github.com/matrix-org/synapse/issues/5386">#5386</a>)</li>
<li>Don't log non-200 responses from federation queries as exceptions. (<a href="https://github.com/matrix-org/synapse/issues/5383">#5383</a>)</li>
<li>Update Python syntax in contrib/ to Python 3. (<a href="https://github.com/matrix-org/synapse/issues/5446">#5446</a>)</li>
<li>Update federation_client dev script to support <code>.well-known</code> and work with python3. (<a href="https://github.com/matrix-org/synapse/issues/5447">#5447</a>)</li>
<li>SyTest has been moved to Buildkite. (<a href="https://github.com/matrix-org/synapse/issues/5459">#5459</a>)</li>
<li>Demo script now uses python3. (<a href="https://github.com/matrix-org/synapse/issues/5460">#5460</a>)</li>
<li>Synapse can now handle RestServlets that return coroutines. (<a href="https://github.com/matrix-org/synapse/issues/5475">#5475</a>, <a href="https://github.com/matrix-org/synapse/issues/5585">#5585</a>)</li>
<li>The demo servers talk to each other again. (<a href="https://github.com/matrix-org/synapse/issues/5478">#5478</a>)</li>
<li>Add an EXPERIMENTAL config option to try and periodically clean up extremities by sending dummy events. (<a href="https://github.com/matrix-org/synapse/issues/5480">#5480</a>)</li>
<li>Synapse's codebase is now formatted by <code>black</code>. (<a href="https://github.com/matrix-org/synapse/issues/5482">#5482</a>)</li>
<li>Some cleanups and sanity-checking in the CPU and database metrics. (<a href="https://github.com/matrix-org/synapse/issues/5499">#5499</a>)</li>
<li>Improve email notification logging. (<a href="https://github.com/matrix-org/synapse/issues/5502">#5502</a>)</li>
<li>Fix &quot;Unexpected entry in 'full_schemas'&quot; log warning. (<a href="https://github.com/matrix-org/synapse/issues/5509">#5509</a>)</li>
<li>Improve logging when generating config files. (<a href="https://github.com/matrix-org/synapse/issues/5510">#5510</a>)</li>
<li>Refactor and clean up Config parser for maintainability. (<a href="https://github.com/matrix-org/synapse/issues/5511">#5511</a>)</li>
<li>Make the config clearer in that email.template_dir is relative to the Synapse's root directory, not the <code>synapse/</code> folder within it. (<a href="https://github.com/matrix-org/synapse/issues/5543">#5543</a>)</li>
<li>Update v1.0.0 release changelog to include more information about changes to password resets. (<a href="https://github.com/matrix-org/synapse/issues/5545">#5545</a>)</li>
<li>Remove non-functioning check_event_hash.py dev script. (<a href="https://github.com/matrix-org/synapse/issues/5548">#5548</a>)</li>
<li>Synapse will now only allow TLS v1.2 connections when serving federation, if it terminates TLS. As Synapse's allowed ciphers were only able to be used in TLSv1.2 before, this does not change behaviour. (<a href="https://github.com/matrix-org/synapse/issues/5550">#5550</a>)</li>
<li>Logging when running GC collection on generation 0 is now at the DEBUG level, not INFO. (<a href="https://github.com/matrix-org/synapse/issues/5557">#5557</a>)</li>
<li>Reduce the amount of stuff we send in the docker context. (<a href="https://github.com/matrix-org/synapse/issues/5564">#5564</a>)</li>
<li>Point the reverse links in the Purge History contrib scripts at the intended location. (<a href="https://github.com/matrix-org/synapse/issues/5570">#5570</a>)</li>
</ul>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="&#x2F;blog&#x2F;2019&#x2F;07&#x2F;03&#x2F;usage-of-matrix-nio&#x2F;" title="Usage of matrix-nio (Python Sans IO)">Usage of matrix-nio (Python Sans IO)</a></h1>
            <span>
                03.07.2019 00:00
                ‚Äî
                <a href="/category/tutorials">
                    Tutorials
                </a>
                ‚Äî
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
            </span>
            
        </header>
        <div>
            <p><em>Canonical version of this article at <a href="https://matrix.org/docs/guides/usage-of-matrix-nio">https://matrix.org/docs/guides/usage-of-matrix-nio</a></em></p>
<p>This article concerns <a href="https://github.com/poljar/matrix-nio">matrix-nio</a>, and <a href="https://docs.python.org/3/library/asyncio.html">asyncio</a>. We'll build a simple &quot;echo bot&quot;, meaning a bot which replies to messages with the text it has just read. Note that this article does not cover E2EE with matrix-nio.</p>
<h2 id="instantiation-and-login">Instantiation and Login</h2>
<p>First create a new venv, and install matrix-nio via <code>pip</code>. On the command line, run:</p>
<pre data-lang="sh" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-sh "><code class="language-sh" data-lang="sh"><span>python3 -m venv env
</span><span>source env/bin/activate
</span><span>pip install matrix-nio
</span></code></pre>
<p>Next, create a new Python file, and open it for editing. We'll import everything we require for this tutorial:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#9b9b9b;">from </span><span>importlib </span><span style="color:#9b9b9b;">import </span><span>util
</span><span style="color:#9b9b9b;">import </span><span>asyncio
</span><span style="color:#9b9b9b;">from </span><span>nio </span><span style="color:#9b9b9b;">import </span><span>(AsyncClient, SyncResponse, RoomMessageText)
</span></code></pre>
<p>We're importing asyncio so we can use the <code>AsyncClient</code> class from matrix-nio.</p>
<p>Create a new instance of <code>AsyncClient</code> by passing the homeserver and username as arguments:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>async_client = AsyncClient(
</span><span>    </span><span style="color:#d69d85;">&quot;https://matrix.org&quot;</span><span>, </span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">YOUR-USERNAME-HERE</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">&quot;
</span><span>)
</span></code></pre>
<p>Then login, and await the response:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>response = </span><span style="color:#569cd6;">await </span><span>async_client.login(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">YOUR-PASSWORD-HERE</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">&quot;</span><span>)
</span><span>print(response)
</span></code></pre>
<p>Of course, we are using an async client, and awaiting the response. Because of this, we must call the <code>async_client.login()</code> from an async method, like so:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">async def </span><span>main():
</span><span>    response = </span><span style="color:#569cd6;">await </span><span>async_client.login(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">YOUR-PASSWORD-HERE</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">&quot;</span><span>)
</span><span>    print(response)
</span><span>
</span><span>asyncio.run(main())
</span></code></pre>
<p>Note that for versions of Python before 3.7 the asyncio syntax must be:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">async def </span><span>main():
</span><span>    response = </span><span style="color:#569cd6;">await </span><span>async_client.login(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">YOUR-PASSWORD-HERE</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">&quot;</span><span>)
</span><span>    print(response)
</span><span>
</span><span>loop = asyncio.get_event_loop()
</span><span>loop.run_until_complete(main())
</span></code></pre>
<p>The remainder of this tutorial assumes you are running everything from an <code>async</code> method.</p>
<p>The response string should look like:</p>
<pre data-lang="sh" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-sh "><code class="language-sh" data-lang="sh"><span>Logged in as @pyconweb-bot:matrix.org, device id: ZBLAJHLKVP.
</span></code></pre>
<h2 id="get-into-a-sync-loop">Get into a <code>/sync</code> loop</h2>
<p>To get updates from a Matrix homeserver to the client, the client makes a request to the <code>/sync</code> endpoint. In the matrix-nio AsyncClient, this is wrapped by the <code>sync()</code> method. We can get the latest updates:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>sync_response = </span><span style="color:#569cd6;">await </span><span>async_client.sync(</span><span style="color:#b5cea8;">30000</span><span>)
</span></code></pre>
<p>30000 means we will wait up to 30 seconds before returning. <code>sync_response</code> will now contain a Python object containing a mapping of the (JSON) <a href="https://matrix.org/docs/spec/client_server/latest#get-matrix-client-r0-sync">response from the Matrix homeserver</a>. We'll inspect this response in the next section.</p>
<p>In fact, we expect there to be updates regularly, so let's create a very simple loop:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">while </span><span>(</span><span style="color:#569cd6;">True</span><span>):
</span><span>    sync_response = </span><span style="color:#569cd6;">await </span><span>async_client.sync(</span><span style="color:#b5cea8;">30000</span><span>)
</span><span>    print(sync_response) </span><span style="color:#608b4e;"># note that this could be LARGE!
</span><span>    </span><span style="color:#608b4e;"># do some reading from sync_response
</span></code></pre>
<p>In this way, every time there is a response (i.e. new events) from the homeserver, they are made available in <code>sync_response</code> for processing, and we loop again.</p>
<h2 id="explore-the-sync-response-object">Explore the sync response object</h2>
<p><code>sync_response</code> <a href="https://matrix.org/docs/spec/client_server/latest#get-matrix-client-r0-sync">can contain multitudes</a>, depending on the rooms this user is part of, or has been part of. <code>sync_response.rooms.join</code> contains updates for the rooms which the current user is &quot;joined to&quot; (meaning, is a member of.)</p>
<p>Of these joined rooms, we are (perhaps!) most interested in the events on the timeline. These are stored in <code>timeline.events</code>, see below:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">if </span><span>len(sync_response.rooms.join) &gt; </span><span style="color:#b5cea8;">0</span><span>:
</span><span>
</span><span>    joins = sync_response.rooms.join
</span><span>    </span><span style="color:#569cd6;">for </span><span>room_id </span><span style="color:#569cd6;">in </span><span>joins:
</span><span>        </span><span style="color:#569cd6;">for </span><span>event </span><span style="color:#569cd6;">in </span><span>joins[room_id].timeline.events:
</span><span>            print(event)
</span></code></pre>
<p><em>Message events</em> are a specific type of event which contain an Instant Messenger message. We can check the type before proceeding:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">for </span><span>event </span><span style="color:#569cd6;">in </span><span>joins[room_id].timeline.events:
</span><span>    </span><span style="color:#569cd6;">if </span><span>isinstance(event, RoomMessageText):
</span><span>        print (event.body)
</span></code></pre>
<p>In these cases, where the event is a message to a room, the <code>body</code> field will contain the message text.</p>
<h2 id="isolate-specific-message-event-objects">Isolate specific message event objects</h2>
<p>Knowing that we can get the message text from an event, we can read it to determine a response. Let's make a new variable and have it store some string we'll check for:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>response_string = </span><span style="color:#d69d85;">&quot;!replybot&quot;
</span></code></pre>
<p>Now let's suppose we're in our <code>/sync</code> loop, and just received an event. We can filter messages that are meant for our bot as follows:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">if </span><span>len(sync_response.rooms.join) &gt; </span><span style="color:#b5cea8;">0</span><span>:
</span><span>    joins = sync_response.rooms.join
</span><span>    </span><span style="color:#569cd6;">for </span><span>room_id </span><span style="color:#569cd6;">in </span><span>joins:
</span><span>        </span><span style="color:#569cd6;">for </span><span>event </span><span style="color:#569cd6;">in </span><span>joins[room_id].timeline.events:
</span><span>            </span><span style="color:#569cd6;">if </span><span>hasattr(event, </span><span style="color:#d69d85;">&#39;body&#39;</span><span>) </span><span style="color:#569cd6;">and </span><span>event.body.startswith(response_string):
</span><span>                print(event)
</span></code></pre>
<h2 id="use-room-send">Use <code>room_send</code></h2>
<p>To send messages, matrix-nio provides a <code>room_send()</code> method. There are three arguments:</p>
<ul>
<li>the room_id</li>
<li>the message type, we will use &quot;m.room.message&quot;</li>
<li>a JSON object representing the content of the message</li>
</ul>
<p>Let's improve the example above, by sending back a message to echo the ones we isolated above:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span>joins = sync_response.rooms.join
</span><span style="color:#569cd6;">for </span><span>room_id </span><span style="color:#569cd6;">in </span><span>joins:
</span><span>    </span><span style="color:#569cd6;">for </span><span>event </span><span style="color:#569cd6;">in </span><span>joins[room_id].timeline.events:
</span><span>        </span><span style="color:#569cd6;">if </span><span>hasattr(event, </span><span style="color:#d69d85;">&#39;body&#39;</span><span>) </span><span style="color:#569cd6;">and </span><span>event.body.startswith(response_string):
</span><span>            response_body = event.body.replace(response_string, </span><span style="color:#d69d85;">&quot;&quot;</span><span>).strip()
</span><span>            content = {
</span><span>               </span><span style="color:#d69d85;">&quot;body&quot;</span><span>: response_body,
</span><span>               </span><span style="color:#d69d85;">&quot;msgtype&quot;</span><span>: </span><span style="color:#d69d85;">&quot;m.text&quot;
</span><span>            }
</span><span>            </span><span style="color:#569cd6;">await </span><span>async_client.room_send(room_id, </span><span style="color:#d69d85;">&#39;m.room.message&#39;</span><span>, content)
</span></code></pre>
<p>Now whenever the bot receives a message &quot;!replybot <em>some message</em>&quot; it will send back &quot;some message&quot;.</p>
<h2 id="use-of-sync-next-batch-tokens">Use of /sync next_batch tokens</h2>
<p>Finally, let's consider the importance of <code>next_batch</code> tokens. Whenever you receive a response from the <code>/sync</code> endpoint, the response will contain a &quot;next_batch&quot; field, which you then pass on the next request to ensure you have the latest messages. matrix-nio keeps track of this automatically, so it doesn't get repeated messages. However, when you stop the program and call the <code>.sync()</code> method again, how can you tell it where to start from? First let's get the latest <code>next_batch</code> token:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">async def </span><span>main():
</span><span>    response = </span><span style="color:#569cd6;">await </span><span>async_client.login(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">YOUR-USERNAME-HERE</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">&quot;</span><span>, </span><span style="color:#d69d85;">&quot;&quot;</span><span>)
</span><span>
</span><span>    </span><span style="color:#569cd6;">while </span><span>(</span><span style="color:#569cd6;">True</span><span>):
</span><span>        sync_response = </span><span style="color:#569cd6;">await </span><span>async_client.sync(</span><span style="color:#b5cea8;">30000</span><span>)
</span><span>        print(sync_response.next_batch) </span><span style="color:#608b4e;"># this is the token
</span></code></pre>
<p>Then we'll write the token to a file:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">async def </span><span>main():
</span><span>    response = </span><span style="color:#569cd6;">await </span><span>async_client.login(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">YOUR-USERNAME-HERE</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">&quot;</span><span>, </span><span style="color:#d69d85;">&quot;&quot;</span><span>)
</span><span>
</span><span>    </span><span style="color:#569cd6;">while </span><span>(</span><span style="color:#569cd6;">True</span><span>):
</span><span>        sync_response = </span><span style="color:#569cd6;">await </span><span>async_client.sync(</span><span style="color:#b5cea8;">30000</span><span>)
</span><span>
</span><span>        </span><span style="color:#608b4e;"># we write the token to a file here
</span><span>        </span><span style="color:#569cd6;">with </span><span>open(</span><span style="color:#d69d85;">&quot;next_batch&quot;</span><span>,</span><span style="color:#d69d85;">&quot;w&quot;</span><span>) </span><span style="color:#569cd6;">as </span><span>next_batch_token:
</span><span>            next_batch_token.write(sync_response.next_batch)
</span></code></pre>
<p>Once that token is written, we know we can re-use it for the first <code>/sync/</code> request next time:</p>
<pre data-lang="python" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#569cd6;">async def </span><span>main():
</span><span>    response = </span><span style="color:#569cd6;">await </span><span>async_client.login(</span><span style="color:#d69d85;">&quot;</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">YOUR-USERNAME-HERE</span><span style="color:#b4cea8;">%%</span><span style="color:#d69d85;">&quot;</span><span>, </span><span style="color:#d69d85;">&quot;&quot;</span><span>)
</span><span>
</span><span>    </span><span style="color:#608b4e;"># we read the previously-written token...
</span><span>    </span><span style="color:#569cd6;">with </span><span>open (</span><span style="color:#d69d85;">&quot;next_batch&quot;</span><span>,</span><span style="color:#d69d85;">&quot;r&quot;</span><span>) </span><span style="color:#569cd6;">as </span><span>next_batch_token:
</span><span>        </span><span style="color:#608b4e;"># ... and well async_client to use it
</span><span>        async_client.next_batch = next_batch_token.read()
</span><span>
</span><span>    </span><span style="color:#569cd6;">while </span><span>(</span><span style="color:#569cd6;">True</span><span>):
</span><span>        sync_response = </span><span style="color:#569cd6;">await </span><span>async_client.sync(</span><span style="color:#b5cea8;">30000</span><span>)
</span><span>        </span><span style="color:#569cd6;">with </span><span>open(</span><span style="color:#d69d85;">&quot;next_batch&quot;</span><span>,</span><span style="color:#d69d85;">&quot;w&quot;</span><span>) </span><span style="color:#569cd6;">as </span><span>next_batch_token:
</span><span>            next_batch_token.write(sync_response.next_batch)
</span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>With this, you can see that in very few lines, it's possible to write a working Matrix bot in Python, using <a href="https://github.com/poljar/matrix-nio">matrix-nio</a>.</p>

        </div>
    </article>
    
    <nav class="pagination">
    <div class="prev">
        
        <a href="&#x2F;blog&#x2F;page&#x2F;27&#x2F;">‚Äπ Previous</a>
        
    </div>
    <span class="page-number">28 / 57</span>
    <div class="prev">
        
        <a href="&#x2F;blog&#x2F;page&#x2F;29&#x2F;">Next ‚Ä∫</a>
        
    </div>
</nav>

</div>
    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="&#x2F;code"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>¬© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
