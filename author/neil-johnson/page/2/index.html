<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - Neil Johnson</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <link rel="stylesheet" href="/style.css" />

    
<link rel="alternate" type="application/rss+xml" title="RSS" href="/author/neil-johnson/atom.xml">
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;docs&#x2F;" class="section ">
                Documentation
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                </div>
            </div>
        </div>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;ecosystem&#x2F;" class="section ">
                Ecosystem
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<div id="taxonomy-single">
    <div class="content">
        <header>
            <h1>Neil Johnson</h1>
            64 posts tagged with "Neil Johnson" <a href="/author">(See all Author)</a>
            
        </header>

        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;05&#x2F;19&#x2F;synapse-1-13-0-released&#x2F;" title="Synapse 1.13.0 released">Synapse 1.13.0 released</a></h2>
                <span>
                    19.05.2020 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Synapse 1.13.0 is here and it's a whopper!</p>
<p>Highlights include new support for User Interactive Authentication (UIA) for Single Sign-on (SSO) installations. This means that for the first time features that require the user to re-authenticate are available for servers that authenticate by SSO. Notably this means that these servers now support cross signing!</p>
<p>SSO admins should take a look at the SSO notes in the changelog.</p>
<p>We have been working hard on performance for large scale installations. Anyone supporting more than a few thousand users is probably running Synapse in worker mode. This means splitting out functionality from the master process and making use of multiple cores (or machines) to spread the load. Cross process communication was previously handled by a home grown TCP based replication protocol. As part of our ongoing efforts to improve performance we have replaced this replication system with Redis and have been running Redis in production on matrix.org for the past 2 weeks.</p>
<p>Redis itself does not provide a significant performance win directly but it means that it is much less expensive to add new workers to a cluster. The topology of the old system meant that every additional worker carried a small but not insignificant overhead to the master process. Since moving to Redis we have doubled the number of workers backing matrix.org.</p>
<p>We still consider Redis to be experimental and admins should not feel obliged to upgrade. However it looks very promising and we are likely to deprecate the old replication system in future. So watch this space - Redis is the future.</p>
<p>Finally we've seen lots of improvements to our documentation and many thanks for those in the community making contributions in this area.</p>
<p>It is also worth noting for those of you contributing to Synapse that the <code>develop</code> branch is now the default. More details in the changelog, so take a look.</p>
<p>Get 1.13.0 from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.13.0">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<p>Changelog since v1.12.4</p>
<h1 id="synapse-1-13-0-2020-05-19">Synapse 1.13.0 (2020-05-19)</h1>
<p>This release brings some potential changes necessary for certain configurations of Synapse:</p>
<ul>
<li>If your Synapse is configured to use SSO and have a custom <code>sso_redirect_confirm_template_dir</code> configuration option set, you will need to duplicate the new <code>sso_auth_confirm.html</code>, <code>sso_auth_success.html</code> and <code>sso_account_deactivated.html</code> templates into that directory.</li>
<li>Synapse plugins using the <code>complete_sso_login</code> method of <code>synapse.module_api.ModuleApi</code> should instead switch to the async/await version, <code>complete_sso_login_async</code>, which includes additional checks. The former version is now deprecated.</li>
<li>A bug was introduced in Synapse 1.4.0 which could cause the room directory to be incomplete or empty if Synapse was upgraded directly from v1.2.1 or earlier, to versions between v1.4.0 and v1.12.x.</li>
</ul>
<p>Please review <a href="https://github.com/matrix-org/synapse/blob/master/UPGRADE.rst">UPGRADE.rst</a> for more details on these changes and for general upgrade guidance.</p>
<h2 id="notice-of-change-to-the-default-git-branch-for-synapse">Notice of change to the default <code>git</code> branch for Synapse</h2>
<p>With the release of Synapse 1.13.0, the default <code>git</code> branch for Synapse has changed to <code>develop</code>, which is the development tip. This is more consistent with common practice and modern <code>git</code> usage.</p>
<p>The <code>master</code> branch, which tracks the latest release, is still available. It is recommended that developers and distributors who have scripts which run builds using the default branch of Synapse should therefore consider pinning their scripts to <code>master</code>.</p>
<h2 id="features">Features</h2>
<ul>
<li>Extend the <code>web_client_location</code> option to accept an absolute URL to use as a redirect. Adds a warning when running the web client on the same hostname as homeserver. Contributed by Martin Milata. (<a href="https://github.com/matrix-org/synapse/issues/7006">#7006</a>)</li>
<li>Set <code>Referrer-Policy</code> header to <code>no-referrer</code> on media downloads. (<a href="https://github.com/matrix-org/synapse/issues/7009">#7009</a>)</li>
<li>Add support for running replication over Redis when using workers. (<a href="https://github.com/matrix-org/synapse/issues/7040">#7040</a>, <a href="https://github.com/matrix-org/synapse/issues/7325">#7325</a>, <a href="https://github.com/matrix-org/synapse/issues/7352">#7352</a>, <a href="https://github.com/matrix-org/synapse/issues/7401">#7401</a>, <a href="https://github.com/matrix-org/synapse/issues/7427">#7427</a>, <a href="https://github.com/matrix-org/synapse/issues/7439">#7439</a>, <a href="https://github.com/matrix-org/synapse/issues/7446">#7446</a>, <a href="https://github.com/matrix-org/synapse/issues/7450">#7450</a>, <a href="https://github.com/matrix-org/synapse/issues/7454">#7454</a>)</li>
<li>Admin API <code>POST /_synapse/admin/v1/join/&lt;roomIdOrAlias&gt;</code> to join users to a room like <code>auto_join_rooms</code> for creation of users. (<a href="https://github.com/matrix-org/synapse/issues/7051">#7051</a>)</li>
<li>Add options to prevent users from changing their profile or associated 3PIDs. (<a href="https://github.com/matrix-org/synapse/issues/7096">#7096</a>)</li>
<li>Support SSO in the user interactive authentication workflow. (<a href="https://github.com/matrix-org/synapse/issues/7102">#7102</a>, <a href="https://github.com/matrix-org/synapse/issues/7186">#7186</a>, <a href="https://github.com/matrix-org/synapse/issues/7279">#7279</a>, <a href="https://github.com/matrix-org/synapse/issues/7343">#7343</a>)</li>
<li>Allow server admins to define and enforce a password policy (<a href="https://github.com/matrix-org/matrix-doc/issues/2000">MSC2000</a>). (<a href="https://github.com/matrix-org/synapse/issues/7118">#7118</a>)</li>
<li>Improve the support for SSO authentication on the login fallback page. (<a href="https://github.com/matrix-org/synapse/issues/7152">#7152</a>, <a href="https://github.com/matrix-org/synapse/issues/7235">#7235</a>)</li>
<li>Always whitelist the login fallback in the SSO configuration if <code>public_baseurl</code> is set. (<a href="https://github.com/matrix-org/synapse/issues/7153">#7153</a>)</li>
<li>Admin users are no longer required to be in a room to create an alias for it. (<a href="https://github.com/matrix-org/synapse/issues/7191">#7191</a>)</li>
<li>Require admin privileges to enable room encryption by default. This does not affect existing rooms. (<a href="https://github.com/matrix-org/synapse/issues/7230">#7230</a>)</li>
<li>Add a config option for specifying the value of the Accept-Language HTTP header when generating URL previews. (<a href="https://github.com/matrix-org/synapse/issues/7265">#7265</a>)</li>
<li>Allow <code>/requestToken</code> endpoints to hide the existence (or lack thereof) of 3PID associations on the homeserver. (<a href="https://github.com/matrix-org/synapse/issues/7315">#7315</a>)</li>
<li>Add a configuration setting to tweak the threshold for dummy events. (<a href="https://github.com/matrix-org/synapse/issues/7422">#7422</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Don't attempt to use an invalid sqlite config if no database configuration is provided. Contributed by @nekatak. (<a href="https://github.com/matrix-org/synapse/issues/6573">#6573</a>)</li>
<li>Fix single-sign on with CAS systems: pass the same service URL when requesting the CAS ticket and when calling the <code>proxyValidate</code> URL. Contributed by @Naugrimm. (<a href="https://github.com/matrix-org/synapse/issues/6634">#6634</a>)</li>
<li>Fix missing field <code>default</code> when fetching user-defined push rules. (<a href="https://github.com/matrix-org/synapse/issues/6639">#6639</a>)</li>
<li>Improve error responses when accessing remote public room lists. (<a href="https://github.com/matrix-org/synapse/issues/6899">#6899</a>, <a href="https://github.com/matrix-org/synapse/issues/7368">#7368</a>)</li>
<li>Transfer alias mappings on room upgrade. (<a href="https://github.com/matrix-org/synapse/issues/6946">#6946</a>)</li>
<li>Ensure that a user interactive authentication session is tied to a single request. (<a href="https://github.com/matrix-org/synapse/issues/7068">#7068</a>, <a href="https://github.com/matrix-org/synapse/issues/7455">#7455</a>)</li>
<li>Fix a bug in the federation API which could cause occasional &quot;Failed to get PDU&quot; errors. (<a href="https://github.com/matrix-org/synapse/issues/7089">#7089</a>)</li>
<li>Return the proper error (<code>M_BAD_ALIAS</code>) when a non-existent canonical alias is provided. (<a href="https://github.com/matrix-org/synapse/issues/7109">#7109</a>)</li>
<li>Fix a bug which meant that groups updates were not correctly replicated between workers. (<a href="https://github.com/matrix-org/synapse/issues/7117">#7117</a>)</li>
<li>Fix starting workers when federation sending not split out. (<a href="https://github.com/matrix-org/synapse/issues/7133">#7133</a>)</li>
<li>Ensure <code>is_verified</code> is a boolean in responses to <code>GET /_matrix/client/r0/room_keys/keys</code>. Also warn the user if they forgot the <code>version</code> query param. (<a href="https://github.com/matrix-org/synapse/issues/7150">#7150</a>)</li>
<li>Fix error page being shown when a custom SAML handler attempted to redirect when processing an auth response. (<a href="https://github.com/matrix-org/synapse/issues/7151">#7151</a>)</li>
<li>Avoid importing <code>sqlite3</code> when using the postgres backend. Contributed by David Vo. (<a href="https://github.com/matrix-org/synapse/issues/7155">#7155</a>)</li>
<li>Fix excessive CPU usage by <code>prune_old_outbound_device_pokes</code> job. (<a href="https://github.com/matrix-org/synapse/issues/7159">#7159</a>)</li>
<li>Fix a bug which could cause outbound federation traffic to stop working if a client uploaded an incorrect e2e device signature. (<a href="https://github.com/matrix-org/synapse/issues/7177">#7177</a>)</li>
<li>Fix a bug which could cause incorrect 'cyclic dependency' error. (<a href="https://github.com/matrix-org/synapse/issues/7178">#7178</a>)</li>
<li>Fix a bug that could cause a user to be invited to a server notices (aka System Alerts) room without any notice being sent. (<a href="https://github.com/matrix-org/synapse/issues/7199">#7199</a>)</li>
<li>Fix some worker-mode replication handling not being correctly recorded in CPU usage stats. (<a href="https://github.com/matrix-org/synapse/issues/7203">#7203</a>)</li>
<li>Do not allow a deactivated user to login via SSO. (<a href="https://github.com/matrix-org/synapse/issues/7240">#7240</a>, <a href="https://github.com/matrix-org/synapse/issues/7259">#7259</a>)</li>
<li>Fix --help command-line argument. (<a href="https://github.com/matrix-org/synapse/issues/7249">#7249</a>)</li>
<li>Fix room publish permissions not being checked on room creation. (<a href="https://github.com/matrix-org/synapse/issues/7260">#7260</a>)</li>
<li>Reject unknown session IDs during user interactive authentication instead of silently creating a new session. (<a href="https://github.com/matrix-org/synapse/issues/7268">#7268</a>)</li>
<li>Fix a SQL query introduced in Synapse 1.12.0 which could cause large amounts of logging to the postgres slow-query log. (<a href="https://github.com/matrix-org/synapse/issues/7274">#7274</a>)</li>
<li>Persist user interactive authentication sessions across workers and Synapse restarts. (<a href="https://github.com/matrix-org/synapse/issues/7302">#7302</a>)</li>
<li>Fixed backwards compatibility logic of the first value of <code>trusted_third_party_id_servers</code> being used for <code>account_threepid_delegates.email</code>, which occurs when the former, deprecated option is set and the latter is not. (<a href="https://github.com/matrix-org/synapse/issues/7316">#7316</a>)</li>
<li>Fix a bug where event updates might not be sent over replication to worker processes after the stream falls behind. (<a href="https://github.com/matrix-org/synapse/issues/7337">#7337</a>, <a href="https://github.com/matrix-org/synapse/issues/7358">#7358</a>)</li>
<li>Fix bad error handling that would cause Synapse to crash if it's provided with a YAML configuration file that's either empty or doesn't parse into a key-value map. (<a href="https://github.com/matrix-org/synapse/issues/7341">#7341</a>)</li>
<li>Fix incorrect metrics reporting for <code>renew_attestations</code> background task. (<a href="https://github.com/matrix-org/synapse/issues/7344">#7344</a>)</li>
<li>Prevent non-federating rooms from appearing in responses to federated <code>POST /publicRoom</code> requests when a filter was included. (<a href="https://github.com/matrix-org/synapse/issues/7367">#7367</a>)</li>
<li>Fix a bug which would cause the room directory to be incorrectly populated if Synapse was upgraded directly from v1.2.1 or earlier to v1.4.0 or later. Note that this fix does not apply retrospectively; see the <a href="UPGRADE.rst#upgrading-to-v1130">upgrade notes</a> for more information. (<a href="https://github.com/matrix-org/synapse/issues/7387">#7387</a>)</li>
<li>Fix bug in <code>EventContext.deserialize</code>. (<a href="https://github.com/matrix-org/synapse/issues/7393">#7393</a>)</li>
<li>Fix a long-standing bug which could cause messages not to be sent over federation, when state events with state keys matching user IDs (such as custom user statuses) were received. (<a href="https://github.com/matrix-org/synapse/issues/7376">#7376</a>)</li>
<li>Restore compatibility with non-compliant clients during the user interactive authentication process, fixing a problem introduced in v1.13.0rc1. (<a href="https://github.com/matrix-org/synapse/issues/7483">#7483</a>)</li>
<li>Hash passwords as early as possible during registration. (<a href="https://github.com/matrix-org/synapse/issues/7523">#7523</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Update Debian installation instructions to recommend installing the <code>virtualenv</code> package instead of <code>python3-virtualenv</code>. (<a href="https://github.com/matrix-org/synapse/issues/6892">#6892</a>)</li>
<li>Improve the documentation for database configuration. (<a href="https://github.com/matrix-org/synapse/issues/6988">#6988</a>)</li>
<li>Improve the documentation of application service configuration files. (<a href="https://github.com/matrix-org/synapse/issues/7091">#7091</a>)</li>
<li>Update pre-built package name for FreeBSD. (<a href="https://github.com/matrix-org/synapse/issues/7107">#7107</a>)</li>
<li>Update postgres docs with login troubleshooting information. (<a href="https://github.com/matrix-org/synapse/issues/7119">#7119</a>)</li>
<li>Clean up INSTALL.md a bit. (<a href="https://github.com/matrix-org/synapse/issues/7141">#7141</a>)</li>
<li>Add documentation for running a local CAS server for testing. (<a href="https://github.com/matrix-org/synapse/issues/7147">#7147</a>)</li>
<li>Improve README.md by being explicit about public IP recommendation for TURN relaying. (<a href="https://github.com/matrix-org/synapse/issues/7167">#7167</a>)</li>
<li>Fix a small typo in the <code>metrics_flags</code> config option. (<a href="https://github.com/matrix-org/synapse/issues/7171">#7171</a>)</li>
<li>Update the contributed documentation on managing synapse workers with systemd, and bring it into the core distribution. (<a href="https://github.com/matrix-org/synapse/issues/7234">#7234</a>)</li>
<li>Add documentation to the <code>password_providers</code> config option. Add known password provider implementations to docs. (<a href="https://github.com/matrix-org/synapse/issues/7238">#7238</a>, <a href="https://github.com/matrix-org/synapse/issues/7248">#7248</a>)</li>
<li>Modify suggested nginx reverse proxy configuration to match Synapse's default file upload size. Contributed by @ProCycleDev. (<a href="https://github.com/matrix-org/synapse/issues/7251">#7251</a>)</li>
<li>Documentation of media_storage_providers options updated to avoid misunderstandings. Contributed by Tristan Lins. (<a href="https://github.com/matrix-org/synapse/issues/7272">#7272</a>)</li>
<li>Add documentation on monitoring workers with Prometheus. (<a href="https://github.com/matrix-org/synapse/issues/7357">#7357</a>)</li>
<li>Clarify endpoint usage in the users admin api documentation. (<a href="https://github.com/matrix-org/synapse/issues/7361">#7361</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove nonfunctional <code>captcha_bypass_secret</code> option from <code>homeserver.yaml</code>. (<a href="https://github.com/matrix-org/synapse/issues/7137">#7137</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add benchmarks for LruCache. (<a href="https://github.com/matrix-org/synapse/issues/6446">#6446</a>)</li>
<li>Return total number of users and profile attributes in admin users endpoint. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/6881">#6881</a>)</li>
<li>Change device list streams to have one row per ID. (<a href="https://github.com/matrix-org/synapse/issues/7010">#7010</a>)</li>
<li>Remove concept of a non-limited stream. (<a href="https://github.com/matrix-org/synapse/issues/7011">#7011</a>)</li>
<li>Move catchup of replication streams logic to worker. (<a href="https://github.com/matrix-org/synapse/issues/7024">#7024</a>, <a href="https://github.com/matrix-org/synapse/issues/7195">#7195</a>, <a href="https://github.com/matrix-org/synapse/issues/7226">#7226</a>, <a href="https://github.com/matrix-org/synapse/issues/7239">#7239</a>, <a href="https://github.com/matrix-org/synapse/issues/7286">#7286</a>, <a href="https://github.com/matrix-org/synapse/issues/7290">#7290</a>, <a href="https://github.com/matrix-org/synapse/issues/7318">#7318</a>, <a href="https://github.com/matrix-org/synapse/issues/7326">#7326</a>, <a href="https://github.com/matrix-org/synapse/issues/7378">#7378</a>, <a href="https://github.com/matrix-org/synapse/issues/7421">#7421</a>)</li>
<li>Convert some of synapse.rest.media to async/await. (<a href="https://github.com/matrix-org/synapse/issues/7110">#7110</a>, <a href="https://github.com/matrix-org/synapse/issues/7184">#7184</a>, <a href="https://github.com/matrix-org/synapse/issues/7241">#7241</a>)</li>
<li>De-duplicate / remove unused REST code for login and auth. (<a href="https://github.com/matrix-org/synapse/issues/7115">#7115</a>)</li>
<li>Convert <code>*StreamRow</code> classes to inner classes. (<a href="https://github.com/matrix-org/synapse/issues/7116">#7116</a>)</li>
<li>Clean up some LoggingContext code. (<a href="https://github.com/matrix-org/synapse/issues/7120">#7120</a>, <a href="https://github.com/matrix-org/synapse/issues/7181">#7181</a>, <a href="https://github.com/matrix-org/synapse/issues/7183">#7183</a>, <a href="https://github.com/matrix-org/synapse/issues/7408">#7408</a>, <a href="https://github.com/matrix-org/synapse/issues/7426">#7426</a>)</li>
<li>Add explicit <code>instance_id</code> for USER_SYNC commands and remove implicit <code>conn_id</code> usage. (<a href="https://github.com/matrix-org/synapse/issues/7128">#7128</a>)</li>
<li>Refactored the CAS authentication logic to a separate class. (<a href="https://github.com/matrix-org/synapse/issues/7136">#7136</a>)</li>
<li>Run replication streamers on workers. (<a href="https://github.com/matrix-org/synapse/issues/7146">#7146</a>)</li>
<li>Add tests for outbound device pokes. (<a href="https://github.com/matrix-org/synapse/issues/7157">#7157</a>)</li>
<li>Fix device list update stream ids going backward. (<a href="https://github.com/matrix-org/synapse/issues/7158">#7158</a>)</li>
<li>Use <code>stream.current_token()</code> and remove <code>stream_positions()</code>. (<a href="https://github.com/matrix-org/synapse/issues/7172">#7172</a>)</li>
<li>Move client command handling out of TCP protocol. (<a href="https://github.com/matrix-org/synapse/issues/7185">#7185</a>)</li>
<li>Move server command handling out of TCP protocol. (<a href="https://github.com/matrix-org/synapse/issues/7187">#7187</a>)</li>
<li>Fix consistency of HTTP status codes reported in log lines. (<a href="https://github.com/matrix-org/synapse/issues/7188">#7188</a>)</li>
<li>Only run one background database update at a time. (<a href="https://github.com/matrix-org/synapse/issues/7190">#7190</a>)</li>
<li>Remove sent outbound device list pokes from the database. (<a href="https://github.com/matrix-org/synapse/issues/7192">#7192</a>)</li>
<li>Add a background database update job to clear out duplicate <code>device_lists_outbound_pokes</code>. (<a href="https://github.com/matrix-org/synapse/issues/7193">#7193</a>)</li>
<li>Remove some extraneous debugging log lines. (<a href="https://github.com/matrix-org/synapse/issues/7207">#7207</a>)</li>
<li>Add explicit Python build tooling as dependencies for the snapcraft build. (<a href="https://github.com/matrix-org/synapse/issues/7213">#7213</a>)</li>
<li>Add typing information to federation server code. (<a href="https://github.com/matrix-org/synapse/issues/7219">#7219</a>)</li>
<li>Extend room admin api (<code>GET /_synapse/admin/v1/rooms</code>) with additional attributes. (<a href="https://github.com/matrix-org/synapse/issues/7225">#7225</a>)</li>
<li>Unblacklist '/upgrade creates a new room' sytest for workers. (<a href="https://github.com/matrix-org/synapse/issues/7228">#7228</a>)</li>
<li>Remove redundant checks on <code>daemonize</code> from synctl. (<a href="https://github.com/matrix-org/synapse/issues/7233">#7233</a>)</li>
<li>Upgrade jQuery to v3.4.1 on fallback login/registration pages. (<a href="https://github.com/matrix-org/synapse/issues/7236">#7236</a>)</li>
<li>Change log line that told user to implement onLogin/onRegister fallback js functions to a warning, instead of an info, so it's more visible. (<a href="https://github.com/matrix-org/synapse/issues/7237">#7237</a>)</li>
<li>Correct the parameters of a test fixture. Contributed by Isaiah Singletary. (<a href="https://github.com/matrix-org/synapse/issues/7243">#7243</a>)</li>
<li>Convert auth handler to async/await. (<a href="https://github.com/matrix-org/synapse/issues/7261">#7261</a>)</li>
<li>Add some unit tests for replication. (<a href="https://github.com/matrix-org/synapse/issues/7278">#7278</a>)</li>
<li>Improve typing annotations in <code>synapse.replication.tcp.streams.Stream</code>. (<a href="https://github.com/matrix-org/synapse/issues/7291">#7291</a>)</li>
<li>Reduce log verbosity of url cache cleanup tasks. (<a href="https://github.com/matrix-org/synapse/issues/7295">#7295</a>)</li>
<li>Fix sample SAML Service Provider configuration. Contributed by @frcl. (<a href="https://github.com/matrix-org/synapse/issues/7300">#7300</a>)</li>
<li>Fix StreamChangeCache to work with multiple entities changing on the same stream id. (<a href="https://github.com/matrix-org/synapse/issues/7303">#7303</a>)</li>
<li>Fix an incorrect import in IdentityHandler. (<a href="https://github.com/matrix-org/synapse/issues/7319">#7319</a>)</li>
<li>Reduce logging verbosity for successful federation requests. (<a href="https://github.com/matrix-org/synapse/issues/7321">#7321</a>)</li>
<li>Convert some federation handler code to async/await. (<a href="https://github.com/matrix-org/synapse/issues/7338">#7338</a>)</li>
<li>Fix collation for postgres for unit tests. (<a href="https://github.com/matrix-org/synapse/issues/7359">#7359</a>)</li>
<li>Convert RegistrationWorkerStore.is_server_admin and dependent code to async/await. (<a href="https://github.com/matrix-org/synapse/issues/7363">#7363</a>)</li>
<li>Add an <code>instance_name</code> to <code>RDATA</code> and <code>POSITION</code> replication commands. (<a href="https://github.com/matrix-org/synapse/issues/7364">#7364</a>)</li>
<li>Thread through instance name to replication client. (<a href="https://github.com/matrix-org/synapse/issues/7369">#7369</a>)</li>
<li>Convert synapse.server_notices to async/await. (<a href="https://github.com/matrix-org/synapse/issues/7394">#7394</a>)</li>
<li>Convert synapse.notifier to async/await. (<a href="https://github.com/matrix-org/synapse/issues/7395">#7395</a>)</li>
<li>Fix issues with the Python package manifest. (<a href="https://github.com/matrix-org/synapse/issues/7404">#7404</a>)</li>
<li>Prevent methods in <code>synapse.handlers.auth</code> from polling the homeserver config every request. (<a href="https://github.com/matrix-org/synapse/issues/7420">#7420</a>)</li>
<li>Speed up fetching device lists changes when handling <code>/sync</code> requests. (<a href="https://github.com/matrix-org/synapse/issues/7423">#7423</a>)</li>
<li>Run group attestation renewal in series rather than parallel for performance. (<a href="https://github.com/matrix-org/synapse/issues/7442">#7442</a>)</li>
<li>Fix linting errors in new version of Flake8. (<a href="https://github.com/matrix-org/synapse/issues/7470">#7470</a>)</li>
<li>Update the version of dh-virtualenv we use to build debs, and add focal to the list of target distributions. (<a href="https://github.com/matrix-org/synapse/issues/7526">#7526</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;04&#x2F;23&#x2F;synapse-1-12-4-released&#x2F;" title="Synapse 1.12.4 released">Synapse 1.12.4 released</a></h2>
                <span>
                    23.04.2020 19:04
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>A small patch release containing features and bugs to support the upcoming launch of cross signing. We are very close now :)</p>
<p>Get 1.12.4 from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.12.4">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<p>Changelog since v1.12.3</p>
<h1 id="synapse-1-12-4-2020-04-23">Synapse 1.12.4 (2020-04-23)</h1>
<p>No significant changes.</p>
<h1 id="synapse-1-12-4rc1-2020-04-22">Synapse 1.12.4rc1 (2020-04-22)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Always send users their own device updates. (<a href="https://github.com/matrix-org/synapse/issues/7160">#7160</a>)</li>
<li>Add support for handling GET requests for <code>account_data</code> on a worker. (<a href="https://github.com/matrix-org/synapse/issues/7311">#7311</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix a bug that prevented cross-signing with users on worker-mode synapses. (<a href="https://github.com/matrix-org/synapse/issues/7255">#7255</a>)</li>
<li>Do not treat display names as globs in push rules. (<a href="https://github.com/matrix-org/synapse/issues/7271">#7271</a>)</li>
<li>Fix a bug with cross-signing devices belonging to remote users who did not share a room with any user on the local homeserver. (<a href="https://github.com/matrix-org/synapse/issues/7289">#7289</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;04&#x2F;02&#x2F;synapse-1-12-2-released&#x2F;" title="Synapse 1.12.2 released">Synapse 1.12.2 released</a></h2>
                <span>
                    02.04.2020 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>A small patch release to fix regressions introduced in v1.11.0 and v1.12.0.</p>
<p>Update 1.12.3 is a fast follow release from 1.12.2</p>
<p>Get 1.12.3 (not 1.12.2) from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.12.3">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<p>Changelog since v1.12.0</p>
<h1 id="synapse-1-12-3-2020-04-03">Synapse 1.12.3 (2020-04-03)</h1>
<ul>
<li>Remove the the pin to Pillow 7.0 which was introduced in Synapse 1.12.2, and
correctly fix the issue with building the Debian packages. (<a href="https://github.com/matrix-org/synapse/issues/7212">#7212</a>)</li>
</ul>
<h1 id="synapse-1-12-2-2020-04-02">Synapse 1.12.2 (2020-04-02)</h1>
<p>This release fixes <a href="https://github.com/matrix-org/synapse/issues/7208">an issue</a> with building the debian packages.</p>
<h1 id="synapse-1-12-1-2020-04-02">Synapse 1.12.1 (2020-04-02)</h1>
<p>No significant changes since 1.12.1rc1.</p>
<h1 id="synapse-1-12-1rc1-2020-03-31">Synapse 1.12.1rc1 (2020-03-31)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix starting workers when federation sending not split out. (<a href="https://github.com/matrix-org/synapse/issues/7133">#7133</a>). Introduced in v1.12.0.</li>
<li>Avoid importing <code>sqlite3</code> when using the postgres backend. Contributed by David Vo. (<a href="https://github.com/matrix-org/synapse/issues/7155">#7155</a>). Introduced in v1.12.0rc1.</li>
<li>Fix a bug which could cause outbound federation traffic to stop working if a client uploaded an incorrect e2e device signature. (<a href="https://github.com/matrix-org/synapse/issues/7177">#7177</a>). Introduced in v1.11.0.</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;03&#x2F;23&#x2F;synapse-1-12-0-released&#x2F;" title="Synapse 1.12.0 released">Synapse 1.12.0 released</a></h2>
                <span>
                    23.03.2020 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Synapse 1.12.0 is here.</p>
<p>The most important reason to upgrade to 1.12.0 is that it contains performance improvements to boost the efficiency of state resolution in room versions greater than v1 (<a href="https://github.com/matrix-org/synapse/issues/7095">#7095</a>).</p>
<p>It also contains an implementation of (<a href="https://github.com/matrix-org/matrix-doc/pull/2432">MSC2432</a>) designed to limit room alias abuse. The MSC contains the full details, but in short admins now have more control over aliases as they appear on their local server.</p>
<p>There is also plenty of ground work for our master process sharding project. Nothing that can be used today unfortunately, but expect big improvements for worker based deployments over the coming weeks.</p>
<p>Please pay special attention to the security advisory in the changelog, TL;DR make sure your installation is using Twisted 20.3.0.</p>
<p>Also, note that once Synapse 1.13.0 is released, the default branch will change to being <code>develop</code> rather than <code>master</code>. Again more details follow in the changelog.</p>
<p>Get the new release from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.12.0">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<p>Changelog since Synapse 1.11.1</p>
<h1 id="synapse-1-12-0-2020-03-23">Synapse 1.12.0 (2020-03-23)</h1>
<p>No significant changes since 1.12.0rc1.</p>
<p>Debian packages and Docker images are rebuilt using the latest versions of
dependency libraries, including Twisted 20.3.0. <strong>Please see security advisory
below</strong>.</p>
<h2 id="security-advisory">Security advisory</h2>
<p>Synapse may be vulnerable to request-smuggling attacks when it is used with a
reverse-proxy. The vulnerabilities are fixed in Twisted 20.3.0, and are
described in
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-10108">CVE-2020-10108</a>
and
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-10109">CVE-2020-10109</a>.
For a good introduction to this class of request-smuggling attacks, see
https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn.</p>
<p>We are not aware of these vulnerabilities being exploited in the wild, and
do not believe that they are exploitable with current versions of any reverse
proxies. Nevertheless, we recommend that all Synapse administrators ensure that
they have the latest versions of the Twisted library to ensure that their
installation remains secure.</p>
<ul>
<li>Administrators using the <a href="https://hub.docker.com/r/matrixdotorg/synapse/"><code>matrix.org</code> Docker
image</a> or the <a href="https://github.com/matrix-org/synapse/blob/master/INSTALL.md#matrixorg-packages">Debian/Ubuntu
packages from
<code>matrix.org</code></a>
should ensure that they have version 1.12.0 installed: these images include
Twisted 20.3.0.</li>
<li>Administrators who have <a href="https://github.com/matrix-org/synapse/blob/master/INSTALL.md#installing-from-source">installed Synapse from
source</a>
should upgrade Twisted within their virtualenv by running:<pre data-lang="shell" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-shell "><code class="language-shell" data-lang="shell"><span>&lt;path_to_virtualenv&gt;/bin/pip install &#39;Twisted&gt;=20.3.0&#39;
</span></code></pre>
</li>
<li>Administrators who have installed Synapse from distribution packages should
consult the information from their distributions.</li>
</ul>
<p>The <code>matrix.org</code> Synapse instance was not vulnerable to these vulnerabilities.</p>
<h2 id="advance-notice-of-change-to-the-default-git-branch-for-synapse">Advance notice of change to the default <code>git</code> branch for Synapse</h2>
<p>Currently, the default <code>git</code> branch for Synapse is <code>master</code>, which tracks the
latest release.</p>
<p>After the release of Synapse 1.13.0, we intend to change this default to
<code>develop</code>, which is the development tip. This is more consistent with common
practice and modern <code>git</code> usage.</p>
<p>Although we try to keep <code>develop</code> in a stable state, there may be occasions
where regressions creep in. Developers and distributors who have scripts which
run builds using the default branch of <code>Synapse</code> should therefore consider
pinning their scripts to <code>master</code>.</p>
<h1 id="synapse-1-12-0rc1-2020-03-19">Synapse 1.12.0rc1 (2020-03-19)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Changes related to room alias management (<a href="https://github.com/matrix-org/matrix-doc/pull/2432">MSC2432</a>):
<ul>
<li>Publishing/removing a room from the room directory now requires the user to have a power level capable of modifying the canonical alias, instead of the room aliases. (<a href="https://github.com/matrix-org/synapse/issues/6965">#6965</a>)</li>
<li>Validate the <code>alt_aliases</code> property of canonical alias events. (<a href="https://github.com/matrix-org/synapse/issues/6971">#6971</a>)</li>
<li>Users with a power level sufficient to modify the canonical alias of a room can now delete room aliases. (<a href="https://github.com/matrix-org/synapse/issues/6986">#6986</a>)</li>
<li>Implement updated authorization rules and redaction rules for aliases events, from <a href="https://github.com/matrix-org/matrix-doc/pull/2261">MSC2261</a> and <a href="https://github.com/matrix-org/matrix-doc/pull/2432">MSC2432</a>. (<a href="https://github.com/matrix-org/synapse/issues/7037">#7037</a>)</li>
<li>Stop sending m.room.aliases events during room creation and upgrade. (<a href="https://github.com/matrix-org/synapse/issues/6941">#6941</a>)</li>
<li>Synapse no longer uses room alias events to calculate room names for push notifications. (<a href="https://github.com/matrix-org/synapse/issues/6966">#6966</a>)</li>
<li>The room list endpoint no longer returns a list of aliases. (<a href="https://github.com/matrix-org/synapse/issues/6970">#6970</a>)</li>
<li>Remove special handling of aliases events from <a href="https://github.com/matrix-org/matrix-doc/pull/2260">MSC2260</a> added in v1.10.0rc1. (<a href="https://github.com/matrix-org/synapse/issues/7034">#7034</a>)</li>
</ul>
</li>
<li>Expose the <code>synctl</code>, <code>hash_password</code> and <code>generate_config</code> commands in the snapcraft package. Contributed by @devec0. (<a href="https://github.com/matrix-org/synapse/issues/6315">#6315</a>)</li>
<li>Check that server_name is correctly set before running database updates. (<a href="https://github.com/matrix-org/synapse/issues/6982">#6982</a>)</li>
<li>Break down monthly active users by <code>appservice_id</code> and emit via Prometheus. (<a href="https://github.com/matrix-org/synapse/issues/7030">#7030</a>)</li>
<li>Render a configurable and comprehensible error page if something goes wrong during the SAML2 authentication process. (<a href="https://github.com/matrix-org/synapse/issues/7058">#7058</a>, <a href="https://github.com/matrix-org/synapse/issues/7067">#7067</a>)</li>
<li>Add an optional parameter to control whether other sessions are logged out when a user's password is modified. (<a href="https://github.com/matrix-org/synapse/issues/7085">#7085</a>)</li>
<li>Add prometheus metrics for the number of active pushers. (<a href="https://github.com/matrix-org/synapse/issues/7103">#7103</a>, <a href="https://github.com/matrix-org/synapse/issues/7106">#7106</a>)</li>
<li>Improve performance when making HTTPS requests to sygnal, sydent, etc, by sharing the SSL context object between connections. (<a href="https://github.com/matrix-org/synapse/issues/7094">#7094</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>When a user's profile is updated via the admin API, also generate a displayname/avatar update for that user in each room. (<a href="https://github.com/matrix-org/synapse/issues/6572">#6572</a>)</li>
<li>Fix a couple of bugs in email configuration handling. (<a href="https://github.com/matrix-org/synapse/issues/6962">#6962</a>)</li>
<li>Fix an issue affecting worker-based deployments where replication would stop working, necessitating a full restart, after joining a large room. (<a href="https://github.com/matrix-org/synapse/issues/6967">#6967</a>)</li>
<li>Fix <code>duplicate key</code> error which was logged when rejoining a room over federation. (<a href="https://github.com/matrix-org/synapse/issues/6968">#6968</a>)</li>
<li>Prevent user from setting 'deactivated' to anything other than a bool on the v2 PUT /users Admin API. (<a href="https://github.com/matrix-org/synapse/issues/6990">#6990</a>)</li>
<li>Fix py35-old CI by using native tox package. (<a href="https://github.com/matrix-org/synapse/issues/7018">#7018</a>)</li>
<li>Fix a bug causing <code>org.matrix.dummy_event</code> to be included in responses from <code>/sync</code>. (<a href="https://github.com/matrix-org/synapse/issues/7035">#7035</a>)</li>
<li>Fix a bug that renders UTF-8 text files incorrectly when loaded from media. Contributed by @TheStranjer. (<a href="https://github.com/matrix-org/synapse/issues/7044">#7044</a>)</li>
<li>Fix a bug that would cause Synapse to respond with an error about event visibility if a client tried to request the state of a room at a given token. (<a href="https://github.com/matrix-org/synapse/issues/7066">#7066</a>)</li>
<li>Repair a data-corruption issue which was introduced in Synapse 1.10, and fixed in Synapse 1.11, and which could cause <code>/sync</code> to return with 404 errors about missing events and unknown rooms. (<a href="https://github.com/matrix-org/synapse/issues/7070">#7070</a>)</li>
<li>Fix a bug causing account validity renewal emails to be sent even if the feature is turned off in some cases. (<a href="https://github.com/matrix-org/synapse/issues/7074">#7074</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Updated CentOS8 install instructions. Contributed by Richard Kellner. (<a href="https://github.com/matrix-org/synapse/issues/6925">#6925</a>)</li>
<li>Fix <code>POSTGRES_INITDB_ARGS</code> in the <code>contrib/docker/docker-compose.yml</code> example docker-compose configuration. (<a href="https://github.com/matrix-org/synapse/issues/6984">#6984</a>)</li>
<li>Change date in <a href="./INSTALL.md#tls-certificates">https://github.com/matrix-org/synapse/blob/master/INSTALL.md</a> for last date of getting TLS certificates to November 2019. (<a href="https://github.com/matrix-org/synapse/issues/7015">#7015</a>)</li>
<li>Document that the fallback auth endpoints must be routed to the same worker node as the register endpoints. (<a href="https://github.com/matrix-org/synapse/issues/7048">#7048</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove the unused query_auth federation endpoint per <a href="https://github.com/matrix-org/matrix-doc/pull/2451">MSC2451</a>. (<a href="https://github.com/matrix-org/synapse/issues/7026">#7026</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add type hints to <code>logging/context.py</code>. (<a href="https://github.com/matrix-org/synapse/issues/6309">#6309</a>)</li>
<li>Add some clarifications to <code>README.md</code> in the database schema directory. (<a href="https://github.com/matrix-org/synapse/issues/6615">#6615</a>)</li>
<li>Refactoring work in preparation for changing the event redaction algorithm. (<a href="https://github.com/matrix-org/synapse/issues/6874">#6874</a>, <a href="https://github.com/matrix-org/synapse/issues/6875">#6875</a>, <a href="https://github.com/matrix-org/synapse/issues/6983">#6983</a>, <a href="https://github.com/matrix-org/synapse/issues/7003">#7003</a>)</li>
<li>Improve performance of v2 state resolution for large rooms. (<a href="https://github.com/matrix-org/synapse/issues/6952">#6952</a>, <a href="https://github.com/matrix-org/synapse/issues/7095">#7095</a>)</li>
<li>Reduce time spent doing GC, by freezing objects on startup. (<a href="https://github.com/matrix-org/synapse/issues/6953">#6953</a>)</li>
<li>Minor performance fixes to <code>get_auth_chain_ids</code>. (<a href="https://github.com/matrix-org/synapse/issues/6954">#6954</a>)</li>
<li>Don't record remote cross-signing keys in the <code>devices</code> table. (<a href="https://github.com/matrix-org/synapse/issues/6956">#6956</a>)</li>
<li>Use flake8-comprehensions to enforce good hygiene of list/set/dict comprehensions. (<a href="https://github.com/matrix-org/synapse/issues/6957">#6957</a>)</li>
<li>Merge worker apps together. (<a href="https://github.com/matrix-org/synapse/issues/6964">#6964</a>, <a href="https://github.com/matrix-org/synapse/issues/7002">#7002</a>, <a href="https://github.com/matrix-org/synapse/issues/7055">#7055</a>, <a href="https://github.com/matrix-org/synapse/issues/7104">#7104</a>)</li>
<li>Remove redundant <code>store_room</code> call from <code>FederationHandler._process_received_pdu</code>. (<a href="https://github.com/matrix-org/synapse/issues/6979">#6979</a>)</li>
<li>Update warning for incorrect database collation/ctype to include link to documentation. (<a href="https://github.com/matrix-org/synapse/issues/6985">#6985</a>)</li>
<li>Add some type annotations to the database storage classes. (<a href="https://github.com/matrix-org/synapse/issues/6987">#6987</a>)</li>
<li>Port <code>synapse.handlers.presence</code> to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6991">#6991</a>, <a href="https://github.com/matrix-org/synapse/issues/7019">#7019</a>)</li>
<li>Add some type annotations to the federation base &amp; client classes. (<a href="https://github.com/matrix-org/synapse/issues/6995">#6995</a>)</li>
<li>Port <code>synapse.rest.keys</code> to async/await. (<a href="https://github.com/matrix-org/synapse/issues/7020">#7020</a>)</li>
<li>Add a type check to <code>is_verified</code> when processing room keys. (<a href="https://github.com/matrix-org/synapse/issues/7045">#7045</a>)</li>
<li>Add type annotations and comments to the auth handler. (<a href="https://github.com/matrix-org/synapse/issues/7063">#7063</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;03&#x2F;03&#x2F;synapse-1-11-1-released&#x2F;" title="Synapse 1.11.1 released">Synapse 1.11.1 released</a></h2>
                <span>
                    03.03.2020 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Synapse 1.11.1 is a security release which contains a fix impacting installations using Single Sign-On (i.e. SAML2 or CAS) for authentication. Administrators of such installations are encouraged to upgrade as soon as possible.</p>
<p>Admins not using Single Sign-On to authenticate users are not affected though may wish to upgrade anyway to pull in some unrelated bug fixes.</p>
<p>Thanks to <a href="https://twitter.com/rhysmdnz">Rhys Davies</a> for the responsible disclosure.</p>
<p>Get the new release from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.11.1">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<p>Changelog since Synapse 1.11.0</p>
<h1 id="synapse-1-11-1-2020-03-03">Synapse 1.11.1 (2020-03-03)</h1>
<p>This release includes a security fix impacting installations using Single Sign-On (i.e. SAML2 or CAS) for authentication. Administrators of such installations are encouraged to upgrade as soon as possible.</p>
<p>The release also includes fixes for a couple of other bugs.</p>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Add a confirmation step to the SSO login flow before redirecting users to the redirect URL. (<a href="https://github.com/matrix-org/synapse/commit/b2bd54a2e31d9a248f73fadb184ae9b4cbdb49f9">b2bd54a2</a>, <a href="https://github.com/matrix-org/synapse/commit/65c73cdfec1876a9fec2fd2c3a74923cd146fe0b">65c73cdf</a>, <a href="https://github.com/matrix-org/synapse/commit/a0178df10422a76fd403b82d2b2a4ed28a9a9d1e">a0178df1</a>)</li>
<li>Fixed set a user as an admin with the admin API <code>PUT /_synapse/admin/v2/users/&lt;user_id&gt;</code>. Contributed by @dklimpel. (<a href="https://github.com/matrix-org/synapse/issues/6910">#6910</a>)</li>
<li>Fix bug introduced in Synapse 1.11.0 which sometimes caused errors when joining rooms over federation, with <code>'coroutine' object has no attribute 'event_id'</code>. (<a href="https://github.com/matrix-org/synapse/issues/6996">#6996</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;02&#x2F;12&#x2F;synapse-1-10-0-released&#x2F;" title="Synapse 1.10.0 released">Synapse 1.10.0 released</a></h2>
                <span>
                    12.02.2020 00:00
                    —
                    <a href="/category/general">
                        General
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>The whole Matrix project is racing towards enabling e2ee by default. Synapse is no different and v1.10.0 contains multiple e2ee UX improvements, as well as a bug fix that prevented cross signing requests over federation to work reliably.</p>
<p><em>If</em> any of your users are on the bleeding edge and have already started using cross signing (by enabling labs flags in Riot), then it will be necessary for them to force Synapse to re-send device updates by renaming all of their devices.</p>
<p>We've also included a temporary fix to address alias abuse. The idea is that until <a href="https://github.com/matrix-org/synapse/issues/6898">#6898</a> lands, servers will refrain from sharing events of type <code>m.room.aliases</code> with clients. Most admins will not be affected, but if you are present in rooms subject to alias abuse, then upgrading provides a pragmatic short term solution.</p>
<p>Finally, as of this release Synapse validates <code>client_secret</code> parameters in the Client-Server API as per the spec. See <a href="https://github.com/matrix-org/synapse/issues/6766">#6766</a> for details.</p>
<p>Get the new release from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.10.0">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<p>Changelog since Synapse 1.9.0</p>
<h1 id="synapse-1-10-0-2020-02-12">Synapse 1.10.0 (2020-02-12)</h1>
<p><strong>WARNING to client developers</strong>: As of this release Synapse validates <code>client_secret</code> parameters in the Client-Server API as per the spec. See <a href="https://github.com/matrix-org/synapse/issues/6766">#6766</a> for details.</p>
<h2 id="updates-to-the-docker-image">Updates to the Docker image</h2>
<ul>
<li>Update the docker images to Alpine Linux 3.11. (<a href="https://github.com/matrix-org/synapse/issues/6897">#6897</a>)</li>
</ul>
<h1 id="synapse-1-10-0rc5-2020-02-11">Synapse 1.10.0rc5 (2020-02-11)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix the filtering introduced in 1.10.0rc3 to also apply to the state blocks returned by <code>/sync</code>. (<a href="https://github.com/matrix-org/synapse/issues/6884">#6884</a>)</li>
</ul>
<h1 id="synapse-1-10-0rc4-2020-02-11">Synapse 1.10.0rc4 (2020-02-11)</h1>
<p>This release candidate was built incorrectly and is superseded by 1.10.0rc5.</p>
<h1 id="synapse-1-10-0rc3-2020-02-10">Synapse 1.10.0rc3 (2020-02-10)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Filter out <code>m.room.aliases</code> from the CS API to mitigate abuse while a better solution is specced. (<a href="https://github.com/matrix-org/synapse/issues/6878">#6878</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Fix continuous integration failures with old versions of <code>pip</code>, which were introduced by a release of the <code>zipp</code> library. (<a href="https://github.com/matrix-org/synapse/issues/6880">#6880</a>)</li>
</ul>
<h1 id="synapse-1-10-0rc2-2020-02-06">Synapse 1.10.0rc2 (2020-02-06)</h1>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Fix an issue with cross-signing where device signatures were not sent to remote servers. (<a href="https://github.com/matrix-org/synapse/issues/6844">#6844</a>)</li>
<li>Fix to the unknown remote device detection which was introduced in 1.10.rc1. (<a href="https://github.com/matrix-org/synapse/issues/6848">#6848</a>)</li>
</ul>
<h2 id="internal-changes-1">Internal Changes</h2>
<ul>
<li>Detect unexpected sender keys on remote encrypted events and resync device lists. (<a href="https://github.com/matrix-org/synapse/issues/6850">#6850</a>)</li>
</ul>
<h1 id="synapse-1-10-0rc1-2020-01-31">Synapse 1.10.0rc1 (2020-01-31)</h1>
<h2 id="features-1">Features</h2>
<ul>
<li>Add experimental support for updated authorization rules for aliases events, from <a href="https://github.com/matrix-org/matrix-doc/pull/2260">MSC2260</a>. (<a href="https://github.com/matrix-org/synapse/issues/6787">#6787</a>, <a href="https://github.com/matrix-org/synapse/issues/6790">#6790</a>, <a href="https://github.com/matrix-org/synapse/issues/6794">#6794</a>)</li>
</ul>
<h2 id="bugfixes-2">Bugfixes</h2>
<ul>
<li>Warn if postgres database has a non-C locale, as that can cause issues when upgrading locales (e.g. due to upgrading OS). (<a href="https://github.com/matrix-org/synapse/issues/6734">#6734</a>)</li>
<li>Minor fixes to <code>PUT /_synapse/admin/v2/users</code> admin api. (<a href="https://github.com/matrix-org/synapse/issues/6761">#6761</a>)</li>
<li>Validate <code>client_secret</code> parameter using the regex provided by the Client-Server API, temporarily allowing <code>:</code> characters for older clients. The <code>:</code> character will be removed in a future release. (<a href="https://github.com/matrix-org/synapse/issues/6767">#6767</a>)</li>
<li>Fix persisting redaction events that have been redacted (or otherwise don't have a redacts key). (<a href="https://github.com/matrix-org/synapse/issues/6771">#6771</a>)</li>
<li>Fix outbound federation request metrics. (<a href="https://github.com/matrix-org/synapse/issues/6795">#6795</a>)</li>
<li>Fix bug where querying a remote user's device keys that weren't cached resulted in only returning a single device. (<a href="https://github.com/matrix-org/synapse/issues/6796">#6796</a>)</li>
<li>Fix race in federation sender worker that delayed sending of device updates. (<a href="https://github.com/matrix-org/synapse/issues/6799">#6799</a>, <a href="https://github.com/matrix-org/synapse/issues/6800">#6800</a>)</li>
<li>Fix bug where Synapse didn't invalidate cache of remote users' devices when Synapse left a room. (<a href="https://github.com/matrix-org/synapse/issues/6801">#6801</a>)</li>
<li>Fix waking up other workers when remote server is detected to have come back online. (<a href="https://github.com/matrix-org/synapse/issues/6811">#6811</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Clarify documentation related to <code>user_dir</code> and <code>federation_reader</code> workers. (<a href="https://github.com/matrix-org/synapse/issues/6775">#6775</a>)</li>
</ul>
<h2 id="internal-changes-2">Internal Changes</h2>
<ul>
<li>Record room versions in the <code>rooms</code> table. (<a href="https://github.com/matrix-org/synapse/issues/6729">#6729</a>, <a href="https://github.com/matrix-org/synapse/issues/6788">#6788</a>, <a href="https://github.com/matrix-org/synapse/issues/6810">#6810</a>)</li>
<li>Propagate cache invalidates from workers to other workers. (<a href="https://github.com/matrix-org/synapse/issues/6748">#6748</a>)</li>
<li>Remove some unnecessary admin handler abstraction methods. (<a href="https://github.com/matrix-org/synapse/issues/6751">#6751</a>)</li>
<li>Add some debugging for media storage providers. (<a href="https://github.com/matrix-org/synapse/issues/6757">#6757</a>)</li>
<li>Detect unknown remote devices and mark cache as stale. (<a href="https://github.com/matrix-org/synapse/issues/6776">#6776</a>, <a href="https://github.com/matrix-org/synapse/issues/6819">#6819</a>)</li>
<li>Attempt to resync remote users' devices when detected as stale. (<a href="https://github.com/matrix-org/synapse/issues/6786">#6786</a>)</li>
<li>Delete current state from the database when server leaves a room. (<a href="https://github.com/matrix-org/synapse/issues/6792">#6792</a>)</li>
<li>When a client asks for a remote user's device keys check if the local cache for that user has been marked as potentially stale. (<a href="https://github.com/matrix-org/synapse/issues/6797">#6797</a>)</li>
<li>Add background update to clean out left rooms from current state. (<a href="https://github.com/matrix-org/synapse/issues/6802">#6802</a>, <a href="https://github.com/matrix-org/synapse/issues/6816">#6816</a>)</li>
<li>Refactoring work in preparation for changing the event redaction algorithm. (<a href="https://github.com/matrix-org/synapse/issues/6803">#6803</a>, <a href="https://github.com/matrix-org/synapse/issues/6805">#6805</a>, <a href="https://github.com/matrix-org/synapse/issues/6806">#6806</a>, <a href="https://github.com/matrix-org/synapse/issues/6807">#6807</a>, <a href="https://github.com/matrix-org/synapse/issues/6820">#6820</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;01&#x2F;28&#x2F;synapse-1-9-1-released&#x2F;" title="Synapse 1.9.1 released">Synapse 1.9.1 released</a></h2>
                <span>
                    28.01.2020 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>A quick bug fix release that affects admins making use of monthly active user limits. You will know if you are affected because 1.9.0 will not start up. Apologies if you were bitten by this one!</p>
<p>Get the new release from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.9.1">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<p>Changelog since Synapse 1.9.1</p>
<h1 id="synapse-1-9-1-2020-01-28">Synapse 1.9.1 (2020-01-28)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix bug where setting <code>mau_limit_reserved_threepids</code> config would cause Synapse to refuse to start. (<a href="https://github.com/matrix-org/synapse/issues/6793">#6793</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;01&#x2F;23&#x2F;synapse-1-9-0-released&#x2F;" title="Synapse 1.9.0 released">Synapse 1.9.0 released</a></h2>
                <span>
                    23.01.2020 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Synapse 1.9.0 contains a bunch of new admin APIs as well as bug fixes to existing ones. In particular we have a new end point that allows admins to <a href="https://github.com/matrix-org/synapse/blob/master/docs/admin_api/rooms.md">query which rooms their server participates in</a>.</p>
<p>Aside from that it is worth noting that we have officially dropped support for SQLite versions &lt; 3.11. Though more generally we would recommend that all admins <a href="https://github.com/matrix-org/synapse/blob/release-v1.9.0/docs/postgres.md">migrate to Postgres</a> for anything other than test and evaluation purposes.</p>
<p>Get the new release from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.9.0">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<p>Changelog since Synapse 1.8.0</p>
<h1 id="synapse-1-9-0-2020-01-23">Synapse 1.9.0 (2020-01-23)</h1>
<p><strong>WARNING</strong>: As of this release, Synapse no longer supports versions of SQLite before 3.11, and will refuse to start when configured to use an older version. Administrators are recommended to migrate their database to Postgres (see instructions <a href="https://github.com/matrix-org/synapse/blob/release-v1.9.0/docs/postgres.md">here</a>).</p>
<p>If your Synapse deployment uses workers, note that the reverse-proxy configurations for the <code>synapse.app.media_repository</code>, <code>synapse.app.federation_reader</code> and <code>synapse.app.event_creator</code> workers have changed, with the addition of a few paths (see the updated configurations <a href="https://github.com/matrix-org/synapse/blob/release-v1.9.0/docs/workers.md#available-worker-applications">here</a>). Existing configurations will continue to work.</p>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Fix endpoint documentation for the List Rooms admin API. (<a href="https://github.com/matrix-org/synapse/issues/6770">#6770</a>)</li>
</ul>
<h1 id="synapse-1-9-0rc1-2020-01-22">Synapse 1.9.0rc1 (2020-01-22)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Allow admin to create or modify a user. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/5742">#5742</a>)</li>
<li>Add new quarantine media admin APIs to quarantine by media ID or by user who uploaded the media. (<a href="https://github.com/matrix-org/synapse/issues/6681">#6681</a>, <a href="https://github.com/matrix-org/synapse/issues/6756">#6756</a>)</li>
<li>Add <code>org.matrix.e2e_cross_signing</code> to <code>unstable_features</code> in <code>/versions</code> as per <a href="https://github.com/matrix-org/matrix-doc/pull/1756">MSC1756</a>. (<a href="https://github.com/matrix-org/synapse/issues/6712">#6712</a>)</li>
<li>Add a new admin API to list and filter rooms on the server. (<a href="https://github.com/matrix-org/synapse/issues/6720">#6720</a>)</li>
</ul>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Correctly proxy HTTP errors due to API calls to remote group servers. (<a href="https://github.com/matrix-org/synapse/issues/6654">#6654</a>)</li>
<li>Fix media repo admin APIs when using a media worker. (<a href="https://github.com/matrix-org/synapse/issues/6664">#6664</a>)</li>
<li>Fix &quot;CRITICAL&quot; errors being logged when a request is received for a uri containing non-ascii characters. (<a href="https://github.com/matrix-org/synapse/issues/6682">#6682</a>)</li>
<li>Fix a bug where we would assign a numeric user ID if somebody tried registering with an empty username. (<a href="https://github.com/matrix-org/synapse/issues/6690">#6690</a>)</li>
<li>Fix <code>purge_room</code> admin API. (<a href="https://github.com/matrix-org/synapse/issues/6711">#6711</a>)</li>
<li>Fix a bug causing Synapse to not always purge quiet rooms with a low <code>max_lifetime</code> in their message retention policies when running the automated purge jobs. (<a href="https://github.com/matrix-org/synapse/issues/6714">#6714</a>)</li>
<li>Fix the <code>synapse_port_db</code> not correctly running background updates. Thanks @tadzik for reporting. (<a href="https://github.com/matrix-org/synapse/issues/6718">#6718</a>)</li>
<li>Fix changing password via user admin API. (<a href="https://github.com/matrix-org/synapse/issues/6730">#6730</a>)</li>
<li>Fix <code>/events/:event_id</code> deprecated API. (<a href="https://github.com/matrix-org/synapse/issues/6731">#6731</a>)</li>
<li>Fix monthly active user limiting support for worker mode, fixes <a href="https://github.com/matrix-org/synapse/issues/4639">#4639</a>. (<a href="https://github.com/matrix-org/synapse/issues/6742">#6742</a>)</li>
<li>Fix bug when setting <code>account_validity</code> to an empty block in the config. Thanks to @Sorunome for reporting. (<a href="https://github.com/matrix-org/synapse/issues/6747">#6747</a>)</li>
<li>Fix <code>AttributeError: 'NoneType' object has no attribute 'get'</code> in <code>hash_password</code> when configuration has an empty <code>password_config</code>. Contributed by @ivilata. (<a href="https://github.com/matrix-org/synapse/issues/6753">#6753</a>)</li>
<li>Fix the <code>docker-compose.yaml</code> overriding the entire <code>/etc</code> folder of the container. Contributed by Fabian Meyer. (<a href="https://github.com/matrix-org/synapse/issues/6656">#6656</a>)</li>
</ul>
<h2 id="improved-documentation-1">Improved Documentation</h2>
<ul>
<li>Fix a typo in the configuration example for purge jobs in the sample configuration file. (<a href="https://github.com/matrix-org/synapse/issues/6621">#6621</a>)</li>
<li>Add complete documentation of the message retention policies support. (<a href="https://github.com/matrix-org/synapse/issues/6624">#6624</a>, <a href="https://github.com/matrix-org/synapse/issues/6665">#6665</a>)</li>
<li>Add some helpful tips about changelog entries to the GitHub pull request template. (<a href="https://github.com/matrix-org/synapse/issues/6663">#6663</a>)</li>
<li>Clarify the <code>account_validity</code> and <code>email</code> sections of the sample configuration. (<a href="https://github.com/matrix-org/synapse/issues/6685">#6685</a>)</li>
<li>Add more endpoints to the documentation for Synapse workers. (<a href="https://github.com/matrix-org/synapse/issues/6698">#6698</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Synapse no longer supports versions of SQLite before 3.11, and will refuse to start when configured to use an older version. Administrators are recommended to migrate their database to Postgres (see instructions <a href="docs/postgres.md">here</a>). (<a href="https://github.com/matrix-org/synapse/issues/6675">#6675</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add <code>local_current_membership</code> table for tracking local user membership state in rooms. (<a href="https://github.com/matrix-org/synapse/issues/6655">#6655</a>, <a href="https://github.com/matrix-org/synapse/issues/6728">#6728</a>)</li>
<li>Port <code>synapse.replication.tcp</code> to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6666">#6666</a>)</li>
<li>Fixup <code>synapse.replication</code> to pass mypy checks. (<a href="https://github.com/matrix-org/synapse/issues/6667">#6667</a>)</li>
<li>Allow <code>additional_resources</code> to implement <code>IResource</code> directly. (<a href="https://github.com/matrix-org/synapse/issues/6686">#6686</a>)</li>
<li>Allow REST endpoint implementations to raise a <code>RedirectException</code>, which will redirect the user's browser to a given location. (<a href="https://github.com/matrix-org/synapse/issues/6687">#6687</a>)</li>
<li>Updates and extensions to the module API. (<a href="https://github.com/matrix-org/synapse/issues/6688">#6688</a>)</li>
<li>Updates to the SAML mapping provider API. (<a href="https://github.com/matrix-org/synapse/issues/6689">#6689</a>, <a href="https://github.com/matrix-org/synapse/issues/6723">#6723</a>)</li>
<li>Remove redundant <code>RegistrationError</code> class. (<a href="https://github.com/matrix-org/synapse/issues/6691">#6691</a>)</li>
<li>Don't block processing of incoming EDUs behind processing PDUs in the same transaction. (<a href="https://github.com/matrix-org/synapse/issues/6697">#6697</a>)</li>
<li>Remove duplicate check for the <code>session</code> query parameter on the <code>/auth/xxx/fallback/web</code> Client-Server endpoint. (<a href="https://github.com/matrix-org/synapse/issues/6702">#6702</a>)</li>
<li>Attempt to retry sending a transaction when we detect a remote server has come back online, rather than waiting for a transaction to be triggered by new data. (<a href="https://github.com/matrix-org/synapse/issues/6706">#6706</a>)</li>
<li>Add <code>StateMap</code> type alias to simplify types. (<a href="https://github.com/matrix-org/synapse/issues/6715">#6715</a>)</li>
<li>Add a <code>DeltaState</code> to track changes to be made to current state during event persistence. (<a href="https://github.com/matrix-org/synapse/issues/6716">#6716</a>)</li>
<li>Add more logging around message retention policies support. (<a href="https://github.com/matrix-org/synapse/issues/6717">#6717</a>)</li>
<li>When processing a SAML response, log the assertions for easier configuration. (<a href="https://github.com/matrix-org/synapse/issues/6724">#6724</a>)</li>
<li>Fixup <code>synapse.rest</code> to pass mypy. (<a href="https://github.com/matrix-org/synapse/issues/6732">#6732</a>, <a href="https://github.com/matrix-org/synapse/issues/6764">#6764</a>)</li>
<li>Fixup <code>synapse.api</code> to pass mypy. (<a href="https://github.com/matrix-org/synapse/issues/6733">#6733</a>)</li>
<li>Allow streaming cache 'invalidate all' to workers. (<a href="https://github.com/matrix-org/synapse/issues/6749">#6749</a>)</li>
<li>Remove unused CI docker compose files. (<a href="https://github.com/matrix-org/synapse/issues/6754">#6754</a>)</li>
</ul>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2020&#x2F;01&#x2F;09&#x2F;synapse-1-8-0-released&#x2F;" title="Synapse 1.8.0 released">Synapse 1.8.0 released</a></h2>
                <span>
                    09.01.2020 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Synapse 1.8.0 has arrived, it contains a whole host of bug fixes and tweaks, most notably fixing some long standing problems with search.</p>
<p>More generally we are spending a lot of time  improving the e2ee experience ahead of switching on e2ee by default, so watch this space.</p>
<p>Get the new release from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.8.0">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>
<h1 id="synapse-1-8-0-2020-01-09">Synapse 1.8.0 (2020-01-09)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix <code>GET</code> request on <code>/_synapse/admin/v2/users</code> endpoint. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/6563">#6563</a>)</li>
<li>Fix incorrect signing of responses from the key server implementation. (<a href="https://github.com/matrix-org/synapse/issues/6657">#6657</a>)</li>
</ul>
<h1 id="synapse-1-8-0rc1-2020-01-07">Synapse 1.8.0rc1 (2020-01-07)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Add v2 APIs for the <code>send_join</code> and <code>send_leave</code> federation endpoints (as described in <a href="https://github.com/matrix-org/matrix-doc/pull/1802">MSC1802</a>). (<a href="https://github.com/matrix-org/synapse/issues/6349">#6349</a>)</li>
<li>Add a develop script to generate full SQL schemas. (<a href="https://github.com/matrix-org/synapse/issues/6394">#6394</a>)</li>
<li>Add custom SAML username mapping functionality through an external provider plugin. (<a href="https://github.com/matrix-org/synapse/issues/6411">#6411</a>)</li>
<li>Automatically delete empty groups/communities. (<a href="https://github.com/matrix-org/synapse/issues/6453">#6453</a>)</li>
<li>Add option <code>limit_profile_requests_to_users_who_share_rooms</code> to prevent requirement of a local user sharing a room with another user to query their profile information. (<a href="https://github.com/matrix-org/synapse/issues/6523">#6523</a>)</li>
<li>Add an <code>export_signing_key</code> script to extract the public part of signing keys when rotating them. (<a href="https://github.com/matrix-org/synapse/issues/6546">#6546</a>)</li>
<li>Add experimental config option to specify multiple databases. (<a href="https://github.com/matrix-org/synapse/issues/6580">#6580</a>)</li>
<li>Raise an error if someone tries to use the <code>log_file</code> config option. (<a href="https://github.com/matrix-org/synapse/issues/6626">#6626</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Prevent redacted events from being returned during message search. (<a href="https://github.com/matrix-org/synapse/issues/6377">#6377</a>, <a href="https://github.com/matrix-org/synapse/issues/6522">#6522</a>)</li>
<li>Prevent error on trying to search a upgraded room when the server is not in the predecessor room. (<a href="https://github.com/matrix-org/synapse/issues/6385">#6385</a>)</li>
<li>Improve performance of looking up cross-signing keys. (<a href="https://github.com/matrix-org/synapse/issues/6486">#6486</a>)</li>
<li>Fix race which occasionally caused deleted devices to reappear. (<a href="https://github.com/matrix-org/synapse/issues/6514">#6514</a>)</li>
<li>Fix missing row in <code>device_max_stream_id</code> that could cause unable to decrypt errors after server restart. (<a href="https://github.com/matrix-org/synapse/issues/6555">#6555</a>)</li>
<li>Fix a bug which meant that we did not send systemd notifications on startup if acme was enabled. (<a href="https://github.com/matrix-org/synapse/issues/6571">#6571</a>)</li>
<li>Fix exception when fetching the <code>matrix.org:ed25519:auto</code> key. (<a href="https://github.com/matrix-org/synapse/issues/6625">#6625</a>)</li>
<li>Fix bug where a moderator upgraded a room and became an admin in the new room. (<a href="https://github.com/matrix-org/synapse/issues/6633">#6633</a>)</li>
<li>Fix an error which was thrown by the <code>PresenceHandler</code> <code>_on_shutdown</code> handler. (<a href="https://github.com/matrix-org/synapse/issues/6640">#6640</a>)</li>
<li>Fix exceptions in the synchrotron worker log when events are rejected. (<a href="https://github.com/matrix-org/synapse/issues/6645">#6645</a>)</li>
<li>Ensure that upgraded rooms are removed from the directory. (<a href="https://github.com/matrix-org/synapse/issues/6648">#6648</a>)</li>
<li>Fix a bug causing Synapse not to fetch missing events when it believes it has every event in the room. (<a href="https://github.com/matrix-org/synapse/issues/6652">#6652</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Document the Room Shutdown Admin API. (<a href="https://github.com/matrix-org/synapse/issues/6541">#6541</a>)</li>
<li>Reword sections of <a href="docs/federate.md">docs/federate.md</a> that explained delegation at time of Synapse 1.0 transition. (<a href="https://github.com/matrix-org/synapse/issues/6601">#6601</a>)</li>
<li>Added the section 'Configuration' in <a href="docs/turn-howto.md">docs/turn-howto.md</a>. (<a href="https://github.com/matrix-org/synapse/issues/6614">#6614</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove redundant code from event authorisation implementation. (<a href="https://github.com/matrix-org/synapse/issues/6502">#6502</a>)</li>
<li>Remove unused, undocumented <code>/_matrix/content</code> API. (<a href="https://github.com/matrix-org/synapse/issues/6628">#6628</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add <em>experimental</em> support for multiple physical databases and split out state storage to separate data store. (<a href="https://github.com/matrix-org/synapse/issues/6245">#6245</a>, <a href="https://github.com/matrix-org/synapse/issues/6510">#6510</a>, <a href="https://github.com/matrix-org/synapse/issues/6511">#6511</a>, <a href="https://github.com/matrix-org/synapse/issues/6513">#6513</a>, <a href="https://github.com/matrix-org/synapse/issues/6564">#6564</a>, <a href="https://github.com/matrix-org/synapse/issues/6565">#6565</a>)</li>
<li>Port sections of code base to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6496">#6496</a>, <a href="https://github.com/matrix-org/synapse/issues/6504">#6504</a>, <a href="https://github.com/matrix-org/synapse/issues/6505">#6505</a>, <a href="https://github.com/matrix-org/synapse/issues/6517">#6517</a>, <a href="https://github.com/matrix-org/synapse/issues/6559">#6559</a>, <a href="https://github.com/matrix-org/synapse/issues/6647">#6647</a>, <a href="https://github.com/matrix-org/synapse/issues/6653">#6653</a>)</li>
<li>Remove <code>SnapshotCache</code> in favour of <code>ResponseCache</code>. (<a href="https://github.com/matrix-org/synapse/issues/6506">#6506</a>)</li>
<li>Silence mypy errors for files outside those specified. (<a href="https://github.com/matrix-org/synapse/issues/6512">#6512</a>)</li>
<li>Clean up some logging when handling incoming events over federation. (<a href="https://github.com/matrix-org/synapse/issues/6515">#6515</a>)</li>
<li>Test more folders against mypy. (<a href="https://github.com/matrix-org/synapse/issues/6534">#6534</a>)</li>
<li>Update <code>mypy</code> to new version. (<a href="https://github.com/matrix-org/synapse/issues/6537">#6537</a>)</li>
<li>Adjust the sytest blacklist for worker mode. (<a href="https://github.com/matrix-org/synapse/issues/6538">#6538</a>)</li>
<li>Remove unused <code>get_pagination_rows</code> methods from <code>EventSource</code> classes. (<a href="https://github.com/matrix-org/synapse/issues/6557">#6557</a>)</li>
<li>Clean up logs from the push notifier at startup. (<a href="https://github.com/matrix-org/synapse/issues/6558">#6558</a>)</li>
<li>Improve diagnostics on database upgrade failure. (<a href="https://github.com/matrix-org/synapse/issues/6570">#6570</a>)</li>
<li>Reduce the reconnect time when worker replication fails, to make it easier to catch up. (<a href="https://github.com/matrix-org/synapse/issues/6617">#6617</a>)</li>
<li>Simplify http handling by removing redundant <code>SynapseRequestFactory</code>. (<a href="https://github.com/matrix-org/synapse/issues/6619">#6619</a>)</li>
<li>Add a workaround for synapse raising exceptions when fetching the notary's own key from the notary. (<a href="https://github.com/matrix-org/synapse/issues/6620">#6620</a>)</li>
<li>Automate generation of the sample log config. (<a href="https://github.com/matrix-org/synapse/issues/6627">#6627</a>)</li>
<li>Simplify event creation code by removing redundant queries on the <code>event_reference_hashes</code> table. (<a href="https://github.com/matrix-org/synapse/issues/6629">#6629</a>)</li>
<li>Fix errors when <code>frozen_dicts</code> are enabled. (<a href="https://github.com/matrix-org/synapse/issues/6642">#6642</a>)</li>
</ul>
<p>Get the new release from <a href="https://github.com/matrix-org/synapse/releases/tag/v1.8.0">github</a> or any of the sources mentioned at https://github.com/matrix-org/synapse/blob/master/INSTALL.md.</p>

                
            </div>
        </article>
        
        <article class="post">
            <header>
                <h2><a href="&#x2F;blog&#x2F;2019&#x2F;12&#x2F;13&#x2F;synapse-1-7-0-released&#x2F;" title="Synapse 1.7.0 released">Synapse 1.7.0 released</a></h2>
                <span>
                    13.12.2019 00:00
                    —
                    <a href="/category/releases">
                        Releases
                    </a>
                    —
                    <a
                        href="/author/neil-johnson">
                        Neil Johnson
                    </a>
                </span>
                
            </header>
            <div>
                
                <p>Hello people, it’s Synapse 1.7.0 time.</p>
<p>This release includes some long requested features, most notably the ability to automatically delete message data after a predefined period. For more details take a look at the config <a href="https://github.com/matrix-org/synapse/blob/v1.7.0/docs/sample_config.yaml#L332-L393">here</a> ─ it should be pretty self explanatory.</p>
<p>Another significant change this release is to explicitly set room directories to be private by default. Previously it was possible to inadvertently configure the directory to be visible to arbitrary Matrix servers and the internet in general.</p>
<p>This means that for those admins who want their room directories to be publicly searchable (matrix.org for instance) they need to explicitly say so in the config. For more details see the <a href="https://github.com/matrix-org/synapse/blob/v1.7.0/UPGRADE.rst#upgrading-to-v170">upgrade notes</a> and our <a href="https://matrix.org/blog/2019/11/09/avoiding-unwelcome-visitors-on-private-matrix-servers/">blog post</a> explaining the situation in greater detail.</p>
<p>We also have early support for ephemeral messages, as well as the ability to specify a reason when rejecting an invite (amongst other actions).</p>
<p>Aside from all of that, we want to let you know about some changes on the horizon. Currently Synapse runs Sqlite by default. This is great in that it gets new admins going quickly without needing to install and configure Postgres. The downside of using Sqlite is that it offers very poor performance, especially once a server tries to join the federation. In truth Sqlite is only really there to demonstrate the service, but for anything other than the most trivial cases it is essential to migrate to Postgres.</p>
<p>Over the past few months we’ve been working to improve the migration path to Postgres such that finally we feel confident to actively encourage admins to migrate. What’s more, in a future release we will forcibly prevent SQLite-backed servers federating unless the admin explicitly sets a config flag to show that they understand the trade-off they are making.</p>
<p>Overall we see these changes as something that will improve everyone’s experience of the matrix federation. We’ll talk more about this closer to the time, but please expect a change in the coming months and if you are running SQLite, consider this a nudge to get yourself migrated.</p>
<p>As ever, you can get the new update <a href="https://github.com/matrix-org/synapse/releases/tag/v1.7.0">here</a> or any of the sources mentioned at <a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a>. Also, check out our <a href="https://matrix.org/docs/guides/installing-synapse">Synapse installation guide page</a>.</p>
<p>The changelog since 1.6.1 follows:</p>
<h1 id="synapse-1-7-0-2019-12-13">Synapse 1.7.0 (2019-12-13)</h1>
<p>This release changes the default settings so that only local authenticated users can query the server's room directory. See the <a href="https://github.com/matrix-org/synapse/blob/v1.7.0/UPGRADE.rst#upgrading-to-v170">upgrade notes</a> for details.</p>
<p>Support for SQLite versions before 3.11 is now deprecated. A future release will refuse to start if used with an SQLite version before 3.11.</p>
<p>Administrators are reminded that SQLite should not be used for production instances. Instructions for migrating to Postgres are available <a href="https://github.com/matrix-org/synapse/blob/v1.7.0/docs/postgres.md">here</a>. A future release of synapse will, by default, disable federation for servers using SQLite.</p>
<p>No significant changes since 1.7.0rc2.</p>
<h1 id="synapse-1-7-0rc2-2019-12-11">Synapse 1.7.0rc2 (2019-12-11)</h1>
<h2 id="bugfixes">Bugfixes</h2>
<ul>
<li>Fix incorrect error message for invalid requests when setting user's avatar URL. (<a href="https://github.com/matrix-org/synapse/issues/6497">#6497</a>)</li>
<li>Fix support for SQLite 3.7. (<a href="https://github.com/matrix-org/synapse/issues/6499">#6499</a>)</li>
<li>Fix regression where sending email push would not work when using a pusher worker. (<a href="https://github.com/matrix-org/synapse/issues/6507">#6507</a>, <a href="https://github.com/matrix-org/synapse/issues/6509">#6509</a>)</li>
</ul>
<h1 id="synapse-1-7-0rc1-2019-12-09">Synapse 1.7.0rc1 (2019-12-09)</h1>
<h2 id="features">Features</h2>
<ul>
<li>Implement per-room message retention policies. (<a href="https://github.com/matrix-org/synapse/issues/5815">#5815</a>, <a href="https://github.com/matrix-org/synapse/issues/6436">#6436</a>)</li>
<li>Add etag and count fields to key backup endpoints to help clients guess if there are new keys. (<a href="https://github.com/matrix-org/synapse/issues/5858">#5858</a>)</li>
<li>Add <code>/admin/v2/users</code> endpoint with pagination. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/5925">#5925</a>)</li>
<li>Require User-Interactive Authentication for <code>/account/3pid/add</code>, meaning the user's password will be required to add a third-party ID to their account. (<a href="https://github.com/matrix-org/synapse/issues/6119">#6119</a>)</li>
<li>Implement the <code>/_matrix/federation/unstable/net.atleastfornow/state/&lt;context&gt;</code> API as drafted in MSC2314. (<a href="https://github.com/matrix-org/synapse/issues/6176">#6176</a>)</li>
<li>Configure privacy-preserving settings by default for the room directory. (<a href="https://github.com/matrix-org/synapse/issues/6355">#6355</a>)</li>
<li>Add ephemeral messages support by partially implementing <a href="https://github.com/matrix-org/matrix-doc/pull/2228">MSC2228</a>. (<a href="https://github.com/matrix-org/synapse/issues/6409">#6409</a>)</li>
<li>Add support for <a href="https://github.com/matrix-org/matrix-doc/pull/2367">MSC 2367</a>, which allows specifying a reason on all membership events. (<a href="https://github.com/matrix-org/synapse/issues/6434">#6434</a>)</li>
</ul>
<h2 id="bugfixes-1">Bugfixes</h2>
<ul>
<li>Transfer non-standard power levels on room upgrade. (<a href="https://github.com/matrix-org/synapse/issues/6237">#6237</a>)</li>
<li>Fix error from the Pillow library when uploading RGBA images. (<a href="https://github.com/matrix-org/synapse/issues/6241">#6241</a>)</li>
<li>Correctly apply the event filter to the <code>state</code>, <code>events_before</code> and <code>events_after</code> fields in the response to <code>/context</code> requests. (<a href="https://github.com/matrix-org/synapse/issues/6329">#6329</a>)</li>
<li>Fix caching devices for remote users when using workers, so that we don't attempt to refetch (and potentially fail) each time a user requests devices. (<a href="https://github.com/matrix-org/synapse/issues/6332">#6332</a>)</li>
<li>Prevent account data syncs getting lost across TCP replication. (<a href="https://github.com/matrix-org/synapse/issues/6333">#6333</a>)</li>
<li>Fix bug: TypeError in <code>register_user()</code> while using LDAP auth module. (<a href="https://github.com/matrix-org/synapse/issues/6406">#6406</a>)</li>
<li>Fix an intermittent exception when handling read-receipts. (<a href="https://github.com/matrix-org/synapse/issues/6408">#6408</a>)</li>
<li>Fix broken guest registration when there are existing blocks of numeric user IDs. (<a href="https://github.com/matrix-org/synapse/issues/6420">#6420</a>)</li>
<li>Fix startup error when http proxy is defined. (<a href="https://github.com/matrix-org/synapse/issues/6421">#6421</a>)</li>
<li>Fix error when using synapse_port_db on a vanilla synapse db. (<a href="https://github.com/matrix-org/synapse/issues/6449">#6449</a>)</li>
<li>Fix uploading multiple cross signing signatures for the same user. (<a href="https://github.com/matrix-org/synapse/issues/6451">#6451</a>)</li>
<li>Fix bug which lead to exceptions being thrown in a loop when a cross-signed device is deleted. (<a href="https://github.com/matrix-org/synapse/issues/6462">#6462</a>)</li>
<li>Fix <code>synapse_port_db</code> not exiting with a 0 code if something went wrong during the port process. (<a href="https://github.com/matrix-org/synapse/issues/6470">#6470</a>)</li>
<li>Improve sanity-checking when receiving events over federation. (<a href="https://github.com/matrix-org/synapse/issues/6472">#6472</a>)</li>
<li>Fix inaccurate per-block Prometheus metrics. (<a href="https://github.com/matrix-org/synapse/issues/6491">#6491</a>)</li>
<li>Fix small performance regression for sending invites. (<a href="https://github.com/matrix-org/synapse/issues/6493">#6493</a>)</li>
<li>Back out cross-signing code added in Synapse 1.5.0, which caused a performance regression. (<a href="https://github.com/matrix-org/synapse/issues/6494">#6494</a>)</li>
</ul>
<h2 id="improved-documentation">Improved Documentation</h2>
<ul>
<li>Update documentation and variables in user contributed systemd reference file. (<a href="https://github.com/matrix-org/synapse/issues/6369">#6369</a>, <a href="https://github.com/matrix-org/synapse/issues/6490">#6490</a>)</li>
<li>Fix link in the user directory documentation. (<a href="https://github.com/matrix-org/synapse/issues/6388">#6388</a>)</li>
<li>Add build instructions to the docker readme. (<a href="https://github.com/matrix-org/synapse/issues/6390">#6390</a>)</li>
<li>Switch Ubuntu package install recommendation to use python3 packages in INSTALL.md. (<a href="https://github.com/matrix-org/synapse/issues/6443">#6443</a>)</li>
<li>Write some docs for the quarantine_media api. (<a href="https://github.com/matrix-org/synapse/issues/6458">#6458</a>)</li>
<li>Convert CONTRIBUTING.rst to markdown (among other small fixes). (<a href="https://github.com/matrix-org/synapse/issues/6461">#6461</a>)</li>
</ul>
<h2 id="deprecations-and-removals">Deprecations and Removals</h2>
<ul>
<li>Remove admin/v1/users_paginate endpoint. Contributed by Awesome Technologies Innovationslabor GmbH. (<a href="https://github.com/matrix-org/synapse/issues/5925">#5925</a>)</li>
<li>Remove fallback for federation with old servers which lack the /federation/v1/state_ids API. (<a href="https://github.com/matrix-org/synapse/issues/6488">#6488</a>)</li>
</ul>
<h2 id="internal-changes">Internal Changes</h2>
<ul>
<li>Add benchmarks for structured logging and improve output performance. (<a href="https://github.com/matrix-org/synapse/issues/6266">#6266</a>)</li>
<li>Improve the performance of outputting structured logging. (<a href="https://github.com/matrix-org/synapse/issues/6322">#6322</a>)</li>
<li>Refactor some code in the event authentication path for clarity. (<a href="https://github.com/matrix-org/synapse/issues/6343">#6343</a>, <a href="https://github.com/matrix-org/synapse/issues/6468">#6468</a>, <a href="https://github.com/matrix-org/synapse/issues/6480">#6480</a>)</li>
<li>Clean up some unnecessary quotation marks around the codebase. (<a href="https://github.com/matrix-org/synapse/issues/6362">#6362</a>)</li>
<li>Complain on startup instead of 500'ing during runtime when <code>public_baseurl</code> isn't set when necessary. (<a href="https://github.com/matrix-org/synapse/issues/6379">#6379</a>)</li>
<li>Add a test scenario to make sure room history purges don't break <code>/messages</code> in the future. (<a href="https://github.com/matrix-org/synapse/issues/6392">#6392</a>)</li>
<li>Clarifications for the email configuration settings. (<a href="https://github.com/matrix-org/synapse/issues/6423">#6423</a>)</li>
<li>Add more tests to the blacklist when running in worker mode. (<a href="https://github.com/matrix-org/synapse/issues/6429">#6429</a>)</li>
<li>Refactor data store layer to support multiple databases in the future. (<a href="https://github.com/matrix-org/synapse/issues/6454">#6454</a>, <a href="https://github.com/matrix-org/synapse/issues/6464">#6464</a>, <a href="https://github.com/matrix-org/synapse/issues/6469">#6469</a>, <a href="https://github.com/matrix-org/synapse/issues/6487">#6487</a>)</li>
<li>Port synapse.rest.client.v1 to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6482">#6482</a>)</li>
<li>Port synapse.rest.client.v2_alpha to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6483">#6483</a>)</li>
<li>Port SyncHandler to async/await. (<a href="https://github.com/matrix-org/synapse/issues/6484">#6484</a>)</li>
</ul>

                
            </div>
        </article>
        
        <nav class="pagination">
    <div class="prev">
        
        <a href="&#x2F;author&#x2F;neil-johnson&#x2F;">‹ Previous</a>
        
    </div>
    <span class="page-number">2 / 7</span>
    <div class="prev">
        
        <a href="&#x2F;author&#x2F;neil-johnson&#x2F;page&#x2F;3&#x2F;">Next ›</a>
        
    </div>
</nav>

    </div>
</div>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="&#x2F;code"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
