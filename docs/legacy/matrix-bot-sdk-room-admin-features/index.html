<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />

    <title>Matrix.org - matrix-bot-sdk Room Admin Features</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/png" href="/assets/favicon.png" />
    <link rel="stylesheet" href="/style.css" />

    </head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="&#x2F;about&#x2F;" class="
            ">
            About
        </a>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            ">
            Blog
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;docs&#x2F;" class="section current">
                Documentation
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    
                    <a href="&#x2F;docs&#x2F;users&#x2F;">Users</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;communities&#x2F;">Communities</a>
                    
                    
                    <a href="&#x2F;docs&#x2F;legacy&#x2F;">Legacy documentation</a>
                    
                </div>
            </div>
        </div>
        
        
        
        
        
        <div class="section-wrap">
            <a href="&#x2F;ecosystem&#x2F;" class="section ">
                Ecosystem
            </a>
            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bots&#x2F;">Bots</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;podcasts&#x2F;" class="
            ">
            Podcasts
        </a>
        
        
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org" class="
            ">
            Shop
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<article class="content">
    <header>
        <div class="legacy-doc-warning">
            <h2>Outdated documentation</h2>
            <p>This documentation has been kept for posterity but might be or
               will be outdated. It should not be used anymore. Please head to
               <a href="/docs">the documentation section</a> for up to date
               documentation and guides.
            </p>
        </div>
        <h1>matrix-bot-sdk Room Admin Features</h1>
    </header>
    <h2 id="intro">Intro</h2>
<p><a href="https://github.com/turt2live/matrix-bot-sdk">matrix-bot-sdk</a> has features which enable bots to perform administration of
Matrix roooms - tasks like kicking, banning and inviting users. Of course, the
bot must have the appropriate permissions for the room in order for this to
work.</p>
<p>You should read <a href="https://matrix.org/docs/guides/usage-of-matrix-bot-sdk">Usage of matrix-bot-sdk</a> for a more fundamental introduction to
the SDK.</p>
<h2 id="kicking">Kicking</h2>
<p>Kicking a user means that user is removed from the room by force, but is not
banned - so they are able to re-join.</p>
<p>Once you have your client object running (see
<a href="https://matrix.org/docs/guides/usage-of-matrix-bot-sdk#instantiation">usage-of-matrix-bot-sdk#instantiation
</a>), you
can use the <code>kickUser()</code> method. There are three parameters:</p>
<ul>
<li>the user ID (MXID) you want to kick</li>
<li>the room ID they will be removed from</li>
<li>(optional) a string explaining why they were kicked</li>
</ul>
<pre data-lang="javascript" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-javascript "><code class="language-javascript" data-lang="javascript"><span style="color:#569cd6;">var </span><span>userId = </span><span style="color:#d69d85;">&quot;@theirmxid:theirserver.tld&quot;</span><span>;
</span><span style="color:#569cd6;">var </span><span>roomId = </span><span style="color:#d69d85;">&quot;!theroomid:servername.tld&quot;</span><span>;
</span><span style="color:#569cd6;">var </span><span>message = </span><span style="color:#d69d85;">&quot;Get out!&quot;</span><span>;
</span><span>client.kickUser(userId, roomId, message);
</span></code></pre>
<h2 id="banning">Banning</h2>
<p>Banning means the user is kicked from a room and unable to re-enter. The method
is very similar to Kicking in that it has three parameters:</p>
<ul>
<li>the user ID (MXID) you want to ban</li>
<li>the room ID they will be removed and banned from</li>
<li>(optional) a string explaining why they were banned</li>
</ul>
<pre data-lang="javascript" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-javascript "><code class="language-javascript" data-lang="javascript"><span style="color:#569cd6;">var </span><span>userId = </span><span style="color:#d69d85;">&quot;@theirmxid:theirserver.tld&quot;</span><span>;
</span><span style="color:#569cd6;">var </span><span>roomId = </span><span style="color:#d69d85;">&quot;!theroomid:servername.tld&quot;</span><span>;
</span><span style="color:#569cd6;">var </span><span>message = </span><span style="color:#d69d85;">&quot;Get out, and don&#39;t come back!&quot;</span><span>;
</span><span>client.banUser(userId, roomId, message);
</span></code></pre>
<h2 id="inviting">Inviting</h2>
<p>Inviting a user to join a room - much friendlier than kicking or banning them!
Inviting a user needs only two parameters:</p>
<ul>
<li>the userId to invite</li>
<li>the roomId you're inviting them to join</li>
</ul>
<pre data-lang="javascript" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-javascript "><code class="language-javascript" data-lang="javascript"><span style="color:#569cd6;">var </span><span>userId = </span><span style="color:#d69d85;">&quot;@theirmxid:theirserver.tld&quot;</span><span>;
</span><span style="color:#569cd6;">var </span><span>roomId = </span><span style="color:#d69d85;">&quot;!theroomid:servername.tld&quot;</span><span>;
</span><span>client.inviteUser(userId, roomId);
</span></code></pre>
<h2 id="reading-the-members-list">Reading the members list</h2>
<p>How about if we want to know who is currently in (joined to) a room? We can use
the <code>getJoinedRoomMembers()</code> method, which takes only a roomId as a param. To
get a result from this method, we should await it:</p>
<pre data-lang="javascript" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-javascript "><code class="language-javascript" data-lang="javascript"><span style="color:#569cd6;">var </span><span>roomId = </span><span style="color:#d69d85;">&quot;!theroomid:servername.tld&quot;</span><span>;
</span><span style="color:#569cd6;">const </span><span>members = </span><span style="color:#569cd6;">await </span><span>client.getJoinedRoomMembers(roomId);
</span></code></pre>
<p><code>members</code> will now contain an array of strings we can inspect.</p>
<h2 id="responding-to-a-keyword">Responding to a keyword</h2>
<p>In <a href="https://matrix.org/docs/guides/usage-of-matrix-bot-sdk#implementing-echobot-functionality">usage-of-matrix-bot-sdk#implementing-echobot-functionality
</a>,
we showed how it's possible to read the content of messages and respond to
them. To reiterate:</p>
<pre data-lang="javascript" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-javascript "><code class="language-javascript" data-lang="javascript"><span>client.on(</span><span style="color:#d69d85;">&quot;room.message&quot;</span><span>, (roomId, event) </span><span style="color:#569cd6;">=&gt; </span><span>{
</span><span>    </span><span style="color:#569cd6;">if </span><span>(</span><span style="color:#569cd6;">! </span><span>event[</span><span style="color:#d69d85;">&quot;content&quot;</span><span>]) </span><span style="color:#569cd6;">return</span><span>;
</span><span>    </span><span style="color:#569cd6;">const </span><span>body = event[</span><span style="color:#d69d85;">&quot;content&quot;</span><span>][</span><span style="color:#d69d85;">&quot;body&quot;</span><span>];
</span><span>
</span><span>    </span><span style="color:#569cd6;">if </span><span>(body </span><span style="color:#569cd6;">&amp;&amp; </span><span>body.indexOf(</span><span style="color:#d69d85;">&quot;keyword&quot;</span><span>) !== -</span><span style="color:#b5cea8;">1</span><span>) {
</span><span>        client.sendMessage(roomId, {
</span><span>            </span><span style="color:#d69d85;">&quot;msgtype&quot;</span><span>: </span><span style="color:#d69d85;">&quot;m.text&quot;</span><span>,
</span><span>            </span><span style="color:#d69d85;">&quot;body&quot;</span><span>: </span><span style="color:#d69d85;">&quot;response to keyword&quot;</span><span>,
</span><span>        });
</span><span>    }
</span><span>});
</span></code></pre>
<p>Here we read the contents of a message, check for the presence of the
string &quot;keyword&quot;. If we find that string, we send a response to that message.</p>
<blockquote>
<p>Note the very subtle bug/issue with this snippet as written: Since the
callback doesn't check the sender, and it sends the string &quot;keyword&quot; in the
reply, this would actually respond to itself forever!</p>
</blockquote>
<h2 id="reacting-to-a-keyword-with-a-kick">Reacting to a keyword with a kick</h2>
<p>Now that we've seen kicks, and we've seen reading a message to decide how to
respond, we can make a (very crude) automoderator:</p>
<pre data-lang="javascript" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-javascript "><code class="language-javascript" data-lang="javascript"><span>client.on(</span><span style="color:#d69d85;">&quot;room.message&quot;</span><span>, (roomId, event) </span><span style="color:#569cd6;">=&gt; </span><span>{
</span><span>    </span><span style="color:#569cd6;">if </span><span>(</span><span style="color:#569cd6;">! </span><span>event[</span><span style="color:#d69d85;">&quot;content&quot;</span><span>]) </span><span style="color:#569cd6;">return</span><span>;
</span><span>    </span><span style="color:#569cd6;">const </span><span>body = event[</span><span style="color:#d69d85;">&quot;content&quot;</span><span>][</span><span style="color:#d69d85;">&quot;body&quot;</span><span>];
</span><span>
</span><span>    </span><span style="color:#569cd6;">if </span><span>(body </span><span style="color:#569cd6;">&amp;&amp; </span><span>body.indexOf(</span><span style="color:#d69d85;">&quot;keyword&quot;</span><span>) !== -</span><span style="color:#b5cea8;">1</span><span>) {
</span><span>        client.kickUser(event[</span><span style="color:#d69d85;">&quot;sender&quot;</span><span>], roomId, </span><span style="color:#d69d85;">&quot;no!&quot;</span><span>)
</span><span>    }
</span><span>});
</span></code></pre>
<p>It's as simple as taking the <code>event[&quot;sender&quot;]</code> field, and passing it to
<code>kickUser()</code>. Now, any time anyone says &quot;keyword&quot;, they'll be kicked.</p>
<h2 id="using-promises-to-know-if-a-request-succeeded">Using promises to know if a request succeeded</h2>
<p><a href="https://github.com/turt2live/matrix-bot-sdk">matrix-bot-sdk</a> is promise-based, so you can chain <code>.then()</code> and <code>.catch ()</code> methods to your Matrix calls to respond after they return:</p>
<pre data-lang="javascript" style="background-color:#1e1e1e;color:#dcdcdc;" class="language-javascript "><code class="language-javascript" data-lang="javascript"><span>client.kickUser(userId, roomId, </span><span style="color:#d69d85;">&quot;no!&quot;</span><span>)
</span><span>    .then(() </span><span style="color:#569cd6;">=&gt; </span><span>{
</span><span>        client.sendMessage(roomId, {
</span><span>            </span><span style="color:#d69d85;">&quot;msgtype&quot;</span><span>: </span><span style="color:#d69d85;">&quot;m.text&quot;</span><span>,
</span><span>            </span><span style="color:#d69d85;">&quot;body&quot;</span><span>: </span><span style="color:#d69d85;">`please don&#39;t say that in here`
</span><span>        });
</span><span>    });
</span></code></pre>
<h2 id="putting-it-all-together-absurdly">Putting it all together absurdly</h2>
<p>I was inspired by <a href="http://bash.org/?178890">this bash.org Quote</a>, in which a
user baits two bots:</p>
<ul>
<li>one bot is baited into saying a forbidden keyword</li>
<li>and is immediately banned by an overzealous automoderator</li>
</ul>
<p>I created a series of bots to endlessly recreate the scene in Matrix:</p>
<ol>
<li>replies with a specific string when asked</li>
<li>checks for the presence of (1), requests the string when it sees them</li>
<li>kicks anyone who says a word that happens to be included in (1)'s string</li>
<li>invites (1) when they are seen to be absent</li>
</ol>
<p>This uses several concepts from this guide to create an endless silly scene.</p>
<p><img src="/docs/legacy/bot-dance.png" alt="screenshot showing the bots interacting" /></p>
<p>You can find the code for <a href="https://github.com/benparsons/bot-dance">this strange project here
</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p><a href="https://github.com/turt2live/matrix-bot-sdk">matrix-bot-sdk</a> can do a great deal when it comes to room administration. Check out <a href="https://github.com/turt2live/matrix-bot-sdk">the repo</a> directly to find out more - or if you need a more introductory guide see <a href="https://matrix.org/docs/guides/usage-of-matrix-bot-sdk">Usage of matrix-bot-sdk</a>.</p>

</article>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;faq">FAQs</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct for Matrix.org</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="&#x2F;code"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
        </div>
    </div>
    <p>© 2022 The Matrix.org Foundation C.I.C.</p>
</footer>

</body>

</html>
